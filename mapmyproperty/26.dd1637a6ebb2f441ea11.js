(function(){var e={"arcgis-js-api/views/3d/layers/graphics/elevationAlignmentUtils":"/9Lg","arcgis-js-api/renderers/support/clickToleranceUtils":"/E+R","arcgis-js-api/views/3d/layers/graphics/GraphicState":"/NuL","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":"0W55","arcgis-js-api/core/libs/earcut/earcut":"1E+e","arcgis-js-api/views/3d/interactive/editingTools/manipulatorUtils":"1eTA","arcgis-js-api/views/3d/webgl-engine/lighting/SphericalHarmonics":"2Mej","arcgis-js-api/views/3d/interactive/visualElements/VisualElementResources":"2W+Z","arcgis-js-api/symbols/support/defaultsJSON":"35hF","arcgis-js-api/geometry/support/triangulationUtils":"3Zlx","arcgis-js-api/core/libs/gl-matrix-2/factories/vec4f32":"3gjc","arcgis-js-api/views/3d/interactive/editingTools/manipulations/Manipulation":"48/q","arcgis-js-api/views/3d/interactive/editingTools/transformGraphic/GraphicTransformTool":"4QR8","arcgis-js-api/views/3d/webgl-engine/lib/GeometryUtil":"4ziW","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":"58az","arcgis-js-api/views/3d/interactive/manipulatorUtils":"5T2R","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYAxisManipulation":"6hC7","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":"6vp1","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYGraphicManipulation":"73uV","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":"7zqm","arcgis-js-api/views/3d/interactive/editingTools/moveGraphic/GraphicMoveTool":"A5GR","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":"B4Pz","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveManipulation":"BhkK","arcgis-js-api/views/3d/layers/graphics/graphicUtils":"BwdQ","arcgis-js-api/views/3d/webgl-engine/materials/WaterGLMaterial":"CP88","arcgis-js-api/core/libs/gl-matrix-2/mat2":"CqfC","arcgis-js-api/views/3d/webgl-engine/shaders/ColorMaterial.glsl":"DFuO","arcgis-js-api/views/3d/support/debugFlags":"Dk48","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":"E/g4","arcgis-js-api/views/3d/webgl-engine/shaders/ColorMaterialTechnique":"EiS2","arcgis-js-api/views/3d/webgl-engine/lib/renderStats":"FLCf","arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialRep":"FU3N","arcgis-js-api/views/3d/webgl-engine/materials/lineStippleUtils":"FbvD","arcgis-js-api/views/3d/interactive/editingTools/manipulations/config":"Fe95","arcgis-js-api/views/3d/interactive/editingTools/visualElementUtils":"G+tB","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/CommonUniformStore":"GDWR","arcgis-js-api/views/3d/layers/graphics/constants":"HbaO","arcgis-js-api/views/3d/layers/graphics/sdfPrimitives":"J2BX","arcgis-js-api/views/3d/interactive/editingTools/reshapeGraphic/ReshapeOperation":"JXo2","arcgis-js-api/views/3d/webgl-engine/lib/LongVectorMath":"KPBO","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/TextureOnly.glsl":"KQg4","arcgis-js-api/core/colorUtils":"KtQ6","arcgis-js-api/views/3d/interactive/editingTools/ManipulatorState":"Kvb2","arcgis-js-api/core/libs/gl-matrix-2/mat2f64":"KwnQ","arcgis-js-api/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":"LZD4","arcgis-js-api/views/3d/interactive/visualElements/LaserlineVisualElement":"MCHn","arcgis-js-api/views/3d/terrain/OverlayRenderTarget":"N+ip","arcgis-js-api/views/interactive/GraphicManipulator":"N78w","arcgis-js-api/views/support/drapedUtils":"NbdF","arcgis-js-api/views/3d/webgl-engine/shaders/ShadedColorMaterial.glsl":"NiJV","arcgis-js-api/views/3d/interactive/editingTools/lineGraphicVisualElementUtils":"PLh7","arcgis-js-api/views/3d/interactive/visualElements/LineVisualElement":"PXiz","arcgis-js-api/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":"Px2u","arcgis-js-api/views/3d/webgl-engine/lighting/SceneLighting":"QDiq","arcgis-js-api/views/3d/interactive/visualElements/OutlineVisualElement":"R4nD","arcgis-js-api/views/3d/webgl-engine/materials/RibbonLineMaterial":"RC9r","arcgis-js-api/views/3d/interactive/editingTools/transformGraphic/GraphicScaleRotateTransform":"RWrl","arcgis-js-api/views/3d/webgl-engine/lib/RenderContext":"Raj5","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":"RdU/","arcgis-js-api/views/3d/webgl-engine/lib/Camera":"RsYQ","arcgis-js-api/views/3d/webgl-engine/shaders/RibbonLineTechnique":"SNs2","arcgis-js-api/views/3d/interactive/visualElements/VerticesVisualElement":"T95R","arcgis-js-api/views/3d/interactive/editingTools/snapping/SnapToScene":"TIRl","arcgis-js-api/views/3d/webgl-engine/shaders/LaserlinePath.glsl":"UGy0","arcgis-js-api/views/3d/support/pointUtils":"UidR","arcgis-js-api/views/3d/webgl-engine/shaders/HUDMaterial.glsl":"VQEQ","arcgis-js-api/views/3d/interactive/editingTools/settings":"X5J5","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":"Xakh","arcgis-js-api/views/3d/webgl-engine/lib/TextureTechnique":"XcBT","arcgis-js-api/views/3d/webgl-engine/lib/ResizableFloat32Array":"YseA","arcgis-js-api/views/3d/webgl-engine/lib/Layer":"ZO6V","arcgis-js-api/views/3d/webgl-engine/materials/renderers/MergedRenderer":"ZeO9","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":"aRjO","arcgis-js-api/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":"ama6","arcgis-js-api/views/3d/interactive/visualElements/DrapedVisualElementResources":"as1Q","arcgis-js-api/views/3d/webgl-engine/lib/RenderGeometry":"cjy9","arcgis-js-api/symbols/support/defaults":"dXKx","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":"dl/g","arcgis-js-api/views/3d/interactive/editingTools/manipulations/moveUtils":"dtql","arcgis-js-api/views/3d/webgl-engine/lib/localOrigin":"eHCP","arcgis-js-api/views/3d/layers/graphics/ElevationContext":"fOZq","arcgis-js-api/views/3d/webgl-engine/shaders/ShadedColorMaterialTechnique":"fQ2U","arcgis-js-api/views/3d/webgl-engine/shaders/LaserlineTechnique":"fUJJ","arcgis-js-api/views/3d/support/LaserlinePathData":"gG9S","arcgis-js-api/views/3d/interactive/visualElements/VisualElement":"gxI5","arcgis-js-api/views/3d/layers/graphics/lineUtils":"hADE","arcgis-js-api/views/3d/support/LaserLineRenderer":"hX2R","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/Laserline.glsl":"hk44","arcgis-js-api/views/3d/webgl-engine/lib/GridLocalOriginFactory":"hkmr","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":"hs8d","arcgis-js-api/views/3d/interactive/visualElements/PointVisualElement":"i10q","arcgis-js-api/views/3d/terrain/OverlayRenderer":"ij3I","arcgis-js-api/core/libs/gl-matrix-2/vec4f32":"j2SP","arcgis-js-api/views/3d/webgl-engine/shaders/WaterSurface.glsl":"jl7D","arcgis-js-api/views/3d/webgl-engine/lib/Octree":"mYMs","arcgis-js-api/views/3d/webgl-engine/shaders/RibbonLine.glsl":"ne9J","arcgis-js-api/views/3d/webgl-engine/materials/ColorMaterial":"o5p5","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":"pLfv","arcgis-js-api/views/3d/webgl-engine/materials/renderers/Instance":"pbva","arcgis-js-api/views/3d/webgl-engine/shaders/HUDMaterialTechnique":"pqGg","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveZManipulation":"pvGl","arcgis-js-api/views/3d/webgl-engine/shaders/Laserlines.glsl":"qSzK","arcgis-js-api/views/3d/webgl-engine/lighting/Lightsources":"qUb7","arcgis-js-api/views/3d/interactive/editingTools":"qkUi","arcgis-js-api/core/libs/gl-matrix-2/types/mat4":"qvwY","arcgis-js-api/views/3d/webgl-engine/shaders/LaserlinePathTechnique":"raiv","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":"sQDZ","arcgis-js-api/views/3d/interactive/editingTools/reshapeGraphic/GraphicReshapeTool":"uNfR","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":"uUnu","arcgis-js-api/views/3d/webgl-engine/materials/ShadedColorMaterial":"uZGf","arcgis-js-api/views/3d/interactive/editingTools/draw/DrawGraphicTool":"ub+M","arcgis-js-api/views/3d/interactive/editingTools/pointGraphicVisualElementUtils":"uinn","arcgis-js-api/views/3d/layers/graphics/pointUtils":"v+nG","arcgis-js-api/views/3d/webgl-engine/materials/WaterTechnique":"v22c","arcgis-js-api/views/3d/support/ElevationProvider":"vA3N","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":"vGsU","arcgis-js-api/core/libs/gl-matrix-2/math/mat2":"vJh7","arcgis-js-api/views/3d/webgl-engine/materials/HUDMaterial":"xFEL","arcgis-js-api/layers/graphics/hydratedFeatures":"xdO3","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":"y68M","arcgis-js-api/views/3d/layers/graphics/featureExpressionInfoUtils":"yVFQ","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":"ybGv","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYDiscManipulation":"yjgM","arcgis-js-api/core/libs/gl-matrix-2/factories/mat2f64":"z4cv","arcgis-js-api/views/3d/webgl-engine/lib/rendererUtils":"znI2"},t=this||window,n=t.webpackJsonp=t.webpackJsonp||[];n.registerAbsMids?n.registerAbsMids(e):(n.absMidsWaiting=n.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{"/9Lg":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("FXVB"),n("1m5D"),n("Rdxj"),n("BwdQ"),n("vA3N"),n("mmEe")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){"use strict";function c(e,t,r,i,a){var o=e.z||0;switch(r.mode){case"on-the-ground":var l=s.getElevationAtPoint(t,e,"ground")||0;return a&&(a.verticalDistanceToGround=0,a.sampledElevation=l),l;case"relative-to-ground":l=s.getElevationAtPoint(t,e,"ground")||0;var c=r.geometryZWithOffset(o,i);return a&&(a.verticalDistanceToGround=c,a.sampledElevation=l),c+l;case"relative-to-scene":return l=s.getElevationAtPoint(t,e,"scene")||0,c=r.geometryZWithOffset(o,i),a&&(a.verticalDistanceToGround=c,a.sampledElevation=l),c+l;case"absolute-height":if(c=r.geometryZWithOffset(o,i),a){var u=s.getElevationAtPoint(t,e,"ground")||0;a.verticalDistanceToGround=c-u,a.sampledElevation=u}return c;default:return n.neverReached(r.mode),0}}var u;Object.defineProperty(t,"__esModule",{value:!0}),t.SymbolUpdateType=t.applyElevationAlignmentForHUD=t.needsElevationUpdates3D=t.needsElevationUpdates2D=t.elevationModeChangeUpdateType=t.evaluateElevationAlignmentAtPoint=t.applyPerVertexElevationAlignment=void 0,t.applyPerVertexElevationAlignment=function(e,t,n,r,i,a,o,s,c,u,d){var h,f,v=p[d.mode],m=0;if(l.bufferToBuffer(e,t,n,r,c.spatialReference,i,s)&&(v.requiresAlignment(d)?(m=v.applyElevationAlignmentBuffer(r,i,a,o,s,c,u,d),h=a,f=o):(h=r,f=i),l.bufferToBuffer(h,c.spatialReference,f,a,u.spatialReference,o,s)))return m},t.evaluateElevationAlignmentAtPoint=c,t.elevationModeChangeUpdateType=function(e,t,n){return null==t||null==n?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?u.UPDATE:e.onTheGroundChanged},t.needsElevationUpdates2D=function(e){return"relative-to-ground"===e||"relative-to-scene"===e},t.needsElevationUpdates3D=function(e){return"absolute-height"!==e},t.applyElevationAlignmentForHUD=function(e,t,n,i,a){var s=c(t,n,a,i,h);o.updateVertexAttributeAuxpos1w(e,h.verticalDistanceToGround);var u=h.sampledElevation,p=r.mat4.copy(d,e.objectTransformation);return f[0]=t.x,f[1]=t.y,f[2]=s,l.computeLinearTransformation(t.spatialReference,f,p,i.spatialReference)?e.objectTransformation=p:console.warn("Could not locate symbol object properly, it might be misplaced"),u},function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(u=t.SymbolUpdateType||(t.SymbolUpdateType={}));var p={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var l=s.calculateOffsetRenderUnits(o),c=s.featureExpressionInfoContext;t*=3,r*=3;for(var u=0;u<i;++u){var p=e[t+1],d=e[t+2];n[r+0]=e[t+0],n[r+1]=p,n[r+2]=null==c?d+l:l,t+=3,r+=3}return 0},requiresAlignment:function(e){return 0!==e.meterUnitOffset||null!=e.featureExpressionInfoContext}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a){var o=0,s=a.spatialReference;t*=3,r*=3;for(var l=0;l<i;++l){var c=e[t+0],u=e[t+1],p=a.getElevation(c,u,e[t+2],s,"ground")||0;o+=p,n[r+0]=c,n[r+1]=u,n[r+2]=p,t+=3,r+=3}return o/i},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var l=0,c=s.calculateOffsetRenderUnits(o),u=s.featureExpressionInfoContext,p=a.spatialReference;t*=3,r*=3;for(var d=0;d<i;++d){var h=e[t+0],f=e[t+1],v=e[t+2],m=a.getElevation(h,f,v,p,"ground")||0;l+=m,n[r+0]=h,n[r+1]=f,n[r+2]=null==u?v+m+c:m+c,t+=3,r+=3}return l/i},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var l=0,c=s.calculateOffsetRenderUnits(o),u=s.featureExpressionInfoContext,p=a.spatialReference;t*=3,r*=3;for(var d=0;d<i;++d){var h=e[t+0],f=e[t+1],v=e[t+2],m=a.getElevation(h,f,v,p,"scene")||0;l+=m,n[r+0]=h,n[r+1]=f,n[r+2]=null==u?v+m+c:m+c,t+=3,r+=3}return l/i},requiresAlignment:function(){return!0}}},d=i.mat4f64.create(),h={verticalDistanceToGround:0,sampledElevation:0},f=a.vec3f64.create()}).apply(null,r))||(e.exports=i)},"/E+R":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,n=0,r=0;r<e.length;r++){var i=e[r].size;"number"==typeof i&&(t+=i,n++)}return t/n}(e.stops):t}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateTolerance=void 0,t.calculateTolerance=function(e){var t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;var a="visualVariables"in t?function(e,t){if(!t)return e;var n=t.filter((function(e){return"size"===e.type})).map((function(t){var n=t.minSize;return(r(t.maxSize,e)+r(n,e))/2})),i=0,a=n.length;if(0===a)return e;for(var o=0;o<a;o++)i+=n[o];var s=Math.floor(i/a);return Math.max(s,e)}(i,t.visualVariables):i;if("simple"===t.type)return n(a,t.symbol);if("unique-value"===t.type){var o=a;return t.uniqueValueInfos.forEach((function(e){o=n(o,e.symbol)})),o}if("class-breaks"===t.type){var s=a;return t.classBreakInfos.forEach((function(e){s=n(s,e.symbol)})),s}return a}}).apply(null,r))||(e.exports=i)},"/NuL":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("BcWh"),n("Vx27")],void 0===(i=(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicState=void 0;var a=function(e){function t(t){var n=e.call(this,t)||this;return n.tracking=!1,n.displaying=!1,n.isDraped=!1,n}return n.__extends(t,e),n.__decorate([i.property({constructOnly:!0})],t.prototype,"graphic",void 0),n.__decorate([i.property()],t.prototype,"tracking",void 0),n.__decorate([i.property()],t.prototype,"displaying",void 0),n.__decorate([i.property()],t.prototype,"isDraped",void 0),n.__decorate([i.subclass("esri.views.3d.layers.graphics.GraphicState")],t)}(r.EventedAccessor);t.GraphicState=a}).apply(null,r))||(e.exports=i)},"0W55":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSpacePass=void 0,t.ScreenSpacePass=function(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = position * 0.5 + vec2(0.5);\n    }\n  "],["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = position * 0.5 + vec2(0.5);\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},"1E+e":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function n(e,t,n,r,i){var a;if(i===h(e,t,n,r)>0)for(var o=t;o<n;o+=r)a=s(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=s(o,e[o],e[o+1],a);return a&&g(a,a.next)&&(l(a),a=a.next),a}function r(e,t){if(void 0===t&&(t=e),!e)return e;var n,r=e;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==p(r.prev,r,r.next))r=r.next;else{if(l(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,s,c,u,p){if(void 0===p&&(p=0),e){!p&&u&&(e=function e(t,n,r,i){for(var a=void 0;a!==t;a=a.next){if(null===(a=a||t).z&&(a.z=m(a.x,a.y,n,r,i)),a.prev.next!==a||a.next.prev!==a)return a.prev.next=a,a.next.prev=a,e(t,n,r,i);a.prevZ=a.prev,a.nextZ=a.next}return t.prevZ.nextZ=null,t.prevZ=null,function(e){for(var t,n=1;;){var r=e,i=void 0;e=null,t=null;for(var a=0;r;){a++,i=r;for(var o=0;o<n&&i;o++)i=i.nextZ;for(var s=n;o>0||s>0&&i;){var l=void 0;0===o?(l=i,i=i.nextZ,s--):0!==s&&i?r.z<=i.z?(l=r,r=r.nextZ,o--):(l=i,i=i.nextZ,s--):(l=r,r=r.nextZ,o--),t?t.nextZ=l:e=l,l.prevZ=t,t=l}r=i}if(t.nextZ=null,n*=2,a<2)return e}}(t)}(e,s,c,u));for(var d=e;e.prev!==e.next;){var h=e.prev,f=e.next;if(u?o(e,s,c,u):a(e))t.push(h.index/n),t.push(e.index/n),t.push(f.index/n),l(e),e=f.next,d=f.next;else if((e=f)===d){p?1===p?i(e=_(e,t,n),t,n,s,c,u,2):2===p&&b(e,t,n,s,c,u):i(r(e),t,n,s,c,u,1);break}}}}function a(e){var t=e.prev,n=e,r=e.next;if(p(t,n,r)>=0)return!1;for(var i=e.next.next,a=i,o=0;i!==e.prev&&(0===o||i!==a);){if(o++,f(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&p(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function o(e,t,n,r){var i=e.prev,a=e,o=e.next;if(p(i,a,o)>=0)return!1;for(var s=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,l=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,c=m(i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,t,n,r),u=m(s,l,t,n,r),d=e.prevZ,h=e.nextZ;d&&d.z>=c&&h&&h.z<=u;){if(d!==e.prev&&d!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&p(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,h!==e.prev&&h!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&p(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(;d&&d.z>=c;){if(d!==e.prev&&d!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&p(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;h&&h.z<=u;){if(h!==e.prev&&h!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&p(h.prev,h,h.next)>=0)return!1;h=h.nextZ}return!0}function s(e,t,n,r){var i=new S(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function l(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function c(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function u(e,t){if(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n.prev;var l,c=n,u=n.x,p=n.y,d=1/0;for(r=n.next;r!==c;)i>=r.x&&r.x>=u&&i!==r.x&&f(a<p?i:o,a,u,p,a<p?o:i,a,r.x,r.y)&&((l=Math.abs(a-r.y)/(i-r.x))<d||l===d&&r.x>n.x)&&v(r,e)&&(n=r,d=l),r=r.next;return n}(e,t)){var n=w(t,e);r(n,n.next)}}function p(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function d(e,t,n,r){return!!(g(e,t)&&g(n,r)||g(e,r)&&g(n,t))||p(e,t,n)>0!=p(e,t,r)>0&&p(n,r,e)>0!=p(n,r,t)>0}function h(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}function f(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function v(e,t){return p(e.prev,e,e.next)<0?p(e,t,e.next)>=0&&p(e,e.prev,t)>=0:p(e,t,e.prev)<0||p(e,e.next,t)<0}function m(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e,t){return e.x===t.x&&e.y===t.y}function y(e,t){return e.x-t.x}function _(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!g(i,a)&&d(i,r,r.next,a)&&v(i,a)&&v(a,i)&&(t.push(i.index/n),t.push(r.index/n),t.push(a.index/n),l(r),l(r.next),r=e=a),r=r.next}while(r!==e);return r}function b(e,t,n,a,o,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.index!==c.index&&x(l,c)){var u=w(l,c);return l=r(l,l.next),u=r(u,u.next),i(l,t,n,a,o,s),void i(u,t,n,a,o,s)}c=c.next}l=l.next}while(l!==e)}function x(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var n=e;do{if(n.index!==e.index&&n.next.index!==e.index&&n.index!==t.index&&n.next.index!==t.index&&d(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&v(e,t)&&v(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)}function w(e,t){var n=new S(e.index,e.x,e.y),r=new S(t.index,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}Object.defineProperty(t,"__esModule",{value:!0}),t.deviation=t.earcut=void 0,t.earcut=function(e,t,a){var o,s,l,p,d,h=t&&t.length,f=h?t[0]*a:e.length,v=n(e,0,f,a,!0),m=new Array;if(!v||v.next===v.prev)return m;if(h&&(v=function(e,t,i,a){for(var o=new Array,s=0,l=t.length;s<l;s++){var p=n(e,t[s]*a,s<l-1?t[s+1]*a:e.length,a,!1);p===p.next&&(p.steiner=!0),o.push(c(p))}o.sort(y);for(var d=0,h=o;d<h.length;d++)u(h[d],i),i=r(i,i.next);return i}(e,t,v,a)),e.length>80*a){o=l=e[0],s=p=e[1];for(var g=a;g<f;g+=a){var _=e[g],b=e[g+1];o=Math.min(o,_),s=Math.min(s,b),l=Math.max(l,_),p=Math.max(p,b)}d=0!==(d=Math.max(l-o,p-s))?1/d:0}return i(v,m,a,o,s,d),m},t.deviation=function(e,t,n,r){var i=t&&t.length,a=Math.abs(h(e,0,i?t[0]*n:e.length,n));if(i)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(h(e,t[o]*n,o<s-1?t[o+1]*n:e.length,n));var l=0;for(o=0;o<r.length;o+=3){var c=r[o]*n,u=r[o+1]*n,p=r[o+2]*n;l+=Math.abs((e[c]-e[p])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[p+1]-e[c+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)};var S=function(e,t,n){this.index=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}).apply(null,r))||(e.exports=i)},"1eTA":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("DtIM")],void 0===(i=(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.disableDisplayOnGrab=t.canMoveZ=void 0,t.canMoveZ=function(e,t){return void 0===t&&(t=r.getGraphicEffectiveElevationInfo(e)),"on-the-ground"!==t.mode&&!(n.isNone(e.geometry)||!e.geometry.hasZ)},t.disableDisplayOnGrab=function(e,t){var r=null,i=e.events.on("grab-changed",(function(i){n.isSome(r)&&(r.remove(),r=null),"start"===i.action?(r=e.disableDisplay(),t&&t(i)):t&&t(i)}));return{remove:function(){n.isSome(r)&&r.remove(),i.remove()}}}}).apply(null,r))||(e.exports=i)},"2Mej":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("0LE5"),n("Rdxj"),n("KPBO"),n("qUb7")],void 0===(i=(function(e,t,n,r,i,a,o){"use strict";function s(e){return(e+1)*(e+1)}function l(e){return n.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function c(e,t,n){var r=e[0],i=e[1],a=e[2],o=n||[];return o.length=s(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*a,o[3]=.4886025119*i),t>=2&&(o[4]=1.09254843059*r*i,o[5]=1.09254843059*i*a,o[6]=.31539156525*(3*a*a-1),o[7]=1.09254843059*r*a,o[8]=.54627421529*(r*r-i*i)),o}function u(e,t){var n=s(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=n;for(var i=0;i<n;i++)r.r[i]=r.g[i]=r.b[i]=0;return r}function p(e,t){for(var n=l(t.r.length),i=0,o=e;i<o.length;i++){var s=o[i];r.vec3.negate(y,s.direction),c(y,n,m),a.elementwiseProduct(m,_),a.scalarProduct(m,s.intensity[0],g),a.add(t.r,g),a.scalarProduct(m,s.intensity[1],g),a.add(t.g,g),a.scalarProduct(m,s.intensity[2],g),a.add(t.b,g)}return t}function d(e,t){c(y,0,m);for(var n=0,r=e;n<r.length;n++){var i=r[n];t.r[0]+=m[0]*_[0]*i.intensity[0]*4*Math.PI,t.g[0]+=m[0]*_[0]*i.intensity[1]*4*Math.PI,t.b[0]+=m[0]*_[0]*i.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.combineLights=t.projectAmbientLights=t.projectFillLights=t.initSHCoefficients=t.computeCoefficients=t.orderFromNumberOfCoefficients=t.numberOfCoefficientsInBand=t.numberOfCoefficients=void 0,t.numberOfCoefficients=s,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=l,t.computeCoefficients=c,t.initSHCoefficients=u,t.projectFillLights=p,t.projectAmbientLights=d,t.combineLights=function(e,t,n){u(t,n.sphericalHarmonics.sh),r.vec3.set(n.main.intensity,0,0,0);var i=!1,s=h,l=f,c=v;s.length=0,l.length=0,c.length=0;for(var m=0,g=e;m<g.length;m++)(b=g[m])instanceof o.MainLight&&!i?(r.vec3.copy(n.main.direction,b.direction),n.main.intensity[0]=b.intensity[0],n.main.intensity[1]=b.intensity[1],n.main.intensity[2]=b.intensity[2],n.main.castShadows=b.castShadows,i=!0):b instanceof o.MainLight||b instanceof o.FillLight?s.push(b):b instanceof o.AmbientLight?l.push(b):b instanceof o.SphericalHarmonicsLight&&c.push(b);p(s,n.sphericalHarmonics.sh),d(l,n.sphericalHarmonics.sh);for(var y=0,_=c;y<_.length;y++){var b=_[y];a.add(n.sphericalHarmonics.sh.r,b.sh.r),a.add(n.sphericalHarmonics.sh.g,b.sh.g),a.add(n.sphericalHarmonics.sh.b,b.sh.b)}};var h=[],f=[],v=[],m=[0],g=[0],y=i.vec3f64.create(),_=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}).apply(null,r))||(e.exports=i)},"2W+Z":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("8MXS"),n("ys4y"),n("ZO6V"),n("ZJC8"),n("yqrJ")],void 0===(i=(function(e,t,n,r,i,a,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisualElementResources=void 0;var l=function(){function e(e){this.resourceFactory=e,this._resources=null,this._hidden=!1,this._attached=!1}return e.prototype.destroy=function(){this._destroyResources()},Object.defineProperty(e.prototype,"object",{get:function(){return n.isSome(this._resources)?this._resources.object:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resources",{get:function(){return n.isSome(this._resources)?this._resources.external:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this._hidden},set:function(e){e!==this._hidden&&(this._hidden=e,this._syncHidden())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())},enumerable:!1,configurable:!0}),e.prototype.recreate=function(){this.attached&&this._createResources()},e.prototype.recreateGeometry=function(){if(this.resourceFactory.recreateGeometry){if(!n.isNone(this._resources)){var e=this._resources.object,t=this.resourceFactory.view._stage;this._resources.external.forEach((function(e){e instanceof i&&t.remove(2,e.id)})),e.removeAllGeometries();for(var r=0,a=this.resourceFactory.recreateGeometry(this._resources.external,e,this._resources.layer);r<a.length;r++)t.add(2,a[r])}}else this.recreate()},e.prototype._createOrDestroyResources=function(){this._attached?this._resources||this._createResources():this._destroyResources()},e.prototype._createResources=function(){var e=this;this._destroyResources();var t=this.resourceFactory.view._stage;if(t){var n=new a("element",{isPickable:!1});t.add(0,n),t.addToViewContent([n.id]);var i=new o({idHint:"element",castShadow:!1}),s=this.resourceFactory.createResources(i,n);s.forEach((function(n){t.add(e._contentTypeFromResource(n),n)})),t.add(1,i),n.addObject(i),this._hidden&&i.setVisible(!1);var l=this.resourceFactory.cameraChanged?r.init(this.resourceFactory.view.state,"camera",(function(t){return e.resourceFactory.cameraChanged(t)})):null;this._resources={layer:n,object:i,external:s,cameraHandle:l}}},e.prototype._contentTypeFromResource=function(e){return e instanceof i?2:e instanceof s?4:3},e.prototype._destroyResources=function(){var e=this;if(!n.isNone(this._resources)){var t=this.resourceFactory.view._stage;t.remove(1,this._resources.object.id),t.remove(0,this._resources.layer.id),this._resources.external.forEach((function(n){t.remove(e._contentTypeFromResource(n),n.id),"dispose"in n&&n.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}},e.prototype._syncHidden=function(){n.isNone(this._resources)||this._resources.object.setVisible(!this._hidden)},e}();t.VisualElementResources=l}).apply(null,r))||(e.exports=i)},"35hF":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorPolygonSymbolJSON=t.errorPolylineSymbolJSON=t.errorPointSymbolJSON=t.defaultTextSymbolJSON=t.defaultPolygonSymbolJSON=t.defaultPolylineSymbolJSON=t.defaultPointSymbolJSON=t.defaultOutlineColor=t.defaultColor=void 0,t.defaultColor=[252,146,31,255],t.defaultOutlineColor=[153,153,153,255],t.defaultPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",size:6,color:t.defaultColor,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},t.defaultPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",width:.75,color:t.defaultColor},t.defaultPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},t.defaultTextSymbolJSON={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},t.errorPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},t.errorPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},t.errorPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}}).apply(null,r))||(e.exports=i)},"3Zlx":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("1E+e"),n("ZPQp"),n("jmRc")],void 0===(i=(function(e,t,n,r,i){"use strict";function a(e,t,n){for(var i=e.length,a=new Array(i),s=new Array(i),l=new Array(i),c=0,u=0,p=0,d=0,h=0;h<i;++h)d+=e[h].length;for(var f=new Float64Array(3*d),v=0,m=i-1;m>=0;m--){var g=e[m],y=1===n&&!r.isClockwise(g,!1,!1);if(y&&1!==i)a[c++]=g;else{var _=g.length;for(h=0;h<c;++h)_+=a[h].length;var b={index:v,pathLengths:new Array(c+1),count:_,holeIndices:new Array(c)};b.pathLengths[0]=g.length,g.length>0&&(l[p++]={index:v,count:g.length}),v=y?o(g,g.length-1,-1,f,v,g.length,t):o(g,0,1,f,v,g.length,t);for(var x=0;x<c;++x){var w=a[x];b.holeIndices[x]=v,b.pathLengths[x+1]=w.length,w.length>0&&(l[p++]={index:v,count:w.length}),v=o(w,0,1,f,v,w.length,t)}c=0,b.count>0&&(s[u++]=b)}}for(x=0;x<c;++x)(w=a[x]).length>0&&(l[p++]={index:v,count:w.length}),v=o(w,0,1,f,v,w.length,t);return u<i&&(s.length=u),p<i&&(l.length=p),{position:f,polygons:s,outlines:l}}function o(e,t,n,r,i,a,o){i*=3;for(var s=0;s<a;++s){var l=e[t];r[i++]=l[0],r[i++]=l[1],r[i++]=o?l[2]:0,t+=n}return i/3}Object.defineProperty(t,"__esModule",{value:!0}),t.pathsToTriangulationInfo=t.triangulate=void 0,t.triangulate=function(e){for(var t=a(e.rings,e.hasZ,1),r=[],o=0,s=0,l=function(e){var i=e.index,a=new Float64Array(t.position.buffer,3*i*t.position.BYTES_PER_ELEMENT,3*e.count),l=e.holeIndices.map((function(e){return e-i})),c=new Uint32Array(n.earcut(a,l,3));r.push({position:a,faces:c}),o+=a.length,s+=c.length},c=0,u=t.polygons;c<u.length;c++)l(u[c]);var p=function(e,t,n){if(1===e.length)return e[0];for(var r=new Float64Array(t),i=new Uint32Array(n),a=0,o=0,s=0,l=0,c=e;l<c.length;l++){for(var u=c[l],p=0;p<u.position.length;p++)r[a++]=u.position[p];for(p=0;p<u.faces.length;p++)i[o++]=u.faces[p]+s;s=a/3}return{position:r,faces:i}}(r,o,s),d=i.default(p.position.buffer,6,{originalIndices:p.faces});return p.position=new Float64Array(d.buffer),p.faces=d.indices,p},t.pathsToTriangulationInfo=a}).apply(null,r))||(e.exports=i)},"3gjc":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function n(){return new Float32Array(4)}function r(e,t,n,r){var i=new Float32Array(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function i(){return n()}function a(){return r(1,1,1,1)}function o(){return r(1,0,0,0)}function s(){return r(0,1,0,0)}function l(){return r(0,0,1,0)}function c(){return r(0,0,0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.UNIT_W=t.UNIT_Z=t.UNIT_Y=t.UNIT_X=t.ONES=t.ZEROS=t.unitW=t.unitZ=t.unitY=t.unitX=t.ones=t.zeros=t.createView=t.fromValues=t.clone=t.create=void 0,t.create=n,t.clone=function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=r,t.createView=function(e,t){return new Float32Array(e,t,4)},t.zeros=i,t.ones=a,t.unitX=o,t.unitY=s,t.unitZ=l,t.unitW=c,t.ZEROS=i(),t.ONES=a(),t.UNIT_X=o(),t.UNIT_Y=s(),t.UNIT_Z=l(),t.UNIT_W=c()}).apply(null,r))||(e.exports=i)},"48/q":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("woUR")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Manipulation=void 0;var r=function(){function e(){this._available=!0}return Object.defineProperty(e.prototype,"location",{set:function(e){this.forEachManipulator3D((function(t){return t.location=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elevationAlignedLocation",{set:function(e){this.forEachManipulator3D((function(t){return t.elevationAlignedLocation=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{set:function(e){this.forEachManipulator3D((function(t){return t.elevationInfo=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"available",{get:function(){return this._available},set:function(e){this._available=e,this.forEachManipulator3D((function(t){return t.available=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grabbing",{get:function(){return this.someManipulator((function(e){return e.grabbing}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dragging",{get:function(){return this.someManipulator((function(e){return e.dragging}))},enumerable:!1,configurable:!0}),e.prototype.hasManipulator=function(e){return this.someManipulator((function(t){return t===e}))},e.prototype.someManipulator=function(e){var t=!1;return this.forEachManipulator((function(n){!t&&e(n)&&(t=!0)})),t},e.prototype.forEachManipulator3D=function(e){this.forEachManipulator((function(t,r){t instanceof n.Manipulator3D&&e(t,r)}))},e}();t.Manipulation=r}).apply(null,r))||(e.exports=i)},"4QR8":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("Vx27"),n("qysZ"),n("DtIM"),n("5T2R"),n("1eTA"),n("G+tB"),n("Fe95"),n("BhkK"),n("RWrl"),n("/NuL"),n("X7Ps")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicTransformTool=void 0;var y=function(e){function t(t){var n=e.call(this,t)||this;return n.enableZ=!0,n.enableRotation=!0,n.enableScaling=!0,n.type="transform-3d",n.handles=new i,n.scaleRotate=null,n}return n.__extends(t,e),t.prototype.initialize=function(){var e=this;this.graphicState=new m.GraphicState({graphic:this.graphic}),this.moveManipulation=new f.MoveManipulation({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&p.canMoveZ(this.graphic),radius:f.MoveManipulation.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((function(t){return e.handles.add(t.events.on("immediate-click",(function(e){return e.stopPropagation()})))})),this.moveManipulation.elevationInfo=c.getGraphicEffectiveElevationInfo(this.graphic),this.moveManipulation.createGraphicDragPipeline(this.graphicState,(function(t){var n={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(t.action){case"start":e.emit("graphic-translate-start",n);break;case"update":e.emit("graphic-translate",n);break;case"end":e.emit("graphic-translate-stop",n)}})),this.moveManipulation.angle=this.symbolRotationAngle,(this.enableScaling||this.enableRotation)&&(this.scaleRotate=new v.GraphicScaleRotateTransform({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate"}),this.handles.add(this.scaleRotate.events.on("scale-changed",(function(){return e.onScaleChanged()})))),this.handles.add([d.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return a.makeHandle()}}),this.graphic.watch("symbol",(function(){return e.updateMoveAngle()})),this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(function(){return e.updateMoveAngle()}))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()},t.prototype.forEachManipulator=function(e){this.moveManipulation.forEachManipulator(e),o.isSome(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)},t.prototype.hideManipulatorsForGraphicState=function(){var e=this;return this.graphicState.watch("displaying",(function(t){e.forEachManipulator((function(e){return e.available=t})),e.moveManipulation.zManipulation.available=t&&e.enableZ&&p.canMoveZ(e.graphic)}))},t.prototype.destroy=function(){this.handles.destroy(),this.moveManipulation.destroy(),o.isSome(this.scaleRotate)&&(this.scaleRotate.destroy(),this.scaleRotate=null),this._set("view",null),this._set("graphic",null)},Object.defineProperty(t.prototype,"snapToScene",{set:function(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"symbolRotationAngle",{get:function(){var e=this.graphic.symbol;if(e){var t=e.symbolLayers.find((function(e){return"object"===e.type}));return l.toRadian(-(t&&t.heading||0))}return 0},enumerable:!1,configurable:!0}),t.prototype.reset=function(){},t.prototype.onDetach=function(){o.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()},t.prototype.onHide=function(){o.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()},t.prototype.onScaleChanged=function(){if(!o.isNone(this.scaleRotate)){var e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}},t.prototype.updateMoveAngle=function(){this.moveManipulation.angle="local"===this.view.viewingMode||this.view.scale<h.ALIGN_ARROWS_SCALE_THRESHOLD?this.symbolRotationAngle:0},t.prototype.onGeometryChanged=function(){u.placeAtGraphic(this.view,this.moveManipulation,this.graphic)},Object.defineProperty(t.prototype,"test",{get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:o.isSome(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}},enumerable:!1,configurable:!0}),n.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"graphic",void 0),n.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"enableZ",void 0),n.__decorate([s.property()],t.prototype,"enableRotation",void 0),n.__decorate([s.property()],t.prototype,"enableScaling",void 0),n.__decorate([s.property({value:!1})],t.prototype,"snapToScene",null),n.__decorate([s.property({readOnly:!0})],t.prototype,"type",void 0),n.__decorate([s.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],t)}(r.EventedMixin(g.InteractiveToolBase));t.GraphicTransformTool=y}).apply(null,r))||(e.exports=i)},"4ziW":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("0LE5"),n("vlC2"),n("Rdxj"),n("aWgr"),n("83/a"),n("AgDx"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){"use strict";var c,u,p,d,h=o.Vec3Compact;!function(e){for(var t=.5,n=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],i=[0,0,1,0,1,1,0,1],a=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],o=new Array(36),c=0;c<6;c++)for(var u=0;u<6;u++)o[6*c+u]=c;var p=new Array(36);for(c=0;c<6;c++)p[6*c+0]=0,p[6*c+1]=1,p[6*c+2]=2,p[6*c+3]=2,p[6*c+4]=3,p[6*c+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(24),c=0;c<8;c++)t[3*c]=n[c][0]*e[0],t[3*c+1]=n[c][1]*e[1],t[3*c+2]=n[c][2]*e[2];var u={};u[l.VertexAttrConstants.POSITION]=new Uint32Array(a),u[l.VertexAttrConstants.NORMAL]=new Uint32Array(o),u[l.VertexAttrConstants.UV0]=new Uint32Array(p);var d={};return d[l.VertexAttrConstants.POSITION]={size:3,data:t},d[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(r)},d[l.VertexAttrConstants.UV0]={size:2,data:new Float32Array(i)},new s.GeometryData(d,u)}}(c||(c={})),function(e){var t=.5,n=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],i=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],a=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(18),o=0;o<6;o++)t[3*o]=n[o][0]*e[0],t[3*o+1]=n[o][1]*e[1],t[3*o+2]=n[o][2]*e[2];var c={};c[l.VertexAttrConstants.POSITION]=new Uint32Array(i),c[l.VertexAttrConstants.NORMAL]=new Uint32Array(a);var u={};return u[l.VertexAttrConstants.POSITION]={size:3,data:t},u[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(r)},new s.GeometryData(u,c)}}(u||(u={})),function(e){var t=.5,i=r.vec3f32.fromValues(-t,0,-t),a=r.vec3f32.fromValues(t,0,-t),o=r.vec3f32.fromValues(0,0,t),c=r.vec3f32.fromValues(0,.5,0),u=r.vec3f32.create(),p=r.vec3f32.create(),d=r.vec3f32.create(),h=r.vec3f32.create(),f=r.vec3f32.create();n.vec3.subtract(u,i,c),n.vec3.subtract(p,i,a),n.vec3.cross(d,u,p),n.vec3.normalize(d,d),n.vec3.subtract(u,a,c),n.vec3.subtract(p,a,o),n.vec3.cross(h,u,p),n.vec3.normalize(h,h),n.vec3.subtract(u,o,c),n.vec3.subtract(p,o,i),n.vec3.cross(f,u,p),n.vec3.normalize(f,f);var v=[i,a,o,c],m=[0,-1,0,d[0],d[1],d[2],h[0],h[1],h[2],f[0],f[1],f[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],y=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(12),n=0;n<4;n++)t[3*n]=v[n][0]*e[0],t[3*n+1]=v[n][1]*e[1],t[3*n+2]=v[n][2]*e[2];var r={};r[l.VertexAttrConstants.POSITION]=new Uint32Array(g),r[l.VertexAttrConstants.NORMAL]=new Uint32Array(y);var i={};return i[l.VertexAttrConstants.POSITION]={size:3,data:t},i[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(m)},new s.GeometryData(i,r)}}(p||(p={})),function(e){e.createBoxGeometry=c.createGeometry,e.createDiamondGeometry=u.createGeometry,e.createTetrahedronGeometry=p.createGeometry,e.createSphereGeometry=function(e,t,n,r,i,a,o){e=e||50,r=void 0!==r?r:-Math.PI,i=void 0!==i?i:2*Math.PI,a=void 0!==a?a:.5*-Math.PI,o=void 0!==o?o:Math.PI;for(var c=Math.max(3,Math.floor(t)||8),u=Math.max(2,Math.floor(n)||6),p=(c+1)*(u+1),d=new Float32Array(3*p),h=new Float32Array(3*p),f=new Float32Array(2*p),v=[],m=0,g=0;g<=u;g++){for(var y=[],_=g/u,b=a+_*o,x=Math.cos(b),w=0;w<=c;w++){var S=w/c,O=r+S*i,P=Math.cos(O)*x,M=Math.sin(b),C=-Math.sin(O)*x;d[3*m]=P*e,d[3*m+1]=M*e,d[3*m+2]=C*e,h[3*m]=P,h[3*m+1]=M,h[3*m+2]=C,f[2*m]=S,f[2*m+1]=_,y.push(m),++m}v.push(y)}var D=new Uint32Array(2*c*(u-1)*3);for(m=0,g=0;g<u;g++)for(w=0;w<c;w++){var R=v[g][w],A=v[g][w+1],E=v[g+1][w+1],T=v[g+1][w];0===g?(D[m++]=R,D[m++]=E,D[m++]=T):g===u-1?(D[m++]=R,D[m++]=A,D[m++]=E):(D[m++]=R,D[m++]=A,D[m++]=E,D[m++]=E,D[m++]=T,D[m++]=R)}l.assert(m===D.length);var j={};j[l.VertexAttrConstants.POSITION]=D,j[l.VertexAttrConstants.NORMAL]=D,j[l.VertexAttrConstants.UV0]=D;var I={};return I[l.VertexAttrConstants.POSITION]={size:3,data:d},I[l.VertexAttrConstants.NORMAL]={size:3,data:h},I[l.VertexAttrConstants.UV0]={size:2,data:f},new s.GeometryData(I,j)},e.createPolySphereGeometry=function(e,t,n){var r,i,a=e;if(n)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],i=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var o=a*(1+Math.sqrt(5))/2;r=[-a,o,0,a,o,0,-a,-o,0,a,-o,0,0,-a,o,0,a,o,0,-a,-o,0,a,-o,o,0,-a,o,0,a,-o,0,-a,-o,0,a],i=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var c=0;c<r.length;c+=3)h.scale(r,c,e/h.length(r,c));var u={};function p(t,n){var i;t>n&&(t=(i=[n,t])[0],n=i[1]);var a=t.toString()+"."+n.toString();if(u[a])return u[a];var o=r.length;return r.length+=3,h.add(r,3*t,r,3*n,r,o),h.scale(r,o,e/h.length(r,o)),u[a]=o/=3,o}for(c=0;c<t;c++){for(var d=i.length,f=new Uint32Array(4*d),v=0;v<d;v+=3){var m=i[v],g=i[v+1],y=i[v+2],_=p(m,g),b=p(g,y),x=p(y,m),w=4*v;f[w]=m,f[w+1]=_,f[w+2]=x,f[w+3]=g,f[w+4]=b,f[w+5]=_,f[w+6]=y,f[w+7]=x,f[w+8]=b,f[w+9]=_,f[w+10]=b,f[w+11]=x}i=f,u={}}var S=new Float32Array(r);for(c=0;c<S.length;c+=3)h.normalize(S,c);var O={};O[l.VertexAttrConstants.POSITION]=i,O[l.VertexAttrConstants.NORMAL]=i;var P={};return P[l.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(r)},P[l.VertexAttrConstants.NORMAL]={size:3,data:S},new s.GeometryData(P,O)},e.createPointGeometry=function(e,t,n,r,i,a,o,c){var u=t?new Float64Array([t[0],t[1],t[2]]):new Float32Array([0,0,0]),p=e?new Float32Array([e[0],e[1],e[2]]):new Float32Array([0,0,1]),d=a?new Float32Array(a):new Float32Array([0,0]),h=n?new Uint8Array([255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]):new Uint8Array([255,255,255,255]),f=null!=r&&2===r.length?new Float32Array(r):new Float32Array([1,1]),v={};if(v[l.VertexAttrConstants.POSITION]={size:3,data:u},v[l.VertexAttrConstants.NORMAL]={size:3,data:p},v[l.VertexAttrConstants.UV0]={size:d.length,data:d},v[l.VertexAttrConstants.COLOR]={size:4,data:h},v[l.VertexAttrConstants.SIZE]={size:2,data:f},null!=i){var m=new Float32Array([i[0],i[1],i[2],i[3]]);v[l.VertexAttrConstants.AUXPOS1]={size:4,data:m}}if(null!=o){var g=new Float32Array([o[0],o[1],o[2],o[3]]);v[l.VertexAttrConstants.AUXPOS2]={size:4,data:g}}return null!=c?(c.initialize(v,s.GeometryData.DefaultIndices,"point"),c):new s.GeometryData(v,s.GeometryData.DefaultIndices,"point")},e.updatePointGeometry=function(e,t,n,r,i,a,o,s){var c,u=s.vertexAttributes;return null!=e&&((c=u[l.VertexAttrConstants.NORMAL].data)[0]=e[0],c[1]=e[1],c[2]=e[2]),null!=t&&((c=u[l.VertexAttrConstants.POSITION].data)[0]=t[0],c[1]=t[1],c[2]=t[2]),null!=n&&((c=u[l.VertexAttrConstants.COLOR].data)[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3]),null!=r&&((c=u[l.VertexAttrConstants.SIZE].data)[0]=r[0],c[1]=r[1]),null!=i&&((c=u[l.VertexAttrConstants.AUXPOS1].data)[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3]),null!=a&&((c=u[l.VertexAttrConstants.UV0].data)[0]=a[0],c[1]=a[1]),null!=o&&((c=u[l.VertexAttrConstants.AUXPOS2].data)[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=o[3]),s},e.createPointArrayGeometry=function(e,t){for(var n=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),i=new Uint32Array(e.length),a=new Uint32Array(e.length),o=0;o<e.length;o++)n[3*o]=e[o][0],n[3*o+1]=e[o][1],n[3*o+2]=e[o][2],t&&(r[3*o]=t[o][0],r[3*o+1]=t[o][1],r[3*o+2]=t[o][2]),i[o]=o,a[o]=0;t||(r[0]=0,r[1]=1,r[2]=0);var c=new Float32Array(2);c[0]=0,c[1]=0;var u={};u[l.VertexAttrConstants.POSITION]=i,u[l.VertexAttrConstants.NORMAL]=t?i:a,u[l.VertexAttrConstants.UV0]=a;var p={};return p[l.VertexAttrConstants.POSITION]={size:3,data:n},p[l.VertexAttrConstants.NORMAL]={size:3,data:r},p[l.VertexAttrConstants.UV0]={size:2,data:c},new s.GeometryData(p,u,"point")},e.createTriangleGeometry=function(){var e=new Float32Array([0,0,0,0,0,100,100,0,0]),t=new Uint32Array([0,1,2]),n=new Float32Array([0,1,0]),r=new Uint32Array([0,0,0]),i=new Float32Array([0,0]),a=new Uint32Array([0,0,0]),o={};o[l.VertexAttrConstants.POSITION]=t,o[l.VertexAttrConstants.NORMAL]=r,o[l.VertexAttrConstants.UV0]=a;var c={};return c[l.VertexAttrConstants.POSITION]={size:3,data:e},c[l.VertexAttrConstants.NORMAL]={size:3,data:n},c[l.VertexAttrConstants.UV0]={size:2,data:i},new s.GeometryData(c,o)};var t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function o(e,t,r,i,a){return!(Math.abs(n.vec3.dot(t,e))>a||(n.vec3.cross(r,e,t),n.vec3.normalize(r,r),n.vec3.cross(i,r,e),n.vec3.normalize(i,i),0))}function d(e,t,n,r,i,a,s){return o(e,t,i,a,s)||o(e,n,i,a,s)||o(e,r,i,a,s)}e.createSquareGeometry=function(e){var n,r;void 0===e&&(e=t);for(var i=new Float64Array(12),a=0;a<4;a++)for(var o=0;o<3;o++)i[3*a+o]=e[a][o];var c=new Uint32Array([0,1,2,2,3,0]),u=new Float32Array([0,0,1]),p=new Uint32Array([0,0,0,0,0,0]),d=new Float32Array([0,0,1,0,1,1,0,1]),h=new Uint8Array([255,255,255,255]),f=((n={})[l.VertexAttrConstants.POSITION]=c,n[l.VertexAttrConstants.NORMAL]=p,n[l.VertexAttrConstants.UV0]=c,n[l.VertexAttrConstants.COLOR]=p,n),v=((r={})[l.VertexAttrConstants.POSITION]={size:3,data:i},r[l.VertexAttrConstants.NORMAL]={size:3,data:u},r[l.VertexAttrConstants.UV0]={size:2,data:d},r[l.VertexAttrConstants.COLOR]={size:4,data:h},r);return new s.GeometryData(v,f)},e.createConeGeometry=function(e,t,n,i,a,o){void 0===a&&(a=!0),void 0===o&&(o=!0);var c=0,u=t,p=e,d=r.vec3f32.fromValues(0,c,0),h=r.vec3f32.fromValues(0,c+p,0),f=r.vec3f32.fromValues(0,-1,0),v=r.vec3f32.fromValues(0,1,0);i&&(c=p,h=r.vec3f32.fromValues(0,0,0),d=r.vec3f32.fromValues(0,c,0),f=r.vec3f32.fromValues(0,1,0),v=r.vec3f32.fromValues(0,-1,0));var m=[h,d],g=[f,v],y=n+2,_=Math.sqrt(p*p+u*u);if(i)for(b=n-1;b>=0;b--)x=b*(2*Math.PI/n),w=r.vec3f32.fromValues(Math.cos(x)*u,c,Math.sin(x)*u),m.push(w),S=r.vec3f32.fromValues(p*Math.cos(x)/_,-u/_,p*Math.sin(x)/_),g.push(S);else for(var b=0;b<n;b++){var x=b*(2*Math.PI/n),w=r.vec3f32.fromValues(Math.cos(x)*u,c,Math.sin(x)*u);m.push(w);var S=r.vec3f32.fromValues(p*Math.cos(x)/_,u/_,p*Math.sin(x)/_);g.push(S)}var O=new Uint32Array(2*(n+2)*3),P=new Uint32Array(2*(n+2)*3),M=0,C=0;if(a){for(b=3;b<m.length;b++)O[M++]=1,O[M++]=b-1,O[M++]=b,P[C++]=0,P[C++]=0,P[C++]=0;O[M++]=m.length-1,O[M++]=2,O[M++]=1,P[C++]=0,P[C++]=0,P[C++]=0}if(o){for(b=3;b<m.length;b++)O[M++]=b,O[M++]=b-1,O[M++]=0,P[C++]=b,P[C++]=b-1,P[C++]=1;O[M++]=0,O[M++]=2,O[M++]=m.length-1,P[C++]=1,P[C++]=2,P[C++]=g.length-1}var D=new Float32Array(3*y);for(b=0;b<y;b++)D[3*b]=m[b][0],D[3*b+1]=m[b][1],D[3*b+2]=m[b][2];var R=new Float32Array(3*y);for(b=0;b<y;b++)R[3*b]=g[b][0],R[3*b+1]=g[b][1],R[3*b+2]=g[b][2];var A={};A[l.VertexAttrConstants.POSITION]=O,A[l.VertexAttrConstants.NORMAL]=P;var E={};return E[l.VertexAttrConstants.POSITION]={size:3,data:D},E[l.VertexAttrConstants.NORMAL]={size:3,data:R},new s.GeometryData(E,A)},e.createCylinderGeometry=function(e,t,i,a,o,c){var u=a?r.vec3f32.clone(a):r.vec3f32.fromValues(1,0,0),p=o?r.vec3f32.clone(o):r.vec3f32.fromValues(0,0,0),d=void 0===c||c,h=r.vec3f32.create();n.vec3.normalize(h,u);var f=r.vec3f32.create();n.vec3.scale(f,h,Math.abs(e));var v=r.vec3f32.create();n.vec3.scale(v,f,-.5),n.vec3.add(v,v,p);var m=r.vec3f32.fromValues(0,1,0);Math.abs(1-n.vec3.dot(h,m))<.2&&n.vec3.set(m,0,0,1);var g=r.vec3f32.create();n.vec3.cross(g,h,m),n.vec3.normalize(g,g),n.vec3.cross(m,g,h);var y=2*i+(d?2:0),_=i+(d?2:0),b=new Float32Array(3*y),x=new Float32Array(3*_),w=new Float32Array(2*y),S=new Uint32Array(3*i*(d?4:2)),O=new Uint32Array(3*i*(d?4:2));d&&(b[3*(y-2)+0]=v[0],b[3*(y-2)+1]=v[1],b[3*(y-2)+2]=v[2],w[2*(y-2)]=0,w[2*(y-2)+1]=0,b[3*(y-1)+0]=b[3*(y-2)+0]+f[0],b[3*(y-1)+1]=b[3*(y-2)+1]+f[1],b[3*(y-1)+2]=b[3*(y-2)+2]+f[2],w[2*(y-1)]=1,w[2*(y-1)+1]=1,x[3*(_-2)+0]=-h[0],x[3*(_-2)+1]=-h[1],x[3*(_-2)+2]=-h[2],x[3*(_-1)+0]=h[0],x[3*(_-1)+1]=h[1],x[3*(_-1)+2]=h[2]);for(var P=function(e,t,n){S[e]=t,O[e]=n},M=0,C=r.vec3f32.create(),D=r.vec3f32.create(),R=0;R<i;R++){var A=R*(2*Math.PI/i);n.vec3.scale(C,m,Math.sin(A)),n.vec3.scale(D,g,Math.cos(A)),n.vec3.add(C,C,D),x[3*R+0]=C[0],x[3*R+1]=C[1],x[3*R+2]=C[2],n.vec3.scale(C,C,t),n.vec3.add(C,C,v),b[3*R+0]=C[0],b[3*R+1]=C[1],b[3*R+2]=C[2],w[2*R+0]=R/i,w[2*R+1]=0,b[3*(R+i)+0]=b[3*R+0]+f[0],b[3*(R+i)+1]=b[3*R+1]+f[1],b[3*(R+i)+2]=b[3*R+2]+f[2],w[2*(R+i)+0]=R/i,w[2*R+1]=1;var E=(R+1)%i;P(M++,R,R),P(M++,R+i,R),P(M++,E,E),P(M++,E,E),P(M++,R+i,R),P(M++,E+i,E)}if(d){for(R=0;R<i;R++)E=(R+1)%i,P(M++,y-2,_-2),P(M++,R,_-2),P(M++,E,_-2);for(R=0;R<i;R++)E=(R+1)%i,P(M++,R+i,_-1),P(M++,y-1,_-1),P(M++,E+i,_-1)}var T={};T[l.VertexAttrConstants.POSITION]=S,T[l.VertexAttrConstants.NORMAL]=O,T[l.VertexAttrConstants.UV0]=S;var j={};return j[l.VertexAttrConstants.POSITION]={size:3,data:b},j[l.VertexAttrConstants.NORMAL]={size:3,data:x},j[l.VertexAttrConstants.UV0]={size:2,data:w},new s.GeometryData(j,T)},e.createTubeGeometry=function(t,n,r,i,a){r=r||10,i=null==i||i,l.assert(t.length>1);for(var o=[],s=[],c=0;c<r;c++){o.push([0,-c-1,-(c+1)%r-1]);var u=c/r*2*Math.PI;s.push([Math.cos(u)*n,Math.sin(u)*n])}return e.createPathExtrusionGeometry(s,t,[[0,0,0]],o,i,a)},e.createPathExtrusionGeometry=function(e,t,o,c,u,p){void 0===p&&(p=r.vec3f32.fromValues(0,0,0));var h=e.length,v=new Float32Array(t.length*h*3+(6*o.length||0)),m=new Float32Array(t.length*h+(2*o.length||0)),g=new Float32Array(t.length*h*3+(o?6:0)),y=(t.length-1)*h*6+3*c.length*2,_=new Uint32Array(y),b=new Uint32Array(y),x=0,w=0,S=0,O=0,P=0,M=r.vec3f32.create(),C=r.vec3f32.create(),D=r.vec3f32.create(),R=r.vec3f32.create(),A=r.vec3f32.create(),E=r.vec3f32.create(),T=r.vec3f32.create(),j=i.vec3f64.create(),I=r.vec3f32.create(),V=r.vec3f32.create(),L=r.vec3f32.create(),z=r.vec3f32.create(),N=r.vec3f32.create(),U=a.plane.create();n.vec3.set(I,0,1,0),n.vec3.subtract(C,t[1],t[0]),n.vec3.normalize(C,C),u?(n.vec3.add(j,t[0],p),n.vec3.normalize(D,j)):n.vec3.set(D,0,0,1),d(C,D,I,I,A,D,f),n.vec3.copy(R,D),n.vec3.copy(z,A);for(var G=0;G<o.length;G++)n.vec3.scale(E,A,o[G][0]),n.vec3.scale(j,D,o[G][2]),n.vec3.add(E,E,j),n.vec3.add(E,E,t[0]),v[x++]=E[0],v[x++]=E[1],v[x++]=E[2],m[S++]=0;for(g[w++]=-C[0],g[w++]=-C[1],g[w++]=-C[2],G=0;G<c.length;G++)_[O++]=c[G][0]>0?c[G][0]:-c[G][0]-1+o.length,_[O++]=c[G][1]>0?c[G][1]:-c[G][1]-1+o.length,_[O++]=c[G][2]>0?c[G][2]:-c[G][2]-1+o.length,b[P++]=0,b[P++]=0,b[P++]=0;for(var F=o.length,H=o.length-1,k=0;k<t.length;k++){var q=!1;k>0&&(n.vec3.copy(M,C),k<t.length-1?(n.vec3.subtract(C,t[k+1],t[k]),n.vec3.normalize(C,C)):q=!0,n.vec3.add(V,M,C),n.vec3.normalize(V,V),n.vec3.add(L,t[k-1],R),a.plane.fromPositionAndNormal(t[k],V,U),a.plane.intersectRay(U,a.ray.wrap(L,M),j)?(n.vec3.subtract(j,j,t[k]),n.vec3.normalize(D,j),n.vec3.cross(A,V,D),n.vec3.normalize(A,A)):d(V,R,z,I,A,D,f),n.vec3.copy(R,D),n.vec3.copy(z,A)),u&&(n.vec3.add(j,t[k],p),n.vec3.normalize(N,j));for(var W=0;W<h;W++)if(n.vec3.scale(E,A,e[W][0]),n.vec3.scale(j,D,e[W][1]),n.vec3.add(E,E,j),n.vec3.normalize(T,E),g[w++]=T[0],g[w++]=T[1],g[w++]=T[2],m[S++]=u?n.vec3.dot(E,N):E[2],n.vec3.add(E,E,t[k]),v[x++]=E[0],v[x++]=E[1],v[x++]=E[2],!q){var B=(W+1)%h;_[O++]=F+W,_[O++]=F+h+W,_[O++]=F+B,_[O++]=F+B,_[O++]=F+h+W,_[O++]=F+h+B;for(var Z=0;Z<6;Z++)b[P++]=_[O-6+Z]-H}F+=h}var X=t[t.length-1];for(G=0;G<o.length;G++)n.vec3.scale(E,A,o[G][0]),n.vec3.scale(j,D,o[G][1]),n.vec3.add(E,E,j),n.vec3.add(E,E,X),v[x++]=E[0],v[x++]=E[1],v[x++]=E[2],m[S++]=0;var Y=w/3;g[w++]=C[0],g[w++]=C[1],g[w++]=C[2];var J=F-h;for(G=0;G<c.length;G++)_[O++]=c[G][0]>=0?F+c[G][0]:-c[G][0]-1+J,_[O++]=c[G][2]>=0?F+c[G][2]:-c[G][2]-1+J,_[O++]=c[G][1]>=0?F+c[G][1]:-c[G][1]-1+J,b[P++]=Y,b[P++]=Y,b[P++]=Y;var Q={};Q[l.VertexAttrConstants.POSITION]=_,Q[l.VertexAttrConstants.NORMAL]=b;var K={};return K[l.VertexAttrConstants.POSITION]={size:3,data:v},K.zOffset={size:1,data:m},K[l.VertexAttrConstants.NORMAL]={size:3,data:g},new s.GeometryData(K,Q)},e.createPolylineGeometry=function(e,t){l.assert(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),l.assert(3===e[0].length,"createPolylineGeometry(): malformed vertex"),l.assert(void 0===t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),l.assert(void 0===t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var n=new Float64Array(3*e.length),r=new Uint32Array(2*(e.length-1)),i=0,a=0,o=0;o<e.length;o++){for(var c=0;c<3;c++)n[i++]=e[o][c];o>0&&(r[a++]=o-1,r[a++]=o)}var u={},p={};if(u[l.VertexAttrConstants.POSITION]=r,p[l.VertexAttrConstants.POSITION]={size:3,data:n},t){var d=new Float32Array(3*t.length),h=0;for(o=0;o<e.length;o++)for(c=0;c<3;c++)d[h++]=t[o][c];u[l.VertexAttrConstants.NORMAL]=r,p[l.VertexAttrConstants.NORMAL]={size:3,data:d}}return new s.GeometryData(p,u,"line")},e.createExtrudedTriangle=function(e,t,n,r){for(var i,a,o=new Float32Array(18),c=[[-t,0,r/2],[n,0,r/2],[0,e,r/2],[-t,0,-r/2],[n,0,-r/2],[0,e,-r/2]],u=0;u<6;u++)o[3*u]=c[u][0],o[3*u+1]=c[u][1],o[3*u+2]=c[u][2];var p=((i={})[l.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),i),d=((a={})[l.VertexAttrConstants.POSITION]={size:3,data:o},a);return new s.GeometryData(d,p)},e.transformInPlace=function(e,t){for(var r=e.vertexAttributes[l.VertexAttrConstants.POSITION].data,i=0;i<r.length;i+=3)n.vec3.set(v,r[i],r[i+1],r[i+2]),n.vec3.transformMat4(v,v,t),r[i]=v[0],r[i+1]=v[1],r[i+2]=v[2]},e.cgToGIS=function(e,t){void 0===t&&(t=e);var n=e.getVertexAttr(),r=n.position.data,i=n.normal.data,a=t.getVertexAttr(),o=a.position.data,s=a.normal.data;if(i)for(var l=0;l<i.length;l+=3){var c=i[l+1];s[l+1]=-i[l+2],s[l+2]=c}if(r)for(l=0;l<r.length;l+=3)c=r[l+1],o[l+1]=-r[l+2],o[l+2]=c;return t},e.makeOrthoBasisDirUp=o,e.makeOrthoBasisDirUpFallback=d}(d||(d={}));var f=.99619469809,v=r.vec3f32.create();return d}).apply(null,r))||(e.exports=i)},"58az":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSpace=void 0,t.CameraSpace=function(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "],["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},"5T2R":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("FXVB"),n("0LE5"),n("O7NG"),n("xdO3"),n("woUR"),n("BwdQ"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5"),n("uZGf")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h){"use strict";function f(e,t){void 0===t&&(t=4);var n=a.vec4f64.fromValues(e[0],e[1],e[2],e.length>3?e[3]:1),r=new h.ShadedColorMaterial({color:n,transparent:e[3]<1,writeDepth:!0,cullFace:2},"manipulator");return r.renderOccluded=t,r}function v(e,t,n,r){var a=i.vec3.normalize(c.sv3d.get(),e),o=i.vec3.normalize(c.sv3d.get(),t),s=i.vec3.cross(c.sv3d.get(),a,o);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=0,r[4]=o[0],r[5]=o[1],r[6]=o[2],r[7]=0,r[8]=s[0],r[9]=s[1],r[10]=s[2],r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function m(e,t){var r=e.getViewForGraphic(t);return n.isSome(r)&&"computeAttachmentOrigin"in r?r.computeAttachmentOrigin(t,e.spatialReference):null}Object.defineProperty(t,"__esModule",{value:!0}),t.placeAtGraphic=t.getGraphicAttachmentOrigin=t.calculateTranslateRotateFromBases=t.calculateInputRotationTransform=t.createSphereManipulator=t.createManipulatorOutlineMaterial=t.createManipulatorMaterial=void 0,t.createManipulatorMaterial=f,t.createManipulatorOutlineMaterial=function(e,t){void 0===t&&(t=4);var n=a.vec4f64.fromValues(e[0],e[1],e[2],4===e.length?e[3]:1),r=new d({color:n,transparent:!0,writeDepth:!0,cullFace:1},"manipulator-outline");return r.renderOccluded=t,r},t.createSphereManipulator=function(e,t,n){return new s.Manipulator3D({view:e,renderObjects:[{geometry:new u(p.createSphereGeometry(1,32,32),"manipulator"),material:f(a.vec4f64.fromValues(t[0],t[1],t[2],null!=n?n:1))}]})},t.calculateInputRotationTransform=function(e,t,n,a){var o=i.vec3.subtract(c.sv3d.get(),e,n),s=v(o,i.vec3.cross(c.sv3d.get(),a,o),n,c.sm4d.get());r.mat4.invert(s,s);var l=i.vec3.transformMat4(c.sv3d.get(),t,s);return Math.atan2(l[1],l[0])},t.calculateTranslateRotateFromBases=v,t.getGraphicAttachmentOrigin=m,t.placeAtGraphic=function(e,t,r){var i=m(e,r);n.isSome(i)?t.elevationAlignedLocation=i:function(e,t){if(!n.isNone(t)){var r=l.computeCentroid(t);n.isNone(r)||(e.location=o.hydrateGeometry(r))}}(t,r.geometry)}}).apply(null,r))||(e.exports=i)},"62Ht":function(e,t){},"6hC7":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("QDcU"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("DtIM"),n("woUR"),n("B3XD"),n("X5J5"),n("Fe95"),n("48/q"),n("dtql"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoveXYAxisManipulation=void 0;var O=function(e){function t(t){var n=e.call(this)||this;return n._handles=new a,n._arrowManipulatorInfos=new Array,n._opaqueMaterial=n.createMaterial(),n._transparentMaterial=n.createMaterial(.5),n._angle=0,n._scale=1,n._radius=m.DISC_RADIUS,n._updateAfterDrag=!1,n.events=new i,n._tool=t.tool,n._view=t.view,null!=t.radius&&(n._radius=t.radius),n._createManipulators(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return n.__extends(t,e),Object.defineProperty(t.prototype,"orthogonalAvailable",{set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0},t.prototype.forEachManipulator=function(e){this._arrowManipulatorInfos.map((function(t){return e(t.manipulator,1)}))},t.prototype.createGraphicDragPipeline=function(e,t){var n=this,r=e.graphic,i=d.getGraphicEffectiveElevationInfo(r),a=s.unwrap(r.geometry).spatialReference;return y.createGraphicMoveDragPipeline(e,t,(function(e){return n.createDragPipeline(e,i,a)}))},t.prototype.createDragPipeline=function(e,t,n){var r=this;return o.handlesGroup(this._arrowManipulatorInfos.map((function(i,a){return S.createManipulatorDragEventPipeline(i.manipulator,(function(i,o,s,l){var c=o.next(f.screenToMapXYAtLocation(r._view,i.elevationAlignedLocation,t,n)).next(S.constrainToMapAxis(i.location,r.angle+(a+1)*Math.PI*.5)).next(S.addScreenDelta());e(i,c,s,l)}))})))},Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayScale",{get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())},enumerable:!1,configurable:!0}),t.prototype._updateManipulators=function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()},t.prototype._updateArrowManipulator=function(e,t){var n=e.manipulator,r=e.transform,i=this._radius/m.DISC_RADIUS,a=m.DISC_TRANSLATE_ARROW_SIZE*i,o=Math.sqrt(a*a*3/4),s=x.createExtrudedTriangle(o,a/2,a/2,m.DISC_HEIGHT);x.transformInPlace(s,l.mat4.fromTranslation(_.sm4d.get(),u.vec3.set(_.sv3d.get(),0,-o/3,0)));var c=new b(s,"move-xy-axis-arrow");n.renderObjects=[{geometry:c,material:this._opaqueMaterial,stateMask:2},{geometry:c,material:this._transparentMaterial,stateMask:1}],n.radius=o/3*2*1.2;var p=l.mat4.identity(_.sm4d.get());l.mat4.fromZRotation(p,t*Math.PI/2);var d=l.mat4.identity(_.sm4d.get());l.mat4.fromTranslation(d,u.vec3.set(_.sv3d.get(),0,m.DISC_TRANSLATE_ARROW_OFFSET*i,0)),l.mat4.multiply(r,p,d)},t.prototype._createManipulators=function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()},t.prototype._updateManipulatorTransform=function(){var e=this.angle,t=l.mat4.identity(_.sm4d.get());l.mat4.rotate(t,t,e,p.vec3f64.fromValues(0,0,1));var n=l.mat4.fromScaling(_.sm4d.get(),u.vec3.set(_.sv3d.get(),this.displayScale,this.displayScale,this.displayScale)),r=l.mat4.identity(_.sm4d.get());l.mat4.multiply(r,n,t);for(var i=0,a=this._arrowManipulatorInfos;i<a.length;i++){var o=a[i],s=l.mat4.multiply(_.sm4d.get(),r,o.transform);o.manipulator.modelTransform=s}},t.prototype._createArrowManipulator=function(e){var t=this,n=new h.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:p.vec3f64.fromValues(0,0,1)}}),r={manipulator:n,transform:c.mat4f64.create()};return this._updateArrowManipulator(r,e),this._handles.add(n.events.on("drag",(function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)}))),r},t.prototype.createMaterial=function(e){void 0===e&&(e=1);var t=r.toUnitRGBA(v.colors.main);t[3]*=e;var n=new w({color:t,transparent:1!==e,cullFace:2},"graphic-transform");return n.renderOccluded=2,n},Object.defineProperty(t.prototype,"test",{get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map((function(e){return e.manipulator}))}},enumerable:!1,configurable:!0}),t}(g.Manipulation);t.MoveXYAxisManipulation=O}).apply(null,r))||(e.exports=i)},"6vp1":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("DKwL"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.ReadLinearDepth=void 0,t.ReadLinearDepth=function(e){e.fragment.include(r.RgbaFloatEncoding),e.fragment.code.add(i.glsl(a||(a=n.__makeTemplateObject(["\n    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "],["\n    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},"73uV":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("eIBl"),n("LxLY"),n("B3XD"),n("48/q"),n("dtql"),n("bz+r"),n("N78w")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoveXYGraphicManipulation=void 0;var u=function(e){function t(t){var n=e.call(this)||this;return n._handles=new r,n._view=t.view,n._tool=t.tool,n._graphicState=t.graphicState,n._createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return n.__extends(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null},t.prototype.forEachManipulator=function(e){e(this._manipulator,1)},t.prototype.createGraphicDragPipeline=function(e){var t=this;return s.createGraphicMoveDragPipeline(this._graphicState,e,(function(e){return t.createDragPipeline(e)}))},t.prototype.createDragPipeline=function(e){var t=this._view,n=this._graphicState.graphic,r=i.isSome(n.geometry)?n.geometry.spatialReference:null;return l.createManipulatorDragEventPipeline(this._manipulator,(function(i,o,s,c){var u=o.next(a.screenToMapXYForGraphic(c,t,n,r)).next(l.addMapDelta()).next(l.addScreenDelta());e(i,u,s,c)}))},t.prototype._createManipulator=function(){this._manipulator=new c.GraphicManipulator({graphic:this._graphicState.graphic,view:this._view,selectable:!0,cursor:"move"})},t}(o.Manipulation);t.MoveXYGraphicManipulation=u}).apply(null,r))||(e.exports=i)},"7zqm":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.LineStipple=void 0,t.LineStipple=function(e,t){e.defines.addFloat("STIPPLE_ALPHA_COLOR_DISCARD",.001),e.defines.addFloat("STIPPLE_ALPHA_HIGHLIGHT_DISCARD",.5),t.stippleEnabled?function(e,t){e.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleUVMaxEnabled&&e.varyings.add("stipplePatternUvMax","float"),e.varyings.add("stipplePatternUv","float"),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"],["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"])),t.stippleUVMaxEnabled?"stipplePatternUvClamped = clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":"")),e.fragment.code.add(r.glsl(t.stippleOffColorEnabled?a||(a=n.__makeTemplateObject(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "])):o||(o=n.__makeTemplateObject(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "]))))}(e,t):function(e){e.fragment.code.add(r.glsl(s||(s=n.__makeTemplateObject(["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "],["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "]))))}(e)}}).apply(null,r))||(e.exports=i)},A5GR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("y4WC"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("Vx27"),n("ZcgO"),n("DtIM"),n("5T2R"),n("1eTA"),n("G+tB"),n("Fe95"),n("BhkK"),n("dtql"),n("73uV"),n("qflc"),n("R4nD"),n("/NuL"),n("bz+r"),n("X7Ps")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicMoveTool=t.GraphicMoveStopEvent=t.GraphicMoveEvent=t.GraphicMoveStartEvent=void 0;var S=function(e){this.allGraphics=e,this.type="graphic-move-start"};t.GraphicMoveStartEvent=S;var O=function(e,t,n){this.dx=e,this.dy=t,this.allGraphics=n,this.type="graphic-move"};t.GraphicMoveEvent=O;var P=function(e){this.allGraphics=e,this.type="graphic-move-stop"};t.GraphicMoveStopEvent=P;var M=function(e){function t(t){var n=e.call(this,t)||this;return n.graphics=new r,n.enableZ=!0,n.type="move-3d",n._toolHandles=new a,n._handles=new a,n}return n.__extends(t,e),t.prototype.initialize=function(){var e=this;this._toolHandles.add([this.graphics.on("change",(function(){return e._refreshManipulators()}))]),this._refreshManipulators()},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)},t.prototype.reset=function(){},t.prototype._refreshManipulators=function(){var e=this;this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var t=this.graphics.toArray().filter((function(e){return 0===y.isSupportedGraphic(e)})).map((function(e){return new C(e)}));t.length&&(this.createManipulators(t),this.createVisualElements(t),this._handles.add(t.map((function(t){return e.view.trackGraphicState(t.state)}))),this.updateMoveManipulation(t))},t.prototype.createManipulators=function(e){for(var t=this,r=function(r){var a=r.state;r.manipulationXY=new g.MoveXYGraphicManipulation({tool:i,view:i.view,graphicState:a}),r.manipulationXY.forEachManipulator((function(e){return t._handles.add(e.events.on("immediate-click",(function(e){t.emit("immediate-click",n.__assign(n.__assign({},e),{graphic:a.graphic})),e.stopPropagation()})))})),i._handles.add(r.manipulationXY.createDragPipeline((function(n,r,i){return t.buildDragEventPipeline(n,r,i,e)})))},i=this,a=0,o=e;a<o.length;a++)r(o[a]);this.createMoveManipulation(e)},t.prototype.createMoveManipulation=function(e){var t=this,r=new v.MoveManipulation({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?v.MoveManipulation.radiusForSymbol(e[0].graphic.symbol):f.DISC_RADIUS});this._moveManipulation=r,r.elevationInfo={mode:"absolute-height",offset:0},r.forEachManipulator((function(e){t._handles.add(e.events.on("immediate-click",(function(i){r.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",n.__assign(n.__assign({},i),{graphic:t.graphics.getItemAt(0)})),i.stopPropagation()})))}));for(var i=function(){return t.updateMoveManipulation(e)},a=0,o=e;a<o.length;a++){var l=o[a];this._handles.add([l.state.on("changed",i),l.state.watch("displaying",i)])}var c=e[e.length-1];this._handles.add(c.state.on("changed",(function(){return t.updateMoveManipulationAngle(c)}))),this._handles.add(r.createDragPipeline((function(n,r,i){t.buildDragEventPipeline(n,r,i,e)}),u.getGraphicEffectiveElevationInfo(c.graphic),s.unwrap(c.graphic.geometry).spatialReference)),this.updateMoveManipulationAngle(c)},t.prototype.createVisualElements=function(e){for(var t=this,n=function(n){var i=h.createVisualElements({view:r.view,graphic:n.graphic,forEachManipulator:function(e){n.manipulationXY.forEachManipulator(e),t._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return o.makeHandle()}});n.geometryRepresentation=i.visualElement,n.geometryRepresentation instanceof _.OutlineVisualElement&&r._handles.add([n.geometryRepresentation.events.on("attachment-origin-changed",(function(){n.state.isDraped||t.updateMoveManipulation(e)})),n.state.watch("isDraped",(function(){return t.updateMoveManipulation(e)}))]),r._handles.add(i)},r=this,i=0,a=e;i<a.length;i++)n(a[i])},t.prototype.updateMoveManipulationAngle=function(e){this._moveManipulation.angleDeferred=function(){return m.primaryShapeOrientation(e.graphic.geometry)}},t.prototype.updateMoveManipulation=function(e){for(var t=c.makeDehydratedPoint(0,0,0,this.view.spatialReference),n=0,r=!1,i=this._moveManipulation,a=0,o=e;a<o.length;a++){var l=o[a];if(l.state.displaying){var u=l.state.graphic;this.enableZ&&d.canMoveZ(u)&&(r=!0);var h=l.geometryRepresentation instanceof _.OutlineVisualElement&&!l.state.isDraped?l.geometryRepresentation.attachmentOrigin:p.getGraphicAttachmentOrigin(this.view,u);s.isSome(h)&&(t.x+=h.x,t.y+=h.y,t.z+=h.z,n++)}}n>0?(t.x/=n,t.y/=n,t.z/=n,i.location=t,i.xyManipulation.available=!0,i.xyAxisManipulation.available=!0,i.zManipulation.available=r):i.available=!1},t.prototype.buildDragEventPipeline=function(e,t,n,r){var i=this,a=[],o=[],s=null,l=null,c=function(){for(var e=0,t=a;e<t.length;e++)t[e].dragging=!1;a.length=0,o.length=0,s=null,l=null,i._moveManipulation.interactive=!0};t.next((function(t){if("start"===t.action){a.length=0,o.length=0;for(var n=0,c=r;n<c.length;n++){var u=c[n];u.dragging||!u.manipulationXY.hasManipulator(e)&&u.manipulationXY.grabbing||(a.push(u),o.push(u.graphic),u.dragging=!0)}if(0!==o.length&&(i._moveManipulation.interactive=!1,s=x.dragGraphicMany(o),l=x.resetGraphicMany(o),i.emit("graphic-move-start",new S(o)),i.destroyed))return null}return 0!==o.length?t:null})).next((function(e){return s(e)})).next((function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=i.view.toScreen(e.mapStart),n=i.view.toScreen(e.mapEnd);if(i.emit("graphic-move",new O(n.x-t.x,n.y-t.y,o)),i.destroyed)return null}break;case"end":if(i.emit("graphic-move-stop",new P(o)),i.destroyed)return null;c()}})),n.next((function(e){return l(e)})).next((function(){if(i.emit("graphic-move-stop",new P(o)),i.destroyed)return null;c()}))},n.__decorate([l.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n.__decorate([l.property({readOnly:!0})],t.prototype,"graphics",void 0),n.__decorate([l.property({constructOnly:!0,nonNullable:!0})],t.prototype,"enableZ",void 0),n.__decorate([l.property({readOnly:!0})],t.prototype,"type",void 0),n.__decorate([l.subclass("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],t)}(i.EventedMixin(w.InteractiveToolBase));t.GraphicMoveTool=M;var C=function(){function e(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new b.GraphicState({graphic:e})}return Object.defineProperty(e.prototype,"graphic",{get:function(){return this.state.graphic},enumerable:!1,configurable:!0}),e}()}).apply(null,r))||(e.exports=i)},B3XD:function(e,t){},B4Pz:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.FoamColor=t.FoamIntensity=void 0,t.FoamIntensity=function(e){e.fragment.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor =  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "],["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor =  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "]))))},t.FoamColor=function(e){e.fragment.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "],["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},BhkK:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("eIBl"),n("XwIv"),n("H1tY"),n("LxLY"),n("Fe95"),n("48/q"),n("6hC7"),n("yjgM"),n("pvGl")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoveManipulation=void 0;var d=function(e){function t(t){var n=e.call(this)||this;n._handles=new r,n._angleDeferred=null,n._interactive=!0;var i=t.tool,a=t.view,o=t.snapToScene,s=t.radius;return n._view=a,n.xyManipulation=new u.MoveXYDiscManipulation({tool:i,view:a,snapToScene:o,radius:s}),n.xyAxisManipulation=new c.MoveXYAxisManipulation({tool:i,view:a,radius:s}),n.zManipulation=new p.MoveZManipulation({tool:i,view:a,radius:s}),n.xyManipulation.available=t.xyAvailable,n.xyAxisManipulation.available=t.xyAxisAvailable,n.zManipulation.available=t.zAvailable,n.autoHideXYAxis(),n.forEachManipulator((function(e){n._handles.add(e.events.on("grab-changed",(function(){return n.updateManipulatorInteractivity()})))})),n}return n.__extends(t,e),t.prototype.destroy=function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()},t.prototype.createGraphicDragPipeline=function(e,t){return i.handlesGroup([this.xyManipulation.createGraphicDragPipeline(e,t),this.xyAxisManipulation.createGraphicDragPipeline(e,t),this.zManipulation.createGraphicDragPipeline(e,t)])},t.prototype.createDragPipeline=function(e,t,n){return i.handlesGroup([this.xyManipulation.createDragPipeline(e,t,n),this.xyAxisManipulation.createDragPipeline(e,t,n),this.zManipulation.createDragPipeline(e,n)])},Object.defineProperty(t.prototype,"snapToScene",{set:function(e){this.xyManipulation.snapToScene=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angleDeferred",{set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"interactive",{set:function(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayScale",{set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e},enumerable:!1,configurable:!0}),t.prototype.forEachManipulator=function(e){this.xyManipulation.forEachManipulator((function(t){return e(t,1)})),this.xyAxisManipulation.forEachManipulator((function(t){return e(t,1)})),this.zManipulation.forEachManipulator((function(t){return e(t,0)}))},Object.defineProperty(t.prototype,"xyAxisVisible",{get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e},enumerable:!1,configurable:!0}),t.prototype.autoHideXYAxis=function(){var e=this,t=this.xyAxisManipulation,n=this.xyManipulation;if(!a("esri-mobile")){var r=[];n.forEachManipulator((function(e){return r.push(e)})),t.forEachManipulator((function(e){return r.push(e)}));for(var i=function(){var n=[];e.xyAxisVisible?o.isSome(e._angleDeferred)&&(e.angle=e._angleDeferred()):t.forEachManipulator((function(e){return n.push(e.disableDisplay())})),e._handles.remove(h),e._handles.add(n,h)},s=0,l=r;s<l.length;s++)this._handles.add(l[s].events.on("focus-changed",i));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",i)),i()}},t.prototype.updateManipulatorInteractivity=function(){var e=this,t=this.grabbing;this.forEachManipulator((function(n){n.interactive=!t&&e._interactive||n.grabbing}))},t.radiusForSymbol=function(e){var t=o.isSome(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((function(e){return"icon"===e.type}))?s.DISC_RADIUS_SMALL:s.DISC_RADIUS},t}(l.Manipulation);t.MoveManipulation=d;var h="disable-xy-axis-display"}).apply(null,r))||(e.exports=i)},BwdQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("LxLY"),n("FXVB"),n("1m5D"),n("DIqE"),n("Rdxj"),n("2fXB"),n("O7NG"),n("WRgd"),n("lRq4"),n("0FS0"),n("ZPQp"),n("ZcgO"),n("xdO3"),n("UidR")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m){"use strict";function g(e){var t=e.paths[0];if(!t||0===t.length)return null;var n=h.getPointOnPath(t,h.getPathLength(t)/2);return f.makeDehydratedPoint(n[0],n[1],n[2],e.spatialReference)}function y(e,t,n){var r=n?e:v.clonePoint(e);return t&&e?m.pointToPoint(e,r,t)?r:null:r}function _(e){if(Array.isArray(e)){for(var t=0,n=e;t<n.length;t++)if(!_(n[t]))return!1;return!0}return null==e||e>=0}Object.defineProperty(t,"__esModule",{value:!0}),t.namedAnchorToHUDMaterialAnchorPos=t.demResolutionForBoundingBox=t.computeObjectRotation=t.isValidSize=t.validateSymbolLayerSize=t.computeObjectScale=t.overrideColor=t.mixinColorAndOpacity=t.updateVertexAttributeAuxpos1w=t.enlargeExtent=t.computeCentroid=void 0,t.computeCentroid=function(e,t){if("point"===e.type)return y(e,t,!1);if(v.isHydratedGeometry(e))switch(e.type){case"extent":return y(e.center,t,!1);case"polygon":return y(e.centroid,t,!1);case"polyline":return y(g(e),t,!0);case"mesh":return y(e.extent.center,t,!1)}else switch(e.type){case"extent":return y(function(e){var t=n.isFinite(e.zmin);return f.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return y(function(e){var t=e.rings[0];if(!t||0===t.length)return null;var n=d.ringsCentroid(e.rings,e.hasZ);return f.makeDehydratedPoint(n[0],n[1],n[2],e.spatialReference)}(e),t,!0);case"polyline":return y(g(e),t,!0)}},t.enlargeExtent=function(e,t,n,r){if(void 0===r&&(r=0),e){t||(t=p.create());var i=.5*e.width*(n-1),a=.5*e.height*(n-1);return e.width<1e-7*e.height?i+=a/20:e.height<1e-7*e.width&&(a+=i/20),l.vec4.set(t,e.xmin-i-r,e.ymin-a-r,e.xmax+i+r,e.ymax+a+r),t}return null},t.updateVertexAttributeAuxpos1w=function(e,t){for(var n=0;n<e.geometries.length;++n){var r=e.geometries[n].data.vertexAttributes.auxpos1;r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(n))}},t.mixinColorAndOpacity=function(e,t){var n=c.vec4f64.clone(c.vec4f64.ONES);return r.isSome(e)&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),r.isSome(t)?n[3]=t:r.isSome(e)&&e.length>3&&(n[3]=e[3]),n},t.overrideColor=function(e,t,n,i,a,o){void 0===o&&(o=[0,0,0,0]);for(var s=0;s<3;++s)o[s]=r.isSome(e)&&null!=e[s]?e[s]:r.isSome(n)&&null!=n[s]?n[s]:a[s];return o[3]=r.isSome(t)?t:r.isSome(i)?i:a[3],o},t.computeObjectScale=function(e,t,n,i){void 0===e&&(e=s.vec3f64.ONES),void 0===i&&(i=1);var a=new Array(3);if(r.isNone(t)||r.isNone(n))a[0]=1,a[1]=1,a[2]=1;else{for(var o=void 0,l=0,c=2;c>=0;c--){var u=e[c],p=void 0,d=null!=u,h=n[c];"symbol-value"===u||0===c&&!o&&!d?p=0!==h?t[c]/h:1:d&&"proportional"!==u&&isFinite(u)&&(p=0!==h?u/h:1),null!=p&&(a[c]=p,o=p,l=Math.max(l,Math.abs(p)))}for(c=2;c>=0;c--)null==a[c]?a[c]=o:0===a[c]&&(a[c]=.001*l)}for(c=2;c>=0;c--)a[c]/=i;return s.vec3f64.fromArray(a)},t.validateSymbolLayerSize=function(e){return null!=e.isPrimitive&&(e=[e.width,e.depth,e.height]),_(e)?null:"Symbol sizes may not be negative values"},t.isValidSize=_,t.computeObjectRotation=function(e,t,n,r){void 0===r&&(r=a.mat4f64.create());var o=e||0,s=t||0,l=n||0;return 0!==o&&i.mat4.rotateZ(r,r,-o/180*Math.PI),0!==s&&i.mat4.rotateX(r,r,s/180*Math.PI),0!==l&&i.mat4.rotateY(r,r,l/180*Math.PI),r},t.demResolutionForBoundingBox=function(e,t){return null!=t.minDemResolution?t.minDemResolution:u.isPoint(e)?t.minDemResolutionForPoints:.01*u.maximumDimension(e)},t.namedAnchorToHUDMaterialAnchorPos={"bottom-left":o.vec2f64.fromValues(0,0),bottom:o.vec2f64.fromValues(.5,0),"bottom-right":o.vec2f64.fromValues(1,0),left:o.vec2f64.fromValues(0,.5),center:o.vec2f64.fromValues(.5,.5),right:o.vec2f64.fromValues(1,.5),"top-left":o.vec2f64.fromValues(0,1),top:o.vec2f64.fromValues(.5,1),"top-right":o.vec2f64.fromValues(1,1)}}).apply(null,r))||(e.exports=i)},CP88:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("tUyH"),n("v22c"),n("s6rJ")],void 0===(i=(function(e,t,n,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaterGLMaterial=void 0;var o=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return n.__extends(t,e),t.prototype.updateParameters=function(){this.params=a.copyParameters(this.material.getParameters()),this.technique=this.techniqueRep.acquireAndReleaseExisting(i.WaterTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){if(2===this.output)return 22===e;if(5===this.output)return null==e;if(4===this.output)return 3===e;var t=3;return this.params.transparent&&(t=this.params.writeDepth?5:8),e===t},t.prototype.setElapsedTimeUniform=function(e){e.setUniform1f("timeElapsed",.001*this.material.animation.time*this.params.animationSpeed)},t.prototype._updateShadowState=function(e){e.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:e.shadowMappingEnabled}),this.updateParameters())},t.prototype._updateSSRState=function(e){e.ssrEnabled!==this.params.ssrEnabled&&(this.material.setParameterValues({ssrEnabled:e.ssrEnabled}),this.updateParameters())},t.prototype.ensureResources=function(e){return this.technique.ensureResource(e)},t.prototype.ensureParameters=function(e){0===this.output&&(this._updateShadowState(e),this._updateSSRState(e))},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.params,t),2!==this.output&&0!==this.output||this.setElapsedTimeUniform(this.technique.program)},t}(r.GLMaterial);t.WaterGLMaterial=o}).apply(null,r))||(e.exports=i)},CqfC:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("vJh7")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat2=void 0,t.mat2=n}).apply(null,r))||(e.exports=i)},DFuO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("3kdR"),n("6t3m"),n("PaEL"),n("IwVr"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c){"use strict";var u,p,d,h;Object.defineProperty(t,"__esModule",{value:!0}),t.build=void 0,t.build=function(e){var t=new c.ShaderBuilder;return t.include(i.Transform,{linearDepth:!1}),t.include(a.VertexColor,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(l.glsl(u||(u=n.__makeTemplateObject(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "],["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])))),t.include(r.Slice,e),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(o.OutputHighlight),t.fragment.code.add(l.glsl(h||(h=n.__makeTemplateObject(["\n  void main() {\n    discardBySlice(vpos);\n    vec4 color = ","\n\n    if (color.a < ",") {\n      discard;\n    }\n\n    ","\n    ",";\n  }\n  "],["\n  void main() {\n    discardBySlice(vpos);\n    vec4 color = ","\n\n    if (color.a < ",") {\n      discard;\n    }\n\n    ","\n    ",";\n  }\n  "])),e.attributeColor?"vColor * eColor;":"eColor;",l.glsl.float(s.symbolAlphaCutoff),0===e.output?l.glsl(p||(p=n.__makeTemplateObject(["gl_FragColor = highlightSlice(color, vpos);"],["gl_FragColor = highlightSlice(color, vpos);"]))):"",4===e.output?l.glsl(d||(d=n.__makeTemplateObject(["outputHighlight();"],["outputHighlight();"]))):"")),t}}).apply(null,r))||(e.exports=i)},Dk48:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("Gtr7"),n("Vx27")],void 0===(i=(function(e,t,n,r,i){"use strict";return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_VISIBLE=!1,t.DECONFLICTOR_SHOW_INVISIBLE=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_DEBUG_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.SHOW_POI=!1,t.TERRAIN_DEBUG_POPUP=!1,t.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,t.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.I3S_TREE_SHOW_TILES=!1,t.I3S_SHOW_MODIFICATIONS=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t.DISABLE_FAST_UPDATES=!1,t.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,t.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,t.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,t}return n.__extends(t,e),n.__decorate([i.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),n.__decorate([i.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),n.__decorate([i.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),n.__decorate([i.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),n.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),n.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),n.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),n.__decorate([i.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),n.__decorate([i.property()],t.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),n.__decorate([i.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),n.__decorate([i.property()],t.prototype,"SHOW_POI",void 0),n.__decorate([i.property()],t.prototype,"TERRAIN_DEBUG_POPUP",void 0),n.__decorate([i.property()],t.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),n.__decorate([i.property()],t.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),n.__decorate([i.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),n.__decorate([i.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),n.__decorate([i.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),n.__decorate([i.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),n.__decorate([i.property()],t.prototype,"I3S_TREE_SHOW_TILES",void 0),n.__decorate([i.property()],t.prototype,"I3S_SHOW_MODIFICATIONS",void 0),n.__decorate([i.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),n.__decorate([i.property()],t.prototype,"DISABLE_FAST_UPDATES",void 0),n.__decorate([i.property()],t.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),n.__decorate([i.property()],t.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),n.__decorate([i.property()],t.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),n.__decorate([i.subclass("esri.views.3d.support.DebugFlags")],t)}(r))}).apply(null,r))||(e.exports=i)},"E/g4":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,a,o,s,l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.RibbonVertexPosition=void 0,t.RibbonVertexPosition=function(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "],["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "]))))):(e.attributes.add("size","float"),e.vertex.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "],["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "]))))),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.defines.addInt("VV_OPACITY_N",8),e.vertex.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value <= vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i = 1; i < VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "],["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value <= vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i = 1; i < VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "]))))):e.vertex.code.add(r.glsl(s||(s=n.__makeTemplateObject(["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "])))),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.defines.addInt("VV_COLOR_N",8),e.vertex.code.add(r.glsl(l||(l=n.__makeTemplateObject(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value <= vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i = 1; i < VV_COLOR_N; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "],["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value <= vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i = 1; i < VV_COLOR_N; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "]))))):(e.attributes.add("color","vec4"),e.vertex.code.add(r.glsl(c||(c=n.__makeTemplateObject(["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "])))))}}).apply(null,r))||(e.exports=i)},EiS2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("PaEL"),n("2NOe"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("lfQW"),n("DFuO"),n("G0ER"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorMaterialTechniqueConfiguration=t.ColorMaterialTechnique=void 0;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get(),r=this.configuration,i=n.build({output:r.output,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new h(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),u.Default3D)},t.prototype.bindPass=function(e,t,n){o.View.bindProjectionMatrix(this.program,n.camera.projectionMatrix),this.program.setUniform4fv("eColor",t.color),4===this.configuration.output&&a.OutputHighlight.bindOutputHighlight(e,this.program,n)},t.prototype.bindDraw=function(e){o.View.bindView(this.program,e),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){var e=this.configuration,t=f.separateBlendingParams(770,1,771,771),n=0===e.output?e.transparent&&t:null,r=function(t){return f.makePipelineState({blending:n,polygonOffset:e.polygonOffset&&m,culling:(r=e.cullFace,0!==r&&{face:1===r?1028:1029,mode:2305}),depthTest:p.depthCompareLess,depthWrite:e.writeDepth&&f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?p.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?t?p.stencilToolMaskBaseParams:p.stencilBaseAllZerosParams:null});var r};return this._occludeeState=r(!0),r(!1)},Object.defineProperty(t.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!1,configurable:!0}),t.shader=new s.ReloadableShaderModule(d,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("DFuO")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(l.ShaderTechnique);t.ColorMaterialTechnique=v;var m={factor:1,units:1},g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.vertexColors=!1,t.transparent=!1,t.polygonOffset=!1,t.writeDepth=!0,t.sceneHasOcludees=!1,t}return r.__extends(t,e),r.__decorate([c.parameter({count:7})],t.prototype,"output",void 0),r.__decorate([c.parameter({count:3})],t.prototype,"cullFace",void 0),r.__decorate([c.parameter()],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([c.parameter()],t.prototype,"sliceHighlightDisabled",void 0),r.__decorate([c.parameter()],t.prototype,"vertexColors",void 0),r.__decorate([c.parameter()],t.prototype,"transparent",void 0),r.__decorate([c.parameter()],t.prototype,"polygonOffset",void 0),r.__decorate([c.parameter()],t.prototype,"writeDepth",void 0),r.__decorate([c.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(c.ShaderTechniqueConfiguration);t.ColorMaterialTechniqueConfiguration=g}).apply(null,r))||(e.exports=i)},FLCf:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderStatsAggregator=t.addToRenderStats=t.makeNewRenderStats=void 0,t.makeNewRenderStats=function(){return{triangles:0,drawCalls:0}},t.addToRenderStats=function(e,t,n){n&&(n.drawCalls+=e,n.triangles+=t)};var n=function(){function e(){this.materialRenderStats=new Map,this.reset()}return e.prototype.getMaterialRenderStatsObject=function(e){var t=this.materialRenderStats.get(e);return t||this.materialRenderStats.set(e,t={triangles:0,drawCalls:0}),t},e.prototype.getAggregatedStats=function(){var e={materialRenderers:{},total:{triangles:0,drawCalls:0}};return this.materialRenderStats.forEach((function(t,n){e.materialRenderers[n]=t,e.total.drawCalls+=t.drawCalls,e.total.triangles+=t.triangles})),e},e.prototype.reset=function(){this.materialRenderStats.forEach((function(e){e.drawCalls=0,e.triangles=0}))},e}();t.RenderStatsAggregator=n}).apply(null,r))||(e.exports=i)},FU3N:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qsST"),n("LxLY"),n("dl/g"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,a){"use strict";var o=n.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),s=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,a.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}();return function(){function e(e,t,n){this._textureRep=e,this._techniqueRep=t,this.onMaterialChanged=n,this._id2glMaterialRef=new Map}return e.prototype.dispose=function(){this._textureRep.dispose()},e.prototype.acquire=function(e,t){this.ownMaterial(e);var n,r=i.getShaderOutputID(e.id,t),a=this._id2glMaterialRef.get(r);return null==a?(n=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t}),a=new s(n),this._id2glMaterialRef.set(r,a)):n=a.getGLMaterial(),a.incRefCnt(),n},e.prototype.release=function(e,t){var n=i.getShaderOutputID(e.id,t),r=this._id2glMaterialRef.get(n);if(r.decRefCnt(),0===r.getRefCnt()){var a=r.getGLMaterial();a&&a.dispose(),this._id2glMaterialRef.delete(n)}},e.prototype.materialChanged=function(e){for(var t=0,n=i.ShaderOutputTypes;t<n.length;t++){var r=n[t];if(5!==r.output&&6!==r.output){var a=this._id2glMaterialRef.get(i.getShaderOutputID(e.id,r.output));if(a&&a.getGLMaterial()){var o=a.getGLMaterial();o.updateParameters&&o.updateParameters()}}}this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.ownMaterial=function(e){r.isSome(e.materialRepository)&&e.materialRepository!==this&&o.error("Material is already owned by a different material repository"),e.materialRepository=this},e}()}).apply(null,r))||(e.exports=i)},FbvD:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("DJpR")],void 0===(i=(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createStipplePatternSimple=t.createStipplePattern=t.StippleTextureRepository=void 0;var i=function(){function e(){this.cache=new Map}return e.prototype.dispose=function(){this.cache.forEach((function(e){n.isSome(e.texture)&&(e.texture.dispose(),e.texture=null)})),this.cache.clear()},e.prototype.acquire=function(e){if(n.isNone(e))return null;var t=this.patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;var a=this.patternToTextureData(e,2),o=a.length/2,s={refCount:1,texture:null,bind:function(e,t){return n.isNone(s.texture)&&(s.texture=new r.Texture(e,{width:a.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},a)),e.bindTexture(s.texture,t),o}};return this.cache.set(t,s),s.bind},e.prototype.release=function(e){if(!n.isNone(e)){var t=this.patternId(e),r=this.cache.get(t);r&&(r.refCount--,0===r.refCount&&(n.isSome(r.texture)&&r.texture.dispose(),this.cache.delete(t)))}},e.prototype.swap=function(e,t){var n=this.acquire(t);return this.release(e),n},e.prototype.patternId=function(e){return e.join(",")},e.prototype.patternToTextureData=function(e,t){for(var n=e.reduce((function(e,t){return e+t}))*t,r=new Uint8Array(n),i=!0,a=0,o=0,s=e;o<s.length;o++){for(var l=s[o],c=0;c<l*t;c++)r[a++]=i?255:0;i=!i}return r},e}();t.StippleTextureRepository=i,t.createStipplePattern=function(e){return n.isNone(e)?e:e.slice()},t.createStipplePatternSimple=function(e){return[e,e]}}).apply(null,r))||(e.exports=i)},Fe95:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ALIGN_ARROWS_SCALE_THRESHOLD=t.RING_RESET_ANIMATION_SPEED_FACTOR=t.RING_INDICATOR_DELAY_MS=t.ROTATE_INDICATOR_DIRECTION_BUFFER=t.SCALE_INDICATOR_DIRECTION_BUFFER=t.SCALE_INDICATOR_OFFSET2=t.SCALE_INDICATOR_OFFSET1=t.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE=t.DRAG_THRESHOLD_PX=t.SCALE_INDICATOR_ARC_LENGTH=t.ROTATE_INDICATOR_ARC_LENGTH=t.ROTATE_INDICATOR_ARROW_TIP_RADIUS=t.ROTATE_INDICATOR_ARROW_TIP_LENGTH=t.OUTER_INDICATOR_RADIUS=t.INNER_INDICATOR_RADIUS=t.INDICATOR_THICKNESS=t.RING_THICKNESS=t.RING_HEIGHT=t.RING_RADIUS=t.DISC_RADIUS_SMALL=t.DISC_TRANSLATE_ARROW_OFFSET=t.DISC_TRANSLATE_ARROW_SIZE=t.DISC_HEIGHT=t.DISC_COLLISION_RADIUS=t.DISC_RADIUS=t.GEOMETRY_SEGMENTS=t.HANDLE_COLOR=void 0,t.HANDLE_COLOR=[1,.5,0],t.GEOMETRY_SEGMENTS=128,t.DISC_RADIUS=70,t.DISC_COLLISION_RADIUS=80,t.DISC_HEIGHT=.02,t.DISC_TRANSLATE_ARROW_SIZE=54,t.DISC_TRANSLATE_ARROW_OFFSET=100,t.DISC_RADIUS_SMALL=Math.ceil(t.DISC_RADIUS/3*2),t.RING_RADIUS=160,t.RING_HEIGHT=.5,t.RING_THICKNESS=24,t.INDICATOR_THICKNESS=9,t.INNER_INDICATOR_RADIUS=t.RING_RADIUS+30,t.OUTER_INDICATOR_RADIUS=t.RING_RADIUS+53,t.ROTATE_INDICATOR_ARROW_TIP_LENGTH=60,t.ROTATE_INDICATOR_ARROW_TIP_RADIUS=23,t.ROTATE_INDICATOR_ARC_LENGTH=5*Math.PI/12,t.SCALE_INDICATOR_ARC_LENGTH=1*Math.PI/3,t.DRAG_THRESHOLD_PX=10,t.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE=.2,t.SCALE_INDICATOR_OFFSET1=30,t.SCALE_INDICATOR_OFFSET2=53,t.SCALE_INDICATOR_DIRECTION_BUFFER=.2,t.ROTATE_INDICATOR_DIRECTION_BUFFER=.3,t.RING_INDICATOR_DELAY_MS=200,t.RING_RESET_ANIMATION_SPEED_FACTOR=3,t.ALIGN_ARROWS_SCALE_THRESHOLD=1e6}).apply(null,r))||(e.exports=i)},"G+tB":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("PLh7"),n("uinn")],void 0===(i=(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=void 0,t.createVisualElements=function(e){switch(n.unwrap(e.graphic.geometry).type){case"point":return i.createVisualElements(e);case"polygon":case"polyline":return r.createVisualElements(e);default:return null}}}).apply(null,r))||(e.exports=i)},GDWR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("KY0m")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommonUniformStore=void 0;var r=function(){function e(){this._uniforms={proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}return e.prototype.dispose=function(){this._uniforms=null},e.prototype.getPrograms=function(e){return this._uniforms[e]||[]},e.prototype.subscribeProgram=function(e){for(var t in this._uniforms)e.hasUniform(t)&&this._uniforms[t].push(e)},e.prototype.unsubscribeProgram=function(e){for(var t in this._uniforms)n.removeUnordered(this._uniforms[t],e)},e}();t.CommonUniformStore=r}).apply(null,r))||(e.exports=i)},HbaO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("O7NG")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WHITE_UNIT=t.TRANSPARENT_UNIT=t.SUSPEND_RESUME_EXTENT_OPTIMISM=t.defaultIconElevationOffset=void 0,t.defaultIconElevationOffset=1,t.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2,t.TRANSPARENT_UNIT=n.vec4f64.ZEROS,t.WHITE_UNIT=n.vec4f64.ONES}).apply(null,r))||(e.exports=i)},J2BX:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("CIy2")],void 0===(i=(function(e,t,n,r){"use strict";function i(e,t){for(var n=e,i=new Uint8Array(4*n*n),a=n/2-.5,o=t/2,s=0;s<n;s++)for(var l=0;l<n;l++){var c=l+n*s,u=l-a,p=s-a,d=Math.sqrt(u*u+p*p)-o;r.packFloatRGBA(d=d/e+.5,i,4*c)}return i}function a(e,t){return u(e,t,!1)}function o(e,t){return u(e,t,!0)}function s(e,t){return p(e,t,!1)}function l(e,t){return p(e,t,!0)}function c(e,t){for(var n=new Uint8Array(4*e*e),i=Math.sqrt(1.25),a=(e-t)/2,o=0;o<e;o++)for(var s=0;s<e;s++){var l=o*e+s,c=(s-a)/t,u=(o-a+.75)/t,p=Math.max(-(1*c+-.5*u)/i,(1*(c-1)+-.5*-u)/i,-u)*t/e+.5;r.packFloatRGBA(p,n,4*l)}return n}function u(e,t,n){n&&(t/=Math.SQRT2);for(var i=new Uint8Array(4*e*e),a=0;a<e;a++)for(var o=0;o<e;o++){var s=o-.5*e+.25,l=.5*e-a-.75,c=a*e+o;if(n){var u=(s+l)/Math.SQRT2;l=(l-s)/Math.SQRT2,s=u}var p=Math.max(Math.abs(s),Math.abs(l))-.5*t;r.packFloatRGBA(p=p/e+.5,i,4*c)}return i}function p(e,t,n){n&&(t*=Math.SQRT2);for(var i=.5*t,a=new Uint8Array(4*e*e),o=0;o<e;o++)for(var s=0;s<e;s++){var l=s-.5*e,c=.5*e-o-1,u=o*e+s;if(n){var p=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=p}var d=void 0;d=(d=(l=Math.abs(l))>(c=Math.abs(c))?l>i?Math.sqrt((l-i)*(l-i)+c*c):c:c>i?Math.sqrt(l*l+(c-i)*(c-i)):l)/e+.5,r.packFloatRGBA(d,a,4*u)}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.createTriangle=t.createX=t.createCross=t.createKite=t.createSquare=t.createCircle=t.createType=void 0,t.createType=function(e,t,r){switch(e){case"circle":return i(t,r);case"square":return a(t,r);case"cross":return s(t,r);case"x":return l(t,r);case"kite":return o(t,r);case"triangle":return c(t,r);default:return n.neverReached(e),i(t,r)}},t.createCircle=i,t.createSquare=a,t.createKite=o,t.createCross=s,t.createX=l,t.createTriangle=c}).apply(null,r))||(e.exports=i)},JXo2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("pcDC"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("8MXS"),n("Vx27"),n("0LE5"),n("ZcgO"),n("DtIM"),n("woUR"),n("5T2R"),n("B3XD"),n("1eTA"),n("X5J5"),n("G+tB"),n("YsOV"),n("Fe95"),n("BhkK"),n("dtql"),n("73uV"),n("R4nD"),n("/NuL"),n("JjCO"),n("ys4y"),n("4ziW"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w,S,O,P,M,C,D,R){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReshapeGeometryHelper=t.ReshapeOperation=void 0;var A=function(e){function t(t){var n=e.call(this,t)||this;return n._vertexManipulatorMaterial=f.createManipulatorMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.vertex.color),g.settings.reshapeManipulators.vertex.renderOccludedFlag),n._vertexManipulatorOutlineMaterial=f.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.vertex.outlineColor),g.settings.reshapeManipulators.vertex.renderOccludedFlag),n._vertexManipulatorHoverOutlineMaterial=f.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.vertex.hoverOutlineColor),g.settings.reshapeManipulators.vertex.renderOccludedFlag),n._edgeManipulatorMaterial=f.createManipulatorMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.edge.color),g.settings.reshapeManipulators.edge.renderOccludedFlag),n._edgeManipulatorOutlineMaterial=f.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.edge.outlineColor),g.settings.reshapeManipulators.edge.renderOccludedFlag),n._selectedManipulatorMaterial=f.createManipulatorMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.selected.color),g.settings.reshapeManipulators.selected.renderOccludedFlag),n._selectedManipulatorOutlineMaterial=f.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.selected.outlineColor),g.settings.reshapeManipulators.selected.renderOccludedFlag),n._selectedManipulatorHoverOutlineMaterial=f.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.selected.hoverOutlineColor),g.settings.reshapeManipulators.selected.renderOccludedFlag),n._selectedIndex=0,n._vertexManipulatorGeometry=null,n._vertexManipulatorOutlineGeometry=null,n._edgeManipulatorGeometry=null,n._edgeManipulatorOutlineGeometry=null,n._handles=new a,n._manipulatorHandles=new a,n._manipulatorInfos=[],n._reshapeHelper=null,n._graphicMoveManipulation=null,n._moveManipulation=null,n._numGrabbing=0,n._numDragging=0,n._reshapeEventState=0,n._outlineVisualElement=null,n.tool=null,n.outputGeometry=null,n._vertexLaserLineVisualElement=null,n}return n.__extends(t,e),t.prototype.initialize=function(){var e=this,t=new P.GraphicState({graphic:this.graphic});this._graphicState=t,this._handles.add([t.watch("displaying",(function(t){for(var n=0,r=e._manipulatorInfos;n<r.length;n++)r[n].manipulator.available=t})),this.view.trackGraphicState(t)])},t.prototype.destroy=function(){this._clear(),this._handles.destroy()},Object.defineProperty(t.prototype,"inputGeometry",{get:function(){return s.isSome(this._reshapeHelper)?this._reshapeHelper.geometry:null},set:function(e){this._recreateManipulators(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manipulators",{get:function(){return this.tool.manipulators},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.tool.view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphic",{get:function(){return this.tool.graphic},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableZ",{get:function(){return this.tool.enableZ},enumerable:!1,configurable:!0}),t.prototype.removeSelectedVertices=function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.handle.type}));this._removeVertices(e)},t.prototype.manipulatorSelectionChanged=function(){this.emit("manipulators-changed")},t.prototype._clear=function(){this._moveManipulation&&this._moveManipulation.destroy(),this._graphicMoveManipulation&&this._graphicMoveManipulation.destroy(),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._graphicMoveManipulation=null,this._moveManipulation=null,this._reshapeHelper=null,this._numGrabbing=0,this._numDragging=0},t.prototype._recreateManipulators=function(e){if(void 0===e&&(e=this.inputGeometry),this._clear(),!s.isNone(e)){this._reshapeHelper=new L(_.EditGeometry.fromGeometry(e,this.view.viewingMode),e.type);for(var t=d.getGraphicEffectiveElevationInfo(this.graphic),n=0,r=this._reshapeHelper.data.components;n<r.length;n++){for(var i=r[n],a=0,o=i.vertices;a<o.length;a++)this._createPerVertexManipulator(o[a],t);for(var l=0,c=i.edges;l<c.length;l++)this._createPerVertexManipulator(c[l],t)}this._createGraphicMoveManipulators(t)}},t.prototype._perGraphicManipulatorDragAction=function(e,t){if("end"!==t.action){for(var n=[],r=this._manipulatorInfos.some((function(e){return"vertex"===e.handle.type&&e.manipulator.selected})),i=1===e&&r,a=s.unwrap(this._reshapeHelper),o=0,l=this._manipulatorInfos;o<l.length;o++)"vertex"===(d=l[o]).handle.type&&(d.manipulator.grabbing||i&&!d.manipulator.selected||(s.unwrap(a).moveVertices([d.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),n.push(d.handle.pos),this._updateManipulatorPosition(d)));if(0!==n.length){for(var c=0,u=0,p=this._manipulatorInfos;u<p.length;u++){var d;"vertex"===(d=p[u]).handle.type&&c++}if(this.outputGeometry=a.geometry,n.length===c){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}}},t.prototype._perVertexManipulatorDragAction=function(e,t){if(this._updateEventState(2),!this.destroyed){var n=t.mapDeltaX,r=t.mapDeltaY,i=t.mapDeltaZ;if(n||r||i){for(var a=[],o=0,l=this._manipulatorInfos;o<l.length;o++){var c=l[o];T(c)&&(c.manipulator.selected&&!c.manipulator.grabbing||c===e)&&a.push(c)}for(var u=s.unwrap(this._reshapeHelper),p=0,d=a;p<d.length;p++){var h=d[p];u.moveVertices([h.handle],n,r,i)}this.outputGeometry=u.geometry;for(var f=0,v=a;f<v.length;f++)this._updateManipulatorPosition(h=v[f]);this.emit("reshape",{type:"reshape",mover:this.graphic})}}},t.prototype._updateEventState=function(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t},t.prototype._createGraphicMoveManipulators=function(e){var t=this;this._graphicMoveManipulation=new S.MoveXYGraphicManipulation({tool:this.tool,view:this.view,graphicState:this._graphicState}),this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((function(e,n,r){n.next((function(e){return t._trackNumDragging(e)})).next((function(e){t._perGraphicManipulatorDragAction(0,e)})),r.next(t._cancelDragOperation())}))),this._graphicMoveManipulation.forEachManipulator((function(e){return t._manipulatorHandles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click"),e.stopPropagation()}))])})),this._moveManipulation=new x.MoveManipulation({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&m.canMoveZ(this.graphic),snapToScene:!1,radius:x.MoveManipulation.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((function(e){t._handles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(n){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some((function(e){return e.manipulator.selected}))||t.emit("immediate-click"),n.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var n=s.unwrap(this.graphic.geometry).spatialReference;this._handles.add([this._moveManipulation.createDragPipeline((function(e,n,r){n.next((function(e){return t._trackNumDragging(e)})).next(R.addMapDelta()).next((function(e){t._perGraphicManipulatorDragAction(1,e)})),r.next(t._cancelDragOperation())}),e,n),l.init(this._graphicState,"displaying",(function(e){t._moveManipulation.xyManipulation.available=e,t._moveManipulation.xyAxisManipulation.available=!0,t._moveManipulation.zManipulation.available=e&&t.enableZ&&m.canMoveZ(t.graphic),t._updateMoveManipulationPosition()})),this._graphicState.on("changed",(function(){return t._updateMoveManipulationPosition()}))]),this._updateMoveManipulationPosition();var r=y.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:function(e){if(!t.destroyed){t._graphicMoveManipulation.forEachManipulator(e);for(var n=0,r=t._manipulatorInfos;n<r.length;n++)e(r[n].manipulator,1);t._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:function(e){return t.on("manipulators-changed",e)}});this._outlineVisualElement=r.visualElement instanceof O.OutlineVisualElement?r.visualElement:null,s.isSome(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(function(){t._graphicState.isDraped||t._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(function(){return t._updateMoveManipulationPosition()}))]),this._manipulatorHandles.add(r)},t.prototype._createPerVertexManipulator=function(e,t){var n=this;if(void 0===t&&(t=d.getGraphicEffectiveElevationInfo(this.graphic)),s.isNone(this._vertexManipulatorGeometry)||s.isNone(this._vertexManipulatorOutlineGeometry)){var r=g.settings.reshapeManipulators.vertex,i=(l=r.size/2)/(c=l+r.collisionPadding);this._vertexManipulatorGeometry=new C(D.createSphereGeometry(i,16,16),"reshape-manipulator");var a=(l+r.outlineSize)/c;this._vertexManipulatorOutlineGeometry=new C(D.createSphereGeometry(a,16,16),"reshape-manipulator-outline")}if(s.isNone(this._edgeManipulatorGeometry)||s.isNone(this._edgeManipulatorOutlineGeometry)){var l,c,u=g.settings.reshapeManipulators.edge;i=(l=u.size/2)/(c=l+u.collisionPadding),this._edgeManipulatorGeometry=new C(D.createSphereGeometry(i,16,16),"reshape-manipulator"),this._edgeManipulatorOutlineGeometry=new C(D.createSphereGeometry(a=(l+u.outlineSize)/c,16,16),"reshape-manipulator-outline")}var p=new h.Manipulator3D({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|I.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|I.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|I.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|I.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|I.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|I.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|I.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(p,e,t);var f="edge"===e.type?{manipulator:p,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:p,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(f),this.manipulators.add(p),this._updateManipulatorPosition(f),"edge"===f.type){var m=this._getManipulatorInfoFromHandle(f.handle.left).manipulator.events.on("location-update",(function(){return n._updateManipulatorPosition(f)})),y=this._getManipulatorInfoFromHandle(f.handle.right).manipulator.events.on("location-update",(function(){return n._updateManipulatorPosition(f)}));f.locationUpdateHandle=o.handlesGroup([m,y]),this._manipulatorHandles.add(f.locationUpdateHandle,p)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(p,!0),p);var _=R.createManipulatorDragEventPipeline(p,(function(e,t,r){t.next((function(e){return n._trackNumDragging(e)})).next((function(e){return j(f)&&n._splitEdgeManipulator(f),e})).next(v.screenToMapXYForGraphicAtLocation(n.view,n.graphic,e.elevationAlignedLocation,e.location.spatialReference)).next(R.addMapDelta()).next((function(e){"vertex"===f.type?n._perVertexManipulatorDragAction(f,e):console.error("drag operation on non-vertex manipulator not allowed")})),r.next(n._cancelDragOperation())}));return this._manipulatorHandles.add(_,p),this._manipulatorHandles.add([p.events.on("immediate-click",(function(e){return n._manipulatorClickCallback(e,f)})),p.events.on("select-changed",(function(){f.selectedIndex=++n._selectedIndex,n._updateMoveManipulationPosition()}))]),this.emit("manipulators-changed"),p},t.prototype._trackNumDragging=function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e},t.prototype._cancelDragOperation=function(){var e=this,t=s.isSome(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return function(){switch(e._numDragging--,e.inputGeometry=t,e.outputGeometry=t,e._reshapeEventState){case 0:break;case 1:e.emit("move",{type:"move",dx:0,dy:0,mover:e.graphic});break;case 2:e.emit("reshape",{type:"reshape",mover:e.graphic})}e.destroyed||e._updateEventState(0)}},t.prototype._setTypeSpecificManipulatorSettings=function(e,t,n){switch(t.type){case"vertex":e.state=I.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=g.settings.reshapeManipulators.vertex.size/2+g.settings.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=n;break;case"edge":e.state=I.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=g.settings.reshapeManipulators.edge.size/2+g.settings.reshapeManipulators.edge.collisionPadding,e.elevationInfo={mode:"absolute-height",offset:0};break;default:r.neverReached(t)}},t.prototype._watchAndUpdateGrabState=function(e,t){var n=this;return e.events.on("grab-changed",(function(r){if("start"===r.action)t&&n._updateSelection(e),n._numGrabbing++;else if(n._numGrabbing--,n._updateEventState(0),n.destroyed)return;n._moveManipulation.interactive=!n._numGrabbing}))},t.prototype._clearSelection=function(){for(var e=0,t=this._manipulatorInfos;e<t.length;e++){var n=t[e];n.manipulator.grabbing||(n.manipulator.selected=!1)}},t.prototype._updateSelection=function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))},t.prototype._removeManipulator=function(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))},t.prototype._getManipulatorInfoFromHandle=function(e){if(e)for(var t=0,n=this._manipulatorInfos;t<n.length;t++){var r=n[t];if(e===r.handle)return r}return null},t.prototype._updateManipulatorPosition=function(e){if(e){var t=s.unwrap(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.data.coordinateHelper.toPoint(e.handle.pos,V),e.manipulator.grabbing&&s.isSome(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){var n=this._getManipulatorInfoFromHandle(e.handle.left).manipulator.elevationAlignedLocation,r=this._getManipulatorInfoFromHandle(e.handle.right).manipulator.elevationAlignedLocation;e.manipulator.elevationAlignedLocation=p.makeDehydratedPoint(n.x+.5*(r.x-n.x),n.y+.5*(r.y-n.y),n.hasZ&&r.hasZ?n.z+.5*(r.z-n.z):void 0,t.geometry.spatialReference)}}},t.prototype._splitEdgeManipulator=function(e){var t=s.unwrap(this._reshapeHelper),n=s.unwrap(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var r=e;r.handle=n,r.type="vertex";var i=d.getGraphicEffectiveElevationInfo(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,i),n.left&&this._createPerVertexManipulator(n.left),n.right&&this._createPerVertexManipulator(n.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(r),this._updateSelection(e.manipulator);var a=t.data.coordinateHelper.toArray(r.handle.pos),o=t.data.components.indexOf(n.component);this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:a,componentIndex:o,vertexIndex:s.unwrap(n.index)}],added:a})},t.prototype._updateMoveManipulationPosition=function(){var e=this,t=M.sv3d.get();u.vec3.set(t,0,0,0);for(var n=0,r=!1,i=null,a=null,o=0,l=this._manipulatorInfos;o<l.length;o++){var c=l[o];T(c)&&(c.manipulator.selected?(n++,u.vec3.add(t,t,c.manipulator.renderLocation),s.isNone(i)||c.selectedIndex>i.selectedIndex?(a=i,i=c):(s.isNone(a)||c.selectedIndex>a.selectedIndex)&&(a=c)):r=!0)}if(this._moveManipulation.xyAxisManipulation.orthogonalAvailable=!0,this._moveManipulation.xyAxisManipulation.available=!0,0!==n){var p=0;if(s.isSome(i)){var d=i.handle.pos,h=s.isSome(a)?a.handle.pos:i.handle.left&&i.handle.left.left?i.handle.left.left.pos:null,v=!s.isSome(a)&&i.handle.right&&i.handle.right.right?i.handle.right.right.pos:null;h&&v?this._moveManipulation.xyAxisManipulation.available=!1:h?p=E(h,d):v&&(p=E(d,v))}this._moveManipulation.xyAxisManipulation.orthogonalAvailable=1!==n,this._moveManipulation.angle=p,this._moveManipulation.radius=b.DISC_RADIUS_SMALL}else this._moveManipulation.angleDeferred=function(){return w.primaryShapeOrientation(s.unwrap(e.graphic.geometry))},this._moveManipulation.radius=x.MoveManipulation.radiusForSymbol(this.graphic.symbol);0!==n&&r?(u.vec3.scale(t,t,1/n),V.spatialReference=s.unwrap(this._reshapeHelper).geometry.spatialReference,this.view.renderCoordsHelper.fromRenderCoords(t,V),this._moveManipulation.elevationAlignedLocation=V):s.isSome(this._outlineVisualElement)&&!this._graphicState.isDraped&&s.isSome(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:f.placeAtGraphic(this.view,this._moveManipulation,this.graphic)},t.prototype._removeVertices=function(e){for(var t=[],n=s.unwrap(this._reshapeHelper),r=0,i=e;r<i.length;r++){var a=i[r];if("vertex"===a.handle.type&&n.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.right));var o=s.unwrap(n.removeVertices([a.handle]).removedVertices[0].createdEdge);o&&this._createPerVertexManipulator(o)}}if(t.length>0){var l=t.map((function(e){var t=n.data.components.indexOf(e.component);return{coordinates:n.data.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:s.unwrap(e.index)}}));this.outputGeometry=n.geometry;var c=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:l.map((function(e){return e.coordinates})),vertices:l}),this.destroyed)return;if(c&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}},t.prototype._manipulatorClickCallback=function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),j(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()},n.__decorate([c.property({constructOnly:!0})],t.prototype,"tool",void 0),n.__decorate([c.property()],t.prototype,"inputGeometry",null),n.__decorate([c.property()],t.prototype,"outputGeometry",void 0),n.__decorate([c.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.ReshapeOperation")],t)}(i.EventedAccessor);function E(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function T(e){return"vertex"===e.handle.type}function j(e){return"edge"===e.handle.type}t.ReshapeOperation=A;var I,V=p.makeDehydratedPoint(0,0,null,null);!function(e){e.Vertex=16,e.Edge=32}(I||(I={}));var L=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.type=n,r._geometry=null,r}return n.__extends(t,e),Object.defineProperty(t.prototype,"geometry",{get:function(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.data.toPolyline();break;case"polygon":this._geometry=this.data.toPolygon()}this._dirty=!1}return this._geometry},enumerable:!1,configurable:!0}),t}(_.EditGeometryHelper);t.ReshapeGeometryHelper=L}).apply(null,r))||(e.exports=i)},KPBO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.add=t.scalarProduct=t.elementwiseProduct=t.dotProduct=void 0,t.dotProduct=function(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n},t.elementwiseProduct=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]*t[r];return n},t.scalarProduct=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]*t;return n},t.add=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]+t[r];return n}}).apply(null,r))||(e.exports=i)},KQg4:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("0W55"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.build=void 0,t.build=function(){var e=new a.ShaderBuilder;return e.include(r.ScreenSpacePass),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(i.glsl(o||(o=n.__makeTemplateObject(["\n    void main() {\n      vec4 texColor = texture2D(tex, uv);\n      gl_FragColor = texColor * color;\n    }\n  "],["\n    void main() {\n      vec4 texColor = texture2D(tex, uv);\n      gl_FragColor = texColor * color;\n    }\n  "])))),e}}).apply(null,r))||(e.exports=i)},KtQ6:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function n(e){return"h"in e&&"s"in e&&"v"in e}function r(e){return"l"in e&&"a"in e&&"b"in e}function i(e){return"l"in e&&"c"in e&&"h"in e}function a(e){return"x"in e&&"y"in e&&"z"in e}Object.defineProperty(t,"__esModule",{value:!0}),t.darken=t.toXYZ=t.toLCH=t.toLAB=t.toHSV=t.toRGB=void 0;var o=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],s=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function l(e,t){var n,r,i=[];if(e[0].length!==t.length)throw"dimensions do not match";var a=e.length,o=e[0].length,s=0;for(n=0;n<a;n++){for(s=0,r=0;r<o;r++)s+=e[n][r]*t[r];i.push(s)}return i}function c(e){var t=[e.r/255,e.g/255,e.b/255].map((function(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)})),n=l(o,t);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function u(e){var t=l(s,[e.x/100,e.y/100,e.z/100]).map((function(e){var t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function p(e){var t=[e.x/95.047,e.y/100,e.z/108.883].map((function(e){return e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29}));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function d(e){var t=e.l,n=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((function(e){return e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)}));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function h(e){return p(c(e))}function f(e){return u(d(e))}function v(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:i(e)?function(e){return u(d(function(e){var t=e.c,n=e.h;return{l:e.l,a:t*Math.cos(n),b:t*Math.sin(n)}}(e)))}(e):r(e)?f(e):a(e)?u(e):n(e)?function(e){var t,n=(e.h+360)%360/60,r=e.v/100*255,i=r*(e.s/100),a=i*(1-Math.abs(n%2-1));switch(Math.floor(n)){case 0:t={r:i,g:a,b:0};break;case 1:t={r:a,g:i,b:0};break;case 2:t={r:0,g:i,b:a};break;case 3:t={r:0,g:a,b:i};break;case 4:t={r:a,g:0,b:i};break;case 5:case 6:t={r:i,g:0,b:a};break;default:t={r:0,g:0,b:0}}return t.r=Math.round(t.r+r-i),t.g=Math.round(t.g+r-i),t.b=Math.round(t.b+r-i),t}(e):e}t.toRGB=v,t.toHSV=function(e){return n(e)?e:function(e){var t=e.r,n=e.g,r=e.b,i=Math.max(t,n,r),a=i-Math.min(t,n,r),o=i,s=0===a?0:i===t?(n-r)/a%6:i===n?(r-t)/a+2:(t-n)/a+4,l=0===a?0:a/o;return s<0&&(s+=6),{h:s*=60,s:l*=100,v:o*=100/255}}(v(e))},t.toLAB=function(e){return r(e)?e:h(v(e))},t.toLCH=function(e){return i(e)?e:function(e){return function(e){var t=e.l,n=e.a,r=e.b,i=Math.sqrt(n*n+r*r),a=Math.atan2(r,n);return{l:t,c:i,h:a=a>0?a:a+2*Math.PI}}(p(c(e)))}(v(e))},t.toXYZ=function(e){return a(e)?e:c(v(e))},t.darken=function(e,t){var n=h(e);return n.l*=1-t,f(n)}}).apply(null,r))||(e.exports=i)},Kvb2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("woUR")],void 0===(i=(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ManipulatorState=void 0;var i=function(){function e(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return e.prototype.update=function(e){var t=this;this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,i){if(0===i&&(t.zManipulator=e),e instanceof r.Manipulator3D&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),n.isNone(t.firstGrabbedXY)&&e.grabbing&&1===i&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=1,i){case 0:t.grabbingState|=2;break;case 1:t.grabbingState|=4}}))},e}();t.ManipulatorState=i}).apply(null,r))||(e.exports=i)},KwnQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("z4cv")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat2f64=void 0,t.mat2f64=n}).apply(null,r))||(e.exports=i)},LZD4:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("2B1V"),n("CIy2"),n("ILj8")],void 0===(i=(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultBufferWriter=t.PositionColorMapSpaceUVBoundsLayout=t.PositionColorMapSpaceUVLayout=t.PositionColorLayout=t.PositionUVLayout=t.PositionLayout=void 0,t.PositionLayout=n.newLayout().vec3f(r.VertexAttrConstants.POSITION),t.PositionUVLayout=n.newLayout().vec3f(r.VertexAttrConstants.POSITION).vec2f(r.VertexAttrConstants.UV0),t.PositionColorLayout=n.newLayout().vec3f(r.VertexAttrConstants.POSITION).vec4u8(r.VertexAttrConstants.COLOR),t.PositionColorMapSpaceUVLayout=n.newLayout().vec3f(r.VertexAttrConstants.POSITION).vec4u8(r.VertexAttrConstants.COLOR).vec4f(r.VertexAttrConstants.UVMAPSPACE).vec3f(r.VertexAttrConstants.MEANVERTEXPOSITION),t.PositionColorMapSpaceUVBoundsLayout=n.newLayout().vec3f(r.VertexAttrConstants.POSITION).vec4u8(r.VertexAttrConstants.COLOR).vec4f(r.VertexAttrConstants.UVMAPSPACE).vec3f(r.VertexAttrConstants.BOUND1).vec3f(r.VertexAttrConstants.BOUND2).vec3f(r.VertexAttrConstants.BOUND3);var a=function(){function e(e){this.vertexBufferLayout=e}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices[r.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,n,r){i.writeDefaultAttributes(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,r)},e}();t.DefaultBufferWriter=a}).apply(null,r))||(e.exports=i)},MCHn:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("0LE5"),n("Rdxj"),n("gxI5"),n("aWgr"),n("hX2R"),n("qSzK")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LaserlineVisualElement=void 0;var u=function(e){function t(t){var n=e.call(this,t.view)||this;return n._angleCutoff=c.defaultAngleCutoff,n._style={},n._heightManifoldTarget=a.vec3f64.create(),n._heightManifoldEnabled=!1,n._intersectsLine=s.lineSegment.create(),n._intersectsLineEnabled=!1,n._intersectsLineInfinite=!1,n._pathVerticalPlaneBuffers=null,n.applyProps(t),n}return n.__extends(t,e),t.prototype.createResources=function(){this.ensureRenderer()},t.prototype.destroyResources=function(){this.disposeRenderer()},t.prototype.updateVisibility=function(e){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane()},Object.defineProperty(t.prototype,"angleCutoff",{get:function(){return this._angleCutoff},set:function(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},set:function(e){this._style=e,this.syncStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"heightManifoldTarget",{get:function(){return this._heightManifoldEnabled?this._heightManifoldTarget:null},set:function(e){r.isSome(e)?(i.vec3.copy(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intersectsWorldUpAtLocation",{set:function(e){if(r.isNone(e))this.intersectsLine=null;else{var t=this.view.renderCoordsHelper.worldUpAtPosition(e,p);this.intersectsLine=s.lineSegment.fromValues(e,t),this.intersectsLineInfinite=!0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intersectsLine",{get:function(){return this._intersectsLineEnabled?this._intersectsLine:null},set:function(e){r.isSome(e)?(s.lineSegment.copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intersectsLineInfinite",{get:function(){return this._intersectsLineInfinite},set:function(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pathVerticalPlane",{get:function(){return this._pathVerticalPlaneBuffers},set:function(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncRenderer()},enumerable:!1,configurable:!0}),t.prototype.syncRenderer=function(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||r.isSome(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()},t.prototype.ensureRenderer=function(){r.isSome(this.renderer)||(this.renderer=new l.LaserLineRenderer(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))},t.prototype.syncStyle=function(){r.isNone(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))},t.prototype.syncAngleCutoff=function(){r.isNone(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})},t.prototype.syncHeightManifold=function(){r.isNone(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))},t.prototype.syncIntersectsLine=function(){r.isNone(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))},t.prototype.syncIntersectsLineInfinite=function(){r.isNone(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)},t.prototype.syncPathVerticalPlane=function(){r.isNone(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=r.isSome(this._pathVerticalPlaneBuffers)&&this.visible,r.isSome(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))},t.prototype.disposeRenderer=function(){r.isSome(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)},t}(o.VisualElement);t.LaserlineVisualElement=u;var p=a.vec3f64.create()}).apply(null,r))||(e.exports=i)},"N+ip":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("DJpR"),n("Kfys")],void 0===(i=(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OverlayRenderTarget=void 0;var i=function(){function e(e,t,r,i){this._renderTarget=null,this.id=t+"_"+ ++r,this._renderTarget=new n.FramebufferObject(e,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}return e.prototype.dispose=function(){this._renderTarget.dispose(),this._renderTarget=null},e.prototype.getTexture=function(){return this._renderTarget?this._renderTarget.colorTexture:null},e.prototype.isValid=function(){return null!==this._renderTarget},e.prototype.resize=function(e,t){this._renderTarget.resize(e,t)},e.prototype.bind=function(e){e.bindFramebuffer(this._renderTarget)},e.prototype.generateMipMap=function(){this._renderTarget.colorTexture.descriptor.hasMipmap&&this._renderTarget.colorTexture.generateMipmap()},e.prototype.disposeRenderTargetMemory=function(){this._renderTarget&&this._renderTarget.resize(0,0)},e.prototype.getGpuMemoryUsage=function(){var e=0;return this._renderTarget&&(e+=r.getGpuMemoryUsage(this._renderTarget)),e},e}();t.OverlayRenderTarget=i}).apply(null,r))||(e.exports=i)},N78w:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("Gtr7"),n("BcWh"),n("qsST"),n("LxLY"),n("jBNx"),n("Vx27"),n("W9tT"),n("0LE5"),n("Rdxj"),n("vtMp"),n("DtIM"),n("dXKx"),n("5ldw"),n("NbdF")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicManipulator=void 0;var g=a.getLogger("esri.views.interactive.GraphicManipulator"),y=function(e){function t(t){var n=e.call(this,t)||this;return n.layer=null,n.interactive=!0,n.selectable=!1,n.grabbable=!0,n.dragging=!1,n.cursor=null,n.events=new i.EventEmitter,n._circleCollisionCache=null,n._graphicSymbolChangedHandle=null,n._originalSymbol=null,n}return n.__extends(t,e),Object.defineProperty(t.prototype,"graphic",{set:function(e){"mesh"!==o.get(e.geometry,"type")?(this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()):g.error("Mesh geometries are not supported")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"elevationInfo",{get:function(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=h.getGraphicEffectiveElevationMode(this.graphic);return new v({mode:t,offset:e?e.offset:0})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusedSymbol",{set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grabbing",{set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hovering",{set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selected",{set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)},t.prototype.intersectionDistance=function(e){var t=this._get("graphic");if(!1===t.visible)return null;var n=this._get("focusedSymbol"),r=o.isSome(n)?n:t.symbol,i=t.geometry;if(o.isNone(i))return null;var a=this._get("view");return"2d"===a.type?this._intersectDistance2D(e,a,i,r):this._intersectDistance3D(e,a,t)},t.prototype.attach=function(){this.attachSymbolChanged(),o.isSome(this.layer)&&this.layer.add(this.graphic)},t.prototype.detach=function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),o.isSome(this.layer)&&this.layer.remove(this.graphic)},t.prototype.attachSymbolChanged=function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(function(t){o.isSome(t)&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&o.isSome(e.focusedSymbol)&&(e.graphic.symbol=e.focusedSymbol))}),!0)},t.prototype.detachSymbolChanged=function(){o.isSome(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)},t.prototype._updateGraphicSymbol=function(){this.graphic.symbol=this._focused&&o.isSome(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol},t.prototype._resetGraphicSymbol=function(){this.graphic.symbol=this._originalSymbol},t.prototype._intersectDistance2D=function(e,t,n,r){if(r=r||f.getDefaultSymbol2D(n),o.isNone(r))return null;var i=this._circleCollisionCache;if("point"!==n.type||"simple-marker"!==r.type){var a=m.intersectsDrapedGeometry(e,n,t);return o.isSome(a)?1:null}if(o.isNone(i)||!i.originalPoint.equals(n)){var l=n,u=t.spatialReference;d.canProject(l,u)&&(a=d.project(l,u),i={originalPoint:l.clone(),mapPoint:a,radiusPx:s.pt2px(r.size)},this._circleCollisionCache=i)}if(o.isSome(i)){var p=s.screenPointObjectToArray(e,b),h=t.state.toScreen(x,i.mapPoint.x,i.mapPoint.y),v=i.radiusPx;return c.vec2.squaredDistance(p,h)<v*v?1:null}return null},t.prototype._intersectDistance3D=function(e,t,n){var r=t.toMap(e,{include:[n]});if(!r)return null;var i=_;return t.renderCoordsHelper.toRenderCoords(r,i)?u.vec3.distance(i,t.state.camera.eye):null},n.__decorate([l.property({constructOnly:!0,nonNullable:!0})],t.prototype,"graphic",null),n.__decorate([l.property({readOnly:!0,dependsOn:["graphic"]})],t.prototype,"elevationInfo",null),n.__decorate([l.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n.__decorate([l.property({value:null})],t.prototype,"focusedSymbol",null),n.__decorate([l.property({constructOnly:!0})],t.prototype,"layer",void 0),n.__decorate([l.property()],t.prototype,"interactive",void 0),n.__decorate([l.property()],t.prototype,"selectable",void 0),n.__decorate([l.property()],t.prototype,"grabbable",void 0),n.__decorate([l.property({value:!1})],t.prototype,"grabbing",null),n.__decorate([l.property()],t.prototype,"dragging",void 0),n.__decorate([l.property()],t.prototype,"hovering",null),n.__decorate([l.property({value:!1})],t.prototype,"selected",null),n.__decorate([l.property()],t.prototype,"cursor",void 0),n.__decorate([l.subclass("esri.views.interactive.GraphicManipulator")],t)}(r);t.GraphicManipulator=y;var _=p.vec3f64.create(),b=s.createScreenPointArray(),x=s.createScreenPointArray()}).apply(null,r))||(e.exports=i)},NbdF:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("TMur"),n("LxLY"),n("8uEs"),n("/E+R")],void 0===(i=(function(e,t,n,r,i,a){"use strict";function o(e,t,r,a){var o;if(void 0===a&&(a=new n.Extent),"2d"===r.type)o=t*r.resolution;else if("3d"===r.type){var s=r.basemapTerrain,l=s.overlayManager,c=l?l.overlayPixelSizeInMapUnits(e):1;o=s&&!s.spatialReference.equals(r.spatialReference)?i.getMetersPerUnitForSR(s.spatialReference)/i.getMetersPerUnitForSR(r.spatialReference):t*c}var u=e.x-o,p=e.y-o,d=e.x+o,h=e.y+o,f=r.spatialReference;return a.xmin=Math.min(u,d),a.ymin=Math.min(p,h),a.xmax=Math.max(u,d),a.ymax=Math.max(p,h),a.spatialReference=f,a}Object.defineProperty(t,"__esModule",{value:!0}),t.intersectsDrapedGeometry=t.createQueryGeometry=void 0,t.createQueryGeometry=o,t.intersectsDrapedGeometry=function(e,t,n){var i=n.toMap(e);return r.isNone(i)?null:o(i,a.calculateTolerance(),n,s).intersects(t)?i:null};var s=new n.Extent}).apply(null,r))||(e.exports=i)},NiJV:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("3kdR"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o){"use strict";var s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.build=void 0,t.build=function(e){var t=new o.ShaderBuilder;return t.include(i.Transform,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("viewNormal","mat4"),t.fragment.uniforms.add("color","vec4").add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("position","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewNormal","vec3"),t.varyings.add("vViewDirection","vec3"),t.vertex.code.add(a.glsl(s||(s=n.__makeTemplateObject(["\n    void main(void) {\n      vWorldPosition = position;\n\n      vec3 worldNormal = normal;\n      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;\n\n      gl_Position = transformPosition(proj, view, vWorldPosition);\n    }\n  "],["\n    void main(void) {\n      vWorldPosition = position;\n\n      vec3 worldNormal = normal;\n      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;\n\n      gl_Position = transformPosition(proj, view, vWorldPosition);\n    }\n  "])))),t.include(r.Slice,e),t.fragment.code.add(a.glsl(l||(l=n.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vWorldPosition);\n\n      vec3 viewNormalNorm = normalize(vViewNormal);\n\n      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\n      vec4 colorWithShading = mix(color, shadedColor, shadingFactor);\n\n      gl_FragColor = highlightSlice(colorWithShading, vWorldPosition);\n    }\n    "],["\n    void main() {\n      discardBySlice(vWorldPosition);\n\n      vec3 viewNormalNorm = normalize(vViewNormal);\n\n      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\n      vec4 colorWithShading = mix(color, shadedColor, shadingFactor);\n\n      gl_FragColor = highlightSlice(colorWithShading, vWorldPosition);\n    }\n    "])))),t}}).apply(null,r))||(e.exports=i)},PLh7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XwIv"),n("xoE+"),n("LxLY"),n("0LE5"),n("Rdxj"),n("DtIM"),n("woUR"),n("Kvb2"),n("X5J5"),n("MCHn"),n("PXiz"),n("R4nD"),n("/NuL")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f){"use strict";function v(e){return i.isSome(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=void 0,t.createVisualElements=function(e){var t=e.view,o=e.graphic,g=new f.GraphicState({graphic:o}),y=[],_=function(e,t,r){var i=e.graphic,a=new h.OutlineVisualElement({view:e.view,geometry:v(i)?i.geometry:null,elevationInfo:s.getGraphicEffectiveElevationInfo(i),attached:!1});u.settings.visualElements.lineGraphics.shadowStyle.apply(a);var o=function(){a.attached=t.displaying};return u.settings.visualElements.lineGraphics.outline.apply(a),r.push(t.watch("displaying",o),t.watch("isDraped",(function(e){return a.isDraped=e})),t.on("changed",(function(){return a.geometry=v(i)?i.geometry:null})),n.destroyHandle(a)),o(),a}(e,g,y);return function(e,t,o,h){var f=e.graphic,g=e.view,y=s.getGraphicEffectiveElevationInfo(f),_="on-the-ground"===y.mode||!y.offset&&"absolute-height"!==y.mode,b=new c.ManipulatorState,x=new d.LineVisualElement({view:g,infinite:u.settings.visualElements.zVerticalLine.infiniteType,attached:!1});u.settings.visualElements.pointGraphics.shadowStyle.apply(x);var w=r.deg2rad(u.settings.visualElements.heightPlaneAngleCutoff),S=new p.LaserlineVisualElement({view:g,attached:!1,angleCutoff:w});u.settings.visualElements.heightPlane.apply(S);var O=1,P=1,M=function(){if(b.update(e),!o.displaying||_&&(o.isDraped||!v(f)||!f.geometry.hasZ))return t.laserlineEnabled=!1,x.attached=!1,void(S.attached=!1);t.laserlineEnabled=!0;var n=4&b.grabbingState?u.settings.visualElements.laserlineAlphaMultiplier:1;n!==O&&(O=n,u.settings.visualElements.lineGraphics.shadowStyle.apply(t,n),u.settings.visualElements.pointGraphics.shadowStyle.apply(x,n));var r=2&b.grabbingState?u.settings.visualElements.laserlineAlphaMultiplier:1;r!==P&&(P=r,u.settings.visualElements.heightPlane.apply(S,r)),function(e,t){var n=1===t.numSelected?t.firstSelected:t.numSelected>1&&i.isSome(t.firstGrabbedXY)?t.firstGrabbedXY:null;i.isSome(n)?(u.settings.visualElements.zVerticalLine.infinite&&(e.worldDownAtLocation=n.renderLocation),e.attached=!0):e.attached=!1}(x,b),function(e,t,n,r){if(r.numSelected>0){a.vec3.set(m,0,0,0);var o=0;e.forEachManipulator((function(e,t){1===t&&e.selected&&e instanceof l.Manipulator3D&&(a.vec3.add(m,m,e.renderLocation),o++)})),o>0?(n.heightManifoldTarget=a.vec3.scale(m,m,1/o),n.attached=!0):n.attached=!1}else{var s=t.attachmentOrigin;i.isSome(s)&&e.view.renderCoordsHelper.toRenderCoords(s,m)?(n.heightManifoldTarget=m,n.attached=!0):n.attached=!1}}(e,t,S,b)};u.settings.visualElements.zVerticalLine.apply(x),h.push(o.on("changed",M),o.watch("displaying",M),t.events.on("attachment-origin-changed",M),n.destroyHandle(x),n.destroyHandle(S));var C=[],D=function(){n.handlesGroup(C).remove(),C.length=0,e.forEachManipulator((function(e){return C.push(e.events.on("grab-changed",M))})),e.forEachManipulator((function(e){return C.push(e.events.on("select-changed",M))})),M()};D(),h.push(e.onManipulatorsChanged(D),n.refHandle((function(){return n.handlesGroup(C)})))}(e,_,g,y),y.push(t.maskOccludee(o)),y.push(t.trackGraphicState(g)),{visualElement:_,remove:function(){n.handlesGroup(y).remove()}}};var m=o.vec3f64.create()}).apply(null,r))||(e.exports=i)},PXiz:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("j2SP"),n("MCHn"),n("2W+Z"),n("aWgr"),n("fXZm"),n("ys4y"),n("4ziW"),n("RC9r"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineVisualElement=void 0;var m=function(){function e(e){var t=this;this.view=null,this._ray=u.ray.create(),this._isWorldDown=!1,this._start=a.vec3f64.create(),this._end=a.vec3f64.fromValues(1,0,0),this._width=1,this._color=s.vec4f32.fromValues(1,0,1,1),this._innerWidth=1,this._innerColor=s.vec4f32.fromValues(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._infinite=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._occludedMode=4,this.resources=new c.VisualElementResources({view:e.view,cameraChanged:function(){return t.updateGeometry()},createResources:function(e){return t.createResources(e)}}),this._laserline=new l.LaserlineVisualElement({view:e.view});var n=!0;for(var r in e)r in this?"attached"===r?n=e[r]:this[r]=e[r]:console.error("Cannot set unknown property",r);this.attached=n}return e.prototype.destroy=function(){this.resources.destroy(),this._laserline.destroy()},Object.defineProperty(e.prototype,"laserlineAttached",{get:function(){return this.attached&&!this.hidden&&this._laserlineEnabled&&n.isSome(this._laserlineStyle)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e,this._laserline.attached=this.laserlineAttached},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached},set:function(e){this.resources.attached=e,this._laserline.attached=this.laserlineAttached},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldDownAtLocation",{set:function(e){this._isWorldDown=!0,i.vec3.copy(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),i.vec3.subtract(this._end,e,this._end),u.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"start",{get:function(){return this._start},set:function(e){this._isWorldDown=!1,i.vec3.exactEquals(this._start,e)||(i.vec3.copy(this._start,e),u.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},set:function(e){this._isWorldDown=!1,i.vec3.exactEquals(this._end,e)||(i.vec3.copy(this._end,e),u.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){o.vec4.exactEquals(e,this._color)||(o.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerWidth",{get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerColor",{get:function(){return this._innerColor},set:function(e){o.vec4.exactEquals(e,this._innerColor)||(o.vec4.copy(this._innerColor,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stipplePattern",{get:function(){return this._stipplePattern},set:function(e){var t=n.isSome(e)!==n.isSome(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stippleOffColor",{get:function(){return this._stippleOffColor},set:function(e){(n.isNone(e)||n.isNone(this._stippleOffColor)||!o.vec4.exactEquals(e,this._stippleOffColor))&&(this._stippleOffColor=n.isSome(e)?s.vec4f32.clone(e):null,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"falloff",{get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"infinite",{get:function(){return this._infinite},set:function(e){e!==this._infinite&&(this._infinite=e,this.updateGeometry())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"laserlineStyle",{get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,n.isSome(e)&&(this._laserline.style=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"laserlineEnabled",{get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(e){e!==this._occludedMode&&(this._occludedMode=e,n.isSome(this.resources.resources)&&(this.resources.resources.material.renderOccluded=e))},enumerable:!1,configurable:!0}),e.prototype.updateMaterial=function(){var e=this.resources.resources;n.isNone(e)||e.material.setParameterValues(this.materialParameters)},Object.defineProperty(e.prototype,"materialParameters",{get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff}},enumerable:!1,configurable:!0}),e.prototype.updateGeometry=function(){var e=this.resources.object;n.isNone(e)||this.updateVertices(e)},e.prototype.updateVertices=function(e){if(this._infinite){var t=this.view.state.camera;switch(p.fromRay(this._ray,g),this._infinite){case 2:g.c0=-Number.MAX_VALUE;break;case 1:case 3:var n=this._ray.origin,r=this.view.elevationProvider.getElevation(n[0],n[1],n[2],this.view.renderCoordsHelper.spatialReference,"ground"),a=this.view.renderCoordsHelper.getAltitude(n);this._isWorldDown&&a<r&&i.vec3.negate(g.ray.direction,g.ray.direction),3===this._infinite&&null!=r&&(g.c1=Math.abs(a-r))}if(!u.frustum.intersectClipRay(t.frustum.planes,g))return void this.updateVertexAttributes(e,this._start,this._end);var o=p.getStart(g,y),s=p.getEnd(g,_);this.updateVertexAttributes(e,o,s),this._laserline.intersectsLine=u.lineSegment.fromPoints(o,s,b)}else this.updateVertexAttributes(e,this._start,this._end),this._laserline.intersectsLine=u.lineSegment.fromPoints(this._start,this._end,b)},e.prototype.updateVertexAttributes=function(e,t,n){var r=e.geometryRecords[0].geometry.data.getVertexAttr()[v.RibbonVertexAttributeConstants.POSITION].data;r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=n[0],r[4]=n[1],r[5]=n[2],e.geometryVertexAttrsUpdated(0)},e.prototype.createResources=function(e){var t=[a.vec3f64.create(),a.vec3f64.create()],n=new d(h.createPolylineGeometry(t),"lineVisualElement"),i=new f(this.materialParameters,"lineVisualElement");return i.renderOccluded=this._occludedMode,e.addGeometry(n,i,r.mat4f64.IDENTITY),this.updateVertices(e),{material:i,geometry:n,forEach:function(e){return e(i),e(n)}}},e}();t.LineVisualElement=m;var g=p.create(),y=a.vec3f64.create(),_=a.vec3f64.create(),b=u.lineSegment.create()}).apply(null,r))||(e.exports=i)},Px2u:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("Gtr7"),n("R2Zq"),n("LxLY"),n("KBgh"),n("Vx27"),n("FNtW"),n("znI2"),n("ZeO9")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SortedRenderGeometryRenderer=void 0;var p=function(){},d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._pendingAddsRemoves=new Map,t._adds=new o,t._removes=new o,t._updates=new o({allocator:function(e){return e||new p},deallocator:function(e){return e.renderGeometry=null,e}}),t._materialRenderers=new Map,t._sortedMaterialRenderers=new o,t._hasHighlights=!1,t._hasWater=!1,t}return n.__extends(t,e),t.prototype.dispose=function(){this._adds.prune(),this._removes.prune(),this._updates.prune(),this._materialRenderers&&(this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear())},Object.defineProperty(t.prototype,"updating",{get:function(){return this._pendingAddsRemoves.size>0||this._updates.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendersOccluded",{get:function(){return i.someMap(this._materialRenderers,(function(e){return e.rendersOccluded}))},enumerable:!1,configurable:!0}),t.prototype.stopAnimationsAtTime=function(e){this._sortedMaterialRenderers.forEachSimple((function(t){return a.applySome(t.material.animation,(function(t){return t.stopAtTime(e)}))}))},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!this.updating&&0===this._materialRenderers.size},enumerable:!1,configurable:!0}),t.prototype.commitChanges=function(){var e=this,t=!1;if(!this.updating)return!1;this.updateAddsRemoves();var n=c.splitRenderGeometryChangeSetByMaterial({numToAdd:this._adds.length,toAdd:this._adds.data,numToRemove:this._removes.length,toRemove:this._removes.data,numToUpdate:this._updates.length,toUpdate:this._updates.data}),r=!1,a=!1;return n.forEach((function(n,i){var o=e._materialRenderers.get(i);if(!o&&n.toAdd.length>0&&(o=new u(e.rctx,e.materialRepository,i),e._materialRenderers.set(i,o),t=!0,r=!0,a=!0),o){var s=r||o.hasHighlights,l=a||o.hasWater;o.modify(n),r=r||s!==o.hasHighlights,a=a||l!==o.hasWater,o.isEmpty&&(e._materialRenderers.delete(i),o.dispose(),t=!0)}})),this._adds.clear(),this._removes.clear(),this._updates.clear(),this._pendingAddsRemoves.clear(),t&&this.updateSortedMaterialRenderers(),r&&(this._hasHighlights=i.someMap(this._materialRenderers,(function(e){return e.hasHighlights}))),a&&(this._hasWater=i.someMap(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0},t.prototype.add=function(e){for(var t=0===this._pendingAddsRemoves.size,n=0,r=e;n<r.length;n++)this._pendingAddsRemoves.set(r[n],0);t&&this._pendingAddsRemoves.size>0&&this.notifyChange("updating")},t.prototype.remove=function(e){for(var t=0===this._pendingAddsRemoves.size,n=0,r=e;n<r.length;n++){var i=r[n],a=this._pendingAddsRemoves.get(i);0===a?this._pendingAddsRemoves.set(i,2):2!==a&&this._pendingAddsRemoves.set(i,1)}t&&this._pendingAddsRemoves.size>0&&this.notifyChange("updating")},t.prototype.modify=function(e,t){for(var n=0===this._updates.length,r=0,i=e;r<i.length;r++){var a=i[r],o=this._updates.pushNew();o.renderGeometry=a,o.updateType=t}n&&this._updates.length>0&&this.notifyChange("updating")},t.prototype.updateLogic=function(e){for(var t=!1,n=0;n<this._sortedMaterialRenderers.length;n++){var r=this._sortedMaterialRenderers.data[n].materialRenderer;r.updateLogic&&r.updateLogic(e)&&(t=!0)}return t},t.prototype.draw=function(e,t,n){for(var r=0;r<this._sortedMaterialRenderers.length;r++){var i=this._sortedMaterialRenderers.data[r];if(l.materialPredicate(i.material,e)){var a=n.getMaterialRenderStatsObject(i.materialRenderer.type);i.materialRenderer.render(null,e,t,a)}}},t.prototype.updateSortedMaterialRenderers=function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(n,r){r.insertOrder=t++,e._sortedMaterialRenderers.push({material:r,materialRenderer:n})})),this._sortedMaterialRenderers.sort((function(e,t){var n=t.material.renderPriority-e.material.renderPriority;return 0!==n?n:e.material.insertOrder-t.material.insertOrder}))},t.prototype.updateAddsRemoves=function(){var e=this;this._adds.clear(),this._removes.clear(),this._pendingAddsRemoves.forEach((function(t,n){switch(t){case 0:e._adds.push(n);break;case 1:e._removes.push(n)}}));for(var t=0;t<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[t].renderGeometry)?this._updates.removeUnorderedIndex(t):t++},Object.defineProperty(t.prototype,"test",{get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}},enumerable:!1,configurable:!0}),n.__decorate([s.property()],t.prototype,"rctx",void 0),n.__decorate([s.property()],t.prototype,"materialRepository",void 0),n.__decorate([s.property()],t.prototype,"updating",null),n.__decorate([s.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],t)}(r);t.SortedRenderGeometryRenderer=d}).apply(null,r))||(e.exports=i)},QDiq:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("0LE5"),n("Rdxj"),n("2Mej")],void 0===(i=(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SceneLighting=void 0;var a=r.vec3f64.create(),o=function(){function e(){this._renderLighting={main:{intensity:r.vec3f64.create(),direction:r.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldSunlight={direction:r.vec3f64.create(),ambient:{color:r.vec3f64.create(),intensity:0},diffuse:{color:r.vec3f64.create(),intensity:0}}}return e.prototype.setLightDirectionUniform=function(e){e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)},e.prototype.setUniforms=function(e,t){void 0===t&&(t=!1),e.setUniform1f("lightingFixedFactor",t?(1-this._info.groundLightingFactor)*(1-this._info.globalFactor):0),e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var n=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),e.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),e.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]),e.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),e.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),e.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),e.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),e.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),e.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8]))},e.prototype.set=function(e){this._info=e,i.combineLights(e.lights,this._shOrder,this._renderLighting),n.vec3.negate(this._oldSunlight.direction,this._renderLighting.main.direction);var t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldSunlight.ambient.intensity=1,this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*t,this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*t,this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*t,this._oldSunlight.diffuse.intensity=1;var r=n.vec3.copy(a,this._oldSunlight.diffuse.color);n.vec3.scale(r,r,.4*this._info.globalFactor),n.vec3.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,r)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"old",{get:function(){return this._oldSunlight},enumerable:!1,configurable:!0}),e}();t.SceneLighting=o}).apply(null,r))||(e.exports=i)},R4nD:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("BcWh"),n("LxLY"),n("0LE5"),n("Rdxj"),n("2fXB"),n("j2SP"),n("WRgd"),n("ZcgO"),n("as1Q"),n("MCHn"),n("2W+Z"),n("fOZq"),n("hADE"),n("mmEe"),n("ys4y"),n("+nCE"),n("cjy9"),n("RC9r"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlineVisualElement=void 0;var x=function(){function e(e){var t=this;this.view=null,this._attachmentOrigin=c.makeDehydratedPoint(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new n,this._isDraped=!1,this._geometry=null,this._width=1,this._color=s.vec4f32.fromValues(1,0,1,1),this._innerWidth=1,this._innerColor=s.vec4f32.fromValues(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._occludedMode=8,this.resources=new d.VisualElementResources({view:e.view,createResources:function(e){return t.createResources(e)},recreateGeometry:function(e,n){return e.geometries.length=0,t.recreateGeometry(n,e.material,e.geometries),e.geometries}}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new u.DrapedVisualElementResources({view:e.view,createResources:function(){return t.createDrapedResources()},recreateGeometry:function(e){e.geometries=t.createRenderGeometriesDraped(e.material),t.attachmentOriginChanged()}});var r=!0;for(var i in this._laserline=new p.LaserlineVisualElement({view:e.view}),e)i in this?"attached"===i?r=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=r}return e.prototype.destroy=function(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()},Object.defineProperty(e.prototype,"isDraped",{get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"laserlineAttached",{get:function(){return this.attached&&!this.hidden&&r.isSome(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e,this.drapedResources.hidden=e,this._laserline.attached=this.laserlineAttached},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this.updateAttached(e)},enumerable:!1,configurable:!0}),e.prototype.updateAttached=function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()},Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){o.vec4.exactEquals(e,this._color)||(o.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerWidth",{get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerColor",{get:function(){return this._innerColor},set:function(e){o.vec4.exactEquals(e,this._innerColor)||(o.vec4.copy(this._innerColor,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stipplePattern",{get:function(){return this._stipplePattern},set:function(e){var t=r.isSome(e)!==r.isSome(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stippleOffColor",{get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&o.vec4.exactEquals(e,this._stippleOffColor)||(this._stippleOffColor=e?s.vec4f32.clone(e):null,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"falloff",{get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"laserlineStyle",{get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,r.isSome(e)&&(this._laserline.style=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"laserlineEnabled",{get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(e){e!==this._occludedMode&&(this._occludedMode=e,r.isSome(this.resources.resources)&&(this.resources.resources.material.renderOccluded=e),r.isSome(this.drapedResources.resources)&&(this.drapedResources.resources.material.renderOccluded=e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attachmentOrigin",{get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=r.isSome(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;i.vec3.set(O,0,0,0);for(var t=b.RibbonVertexAttributeConstants.POSITION,n=0,a=0,o=e;a<o.length;a++){var s=o[a],l=s.getAttribute(t),c=s.getIndices(t),u=r.unwrap(this.resources.resources).material.isClosed(l.data,c);g.computeAttachmentOriginLines(l,c,u,S)&&(i.vec3.add(O,O,S),n++)}return 0===n?null:(i.vec3.scale(O,O,1/n),this.view.renderCoordsHelper.fromRenderCoords(O,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)},enumerable:!1,configurable:!0}),e.prototype.updateMaterial=function(){r.isSome(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),r.isSome(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)},Object.defineProperty(e.prototype,"isClosed",{get:function(){return r.isSome(this.geometry)&&"polygon"===this.geometry.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"materialParameters",{get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0}},enumerable:!1,configurable:!0}),e.prototype.recreateGeometry=function(e,t,n){for(var r=0,i=this.createRenderGeometries();r<i.length;r++){var a=i[r];e.addGeometry(a,t),n.push(a)}this.attachmentOriginChanged()},e.prototype.attachmentOriginChanged=function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")},e.prototype.createResources=function(e){var t=new _(this.materialParameters,"lineVisualElement");t.renderOccluded=8;var n=[];return this.recreateGeometry(e,t,n),{material:t,geometries:n,forEach:function(e){e(t),n.forEach(e)}}},e.prototype.createDrapedResources=function(){var e=new _(this.materialParameters,"lineVisualElement");return e.renderOccluded=4,{material:e,geometries:this.createRenderGeometriesDraped(e)}},e.prototype.createRenderGeometriesDraped=function(e){var t=this.geometry;if(r.isNone(t))return[];for(var n=[],a=0,o=f.geometryToRenderInfoDraped(t,this.view.basemapTerrain.spatialReference).lines;a<o.length;a++){var s=o[a].position,c=new y(f.createGeometryData({attributeData:{position:s},removeDuplicateStartEnd:this.isClosed?1:0}));c.material=e;var u=l.empty(w);l.expandWithBuffer(u,s),i.vec3.set(c.center,.5*(u[0]+u[3]),.5*(u[1]+u[4]),0),c.bsRadius=.5*Math.sqrt((u[3]-u[0])*(u[3]-u[0])+(u[4]-u[1])*(u[4]-u[1])),n.push(c)}return n},e.prototype.calculateMapBounds=function(e){if(r.isNone(this.resources.resources))return!1;for(var t=this.view.renderCoordsHelper,n=0,i=this.resources.resources.geometries;n<i.length;n++){var a=i[n].data.getAttribute("position"),o=a.data,s=new Float64Array(o.length);v.bufferToBuffer(a.data,t.spatialReference,0,s,this.view.spatialReference,0,o.length/3),l.expandWithBuffer(e,s)}return!0},e.prototype.createRenderGeometries=function(){var e=this.geometry;if(r.isNone(e))return[];for(var t=[],n=[],i=0,a=f.geometryToRenderInfo(e,this.view.elevationProvider,this.view.renderCoordsHelper,h.ElevationContext.fromElevationInfo(this.elevationInfo)).lines;i<a.length;i++){var o=a[i],s=o.position,l=f.createGeometryData({attributeData:{position:s,mapPosition:o.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0});t.push(new m(l,"geometryOutlineVisualElement")),n.push(s)}return this._laserline.pathVerticalPlane=n,t},e}();t.OutlineVisualElement=x;var w=l.create(),S=a.vec3f64.create(),O=a.vec3f64.create()}).apply(null,r))||(e.exports=i)},RC9r:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("qsST"),n("xoE+"),n("LxLY"),n("jBNx"),n("W9tT"),n("0LE5"),n("Rdxj"),n("aWgr"),n("2B1V"),n("+nCE"),n("tUyH"),n("FNtW"),n("CIy2"),n("ama6"),n("s6rJ"),n("PwS/"),n("SNs2"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b){"use strict";var x=r.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),w=function(e){function t(t,n){var r=e.call(this,n)||this;return r._vertexAttributeLocations=b.ribbonVertexAttributeLocations,r.techniqueConfig=new b.RibbonLineTechniqueConfiguration,r.params=g.copyParameters(t,O),r.validateParams(),r.params.transparent=r.params.color[3]<1||r.params.transparent,r.layout=r.createLayout(),r}return n.__extends(t,e),t.prototype.isClosed=function(e,t){return D(this.params,e,t)},t.prototype.dispose=function(){},t.prototype.setParameterValues=function(e){for(var t in e)if("cap"!==t){if("join"===t&&"round"===this.params[t]!=("round"===e[t])){x.error("join cannot be changed after creation");continue}if("stipplePattern"===t&&!!this.params[t]!=!!e[t]){x.error("stippledness cannot be changed after creation");continue}this.params[t]=e[t]}else x.error("cap cannot be changed after creation");this.validateParams(),this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getPassParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){this.techniqueConfig.output=e;var t=a.isSome(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.stippleOffColorEnabled=t&&a.isSome(this.params.stippleOffColor),this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.params.join,this.techniqueConfig.roundCaps="round"===this.params.cap,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.params.innerWidth>0&&a.isSome(this.params.innerColor),this.techniqueConfig.falloffEnabled=this.params.falloff>0,this.techniqueConfig.occluder=8===this.renderOccluded,this.techniqueConfig},t.prototype.intersect=function(e,t,n,r,i,a,o,s,l){l?this.intersectDrapedLineGeometry(e,r,a,o):this.intersectLineGeometry(e,t,n,r,this.params.width,o)},t.prototype.intersectDrapedLineGeometry=function(e,t,n,r){if(t.options.selectionMode){var a=e.getAttribute(b.RibbonVertexAttributeConstants.POSITION).data,o=e.getAttribute(b.RibbonVertexAttributeConstants.SIZE),s=this.params.width;if(this.params.vvSizeEnabled){var l=e.getAttribute(b.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE).data[0];s*=i.clamp(this.params.vvSizeOffset[0]+l*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else o&&(s*=o.data[0]);for(var c=n[0],u=n[1],p=(s/2+4)*e.screenToWorldRatio,d=Number.MAX_VALUE,h=0;h<a.length-5;h+=3){var f=a[h],v=a[h+1],m=c-f,g=u-v,y=a[h+3]-f,_=a[h+4]-v,x=i.clamp((y*m+_*g)/(y*y+_*_),0,1),w=y*x-m,S=_*x-g,O=w*w+S*S;O<d&&(d=O)}d<p*p&&r()}},t.prototype.intersectLineGeometry=function(e,t,n,r,a,o){if(r.options.selectionMode&&!y.isInstanceHidden(t))if(v.isTranslationMatrix(n)){var c=e.data,p=c.getVertexAttr(),d=p[b.RibbonVertexAttributeConstants.POSITION].data,h=a;this.params.vvSizeEnabled?h*=i.clamp(this.params.vvSizeOffset[0]+p[b.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0]):p[b.RibbonVertexAttributeConstants.SIZE]&&(h*=p[b.RibbonVertexAttributeConstants.SIZE].data[0]);var f=r.camera,m=V;s.vec2.copy(m,r.point);var g=h*f.pixelRatio/2+4*f.pixelRatio;l.vec3.set(W[0],m[0]-g,m[1]+g,0),l.vec3.set(W[1],m[0]+g,m[1]+g,0),l.vec3.set(W[2],m[0]+g,m[1]-g,0),l.vec3.set(W[3],m[0]-g,m[1]-g,0);for(var _=0;_<4;_++)f.unprojectPoint(W[_],B[_]);u.plane.fromPoints(f.eye,B[0],B[1],Z),u.plane.fromPoints(f.eye,B[1],B[2],X),u.plane.fromPoints(f.eye,B[2],B[3],Y),u.plane.fromPoints(f.eye,B[3],B[0],J);var w=Number.MAX_VALUE,S=C(this.params,p,c.indices)?d.length-2:d.length-5;for(_=0;_<S;_+=3){E[0]=d[_]+n[12],E[1]=d[_+1]+n[13],E[2]=d[_+2]+n[14];var O=(_+3)%d.length;if(T[0]=d[O]+n[12],T[1]=d[O+1]+n[13],T[2]=d[O+2]+n[14],!(u.plane.signedDistance(Z,E)<0&&u.plane.signedDistance(Z,T)<0||u.plane.signedDistance(X,E)<0&&u.plane.signedDistance(X,T)<0||u.plane.signedDistance(Y,E)<0&&u.plane.signedDistance(Y,T)<0||u.plane.signedDistance(J,E)<0&&u.plane.signedDistance(J,T)<0)){if(f.projectPoint(E,L),f.projectPoint(T,z),L[2]<0&&z[2]>0){l.vec3.subtract(j,E,T);var P=f.frustum,M=-u.plane.signedDistance(P.planes[4],E)/l.vec3.dot(j,u.plane.normal(P.planes[4]));l.vec3.scale(j,j,M),l.vec3.add(E,E,j),f.projectPoint(E,L)}else if(L[2]>0&&z[2]<0)l.vec3.subtract(j,T,E),M=-u.plane.signedDistance((P=f.frustum).planes[4],T)/l.vec3.dot(j,u.plane.normal(P.planes[4])),l.vec3.scale(j,j,M),l.vec3.add(T,T,j),f.projectPoint(T,z);else if(L[2]<0&&z[2]<0)continue;L[2]=0,z[2]=0;var D=u.lineSegment.distance2(u.lineSegment.fromPoints(L,z,G),m);D<w&&(w=D,l.vec3.copy(N,E),l.vec3.copy(U,T))}}var R=r.rayBeginPoint,A=r.rayEndPoint;if(w<g*g){var H=Number.MAX_VALUE;if(u.lineSegment.closestLineSegmentPoint(u.lineSegment.fromPoints(N,U,G),u.lineSegment.fromPoints(R,A,F),I)){l.vec3.subtract(I,I,R);var k=l.vec3.length(I);l.vec3.scale(I,I,1/k),H=k/l.vec3.distance(R,A)}o(H,I)}}else x.error("intersection assumes a translation-only matrix")},t.prototype.computeAttachmentOrigin=function(e,t){var n=e.data,r="getVertexAttr"in n?n.getVertexAttr():"vertexAttr"in n?n.vertexAttr:null;if(!r)return null;var i=b.RibbonVertexAttributeConstants.POSITION,a="getVertexAttr"in n?n.indices:null;return d.computeAttachmentOriginLines(r[i],a?a[i]:null,a&&C(this.params,r,a),t)},t.prototype.createLayout=function(){var e=p.newLayout().vec3f(b.RibbonVertexAttributeConstants.POSITION).f32(b.RibbonVertexAttributeConstants.SUBDIVISIONFACTOR).vec2f(b.RibbonVertexAttributeConstants.UV0).vec3f(b.RibbonVertexAttributeConstants.AUXPOS1).vec3f(b.RibbonVertexAttributeConstants.AUXPOS2);return e.f32(this.params.vvSizeEnabled?b.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE:b.RibbonVertexAttributeConstants.SIZE),this.params.vvColorEnabled?e.f32(b.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE):e.vec4f(b.RibbonVertexAttributeConstants.COLOR),this.params.vvOpacityEnabled&&e.f32(b.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE),e},t.prototype.createBufferWriter=function(){return new P(this.layout,this.params)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new S(e):void 0},t.prototype.validateParams=function(){"miter"!==this.params.join&&(this.params.miterLimit=0)},t}(f.Material),S=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return n.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(_.RibbonLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return this.technique.configuration.occluder?3===e||10===e||11===e:0===this.output?(this.targetSlot=this.technique.configuration.writeDepth?5:8,e===this.targetSlot):3===e},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&this._updateOccludeeState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t.prototype.getPipelineState=function(e,t){return t?this.technique.occludeePipeline:this.technique.configuration.occluder?11===e?this.technique.occluderPipelineTransparent:10===e?this.technique.occluderPipelineOpaque:this.technique.occluderPipelineMaskWrite:this.technique.pipeline},t}(h.GLMaterial),O=n.__assign({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1},m.Default),P=function(){function e(e,t){switch(this.params=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e,this.params.join){case"miter":case"bevel":this.numJoinSubdivisions=t.stipplePattern?1:0;break;case"round":this.numJoinSubdivisions=A}}return e.prototype.isClosed=function(e){return C(this.params,e.vertexAttr,e.indices)},e.prototype.numCapSubdivisions=function(e){if(this.isClosed(e))return 0;switch(this.params.cap){case"butt":return 0;case"square":return 1;case"round":return R}},e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){var t=2*this.numCapSubdivisions(e)+2,n=e.indices[b.RibbonVertexAttributeConstants.POSITION].length/2+1,r=this.isClosed(e),i=r?2:2*t,a=r?0:1,o=r?n:n-1;if(e.vertexAttr[b.RibbonVertexAttributeConstants.SUBDIVISIONS])for(var s=e.vertexAttr[b.RibbonVertexAttributeConstants.SUBDIVISIONS].data,l=a;l<o;++l)i+=4+2*s[l];else i+=(o-a)*(2*this.numJoinSubdivisions+4);return i+2},e.prototype.write=function(e,t,n,r){var i=this,a=H,o=k,s=q,c=t.vertexAttr[b.RibbonVertexAttributeConstants.POSITION].data,u=t.indices&&t.indices[b.RibbonVertexAttributeConstants.POSITION],p=this.numCapSubdivisions(t);u&&u.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var d=null;t.vertexAttr[b.RibbonVertexAttributeConstants.SUBDIVISIONS]&&(d=t.vertexAttr[b.RibbonVertexAttributeConstants.SUBDIVISIONS].data);var h=1,f=0;this.params.vvSizeEnabled?f=t.vertexAttr[b.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]:t.vertexAttr[b.RibbonVertexAttributeConstants.SIZE]&&(h=t.vertexAttr[b.RibbonVertexAttributeConstants.SIZE].data[0]);var v=[1,1,1,1],m=0;this.params.vvColorEnabled?m=t.vertexAttr[b.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE].data[0]:t.vertexAttr[b.RibbonVertexAttributeConstants.COLOR]&&(v=t.vertexAttr[b.RibbonVertexAttributeConstants.COLOR].data);var g=0;this.params.vvOpacityEnabled&&(g=t.vertexAttr[b.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE].data[0]);var y=c.length/3,_=e.transformation,x=new Float32Array(n.buffer),w=this.vertexBufferLayout.stride/4,S=r*w,O=S,P=function(e,t,n,r,a,o){x[S++]=t[0],x[S++]=t[1],x[S++]=t[2],x[S++]=r,x[S++]=a,x[S++]=o,x[S++]=e[0],x[S++]=e[1],x[S++]=e[2],x[S++]=n[0],x[S++]=n[1],x[S++]=n[2],x[S++]=i.params.vvSizeEnabled?f:h,i.params.vvColorEnabled?x[S++]=m:(x[S++]=v[0],x[S++]=v[1],x[S++]=v[2],x[S++]=v[3]),i.params.vvOpacityEnabled&&(x[S++]=g)};S+=w,l.vec3.set(o,c[0],c[1],c[2]),_&&l.vec3.transformMat4(o,o,_);var C=this.isClosed(t);if(C){var D=c.length-3;l.vec3.set(a,c[D],c[D+1],c[D+2]),_&&l.vec3.transformMat4(a,a,_)}else{l.vec3.copy(a,o),l.vec3.set(s,c[3],c[4],c[5]),_&&l.vec3.transformMat4(s,s,_);for(var R=0;R<p;++R)P(a,o,s,I=1-R/p,1,-4),P(a,o,s,I,1,4);P(a,o,s,0,0,-4),P(a,o,s,0,0,4),l.vec3.copy(a,o),l.vec3.copy(o,s)}var A=C?y:y-1;for(R=C?0:1;R<A;R++){var E=(R+1)%y*3;l.vec3.set(s,c[E+0],c[E+1],c[E+2]),_&&l.vec3.transformMat4(s,s,_),P(a,o,s,0,1,-1),P(a,o,s,0,1,1);for(var T=d?d[R]:this.numJoinSubdivisions,j=0;j<T;++j)P(a,o,s,I=(j+1)/(T+1),1,-2),P(a,o,s,I,1,2);P(a,o,s,1,0,-2),P(a,o,s,1,0,2),l.vec3.copy(a,o),l.vec3.copy(o,s)}if(C)S=M(x,O+w,x,S,2*w);else for(P(a,o,s,0,1,-5),P(a,o,s,0,1,5),R=0;R<p;++R){var I;P(a,o,s,I=(R+1)/p,1,-5),P(a,o,s,I,1,5)}M(x,O+w,x,O,w),S=M(x,S-w,x,S,w)},e}();function M(e,t,n,r,i){for(var a=0;a<i;a++)n[r++]=e[t++];return r}function C(e,t,n){return D(e,t[b.RibbonVertexAttributeConstants.POSITION].data,n?n[b.RibbonVertexAttributeConstants.POSITION]:null)}function D(e,t,n){return!!e.isClosed&&(n?n.length>2:t.length>6)}var R=3,A=1,E=c.vec3f64.create(),T=c.vec3f64.create(),j=c.vec3f64.create(),I=c.vec3f64.create(),V=c.vec3f64.create(),L=o.createRenderScreenPointArray3(),z=o.createRenderScreenPointArray3(),N=c.vec3f64.create(),U=c.vec3f64.create(),G=u.lineSegment.create(),F=u.lineSegment.create(),H=c.vec3f64.create(),k=c.vec3f64.create(),q=c.vec3f64.create(),W=[o.createRenderScreenPointArray3(),o.createRenderScreenPointArray3(),o.createRenderScreenPointArray3(),o.createRenderScreenPointArray3()],B=[c.vec3f64.create(),c.vec3f64.create(),c.vec3f64.create(),c.vec3f64.create()],Z=u.plane.create(),X=u.plane.create(),Y=u.plane.create(),J=u.plane.create();return w}).apply(null,r))||(e.exports=i)},RWrl:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("BcWh"),n("eIBl"),n("xoE+"),n("LxLY"),n("afW+"),n("jBNx"),n("8MXS"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("qysZ"),n("DtIM"),n("woUR"),n("5T2R"),n("B3XD"),n("Fe95"),n("aWgr"),n("AzkI"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w,S,O,P,M){"use strict";var C;Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicScaleRotateTransform=void 0,function(e){e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.Unlocked=1024,e.DelayedFocused=2048,e.TouchInput=32768}(C||(C={}));var D=function(){function e(e){var t=this;this.mode=null,this._handles=new i,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new r,this.getFocused=function(){return t.ringManipulator.focused},this.getScale=function(){return o.isSome(t._scaleRotateDragData)&&"scale"===t._scaleRotateDragData.mode?t._scaleRotateDragData.scale:1},this.tool=e.tool,this.mode=e.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}return e.prototype.destroy=function(){o.isSome(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null},e.prototype.startAnimation=function(e){var t=this;this.cancelActiveAnimation(),e.start();var r=s.addFrameTask({update:function(n){e.update(n.deltaTime)&&t.cancelActiveAnimation()}});this._activeAnimation=n.__assign(n.__assign({},e),{frameTask:r})},e.prototype.cancelActiveAnimation=function(){o.isSome(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)},e.prototype.forEachManipulator=function(e){e(this.ringManipulator,2)},e.prototype.createManipulator=function(){var e=this;this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);var t=this.tool.graphicState.graphic,n=M.createManipulatorDragEventPipeline(this.ringManipulator,(function(n,r,i){e._scaleRotateDragData=null;var s=function(e,t){var n=e.allLayerViews.find((function(e){return e.layer===t.layer}));if(o.isNone(t.symbol))return null;var r=t.symbol;return{symbolLayers:r.symbolLayers.map((function(e){var t=null;return"object"===e.type&&(t=e.heading),{heading:t,size:n.getSymbolLayerSize(r,e)}})).toArray()}}(e.tool.view,t);if(o.isNone(s))return e.updateDragState(),null;var l={mode:"none",origin:h.vec3f64.clone(n.renderLocation),angle:0,startAngle:e.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:s};e._scaleRotateDragData=l,e.updateDragState();var c=w.sv3d.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(n.renderLocation,c),r.next(y.screenToRenderPlane(e.tool.view,b.plane.fromPositionAndNormal(n.renderLocation,c))).next((function(n){var r=b.plane.normal(n.plane),i=g.calculateInputRotationTransform(n.renderStart,n.renderEnd,l.origin,r),s=x.cyclicalPI.shortestSignedDiff(l.angle,i);l.angleDir=a.clamp(l.angleDir+s,-_.ROTATE_INDICATOR_DIRECTION_BUFFER,_.ROTATE_INDICATOR_DIRECTION_BUFFER),l.angle=i;var c=function(e,t){var n=d.vec3.subtract(w.sv3d.get(),t.renderStart,e.origin),r=d.vec3.subtract(w.sv3d.get(),t.renderEnd,e.origin),i=d.vec3.length(n),a=d.vec3.length(r);return 0===i?0:a/i}(l,n);if(l.scaleDir=a.clamp(l.scaleDir+(c-l.scale),-_.SCALE_INDICATOR_DIRECTION_BUFFER,_.SCALE_INDICATOR_DIRECTION_BUFFER),l.scale=c,e.onScaleChanged(),"none"===l.mode){var u=e.mode||function(e,t,n,r){var i=e.renderStart,a=e.renderEnd,o=R(i,r,w.sv3d.get()),s=R(a,r,w.sv3d.get());if(d.vec3.squaredDistance(o,s)<_.DRAG_THRESHOLD_PX*_.DRAG_THRESHOLD_PX)return null;var l=d.vec3.subtract(w.sv3d.get(),i,n),c=d.vec3.cross(w.sv3d.get(),l,t),u=i,p=d.vec3.add(w.sv3d.get(),u,c),h=R(n,r,w.sv3d.get()),f=o,v=R(p,r,w.sv3d.get()),m=d.vec3.subtract(w.sv3d.get(),v,f),g=d.vec3.subtract(w.sv3d.get(),o,h),y=b.ray.wrap(f,m),x=b.ray.wrap(h,g);return b.ray.distance2(y,s)<b.ray.distance2(x,s)?"rotate":"scale"}(n,n.plane,l.origin,e.tool.view.state.camera);if(o.isSome(u)){switch(u){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:t,angle:l.angle});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:t,scale:l.scale})}l.mode=u}}if(e.updateDragState(),o.isSome(t.symbol)){var p=t.symbol.clone(),h=0,f=1;switch(l.mode){default:case"none":break;case"scale":f=l.scale;break;case"rotate":h=l.angle}e.applySymbolData(p,l.startSymbolData,h,f),t.symbol=p,e.updateManipulatorTransform()}switch(n.action){case"start":case"update":switch(l.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:t,angle:l.angle});break;case"scale":e.tool.emit("graphic-scale",{graphic:t,scale:l.scale})}break;case"end":switch(l.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:t,angle:l.angle});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:t,scale:l.scale});break;default:case"none":}}"end"===n.action&&(e.startAnimation(A(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState())})),i.next(M.resetSymbol(t)).next((function(){if(o.isSome(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:t,angle:e._scaleRotateDragData.startAngle});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:t,scale:1})}e.startAnimation(A(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null}}))}));this._handles.add(n),this._handles.add([this.ringManipulator.events.on("focus-changed",(function(t){var n,r,i,a,o;"focus"===t.action?e.startAnimation((n=e,r=function(){return e.updateDelayedFocusedState()},i=0,a=null,o=function(){return!1},{start:function(){a=n.getFocused,n.getFocused=o,i=0,r()},update:function(e){return i+=e,!a()||i>_.RING_INDICATOR_DELAY_MS?1:0},destroy:function(){n.getFocused=a,r()}})):e.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(function(e){e.stopPropagation()})),c.init(this.tool.graphicState,"displaying",(function(t){return e.ringManipulator.available=t})),this.tool.graphicState.on("changed",(function(){return g.placeAtGraphic(e.tool.view,e.ringManipulator,t)}))]),g.placeAtGraphic(this.tool.view,this.ringManipulator,t)},e.prototype.onScaleChanged=function(){this.events.emit("scale-changed"),this.updateManipulatorTransform()},e.prototype.updateDelayedFocusedState=function(){this.ringManipulator.updateStateEnabled(C.DelayedFocused,this.getFocused())},e.prototype.updateDragState=function(){if(this.ringManipulator.updateStateEnabled(C.Unlocked,!(o.isSome(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),o.isSome(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(C.ScaleIn|C.ScaleOut,!1),this.ringManipulator.updateStateEnabled(C.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(C.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(C.RotateLeft|C.RotateRight,!1),this.ringManipulator.updateStateEnabled(C.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(C.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(C.ScaleIn|C.ScaleOut|C.RotateLeft|C.RotateRight,!1)},e.prototype.updateManipulatorTransform=function(){var e=u.mat4.identity(w.sm4d.get());u.mat4.rotate(e,e,this.tool.symbolRotationAngle,h.vec3f64.fromValues(0,0,1));var t=this.getScale(),n=u.mat4.fromScaling(w.sm4d.get(),d.vec3.set(w.sv3d.get(),t,t,t)),r=u.mat4.identity(w.sm4d.get());u.mat4.multiply(r,n,e),this.ringManipulator.modelTransform=r},e.prototype.createRingManipulator=function(){for(var e=function(e,t,n){for(var r=[],i=Math.ceil(_.GEOMETRY_SEGMENTS*(t-e)/(2*Math.PI)),a=0;a<i+1;a++){var o=e+a*(t-e)/i;r.push(h.vec3f64.fromValues(n*Math.cos(o),n*Math.sin(o),0))}return r},t=function(t){return e(0,2*Math.PI,t)},r=function(e,t){return new S(O.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,_.RING_HEIGHT/2],[-e/2,_.RING_HEIGHT/2]]}(t),e,[],[],!1),"graphic-transform-ring")},i=t(_.RING_RADIUS),a=r(i,_.RING_THICKNESS),o={left:[],right:[]},s=[],l=0;l<2;l++){var c=(D=l*Math.PI-Math.PI/4)+(R=Math.PI/2-_.ROTATE_INDICATOR_ARC_LENGTH),d=D+Math.PI/2-R,f=r(A=e(c,d,_.INNER_INDICATOR_RADIUS),_.INDICATOR_THICKNESS);s.push(A),s.push(e(c,d,_.OUTER_INDICATOR_RADIUS-_.RING_THICKNESS/2)),o.left.push(f),o.right.push(f);for(var g=0;g<2;g++){var y=0===g,b=p.mat4f64.create();if(y){u.mat4.scale(b,b,[1,-1,1]),u.mat4.rotate(b,b,-c,[0,0,1]);var x=Math.round(_.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE*(A.length-1));b[12]=A[x][0],b[13]=A[x][1],b[14]=A[x][2]}else u.mat4.rotate(b,b,d,[0,0,1]),x=Math.round((1-_.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE)*(A.length-1)),b[12]=A[x][0],b[13]=A[x][1],b[14]=A[x][2];var w=O.createExtrudedTriangle(_.ROTATE_INDICATOR_ARROW_TIP_LENGTH,0,_.ROTATE_INDICATOR_ARROW_TIP_RADIUS,_.RING_HEIGHT);O.transformInPlace(w,b);var P=new S(w,"graphic-transform-ring-rotate");(y?o.left:o.right).push(P)}}var M=[];for(l=0;l<2;l++){c=(D=l*Math.PI-Math.PI/4)+(R=Math.PI/2-_.SCALE_INDICATOR_ARC_LENGTH),d=D+Math.PI/2-R;var D,R,A=e(c,d,_.OUTER_INDICATOR_RADIUS);M.push(r(A,_.INDICATOR_THICKNESS))}var E=t(_.RING_RADIUS+_.SCALE_INDICATOR_OFFSET1),T=t(_.RING_RADIUS+_.SCALE_INDICATOR_OFFSET2),j=r(E,_.INDICATOR_THICKNESS),I=r(T,_.INDICATOR_THICKNESS),V=t(_.RING_RADIUS-_.SCALE_INDICATOR_OFFSET1),L=t(_.RING_RADIUS-_.SCALE_INDICATOR_OFFSET2),z=r(V,_.INDICATOR_THICKNESS),N=r(L,_.INDICATOR_THICKNESS),U=this.createMaterial(),G=this.createMaterial(.66),F=this.createMaterial(.5),H=this.createMaterial(.33),k=[{geometry:a,material:U,stateMask:C.DelayedFocused},{geometry:a,material:F,stateMask:0}];this.mode&&"scale"!==this.mode||(k=k.concat([{geometry:M,material:U,stateMask:C.DelayedFocused|C.Unlocked},{geometry:j,material:G,stateMask:C.DelayedFocused|C.ScaleIn},{geometry:I,material:H,stateMask:C.DelayedFocused|C.ScaleIn},{geometry:z,material:G,stateMask:C.DelayedFocused|C.ScaleOut},{geometry:N,material:H,stateMask:C.DelayedFocused|C.ScaleOut}])),this.mode&&"rotate"!==this.mode||(k=k.concat([{geometry:o.right,material:U,stateMask:C.DelayedFocused|C.Unlocked},{geometry:o.left,material:U,stateMask:C.DelayedFocused|C.RotateLeft},{geometry:o.right,material:U,stateMask:C.DelayedFocused|C.RotateRight}]));var q=n.__spreadArrays([i],s);return new m.Manipulator3D({view:this.tool.view,renderObjects:k,autoScaleRenderObjects:!1,worldOriented:!0,radius:_.RING_THICKNESS,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:v.getGraphicEffectiveElevationInfo(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:q,direction:h.vec3f64.fromValues(0,0,1)}})},e.prototype.createMaterial=function(e){void 0===e&&(e=1);var t=n.__spreadArrays(_.HANDLE_COLOR,[e]),r=new P({color:t,transparent:1!==e,cullFace:2},"graphic-transform");return r.renderOccluded=2,r},e.prototype.applySymbolData=function(e,t,n,r){var i=this;e.symbolLayers.forEach((function(e,a){var s=t.symbolLayers[a],l=s.heading,c=s.size;"object"===e.type&&(e.heading=(o.isSome(l)?l:0)-f.toDegree(n),o.isSome(c)&&"width"in c&&(c.width=i.enforceNonZeroSize(c.width),c.height=i.enforceNonZeroSize(c.height),c.depth=i.enforceNonZeroSize(c.depth),e.width=c.width*r,e.depth=c.depth*r,e.height=c.height*r))}))},e.prototype.enforceNonZeroSize=function(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)},Object.defineProperty(e.prototype,"test",{get:function(){return{ringManipulator:this.ringManipulator}},enumerable:!1,configurable:!0}),e}();function R(e,t,n){var r=t.projectPoint(e,l.castRenderScreenPointArray(E)),i=t.renderToScreen(r,T);return d.vec3.set(n,i[0],i[1],0)}function A(e,t){var n=null,r=1,i=function(){return r};return{start:function(){r=e.getScale(),n=e.getScale,e.getScale=i,t()},update:function(e){return r+=((r+1)/2-r)*Math.min(e*_.RING_RESET_ANIMATION_SPEED_FACTOR,1),t(),Math.abs(r-1)<.01?1:0},destroy:function(){e.getScale=n,t()}}}t.GraphicScaleRotateTransform=D;var E=h.vec3f64.create(),T=l.createScreenPointArray()}).apply(null,r))||(e.exports=i)},Raj5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("RsYQ")],void 0===(i=(function(e,t,n){"use strict";var r=function(){function e(e,t,r,a,o,s){this.camera=null,this.lastFrameCamera=new n.default,this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=i,this.hasOccludees=!1,this.rctx=e,this.offscreenRenderingHelper=t,this.scenelightingData=r,this.shadowMap=a,this.ssaoHelper=o,this.sliceHelper=s}return e.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=i},Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!1,configurable:!0}),e}(),i=13;return r}).apply(null,r))||(e.exports=i)},"RdU/":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("B4Pz"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){"use strict";function a(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(r.FoamIntensity),e.fragment.code.add(i.glsl(o||(o=n.__makeTemplateObject(["\n      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress = computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength = waveParams[2];\n        float flowOffset = waveParams[3];\n\n        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress = computeProgress(uv, time + phaseOffset);\n        float weight = computeWeight(uv, time + phaseOffset);\n\n        vec2 result = uv;\n        result -= flowVector * (progress + flowOffset);\n        result += phaseOffset;\n        result += (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\n      const float TIME_NOISE_STRENGTH = 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength = waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement = time * -_waveDir;\n\n        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal = normalize(normal_A + normal_B);\n        mixNormal.xy *= waveStrength;\n        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat = waveParams[1];\n        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  = normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "],["\n      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress = computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength = waveParams[2];\n        float flowOffset = waveParams[3];\n\n        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress = computeProgress(uv, time + phaseOffset);\n        float weight = computeWeight(uv, time + phaseOffset);\n\n        vec2 result = uv;\n        result -= flowVector * (progress + flowOffset);\n        result += phaseOffset;\n        result += (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\n      const float TIME_NOISE_STRENGTH = 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength = waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement = time * -_waveDir;\n\n        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal = normalize(normal_A + normal_B);\n        mixNormal.xy *= waveStrength;\n        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat = waveParams[1];\n        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  = normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "]))))}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.WaterDistortion=void 0,t.WaterDistortion=a,function(e){e.bindUniforms=function(e,t){e.setUniform1i("texWaveNormal",0),e.setUniform1i("texWavePerturbation",1),e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}}(a=t.WaterDistortion||(t.WaterDistortion={}))}).apply(null,r))||(e.exports=i)},RsYQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("jBNx"),n("FXVB"),n("1m5D"),n("W9tT"),n("DIqE"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("AzkI"),n("18xY"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=function(){function e(e,t,n){void 0===e&&(e=c.vec3f64.create()),void 0===t&&(t=c.vec3f64.create()),void 0===n&&(n=c.vec3f64.fromValues(0,0,1)),this._viewUp=c.vec3f64.create(),this._viewForward=c.vec3f64.create(),this._viewRight=c.vec3f64.create(),this._ray=d.ray.createWrapper(),this._viewport=p.vec4f64.fromValues(0,0,1,1),this._padding=p.vec4f64.fromValues(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=s.vec2f64.fromValues(1,1e3),this._viewDirty=!0,this._viewMatrix=a.mat4f64.create(),this._projectionDirty=!0,this._projectionMatrix=a.mat4f64.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=a.mat4f64.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=a.mat4f64.create(),this._frustumDirty=!0,this._frustum=d.frustum.create(),this._fullViewport=null,this.pixelRatio=1,this.relativeElevation=0,this._eye=c.vec3f64.clone(e),this._center=c.vec3f64.clone(t),this._up=c.vec3f64.clone(n),this._padding=p.vec4f64.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=c.vec3f64.create()),l.vec3.subtract(this._ray.direction,this.center,this.eye),this._ray},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){i.mat4.copy(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nearFar",{get:function(){return this._nearFar},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._nearFar[0]},set:function(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._nearFar[1]},set:function(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){this._viewport[0]!==(e+=this._padding[3])&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){this._viewport[1]!==(e+=this._padding[2])&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=p.vec4f64.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),u.vec4.copy(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(i.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2),r=n*this.aspect;i.mat4.frustum(this._projectionMatrix,-r*(1+2*this._padding[3]/e),r*(1+2*this._padding[1]/e),-n*(1+2*this._padding[2]/t),n*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){i.mat4.copy(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return v.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=v.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return v.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=v.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return l.vec3.distance(this._center,this._eye)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frustum",{get:function(){return this._recomputeFrustum(),this._frustum},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=a.mat4f64.create()),i.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),i.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!1,configurable:!0}),e.prototype.depthNDCToWorld=function(e){return 2*this.near*this.far/(this.far+this.near-(2*e-1)*(this.far-this.near))},Object.defineProperty(e.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation&&this.relativeElevation>=0},enumerable:!1,configurable:!0}),e.prototype.copyFrom=function(e){var t=e;return l.vec3.copy(this._eye,t._eye),l.vec3.copy(this._center,t._center),l.vec3.copy(this._up,t._up),u.vec4.copy(this._viewport,t._viewport),u.vec4.copy(this._padding,t._padding),o.vec2.copy(this._nearFar,t._nearFar),this._fov=t._fov,this.relativeElevation=e.relativeElevation,this._viewDirty=t._viewDirty,this._viewDirty||(i.mat4.copy(this._viewMatrix,t._viewMatrix),l.vec3.copy(this._viewRight,t._viewRight),l.vec3.copy(this._viewUp,t._viewUp),l.vec3.copy(this._viewForward,t._viewForward)),t._projectionDirty?this._projectionDirty=!0:(i.mat4.copy(this._projectionMatrix,t._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(d.frustum.copy(t._frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?i.mat4.copy(this._viewInverseTransposeMatrix,t._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=a.mat4f64.clone(t._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),t._fullViewport?this._fullViewport?u.vec4.copy(this._fullViewport,t._fullViewport):this._fullViewport=p.vec4f64.clone(t._fullViewport):this._fullViewport=null,this.pixelRatio=e.pixelRatio,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equals=function(e){return l.vec3.exactEquals(this._eye,e._eye)&&l.vec3.exactEquals(this._center,e._center)&&l.vec3.exactEquals(this._up,e._up)&&u.vec4.exactEquals(this._viewport,e._viewport)&&u.vec4.exactEquals(this._padding,e._padding)&&o.vec2.exactEquals(this._nearFar,e._nearFar)&&this._fov===e._fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation},e.prototype.almostEquals=function(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e._fov-this._fov)>=.001)return!1;l.vec3.sub(_,e._eye,e._center),l.vec3.sub(b,this._eye,this._center);var t=l.vec3.dot(_,b),n=l.vec3.sqrLen(_),r=l.vec3.sqrLen(b);return t*t>=(1-1e-10)*n*r&&l.vec3.sqrDist(e._eye,this._eye)<5e-4*Math.max(n,r)*5e-4&&u.vec4.squaredDistance(e._padding,this._padding)<.5&&u.vec4.squaredDistance(e._viewport,this._viewport)<.5},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0},e.prototype.computeRenderPixelSizeAt=function(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.computeRenderPixelSizeAtDist=function(e){return e*this.perRenderPixelRatio},e.prototype.computeScreenPixelSizeAt=function(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.viewDirectionDistance=function(e){return Math.abs(f.projectPointSignedLength(this.viewForward,l.vec3.subtract(_,e,this._eye)))},e.prototype.computeScreenPixelSizeAtDist=function(e){return e*this.perScreenPixelRatio},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.getScreenCenter=function(e){return void 0===e&&(e=r.createScreenPointArray()),e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e},e.prototype.getRenderCenter=function(e,t,n){return void 0===t&&(t=.5),void 0===n&&(n=.5),e||(e=r.createRenderScreenPointArray3()),e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*n,e.length>2&&(e[2]=.5),e},e.prototype.setGLViewport=function(e){var t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])},e.prototype.applyProjection=function(e,t,r){void 0===r&&(r=!1),e!==g&&l.vec3.copy(g,e),g[3]=1,r&&(t[2]=-g[2]),u.vec4.transformMat4(g,g,this.projectionMatrix),l.vec3.scale(g,g,1/Math.abs(g[3]));var i=this.fullViewport;return t[0]=n.lerp(0,i[0]+i[2],.5+.5*g[0]),t[1]=n.lerp(0,i[1]+i[3],.5+.5*g[1]),r||(t[2]=.5*(g[2]+1)),t},e.prototype.projectPoint=function(e,t){if(g[0]=e[0],g[1]=e[1],g[2]=e[2],g[3]=1,u.vec4.transformMat4(g,g,this.viewProjectionMatrix),0===g[3])return null;l.vec3.scale(g,g,1/Math.abs(g[3]));var r=this.fullViewport;return"x"in t?(t.x=n.lerp(0,r[0]+r[2],.5+.5*g[0]),t.y=n.lerp(0,r[1]+r[3],.5+.5*g[1])):(t[0]=n.lerp(0,r[0]+r[2],.5+.5*g[0]),t[1]=n.lerp(0,r[1]+r[3],.5+.5*g[1]),t.length>2&&(t[2]=.5*(g[2]+1))),t},e.prototype.unprojectPoint=function(e,t){if(i.mat4.multiply(y,this.projectionMatrix,this.viewMatrix),!i.mat4.invert(y,y))return null;var n=this.fullViewport;return g[0]=2*(e[0]-n[0])/n[2]-1,g[1]=2*(e[1]-n[1])/n[3]-1,g[2]=2*e[2]-1,g[3]=1,u.vec4.transformMat4(g,g,y),0===g[3]?null:(t[0]=g[0]/g[3],t[1]=g[1]/g[3],t[2]=g[2]/g[3],t)},e.prototype.computeUp=function(e){1===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.screenToRender=function(e,t){var n=this.fullHeight-e[1]*this.pixelRatio;return t[0]=e[0]*this.pixelRatio,t[1]=n,t},e.prototype.renderToScreen=function(e,t){var n=(this.fullHeight-e[1])/this.pixelRatio;return t[0]=e[0]/this.pixelRatio,t[1]=n,t},e.prototype.computeUpGlobal=function(){l.vec3.subtract(_,this.center,this.eye);var e=l.vec3.length(this.center);e<1?(l.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(l.vec3.dot(_,this.center))>.9999*l.vec3.length(_)*e||(l.vec3.cross(this.up,_,this.center),l.vec3.cross(this.up,this.up,_),l.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){h.directionFromTo(_,this.eye,this.center),Math.abs(_[2])<=.9999&&(l.vec3.scale(_,_,_[2]),l.vec3.set(this.up,-_[0],-_[1],1-_[2]),l.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){l.vec3.exactEquals(e,t)||(l.vec3.copy(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)},e.prototype._recomputeFrustum=function(){this._frustumDirty&&(d.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)},e.prototype._ensureViewClean=function(){this._viewDirty&&(i.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),l.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),l.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),l.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}();t.default=m;var g=p.vec4f64.create(),y=a.mat4f64.create(),_=c.vec3f64.create(),b=c.vec3f64.create()}).apply(null,r))||(e.exports=i)},SNs2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("LxLY"),n("fese"),n("PaEL"),n("3PFg"),n("2NOe"),n("W/V4"),n("FQ4r"),n("lBa0"),n("lfQW"),n("ne9J"),n("G0ER"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d,h,f,v,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RibbonLineTechniqueConfiguration=t.RibbonLineTechnique=t.ribbonVertexAttributeLocations=t.RibbonVertexAttributeConstants=void 0,t.RibbonVertexAttributeConstants={POSITION:"position",SUBDIVISIONFACTOR:"subdivisionFactor",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",SUBDIVISIONS:"subdivisions",COLOR:"color",COLORFEATUREATTRIBUTE:"colorFeatureAttribute",SIZE:"size",SIZEFEATUREATTRIBUTE:"sizeFeatureAttribute",OPACITYFEATUREATTRIBUTE:"opacityFeatureAttribute"},t.ribbonVertexAttributeLocations={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};var g=function(e){function p(t,n){var r=e.call(this,t,n)||this;return r.stipplePattern=null,r.stippleTextureBind=null,r.stippleTextureRepository=t.stippleTextureRepository,r}return r.__extends(p,e),p.prototype.initializeProgram=function(e){var n=p.shader.get(),r=this.configuration,i=n.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,stippleEnabled:r.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleUVMaxEnabled:r.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:r.stippleIntegerRepeatsEnabled,roundCaps:r.roundCaps,roundJoins:r.roundJoins,vvColor:r.vvColor,vvSize:r.vvSize,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,falloffEnabled:r.falloffEnabled,innerColorEnabled:r.innerColorEnabled});return new v(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),t.ribbonVertexAttributeLocations)},p.prototype.dispose=function(){e.prototype.dispose.call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null},p.prototype.bindPass=function(e,t,n){if(c.View.bindProjectionMatrix(this.program,n.camera.projectionMatrix),4===this.configuration.output&&s.OutputHighlight.bindOutputHighlight(e,this.program,n),this.program.setUniform1f("intrinsicWidth",t.width),this.program.setUniform4fv("intrinsicColor",t.color),this.program.setUniform1f("miterLimit","miter"!==t.join?0:t.miterLimit),this.program.setUniform1f("nearPlane",n.camera.nearFar[0]),this.program.setUniform1f("pixelRatio",n.camera.pixelRatio),this.program.setUniform2f("screenSize",n.camera.fullViewport[2],n.camera.fullViewport[3]),l.VisualVariables.bindUniformsWithOpacity(this.program,t),this.stipplePattern!==t.stipplePattern){var r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){var o=a.isSome(this.stippleTextureBind)?this.stippleTextureBind(e,0)*n.camera.pixelRatio:1;if(this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/o),this.configuration.stippleOffColorEnabled){var u=i.unwrap(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",u[0],u[1],u[2],u.length>3?u[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",t.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",i.unwrapOr(t.innerColor,t.color)),this.program.setUniform1f("innerWidth",t.innerWidth*n.camera.pixelRatio))},p.prototype.bindDraw=function(e){c.View.bindView(this.program,e),o.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},p.prototype.initializePipeline=function(){var e=this.configuration,t=m.separateBlendingParams(770,1,771,771),n=e.polygonOffset&&y;if(e.occluder&&(this._occluderPipelineTransparent=m.makePipelineState({blending:t,polygonOffset:n,depthTest:h.depthCompareAlways,depthWrite:null,colorWrite:m.defaultColorWriteParams,stencilWrite:null,stencilTest:h.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=m.makePipelineState({polygonOffset:n,depthTest:h.depthCompareAlways,depthWrite:null,colorWrite:m.defaultColorWriteParams,stencilWrite:h.stencilWriteMaskOff,stencilTest:h.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=m.makePipelineState({polygonOffset:n,depthTest:h.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:h.stencilWriteMaskOn,stencilTest:h.stencilToolMaskBaseParams})),0===e.output){var r=function(r){return m.makePipelineState({blending:t,polygonOffset:n,depthTest:h.depthCompareLess,depthWrite:!e.transparent&&e.writeDepth&&m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?h.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?r?h.stencilToolMaskBaseParams:h.stencilBaseAllZerosParams:null})};return this._occludeePipeline=r(!0),r(!1)}return m.makePipelineState({polygonOffset:n,depthTest:h.depthCompareLess,depthWrite:!e.transparent&&e.writeDepth&&m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams})},Object.defineProperty(p.prototype,"occluderPipelineTransparent",{get:function(){return this._occluderPipelineTransparent},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"occluderPipelineOpaque",{get:function(){return this._occluderPipelineOpaque},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"occludeePipeline",{get:function(){return this._occludeePipeline},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"occluderPipelineMaskWrite",{get:function(){return this._occluderPipelineMaskWrite},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"primitiveType",{get:function(){return 5},enumerable:!1,configurable:!0}),p.shader=new u.ReloadableShaderModule(f,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("ne9J")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),p}(p.ShaderTechnique);t.RibbonLineTechnique=g;var y={factor:0,units:-4},_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.occluder=!1,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.vertexColors=!1,t.transparent=!1,t.polygonOffset=!1,t.writeDepth=!1,t.stippleEnabled=!1,t.stippleOffColorEnabled=!1,t.stippleIntegerRepeatsEnabled=!1,t.roundCaps=!1,t.roundJoins=!1,t.vvSize=!1,t.vvColor=!1,t.vvOpacity=!1,t.falloffEnabled=!1,t.innerColorEnabled=!1,t.sceneHasOcludees=!1,t}return r.__extends(t,e),r.__decorate([d.parameter({count:7})],t.prototype,"output",void 0),r.__decorate([d.parameter()],t.prototype,"occluder",void 0),r.__decorate([d.parameter()],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"sliceHighlightDisabled",void 0),r.__decorate([d.parameter()],t.prototype,"vertexColors",void 0),r.__decorate([d.parameter()],t.prototype,"transparent",void 0),r.__decorate([d.parameter()],t.prototype,"polygonOffset",void 0),r.__decorate([d.parameter()],t.prototype,"writeDepth",void 0),r.__decorate([d.parameter()],t.prototype,"stippleEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"stippleOffColorEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"stippleIntegerRepeatsEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"roundCaps",void 0),r.__decorate([d.parameter()],t.prototype,"roundJoins",void 0),r.__decorate([d.parameter()],t.prototype,"vvSize",void 0),r.__decorate([d.parameter()],t.prototype,"vvColor",void 0),r.__decorate([d.parameter()],t.prototype,"vvOpacity",void 0),r.__decorate([d.parameter()],t.prototype,"falloffEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"innerColorEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(d.ShaderTechniqueConfiguration);t.RibbonLineTechniqueConfiguration=_}).apply(null,r))||(e.exports=i)},T95R:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("BcWh"),n("LxLY"),n("jBNx"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("WRgd"),n("X5J5"),n("2W+Z"),n("fOZq"),n("v+nG"),n("mmEe"),n("RsYQ"),n("ys4y"),n("4ziW"),n("o5p5"),n("uZGf")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VerticesVisualElement=void 0;var w=function(){function e(e){var t=this;this.view=null,this.camera=new g.default,this.events=new n,this._vertices=null,this._spatialReference=null,this._color=d.settings.colorToVec4(d.settings.reshapeManipulators.vertex.color),this._elevationInfo=null,this._occludedMode=8,this.resources=new h.VisualElementResources({view:e.view,createResources:function(e){return t.createResources(e)},recreateGeometry:function(e,n){return e.geometries.length=0,t.recreateGeometry(n,e.vertexMaterial,e.vertexOutlineMaterial,e.geometries),e.geometries},cameraChanged:function(e){return t.resources.recreateGeometry()}});var r=!0;for(var i in e)i in this?"attached"===i?r=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=r}return e.prototype.destroy=function(){this.resources.destroy()},Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached},set:function(e){this.updateAttached(e)},enumerable:!1,configurable:!0}),e.prototype.updateAttached=function(e){this.resources.attached=e},Object.defineProperty(e.prototype,"vertices",{get:function(){return this._vertices},set:function(e){this._vertices=e,this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){c.vec4.exactEquals(e,this._color)||(c.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(e){e!==this._occludedMode&&(this._occludedMode=e,r.isSome(this.resources.resources)&&(this.resources.resources.vertexMaterial.renderOccluded=e,this.resources.resources.vertexOutlineMaterial.renderOccluded=e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vertexMaterialParameters",{get:function(){return{color:this._color,transparent:this._color[3]<1}},enumerable:!1,configurable:!0}),e.prototype.updateMaterial=function(){r.isSome(this.resources.resources)&&this.resources.resources.vertexMaterial.setParameterValues(this.vertexMaterialParameters)},e.prototype.recreateGeometry=function(e,t,n,r){for(var i=0,a=this.createRenderGeometries();i<a.length;i++){var o=a[i];e.addGeometry(o.vertexGeometry,t,o.xform),r.push(o.vertexGeometry),e.addGeometry(o.vertexOutlineGeometry,n,o.xform),r.push(o.vertexOutlineGeometry)}},e.prototype.createResources=function(e){var t=this.color,n=u.vec4f64.fromValues(t[0],t[1],t[2],t.length>3?t[3]:1),r=new x.ShadedColorMaterial({color:n,transparent:t[3]<1,writeDepth:!0,cullFace:2},"manipulator");r.renderOccluded=d.settings.reshapeManipulators.vertex.renderOccludedFlag;var i=d.settings.colorToVec4(d.settings.reshapeManipulators.vertex.outlineColor),a=u.vec4f64.fromValues(i[0],i[1],i[2],4===i.length?i[3]:1),o=new b({color:a,transparent:!0,writeDepth:!0,cullFace:1},"manipulator-outline");o.renderOccluded=d.settings.reshapeManipulators.vertex.renderOccludedFlag;var s=[];return this.recreateGeometry(e,r,o,s),{vertexMaterial:r,vertexOutlineMaterial:o,geometries:s,forEach:function(e){e(r),e(o),s.forEach(e)}}},e.prototype.calculateMapBounds=function(e){if(r.isNone(this.resources.resources))return!1;for(var t=this.view.renderCoordsHelper,n=0,i=this.resources.resources.geometries;n<i.length;n++){var a=i[n].data.getAttribute("position"),o=a.data,s=new Float64Array(o.length);m.bufferToBuffer(a.data,t.spatialReference,0,s,this.view.spatialReference,0,o.length/3),p.expandWithBuffer(e,s)}return!0},e.prototype.computeScreenLocation=function(e,t){return t.pixelSize=this.camera.computeScreenPixelSizeAt(e),this.camera.projectPoint(e,t.renderScreenPointArray),this.camera.renderToScreen(t.renderScreenPointArray,t.screenPointArray),t},e.prototype.computeTransform=function(e,t){var n=o.mat4f64.create(),r=t*this.computeScreenLocation(e,S).pixelSize;return a.mat4.set(n,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1),n[12]+=e[0],n[13]+=e[1],n[14]+=e[2],n[15]=1,n},e.prototype.createRenderGeometries=function(){var e=this.vertices;if(r.isNone(e)||0===e.length)return[];if(!this.view.state||!this.view.state.camera)return[];this.camera.copyFrom(this.view.state.camera);for(var t=d.settings.reshapeManipulators.vertex,n=t.size/2,i=n+t.collisionPadding,a=n/i,o=(n+t.outlineSize)/i,l=v.geometryToRenderInfo(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,f.ElevationContext.fromElevationInfo(this.elevationInfo)),c=[],u=l.numVertices,p=l.position,h=0;h<u;++h){var m=new y(_.createSphereGeometry(a,16,16),"VerticesVisualElement-vertex"),g=new y(_.createSphereGeometry(o,16,16),"VerticesVisualElement-vertexOutline"),b=s.vec3.set(O,p[3*h+0],p[3*h+1],p[3*h+2]),x=this.computeTransform(b,i);c.push({vertexGeometry:m,vertexOutlineGeometry:g,xform:x})}return c},e}();t.VerticesVisualElement=w;var S={screenPointArray:i.createScreenPointArray(),renderScreenPointArray:i.createRenderScreenPointArray3(),pixelSize:0},O=l.vec3f64.create()}).apply(null,r))||(e.exports=i)},TIRl:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("DtIM"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SnapToScene=void 0;var o=function(){function e(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new a.EventPipeline,this._enabled=!1}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&r.isSome(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,n=this.snap(this.lastDragEvent.screenEnd);r.isSome(n)&&this.next.execute({action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?n:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd})}this._enabled=e},enumerable:!1,configurable:!0}),e.prototype.snap=function(e){var t=r.isSome(this.view)?this.view.toMap(e,{exclude:[]}):null;return r.isSome(t)&&r.isSome(this.view)&&(t.z=i.getZForElevationMode(t,this.view,this.elevationInfo)),t},e.prototype.createDragEventPipelineStep=function(e,t){var i=this;return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,function(e){if(i.lastDragEvent="end"!==e.action?n.__assign({},e):null,i._enabled){var t=i.snap(e.screenEnd);return r.isSome(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}},e}();t.SnapToScene=o}).apply(null,r))||(e.exports=i)},UGy0:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("hk44"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a){"use strict";var o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.build=void 0,t.build=function(e){var t=new a.ShaderBuilder;return t.include(r.Laserline,e),t.vertex.uniforms.add("uModelViewMatrix","mat4"),t.vertex.uniforms.add("uProjectionMatrix","mat4"),t.attributes.add("start","vec3"),t.attributes.add("end","vec3"),t.attributes.add("up","vec3"),t.attributes.add("extrude","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add(i.glsl(o||(o=n.__makeTemplateObject(["\n  void main() {\n    vec3 pos = mix(start, end, extrude.x);\n\n    vec4 viewPos = uModelViewMatrix * vec4(pos, 1);\n    vec4 projPos = uProjectionMatrix * viewPos;\n    vec2 ndcPos = projPos.xy / projPos.w;\n\n    vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;\n    vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);\n    vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);\n\n    vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);\n    ndcPos += length(lxy) * projExtrudeDir;\n\n    vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));\n    vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;\n\n    vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;\n    vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;\n    vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\n\n    // Add enough padding in the X screen space direction for glow\n    float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\n    ndcPos.x += xPaddingPixels * pixelToNDC.x;\n\n    uv = ndcPos * 0.5 + 0.5;\n    gl_Position = vec4(ndcPos, 0, 1);\n  }\n  "],["\n  void main() {\n    vec3 pos = mix(start, end, extrude.x);\n\n    vec4 viewPos = uModelViewMatrix * vec4(pos, 1);\n    vec4 projPos = uProjectionMatrix * viewPos;\n    vec2 ndcPos = projPos.xy / projPos.w;\n\n    vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;\n    vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);\n    vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);\n\n    vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);\n    ndcPos += length(lxy) * projExtrudeDir;\n\n    vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));\n    vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;\n\n    vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;\n    vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;\n    vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\n\n    // Add enough padding in the X screen space direction for glow\n    float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\n    ndcPos.x += xPaddingPixels * pixelToNDC.x;\n\n    uv = ndcPos * 0.5 + 0.5;\n    gl_Position = vec4(ndcPos, 0, 1);\n  }\n  "])))),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add(i.glsl(s||(s=n.__makeTemplateObject(["\n  float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\n    vec3 origin = mix(start, end, 0.5);\n    vec3 basis = end - origin;\n    vec3 posAtOrigin = pos - origin;\n\n    float x = dot(normalize(basis), posAtOrigin);\n    float y = dot(plane.xyz, posAtOrigin);\n\n    float dx = max(abs(x) - length(basis), 0.0);\n    float dy = y;\n\n    float dist = length(vec2(dx, dy));\n\n    float width = fwidth(y);\n    float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;\n    float pixelDist = dist / min(width, maxPixelDistance);\n    return abs(pixelDist);\n  }\n\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\n\n    vec4 color = laserlineProfile(distance);\n    float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\n\n    gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n  }\n  "],["\n  float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\n    vec3 origin = mix(start, end, 0.5);\n    vec3 basis = end - origin;\n    vec3 posAtOrigin = pos - origin;\n\n    float x = dot(normalize(basis), posAtOrigin);\n    float y = dot(plane.xyz, posAtOrigin);\n\n    float dx = max(abs(x) - length(basis), 0.0);\n    float dy = y;\n\n    float dist = length(vec2(dx, dy));\n\n    float width = fwidth(y);\n    float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;\n    float pixelDist = dist / min(width, maxPixelDistance);\n    return abs(pixelDist);\n  }\n\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\n\n    vec4 color = laserlineProfile(distance);\n    float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\n\n    gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n  }\n  "])))),t}}).apply(null,r))||(e.exports=i)},UidR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("TMur"),n("LxLY"),n("Rdxj"),n("mmEe")],void 0===(i=(function(e,t,n,r,i,a){"use strict";function o(e,t){return s[0]=e.x,s[1]=e.y,s[2]=e.hasZ?e.z:0,a.vectorToWGS84ComparableLonLat(s,e.spatialReference,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.pointToWGS84ComparableLonLatPoint=t.pointToWGS84ComparableLonLat=t.pointToVector=t.pointToPoint=t.vectorToDehydratedPoint=t.vectorToPoint=void 0,t.vectorToPoint=function(e,t,i,o){return o=r.isSome(o)?o:new n.Point({spatialReference:i}),a.bufferToBuffer(e,t,0,s,i,0,1)?(o.x=s[0],o.y=s[1],o.z=s[2],o.spatialReference=i,o):null},t.vectorToDehydratedPoint=function(e,t,n,i){return r.isNone(i)&&(i=n.spatialReference),a.bufferToBuffer(e,t,0,s,i,0,1)?(n.x=s[0],n.y=s[1],n.z=s[2],n.spatialReference=i,n):null},t.pointToPoint=function(e,t,n,r){void 0===n&&(n=t.spatialReference),void 0===r&&(r=0),s[0]=e.x,s[1]=e.y;var i=e.z;return s[2]=void 0!==i?i:r,!!a.bufferToBuffer(s,e.spatialReference,0,s,n,0,1)&&(t.x=s[0],t.y=s[1],t.spatialReference=n,void 0!==i?(t.z=s[2],t.hasZ=!0):(t.z=void 0,t.hasZ=!1),!0)},t.pointToVector=function(e,t,n,r){void 0===r&&(r=0),s[0]=e.x,s[1]=e.y;var i=e.z;return s[2]=void 0!==i?i:r,a.bufferToBuffer(s,e.spatialReference,0,t,n,0,1)},t.pointToWGS84ComparableLonLat=o,t.pointToWGS84ComparableLonLatPoint=function(e,t){return!!o(e,s)&&(t.x=s[0],t.y=s[1],t.z=s[2],!0)};var s=i.vec3f64.create()}).apply(null,r))||(e.exports=i)},VQEQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("W9tT"),n("DIqE"),n("O7NG"),n("fese"),n("hs8d"),n("uUnu"),n("aRjO"),n("PaEL"),n("3PFg"),n("IwVr"),n("rCq5"),n("DKwL"),n("2o+p"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g){"use strict";function y(e,t){var n,i,a;return void 0===t&&(t=L),e.textureIsSignedDistanceField?((a=t)[0]=(n=e.anchorPos)[0]*((i=e.distanceFieldBoundingBox)[2]-i[0])+i[0],a[1]=n[1]*(i[3]-i[1])+i[1]):r.vec2.copy(t,e.anchorPos),t}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateAnchorPosForRendering=t.HUDMaterial=t.build=void 0,t.build=function(e){var t=new g.ShaderBuilder,r=e.signedDistanceFieldEnabled;if(t.include(s.AlignPixel),t.include(l.HUD,e),t.include(o.Slice,e),6===e.output)return t.include(c.HUDOcclusionPass,e),t;t.include(v.ScreenSizePerspective),t.fragment.include(f.RgbaFloatEncoding),t.fragment.include(h.ColorConversion),t.include(p.VisualVariables,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),r&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(m.glsl(x||(x=n.__makeTemplateObject(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "],["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),m.glsl(e.screenSizePerspectiveEnabled?_||(_=n.__makeTemplateObject(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "],["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "])):b||(b=n.__makeTemplateObject(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"],["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var i=m.glsl(w||(w=n.__makeTemplateObject(["\n      vec2 uv01 = floor(uv0);\n      vec2 uv = uv0 - uv01;\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "],["\n      vec2 uv01 = floor(uv0);\n      vec2 uv = uv0 - uv01;\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "]))),a=m.glsl(r?S||(S=n.__makeTemplateObject(["\n  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"],["\n  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"])):O||(O=n.__makeTemplateObject(["\n  posProj += quadOffset;\n  if (inputSize.x == size.x) {\n    posProj = alignToPixelOrigin(posProj, viewport.zw);\n  }"],["\n  posProj += quadOffset;\n  if (inputSize.x == size.x) {\n    posProj = alignToPixelOrigin(posProj, viewport.zw);\n  }"])));t.vertex.code.add(m.glsl(M||(M=n.__makeTemplateObject(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "],["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "])),e.occlusionTestEnabled?"if (visible) {":"",i,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",m.glsl.float(d.symbolAlphaCutoff),r?"alphaDiscard = alphaDiscard && outlineColor.a < "+m.glsl.float(d.symbolAlphaCutoff)+";":"",a,e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?m.glsl(P||(P=n.__makeTemplateObject(["} else { vtc = vec2(0.0);\n        ",""],["} else { vtc = vec2(0.0);\n        ",""])),e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),t.fragment.uniforms.add("tex","sampler2D"),r&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));var y=e.debugDrawBorder?m.glsl(C||(C=n.__makeTemplateObject(["(isBorder > 0.0 ? 0.0 : ",")"],["(isBorder > 0.0 ? 0.0 : ",")"])),m.glsl.float(d.defaultMaskAlphaCutoff)):m.glsl.float(d.defaultMaskAlphaCutoff),L=m.glsl(T||(T=n.__makeTemplateObject(["\n    ","\n\n    ","\n\n    ","\n  "],["\n    ","\n\n    ","\n\n    ","\n  "])),e.debugDrawBorder?m.glsl(D||(D=n.__makeTemplateObject(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"],["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",r?m.glsl(R||(R=n.__makeTemplateObject(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "],["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),y,m.glsl.float(d.symbolAlphaCutoff),y):m.glsl(A||(A=n.__makeTemplateObject(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "],["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),y),e.debugDrawBorder?m.glsl(E||(E=n.__makeTemplateObject(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"],["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");return 0===e.output&&t.fragment.code.add(m.glsl(j||(j=n.__makeTemplateObject(["\n    void main() {\n      ","\n    }\n    "],["\n    void main() {\n      ","\n    }\n    "])),L)),4===e.output&&(t.include(u.OutputHighlight),t.fragment.code.add(m.glsl(V||(V=n.__makeTemplateObject(["\n    void main() {\n      ","\n      ","\n    }\n    "],["\n    void main() {\n      ","\n      ","\n    }\n    "])),L,e.binaryHighlightOcclusionEnabled?m.glsl(I||(I=n.__makeTemplateObject(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"],["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t},function(e){e.bindUniforms=function(e,t,n){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",a.vec4f64.ZEROS),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*n,2*t.screenOffset[1]*n),e.setUniform2fv("anchorPos",y(t))}}(t.HUDMaterial||(t.HUDMaterial={})),t.calculateAnchorPosForRendering=y;var _,b,x,w,S,O,P,M,C,D,R,A,E,T,j,I,V,L=i.vec2f64.create()}).apply(null,r))||(e.exports=i)},X5J5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("QDcU"),n("KtQ6"),n("pcDC"),n("O7NG"),n("FbvD")],void 0===(i=(function(e,t,n,r,i,a,o,s){"use strict";function l(e,t){var n=e.clone();return n.a*=t,n}function c(e,t){var n=e.clone(),r=i.toHSV(n);r.s*=t;var a=i.toRGB(r);return n.r=a.r,n.g=a.g,n.b=a.b,n}function u(e,t){if(t)for(var n in t)e[n]=t[n]}Object.defineProperty(t,"__esModule",{value:!0}),t.settings=t.colors=void 0,t.colors={main:new r([255,127,0]),selected:new r([255,255,255]),staged:new r([12,207,255]),outline:new r([0,0,0,.5]),selectedOutline:new r([255,255,255])};var p=function(){function e(e){this.color=t.colors.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.occludedMode="always",u(this,e)}return Object.defineProperty(e.prototype,"occludedFlag",{get:function(){return S(this.occludedMode)},enumerable:!1,configurable:!0}),e}(),d=function(){function e(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=t.colors.main,this.outlineColor=t.colors.outline,this.occludedMode="always",this.hoverOutlineColor=t.colors.selectedOutline,u(this,e)}return Object.defineProperty(e.prototype,"renderOccludedFlag",{get:function(){return S(this.occludedMode)},enumerable:!1,configurable:!0}),e.prototype.apply=function(e,t){var n=this[e];t.setParameterValues({color:w(n),transparent:"color"!==e||n.a<1}),t.renderOccluded=this.renderOccludedFlag},e}(),h=function(e){this.vertex=new d({color:t.colors.main,outlineColor:t.colors.outline}),this.edge=new d({color:c(l(t.colors.main,2/3),.5),outlineColor:l(t.colors.outline,.5),size:8,collisionPadding:8}),this.selected=new d({color:t.colors.selected,outlineColor:t.colors.outline}),u(this,e)},f=function(){function e(e){this.color=t.colors.selected,this.width=1.5,this.stipplePattern=s.createStipplePattern([5,5]),this.stippleOffColor=t.colors.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=t.colors.selected,this.occludedMode="transparent",this.occludedLayer="default",u(this,e)}return e.prototype.apply=function(e){e.color=w(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=w(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=w(this.innerColor),e.occludedMode=S(this.occludedMode,{layer:this.occludedLayer})},e}(),v=function(){function e(e){this.color=t.colors.selected,this.size=4,this.outlineSize=1,this.outlineColor=t.colors.outline,this.shape="square",u(this,e)}return e.prototype.apply=function(e){e.color=w(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=w(this.outlineColor),e.primitive=this.shape},e}(),m=function(){function e(e){this.innerColor=t.colors.selected,this.innerWidth=1,this.glowColor=t.colors.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=t.colors.main,u(this,e)}return e.prototype.apply=function(e,t){void 0===t&&(t=1);var n={glowColor:r.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:r.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=n:e.laserlineStyle=n},e}(),g=function(e){this.outline=new f({color:t.colors.selected,occludedMode:"transparent",occludedLayer:"foreground",stippleOffColor:t.colors.outline,stipplePattern:s.createStipplePattern([5,5]),width:1.5}),this.staged=new f({color:t.colors.selected,occludedMode:"transparent",occludedLayer:"foreground",innerColor:t.colors.staged,stippleOffColor:t.colors.outline,stipplePattern:s.createStipplePattern([5,5]),width:1.5}),this.shadowStyle=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:1}),u(this,e)},y=function(e){this.outline=new v({color:t.colors.selected,outlineColor:t.colors.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:1.5,glowWidth:6,innerColor:t.colors.selected,innerWidth:1,radius:2}),u(this,e)},_=function(e){function t(t){var n=e.call(this)||this;return n.infinite="ground",u(n,t),n}return n.__extends(t,e),Object.defineProperty(t.prototype,"infiniteType",{get:function(){switch(this.infinite){case"single":return 1;case"double":return 2;case"ground":return 3;default:return a.neverReached(this.infinite),1}},enumerable:!1,configurable:!0}),t}(f),b=function(e){this.lineGraphics=new g,this.pointGraphics=new y,this.heightPlane=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:1}),this.heightBox=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:0,heightFillColor:t.colors.main}),this.zVerticalLine=new _({color:l(t.colors.main,.5),falloff:2,innerColor:l(t.colors.selected,0),occludedMode:"transparent",stipplePattern:null,width:5,infinite:"ground"}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,u(this,e)},x=function(){function e(e){this.visualElements=new b,this.reshapeManipulators=new h,this.zManipulator=new p,u(this,e)}return e.prototype.colorToVec4=function(e){return w(e)},e}();function w(e){return o.vec4f64.fromArray(r.toUnitRGBA(e))}function S(e,t){var n=t&&"foreground"===t.layer;switch(e){case"always":return n?32:16;case"transparent":return n?8:4;case"always-transparent":return 2;default:a.neverReached(e)}return 1}t.settings=new x}).apply(null,r))||(e.exports=i)},Xakh:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";function i(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "],["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "]))))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.Reprojection=void 0,t.Reprojection=i,function(e){e.bindUniforms=function(e,t,n){e.setUniform1i("lastFrameColorMap",n.lastFrameColorTextureID),t.bindTexture(n.lastFrameColorTexture,n.lastFrameColorTextureID),e.setUniformMatrix4fv("reprojectionMat",n.reprojectionMat),e.setUniformMatrix4fv("rpProjectionMat",n.camera.projectionMatrix)}}(i=t.Reprojection||(t.Reprojection={}))}).apply(null,r))||(e.exports=i)},XcBT:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("KQg4"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("G0ER"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureTechniqueConfiguration=t.TextureTechnique=void 0;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get().build();return new c(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),l.Default3D)},t.prototype.initializePipeline=function(){return u.makePipelineState(this.configuration.hasAlpha?{blending:u.separateBlendingParams(770,1,771,771),colorWrite:u.defaultColorWriteParams}:{colorWrite:u.defaultColorWriteParams})},t.shader=new a.ReloadableShaderModule(i,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("KQg4")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(o.ShaderTechnique);t.TextureTechnique=p;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasAlpha=!1,t}return r.__extends(t,e),r.__decorate([s.parameter()],t.prototype,"hasAlpha",void 0),t}(s.ShaderTechniqueConfiguration);t.TextureTechniqueConfiguration=d}).apply(null,r))||(e.exports=i)},YseA:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResizableFloat32Array=void 0;var r=function(){function e(e){null==e?e=16:e<65536&&(e=n.nextHighestPowerOfTwo(e)),this._array=new Float32Array(e),this._size=0}return e.prototype.resize=function(e,t){if(this._size=e,this._size>this._array.length){for(var n=this._array.length||1;n<this._size;)n*=2;var r=new Float32Array(n);return t&&r.set(this._array),this._array=r,!0}var i=2*this._size;if(i<=this._array.length){for(n=this._array.length;n>=i;)n=Math.floor(n/2);return r=new Float32Array(n),t&&r.set(this._array.subarray(0,n)),this._array=r,!0}return!1},e.prototype.append=function(e){var t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)},e.prototype.erase=function(e,t){for(var n=e;n<t;++n)this._array[n]=0},Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),e}();t.ResizableFloat32Array=r}).apply(null,r))||(e.exports=i)},ZO6V:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("KY0m"),n("BcWh"),n("Rdxj"),n("W0kZ"),n("mYMs")],void 0===(i=(function(e,t,n,r,i,a,o,s){"use strict";return function(e){function t(n,r,i){var o=e.call(this)||this;return o._parentStages=new Map,o._objects=new Set,o.id=t._idGen.gen(n),o.apiLayerUid=i,o.name=n,o.group=(r=r||{}).group||"",o.isVisible=null==r.isVisible||r.isVisible,o.isPickable=null==r.isPickable||r.isPickable,o.isSliceable=!1,o.translation=r.translation?a.vec3f64.clone(r.translation):a.vec3f64.create(),o}return n.__extends(t,e),t.prototype.addParentStage=function(e){if(!this._parentStages.has(e)){var t=this.on("dirty",(function(t){e.notifyDirty(t.origin,t.dirtyType,t.subObject)}));this._parentStages.set(e,t)}},t.prototype.removeParentStage=function(e){var t=this._parentStages.get(e);t&&(t.remove(),this._parentStages.delete(e)),this.invalidateSpatialQueryAccelerator()},t.prototype.getName=function(){return this.name},t.prototype.getGroup=function(){return this.group},t.prototype.getTranslation=function(){return this.translation},t.prototype.getObjectIds=function(){return r.keysOfSet(this._objects,(function(e){return e.id}))},t.prototype.getObjects=function(){return r.keysOfSet(this._objects)},t.prototype.addObject=function(e){this._objects.add(e),e.parentLayer=this,this.notifyDirty("layerObjectAdded",e),this._octree&&this._octree.add(e)},t.prototype.hasObject=function(e){return this._objects.has(e)},t.prototype.removeObject=function(e){return!!this._objects.delete(e)&&(e.parentLayer=null,this.notifyDirty("layerObjectRemoved",e),this._octree&&this._octree.remove(e),!0)},t.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},t.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._objects.size>50&&this._createOctree(),this._octree},t.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},t.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)},t.prototype.notifyDirty=function(e,t,n,r){n=n||0,this.emit("dirty",{origin:r||this,dirtyType:e,subObject:t})},t.prototype._createOctree=function(){this._octree=new s({getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(r.keysOfSet(this._objects))},t._idGen=new o.IdGen,t}(i)}).apply(null,r))||(e.exports=i)},ZeO9:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("R2Zq"),n("R2Zq"),n("LxLY"),n("LxLY"),n("FXVB"),n("1m5D"),n("MzcX"),n("FLCf"),n("YseA"),n("CIy2"),n("CP88"),n("pbva"),n("PwS/"),n("QFi0"),n("Kfys"),n("z2+Q")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g){"use strict";var y=function(){function e(e,t,n){this.type="MergedRenderer",this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._rctx=e,this._material=n,this._materialRep=t,this._glMaterials=f.acquireMaterials(this._material,this._materialRep),this._bufferWriter=n.createBufferWriter()}return e.prototype.dispose=function(){f.releaseMaterials(this._material,this._materialRep),this._dataByOrigin&&(this._dataByOrigin.forEach((function(e){e.vao.dispose(!0),e.vao=null})),this._dataByOrigin.clear(),this._dataByOrigin=null),this._glMaterials&&(this._glMaterials.forEach((function(e){e&&e.dispose()})),this._glMaterials.clear(),this._glMaterials=null)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasOccludees",{get:function(){return this._hasOccludees},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasWater",{get:function(){return!this.isEmpty&&r.someMap(this._glMaterials,(function(e){return e instanceof d.WaterGLMaterial}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rendersOccluded",{get:function(){return!this.isEmpty&&1!==this._material.renderOccluded},enumerable:!1,configurable:!0}),e.prototype.modify=function(e){this.updateGeometries(e.toUpdate),this.addAndRemoveGeometries(e.toAdd,e.toRemove),this.updateRenderCommands()},e.prototype.addAndRemoveGeometries=function(e,t){var n=this,r=this._bufferWriter,i=r.vertexBufferLayout,a=i.stride/4,o=this._dataByOrigin,s=function(e,t,n,r){for(var i=new Map,a=t.vertexBufferLayout.stride/4,o=function(n,r){var o=n.origin,s=e.get(o.id),l=i.get(o.id);null==l&&i.set(o.id,l={optimalCount:null==s?0:s.optimalCount,sparseCount:null==s?0:s.buffer.size,toAdd:[],toRemove:[],origin:o.vec3});var c=t.elementCount(n.data)*a;r?(l.optimalCount+=c,l.sparseCount+=c,l.toAdd.push(n)):(l.optimalCount-=c,l.toRemove.push(n))},s=0,l=n;s<l.length;s++){var c=l[s];o(c,!0)}for(var u=0,p=r;u<p.length;u++)o(c=p[u],!1);return i}(o,r,e,t);s.forEach((function(e,t){s.delete(t);var r=e.optimalCount,l=e.sparseCount,c=o.get(t);if(null==c&&(p.assert(r>0),c=n.createData(i,r,e.origin),o.set(t,c)),0===r)return c.vao.dispose(!0),c.vao=null,void o.delete(t);var u=r<e.sparseCount/2,d=_,h=c.buffer.size,f=c.buffer.array,v=c.buffer.resize(u?r:l,!1);u||v?n.removeAndRebuild(c,e.toRemove,a,f,d):e.toRemove.length>0?(n.removeByErasing(c,e.toRemove,a,d),e.toAdd.length>0&&(d.end=h)):(d.begin=h,d.end=h);var m=b;p.setMatrixTranslation3(m,-e.origin[0],-e.origin[1],-e.origin[2]),n.append(c,e.toAdd,a,m,d);var g=c.vao.vertexBuffers.geometry;if(g.byteSize!==c.buffer.array.buffer.byteLength)g.setData(c.buffer.array);else{var y=d.begin,x=d.end;if(y<x){var w=4*y;g.setSubData(c.buffer.array,w,w,4*x)}}c.drawCommandsDirty=!0}))},e.prototype.updateGeometries=function(e){for(var t=this._bufferWriter,n=t.vertexBufferLayout.stride/4,r=0,i=e;r<i.length;r++){var a=i[r],o=a.updateType,s=a.renderGeometry,l=this._dataByOrigin.get(s.origin.id),c=l&&l.instances.get(s.uniqueName);if(!c)return;if(1&o&&(c.isVisible=s.instanceParameters.visible),9&o&&(c.hasHighlights=!!s.instanceParameters.highlights&&s.instanceParameters.visible),16&o&&(c.hasOccludees=!!s.instanceParameters.occludees),6&o){var u=l.buffer.array,d=l.vao;f.calculateTransformRelToOrigin(s,x,w),t.write({transformation:x,invTranspTransformation:w},s.data,t.vertexBufferLayout.createView(u.buffer),c.from),p.assert(c.from+t.elementCount(s.data)===c.to,"material VBO layout has changed"),d.vertexBuffers.geometry.setSubData(u,c.from*n*4,c.from*n*4,c.to*n*4)}l.drawCommandsDirty=!0}},e.prototype.updateRenderCommands=function(){this._dataByOrigin.forEach((function(e){e.hasHiddenInstances=r.someMap(e.instances,(function(e){return!e.isVisible})),e.hasHighlights=r.someMap(e.instances,(function(e){return e.isVisible&&e.hasHighlights})),e.hasOccludees=r.someMap(e.instances,(function(e){return e.isVisible&&e.hasOccludees}))})),this._hasHighlights=r.someMap(this._dataByOrigin,(function(e){return e.hasHighlights})),this._hasOccludees=r.someMap(this._dataByOrigin,(function(e){return e.hasOccludees})),this._dataByOrigin.forEach((function(e){e.drawCommandsDirty&&(function(e){if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.stats={default:0,highlight:0,occludees:0},0!==e.instances.size){if(!(e.hasOccludees||e.hasHighlights||e.hasHiddenInstances)){var t=4*e.buffer.size/m.getStride(e.vao.layout.geometry);return e.drawCommandsDefault=[{first:0,count:t}],void(e.stats={default:t,highlight:0,occludees:0})}var r=h.sortInstancesAccordingToRange(n.valuesOfMap(e.instances));e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[];for(var i=0,a=r;i<a.length;i++){var o=a[i];o.isVisible&&(h.addOrMerge(o.hasOccludees?e.drawCommandsOccludees:e.drawCommandsDefault,o),o.hasHighlights&&h.addOrMerge(e.drawCommandsHighlight,o))}var s=function(e){for(var t=0,n=0,r=e;n<r.length;n++)t+=r[n].count;return t/3};e.stats={default:s(e.drawCommandsDefault),highlight:s(e.drawCommandsHighlight),occludees:s(e.drawCommandsOccludees)}}}(e),e.drawCommandsDirty=!1)}))},e.prototype.updateLogic=function(e){return this._material.update(e)},e.prototype.render=function(e,t,n,r){var o=this,s=this._rctx,l=this._glMaterials.get(t.pass),u=4===t.pass,p=e;if(2===t.pass&&null===p&&(p=22),!l||2!==l.ensureResources(s)||null!=p&&!l.beginSlot(p)||u&&!this._hasHighlights)return!1;l.ensureParameters(n);var d=l.getTechnique(),h=l.getPipelineState(p,!1);s.setPipelineState(h),l.bind(s,n);var f=!1;return this._dataByOrigin.forEach((function(e){if(!(i.isNone(e.drawCommandsDefault)&&i.isNone(e.drawCommandsHighlight)&&i.isNone(e.drawCommandsOccludees))&&(!u||e.hasHighlights)){n.origin=e.origin,d.bindDraw(n),d.ensureAttributeLocations(e.vao),s.bindVAO(e.vao);var t=d.primitiveType,v=u?e.drawCommandsHighlight:e.drawCommandsDefault,m=u?e.stats.highlight:e.stats.default;if(a.isSome(v)&&(o.renderCommands(s,t,v),c.addToRenderStats(v.length,m,r),f=!0),!u&&a.isSome(v=e.drawCommandsOccludees)){var g=l.getPipelineState(p,!0);s.setPipelineState(g),o.renderCommands(s,t,v),s.setPipelineState(h),c.addToRenderStats(v.length,e.stats.occludees,r),f=!0}}})),f},e.prototype.renderCommands=function(e,t,n){for(var r=0;r<n.length;r++)e.drawArrays(t,n[r].first,n[r].count)},e.prototype.createData=function(e,t,n){return{instances:new Map,vao:new g(this._rctx,this._material.vertexAttributeLocations,{geometry:l.glLayout(e)},{geometry:v.createVertex(this._rctx,35044)}),buffer:new u.ResizableFloat32Array(t),optimalCount:0,origin:n,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,stats:{default:0,highlight:0,occludees:0}}},e.prototype.removeAndRebuild=function(e,t,n,r,i){for(var a=0,o=t;a<o.length;a++){var s=o[a].uniqueName,l=e.instances.get(s);e.optimalCount-=(l.to-l.from)*n,e.instances.delete(s)}var c=0,u=e.buffer.array;i.begin=0,i.end=0;var p=-1,d=-1,h=0;e.instances.forEach((function(e){var t=e.from*n,i=e.to*n,a=i-t;p!==d&&d!==t?(u.set(r.subarray(p,d),h),h+=d-p,p=t):-1===p&&(p=t),d=i,e.from=c/n,e.to=(c+=a)/n})),p!==d&&u.set(r.subarray(p,d),h),i.end=c},e.prototype.removeByErasing=function(e,t,n,r){r.begin=1/0,r.end=-1/0;for(var i=-1,a=-1,o=0,s=t;o<s.length;o++){var l=s[o].uniqueName,c=e.instances.get(l),u=c.from*n,p=c.to*n;i!==a&&a!==u?(e.buffer.erase(i,a),i=u):-1===i&&(i=u),a=p,e.instances.delete(l),e.optimalCount-=p-u,u<r.begin&&(r.begin=u),p>r.end&&(r.end=p)}i!==a&&e.buffer.erase(i,a)},e.prototype.append=function(e,t,n,r,i){for(var s=this._bufferWriter,l=0,c=t;l<c.length;l++){var u=c[l],d=a.isSome(u.transformation)?o.mat4.multiply(x,r,u.transformation):r;o.mat4.invert(w,d),o.mat4.transpose(w,w);var f=i.end;s.write({transformation:d,invTranspTransformation:w},u.data,s.vertexBufferLayout.createView(e.buffer.array.buffer),i.end/n);var v=s.elementCount(u.data)*n,m=f+v;p.assert(null==e.instances.get(u.uniqueName));var g=u.instanceParameters.visible,y=new h.Instance(f/n,m/n,g,!!u.instanceParameters.highlights&&g,!!u.instanceParameters.occludees);e.instances.set(u.uniqueName,y),e.optimalCount+=v,i.end+=v}},Object.defineProperty(e.prototype,"test",{get:function(){return{material:this._material,glMaterials:this._glMaterials}},enumerable:!1,configurable:!0}),e}(),_={begin:0,end:0},b=s.mat4f64.create(),x=s.mat4f64.create(),w=s.mat4f64.create();return y}).apply(null,r))||(e.exports=i)},aRjO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.HUDOcclusion=t.HUDOcclusionPass=void 0,t.HUDOcclusionPass=function(e){var t=e;t.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "],["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])))),t.fragment.uniforms.add("color","vec4"),t.fragment.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n  void main() {\n    gl_FragColor = color;\n  }\n  "],["\n  void main() {\n    gl_FragColor = color;\n  }\n  "]))))},function(e){e.bindUniforms=function(e){e.setUniform4f("color",1,1,1,1)}}(t.HUDOcclusion||(t.HUDOcclusion={}))}).apply(null,r))||(e.exports=i)},ama6:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("51bw"),n("vlC2")],void 0===(i=(function(e,t,n,r){"use strict";var i;return function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:r.vec3f32.fromValues(1,1,1),vvSizeMaxSize:r.vec3f32.fromValues(100,100,100),vvSizeOffset:r.vec3f32.fromValues(0,0,0),vvSizeFactor:r.vec3f32.fromValues(1,1,1),vvSizeValue:r.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:n.mat3f64.create()}}(i||(i={})),i}).apply(null,r))||(e.exports=i)},as1Q:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrapedVisualElementResources=void 0;var r=function(){function e(e){this.resourceFactory=e,this._resources=null,this._hidden=!1,this._attached=!1}return e.prototype.destroy=function(){this._destroyResources()},Object.defineProperty(e.prototype,"resources",{get:function(){return n.isSome(this._resources)?this._resources.external:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this._hidden},set:function(e){e!==this._hidden&&(this._hidden=e,this._syncGeometriesToRenderer())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())},enumerable:!1,configurable:!0}),e.prototype.recreate=function(){this.attached&&this._createResources()},e.prototype.recreateGeometry=function(){this.resourceFactory.recreateGeometry?n.isNone(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()},e.prototype._createOrDestroyResources=function(){this._attached?n.isNone(this._resources)&&this._createResources():this._destroyResources()},e.prototype._createResources=function(){this._destroyResources();var e=this.resourceFactory.createResources();this._resources={layerView:{view:this.resourceFactory.view,notifyGraphicUpdate:function(){},watch:function(){return{remove:function(){}}}},external:e,geometriesAdded:!1},this._syncGeometriesToRenderer()},e.prototype._destroyResources=function(){n.isNone(this._resources)||(this.ensureRenderGeometriesRemoved(),this._resources=null)},e.prototype._syncGeometriesToRenderer=function(){this._hidden?this.ensureRenderGeometriesRemoved():this._hidden||this.ensureRenderGeometriesAdded()},e.prototype.ensureRenderGeometriesRemoved=function(){n.isNone(this._resources)||this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)},e.prototype.ensureRenderGeometriesAdded=function(){n.isNone(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)},e}();t.DrapedVisualElementResources=r}).apply(null,r))||(e.exports=i)},cjy9:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("CIzB"),n("AzkI"),n("+nCE"),n("62Ht"),n("CIy2"),n("PwS/")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d){"use strict";return function(){function e(e,t,n,r,i,a,s){this.uniqueName=null,this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.boundingInfo=t,this.material=n,this.origin=null,this.center=o.vec3f64.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=i,r&&this.updateTransformation(r,a),this.castShadow=s,this.instanceParameters={highlights:null,occludees:null,visible:!0}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,n){return t=t||l.maxScale(e),a.vec3.transformMat4(n,this.boundingInfo.getCenter(),e),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!1,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=i.mat4f64.create()),r.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(n.unwrapOr(this.transformation,s.IDENTITY))),this.shaderTransformationDirty=!1),this.shaderTransformation):n.unwrapOr(this.transformation,s.IDENTITY)},e.prototype.computeAttachmentOrigin=function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(n.isSome(this.transformation)&&a.vec3.transformMat4(e,e,this.transformation),!0);var t=this.getIndices(p.VertexAttrConstants.POSITION),r=this.getAttribute(p.VertexAttrConstants.POSITION);return!!c.computeAttachmentOriginTriangles(r,t,e)&&(n.isSome(this.transformation)&&a.vec3.transformMat4(e,e,this.transformation),!0)},e.prototype.getIndices=function(e){return"indices"in this.data?this.data.indices[e]:null},e.prototype.getAttribute=function(e){return"vertexAttr"in this.data?this.data.vertexAttr[e]:null},e.prototype.addHighlight=function(){var e=u.generateObject3DStateId(0),t=this.instanceParameters;return t.highlights=d.addObject3DStateID(t.highlights,e),e},e.prototype.removeHighlight=function(e){var t=this.instanceParameters;t.highlights=d.removeObject3DStateID(t.highlights,e)},e}()}).apply(null,r))||(e.exports=i)},dXKx:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("LxLY"),n("x7Wq"),n("CF4u"),n("NsXp"),n("Z91k"),n("35hF")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorPolygonSymbol2D=t.errorPolylineSymbol2D=t.errorPointSymbol2D=t.getDefaultSymbol2D=t.defaultTextSymbol2D=t.defaultPolygonSymbol2D=t.defaultPolylineSymbol2D=t.defaultPointSymbol2D=void 0,t.defaultPointSymbol2D=o.fromJSON(l.defaultPointSymbolJSON),t.defaultPolylineSymbol2D=a.fromJSON(l.defaultPolylineSymbolJSON),t.defaultPolygonSymbol2D=i.fromJSON(l.defaultPolygonSymbolJSON),t.defaultTextSymbol2D=s.fromJSON(l.defaultTextSymbolJSON),t.getDefaultSymbol2D=function(e){if(r.isNone(e))return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return t.defaultPointSymbol2D;case"polyline":return t.defaultPolylineSymbol2D;case"polygon":case"extent":return t.defaultPolygonSymbol2D;default:n.neverReached(e)}return null},t.errorPointSymbol2D=o.fromJSON(l.errorPointSymbolJSON),t.errorPolylineSymbol2D=a.fromJSON(l.errorPolylineSymbolJSON),t.errorPolygonSymbol2D=i.fromJSON(l.errorPolygonSymbolJSON)}).apply(null,r))||(e.exports=i)},"dl/g":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("KY0m")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getShaderOutputID=t.ShaderOutputTypes=void 0,t.ShaderOutputTypes=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"}],t.getShaderOutputID=function(e,r){return e+"_"+n.find(t.ShaderOutputTypes,(function(e){return e.output===r})).name}}).apply(null,r))||(e.exports=i)},dtql:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("CqfC"),n("KwnQ"),n("W9tT"),n("DIqE"),n("21p4"),n("lRq4"),n("AzkI"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.primaryShapeOrientation=t.createGraphicMoveDragPipeline=void 0,t.createGraphicMoveDragPipeline=function(e,t,n){var r=e.graphic,i=function(e,n){return t({action:e,graphic:r,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY})};return n((function(e,t,n){t.next((function(e){return"start"===e.action&&i("start",e),e})).next(u.dragGraphic(r)).next((function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&i("update",e);break;case"end":i("end",e)}return e})),n.next(u.resetGraphic(r)).next((function(){i("end",{screenDeltaX:0,screenDeltaY:0})}))}))},t.primaryShapeOrientation=function(e){if(n.isNone(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=s.convexHull(e),i=t&&t.rings&&t.rings[0];if(!i)return 0;!function(e){for(var t=0,n=0,r=0,i=e;r<i.length;r++){var a=i[r];t+=a[0],n+=a[1]}t/=e.length,n/=e.length;for(var o=0,s=e;o<s.length;o++)(a=s[o])[0]-=t,a[1]-=n}(i);for(var o=[],u=0;u<i.length-1;u++){var f=Math.atan2(i[u+1][1]-i[u][1],i[u+1][0]-i[u][0]),v=c.cyclical2PI.normalize(f)%(Math.PI/2);o.push(v)}for(var m=o.sort((function(e,t){return e-t})),g=null,y=0,_=Number.POSITIVE_INFINITY,b=0,x=0,w=m;x<w.length;x++)if((f=w[x])!==g){g=f,r.mat2.fromRotation(p,f),l.empty(d);for(var S=0,O=i;S<O.length;S++)a.vec2.transformMat2(h,O[S],p),l.expandPointInPlace(d,h);var P=l.area(d);((P>_?_/P:P/_)>=.99&&f<y||P<_)&&(y=f,_=P),b=Math.max(b,P)}return _/b>=.95?0:y};var p=i.mat2f64.create(),d=l.create(),h=o.vec2f64.create()}).apply(null,r))||(e.exports=i)},eHCP:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("Rdxj")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fromValues=t.fromVector=void 0,t.fromVector=function(e,t){return{vec3:n.vec3f64.clone(e),id:t}},t.fromValues=function(e,t,r,i){return{vec3:n.vec3f64.fromValues(e,t,r),id:i}}}).apply(null,r))||(e.exports=i)},fOZq:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("sSIw"),n("yVFQ")],void 0===(i=(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ElevationContext=void 0;var a=function(){function e(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return Object.defineProperty(e.prototype,"featureExpressionInfoContext",{get:function(){return this._featureExpressionInfoContext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=r.getMetersPerUnit(e)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"},Object.defineProperty(e.prototype,"offsetMeters",{set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetElevationInfoUnits",{set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0},enumerable:!1,configurable:!0}),e.prototype.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e},e.prototype.geometryZWithOffset=function(e,t){var n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n},e.prototype.calculateOffsetRenderUnits=function(e){var t=this._meterUnitOffset,n=this.featureExpressionInfoContext;return null!=n&&(t+=i.execute(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset},e.prototype.setFromElevationInfo=function(e){this.mode=e.mode,this.unit=e.unit||"meters",this.offsetElevationInfoUnits=n.unwrapOr(e.offset,0)},e.prototype.updateFeatureExpressionInfoContext=function(e,t,r){if(n.isNone(e))this._featureExpressionInfoContext=null;else{var a=e&&e.arcade;a&&n.isSome(t)&&n.isSome(r)?(this._featureExpressionInfoContext=i.clone(e),i.setContextFeature(this._featureExpressionInfoContext,i.createFeature(a.modules,t,r))):this._featureExpressionInfoContext=e}},e.fromElevationInfo=function(t){var r=new e;return n.isSome(t)&&r.setFromElevationInfo(t),r},e}();t.ElevationContext=a}).apply(null,r))||(e.exports=i)},fQ2U:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("O7NG"),n("fese"),n("2NOe"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("NiJV"),n("G0ER"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShadedColorMaterialTechniqueConfiguration=t.ShadedColorMaterialTechnique=void 0;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get(),r=this.configuration,i=n.build({slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new d(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),u.Default3D)},t.prototype.bindPass=function(e,t,n){o.View.bindProjectionMatrix(this.program,n.camera.projectionMatrix);var r=t.color,i=t.shadingTint;this.program.setUniform4fv("color",r),this.program.setUniform4fv("shadedColor",this.blendColor(m,i,r)),this.program.setUniform3fv("shadingDirection",t.shadingDirection),this.program.setUniformMatrix4fv("viewNormal",n.camera.viewInverseTransposeMatrix)},t.prototype.blendColor=function(e,t,n){var r=1-t[3],i=t[3]+n[3]*r;return 0===i?(e[3]=i,e):(e[0]=(t[0]*t[3]+n[0]*n[3]*r)/i,e[1]=(t[1]*t[3]+n[1]*n[3]*r)/i,e[2]=(t[2]*t[3]+n[2]*n[3]*r)/i,e[3]=n[3],e)},t.prototype.bindDraw=function(e){o.View.bindView(this.program,e),a.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){var e,t=this.configuration,n=0===t.output?t.transparent&&h.separateBlendingParams(770,1,771,771):null;return h.makePipelineState({blending:n,culling:(e=t.cullFace,0!==e&&{face:1===e?1028:1029,mode:2305}),depthTest:{func:515},depthWrite:t.writeDepth&&h.defaultDepthWriteParams,colorWrite:h.defaultColorWriteParams})},t.shader=new s.ReloadableShaderModule(p,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("NiJV")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(l.ShaderTechnique);t.ShadedColorMaterialTechnique=f;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.transparent=!1,t.writeDepth=!0,t}return r.__extends(t,e),r.__decorate([c.parameter({count:7})],t.prototype,"output",void 0),r.__decorate([c.parameter({count:3})],t.prototype,"cullFace",void 0),r.__decorate([c.parameter()],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([c.parameter()],t.prototype,"sliceHighlightDisabled",void 0),r.__decorate([c.parameter()],t.prototype,"transparent",void 0),r.__decorate([c.parameter()],t.prototype,"writeDepth",void 0),t}(c.ShaderTechniqueConfiguration);t.ShadedColorMaterialTechniqueConfiguration=v;var m=i.vec4f64.create()}).apply(null,r))||(e.exports=i)},fUJJ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("xoE+"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("qSzK"),n("G0ER"),n("qbr3"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LaserlineTechniqueConfiguration=t.LaserlineTechnique=void 0;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get().build(this.configuration);return new u(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),l.Default3D)},t.prototype.bind=function(e,t){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*t.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*t.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1);var n=null!=e.angleCutoff?e.angleCutoff:c.defaultAngleCutoff;this.program.setUniform2f("angleCutoff",Math.cos(n),Math.cos(Math.max(0,n-i.deg2rad(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",t.perScreenPixelRatio)},t.prototype.initializePipeline=function(){return d.makePipelineState({blending:p.simpleBlendingParams(1,771),colorWrite:d.defaultColorWriteParams})},t.shader=new a.ReloadableShaderModule(c,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("qSzK")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(o.ShaderTechnique);t.LaserlineTechnique=h;var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.heightManifoldEnabled=!1,t.pointDistanceEnabled=!1,t.lineVerticalPlaneEnabled=!1,t.intersectsLineEnabled=!1,t.contrastControlEnabled=!1,t}return r.__extends(t,e),r.__decorate([s.parameter()],t.prototype,"heightManifoldEnabled",void 0),r.__decorate([s.parameter()],t.prototype,"pointDistanceEnabled",void 0),r.__decorate([s.parameter()],t.prototype,"lineVerticalPlaneEnabled",void 0),r.__decorate([s.parameter()],t.prototype,"intersectsLineEnabled",void 0),r.__decorate([s.parameter()],t.prototype,"contrastControlEnabled",void 0),t}(s.ShaderTechniqueConfiguration);t.LaserlineTechniqueConfiguration=f}).apply(null,r))||(e.exports=i)},gG9S:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("0LE5"),n("Rdxj"),n("DJpR"),n("MzcX"),n("2B1V"),n("raiv")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LaserlinePathData=void 0;var c=function(){function e(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=i.vec3f64.create(),this._dirty=!1,this._count=0,this._vao=null}return Object.defineProperty(e.prototype,"vertices",{set:function(e){for(var t=new Float64Array(3*e.length),n=0,r=0,i=e;r<i.length;r++){var a=i[r];t[n++]=a[0],t[n++]=a[1],t[n++]=a[2]}this.buffers=[t]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffers",{set:function(e){if(this._buffers=e,this._buffers.length>0){var t=this._buffers[0],n=3*Math.floor(t.length/3/2);r.vec3.set(this._origin,t[n+0],t[n+1],t[n+2])}else r.vec3.set(this._origin,0,0,0);this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),e.prototype.draw=function(e){var t=this.ensureVAO(e);n.isSome(t)&&(e.bindVAO(t),e.drawArrays(4,0,this._count))},e.prototype.dispose=function(){n.isSome(this._vao)&&this._vao.dispose()},e.prototype.ensureVAO=function(e){return n.isNone(this._buffers)?null:(n.isNone(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)},e.prototype.createVAO=function(e,t){var n=this.createDataBuffer(t);return this._dirty=!1,new a.VertexArrayObject(e,l.LaserlinePathTechnique.attributeLocations,{data:o.glLayout(d)},{data:a.BufferObject.createVertex(e,35044,n)})},e.prototype.ensureVertexData=function(e,t){if(this._dirty){var n=this.createDataBuffer(t);e.vertexBuffers.data.setData(n),this._dirty=!1}},e.prototype.numberOfRenderVertices=function(e){return 2*(e.length/3-1)*3},e.prototype.createDataBuffer=function(e){var t=this,n=e.reduce((function(e,n){return e+t.numberOfRenderVertices(n)}),0);this._count=n;for(var i=d.createBuffer(n),a=this._origin,o=0,s=0,l=0,c=e;l<c.length;l++){for(var h=c[l],f=0;f<h.length;f+=3){var v=r.vec3.set(p,h[f+0],h[f+1],h[f+2]);0===f?s=this._renderCoordsHelper.getAltitude(v):this._renderCoordsHelper.setAltitude(s,v);var m=this._renderCoordsHelper.worldUpAtPosition(v,u),g=o+2*f,y=r.vec3.subtract(p,v,a);if(f<h.length-3){i.up.setVec(g,m),i.up.setVec(g+3,m),i.up.setVec(g+5,m);for(var _=0;_<6;_++)i.start.setVec(g+_,y);i.extrude.setValues(g+0,0,-1),i.extrude.setValues(g+1,1,-1),i.extrude.setValues(g+2,1,1),i.extrude.setValues(g+3,0,-1),i.extrude.setValues(g+4,1,1),i.extrude.setValues(g+5,0,1)}if(f>0)for(i.up.setVec(g-2,m),i.up.setVec(g-4,m),i.up.setVec(g-5,m),_=-6;_<0;_++)i.end.setVec(g+_,y)}o+=this.numberOfRenderVertices(h)}return i.buffer},e}();t.LaserlinePathData=c;var u=i.vec3f64.create(),p=i.vec3f64.create(),d=s.newLayout().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude")}).apply(null,r))||(e.exports=i)},gxI5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisualElement=void 0;var n=function(){function e(e){this._attached=!1,this._visible=!0,this.view=e}return e.prototype.applyProps=function(e){var t=!1;for(var n in e)n in this?"attached"===n?t=e[n]:this[n]=e[n]:console.error("Cannot set unknown property",n);this.attached=t},e.prototype.destroy=function(){this.attached=!1},Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._attached?this.createResources():this.destroyResources())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))},enumerable:!1,configurable:!0}),e}();t.VisualElement=n}).apply(null,r))||(e.exports=i)},hADE:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("LxLY"),n("rusB"),n("0LE5"),n("Rdxj"),n("3Zlx"),n("HbaO"),n("/9Lg"),n("mmEe"),n("ij3I"),n("AgDx"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h){"use strict";function f(e,t,n){for(var r=new Array,i=0,a=e;i<a.length;i++){var o=a[i],s=o.count;if(!(s<=1)){var l=3*o.index,c=l+3*s;r.push({position:t.subarray(l,c),mapPosition:n?n.subarray(l,c):void 0})}}return r}Object.defineProperty(t,"__esModule",{value:!0}),t.geometryToRenderInfoDraped=t.geometryToRenderInfo=t.createGeometryData=void 0,t.createGeometryData=function(e){var t={},o={};!function(e,t,n){for(var r=e.attributeData.position,a=(p=r)[0]===p[(d=p.length)-3]&&p[1]===p[d-2]&&p[2]===p[d-1]&&1===e.removeDuplicateStartEnd,o=r.length/3-(a?1:0),s=new Uint32Array(2*(o-1)),l=a?i.slice(r,0,r.length-3):r,c=0,u=0;u<o-1;u++)s[c++]=u,s[c++]=u+1;var p,d;t[h.RibbonVertexAttributeConstants.POSITION]={size:3,data:l,offsetIdx:0,strideIdx:3},n[h.RibbonVertexAttributeConstants.POSITION]=s}(e,o,t);var s=new Uint32Array(t[h.RibbonVertexAttributeConstants.POSITION].length);return function(e,t,n){var i=e.attributeData.mapPosition;r.isNone(i)||(n.mapPos=n[h.RibbonVertexAttributeConstants.POSITION],t.mapPos={size:3,data:i,offsetIdx:0,strideIdx:3})}(e,o,t),function(e,t,n,i){r.isSome(e.attributeData.colorFeature)||(t[h.RibbonVertexAttributeConstants.COLOR]={size:4,data:r.unwrapOr(e.attributeData.color,l.WHITE_UNIT),offsetIdx:0,strideIdx:4},n[h.RibbonVertexAttributeConstants.COLOR]=i)}(e,o,t,s),function(e,t,n,i){r.isSome(e.attributeData.sizeFeature)||(t[h.RibbonVertexAttributeConstants.SIZE]={size:1,data:new Float32Array([r.unwrapOr(e.attributeData.size,1)]),offsetIdx:0,strideIdx:1},n[h.RibbonVertexAttributeConstants.SIZE]=i)}(e,o,t,s),function(e,t,n,i){var a=e.attributeData.colorFeature;r.isNone(a)||(t[h.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE]={size:1,data:new Float32Array([a]),offsetIdx:0,strideIdx:1},n[h.RibbonVertexAttributeConstants.COLOR]=i)}(e,o,t,s),function(e,t,n,i){var a=e.attributeData.sizeFeature;r.isNone(a)||(t[h.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]={size:1,data:new Float32Array([a]),offsetIdx:0,strideIdx:1},n[h.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]=i)}(e,o,t,s),function(e,t,n,i){var a=e.attributeData.opacityFeature;r.isNone(a)||(t[h.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:new Float32Array([a]),offsetIdx:0,strideIdx:1},n[h.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]=i)}(e,o,t,s),function(e,t,i){if("round"===e.join){var o=t[h.RibbonVertexAttributeConstants.POSITION].data,s=o.length/3,l=new Float32Array(s),c=v,u=m;a.vec3.set(c,0,0,0);for(var p=r.unwrapOr(e.uniformSize,1),d=-1;d<s;++d){var f=d<0?s+d:d,y=(d+1)%s;if(a.vec3.set(u,o[3*y+0]-o[3*f+0],o[3*y+1]-o[3*f+1],o[3*y+2]-o[3*f+2]),a.vec3.normalize(u,u),d>=0){var _=(Math.PI-n.acosClamped(a.vec3.dot(c,u)))*g*1*(1.863798+-2.0062872/Math.pow(1+p/18.2313,.8856294));l[d]=Math.max(Math.floor(_),0)}a.vec3.scale(c,u,-1)}t[h.RibbonVertexAttributeConstants.SUBDIVISIONS]={size:1,data:l,offsetIdx:0,strideIdx:1},i[h.RibbonVertexAttributeConstants.SUBDIVISIONS]=i[h.RibbonVertexAttributeConstants.POSITION]}}(e,o,t),new d.GeometryData(o,t,"line")},t.geometryToRenderInfo=function(e,t,n,r){var i=s.pathsToTriangulationInfo("polygon"===e.type?e.rings:e.paths,e.hasZ,"polygon"===e.type?1:0),a=i.position,o=i.outlines,l=new Float64Array(a.length),u=c.applyPerVertexElevationAlignment(a,e.spatialReference,0,l,0,a,0,a.length/3,t,n,r),p=null!=u;return{lines:p?f(o,a,l):[],projectionSuccess:p,sampledElevation:u}},t.geometryToRenderInfoDraped=function(e,t){for(var n=s.pathsToTriangulationInfo("polygon"===e.type?e.rings:e.paths,!1,"polygon"===e.type?1:0),r=n.position,i=n.outlines,a=u.bufferToBuffer(r,e.spatialReference,0,r,t,0,r.length/3),o=2;o<r.length;o+=3)r[o]=p.DRAPED_Z;return{lines:a?f(i,r):[],projectionSuccess:a}};var v=o.vec3f64.create(),m=o.vec3f64.create(),g=4/Math.PI}).apply(null,r))||(e.exports=i)},hX2R:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("LxLY"),n("DIqE"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("gG9S"),n("/Bau"),n("CIy2"),n("s6rJ"),n("raiv"),n("fUJJ")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LaserLineRenderer=void 0;var m=o.vec3f64.create(),g=l.vec4f64.create(),y={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:n.deg2rad(6),globalAlphaContrastBoost:2};function _(e,t,n,r){var i=m,o=g;a.vec3.transformMat4(i,t,r),a.vec3.copy(o,n),o[3]=0,s.vec4.transformMat4(o,o,r),c.plane.fromPositionAndNormal(i,o,e)}var b=function(){function e(e,t,n){void 0===t&&(t={}),void 0===n&&(n={contrastControlEnabled:!1}),this._technique=null,this._projInfo=l.vec4f64.create(),this._zScale=i.vec2f64.create(),this._heightManifoldEnabled=!1,this._heightManifoldTarget=o.vec3f64.create(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=o.vec3f64.create(),this._pointDistanceTarget=o.vec3f64.create(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=c.lineSegment.create(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=c.lineSegment.create(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=o.vec3f64.create(),this._tempDir=o.vec3f64.create(),this._tempUp=o.vec3f64.create(),this._tempVec3A=o.vec3f64.create(),this._tempVec3B=o.vec3f64.create(),this._tempVec4=l.vec4f64.create(),this._tempPlane=c.plane.create(),this._tempSphere=c.sphere.create(),this._renderCoordsHelper=e,this._params=h.copyParameters(t,y),this._config=n}return Object.defineProperty(e.prototype,"renderSlots",{get:function(){return[this._config.contrastControlEnabled?17:16]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needsLinearDepth",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heightManifoldEnabled",{get:function(){return this._heightManifoldEnabled},set:function(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heightManifoldTarget",{get:function(){return this._heightManifoldTarget},set:function(e){a.vec3.copy(this._heightManifoldTarget,e),this._requestRender()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointDistanceEnabled",{get:function(){return this._pointDistanceEnabled},set:function(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointDistanceTarget",{get:function(){return this._pointDistanceTarget},set:function(e){a.vec3.copy(this._pointDistanceTarget,e),this._requestRender()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointDistanceOrigin",{get:function(){return this._pointDistanceOrigin},set:function(e){a.vec3.copy(this._pointDistanceOrigin,e),this._requestRender()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineVerticalPlaneEnabled",{get:function(){return this._lineVerticalPlaneEnabled},set:function(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineVerticalPlaneSegment",{get:function(){return this._lineVerticalPlaneSegment},set:function(e){c.lineSegment.copy(e,this._lineVerticalPlaneSegment),this._requestRender()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineEnabled",{get:function(){return this._intersectsLineEnabled},set:function(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineSegment",{get:function(){return this._intersectsLineSegment},set:function(e){c.lineSegment.copy(e,this._intersectsLineSegment),this._requestRender()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineRadius",{get:function(){return this._intersectsLineRadius},set:function(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineInfinite",{get:function(){return this._intersectsLineInfinite},set:function(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pathVerticalPlaneEnabled",{get:function(){return this._pathVerticalPlaneEnabled},set:function(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,r.isSome(this._pathVerticalPlaneData)&&this._requestRender())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pathVerticalPlaneVertices",{set:function(e){r.isNone(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new u.LaserlinePathData(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pathVerticalPlaneBuffers",{set:function(e){r.isNone(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new u.LaserlinePathData(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()},enumerable:!1,configurable:!0}),e.prototype.setParameterValues=function(e){h.updateParameters(this._params,e)&&this._requestRender()},e.prototype.initializeRenderContext=function(e){this._initContext=e,this._quadVAO=p.createQuadVAO(e.rctx),this._techniqueRepository=e.shaderTechniqueRep,this._techniqueConfig=new v.LaserlineTechniqueConfiguration,this._pathTechniqueConfig=new f.LaserlinePathTechniqueConfiguration},e.prototype.uninitializeRenderContext=function(){this._quadVAO.dispose(),this._quadVAO=null,r.isSome(this._technique)&&this._techniqueRepository.release(this._technique),r.isSome(this._pathVerticalPlaneData)&&this._pathVerticalPlaneData.dispose(),r.isSome(this._pathTechnique)&&this._techniqueRepository.release(this._pathTechnique)},e.prototype.render=function(e){var t=this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,n=this.pathVerticalPlaneEnabled;if(!t&&!n)return!0;var r=e.camera;return d.inverseProjectionInfo(r.projectionMatrix,r.fullWidth,r.fullHeight,this._projInfo,this._zScale),t&&this.renderUnified(e),n&&this.renderPath(e),!0},e.prototype.renderUnified=function(e){var t=e.rctx,n=this._selectTechnique(),r=n.program;t.bindProgram(r),n.bindPipelineState(t),this.bindGlobalUniforms(e,r),this.bindHeightManifoldUniforms(e,r),this.bindPointDistanceUniforms(e,r),this.bindLineVerticalPlaneUniforms(e,r),this.bindIntersectsLineUniforms(e,r),n.bind(this._params,e.camera),t.bindVAO(this._quadVAO),t.drawArrays(5,0,4)},e.prototype.renderPath=function(e){if(!r.isNone(this._pathVerticalPlaneData)){this._pathTechniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquireAndReleaseExisting(f.LaserlinePathTechnique,this._pathTechniqueConfig,this._pathTechnique);var t=e.rctx,n=this._pathTechnique,i=n.program;t.bindProgram(i),n.bindPipelineState(t),this.bindGlobalUniforms(e,i),n.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx)}},e.prototype.bindHeightManifoldUniforms=function(e,t){if(this.heightManifoldEnabled){var n=this._tempVec3A,r=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,n),_(r,this._heightManifoldTarget,n,e.camera.viewMatrix),t.setUniform4fv("heightPlane",r)}},e.prototype.bindPointDistanceUniforms=function(e,t){if(this._pointDistanceEnabled){var n=e.camera,r=this._tempSphere;a.vec3.copy(r.center,this._pointDistanceOrigin),a.vec3.transformMat4(r.center,r.center,n.viewMatrix),r.radius=a.vec3.distance(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",r.center[0],r.center[1],r.center[2],r.radius)}},e.prototype.bindLineVerticalPlaneUniforms=function(e,t){if(this._lineVerticalPlaneEnabled){var n=this._renderCoordsHelper,r=e.camera,i=this._tempPlane,o=this._tempVec3A,s=this._tempUp,l=this._tempDir,u=this._tempNormal;c.lineSegment.pointAt(this._lineVerticalPlaneSegment,.5,o),n.worldUpAtPosition(o,s),a.vec3.normalize(l,this._lineVerticalPlaneSegment.vector),a.vec3.cross(u,s,l),a.vec3.normalize(u,u),_(i,this._lineVerticalPlaneSegment.origin,u,r.viewMatrix),t.setUniform4fv("lineVerticalPlane",i);var p=this._tempVec3A;a.vec3.copy(p,this._lineVerticalPlaneSegment.origin),n.setAltitude(0,p),a.vec3.transformMat4(p,p,r.viewMatrix),t.setUniform3fv("lineVerticalStart",p);var d=this._tempVec3B;a.vec3.add(d,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),n.setAltitude(0,d),a.vec3.transformMat4(d,d,r.viewMatrix),t.setUniform3fv("lineVerticalEnd",d)}},e.prototype.bindIntersectsLineUniforms=function(e,t){if(this._intersectsLineEnabled){var n=w,r=S;if(this._intersectsLineInfinite){var i=e.camera;if(c.clipRay.fromRay(c.ray.wrap(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),x),x.c0=-Number.MAX_VALUE,!c.frustum.intersectClipRay(i.frustum.planes,x))return;c.clipRay.getStart(x,n),c.clipRay.getEnd(x,r)}else a.vec3.copy(n,this._intersectsLineSegment.origin),a.vec3.add(r,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);var o=this._tempVec3A;a.vec3.transformMat4(o,n,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",o);var l=this._tempVec4;a.vec3.copy(l,this._intersectsLineSegment.vector),this._tempVec4[3]=0,s.vec4.transformMat4(this._tempVec4,this._tempVec4,e.camera.viewMatrix),a.vec3.transformMat4(r,r,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",r),a.vec3.normalize(l,l),t.setUniform3f("intersectsLineDirection",l[0],l[1],l[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}},e.prototype.bindGlobalUniforms=function(e,t){var n=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2f("nearFar",n.near,n.far),this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.setUniform1i("depthMap",0),e.rctx.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,0),t.setUniform1i("frameColor",1),e.rctx.bindTexture(e.offscreenRenderingHelper.mainColorTexture,1)},e.prototype._requestRender=function(){this._initContext&&this._initContext.requestRender()},e.prototype._selectTechnique=function(){return this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.acquireAndReleaseExisting(v.LaserlineTechnique,this._techniqueConfig,this._technique),this._technique},e}();t.LaserLineRenderer=b;var x=c.clipRay.create(),w=o.vec3f64.create(),S=o.vec3f64.create()}).apply(null,r))||(e.exports=i)},hk44:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("6vp1"),n("58az"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,a){"use strict";var o,s,l,c,u,p;Object.defineProperty(t,"__esModule",{value:!0}),t.Laserline=void 0,t.Laserline=function(e,t){e.extensions.add("GL_OES_standard_derivatives"),e.include(r.ReadLinearDepth),e.include(i.CameraSpace),e.fragment.uniforms.add("glowColor","vec3"),e.fragment.uniforms.add("glowWidth","float"),e.fragment.uniforms.add("glowFalloff","float"),e.fragment.uniforms.add("innerColor","vec3"),e.fragment.uniforms.add("innerWidth","float"),e.fragment.uniforms.add("depthMap","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&e.fragment.uniforms.add("globalAlphaContrastBoost","float"),e.fragment.code.add(a.glsl(o||(o=n.__makeTemplateObject(["\n  vec4 blendPremultiplied(vec4 source, vec4 dest) {\n    float oneMinusSourceAlpha = 1.0 - source.a;\n\n    return vec4(\n      source.rgb + dest.rgb * oneMinusSourceAlpha,\n      source.a + dest.a * oneMinusSourceAlpha\n    );\n  }\n  "],["\n  vec4 blendPremultiplied(vec4 source, vec4 dest) {\n    float oneMinusSourceAlpha = 1.0 - source.a;\n\n    return vec4(\n      source.rgb + dest.rgb * oneMinusSourceAlpha,\n      source.a + dest.a * oneMinusSourceAlpha\n    );\n  }\n  "])))),e.fragment.code.add(a.glsl(s||(s=n.__makeTemplateObject(["\n  vec4 premultipliedColor(vec3 rgb, float alpha) {\n    return vec4(rgb * alpha, alpha);\n  }\n  "],["\n  vec4 premultipliedColor(vec3 rgb, float alpha) {\n    return vec4(rgb * alpha, alpha);\n  }\n  "])))),e.fragment.code.add(a.glsl(l||(l=n.__makeTemplateObject(["\n  vec4 laserlineProfile(float dist) {\n    if (dist > glowWidth) {\n      return vec4(0.0);\n    }\n\n    float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\n    float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\n\n    return blendPremultiplied(\n      premultipliedColor(innerColor, innerAlpha),\n      premultipliedColor(glowColor, glowAlpha)\n    );\n  }\n  "],["\n  vec4 laserlineProfile(float dist) {\n    if (dist > glowWidth) {\n      return vec4(0.0);\n    }\n\n    float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\n    float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\n\n    return blendPremultiplied(\n      premultipliedColor(innerColor, innerAlpha),\n      premultipliedColor(glowColor, glowAlpha)\n    );\n  }\n  "])))),e.fragment.code.add(a.glsl(c||(c=n.__makeTemplateObject(["\n  bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\n    float depth = linearDepthFromTexture(depthMap, uv, nearFar);\n\n    if (-depth == nearFar[0]) {\n      return false;\n    }\n\n    pos = reconstructPosition(gl_FragCoord.xy, depth);\n    normal = normalize(cross(dFdx(pos), dFdy(pos)));\n\n    float ddepth = fwidth(depth);\n    depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n\n    return true;\n  }\n  "],["\n  bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\n    float depth = linearDepthFromTexture(depthMap, uv, nearFar);\n\n    if (-depth == nearFar[0]) {\n      return false;\n    }\n\n    pos = reconstructPosition(gl_FragCoord.xy, depth);\n    normal = normalize(cross(dFdx(pos), dFdy(pos)));\n\n    float ddepth = fwidth(depth);\n    depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n\n    return true;\n  }\n  "])))),e.fragment.code.add(a.glsl(t.contrastControlEnabled?u||(u=n.__makeTemplateObject(["\n    float rgbToLuminance(vec3 color) {\n      return dot(vec3(0.2126, 0.7152, 0.0722), color);\n    }\n\n    vec4 laserlineOutput(vec4 color) {\n      float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);\n      float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\n\n      return color * alpha;\n    }\n    "],["\n    float rgbToLuminance(vec3 color) {\n      return dot(vec3(0.2126, 0.7152, 0.0722), color);\n    }\n\n    vec4 laserlineOutput(vec4 color) {\n      float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);\n      float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\n\n      return color * alpha;\n    }\n    "])):p||(p=n.__makeTemplateObject(["\n    vec4 laserlineOutput(vec4 color) {\n      return color * globalAlpha;\n    }\n    "],["\n    vec4 laserlineOutput(vec4 color) {\n      return color * globalAlpha;\n    }\n    "]))))}}).apply(null,r))||(e.exports=i)},hkmr:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("1m5D"),n("0LE5"),n("Rdxj"),n("Z4y+"),n("mmEe"),n("ys4y"),n("AgDx"),n("ZO6V"),n("eHCP"),n("ZJC8"),n("CIy2"),n("RC9r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f){"use strict";var v=0,m=function(){function e(){this.ROOT_ORIGIN_ID="rg_root_"+v++,this._origins=new Map,this._gridSize=42e5}return e.prototype.getOrigin=function(t){var r=this._origins.get(this.ROOT_ORIGIN_ID);if(null==r){if(n.isSome(e.testOrigin)){var a=e.testOrigin;return this._origins.set(this.ROOT_ORIGIN_ID,p.fromValues(a[0],a[1],a[2],this.ROOT_ORIGIN_ID)),this.getOrigin(t)}var o=p.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,o),o}i.vec3.subtract(g,t,r.vec3),g[0]=Math.abs(g[0]),g[1]=Math.abs(g[1]),g[2]=Math.abs(g[2]);var s=this._gridSize;if(g[0]<s&&g[1]<s&&g[2]<s)return r;var l=Math.round(t[0]/s),c=Math.round(t[1]/s),u=Math.round(t[2]/s),d="rg_"+l+"/"+c+"/"+u,h=this._origins.get(d);return h||(h=p.fromValues(l*s,c*s,u*s,d),this._origins.set(d,h)),h},e.prototype._drawOriginBox=function(e){var t=window.view,n=t._stage;if(null==this._object){this._material=new f({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial"),n.add(3,this._material);var i=new u("GridLocalOrigin",{isPickable:!1});n.add(0,i),this._object=new d({idHint:"GridLocalOrigin",castShadow:!1}),n.add(1,this._object),i.addObject(this._object),n.addToViewContent([i.id])}for(var a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=a.length,v=new Float32Array(3*p),m=new Uint32Array(2*(p-1)),g=.5*this._gridSize,y=0;y<p;y++)v[3*y+0]=e[0]+(1&a[y]?g:-g),v[3*y+1]=e[1]+(2&a[y]?g:-g),v[3*y+2]=e[2]+(4&a[y]?g:-g),y>0&&(m[2*y+0]=y-1,m[2*y+1]=y);s.bufferToBuffer(v,o.WebMercator,0,v,t.spatialReference,0,p);var _={};_[h.VertexAttrConstants.POSITION]={size:3,data:v};var b={};b[h.VertexAttrConstants.POSITION]=m;var x=new c.GeometryData(_,b,"line"),w=new l(x,"GridLocalOriginBox");n.add(2,w),this._object.addGeometry(w,this._material,r.mat4f64.IDENTITY),console.log(this._origins.size,e)},e}(),g=a.vec3f64.create();return function(e){e.testOrigin=null}(m||(m={})),m}).apply(null,r))||(e.exports=i)},hs8d:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.AlignPixel=void 0,t.AlignPixel=function(e){var t=r.glsl(i||(i=n.__makeTemplateObject(["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "]))),o=r.glsl(a||(a=n.__makeTemplateObject(["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "])));e.vertex.code.add(t),e.vertex.code.add(o),e.fragment.code.add(t),e.fragment.code.add(o)}}).apply(null,r))||(e.exports=i)},i10q:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("LxLY"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("WRgd"),n("2W+Z"),n("/9Lg"),n("fOZq"),n("J2BX"),n("mmEe"),n("JjCO"),n("ys4y"),n("4ziW"),n("yqrJ"),n("CIy2"),n("xFEL")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointVisualElement=void 0;var b=function(){function e(e){var t=this;this.view=null,this._geometry=null,this._size=3,this._color=s.vec4f64.fromValues(1,0,1,1),this._primitive="square",this._outlineSize=1,this._outlineColor=s.vec4f64.fromValues(1,1,1,1),this._elevationInfo=null,this.resources=new c.VisualElementResources({view:e.view,createResources:function(e){return t.createResources(e)},recreateGeometry:function(e,n){return e.geometry=t.recreateGeometry(n,e.material),r.isSome(e.geometry)?[e.geometry]:[]}});var n=!0;for(var i in e)i in this?"attached"===i?n=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=n}return e.prototype.destroy=function(){this.resources.destroy()},Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached},set:function(e){this.resources.attached=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){if(e!==this._size){var t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?r.isSome(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){o.vec4.exactEquals(e,this._color)||(o.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"primitive",{get:function(){return this._primitive},set:function(e){this._primitive!==e&&(this._primitive=e,r.isSome(this.resources)&&this.resources.recreate())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"outlineSize",{get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(e){o.vec4.exactEquals(e,this._outlineColor)||(o.vec4.copy(this._outlineColor,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),e.prototype.updateMaterial=function(){var e=this.resources.resources;r.isNone(e)||e.material.setParameterValues(this.materialParameters(e.texture.id))},e.prototype.updateSizeAttribute=function(){var e=this.resources.resources,t=this.resources.object;if(!r.isNone(e)&&!r.isNone(t)){var n=e.geometry;if(!r.isNone(n)){var i=n.data.getVertexAttr()[y.VertexAttrConstants.SIZE].data,a=this.geometrySize;i[0]=a,i[1]=a,t.geometryVertexAttrsUpdated(0)}}},e.prototype.materialParameters=function(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:w,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1}},Object.defineProperty(e.prototype,"geometrySize",{get:function(){return this._size/x},enumerable:!1,configurable:!0}),e.prototype.recreateGeometry=function(e,t){var n=this.createRenderGeometry();return r.isSome(n)&&e.addGeometry(n,t),n},e.prototype.createResources=function(e){var t=this.createTexture(),n=new _.default(this.materialParameters(t.id),"pointVisualElement");n.renderOccluded=8;var i=this.recreateGeometry(e,n);return{material:n,texture:t,geometry:i,forEach:function(e){e(t),e(n),r.isSome(this.geometry)&&e(this.geometry)}}},Object.defineProperty(e.prototype,"preferredTextureSize",{get:function(){return n.clamp(n.nextHighestPowerOfTwo(2*this.geometrySize),16,128)},enumerable:!1,configurable:!0}),e.prototype.createTexture=function(){var e=this.preferredTextureSize;return new g(d.createType(this._primitive,e,e*x),"pointVisualElement",{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})},e.prototype.calculateMapBounds=function(e){if(r.isNone(this.resources.resources)||r.isNone(this.resources.resources.geometry))return!1;var t=this.resources.resources.geometry.data.getAttribute("position");return h.vectorToVector(t.data,this.view.renderCoordsHelper.spatialReference,S,this.view.spatialReference),l.expandWithBuffer(e,S),!0},e.prototype.createRenderGeometry=function(){var e=this.geometry;if(r.isNone(e))return null;var t=this.view.renderCoordsHelper,n=u.evaluateElevationAlignmentAtPoint(e,this.view.elevationProvider,p.ElevationContext.fromElevationInfo(this.elevationInfo),t),a=i.vec3.set(f.sv3d.get(),e.x,e.y,n),o=f.sv3d.get();h.vectorToVector(a,e.spatialReference,o,t.spatialReference);var s=this.geometrySize,l=m.createPointGeometry(null,o,null,[s,s],[0,0,0,1]);return new v(l)},e}();t.PointVisualElement=b;var x=.5,w=[x/2,x/2,1-x/2,1-x/2],S=a.vec3f64.create()}).apply(null,r))||(e.exports=i)},ij3I:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("Gtr7"),n("eIBl"),n("qsST"),n("R2Zq"),n("LxLY"),n("LxLY"),n("KBgh"),n("ULaq"),n("8MXS"),n("Vx27"),n("FXVB"),n("DIqE"),n("Rdxj"),n("Dk48"),n("N+ip"),n("GDWR"),n("y68M"),n("KRuQ"),n("RsYQ"),n("FU3N"),n("/Bau"),n("hkmr"),n("9DjX"),n("Raj5"),n("FLCf"),n("Px2u"),n("XcBT"),n("qUb7"),n("QDiq"),n("FbvD"),n("Zp3t"),n("Kfys")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w,S,O,P,M,C,D,R,A,E,T,j,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overlayRenderOccludedFlag=t.DRAPED_Z=t.OverlayRenderer=void 0;var V=a.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer"),L=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._hasHighlights=!1,t._rendersOccluded=!1,t._hasWater=!1,t._lighting=new E.SceneLighting,t._localOrigins=new O,t._handles=new i,t._layerRenderers=new Map,t._sortedLayerRenderersDirty=!1,t._sortedLayerRenderers=new c,t._stats=new C.RenderStatsAggregator,t._geometries=new Map,t._uniqueIdx=0,t.globalUnitScale=1,t.longitudeCyclical=null,t}return n.__extends(r,e),r.prototype.initialize=function(){var e=this;this._rctx=this.renderView.renderingContext,this._renderContext=new M(this._rctx,null,null,null,null,null),this._stippleTextureRepository=new T.StippleTextureRepository,this.waterTextureRepository=this.renderView.waterTextureRepository,this._shaderTechniqueRepository=new _.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:2,commonUniformStore:new y.CommonUniformStore,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),p.init(this.waterTextureRepository,"loadingState",(function(){return e.emitContentChanged()})),this._materialRepository=new w(this.renderView.textureRepository,this._shaderTechniqueRepository),this._materialRepository.onMaterialChanged=function(n){(n.renderOccluded&t.overlayRenderOccludedFlag)>0!==e._rendersOccluded&&e.updateRendersOccluded(),e.emitContentChanged(),e.notifyChange("updating")},this._compositingHelper=this.renderView.compositingHelper,this._lighting.set({lights:[new A.AmbientLight(v.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0}),this._bindParameters={slot:null,highlightDepthTexture:S.createEmptyDepthTexture(this._rctx),camera:U,inverseViewport:f.vec2f64.create(),origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting}},r.prototype.dispose=function(){this._handles.destroy(),this._layerRenderers.forEach((function(e){return e.dispose()})),this._layerRenderers.clear(),this._bindParameters.highlightDepthTexture.dispose(),this._bindParameters.highlightDepthTexture=null,this._shaderTechniqueRepository.dispose(),this._shaderTechniqueRepository=null},Object.defineProperty(r.prototype,"updating",{get:function(){return this._sortedLayerRenderersDirty||o.someMap(this._layerRenderers,(function(e){return e.updating}))||this.waterTextureRepository.updating},enumerable:!1,configurable:!0}),r.prototype.commitChanges=function(){var e=this,t=!1;this._layerRenderers.forEach((function(n,r){n.commitChanges()&&(t=!0),n.isEmpty&&(e._layerRenderers.delete(r),e._sortedLayerRenderersDirty=!0,e._handles.remove(r))})),this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),t=!0),t&&(this.notifyChange("updating"),this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())},r.prototype.addGeometries=function(e,t,n){for(var r=0,i=e;r<i.length;r++){var a=i[r];null==a.origin&&(a.origin=this._localOrigins.getOrigin(a.center)),a.uniqueName||(a.uniqueName="ov:"+this._uniqueIdx++),this._geometries.set(a.uniqueName,a)}this.ensureLayerRenderer(t).add(e),2===n&&this.notifyGraphicUpdate(e,t,2)},r.prototype.removeGeometries=function(e,t,n){for(var r=0,i=e;r<i.length;r++)this._geometries.delete(i[r].uniqueName);var a=this._layerRenderers.get(t);a&&(a.remove(e),2===n&&this.notifyGraphicUpdate(e,t,2))},r.prototype.updateGeometries=function(e,t,n){var r=this._layerRenderers.get(t);r?(r.modify(e,n),this.notifyUpdateGeometries(e,t,n)):V.warn("Attempted to update geometry for nonexistent layer")},r.prototype.notifyUpdateGeometries=function(e,t,n){this.notifyGraphicUpdate(e,t,4===n||2===n?2:1===n?1:0)},r.prototype.notifyGraphicUpdate=function(e,t,n){if(0!==n)for(var r=-1,i=0,a=e;i<a.length;i++){var o=a[i].data.graphicUid;o!==r&&(t.notifyGraphicUpdate(o,n),r=o)}},r.prototype.updateHighlights=function(e,t){var n=this._layerRenderers.get(t);n?n.modify(e,8):V.warn("Attempted to update highlights for nonexistent layer")},r.prototype.isEmpty=function(){return 0===this._geometries.size&&!m.OVERLAY_DRAW_DEBUG_TEXTURE},Object.defineProperty(r.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rendersOccluded",{get:function(){return this._rendersOccluded},enumerable:!1,configurable:!0}),r.prototype.updateLogic=function(e){var t=!1;return this._layerRenderers.forEach((function(n){n.updateLogic(e)&&(t=!0)})),t},r.prototype.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0},r.prototype.drawPass=function(e,n,r,i){var a=this;if(void 0===i&&(i=0),0===r.numViews)return!1;if(this._screenToWorldRatio=r.pixelRatio*Math.abs(r.views[0].extent[2]-r.views[0].extent[0])/Math.abs(r.views[0].viewport[2]-r.views[0].viewport[0]),this.isEmpty()||4===e&&!this.hasHighlights||2===e&&!this.hasWater)return!1;if(!this.hasNonZeroSizedView(r))return!1;var o=r.width,s=r.height;if(!n.isValid())return!1;n.resize(o,s);var c=this._rctx;if(U.pixelRatio=r.pixelRatio||1,this._renderContext.pass=e,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToWorldRatioGlobalWM=this._screenToWorldRatio*this.globalUnitScale,n.bind(c),c.setClearColor(0,0,0,0),c.clearSafe(16384),1===i&&(this._renderContext.renderOccludedMask=t.overlayRenderOccludedFlag),m.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==i)for(var u=0;u<r.numViews;u++)this.setViewParameters(r.views[u],U),this.drawDebugTexture(o,s,N[r.index%N.length]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forEachSimple((function(t){var u=t.layerView,p=t.renderer;if(2!==i||!l.isSome(u)||0!==u.drapeSourceType){var d=l.isSome(u)&&l.isSome(u.fullOpacity)&&u.fullOpacity<1&&0===e;d&&(a.bindTemporaryFramebuffer(a._rctx,o,s),c.clearSafe(16384));for(var h=0;h<r.numViews;h++)a.setViewParameters(r.views[h],U),p.draw(a._renderContext,a._bindParameters,a._stats);d&&l.isSome(a._temporaryRenderTarget)&&(n.bind(c),a._compositingHelper.composite(a._temporaryRenderTarget.getTexture(),2,l.unwrap(l.unwrap(u).fullOpacity)))}})),c.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0},r.prototype.bindTemporaryFramebuffer=function(e,t,n){s.isNone(this._temporaryRenderTarget)&&(this._temporaryRenderTarget=new g.OverlayRenderTarget(e,"temp",0,!1)),this._temporaryRenderTarget.resize(t,n),this._temporaryRenderTarget.bind(e)},r.prototype.getStats=function(){return this._stats.getAggregatedStats()},r.prototype.hotReloadShaders=function(){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(e){switch(e.label){case 0:return[4,this._shaderTechniqueRepository.hotReload()];case 1:return e.sent(),[2]}}))}))},r.prototype.intersect=function(e,t,n){var r=this,i=0;this._geometries.forEach((function(a){if(!n||n(a)){r.intersectRenderGeometry(a,t,0,e,i);var o=r.longitudeCyclical;o&&(a.center[0]-a.bsRadius<o.min&&r.intersectRenderGeometry(a,t,o.range,e,i),a.center[0]+a.bsRadius>o.max&&r.intersectRenderGeometry(a,t,-o.range,e,i)),i++}}))},r.prototype.intersectRenderGeometry=function(e,t,n,r,i){var a=this,o=0;l.isSome(e.transformation)&&(n+=e.transformation[12],o=e.transformation[13]),G[0]=t[0]-n,G[1]=t[1]-o,G[2]=1,F[0]=t[0]-n,F[1]=t[1]-o,F[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),r,G,F,(function(t,n,o){a.addIntersectionResult(o,e.material.renderPriority,i,r,e.data.layerUid,e.data.graphicUid)}),e.calculateShaderTransformation,!0)},r.prototype.addIntersectionResult=function(e,t,n,r,i,a){var o={type:"external",metadata:{layerUid:i,graphicUid:a}},s=function(i){i.set(o,null,r.results.ground.dist,r.results.ground.normal,r.results.ground.transformation,t,null,null,e,n),i.intersector="OverlayRenderer"};if((null==r.results.min.drapedLayerOrder||t>=r.results.min.drapedLayerOrder)&&(null==r.results.min.dist||r.results.ground.dist<=r.results.min.dist)&&s(r.results.min),0!==r.options.store&&(null==r.results.max.drapedLayerOrder||t<r.results.max.drapedLayerOrder)&&(null==r.results.max.dist||r.results.ground.dist>r.results.max.dist)&&s(r.results.max),2===r.options.store){var l=new P.IntersectorResult(r.ray);s(l),r.results.all.push(l)}},r.prototype.stopAnimationsAtTime=function(e){this._sortedLayerRenderers.forEachSimple((function(t){return t.renderer.stopAnimationsAtTime(e)}))},r.prototype.ensureLayerRenderer=function(e){var t=this,n=this._layerRenderers.get(e);return n||(n=new D.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,n),this._sortedLayerRenderersDirty=!0,this._handles.add([e.watch("fullOpacity",(function(){return t.emitContentChanged()})),p.init(n,"updating",(function(){return t.notifyChange("updating")}))],e)),n},r.prototype.updateSortedLayerRenderers=function(){var e=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var t=o.firstKeyOfMap(this._layerRenderers).view.allLayerViews,n=u.SetFromValues(o.valuesOfMap(this._layerRenderers));t.forEach((function(t){var r=t,i=e._layerRenderers.get(r);i&&(e._sortedLayerRenderers.push(new z(r,i)),n.delete(i))})),n.forEach((function(t){e._sortedLayerRenderers.push(new z(null,t))}))}},r.prototype.setViewParameters=function(e,t){t.viewport=e.viewport;var n=e.extent;h.mat4.ortho(t.projectionMatrix,0,n[2]-n[0],0,n[3]-n[1],t.near,t.far),h.mat4.identity(t.viewMatrix),h.mat4.translate(t.viewMatrix,t.viewMatrix,[-e.extent[0],-e.extent[1],0]),t.setGLViewport(this._rctx),this._renderContext.camera=t,this._bindParameters.camera=t,this._bindParameters.inverseViewport[0]=1/t.fullViewport[2],this._bindParameters.inverseViewport[1]=1/t.fullViewport[3]},r.prototype.hasNonZeroSizedView=function(e){for(var t=0;t<e.numViews;t++){var n=e.views[t];if(n.extent[0]!==n.extent[2]&&n.extent[1]!==n.extent[3])return!0}return!1},r.prototype.emitContentChanged=function(){this.onContentChanged&&this.onContentChanged()},r.prototype.updateHasWater=function(){var e=o.someMap(this._layerRenderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e)},r.prototype.updateHasHighlights=function(){var e=o.someMap(this._layerRenderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this._hasHighlights))},r.prototype.updateRendersOccluded=function(){var e=o.someMap(this._layerRenderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.onRendersOccludedChanged&&this.onRendersOccludedChanged(this.rendersOccluded))},r.prototype.drawDebugTexture=function(e,t,n){var r=this._rctx;this.ensureDebugPatternResources(e,t);var i=this._debugPatternProgram;r.bindProgram(i),r.setPipelineState(this._debugPatternPipelineState),i.setUniform4f("color",n[0],n[1],n[2],1),i.setUniform1i("tex",0),r.bindTexture(this._debugPatternTexture,0),r.bindVAO(this._quadVAO),r.drawArrays(5,0,I.vertexCount(this._quadVAO,"geometry"))},r.prototype.ensureDebugPatternResources=function(e,t){if(!this._debugPatternTexture){for(var n=new Uint8Array(e*t*4),r=0,i=0;i<t;i++)for(var a=0;a<e;a++){var o=Math.floor(a/10),s=Math.floor(i/10);o<2||s<2||10*o>e-20||10*s>t-20?(n[r++]=255,n[r++]=255,n[r++]=255,n[r++]=255):(n[r++]=255,n[r++]=255,n[r++]=255,n[r++]=1&o&&1&s?1&a^1&i?0:255:1&o^1&s?0:128)}this._debugPatternTexture=new j(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},n);var l=new R.TextureTechniqueConfiguration;l.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(R.TextureTechnique,l,this._debugTextureTechnique),this._debugPatternProgram=this._debugTextureTechnique.program,this._debugPatternPipelineState=this._debugTextureTechnique.pipeline,this._quadVAO=S.createQuadVAO(this._rctx)}},Object.defineProperty(r.prototype,"test",{get:function(){return{layerRenderers:this._layerRenderers}},enumerable:!1,configurable:!0}),n.__decorate([b.autoDispose()],r.prototype,"_shaderTechniqueRepository",void 0),n.__decorate([b.autoDispose()],r.prototype,"_stippleTextureRepository",void 0),n.__decorate([d.property(),b.autoDispose()],r.prototype,"waterTextureRepository",void 0),n.__decorate([d.property()],r.prototype,"renderView",void 0),n.__decorate([d.property()],r.prototype,"globalUnitScale",void 0),n.__decorate([d.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating"]})],r.prototype,"updating",null),n.__decorate([d.subclass("esri.views.3d.terrain.OverlayRenderer")],r)}(b.AutoDisposableMixin(r));t.OverlayRenderer=L;var z=function(e,t){this.layerView=e,this.renderer=t},N=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],U=new x.default;U.near=1,U.far=1e4,U.relativeElevation=null;var G=v.vec3f64.create(),F=v.vec3f64.create();t.DRAPED_Z=-2,t.overlayRenderOccludedFlag=4}).apply(null,r))||(e.exports=i)},j2SP:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("3gjc")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec4f32=void 0,t.vec4f32=n}).apply(null,r))||(e.exports=i)},jl7D:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("cmSR"),n("fese"),n("3kdR"),n("PaEL"),n("pLfv"),n("cj3m"),n("vGsU"),n("RdU/"),n("IwVr"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h){"use strict";var f,v,m,g,y,_,b,x,w;Object.defineProperty(t,"__esModule",{value:!0}),t.build=void 0,t.build=function(e){var t=new h.ShaderBuilder;return t.include(a.Transform,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0===e.output&&(t.include(s.NormalUtils,e),t.include(r.ForwardLinearDepth,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),t.vertex.code.add(d.glsl(f||(f=n.__makeTemplateObject(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "],["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "])),d.glsl.float(p.symbolAlphaCutoff))),t.include(u.WaterDistortion,e),t.include(i.Slice,e),e.receiveShadows&&t.include(l.ReadShadowMap,e),t.include(c.Water,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.code.add(d.glsl(m||(m=n.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        vec3 l = normalize(-lightingMainDirection);\n        float shadow = ",";\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        vec3 l = normalize(-lightingMainDirection);\n        float shadow = ",";\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "])),e.receiveShadows?d.glsl(v||(v=n.__makeTemplateObject(["1.0 - readShadowMap(vpos, linearDepth)"],["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0"))),2===e.output&&(t.include(s.NormalUtils,e),t.include(u.WaterDistortion,e),t.include(i.Slice,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(d.glsl(g||(g=n.__makeTemplateObject(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),d.glsl.float(p.symbolAlphaCutoff))),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(d.glsl(y||(y=n.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "]))))),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(d.glsl(_||(_=n.__makeTemplateObject(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),d.glsl.float(p.symbolAlphaCutoff))),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(d.glsl(b||(b=n.__makeTemplateObject(["\n        void main() {\n          gl_FragColor = waterColor;\n        }\n    "],["\n        void main() {\n          gl_FragColor = waterColor;\n        }\n    "]))))),4===e.output&&(t.include(o.OutputHighlight),t.varyings.add("vpos","vec3"),t.vertex.code.add(d.glsl(x||(x=n.__makeTemplateObject(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "],["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),d.glsl.float(p.symbolAlphaCutoff))),t.include(i.Slice,e),t.fragment.code.add(d.glsl(w||(w=n.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "]))))),t}}).apply(null,r))||(e.exports=i)},mYMs:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("SyoC"),n("KBgh"),n("0LE5"),n("Rdxj"),n("aWgr"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,a,o,s){"use strict";var l=function(){function e(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth)),this._root=new c(null,a.vec3f64.fromValues(0,0,0),0)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._degenerateObjects.clear(),this._root=null,c.clearPool(),_[0]=null,P.prune(),E.prune(),T.prune()},e.prototype.add=function(e,t){var n=b(e);this._objectCount+=t=null==t?n.length:t,this._grow(n,t);for(var r=c.acquire(),i=0;i<t;i++){var a=n[i];this._isDegenerate(a)?this._degenerateObjects.add(a):(r.init(this._root),this._add(a,r))}c.release(r)},e.prototype.remove=function(e,t){var n=b(e);this._objectCount-=n.length;for(var r=c.acquire(),i=0,a=n;i<a.length;i++){var o=a[i],s=t||this._boundingSphereFromObject(o,M);this._isValidRadius(s.radius)?(r.init(this._root),this._remove(o,s,r)):this._degenerateObjects.delete(o)}c.release(r),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,n){var r=this,i=o.ray.wrap(e,t);this._forEachNode(this._root,(function(e){if(!r._intersectsNode(i,e))return!1;var t=e.node;return t.terminals.forEachSimple((function(e){r._intersectsObject(i,e)&&n(e)})),null!==t.residents&&t.residents.forEachSimple((function(e){r._intersectsObject(i,e)&&n(e)})),!0}))},e.prototype.forEachAlongRayWithVerticalOffset=function(e,t,n,r){var i=this,a=o.ray.wrap(e,t);this._forEachNode(this._root,(function(e){if(!i._intersectsNodeWithOffset(a,e,r))return!1;var t=e.node;return t.terminals.forEachSimple((function(e){i._intersectsObjectWithOffset(a,e,r)&&n(e)})),null!==t.residents&&t.residents.forEachSimple((function(e){i._intersectsObjectWithOffset(a,e,r)&&n(e)})),!0}))},e.prototype.forEach=function(e){this._forEachNode(this._root,(function(t){var n=t.node;return n.terminals.forEachSimple(e),null!==n.residents&&n.residents.forEachSimple(e),!0})),this._degenerateObjects.forEach(e)},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,n,r,i){return this._findClosest(e,"front-to-back"===t?1:-1,n,r,i)},e.prototype.forEachInDepthRange=function(e,t,n,r,i,a,o,s){this._forEachInDepthRange(e,t,"front-to-back"===n?1:-1,r,i,a,o,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,(function(t){return e(t.node,t.center,2*t.halfSize)}))},e.prototype._intersectsNode=function(e,t){return d(t.center,2*-t.halfSize,S),d(t.center,2*t.halfSize,O),s.rayBoxTest(e.origin,e.direction,S,O)},e.prototype._intersectsNodeWithOffset=function(e,t,n){return d(t.center,2*-t.halfSize,S),d(t.center,2*t.halfSize,O),n.applyToMinMax(S,O),s.rayBoxTest(e.origin,e.direction,S,O)},e.prototype._intersectsObject=function(e,t){var n=this._objectToBoundingSphere.getRadius(t);return!(n>0)||o.sphere.intersectsRay(o.sphere.wrap(n,this._objectToBoundingSphere.getCenter(t)),e)},e.prototype._intersectsObjectWithOffset=function(e,t,n){var r=this._objectToBoundingSphere.getRadius(t);return!(r>0)||o.sphere.intersectsRay(n.applyToBoundingSphere(r,this._objectToBoundingSphere.getCenter(t)),e)},e.prototype._forEachNode=function(e,t){for(var n=c.acquire().init(e),r=[n];0!==r.length;){if(t(n=r.pop())&&!n.isLeaf())for(var i=0;i<n.node.children.length;i++)n.node.children[i]&&r.push(c.acquire().init(n).advance(i));c.release(n)}},e.prototype._forEachNodeDepthOrdered=function(e,t,n,r){void 0===r&&(r=1);var i=c.acquire().init(e),a=[i];for(function(e,t,n){if(!E.length)for(var r=0;r<8;++r)E.push({index:0,distance:0});for(r=0;r<8;++r){var i=m[r];E.data[r].index=r,E.data[r].distance=v(e,t,i)}for(E.sort((function(e,t){return e.distance-t.distance})),n.clear(),r=0;r<8;++r)n.push(E.data[r].index)}(n,r,T);0!==a.length;){if(t(i=a.pop())&&!i.isLeaf())for(var o=7;o>=0;--o){var s=T.data[o];s>=i.node.children.length||i.node.children[s]&&a.push(c.acquire().init(i).advance(s))}c.release(i)}},e.prototype._findClosest=function(e,t,n,r,a){var o=this,s=1/0,l=1/0,c=null,u=f(e,t),p=0,d=function(i){if(++p,!r||r(i)){var a=o._objectToBoundingSphere.getCenter(i),u=o._objectToBoundingSphere.getRadius(i);if(!n||!h(a,u,n)){var d=v(e,t,a),f=d-u;f<s&&(s=f,l=d+u,c=i)}}};return this._forEachNodeDepthOrdered(this._root,(function(r){if(null!=a&&p>=a)return!1;if(n&&h(r.center,r.halfSize*y,n))return!1;if(i.vec3.scale(w,u,r.halfSize),i.vec3.add(w,w,r.center),v(e,t,w)>l)return!1;var o=r.node;return o.terminals.forEachSimple((function(e){d(e)})),null!==o.residents&&o.residents.forEachSimple((function(e){d(e)})),!0}),e,t),c},e.prototype._forEachInDepthRange=function(e,t,n,r,a,o,s,l){var c=this,u=-1/0,p=1/0,d={setRange:function(e){1===n?(u=Math.max(u,e.near),p=Math.min(p,e.far)):(u=Math.max(u,-e.far),p=Math.min(p,-e.near))}};d.setRange(r);var m=v(t,n,e),g=f(t,n),_=f(t,-1*n),b=0,x=function(e){if(++b,!s||s(e)){var r=c._objectToBoundingSphere.getCenter(e),i=c._objectToBoundingSphere.getRadius(e),l=v(t,n,r)-m;l-i>p||l+i<u||o&&h(r,i,o)||a(e,d)}};this._forEachNodeDepthOrdered(this._root,(function(e){if(null!=l&&b>=l)return!1;if(o&&h(e.center,e.halfSize*y,o))return!1;if(i.vec3.scale(w,g,e.halfSize),i.vec3.add(w,w,e.center),v(t,n,w)-m>p)return!1;if(i.vec3.scale(w,_,e.halfSize),i.vec3.add(w,w,e.center),v(t,n,w)-m<u)return!1;var r=e.node;return r.terminals.forEachSimple((function(e){x(e)})),null!==r.residents&&r.residents.forEachSimple((function(e){x(e)})),!0}),t,n)},e.prototype._remove=function(e,t,n){P.clear();var r=n.advanceTo(t,(function(e,t){P.push(e.node),P.push(t)}))?n.node.terminals:n.node.residents;if(r.removeUnordered(e),0===r.length)for(var i=P.length-2;i>=0&&this._purge(P.data[i],P.data[i+1]);i-=2);},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new r({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,M))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var n=0;n<t.length;n++){var r=c.acquire().init(e);this._add(t.data[n],r),c.release(r)}},e.prototype._grow=function(e,t){var n=this;if(0!==t){var r=this._boundingSphereFromObjects(e,t,(function(e,t){return n._boundingSphereFromObject(e,t)}),C);if(this._isValidRadius(r.radius)&&!this._fitsInsideTree(r))if(this._nodeIsEmpty(this._root.node))i.vec3.copy(this._root.center,r.center),this._root.halfSize=1.25*r.radius;else{var a=c.acquire();this._rootBoundsForRootAsSubNode(r,a),this._placingRootViolatesMaxDepth(a)?this._rebuildTree(r,a):this._growRootAsSubNode(a),c.release(a)}}},e.prototype._rebuildTree=function(e,t){var n=this;i.vec3.copy(D.center,t.center),D.radius=t.halfSize;var r=this._boundingSphereFromObjects([e,D],2,(function(e){return e}),R),a=c.acquire().init(this._root);this._root.initFrom(null,r.center,1.25*r.radius),this._forEachNode(a,(function(e){return n.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&n.add(e.node.residents.data,e.node.residents.length),!0})),c.release(a)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,(function(e){return t=Math.max(t,e.depth),!0})),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var n=e.radius,r=e.center,i=-1/0,a=this._root.center,o=this._root.halfSize,s=0;s<3;s++){var l=r[s]+n-(a[s]+o),c=Math.max(0,Math.ceil((a[s]-o-(r[s]-n))/(2*o))),u=Math.max(0,Math.ceil(l/(2*o)))+1,p=Math.pow(2,Math.ceil(Math.log(c+u)*Math.LOG2E));i=Math.max(i,p),A[s].min=c,A[s].max=u}for(s=0;s<3;s++){var d=(i-((c=A[s].min)+(u=A[s].max)))/2;c+=Math.ceil(d),u+=Math.floor(d),x[s]=a[s]-o-c*o*2+(u+c)*o}return t.initFrom(null,x,i*o,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;i.vec3.copy(C.center,this._root.center),C.radius=this._root.halfSize,this._root.init(e),e.advanceTo(C,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,n=0,r=0;r<t.length&&null==e;)e=t[n=r++];for(;r<t.length;)if(t[r++])return-1;return n},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,n=this._root.halfSize,r=e.center;return e.radius<=n&&r[0]>=t[0]-n&&r[0]<=t[0]+n&&r[1]>=t[1]-n&&r[1]<=t[1]+n&&r[2]>=t[2]-n&&r[2]<=t[2]+n},e.prototype._boundingSphereFromObject=function(e,t){return i.vec3.copy(t.center,this._objectToBoundingSphere.getCenter(e)),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,n,r){if(1===t){var a=n(e[0],C);i.vec3.copy(r.center,a.center),r.radius=a.radius}else{S[0]=1/0,S[1]=1/0,S[2]=1/0,O[0]=-1/0,O[1]=-1/0,O[2]=-1/0;for(var o=0;o<t;o++)a=n(e[o],C),this._isValidRadius(a.radius)&&(u(S,a.center,a.radius),p(O,a.center,a.radius));i.vec3.lerp(r.center,S,O,.5),r.radius=Math.max(O[0]-S[0],O[1]-S[1],O[2]-S[2])/2}return r},e}(),c=function(){function e(e,t,n){void 0===n&&(n=0),this.center=a.vec3f64.create(),this.initFrom(e,t,n,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,n,r,a){return void 0===t&&(t=null),void 0===r&&(r=this.halfSize),void 0===a&&(a=this.depth),this.node=t||e.createEmptyNode(),n&&i.vec3.copy(this.center,n),this.halfSize=r,this.depth=a,this},e.prototype.advance=function(t){var n=this.node.children[t];n||(n=e.createEmptyNode(),this.node.children[t]=n),this.node=n,this.halfSize/=2,this.depth++;var r=m[t];return this.center[0]+=r[0]*this.halfSize,this.center[1]+=r[1]*this.halfSize,this.center[2]+=r[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,n){for(void 0===n&&(n=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!n)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var r=this._childIndex(e);t&&t(this,r),this.advance(r)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,n=this.center,r=0,i=0;i<3;i++)n[i]<t[i]&&(r|=1<<i);return r},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new r({shrink:!0}),residents:new r({shrink:!0})}},e.acquire=function(){return e._pool.acquire()},e.release=function(t){e._pool.release(t)},e.clearPool=function(){e._pool.prune()},e._pool=new n(e),e}();function u(e,t,n){e[0]=Math.min(e[0],t[0]-n),e[1]=Math.min(e[1],t[1]-n),e[2]=Math.min(e[2],t[2]-n)}function p(e,t,n){e[0]=Math.max(e[0],t[0]+n),e[1]=Math.max(e[1],t[1]+n),e[2]=Math.max(e[2],t[2]+n)}function d(e,t,n){return(n=n||e)[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n}function h(e,t,n){return!o.frustum.intersectsSphere(n.planes,o.sphere.wrap(t,e))}function f(e,t){for(var n=1/0,r=null,i=0;i<8;++i){var a=v(e,t,g[i]);a<n&&(n=a,r=g[i])}return r}function v(e,t,n){return t*(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])}var m=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(1,1,-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(1,-1,1),a.vec3f64.fromValues(-1,1,1),a.vec3f64.fromValues(1,1,1)],g=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(-1,1,1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(1,-1,1),a.vec3f64.fromValues(1,1,-1),a.vec3f64.fromValues(1,1,1)],y=Math.sqrt(3),_=[null];function b(e){return Array.isArray(e)?e:(_[0]=e,_)}var x=a.vec3f64.create(),w=a.vec3f64.create(),S=a.vec3f64.create(),O=a.vec3f64.create(),P=new r,M={center:a.vec3f64.create(),radius:0},C={center:a.vec3f64.create(),radius:0},D={center:a.vec3f64.create(),radius:0},R={center:a.vec3f64.create(),radius:0},A=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],E=new r,T=new r;return l}).apply(null,r))||(e.exports=i)},ne9J:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("E/g4"),n("7zqm"),n("quQL"),n("IwVr"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c){"use strict";var u,p,d,h,f,v,m,g,y,_,b,x,w,S,O,P,M,C,D,R,A,E,T,j,I,V;Object.defineProperty(t,"__esModule",{value:!0}),t.build=void 0,t.build=function(e){var t=new c.ShaderBuilder;t.extensions.add("GL_OES_standard_derivatives"),t.include(o.PiUtils),t.include(i.RibbonVertexPosition,e),t.include(a.LineStipple,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearPlane","float").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3");var L=e.falloffEnabled,z=e.innerColorEnabled;return z&&t.varyings.add("vLineDistance","float"),L&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),t.vertex.code.add(l.glsl(u||(u=n.__makeTemplateObject(["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s = sin(a);\n\t\t\tfloat c = cos(a);\n\t\t\tmat2 m = mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"],["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s = sin(a);\n\t\t\tfloat c = cos(a);\n\t\t\tmat2 m = mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"])))),t.vertex.code.add(l.glsl(p||(p=n.__makeTemplateObject(["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc = proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *= screenSize / posNdc.w;\n      return posNdc;\n    }\n"],["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc = proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *= screenSize / posNdc.w;\n      return posNdc;\n    }\n"])))),t.vertex.code.add(l.glsl(d||(d=n.__makeTemplateObject(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z > -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z < -nearPlane) {\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z < -nearPlane) {\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z > -nearPlane) {\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z > -nearPlane) {\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n"],["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z > -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z < -nearPlane) {\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z < -nearPlane) {\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z > -nearPlane) {\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z > -nearPlane) {\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n"])))),t.vertex.code.add(l.glsl(h||(h=n.__makeTemplateObject(["\n  void main(void) {\n    float coverage = 1.0;\n    vpos = position;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n      bool isJoin = abs(uv0.y)-3.0 < 0.0;\n\n      float lineWidth = getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left = (pos.xy - prev.xy);\n      vec2 right = (next.xy - pos.xy);\n\n      float leftLen = length(left);\n      float rightLen = length(right);\n  "],["\n  void main(void) {\n    float coverage = 1.0;\n    vpos = position;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n      bool isJoin = abs(uv0.y)-3.0 < 0.0;\n\n      float lineWidth = getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left = (pos.xy - prev.xy);\n      vec2 right = (next.xy - pos.xy);\n\n      float leftLen = length(left);\n      float rightLen = length(right);\n  "])))),e.stippleEnabled&&t.vertex.code.add(l.glsl(f||(f=n.__makeTemplateObject(["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos->next, otherwise use prev->pos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection = stippleSegmentInfo.zw;\n    "],["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos->next, otherwise use prev->pos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection = stippleSegmentInfo.zw;\n    "])))),t.vertex.code.add(l.glsl(v||(v=n.__makeTemplateObject(['\n    left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir = vec2(0, 0);\n    vec2 joinDisplacementDir = vec2(0, 0);\n    float displacementLen = lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside = ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir = normalize(left + right);\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen > 0.001 && rightLen > 0.001) {\n        float nDotSeg = dot(joinDisplacementDir, left);\n        displacementLen /= length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside && (displacementLen > miterLimit * lineWidth)) {\n    '],['\n    left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir = vec2(0, 0);\n    vec2 joinDisplacementDir = vec2(0, 0);\n    float displacementLen = lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside = ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir = normalize(left + right);\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen > 0.001 && rightLen > 0.001) {\n        float nDotSeg = dot(joinDisplacementDir, left);\n        displacementLen /= length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside && (displacementLen > miterLimit * lineWidth)) {\n    '])))),t.vertex.code.add(l.glsl(e.roundJoins?m||(m=n.__makeTemplateObject(["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen < 0.001) {\n          startDir = right;\n        }\n        else{\n          startDir = left;\n        }\n        startDir = normalize(startDir);\n        startDir = PERPENDICULAR(startDir);\n\n        if (rightLen < 0.001) {\n          endDir = left;\n        }\n        else{\n          endDir = right;\n        }\n        endDir = normalize(endDir);\n        endDir = PERPENDICULAR(endDir);\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "],["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen < 0.001) {\n          startDir = right;\n        }\n        else{\n          startDir = left;\n        }\n        startDir = normalize(startDir);\n        startDir = PERPENDICULAR(startDir);\n\n        if (rightLen < 0.001) {\n          endDir = left;\n        }\n        else{\n          endDir = right;\n        }\n        endDir = normalize(endDir);\n        endDir = PERPENDICULAR(endDir);\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "])):g||(g=n.__makeTemplateObject(["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen < 0.001) {\n          joinDisplacementDir = right;\n        }\n        else if (rightLen < 0.001) {\n          joinDisplacementDir = left;\n        }\n        else {\n          joinDisplacementDir = isStartVertex ? right : left;\n        }\n        joinDisplacementDir = normalize(joinDisplacementDir);\n        joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n  "],["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen < 0.001) {\n          joinDisplacementDir = right;\n        }\n        else if (rightLen < 0.001) {\n          joinDisplacementDir = left;\n        }\n        else {\n          joinDisplacementDir = isStartVertex ? right : left;\n        }\n        joinDisplacementDir = normalize(joinDisplacementDir);\n        joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n  "])))),t.vertex.code.add(l.glsl(y||(y=n.__makeTemplateObject(["\n        displacementLen = lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen < 0.001) {\n      joinDisplacementDir = right;\n    }\n    else if (rightLen < 0.001) {\n      joinDisplacementDir = left;\n    }\n    else {\n      joinDisplacementDir = isStartVertex ? right : left;\n    }\n    joinDisplacementDir = normalize(joinDisplacementDir);\n    joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n    displacementLen = lineWidth;\n\n    capDisplacementDir = isStartVertex ? -right : left;\n  "],["\n        displacementLen = lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen < 0.001) {\n      joinDisplacementDir = right;\n    }\n    else if (rightLen < 0.001) {\n      joinDisplacementDir = left;\n    }\n    else {\n      joinDisplacementDir = isStartVertex ? right : left;\n    }\n    joinDisplacementDir = normalize(joinDisplacementDir);\n    joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n    displacementLen = lineWidth;\n\n    capDisplacementDir = isStartVertex ? -right : left;\n  "])))),t.vertex.code.add(l.glsl(e.roundCaps?_||(_=n.__makeTemplateObject(["\n    float angle = subdivisionFactor*PI*0.5;\n    joinDisplacementDir *= cos(angle);\n    capDisplacementDir *= sin(angle);\n    "],["\n    float angle = subdivisionFactor*PI*0.5;\n    joinDisplacementDir *= cos(angle);\n    capDisplacementDir *= sin(angle);\n    "])):b||(b=n.__makeTemplateObject(["\n    capDisplacementDir *= subdivisionFactor;\n    "],["\n    capDisplacementDir *= subdivisionFactor;\n    "])))),t.vertex.code.add(l.glsl(O||(O=n.__makeTemplateObject(["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy += dpos;\n  "],["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy += dpos;\n  "])),L||z?l.glsl(x||(x=n.__makeTemplateObject(["float lineDist = lineWidth * sign(uv0.y) * pos.w;"],["float lineDist = lineWidth * sign(uv0.y) * pos.w;"]))):"",z?l.glsl(w||(w=n.__makeTemplateObject(["vLineDistance = lineDist;"],["vLineDistance = lineDist;"]))):"",L?l.glsl(S||(S=n.__makeTemplateObject(["vLineDistanceNorm = lineDist / lineWidth;"],["vLineDistanceNorm = lineDist / lineWidth;"]))):"")),e.stippleEnabled&&(t.vertex.code.add(l.glsl(P||(P=n.__makeTemplateObject(["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec = pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength = length(stippleSegmentDirection);\n    "],["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec = pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength = length(stippleSegmentDirection);\n    "])))),e.stippleIntegerRepeatsEnabled&&t.vertex.code.add(l.glsl(M||(M=n.__makeTemplateObject(["\n      float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats = max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax = roundedNumberOfPatternRepeats;\n      "],["\n      float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats = max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax = roundedNumberOfPatternRepeats;\n      "])))),t.vertex.code.add(l.glsl(C||(C=n.__makeTemplateObject(["\n      if (stippleSegmentDirectionLength >= 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv = 1.0;\n        }\n      }\n    "],["\n      if (stippleSegmentDirectionLength >= 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv = 1.0;\n        }\n      }\n    "])),e.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale = roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale = 1.0;"))),t.vertex.code.add(l.glsl(D||(D=n.__makeTemplateObject(["\n      // Convert back into NDC\n      pos.xy = pos.xy / screenSize * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      gl_Position = pos;\n    }\n  }\n  "],["\n      // Convert back into NDC\n      pos.xy = pos.xy / screenSize * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      gl_Position = pos;\n    }\n  }\n  "])))),t.include(r.Slice,e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.code.add(l.glsl(R||(R=n.__makeTemplateObject(["\n  void main() {\n    discardBySlice(vpos);\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n    vec4 color = intrinsicColor * vColor;\n  "],["\n  void main() {\n    discardBySlice(vpos);\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n    vec4 color = intrinsicColor * vColor;\n  "])))),e.innerColorEnabled&&(t.fragment.uniforms.add("pixelRatio","float"),t.fragment.code.add(l.glsl(A||(A=n.__makeTemplateObject(["\n    float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n    float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\n    float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\n    color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n    "],["\n    float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n    float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\n    float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\n    color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n    "]))))),t.fragment.code.add(l.glsl(E||(E=n.__makeTemplateObject(["\n    vec4 finalColor = blendStipple(color, stippleAlpha);\n  "],["\n    vec4 finalColor = blendStipple(color, stippleAlpha);\n  "])))),e.falloffEnabled&&t.fragment.code.add(l.glsl(T||(T=n.__makeTemplateObject(["\n    finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n    "],["\n    finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n    "])))),t.fragment.code.add(l.glsl(V||(V=n.__makeTemplateObject(["\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "],["\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),l.glsl.float(s.symbolAlphaCutoff),0===e.output?l.glsl(j||(j=n.__makeTemplateObject(["gl_FragColor = highlightSlice(finalColor, vpos);"],["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",4===e.output?l.glsl(I||(I=n.__makeTemplateObject(["gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);"],["gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);"]))):"")),t}}).apply(null,r))||(e.exports=i)},o5p5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("tUyH"),n("FNtW"),n("LZD4"),n("s6rJ"),n("s6rJ"),n("EiS2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){"use strict";var c=function(e){function t(t,n){var r=e.call(this,n)||this;return r.supportsEdges=!0,r.techniqueConfig=new l.ColorMaterialTechniqueConfiguration,r.params=s.copyParameters(t,p),r}return n.__extends(t,e),t.prototype.setParameterValues=function(e){o.updateParameters(this.params,e)&&this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig},t.prototype.getPassParameters=function(){return this.params},t.prototype.intersect=function(e,t,n,r,i,a,o){s.intersectTriangleGeometry(e,t,r,i,a,void 0,o)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new u(e):void 0},t.prototype.createBufferWriter=function(){return new a.DefaultBufferWriter(a.PositionColorLayout)},t}(i.Material),u=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return n.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(l.ColorMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&this._updateOccludeeState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t.prototype.getPipelineState=function(e,t){return t?this.technique.opaqueOccludeeState:this.technique.pipeline},t}(r.GLMaterial),p={color:[1,1,1,1],transparent:!1,writeDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1};return c}).apply(null,r))||(e.exports=i)},pLfv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.NormalUtils=void 0,t.NormalUtils=function(e,t){e.vertex.code.add(r.glsl(1===t.viewingMode?i||(i=n.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "])):a||(a=n.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "])))),e.vertex.code.add(r.glsl(1===t.viewingMode?o||(o=n.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "])):s||(s=n.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = vec3(1.0, 0.0, 0.0);\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = vec3(1.0, 0.0, 0.0);\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "]))))}}).apply(null,r))||(e.exports=i)},pbva:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("FXVB"),n("1m5D")],void 0===(i=(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addOrMerge=t.sortInstancesAccordingToRange=t.Instance=void 0,t.Instance=function(e,t,i,a,o,s){this.from=e,this.to=t,this.isVisible=i,this.hasHighlights=a,this.hasOccludees=o,this.transformation=s,null!=s&&(this.transformationNormal=r.mat4f64.clone(s),n.mat4.invert(this.transformationNormal,this.transformationNormal),n.mat4.transpose(this.transformationNormal,this.transformationNormal))},t.sortInstancesAccordingToRange=function(e){return e.sort((function(e,t){return e.from===t.from?e.to>t.to?1:e.to<t.to?-1:0:e.from>t.from?1:e.from<t.from?-1:0}))},t.addOrMerge=function(e,t){var n=function(e){return{first:e.from,count:e.to-e.from}};if(0!==e.length){var r,i=e[e.length-1];(r=i).first+r.count>=t.from?i.count=t.from-i.first+t.to-t.from:e.push(n(t))}else e.push(n(t))}}).apply(null,r))||(e.exports=i)},pqGg:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("xDGw"),n("uUnu"),n("aRjO"),n("PaEL"),n("3PFg"),n("2o+p"),n("2NOe"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("VQEQ"),n("VQEQ"),n("G0ER"),n("qbr3"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HUDMaterialTechniqueConfiguration=t.HUDMaterialTechnique=void 0;var x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get(),r=this.configuration,i=n.build({output:r.output,viewingMode:e.viewingMode,occlusionTestEnabled:r.occlusionTestEnabled,signedDistanceFieldEnabled:r.sdf,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:r.debugDrawBorder,binaryHighlightOcclusionEnabled:r.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:r.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!1});return new y(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),v.Default3D)},t.prototype.bindPass=function(e,t,n){p.View.bindProjectionMatrix(this.program,n.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",n.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",n.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),a.VerticalOffset.bindUniforms(this.program,t,n),u.ScreenSizePerspective.bindUniforms(this.program,t),this.program.setUniform1f("pixelRatio",n.camera.pixelRatio||1),p.View.bindViewport(this.program,n),6===this.configuration.output?s.HUDOcclusion.bindUniforms(this.program):(o.HUD.bindUniforms(this.program,n),g.HUDMaterial.bindUniforms(this.program,t,n.camera.pixelRatio||1),c.VisualVariables.bindUniforms(this.program,t),this.configuration.occlusionTestEnabled&&o.HUD.bindVisibilityTexture(e,this.program,n)),4===this.configuration.output&&l.OutputHighlight.bindOutputHighlight(e,this.program,n)},t.prototype.bindDraw=function(e){p.View.bindView(this.program,e),p.View.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){return b.makePipelineState(4===this.configuration.output?{blending:_.separateBlendingParams(1,1,771,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},colorWrite:b.defaultColorWriteParams}:6===this.configuration.output?{depthTest:{func:515},depthWrite:b.defaultDepthWriteParams,colorWrite:b.defaultColorWriteParams}:{blending:_.simpleBlendingParams(1,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:this.configuration.depthEnabled?515:519},depthWrite:this.configuration.depthEnabled?b.defaultDepthWriteParams:void 0,colorWrite:b.defaultColorWriteParams})},Object.defineProperty(t.prototype,"primitiveType",{get:function(){return 6===this.configuration.output?0:4},enumerable:!1,configurable:!0}),t.shader=new d.ReloadableShaderModule(m,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("VQEQ")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(h.ShaderTechnique);t.HUDMaterialTechnique=x;var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.occlusionTestEnabled=!0,t.sdf=!1,t.vvSize=!1,t.vvColor=!1,t.verticalOffset=!1,t.screenSizePerspective=!1,t.screenCenterOffsetUnitsEnabled=0,t.debugDrawBorder=!0,t.binaryHighlightOcclusion=!0,t.slicePlaneEnabled=!1,t.polygonOffsetEnabled=!1,t.depthEnabled=!0,t}return r.__extends(t,e),r.__decorate([f.parameter({count:7})],t.prototype,"output",void 0),r.__decorate([f.parameter()],t.prototype,"occlusionTestEnabled",void 0),r.__decorate([f.parameter()],t.prototype,"sdf",void 0),r.__decorate([f.parameter()],t.prototype,"vvSize",void 0),r.__decorate([f.parameter()],t.prototype,"vvColor",void 0),r.__decorate([f.parameter()],t.prototype,"verticalOffset",void 0),r.__decorate([f.parameter()],t.prototype,"screenSizePerspective",void 0),r.__decorate([f.parameter({count:2})],t.prototype,"screenCenterOffsetUnitsEnabled",void 0),r.__decorate([f.parameter()],t.prototype,"debugDrawBorder",void 0),r.__decorate([f.parameter()],t.prototype,"binaryHighlightOcclusion",void 0),r.__decorate([f.parameter()],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([f.parameter()],t.prototype,"polygonOffsetEnabled",void 0),r.__decorate([f.parameter()],t.prototype,"depthEnabled",void 0),t}(f.ShaderTechniqueConfiguration);t.HUDMaterialTechniqueConfiguration=w}).apply(null,r))||(e.exports=i)},pvGl:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("KtQ6"),n("BcWh"),n("eIBl"),n("xoE+"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("woUR"),n("5T2R"),n("B3XD"),n("X5J5"),n("Fe95"),n("48/q"),n("dtql"),n("ys4y"),n("4ziW"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoveZManipulation=void 0;var w=function(e){function t(t){var n=e.call(this)||this;return n._handles=new a,n._radius=m.DISC_RADIUS,n.events=new i,n._tool=t.tool,n._view=t.view,null!=t.radius&&(n._radius=t.radius),n.createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return n.__extends(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))},t.prototype.forEachManipulator=function(e){e(this._manipulator,0)},t.prototype.createGraphicDragPipeline=function(e,t){var n=this,r=s.unwrap(e.graphic.geometry).spatialReference;return y.createGraphicMoveDragPipeline(e,t,(function(e){return n.createDragPipeline(e,r)}))},t.prototype.createDragPipeline=function(e,t){var n=this._view;return x.createManipulatorDragEventPipeline(this._manipulator,(function(r,i,a,o){var s=i.next(f.screenToZConstrained(n,r.renderLocation,t)).next(x.addScreenDelta());e(r,s,a,o)}))},Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this.updateManipulator())},enumerable:!1,configurable:!0}),t.prototype.updateManipulator=function(){var e=this._radius/m.DISC_RADIUS,t=v.settings.zManipulator.height*e,n=v.settings.zManipulator.coneHeight*e,i=v.settings.zManipulator.coneWidth*e,a=v.settings.zManipulator.width*e,o=[p.vec3f64.fromValues(0,0,0),p.vec3f64.fromValues(0,0,t)],s=new _(b.createTubeGeometry(o,a/2,16,!1),"move-z"),u=b.createConeGeometry(n,i/2,16,!1),d=new _(u),f=[p.vec3f64.fromValues(0,0,0),p.vec3f64.fromValues(0,0,t+n)],g=function(e){var n=c.mat4f64.create();return l.mat4.translate(n,n,[0,0,t]),l.mat4.rotateX(n,n,Math.PI/2),n}(),y=function(e,t){var n=r.darken(v.settings.zManipulator.color,t);return[n.r/255,n.g/255,n.b/255,v.settings.zManipulator.color.a*e]},x=h.createManipulatorMaterial(y(1,.25),1),w=h.createManipulatorMaterial(y(1,0),1),S=h.createManipulatorMaterial(y(.7,0),v.settings.zManipulator.occludedFlag),O=h.createManipulatorMaterial(y(.85,0),v.settings.zManipulator.occludedFlag);this._manipulator.renderObjects=[{geometry:d,transform:g,material:x,stateMask:1},{geometry:s,material:x,stateMask:1},{geometry:d,transform:g,material:w,stateMask:2},{geometry:s,material:w,stateMask:2},{geometry:d,transform:g,material:S,stateMask:1},{geometry:s,material:S,stateMask:1},{geometry:d,transform:g,material:O,stateMask:2},{geometry:s,material:O,stateMask:2}],this._manipulator.radius=a/2+2,this._manipulator.collisionType={type:"line",paths:[f]}},t.prototype.createManipulator=function(){var e=this,t=new d.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var n=e._view.state.camera,r=S;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,r);var i=u.vec3.dist(n.eye,r),a=n.computeRenderPixelSizeAtDist(i),s=u.vec3.subtract(O,r,n.eye);u.vec3.normalize(s,s);var l=P;e._view.renderCoordsHelper.worldUpAtPosition(S,l);var c=Math.abs(u.vec3.dot(s,l)),p=u.vec3.cross(O,s,l),d=u.vec3.cross(O,p,l),h=o.clamp(c,.01,1),f=1-Math.sqrt(1-h*h)/h/n.fullWidth,g=v.settings.zManipulator.width*(e._radius/m.DISC_RADIUS);u.vec3.scale(d,u.vec3.normalize(d,d),(1/f-1)*i+a*g),t[12]-=O[0],t[13]-=O[1],t[14]-=O[2]},this._manipulator=t,this.updateManipulator()},t}(g.Manipulation);t.MoveZManipulation=w;var S=p.vec3f64.create(),O=p.vec3f64.create(),P=p.vec3f64.create()}).apply(null,r))||(e.exports=i)},qSzK:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("xoE+"),n("hk44"),n("0W55"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o,s){"use strict";var l,c,u,p,d,h,f,v,m,g;Object.defineProperty(t,"__esModule",{value:!0}),t.build=t.defaultAngleCutoff=void 0,t.defaultAngleCutoff=r.deg2rad(6),t.build=function(e){var t=new s.ShaderBuilder;return t.extensions.add("GL_OES_standard_derivatives"),t.include(a.ScreenSpacePass),t.include(i.Laserline,e),t.fragment.uniforms.add("angleCutoff","vec2"),t.fragment.uniforms.add("globalAlpha","float"),e.heightManifoldEnabled&&t.fragment.uniforms.add("heightPlane","vec4"),e.pointDistanceEnabled&&t.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&t.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&t.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&t.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&t.fragment.code.add(o.glsl(l||(l=n.__makeTemplateObject(["\n      float planeDistancePixels(vec4 plane, vec3 pos) {\n        float dist = dot(plane.xyz, pos) + plane.w;\n        float width = fwidth(dist);\n        dist /= min(width, maxPixelDistance);\n        return abs(dist);\n      }"],["\n      float planeDistancePixels(vec4 plane, vec3 pos) {\n        float dist = dot(plane.xyz, pos) + plane.w;\n        float width = fwidth(dist);\n        dist /= min(width, maxPixelDistance);\n        return abs(dist);\n      }"])))),e.pointDistanceEnabled&&t.fragment.code.add(o.glsl(c||(c=n.__makeTemplateObject(["\n    float sphereDistancePixels(vec4 sphere, vec3 pos) {\n      float dist = distance(sphere.xyz, pos) - sphere.w;\n      float width = fwidth(dist);\n      dist /= min(width, maxPixelDistance);\n      return abs(dist);\n    }\n    "],["\n    float sphereDistancePixels(vec4 sphere, vec3 pos) {\n      float dist = distance(sphere.xyz, pos) - sphere.w;\n      float width = fwidth(dist);\n      dist /= min(width, maxPixelDistance);\n      return abs(dist);\n    }\n    "])))),e.intersectsLineEnabled&&t.fragment.code.add(o.glsl(u||(u=n.__makeTemplateObject(["\n    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\n      float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\n      return abs(dist) - radius;\n    }\n    "],["\n    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\n      float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\n      return abs(dist) - radius;\n    }\n    "])))),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.fragment.code.add(o.glsl(p||(p=n.__makeTemplateObject(["\n    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\n      vec3 dir = end - start;\n      float t2 = dot(dir, pos - start);\n      float l2 = dot(dir, dir);\n      return t2 >= 0.0 && t2 <= l2;\n    }\n    "],["\n    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\n      vec3 dir = end - start;\n      float t2 = dot(dir, pos - start);\n      float l2 = dot(dir, dir);\n      return t2 >= 0.0 && t2 <= l2;\n    }\n    "])))),t.fragment.code.add(o.glsl(d||(d=n.__makeTemplateObject(["\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    vec4 color = vec4(0, 0, 0, 0);\n  "],["\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    vec4 color = vec4(0, 0, 0, 0);\n  "])))),e.heightManifoldEnabled&&t.fragment.code.add(o.glsl(h||(h=n.__makeTemplateObject(["\n    {\n      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\n      vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));\n      color = max(color, heightManifoldColor * heightManifoldAlpha);\n    }\n    "],["\n    {\n      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\n      vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));\n      color = max(color, heightManifoldColor * heightManifoldAlpha);\n    }\n    "])))),e.pointDistanceEnabled&&t.fragment.code.add(o.glsl(f||(f=n.__makeTemplateObject(["\n    {\n      // distance to sphere\n      float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\n      vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\n      float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\n\n      color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n    }\n    "],["\n    {\n      // distance to sphere\n      float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\n      vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\n      float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\n\n      color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n    }\n    "])))),e.lineVerticalPlaneEnabled&&t.fragment.code.add(o.glsl(v||(v=n.__makeTemplateObject(["\n    {\n      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\n        float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\n\n        vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\n        float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\n\n        color = max(color, lineVerticalColor * lineVerticalAlpha);\n      }\n    }\n    "],["\n    {\n      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\n        float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\n\n        vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\n        float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\n\n        color = max(color, lineVerticalColor * lineVerticalAlpha);\n      }\n    }\n    "])))),e.intersectsLineEnabled&&t.fragment.code.add(o.glsl(m||(m=n.__makeTemplateObject(["\n    {\n      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\n        float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\n        vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\n        float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\n\n        color = max(color, intersectsLineColor * intersectsLineAlpha);\n      }\n    }\n    "],["\n    {\n      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\n        float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\n        vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\n        float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\n\n        color = max(color, intersectsLineColor * intersectsLineAlpha);\n      }\n    }\n    "])))),t.fragment.code.add(o.glsl(g||(g=n.__makeTemplateObject(["\n    gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);\n  }\n  "],["\n    gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);\n  }\n  "])))),t}}).apply(null,r))||(e.exports=i)},qUb7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("Rdxj")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphericalHarmonicsLight=t.AmbientLight=t.FillLight=t.MainLight=void 0,t.MainLight=function(e,t,r){void 0===e&&(e=n.vec3f64.create()),void 0===t&&(t=n.vec3f64.fromValues(.57735,.57735,.57735)),void 0===r&&(r=!0),this.intensity=e,this.direction=t,this.castShadows=r},t.FillLight=function(e,t){void 0===e&&(e=n.vec3f64.create()),void 0===t&&(t=n.vec3f64.fromValues(.57735,.57735,.57735)),this.intensity=n.vec3f64.create(),this.direction=n.vec3f64.create(),this.intensity=e,this.direction=t},t.AmbientLight=function(e){void 0===e&&(e=n.vec3f64.create()),this.intensity=e},t.SphericalHarmonicsLight=function(){this.sh={r:[0],g:[0],b:[0]}}}).apply(null,r))||(e.exports=i)},qkUi:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("ub+M"),n("owRV"),n("A5GR"),n("uNfR"),n("4QR8")],void 0===(i=(function(e,t,n,r,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DrawGraphicTool",{enumerable:!0,get:function(){return n.DrawGraphicTool}}),Object.defineProperty(t,"DrawOperation",{enumerable:!0,get:function(){return r.DrawOperation}}),Object.defineProperty(t,"GraphicMoveTool",{enumerable:!0,get:function(){return i.GraphicMoveTool}}),Object.defineProperty(t,"GraphicReshapeTool",{enumerable:!0,get:function(){return a.GraphicReshapeTool}}),Object.defineProperty(t,"GraphicTransformTool",{enumerable:!0,get:function(){return o.GraphicTransformTool}})}).apply(null,r))||(e.exports=i)},qvwY:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function n(e){return e instanceof Float32Array&&e.length>=16}function r(e){return Array.isArray(e)&&e.length>=16}Object.defineProperty(t,"__esModule",{value:!0}),t.isMat4=t.isMat4f64=t.isMat4f32=void 0,t.isMat4f32=n,t.isMat4f64=r,t.isMat4=function(e){return n(e)||r(e)}}).apply(null,r))||(e.exports=i)},raiv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("FXVB"),n("1m5D"),n("W/V4"),n("FQ4r"),n("lBa0"),n("UGy0"),n("G0ER"),n("qbr3"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LaserlinePathTechniqueConfiguration=t.LaserlinePathTechnique=void 0;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get().build(this.configuration);return new u(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),t.attributeLocations)},t.prototype.bind=function(e,t,n){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*n.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*n.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",n.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/n.fullWidth,2/n.fullHeight),this.program.setUniformMatrix4fv("uProjectionMatrix",n.projectionMatrix),i.mat4.translate(v,n.viewMatrix,t),this.program.setUniformMatrix4fv("uModelViewMatrix",v),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1)},t.prototype.initializePipeline=function(){return d.makePipelineState({blending:p.simpleBlendingParams(1,771),colorWrite:d.defaultColorWriteParams})},t.prototype.bindPipelineState=function(e){e.setPipelineState(this.pipeline)},t.shader=new o.ReloadableShaderModule(c,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("UGy0")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t.attributeLocations={start:0,end:1,up:2,extrude:3},t}(s.ShaderTechnique);t.LaserlinePathTechnique=h;var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.contrastControlEnabled=!1,t}return r.__extends(t,e),r.__decorate([l.parameter()],t.prototype,"contrastControlEnabled",void 0),t}(l.ShaderTechniqueConfiguration);t.LaserlinePathTechniqueConfiguration=f;var v=a.mat4f64.create()}).apply(null,r))||(e.exports=i)},sQDZ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("6vp1"),n("Xakh"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,a){"use strict";function o(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.include(r.ReadLinearDepth),e.include(i.Reprojection),e.fragment.code.add(a.glsl(s||(s=n.__makeTemplateObject(["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "],["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150;":"75;"))}var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSpaceReflections=void 0,t.ScreenSpaceReflections=o,function(e){e.bindUniforms=function(e,t,n){n.ssrEnabled&&(e.setUniform1i("depthMapView",n.linearDepthTextureID),t.bindTexture(n.linearDepthTexture,n.linearDepthTextureID),e.setUniform2fv("nearFar",n.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",n.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/n.camera.height),i.Reprojection.bindUniforms(e,t,n))}}(o=t.ScreenSpaceReflections||(t.ScreenSpaceReflections={}))}).apply(null,r))||(e.exports=i)},uNfR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("BcWh"),n("eIBl"),n("LxLY"),n("8MXS"),n("Vx27"),n("9O7+"),n("JXo2"),n("X7Ps")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicReshapeTool=void 0;var p=function(e){function t(t){var n=e.call(this,t)||this;return n._handles=new i,n._reshapeOperation=null,n._internalGeometryUpdate=!1,n.type="reshape-3d",n}return n.__extends(t,e),t.prototype.destroy=function(){this._handles.removeAll(),this._reshapeOperation&&(this._reshapeOperation.destroy(),this._reshapeOperation=null),this._set("view",null),this._set("graphic",null)},Object.defineProperty(t.prototype,"selectionManagementDisabled",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype._updateGeometry=function(){var e=this.graphic.geometry;this._reshapeOperation.inputGeometry=0!==l.isSupportedGraphic(this.graphic)||!a.isSome(e)||"polygon"!==e.type&&"polyline"!==e.type?null:e.clone()},t.prototype._updateGraphic=function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0===l.isSupportedGraphic(this.graphic)){var t=this.watch("graphic.geometry",(function(){!1===e._internalGeometryUpdate&&e._updateGeometry()}),!0);this._handles.add(t,"onGraphicGeometryChange")}},t.prototype.manipulatorSelectionChanged=function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()},t.prototype._onReshapeGeometryChanged=function(){a.isNone(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)},t.prototype.initialize=function(){var e=this;this._reshapeOperation=new c.ReshapeOperation({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)})),this._reshapeOperation.on("move",(function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)})),this._reshapeOperation.on("vertex-add",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)})),this._reshapeOperation.on("vertex-remove",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)})),this._reshapeOperation.on("immediate-click",(function(){return e.emit("immediate-click")})),o.init(this,"graphic",(function(){e._updateGraphic()}),!0)])},t.prototype.onInputEvent=function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()},t.prototype.reset=function(){},n.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n.__decorate([s.property({constructOnly:!0})],t.prototype,"graphic",void 0),n.__decorate([s.property({constructOnly:!0,nonNullable:!0,value:!0})],t.prototype,"enableZ",void 0),n.__decorate([s.property({readOnly:!0})],t.prototype,"type",void 0),n.__decorate([s.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],t)}(r.EventedMixin(u.InteractiveToolBase));t.GraphicReshapeTool=p}).apply(null,r))||(e.exports=i)},uUnu:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("2o+p"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){"use strict";function a(e,t){var a=e;a.include(r.ScreenSizePerspective),a.attributes.add("position","vec3"),a.attributes.add("normal","vec3"),a.attributes.add("auxpos1","vec4"),a.vertex.uniforms.add("proj","mat4"),a.vertex.uniforms.add("view","mat4"),a.vertex.uniforms.add("viewNormal","mat4"),a.vertex.uniforms.add("viewport","vec4"),a.vertex.uniforms.add("camPos","vec3"),a.vertex.uniforms.add("polygonOffset","float"),a.vertex.uniforms.add("cameraGroundRelative","float"),a.vertex.uniforms.add("pixelRatio","float"),a.vertex.uniforms.add("perDistancePixelRatio","float"),a.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&a.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&a.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),a.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),a.vertex.defines.addFloat("SMALL_OFFSET_ANGLE",.984807753012208),a.vertex.code.add(i.glsl(o||(o=n.__makeTemplateObject(["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "],["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "])))),a.vertex.code.add(i.glsl(s||(s=n.__makeTemplateObject(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = sign(pointGroundDistance);\n\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "],["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = sign(pointGroundDistance);\n\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "])))),a.vertex.code.add(i.glsl(l||(l=n.__makeTemplateObject(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "],["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "])))),a.vertex.code.add(i.glsl(p||(p=n.__makeTemplateObject(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "],["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.verticalOffsetEnabled?i.glsl(c||(c=n.__makeTemplateObject(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"],["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",1!==t.screenCenterOffsetUnitsEnabled?i.glsl(u||(u=n.__makeTemplateObject(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "],["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),a.vertex.code.add(i.glsl(d||(d=n.__makeTemplateObject(["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD > 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD = 0.75\n        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n  "],["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD > 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD = 0.75\n        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n  "]))))}var o,s,l,c,u,p,d;Object.defineProperty(t,"__esModule",{value:!0}),t.HUD=void 0,t.HUD=a,function(e){!function(e){e[e.OCCLUDED=0]="OCCLUDED",e[e.NOTOCCLUDED=1]="NOTOCCLUDED",e[e.BOTH=2]="BOTH",e[e.COUNT=3]="COUNT"}(e.TransparentRenderStyle||(e.TransparentRenderStyle={})),e.bindUniforms=function(t,n){t.setUniform1f("uRenderTransparentlyOccludedHUD",n.renderTransparentlyOccludedHUD===e.TransparentRenderStyle.OCCLUDED?1:n.renderTransparentlyOccludedHUD===e.TransparentRenderStyle.NOTOCCLUDED?0:.75)},e.bindVisibilityTexture=function(e,t,n){t.setUniform1i("hudVisibilityTexture",1),e.bindTexture(n.hudVisibilityTexture,1),e.setActiveTexture(0)}}(a=t.HUD||(t.HUD={}))}).apply(null,r))||(e.exports=i)},uZGf:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("0LE5"),n("Rdxj"),n("2B1V"),n("tUyH"),n("FNtW"),n("CIy2"),n("LZD4"),n("s6rJ"),n("s6rJ"),n("fQ2U")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShadedColorMaterial=void 0;var h=a.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec3f(l.VertexAttrConstants.NORMAL),f=function(e){function t(t,n){var r=e.call(this,n)||this;return r.supportsEdges=!0,r.techniqueConfig=new d.ShadedColorMaterialTechniqueConfiguration,r.params=p.copyParameters(t,m),r}return n.__extends(t,e),t.prototype.setParameterValues=function(e){u.updateParameters(this.params,e)&&this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig},t.prototype.getPassParameters=function(){return this.params},t.prototype.intersect=function(e,t,n,r,i,a,o){p.intersectTriangleGeometry(e,t,r,i,a,void 0,o)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new v(e):void 0},t.prototype.createBufferWriter=function(){return new c.DefaultBufferWriter(h)},t}(s.Material);t.ShadedColorMaterial=f;var v=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return n.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(d.ShadedColorMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){if(4===this.output)return 3===e;var t=3;return this.technique.configuration.transparent&&(t=this.technique.configuration.writeDepth?5:8),e===t},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t}(o.GLMaterial),m={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:r.vec3.normalize(i.vec3f64.create(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0}}).apply(null,r))||(e.exports=i)},"ub+M":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("jZlN"),n("pcDC"),n("BcWh"),n("LxLY"),n("Vx27"),n("RYqx"),n("DtIM"),n("X5J5"),n("owRV"),n("5uSI"),n("R4nD"),n("T95R"),n("wT+E"),n("X7Ps")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawGraphicTool=void 0;var g=function(e){function t(t){var n=e.call(this,t)||this;return n.drawOperation=null,n._createGraphic=null,n._outlineVisualElement=null,n._verticesVisualElement=null,n._stagedVerticesVisualElement=null,n.hasZ=!0,n.defaultZ=0,n.elevationInfo=null,n.snapToScene=!1,n.mode="hybrid",n.geometryType=null,n.type="draw-3d",n}return n.__extends(t,e),t.prototype.initialize=function(){var e=this,t=o.unwrapOr(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new l({elevationInfo:t}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new p.DrawOperation({view:this.view,manipulators:this.manipulators,geometryType:y(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snappingEnabled:this.snapToScene,snappingDrawSurface:new d.SceneDrawSurface(this.view,t,[this._internalGraphicsLayer]),hasM:!1,elevationInfo:t}),this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)}))},t.prototype.destroy=function(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)},t.prototype.onInputEvent=function(e){this.drawOperation.onInputEvent(e)},t.prototype._getCreateGeometry=function(e,t){if(void 0===t&&(t=!1),null==this.drawOperation)return null;var n=o.isSome(e)?e:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null,r=this.drawOperation.vertices;if(0===r.length)return null;var i=this.drawOperation.spatialReference,a=r,s=a.slice(),l=[];o.isSome(n)&&(s.splice(n,1),l.push(a[n]));var c={regularVertices:null,stagedVertices:null,full:null,outline:null},u="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":c.regularVertices=s,c.stagedVertices=l,c.full=this.drawOperation.coordinateHelper.createPointFromArray(r[0]);break;case"polyline":c.regularVertices=s,c.stagedVertices=l,a.length>0&&(c.full=v.createPolyline([a],i,u));break;case"polygon":c.regularVertices=s,c.stagedVertices=l,a.length>0&&(c.full=v.createPolygon([a],i,u,!0));break;case"circle":if(a.length>0){var p=v.createViewAlignedCoordinateSystem(this.view,r[0]);if(1===a.length&&t){var d=a[0],h=p.makeMapPoint(d[0]+_*this.view.resolution,d[1]);c.full=v.createCircle([d,h],p,!0)}else 2===a.length&&(c.full=this.forceUniformSize?v.createCircle(r,p,this.centered):v.createEllipse(r,p,this.centered))}break;case"rectangle":a.length>0&&(p=v.createViewAlignedCoordinateSystem(this.view,r[0]),1===a.length&&t?(h=p.makeMapPoint((d=a[0])[0]+_*this.view.resolution,d[1]),c.full=v.createSquare([d,h],p,!0)):2===a.length&&(c.full=this.forceUniformSize?v.createSquare(r,p,this.centered):v.createRectangle(r,p,this.centered)));break;default:return null}switch(this.geometryType){case"point":break;case"polyline":a.length>1&&(c.outline=v.createPolyline([a],i,u));break;case"polygon":a.length>1&&(c.outline=v.createPolygon([a],i,u));break;case"circle":case"rectangle":o.isSome(c.full)&&"polygon"===c.full.type&&(c.outline=v.createPolygon(c.full.rings,i,u))}return c},t.prototype._destroyAllVisualisations=function(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()},t.prototype._destroyCreateGraphic=function(){o.isSome(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null)},t.prototype._destroyOutlineVisualElement=function(){o.isSome(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)},t.prototype._destroyVerticesVisualElement=function(){o.isSome(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)},t.prototype._destroyStagedVerticesVisualElement=function(){o.isSome(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)},t.prototype._updateCreateGraphic=function(e){void 0===e&&(e=null);var t=this._getCreateGeometry(e);if(o.isNone(t))this._destroyAllVisualisations();else{var n=this._internalGraphicsLayer.elevationInfo,i="on-the-ground"===c.getEffectiveElevationMode(this.hasZ,n);o.isSome(t.outline)?o.isNone(this._outlineVisualElement)?(this._outlineVisualElement=new h.OutlineVisualElement({view:this.view,geometry:t.outline,elevationInfo:o.unwrap(n),isDraped:i,attached:!1}),u.settings.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),u.settings.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=t.outline:this._destroyOutlineVisualElement(),o.isSome(t.regularVertices)?o.isNone(this._verticesVisualElement)?(this._verticesVisualElement=new f.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:t.regularVertices,elevationInfo:o.unwrap(this._internalGraphicsLayer.elevationInfo),attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=t.regularVertices:this._destroyVerticesVisualElement(),o.isSome(t.stagedVertices)?o.isNone(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new f.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:t.stagedVertices,elevationInfo:o.unwrap(this._internalGraphicsLayer.elevationInfo),attached:!1}),this._stagedVerticesVisualElement.color=u.settings.colorToVec4(u.settings.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=t.stagedVertices:this._destroyStagedVerticesVisualElement(),o.isSome(t.full)?o.isNone(this._createGraphic)?(this._createGraphic=new r({geometry:t.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this.notifyChange("createGraphic")):this._createGraphic.geometry=t.full:this._destroyCreateGraphic()}},Object.defineProperty(t.prototype,"createGraphic",{get:function(){return this._createGraphic},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"centered",{set:function(e){this._set("centered",e),this._updateCreateGraphic()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forceUniformSize",{set:function(e){this._set("forceUniformSize",e),this._updateCreateGraphic()},enumerable:!1,configurable:!0}),t.prototype.reset=function(){},Object.defineProperty(t.prototype,"canRedo",{get:function(){return this.drawOperation.canRedo},enumerable:!1,configurable:!0}),t.prototype.redo=function(){this.drawOperation.redo()},Object.defineProperty(t.prototype,"canUndo",{get:function(){return this.drawOperation.canUndo},enumerable:!1,configurable:!0}),t.prototype.undo=function(){this.drawOperation.undo()},t.prototype.completeCreateOperation=function(){this.drawOperation.complete()},t.prototype.activate=function(){},t.prototype.deactivate=function(){this.drawOperation.isCompleted||this.drawOperation.cancel()},t.prototype.getVertexCoords=function(){return this.drawOperation.vertices},t.prototype.onVertexAdd=function(e){this._updateCreateGraphic(),this.emit("vertex-add",e)},t.prototype.onVertexRemove=function(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)},t.prototype.onVertexUpdate=function(e){this._updateCreateGraphic(),this.emit("vertex-update",e)},t.prototype.onCursorUpdate=function(e){this._updateCreateGraphic(1===e.vertices.length?e.vertices[0].vertexIndex:null),this.emit("cursor-update",e)},t.prototype.onComplete=function(e){this._updateCreateGraphic();var t=null;if(this.drawOperation.isCompleted){var i=this._getCreateGeometry(null,!0);o.isSome(i)&&(t=new r({geometry:i.full,symbol:this.createGraphicSymbol}))}this.emit("complete",n.__assign({graphic:t},e))},n.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n.__decorate([s.property()],t.prototype,"createGraphicSymbol",void 0),n.__decorate([s.property()],t.prototype,"createGraphic",null),n.__decorate([s.property({value:!0})],t.prototype,"enabled",null),n.__decorate([s.property({value:!0})],t.prototype,"centered",null),n.__decorate([s.property({value:!0})],t.prototype,"forceUniformSize",null),n.__decorate([s.property({constructOnly:!0})],t.prototype,"hasZ",void 0),n.__decorate([s.property({nonNullable:!0})],t.prototype,"defaultZ",void 0),n.__decorate([s.property({constructOnly:!0})],t.prototype,"elevationInfo",void 0),n.__decorate([s.property()],t.prototype,"snapToScene",void 0),n.__decorate([s.property({constructOnly:!0})],t.prototype,"mode",void 0),n.__decorate([s.property({constructOnly:!0})],t.prototype,"geometryType",void 0),n.__decorate([s.property({readOnly:!0})],t.prototype,"type",void 0),n.__decorate([s.subclass("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],t)}(a.EventedMixin(m.InteractiveToolBase));function y(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return i.neverReached(e),null}}t.DrawGraphicTool=g;var _=48}).apply(null,r))||(e.exports=i)},uinn:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XwIv"),n("xoE+"),n("LxLY"),n("8MXS"),n("0LE5"),n("Rdxj"),n("WRgd"),n("lRq4"),n("DtIM"),n("Kvb2"),n("X5J5"),n("MCHn"),n("PXiz"),n("i10q"),n("/9Lg"),n("fOZq"),n("/NuL"),n("UidR"),n("mmEe")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b){"use strict";function x(e){return i.isSome(e.geometry)&&"point"===e.geometry.type}Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=void 0,t.createVisualElements=function(e){var t=e.view,s=new y.GraphicState({graphic:e.graphic}),O=[],P=function(e,t,r){var o=e.graphic,s=new v.PointVisualElement({view:e.view,geometry:x(o)?o.geometry:null,elevationInfo:u.getGraphicEffectiveElevationInfo(o),attached:!1});return function(e,t,r,o){(function(e,t,r,a){var o=e.view,s=e.graphic,l=null,u=function(){i.isSome(l)&&(l.remove(),l=null),r.isDraped&&x(s)&&(l=function(e,t,n){_.pointToVector(t,w,e.elevationProvider.spatialReference);var r=w[0],i=w[1];return e.elevationProvider.on("elevation-change",(function(e){c.containsXY(e.extent,r,i)&&n()}))}(o,s.geometry,(function(){t.geometry=s.geometry}))),t.geometry=x(s)?s.geometry:null};a.push(r.on("changed",u),n.refHandle((function(){return l}))),u()})(e,t,r,o),d.settings.visualElements.pointGraphics.outline.apply(t),o.push(a.init(r,"displaying",(function(){return t.attached=r.displaying})))}(e,s,t,r),r.push(n.destroyHandle(s)),s}(e,s,O);return function(e,t,i,a){var s=e.view,c=e.graphic,v=new f.LineVisualElement({view:s,infinite:d.settings.visualElements.zVerticalLine.infiniteType,attached:!1});d.settings.visualElements.zVerticalLine.apply(v);var y=new h.LaserlineVisualElement({view:s,intersectsLineInfinite:!0,attached:!1});d.settings.visualElements.pointGraphics.shadowStyle.apply(y);var _=r.deg2rad(d.settings.visualElements.heightPlaneAngleCutoff),O=new h.LaserlineVisualElement({view:s,attached:!1,angleCutoff:_});d.settings.visualElements.heightPlane.apply(O);var P=u.getGraphicEffectiveElevationInfo(e.graphic),M=g.ElevationContext.fromElevationInfo(P),C="on-the-ground"===P.mode||!P.offset&&"absolute-height"!==P.mode,D=new p.ManipulatorState,R=1,A=1,E=function(){D.update(e);var n=C&&(t.isDraped||!x(c)||!c.geometry.hasZ),r=!0;if(!n&&x(c)){var i=c.geometry,u=m.evaluateElevationAlignmentAtPoint(c.geometry,s.elevationProvider,M,s.renderCoordsHelper);o.vec3.set(w,i.x,i.y,u),b.vectorToVector(w,i.spatialReference,w,s.renderCoordsHelper.spatialReference),v.worldDownAtLocation=w,y.intersectsWorldUpAtLocation=w}else r=!1;var p=2&D.grabbingState?d.settings.visualElements.laserlineAlphaMultiplier:1;p!==R&&(R=p,d.settings.visualElements.heightPlane.apply(O,p));var h=l.empty(S);!n&&t.displaying&&a.calculateMapBounds(h)&&b.vectorToVector(l.getMin(h,w),s.spatialReference,w,s.renderCoordsHelper.spatialReference)?(O.heightManifoldTarget=w,O.attached=!0):O.attached=!1;var f=4&D.grabbingState?d.settings.visualElements.laserlineAlphaMultiplier:1;f!==A&&(A=f,d.settings.visualElements.pointGraphics.shadowStyle.apply(y,f));var g=r&&t.displaying&&!n;y.attached=g,v.attached=g};i.push(t.watch(["displaying","isDraped"],E),t.on("changed",E)),e.forEachManipulator((function(e){i.push(e.events.on("grab-changed",E))})),i.push(n.destroyHandle(y)),i.push(n.destroyHandle(v)),i.push(n.destroyHandle(O)),E()}(e,s,O,P),O.push(t.trackGraphicState(s)),{visualElement:P,remove:function(){n.handlesGroup(O).remove()}}};var w=s.vec3f64.create(),S=l.create()}).apply(null,r))||(e.exports=i)},"v+nG":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("1m5D"),n("Rdxj"),n("WRgd"),n("ZPQp"),n("ZcgO"),n("/9Lg"),n("/9Lg"),n("BwdQ"),n("UidR"),n("ZJC8")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.geometryToRenderInfo=t.placePointOnGeometry=t.extendPointGraphicElevationContext=t.createStageObjectForHUD=void 0;var h=i.vec3f64.create();t.createStageObjectForHUD=function(e,t,i,o,s,l,u,f,v,m,g){var y=i?i.length:0,_=e.clippingExtent;if(p.pointToVector(t,h,e.elevationProvider.spatialReference),n.isSome(_)&&!a.containsPoint(_,h))return null;p.pointToVector(t,h,e.renderCoordsHelper.spatialReference);for(var b=e.localOriginFactory.getOrigin(h),x=new d({castShadow:!1,metadata:{layerUid:v,graphicUid:m,usesVerticalDistanceToGround:!0},idHint:f}),w=0;w<y;w++)x.addGeometry(i[w],o[w],s?s[w]:r.mat4f64.IDENTITY,l,b,g);return{object:x,sampledElevation:c.applyElevationAlignmentForHUD(x,t,e.elevationProvider,e.renderCoordsHelper,u)}},t.extendPointGraphicElevationContext=function(e,t,n){var r=e.elevationContext,i=n.spatialReference;p.pointToVector(t,h,i),r.centerPointInElevationSR=s.makeDehydratedPoint(h[0],h[1],t.hasZ?h[2]:0,i)},t.placePointOnGeometry=function(e){switch(e.type){case"point":return e;case"polygon":case"extent":return u.computeCentroid(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var n=o.getPointOnPath(t,o.getPathLength(t)/2);return s.makeDehydratedPoint(n[0],n[1],n[2],e.spatialReference);case"mesh":return e.extent.center}return null},t.geometryToRenderInfo=function(e,t,n,r,i){var a=new Float64Array(3*e.length),o=new Float64Array(a.length);e.forEach((function(e,t){a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));var s=l.applyPerVertexElevationAlignment(a,t,0,o,0,a,0,a.length/3,n,r,i);return{numVertices:e.length,position:a,mapPosition:o,projectionSuccess:null!=s,sampledElevation:s}}}).apply(null,r))||(e.exports=i)},v22c:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("PaEL"),n("cj3m"),n("sQDZ"),n("RdU/"),n("2NOe"),n("W/V4"),n("FQ4r"),n("lBa0"),n("EiD/"),n("ff/U"),n("jl7D"),n("G0ER"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaterTechniqueConfiguration=t.WaterTechnique=void 0;var y=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.waterTextureRepository=t.waterTextureRepository,r}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get(),r=this.configuration,i=n.build({output:r.output,viewingMode:e.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:r.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:r.useSSR,highStepCount:!0});return new m(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),f.Default3D)},t.prototype.ensureResource=function(e){return this.waterTextureRepository.ready||this.waterTextureRepository.updating||this.waterTextureRepository.loadTextures(e),this.waterTextureRepository.ready?2:1},t.prototype.bindPass=function(e,t,n){c.View.bindProjectionMatrix(this.program,n.camera.projectionMatrix),0===this.configuration.output&&(n.lighting.setUniforms(this.program,!1),s.ScreenSpaceReflections.bindUniforms(this.program,e,n)),0!==this.configuration.output&&2!==this.configuration.output||(l.WaterDistortion.bindUniforms(this.program,t),this.waterTextureRepository.bindRepo(e)),this.program.setUniform4fv("waterColor",t.color),4===this.configuration.output&&a.OutputHighlight.bindOutputHighlight(e,this.program,n)},t.prototype.bindDraw=function(e){c.View.bindView(this.program,e),0===this.configuration.output&&(c.View.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),o.ReadShadowMap.bindUniforms(this.program,e,h.DefaultTextureUnits.SHADOW_MAP)),0!==this.configuration.output&&4!==this.configuration.output||i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){var e=this.configuration;return g.makePipelineState(2===e.output?{depthTest:{func:513},depthWrite:e.writeDepth&&g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams}:{blending:4!==e.output&&e.transparent?g.separateBlendingParams(770,1,771,771):null,depthTest:{func:513},depthWrite:e.writeDepth&&g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams})},t.shader=new u.ReloadableShaderModule(v,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("jl7D")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(p.ShaderTechnique);t.WaterTechnique=y;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.receiveShadows=!1,t.slicePlaneEnabled=!1,t.transparent=!1,t.writeDepth=!1,t.useSSR=!1,t.isDraped=!1,t}return r.__extends(t,e),r.__decorate([d.parameter({count:7})],t.prototype,"output",void 0),r.__decorate([d.parameter()],t.prototype,"receiveShadows",void 0),r.__decorate([d.parameter()],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"transparent",void 0),r.__decorate([d.parameter()],t.prototype,"writeDepth",void 0),r.__decorate([d.parameter()],t.prototype,"useSSR",void 0),r.__decorate([d.parameter()],t.prototype,"isDraped",void 0),t}(d.ShaderTechniqueConfiguration);t.WaterTechniqueConfiguration=_}).apply(null,r))||(e.exports=i)},vA3N:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getElevationAtPoint=void 0,t.getElevationAtPoint=function(e,t,n){return void 0===n&&(n="ground"),e.getElevation(t.x,t.y,t.z||0,t.spatialReference,n)}}).apply(null,r))||(e.exports=i)},vGsU:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("B4Pz"),n("ybGv"),n("piY7"),n("sQDZ"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,a,o,s){"use strict";var l,c,u;Object.defineProperty(t,"__esModule",{value:!0}),t.Water=void 0,t.Water=function(e,t){e.include(a.PhysicallyBasedRendering,t),e.include(i.Gamma),e.include(r.FoamColor),t.ssrEnabled&&e.include(o.ScreenSpaceReflections,t),e.fragment.code.add(s.glsl(l||(l=n.__makeTemplateObject(["\n    const vec3 fresnelSky =  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial =  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness = 0.015;\n    const float foamIntensityExternal = 1.7;\n    const float ssrIntensity = 0.65;\n    const float ssrHeightFadeStart = 300000.0;\n    const float ssrHeightFadeEnd = 500000.0;\n    const float waterDiffusion = 0.775;\n    const float waterSeeColorMod = 0.8;\n    const float correctionViewingPowerFactor = 0.4;\n\n    const vec3 skyZenitColor = vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor = vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon = the dominant color of the sky horizon\n    *   @parameter: cosTheta = the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n = normal facing away from the surface\n    *   @parameter: v = view direction facing away from the surface.\n    *   @parameter: l = light direction facing away from the surface\n    *   @parameter: lightIntensity = light intensity, currently between 0...PI\n    *   @parameter: localUp = a normal for the general direction of the surface\n    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit = 0.;\n      vec3 seaWaterColor = linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h = normalize(l + v);\n      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV = max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon = linearizeGamma(skyColor);\n      vec3 skyZenit = linearizeGamma(skyZenitColor);\n      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL = max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod = 0.1 + upDotL * 0.9;\n      skyColor *= daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier = clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular = vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV > 0.0 && upDotL > 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular = shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam = vec3(0.0);\n      if(upDotV > 0.0) {\n        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "],["\n    const vec3 fresnelSky =  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial =  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness = 0.015;\n    const float foamIntensityExternal = 1.7;\n    const float ssrIntensity = 0.65;\n    const float ssrHeightFadeStart = 300000.0;\n    const float ssrHeightFadeEnd = 500000.0;\n    const float waterDiffusion = 0.775;\n    const float waterSeeColorMod = 0.8;\n    const float correctionViewingPowerFactor = 0.4;\n\n    const vec3 skyZenitColor = vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor = vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon = the dominant color of the sky horizon\n    *   @parameter: cosTheta = the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n = normal facing away from the surface\n    *   @parameter: v = view direction facing away from the surface.\n    *   @parameter: l = light direction facing away from the surface\n    *   @parameter: lightIntensity = light intensity, currently between 0...PI\n    *   @parameter: localUp = a normal for the general direction of the surface\n    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit = 0.;\n      vec3 seaWaterColor = linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h = normalize(l + v);\n      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV = max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon = linearizeGamma(skyColor);\n      vec3 skyZenit = linearizeGamma(skyZenitColor);\n      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL = max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod = 0.1 + upDotL * 0.9;\n      skyColor *= daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier = clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular = vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV > 0.0 && upDotL > 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular = shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam = vec3(0.0);\n      if(upDotV > 0.0) {\n        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "])))),e.fragment.code.add(s.glsl(t.ssrEnabled?c||(c=n.__makeTemplateObject(["\n      // Convert the world position to view position\n      vec4 viewPosition = vec4(positionView.xyz, 1.0);\n      vec3 viewDir = normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor = vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z > 0.0)\n      {\n        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "],["\n      // Convert the world position to view position\n      vec4 viewPosition = vec4(positionView.xyz, 1.0);\n      vec3 viewDir = normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor = vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z > 0.0)\n      {\n        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "])):u||(u=n.__makeTemplateObject(["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "],["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},vJh7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qysZ")],void 0===(i=(function(e,t,n){"use strict";function r(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=r*s+a*l,e[1]=i*s+o*l,e[2]=r*c+a*u,e[3]=i*c+o*u,e}function i(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=t.multiplyScalarAndAdd=t.multiplyScalar=t.equals=t.exactEquals=t.subtract=t.add=t.LDU=t.frob=t.str=t.fromScaling=t.fromRotation=t.scale=t.rotate=t.multiply=t.determinant=t.adjoint=t.invert=t.transpose=t.set=t.identity=t.copy=void 0,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},t.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*a-i*r;return o?(e[0]=a*(o=1/o),e[1]=-r*o,e[2]=-i*o,e[3]=n*o,e):null},t.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=r,t.rotate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l+a*s,e[1]=i*l+o*s,e[2]=r*-s+a*l,e[3]=i*-s+o*l,e},t.scale=function(e,t,n){var r=t[1],i=t[2],a=t[3],o=n[0],s=n[1];return e[0]=t[0]*o,e[1]=r*o,e[2]=i*s,e[3]=a*s,e},t.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},t.subtract=i,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],i=e[1],a=e[2],o=e[3],s=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(r-s)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-l)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-c)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(o-u)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},t.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},t.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},t.mul=r,t.sub=i}).apply(null,r))||(e.exports=i)},woUR:function(e,t){},xFEL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("xoE+"),n("LxLY"),n("jBNx"),n("YX1r"),n("51bw"),n("FXVB"),n("1m5D"),n("W9tT"),n("DIqE"),n("0LE5"),n("Rdxj"),n("qvwY"),n("lRq4"),n("2B1V"),n("+nCE"),n("9FJH"),n("FNtW"),n("+wMf"),n("CIy2"),n("ILj8"),n("s6rJ"),n("PwS/"),n("VQEQ"),n("pqGg")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w,S,O,P,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var C=function(e){function t(t,n){var r=e.call(this,n)||this;return r.techniqueConfig=new M.HUDMaterialTechniqueConfiguration,r.params=S.copyParameters(t,Y),r}return n.__extends(t,e),t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&x.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig},t.prototype.intersect=function(e,t,n,r,i,a,o,s,l){l?this.intersectDrapedHudGeometry(e,a,o,s):this.intersectHudGeometry(e,t,n,r,o,s)},t.prototype.intersectDrapedHudGeometry=function(e,t,n,r){var i=e.getAttribute(x.VertexAttrConstants.POSITION),a=e.getAttribute(x.VertexAttrConstants.SIZE),o=this.params,s=P.calculateAnchorPosForRendering(o),l=1,c=1;if(r){var u=r(q);l=u[0],c=u[5]}l*=e.screenToWorldRatio,c*=e.screenToWorldRatio;for(var p=B*e.screenToWorldRatio,d=0;d<i.data.length/i.size;d++){var h=d*i.size,f=i.data[h],v=i.data[h+1],m=d*a.size;Z[0]=a.data[m]*l,Z[1]=a.data[m+1]*c;var g=void 0;o.textureIsSignedDistanceField&&(g=o.outlineSize*e.screenToWorldRatio/2),E(t,f,v,Z,p,g,o,s)&&n()}},t.prototype.intersectHudGeometry=function(e,t,n,r,i,a){if(r.options.selectionMode&&r.options.hud&&!O.isInstanceHidden(t)){var s,c,u,p,f,v,m,g,y,_,w,S,M,C=e.data,D=this.params,R=1,A=1;if(o.mat3.fromMat4(U,n),a){var j=a(q);R=j[0],A=j[5],c=(s=U)[0],u=s[1],p=s[2],f=s[3],v=s[4],m=s[5],g=s[6],y=s[7],_=s[8],w=1/Math.sqrt(c*c+u*u+p*p),S=1/Math.sqrt(f*f+v*v+m*m),M=1/Math.sqrt(g*g+y*y+_*_),s[0]=c*w,s[1]=u*w,s[2]=p*w,s[3]=f*S,s[4]=v*S,s[5]=m*S,s[6]=g*M,s[7]=y*M,s[8]=_*M}var z=C.getVertexAttr()[x.VertexAttrConstants.POSITION],G=C.getVertexAttr()[x.VertexAttrConstants.SIZE],B=C.getVertexAttr()[x.VertexAttrConstants.NORMAL],X=C.getVertexAttr()[x.VertexAttrConstants.AUXPOS1];x.assert(z.size>=3);var Y=r.point,J=r.camera,Q=P.calculateAnchorPosForRendering(D);R*=J.pixelRatio,A*=J.pixelRatio;for(var K="screen"===this.params.centerOffsetUnits,$=0;$<z.data.length/z.size;$++){var ee=$*z.size;d.vec3.set(I,z.data[ee],z.data[ee+1],z.data[ee+2]),d.vec3.transformMat4(I,I,n);var te=$*G.size;Z[0]=G.data[te]*R,Z[1]=G.data[te+1]*A,d.vec3.transformMat4(I,I,J.viewMatrix);var ne=$*X.size;if(d.vec3.set(H,X.data[ne+0],X.data[ne+1],X.data[ne+2]),!K&&(I[0]+=H[0],I[1]+=H[1],0!==H[2])){var re=H[2];d.vec3.normalize(H,I),d.vec3.subtract(I,I,d.vec3.scale(H,H,re))}var ie=$*B.size;if(d.vec3.set(V,B.data[ie],B.data[ie+1],B.data[ie+2]),this.normalAndViewAngle(V,U,J,k),this.applyVerticalOffsetTransformationView(I,k,J,T),J.applyProjection(I,L),L[0]>-1){var ae=Math.floor(L[0])+this.params.screenOffset[0],oe=Math.floor(L[1])+this.params.screenOffset[1];K&&(ae+=H[0],0!==H[1]&&(oe+=b.applyScaleFactor(H[1],T.factorAlignment))),b.applyPrecomputedScaleFactor(Z,T.factor,Z);var se=void 0;if(D.textureIsSignedDistanceField&&(se=D.outlineSize*J.pixelRatio/2),E(Y,ae,oe,Z,W*J.pixelRatio,se,D,Q)){var le=r.ray;d.vec3.transformMat4(N,I,l.mat4.invert(F,J.viewMatrix)),L[0]=Y[0],L[1]=Y[1],J.unprojectPoint(L,I);var ce=h.vec3f64.create();d.vec3.copy(ce,le.direction);var ue=1/d.vec3.length(ce);d.vec3.scale(ce,ce,ue),i(d.vec3.distance(le.origin,I)*ue,ce,-1,1,!0,N)}}}}},t.prototype.computeAttachmentOrigin=function(e,t){var n=e.data,r="getVertexAttr"in n?n.getVertexAttr():"vertexAttr"in n?n.vertexAttr:null;if(!r)return null;var i=x.VertexAttrConstants.POSITION,a=r[i],o="getIndices"in n?n.getIndices(i):"indices"in n?n.indices[i]:null;return g.computeAttachmentOriginPoints(a,o,t)},t.prototype.createBufferWriter=function(){return new Q(this)},t.prototype.normalAndViewAngle=function(e,t,n,r){return f.isMat4(t)&&(t=o.mat3.fromMat4(G,t)),d.vec3.transformMat3(r.normal,e,t),d.vec3.transformMat4(r.normal,r.normal,n.viewInverseTransposeMatrix),r.cosAngle=d.vec3.dot(z,X),r},t.prototype.updateScaleInfo=function(e,t,n){var r=this.params;r.screenSizePerspective?b.precomputeScaleFactor(n,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),r.screenSizePerspectiveAlignment?b.precomputeScaleFactor(n,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)},t.prototype.applyShaderOffsetsView=function(e,t,n,r,i,a,o){var s=this.normalAndViewAngle(t,n,i,k);return this.applyVerticalGroundOffsetView(e,s,i,o),this.applyVerticalOffsetTransformationView(o,s,i,a),this.applyPolygonOffsetView(o,s,r[3],i,o),this.applyCenterOffsetView(o,r,o),o},t.prototype.applyShaderOffsetsNDC=function(e,t,n,r,a){return this.applyCenterOffsetNDC(e,t,n,r),i.isSome(a)&&d.vec3.copy(a,r),this.applyPolygonOffsetNDC(r,t,n,r),r},t.prototype.applyPolygonOffsetView=function(e,t,n,i,a){var o=i.aboveGround?1:-1,s=r.sign(n);0===s&&(s=o);var l=o*s;if(this.params.shaderPolygonOffset<=0)return d.vec3.copy(a,e);var c=r.clamp(Math.abs(t.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/i.viewport[2];return d.vec3.scale(a,e,l>0?u:1/u),a},t.prototype.applyVerticalGroundOffsetView=function(e,t,n,r){var i=d.vec3.length(e),a=n.aboveGround?1:-1,o=.5*n.computeRenderPixelSizeAtDist(i),s=d.vec3.scale(I,t.normal,a*o);return d.vec3.add(r,e,s),r},t.prototype.applyVerticalOffsetTransformationView=function(e,t,n,r){var i=this.params;if(!i.verticalOffset||!i.verticalOffset.screenLength){if(i.screenSizePerspective||i.screenSizePerspectiveAlignment){var a=d.vec3.length(e);this.updateScaleInfo(r,a,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}var o=d.vec3.length(e),s=S.verticalOffsetAtDistance(n,o,i.verticalOffset,t.cosAngle,i.screenSizePerspectiveAlignment||i.screenSizePerspective);return this.updateScaleInfo(r,o,t.cosAngle),d.vec3.scale(t.normal,t.normal,s),d.vec3.add(e,e,t.normal)},t.prototype.applyCenterOffsetView=function(e,t,n){var r="screen"!==this.params.centerOffsetUnits;return n!==e&&d.vec3.copy(n,e),r&&(n[0]+=t[0],n[1]+=t[1],t[2]&&(d.vec3.normalize(V,n),d.vec3.add(n,n,d.vec3.scale(V,V,t[2])))),n},t.prototype.applyCenterOffsetNDC=function(e,t,n,r){var i="screen"!==this.params.centerOffsetUnits;return r!==e&&d.vec3.copy(r,e),i||(r[0]+=t[0]/n.fullWidth*2,r[1]+=t[1]/n.fullHeight*2),r},t.prototype.applyPolygonOffsetNDC=function(e,t,n,i){var a=this.params.shaderPolygonOffset;if(e!==i&&d.vec3.copy(i,e),a){var o=n.aboveGround?1:-1,s=o*r.sign(t[3]);i[2]-=(s||o)*a}return i},t.prototype.getGLMaterial=function(e){return 0===e.output?new R(e):4===e.output?new A(e):void 0},t.prototype.calculateRelativeScreenBounds=function(e,t,n){return void 0===n&&(n=v.create()),function(e,t,n,r){void 0===r&&(r=j),u.vec2.copy(r,e.anchorPos),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*n,r[1]+=e.screenOffset[1]*n}(this.params,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n},t}(_.Material);t.default=C;var D=function(e){function t(t){var r=e.call(this,n.__assign(n.__assign({},t),t.material.getParameters()))||this;return r.updateParameters(),r}return n.__extends(t,e),t.prototype.beginSlot=function(e){return e===(this.params.drawInSecondSlot?19:18)},t.prototype.updateParameters=function(){this.params=S.copyParameters(this.material.getParameters()),this.updateTexture(this.params.textureId),this.selectProgram()},t.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(M.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.params,t)},t}(y),R=function(e){function t(t){var r=e.call(this,n.__assign(n.__assign({},t),{output:0}))||this;return r.isOcclusionSlot=!1,r}return n.__extends(t,e),t.prototype.beginSlot=function(e){var t=this.params.drawInSecondSlot?19:18;return this.params.occlusionTest?(this.isOcclusionSlot=12===e,12===e||e===t):(this.isOcclusionSlot=!1,e===t)},t.prototype.getTechnique=function(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique},t.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(M.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique),this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(M.HUDMaterialTechnique,this.material.getTechniqueConfig(6),this.occlusionTechnique)},t.prototype.bind=function(e,t){var n=this.getTechnique();e.bindProgram(n.program),this.isOcclusionSlot||(this.bindTexture(e,n.program),this.bindTextureScale(e,n.program)),n.bindPass(e,this.params,t)},t}(D),A=function(e){function t(t){return e.call(this,n.__assign(n.__assign({},t),{output:4}))||this}return n.__extends(t,e),t}(D);function E(e,t,n,r,i,a,o,s){var l=t-i-(s[0]>0?r[0]*s[0]:0),c=l+r[0]+2*i,u=n-i-(s[1]>0?r[1]*s[1]:0),p=u+r[1]+2*i;if(o.textureIsSignedDistanceField){var d=o.distanceFieldBoundingBox;l+=r[0]*d[0],u+=r[1]*d[1],c-=r[0]*(1-d[2]),p-=r[1]*(1-d[3]),l-=a,c+=a,u-=a,p+=a}return e[0]>l&&e[0]<c&&e[1]>u&&e[1]<p}var T={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},j=p.vec2f64.create(),I=h.vec3f64.create(),V=h.vec3f64.create(),L=a.createRenderScreenPointArray3(),z=h.vec3f64.create(),N=h.vec3f64.create(),U=s.mat3f64.create(),G=s.mat3f64.create(),F=c.mat4f64.create(),H=h.vec3f64.create(),k={normal:z,cosAngle:0},q=c.mat4f64.create(),W=1,B=2,Z=[0,0],X=h.vec3f64.fromValues(0,0,1),Y={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:p.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,debugDrawBorder:!1},J=m.newLayout().vec3f(x.VertexAttrConstants.POSITION).vec3f(x.VertexAttrConstants.NORMAL).vec2f(x.VertexAttrConstants.UV0).vec4u8(x.VertexAttrConstants.COLOR).vec2f(x.VertexAttrConstants.SIZE).vec4f(x.VertexAttrConstants.AUXPOS1).vec4f(x.VertexAttrConstants.AUXPOS2),Q=function(){function e(e){this.material=e,this.vertexBufferLayout=J}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[x.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,n,r){w.writePosition(t.indices[x.VertexAttrConstants.POSITION],t.vertexAttr[x.VertexAttrConstants.POSITION].data,e.transformation,n.position,r,6),w.writeNormal(t.indices[x.VertexAttrConstants.NORMAL],t.vertexAttr[x.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,n.normal,r,6);var i=t.vertexAttr[x.VertexAttrConstants.UV0].data,a=void 0,o=void 0,s=void 0,l=void 0;if(null==i||i.length<4){var c=this.material.getParameters();a=0,o=0,s=c.texCoordScale[0],l=c.texCoordScale[1]}else a=i[0],o=i[1],s=i[2],l=i[3];s=Math.min(1.99999,s+1),l=Math.min(1.99999,l+1);for(var u=t.indices[x.VertexAttrConstants.POSITION].length,p=n.uv0,d=r,h=0;h<u;++h)p.set(d,0,a),p.set(d,1,o),p.set(d+=1,0,s),p.set(d,1,o),p.set(d+=1,0,s),p.set(d,1,l),p.set(d+=1,0,s),p.set(d,1,l),p.set(d+=1,0,a),p.set(d,1,l),p.set(d+=1,0,a),p.set(d,1,o),d+=1;w.writeColor(t.indices[x.VertexAttrConstants.COLOR],t.vertexAttr[x.VertexAttrConstants.COLOR].data,4,n.color,r,6);var f=t.indices[x.VertexAttrConstants.SIZE],v=t.vertexAttr[x.VertexAttrConstants.SIZE].data,m=f.length,g=n.size;for(d=r,h=0;h<m;++h)for(var y=v[2*f[h]],_=v[2*f[h]+1],b=0;b<6;++b)g.set(d,0,y),g.set(d,1,_),d+=1;t.indices[x.VertexAttrConstants.AUXPOS1]&&t.vertexAttr[x.VertexAttrConstants.AUXPOS1]&&w.writeBufferVec4(t.indices[x.VertexAttrConstants.AUXPOS1],t.vertexAttr[x.VertexAttrConstants.AUXPOS1].data,n.auxpos1,r,6),t.indices[x.VertexAttrConstants.AUXPOS2]&&t.vertexAttr[x.VertexAttrConstants.AUXPOS2]&&w.writeBufferVec4(t.indices[x.VertexAttrConstants.AUXPOS2],t.vertexAttr[x.VertexAttrConstants.AUXPOS2].data,n.auxpos2,r,6)},e}()}).apply(null,r))||(e.exports=i)},xdO3:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("jZlN"),n("pcDC"),n("rg9i"),n("LxLY"),n("rusB"),n("Lzvl"),n("ZcgO")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){"use strict";function c(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function p(e){return"declaredClass"in e}function d(e){return a.isNone(e)?null:c(e)?e:s.fromJSON(function(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var n=e.hasZ,i=e.hasM;return{rings:h(e.rings),hasZ:n,hasM:i,spatialReference:t};case"polyline":return n=e.hasZ,i=e.hasM,{paths:h(e.paths),hasZ:n,hasM:i,spatialReference:t};case"extent":return{xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax,hasZ:n=e.hasZ,hasM:i=e.hasM,spatialReference:t};case"multipoint":var a=e.points;return n=e.hasZ,i=e.hasM,{points:v(a)?f(a):a,hasZ:n,hasM:i,spatialReference:t};default:return void r.neverReached(e)}}(e))}function h(e){return function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(0!==r.length)return v(r)}return!1}(e)?e.map((function(e){return f(e)})):e}function f(e){return e.map((function(e){return o.toArray(e)}))}function v(e){return e.length&&(o.isFloat32Array(e[0])||o.isFloat64Array(e[0]))}Object.defineProperty(t,"__esModule",{value:!0}),t.clonePoint=t.hydrateGeometry=t.hydrateGraphic=t.isHydratedGraphic=t.isHydratedPoint=t.isHydratedGeometry=void 0,t.isHydratedGeometry=c,t.isHydratedPoint=u,t.isHydratedGraphic=p,t.hydrateGraphic=function(e,t){if(!e)return null;if(p(e))return e;var r=new n({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=i.clone(e.symbol),r.attributes=i.clone(e.attributes),r.geometry=d(e.geometry),r},t.hydrateGeometry=d,t.clonePoint=function(e,t){if(!e)return null;var n;if(u(e)){if(null==t)return e.clone();if(u(t))return t.copy(e)}return null!=t?((n=t).x=e.x,n.y=e.y,n.spatialReference=e.spatialReference,e.hasZ?(n.z=e.z,n.hasZ=e.hasZ):(n.z=null,n.hasZ=!1),e.hasM?(n.m=e.m,n.hasM=!0):(n.m=null,n.hasM=!1)):(n=l.makeDehydratedPoint(e.x,e.y,e.z,e.spatialReference),e.hasM&&(n.m=e.m,n.hasM=!0)),n}}).apply(null,r))||(e.exports=i)},y68M:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("qMld")],void 0===(i=(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderTechniqueRepository=void 0;var a=function(e){this.technique=e,this.refCount=0,this.refZeroFrame=0},o=function(){function e(e){this._context=e,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=1200}return Object.defineProperty(e.prototype,"viewingMode",{get:function(){return this._context.viewingMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"constructionContext",{get:function(){return this._context},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.dispose()}))})),this._perConstructorInstances.clear()},e.prototype.acquire=function(e,t){var n=t.key,r=this._perConstructorInstances.get(e);r||(r=new Map,this._perConstructorInstances.set(e,r));var i=r.get(n);return void 0===i&&(i=new a(new e(this._context,t)),r.set(n,i)),++i.refCount,i.technique},e.prototype.acquireAndReleaseExisting=function(e,t,n){return r.isNone(n)?this.acquire(e,t):t.key===n.key&&n instanceof e?n:(this.release(n),this.acquire(e,t))},e.prototype.release=function(e){var t=this._perConstructorInstances.get(e.constructor).get(e.key);t.refCount-=1,0===t.refCount&&(t.refZeroFrame=this._frameCounter)},e.prototype.frameUpdate=function(){var e=this;this._frameCounter++,this._perConstructorInstances.forEach((function(t,n){t.forEach((function(n,r){0===n.refCount&&n.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(n.technique.dispose(),t.delete(r))})),0===t.size&&e._perConstructorInstances.delete(n)}))},e.prototype.getProgramsUsingUniform=function(e){return this._context.commonUniformStore.getPrograms(e)},e.prototype.hotReload=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t=this;return n.__generator(this,(function(r){switch(r.label){case 0:return e=new Array,this._perConstructorInstances.forEach((function(r,i){e.push(function(e,r){return n.__awaiter(t,void 0,void 0,(function(){var t,i=this;return n.__generator(this,(function(n){switch(n.label){case 0:return(t=r.shader)?[4,t.reload()]:[3,2];case 1:n.sent(),e.forEach((function(e){e.technique.reload(i._context)})),n.label=2;case 2:return[2]}}))}))}(r,i))})),[4,i.all(e)];case 1:return r.sent(),[2]}}))}))},e}();t.ShaderTechniqueRepository=o}).apply(null,r))||(e.exports=i)},yVFQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("qsST"),n("xdO3"),n("sCbS")],void 0===(i=(function(e,t,n,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zeroContext=t.extractExpressionInfo=t.execute=t.setContextFeature=t.createFeature=t.createContext=t.createContextWithoutExpressionSupport=t.clone=void 0;var o=r.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function s(e){return null!=e.cachedResult}function l(e){return"0"===e?0:null}t.clone=function(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}},t.createContextWithoutExpressionSupport=function(e){var t=e&&e.expression;if("string"==typeof t){var n=l(t);if(null!=n)return{cachedResult:n}}return null},t.createContext=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,o,s,c,u;return n.__generator(this,(function(n){switch(n.label){case 0:return"string"!=typeof(i=e&&e.expression)?[2,null]:null!=(o=l(i))?[2,{cachedResult:o}]:[4,a.loadArcade()];case 1:return s=n.sent(),u=(c=s.arcadeUtils).createSyntaxTree(i),c.dependsOnView(u)?(null!=r&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),[2,{cachedResult:0}]):[2,{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:s}}]}}))}))},t.createFeature=function(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)},t.setContextFeature=function(e,t){if(null!=e&&!s(e)){if(!t||!e.arcade)return void o.errorOncePerTick("Arcade support required but not provided");t._geometry&&(t._geometry=i.hydrateGeometry(t._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}},t.execute=function(e){if(null!=e){if(s(e))return e.cachedResult;var t=e.arcade,n=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0},t.extractExpressionInfo=function(e,t){void 0===t&&(t=!1);var n=e&&e.featureExpressionInfo;return t||"0"===(n&&n.expression)||(n=null),n},t.zeroContext={cachedResult:0}}).apply(null,r))||(e.exports=i)},ybGv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Gamma=void 0,t.Gamma=function(e){e.fragment.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    const float GAMMA = 2.2;\n    const float INV_GAMMA = 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "],["\n    const float GAMMA = 2.2;\n    const float INV_GAMMA = 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},yjgM:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("QDcU"),n("eIBl"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("DtIM"),n("woUR"),n("B3XD"),n("X5J5"),n("Fe95"),n("48/q"),n("dtql"),n("TIRl"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoveXYDiscManipulation=void 0;var S=function(e){function t(t){var n=e.call(this)||this;return n._handles=new i,n._snapToScene=new g.SnapToScene,n._discMaterial=n._createMaterial(),n._discMaterialTransparent=n._createMaterial(.5),n._scale=1,n._radius=f.DISC_RADIUS,n._view=t.view,n._tool=t.tool,null!=t.snapToScene&&(n.snapToScene=t.snapToScene),null!=t.radius&&(n._radius=t.radius),n._createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return n.__extends(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null},t.prototype.forEachManipulator=function(e){e(this._manipulator,1)},Object.defineProperty(t.prototype,"displayScale",{get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapToScene",{get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())},enumerable:!1,configurable:!0}),t.prototype.createGraphicDragPipeline=function(e,t){var n=this,r=e.graphic,i=u.getGraphicEffectiveElevationInfo(r),o=a.unwrap(r.geometry).spatialReference;return m.createGraphicMoveDragPipeline(e,t,(function(e){return n.createDragPipeline(e,i,o)}))},t.prototype.createDragPipeline=function(e,t,n){var r=this,i=this._view;return w.createManipulatorDragEventPipeline(this._manipulator,(function(a,o,s,l){var c=o.next(w.dragAtLocation(i,a.elevationAlignedLocation)).next(d.screenToMapXYAtLocation(i,a.elevationAlignedLocation,t,n)).next(r._snapToScene.createDragEventPipelineStep(i,t),r._snapToScene.next).next(w.addScreenDelta());e(a,c,s,l)}))},t.prototype._updateManipulatorTransform=function(){var e=o.mat4.fromScaling(y.sm4d.get(),l.vec3.set(y.sv3d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e},t.prototype._createManipulator=function(){this._manipulator=new p.Manipulator3D({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:c.vec3f64.fromValues(0,0,1)},worldOriented:!0}),this._updateManipulator()},t.prototype._updateManipulator=function(){var e=new _(b.createCylinderGeometry(f.DISC_HEIGHT,1,f.GEOMETRY_SEGMENTS,c.vec3f64.fromValues(0,0,1),c.vec3f64.fromValues(0,0,0)),"graphic-transform-disc"),t=o.mat4.fromScaling(s.mat4f64.create(),c.vec3f64.fromValues(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=f.DISC_COLLISION_RADIUS*(this._radius/f.DISC_RADIUS)},t.prototype._createMaterial=function(e){void 0===e&&(e=1);var t=r.toUnitRGBA(h.colors.main);t[3]*=e;var n=new x({color:t,transparent:1!==e,cullFace:2},"move-xy-disc");return n.renderOccluded=2,n},Object.defineProperty(t.prototype,"test",{get:function(){return{discManipulator:this._manipulator}},enumerable:!1,configurable:!0}),t}(v.Manipulation);t.MoveXYDiscManipulation=S}).apply(null,r))||(e.exports=i)},z4cv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createView=t.fromValues=t.clone=t.create=void 0,t.create=function(){return[1,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3]]},t.fromValues=function(e,t,n,r){return[e,t,n,r]},t.createView=function(e,t){return new Float64Array(e,t,4)}}).apply(null,r))||(e.exports=i)},znI2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("CIy2")],void 0===(i=(function(e,t,n){"use strict";function r(e){return n.getFirstObjectValue(e.data.indices).length>=1}Object.defineProperty(t,"__esModule",{value:!0}),t.splitRenderGeometryChangeSetByMaterial=void 0,t.splitRenderGeometryChangeSetByMaterial=function(e){for(var t=new Map,n=null,i=null,a=function(e){if(e===n)return i;var r=t.get(e);return r||t.set(e,r={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1}),n=e,i=r,r},o=0;o<e.numToAdd;o++)r(s=e.toAdd[o])&&a(s.material).toAdd.push(s);for(o=0;o<e.numToRemove;o++){var s;r(s=e.toRemove[o])&&a(s.material).toRemove.push(s)}for(o=0;o<e.numToUpdate;o++){var l=e.toUpdate[o];r(l.renderGeometry)&&a(l.renderGeometry.material).toUpdate.push(l)}return t}}).apply(null,r))||(e.exports=i)}}]);