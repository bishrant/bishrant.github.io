!function(){function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?e(Object(a),!0).forEach(function(e){r(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=u(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function a(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t,r,n,a,u,s){try{var i=e[u](s),o=i.value}catch(c){return void r(c)}i.done?t(o):Promise.resolve(o).then(n,a)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var u=e.apply(t,r);function s(e){i(u,n,a,s,o,"next",e)}function o(e){i(u,n,a,s,o,"throw",e)}s(void 0)})}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=h(e);if(t){var a=h(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return f(this,r)}}function f(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{DlAm:function(e,r,u){"use strict";u.r(r);var s=u("pO5D"),i=u("wSAH"),f=u("f/qv"),h=u("nR38"),y=u("srIe"),m=(u("6S2I"),u("zqDF"),u("WbKI")),b=u("04ZG"),v=u("zlDU"),g=u("4EHJ"),R=(u("ju1D"),u("9AIY"),u("OvF4")),O=u("Lqtk"),w=u("bV/r"),k=u("ZYtI"),x=u("iRQj"),j=u("2LKE"),F=u("/uz8"),I=u("iNG6"),_=new Set(["Feature Layer","Table"]),q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(G,e);var r,u,s,m,b,w,q,A,S,E,P,T,D,J,U,N,L,z=p(G);function G(){var e;return c(this,G),(e=z.apply(this,arguments)).type="feature-layer",e}return r=G,(u=[{key:"load",value:function(e){var t=Object(y.k)(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),Promise.resolve(this)}},{key:"queryTask",get:function(){var e=this.layer,t=e.capabilities.query.supportsFormatPBF,r=e.parsedUrl,n=e.dynamicDataSource,a=e.gdbVersion,u=e.spatialReference,s=e.fieldsIndex,o=Object(i.a)("featurelayer-pbf")&&t?"pbf":"json";return new F.a({url:r.path,format:o,fieldsIndex:s,dynamicDataSource:n,gdbVersion:a,sourceSpatialReference:u})}},{key:"addAttachment",value:(L=o(regeneratorRuntime.mark(function e(t,r){var n,a,u,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return n=t.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+"/"+n+"/addAttachment",u=this._getLayerRequestOptions(),s=this._getFormDataForAttachment(r,u.query),e.prev=3,e.next=6,Object(O.default)(a,{body:s});case 6:return i=e.sent,e.abrupt("return",this._createFeatureEditResult(i.data.addAttachmentResult));case 10:throw e.prev=10,e.t0=e.catch(3),this._createAttachmentErrorResult(n,e.t0);case 13:case"end":return e.stop()}},e,this,[[3,10]])})),function(e,t){return L.apply(this,arguments)})},{key:"updateAttachment",value:(N=o(regeneratorRuntime.mark(function e(t,r,n){var a,u,s,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return a=t.attributes[this.layer.objectIdField],u=this.layer.parsedUrl.path+"/"+a+"/updateAttachment",s=this._getLayerRequestOptions({query:{attachmentId:r}}),i=this._getFormDataForAttachment(n,s.query),e.prev=3,e.next=6,Object(O.default)(u,{body:i});case 6:return o=e.sent,e.abrupt("return",this._createFeatureEditResult(o.data.updateAttachmentResult));case 10:throw e.prev=10,e.t0=e.catch(3),this._createAttachmentErrorResult(a,e.t0);case 13:case"end":return e.stop()}},e,this,[[3,10]])})),function(e,t,r){return N.apply(this,arguments)})},{key:"applyEdits",value:(U=o(regeneratorRuntime.mark(function e(t,r){var u,s,i,o,c,l,d,p,f,h,y,m,b,v,g;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:u=t.addFeatures.map(this._serializeFeature,this),s=t.updateFeatures.map(this._serializeFeature,this),i=this._getFeatureIds(t.deleteFeatures,null==r?void 0:r.globalIdUsed),Object(x.b)(u,s,this.layer.spatialReference),o=[],c=[],l=a(t.deleteAttachments),d=n(t.addAttachments),e.prev=6,d.s();case 8:if((p=d.n()).done){e.next=17;break}return f=p.value,e.t0=o,e.next=13,this._serializeAttachment(f);case 13:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t2=e.catch(6),d.e(e.t2);case 22:return e.prev=22,d.f(),e.finish(22);case 25:h=n(t.updateAttachments),e.prev=26,h.s();case 28:if((y=h.n()).done){e.next=37;break}return m=y.value,e.t3=c,e.next=33,this._serializeAttachment(m);case 33:e.t4=e.sent,e.t3.push.call(e.t3,e.t4);case 35:e.next=28;break;case 37:e.next=42;break;case 39:e.prev=39,e.t5=e.catch(26),h.e(e.t5);case 42:return e.prev=42,h.f(),e.finish(42);case 45:return b=o.length||c.length||l.length?{adds:o,updates:c,deletes:l}:null,v=this._getLayerRequestOptions({method:"post",query:{adds:u.length?JSON.stringify(u):null,updates:s.length?JSON.stringify(s):null,deletes:i.length?null!=r&&r.globalIdUsed?JSON.stringify(i):i.join(","):null,gdbVersion:(null==r?void 0:r.gdbVersion)||this.layer.gdbVersion,rollbackOnFailure:null==r?void 0:r.rollbackOnFailureEnabled,useGlobalIds:null==r?void 0:r.globalIdUsed,attachments:b&&JSON.stringify(b)}}),e.next=49,Object(O.default)(this.layer.parsedUrl.path+"/applyEdits",v);case 49:return g=e.sent,e.abrupt("return",this._createEditsResult(g));case 51:case"end":return e.stop()}},e,this,[[6,19,22,25],[26,39,42,45]])})),function(e,t){return U.apply(this,arguments)})},{key:"deleteAttachments",value:(J=o(regeneratorRuntime.mark(function e(t,r){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return n=t.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+"/"+n+"/deleteAttachments",e.prev=3,e.next=6,Object(O.default)(a,this._getLayerRequestOptions({query:{attachmentIds:r.join(",")},method:"post"}));case 6:return e.abrupt("return",e.sent.data.deleteAttachmentResults.map(this._createFeatureEditResult));case 9:throw e.prev=9,e.t0=e.catch(3),this._createAttachmentErrorResult(n,e.t0);case 12:case"end":return e.stop()}},e,this,[[3,9]])})),function(e,t){return J.apply(this,arguments)})},{key:"fetchRecomputedExtents",value:function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.load({signal:r.signal}).then(o(regeneratorRuntime.mark(function n(){var a,u,s,i,o,c,l,d,p,f,h;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=e._getLayerRequestOptions(t(t({},r),{},{query:{returnUpdates:!0}})),u=e.layer,s=u.layerId,i=u.url,n.next=6,Object(O.default)("".concat(i,"/").concat(s),a);case 6:return o=n.sent,c=o.data,l=c.id,d=c.extent,p=c.fullExtent,f=c.timeExtent,h=d||p,n.abrupt("return",{id:l,fullExtent:h&&R.a.fromJSON(h),timeExtent:f&&k.a.fromJSON({start:f[0],end:f[1]})});case 14:case"end":return n.stop()}},n)})))}},{key:"queryAttachments",value:(D=o(regeneratorRuntime.mark(function e(t){var r,a,u,s,i,o,c,l,d,p,f=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>1&&void 0!==f[1]?f[1]:{},a=this.layer.parsedUrl,u=a.path,e.next=4,this.load();case 4:if(s=this._getLayerRequestOptions(r),this.layer.get("capabilities.operations.supportsQueryAttachments")){e.next=10;break}i=t.objectIds,o=[],c=n(i);try{for(c.s();!(l=c.n()).done;)d=l.value,p=u+"/"+d+"/attachments",o.push(Object(O.default)(p,s))}catch(h){c.e(h)}finally{c.f()}return e.abrupt("return",Promise.all(o).then(function(e){return i.map(function(t,r){return{parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}})}).then(function(e){return Object(j.b)(e,u)}));case 10:return e.abrupt("return",this.queryTask.executeAttachmentQuery(t,s));case 11:case"end":return e.stop()}},e,this)})),function(e){return D.apply(this,arguments)})},{key:"queryFeatures",value:(T=o(regeneratorRuntime.mark(function e(r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.execute(r,t(t({},n),{},{query:t(t({},this.layer.customParameters),null==n?void 0:n.query)})));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return T.apply(this,arguments)})},{key:"queryFeaturesJSON",value:(P=o(regeneratorRuntime.mark(function e(r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeJSON(r,t(t({},n),{},{query:t(t({},this.layer.customParameters),null==n?void 0:n.query)})));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return P.apply(this,arguments)})},{key:"queryObjectIds",value:(E=o(regeneratorRuntime.mark(function e(r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForIds(r,t(t({},n),{},{query:t(t({},this.layer.customParameters),null==n?void 0:n.query)})));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return E.apply(this,arguments)})},{key:"queryFeatureCount",value:(S=o(regeneratorRuntime.mark(function e(r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForCount(r,t(t({},n),{},{query:t(t({},this.layer.customParameters),null==n?void 0:n.query)})));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return S.apply(this,arguments)})},{key:"queryExtent",value:(A=o(regeneratorRuntime.mark(function e(r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForExtent(r,t(t({},n),{},{query:t(t({},this.layer.customParameters),null==n?void 0:n.query)})));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return A.apply(this,arguments)})},{key:"queryRelatedFeatures",value:(q=o(regeneratorRuntime.mark(function e(r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeRelationshipQuery(r,t(t({},n),{},{query:t(t({},this.layer.customParameters),null==n?void 0:n.query)})));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return q.apply(this,arguments)})},{key:"queryRelatedFeaturesCount",value:(w=o(regeneratorRuntime.mark(function e(r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeRelationshipQueryForCount(r,t(t({},n),{},{query:t(t({},this.layer.customParameters),null==n?void 0:n.query)})));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return w.apply(this,arguments)})},{key:"_fetchService",value:(b=o(regeneratorRuntime.mark(function e(t){var r,n,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.layer.sourceJSON){e.next=7;break}return e.next=4,Object(O.default)(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:Object(i.a)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:t}));case 4:n=e.sent,a=n.data,r=a;case 7:if(this.sourceJSON=this._patchServiceJSON(r),u=r.type,_.has(u)){e.next=11;break}throw new v.a("feature-layer-source:unsupported-type",'Source type "'.concat(u,'" is not supported'));case 11:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"_patchServiceJSON",value:function(e){var t;if("Table"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){var r=Object(I.c)(e.geometryType).renderer;Object(h.c)("drawingInfo.renderer",r,e)}return e}},{key:"_serializeFeature",value:function(e){var t=e.geometry,r=e.attributes;return Object(y.j)(t)?{attributes:r}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:r}}},{key:"_serializeAttachment",value:(m=o(regeneratorRuntime.mark(function e(t){var r,n,a,u,s,i,c,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.feature,n=t.attachment,a=n.globalId,u=n.name,s=n.contentType,i=n.data,c=n.uploadId,l={globalId:a,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null},r&&(l.parentGlobalId="attributes"in r?r.attributes&&r.attributes[this.layer.globalIdField]:r.globalId),!c){e.next=5;break}l.uploadId=c,e.next=10;break;case 5:if(!i){e.next=10;break}return e.next=8,function(){var e=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","string"==typeof t?Object(g.i)(t)||{data:t}:new Promise(function(e,r){var n=new FileReader;n.readAsDataURL(t),n.onload=function(){return e(Object(g.i)(n.result))},n.onerror=function(e){return r(e)}}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()(i);case 8:d=e.sent,l.contentType=d.mediaType,l.data=d.data,i instanceof File&&(l.name=i.name);case 10:return e.abrupt("return",(u&&(l.name=u),s&&(l.contentType=s),l));case 11:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"_getFeatureIds",value:function(e,t){var r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):"objectId"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}},{key:"_getIdsFromFeatures",value:function(e){var t=this.layer.objectIdField;return e.map(function(e){return e.attributes&&e.attributes[t]})}},{key:"_canUseGlobalIds",value:function(e,t){return e&&"globalId"in t[0]}},{key:"_getObjectIdsFromFeatureIdentifier",value:function(e){return e.map(function(e){return e.objectId})}},{key:"_getGlobalIdsFromFeatureIdentifier",value:function(e){return e.map(function(e){return e.globalId})}},{key:"_createEditsResult",value:function(e){var t=e.data,r=e.data&&e.data.attachments;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:r&&r.addResults?r.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:r&&r.updateResults?r.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:r&&r.deleteResults?r.deleteResults.map(this._createFeatureEditResult,this):[]}}},{key:"_createFeatureEditResult",value:function(e){var t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new v.a("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}},{key:"_createAttachmentErrorResult",value:function(e,t){return{objectId:e,globalId:null,error:new v.a("feature-layer-source:attachment-failure",t.details.messages&&t.details.messages[0]||t.message,{code:t.details.httpStatus||t.details.messageCode})}}},{key:"_getFormDataForAttachment",value:function(e,t){var r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(var n in t){var a=t[n];null!=a&&(r.set?r.set(n,a):r.append(n,a))}return r}},{key:"_getLayerRequestOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this.layer,n=r.parsedUrl,a=r.gdbVersion,u=r.dynamicDataSource;return t(t({},e),{},{query:Object(f.c)(t(t(t({gdbVersion:a,layer:u?JSON.stringify({source:u}):void 0},n.query),{},{f:"json"},this.layer.customParameters),null==e?void 0:e.query)),responseType:"json"})}}])&&l(r.prototype,u),s&&l(r,s),G}(w.a);Object(s.a)([Object(m.b)()],q.prototype,"type",void 0),Object(s.a)([Object(m.b)({constructOnly:!0})],q.prototype,"layer",void 0),Object(s.a)([Object(m.b)({readOnly:!0})],q.prototype,"queryTask",null),q=Object(s.a)([Object(b.a)("esri.layers.graphics.sources.FeatureLayerSource")],q),r.default=q}}])}();