(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{FxzD:function(t,e,i){"use strict";var r=i("srIe"),s=i("OKTS"),n=i("qRWG"),a=i("Cy1f"),o=i("5DEt"),c=i("aAs6"),h=i("15Hh"),l=i("r+FG"),d=i("AvGH"),u=i("D8Ta"),b=i("M0lq"),f=i("dXfX"),p=i("IEcw"),_=i("0Kx6"),g=i("EVMh");class j{constructor(t=null,e=null,i=null){this._viewUp=Object(a.e)(),this._viewForward=Object(a.e)(),this._viewRight=Object(a.e)(),this._ray=_.f.createWrapper(),this._viewport=Object(u.d)(0,0,1,1),this._padding=Object(u.d)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(d.e)(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(l.b)(),this._projectionDirty=!0,this._projectionMatrix=Object(l.b)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(l.b)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(l.b)(),this._frustumDirty=!0,this._frustum=_.c.create(),this._fullViewport=Object(u.c)(),this.pixelRatio=1,this.relativeElevation=0,this._eye=Object(r.k)(t)?Object(a.d)(t):Object(a.e)(),this._center=Object(r.k)(e)?Object(a.d)(e):Object(a.e)(),this._up=Object(r.k)(i)?Object(a.d)(i):Object(a.g)(0,0,1)}get eye(){return this._eye}set eye(t){this._compareAndSetView(t,this._eye)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=Object(a.e)()),Object(o.i)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Object(h.c)(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){this._viewport[0]!==(t+=this._padding[3])&&(this._viewport[0]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){this._viewport[1]!==(t+=this._padding[2])&&(this._viewport[1]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(t){this.width=t-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(t){this.height=t-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[0]===t[0]&&this._padding[1]===t[1]&&this._padding[2]===t[2]&&this._padding[3]===t[3]||(this._viewport[0]+=t[3]-this._padding[3],this._viewport[1]+=t[2]-this._padding[2],this._viewport[2]-=t[1]+t[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=t[0]+t[2]-(this._padding[0]+this._padding[2]),Object(f.c)(this._padding,t),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Object(h.l)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this.aspect;Object(h.h)(this._projectionMatrix,-r*(1+2*this._padding[3]/t),r*(1+2*this._padding[1]/t),-i*(1+2*this._padding[2]/e),i*(1+2*this._padding[0]/e),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(t){Object(h.c)(this._projectionMatrix,t),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Object(g.b)(this._fov,this.width,this.height)}set fovX(t){this._fov=Object(g.d)(t,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Object(g.c)(this._fov,this.width,this.height)}set fovY(t){this._fov=Object(g.e)(t,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Object(o.n)(this._center,this._eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(h.a)(this._viewInverseTransposeMatrix,this.viewMatrix),Object(h.b)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){return 2*this.near*this.far/(this.far+this.near-(2*t-1)*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){const e=t;return Object(o.j)(this._eye,e._eye),Object(o.j)(this._center,e._center),Object(o.j)(this._up,e._up),Object(f.c)(this._viewport,e._viewport),Object(f.c)(this._padding,e._padding),Object(b.c)(this._nearFar,e._nearFar),this._fov=e._fov,this.relativeElevation=t.relativeElevation,this._viewDirty=e._viewDirty,this._viewDirty||(Object(h.c)(this._viewMatrix,e._viewMatrix),Object(o.j)(this._viewRight,e._viewRight),Object(o.j)(this._viewUp,e._viewUp),Object(o.j)(this._viewForward,e._viewForward)),e._projectionDirty?this._projectionDirty=!0:(Object(h.c)(this._projectionMatrix,e._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(_.c.copy(e._frustum,this._frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(h.c)(this._viewInverseTransposeMatrix,e._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(f.c)(this._fullViewport,e._fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return(new j).copyFrom(this)}equals(t){return Object(o.p)(this._eye,t._eye)&&Object(o.p)(this._center,t._center)&&Object(o.p)(this._up,t._up)&&Object(f.g)(this._viewport,t._viewport)&&Object(f.g)(this._padding,t._padding)&&Object(b.k)(this._nearFar,t._nearFar)&&this._fov===t._fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this.pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const e=5e-4;Object(o.u)(O,t.eye,t.center),Object(o.u)(y,this._eye,this._center);const i=Object(o.g)(O,y),r=Object(o.x)(O),s=Object(o.x)(y);return i*i>=(1-1e-10)*r*s&&Object(o.y)(t.eye,this._eye)<Math.max(r,s)*e*e&&Object(f.i)(t.padding,this._padding)<.5&&Object(f.i)(t.viewport,this._viewport)<.5}markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(t))}viewDirectionDistance(t){return Math.abs(Object(p.c)(this.viewForward,Object(o.i)(O,t,this._eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Object(n.g)()){return t[0]=(this.padding[3]+this.width/2)/this.pixelRatio,t[1]=(this.padding[0]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t||(t=Object(n.e)()),t[0]=this.padding[3]+this.width*e,t[1]=this.padding[2]+this.height*i,t.length>2&&(t[2]=.5),t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e,i=!1){t!==m&&Object(o.j)(m,t),m[3]=1,i&&(e[2]=-m[2]),Object(f.m)(m,m,this.projectionMatrix),Object(o.d)(m,m,1/Math.abs(m[3]));const r=this.fullViewport;return e[0]=Object(s.i)(0,r[0]+r[2],.5+.5*m[0]),e[1]=Object(s.i)(0,r[1]+r[3],.5+.5*m[1]),i||(e[2]=.5*(m[2]+1)),e}projectToScreen(t,e){return this.projectToRenderScreen(t,w),this.renderToScreen(w,e)}projectToRenderScreen(t,e){if(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=1,Object(f.m)(m,m,this.viewProjectionMatrix),0===m[3])return null;Object(o.d)(m,m,1/Math.abs(m[3]));const i=this.fullViewport;return"x"in e?(e.x=Object(s.i)(0,i[0]+i[2],.5+.5*m[0]),e.y=Object(s.i)(0,i[1]+i[3],.5+.5*m[1])):(e[0]=Object(s.i)(0,i[0]+i[2],.5+.5*m[0]),e[1]=Object(s.i)(0,i[1]+i[3],.5+.5*m[1]),e.length>2&&(e[2]=.5*(m[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,w),e)}unprojectFromRenderScreen(t,e){if(Object(h.l)(v,this.projectionMatrix,this.viewMatrix),!Object(h.a)(v,v))return null;const i=this.fullViewport;return m[0]=2*(t[0]-i[0])/i[2]-1,m[1]=2*(t[1]-i[1])/i[3]-1,m[2]=2*t[2]-1,m[3]=1,Object(f.m)(m,m,v),0===m[3]?null:(e[0]=m[0]/m[3],e[1]=m[1]/m[3],e[2]=m[2]/m[3],e)}constrainWindowSize(t,e,i,r=1){const s=t*this.pixelRatio,n=e*this.pixelRatio,a=Math.max(s-i*r/2,0),o=Math.max(this.fullHeight-n-i/2,0),c=-Math.min(s-i*r/2,0),h=-Math.min(this.fullHeight-n-i/2,0);return[a,o,i*r-c- -Math.min(this.fullWidth-s-i*r/2,0),i-h- -Math.min(n-i/2,0)]}computeUp(t){1===t?this.computeUpGlobal():this.computeUpLocal()}screenToRender(t,e){const i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=t[0]*this.pixelRatio,e[1]=i,e}renderToScreen(t,e){const i=(this.fullHeight-t[1])/this.pixelRatio;return e[0]=t[0]/this.pixelRatio,e[1]=i,e}computeUpGlobal(){Object(o.i)(O,this.center,this.eye);const t=Object(o.o)(this.center);t<1?(Object(o.v)(this.up,0,0,1),this.markViewDirty()):Math.abs(Object(o.g)(O,this.center))>.9999*Object(o.o)(O)*t||(Object(o.f)(this.up,O,this.center),Object(o.f)(this.up,this.up,O),Object(o.q)(this.up,this.up),this.markViewDirty())}computeUpLocal(){Object(c.d)(O,this.eye,this.center),Math.abs(O[2])<=.9999&&(Object(o.d)(O,O,O[2]),Object(o.v)(this.up,-O[0],-O[1],1-O[2]),Object(o.q)(this.up,this.up),this.markViewDirty())}_compareAndSetView(t,e){Object(o.p)(t,e)||(Object(o.j)(e,t),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)}_recomputeFrustum(){this._frustumDirty&&(_.c.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Object(h.k)(this._viewMatrix,this._eye,this._center,this._up),Object(o.v)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(o.v)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(o.v)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const m=Object(u.c)(),v=Object(l.b)(),O=Object(a.e)(),y=Object(a.e)(),w=Object(n.e)();e.a=j},IlJQ:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var r,s=i("OIYi");!function(t){t.builder=function(t,e){t.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),t.vertex.code.add(s.a`
    float computeRenderPixelSizeAt( vec3 pWorld ){
      vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
      float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
      return viewDirectionDistance*perScreenPixelRatio;
    }

    vec3 screenSizeScaling(vec3 position, vec3 anchor){
      return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
    }
  `)},t.bindPassUniforms=function(t,e,i){t.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),t.setUniform1f("screenSize",e.screenSize)}}(r||(r={}))},TnN0:function(t,e,i){"use strict";i.d(e,"a",function(){return T});var r=i("bJda"),s=i("srIe"),n=i("TDcG"),a=i("SuVq"),o=(i("4GrV"),i("zm0L")),c=i("OKTS"),h=i("qRWG"),l=i("Cy1f"),d=i("5DEt"),u=i("9pTf"),b=i("15Hh"),f=i("kYAx"),p=i("gYg2"),_=i("2uVf"),g=i("r+FG"),j=i("HJJS"),m=i("M0lq"),v=i("DLk3"),O=i("8JEK"),y=i("0Kx6"),w=i("WiJz"),S=i("FxzD"),x=i("08/N"),D=i("dI/Q");class T{constructor(t){this.idHint=0,this.camera=new S.a,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(g.b)(),this._worldFrame=null,this._renderLocation=Object(l.e)(),this._renderLocationDirty=!0,this._location=new a.a({x:0,y:0,z:0}),this._elevationAlignedLocation=new a.a,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new o.a.EventEmitter,this._screenLocation={screenPointArray:Object(h.g)(),renderScreenPointArray:Object(h.e)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=t.view.spatialReference;for(const e in t)this[e]=t[e];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(t){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=t.slice(),this._updateEngineObject()}set available(t){t!==this._available&&(this._available=t,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(n.d)(()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()})}}set radius(t){t!==this._radius&&(this._radius=t,this._updateEngineObject())}get radius(){return this._radius}set worldSized(t){t!==this._worldSized&&(this._worldSized=t,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(t){E(t)&&(this._screenLocationDirty=!0),Object(b.c)(this._modelTransform,t),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(g.b)()),function(t,e,i){switch(t.viewingMode){case"local":return Object(b.i)(i),!0;case"global":{const r=Object(u.e)(t.renderCoordsHelper.spatialReference);Object(p.t)(e,0,I,0,r.radius),Object(p.c)(Object(c.d)(I[1]),Object(c.d)(I[0]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(t){this.view.renderCoordsHelper.fromRenderCoords(t,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(t){Object(x.a)(t,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(t){Object(x.a)(t,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const t=Object(s.k)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=t+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(t){t!==this._grabbing&&(this._grabbing=t,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(t){t!==this._hovering&&(this._hovering=t,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(t){t!==this._selected&&(this._selected=t,this._updateEngineObject(),this.events.emit("select-changed",{action:t?"select":"deselect"}))}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._updateEngineObject())}updateStateEnabled(t,e){e?this.state|=t:this.state&=~t}_setFocused(t){t!==this._focused&&(this._focused=t,this.events.emit("focus-changed",{action:!0===t?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this.ensureScreenLocation(),this._screenLocation}ensureScreenLocation(){if(!this._screenLocationDirty)return;let t;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,E(this._modelTransform)){const e=this._calculateModelTransformOffset(G);t=Object(d.e)(e,e,this.renderLocation)}else t=this.renderLocation;this.camera.projectToRenderScreen(t,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(t){this._applyObjectTransform=t,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(t,e){if(!this.available)return null;const i=Object(h.j)(t,R),n=this._getCollisionRadius(e),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(m.j)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":{const t=this.collisionType.paths,e=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(e,A),o=n*this.screenLocation.pixelSize,c=y.f.fromScreen(this.camera,i,L);if(Object(s.j)(c))return null;for(const i of t){if(0===i.length)continue;const t=Object(d.l)(I,i[0],r);for(let e=1;e<i.length;e++){const s=Object(d.l)(V,i[e],r),n=y.d.closestRayDistance2(y.d.fromPoints(t,s,P),c);if(null!=n&&n<o*o){const e=Object(d.e)(O.d.get(),t,s);Object(d.d)(e,e,.5);const i=Object(h.a)(O.d.get());return this.camera.projectToRenderScreen(e,i),i[2]+a}Object(d.j)(t,s)}}break}case"disc":{var o;const t=this.collisionType.direction,e=null!=(o=this.collisionType.offset)?o:l.b,r=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(r,A),h=n*this.screenLocation.pixelSize,u=y.f.fromScreen(this.camera,i,L);if(Object(s.j)(u))return null;const b=Object(j.d)(M,c),f=Object(d.w)(C,t,b),p=Object(d.l)(k,e,c);y.e.fromPositionAndNormal(p,f,F);const _=q;if(y.e.intersectRay(F,u,_)&&Object(d.k)(_,p)<h*h)return this.screenLocation.renderScreenPointArray[2]+a;break}case"ribbon":{const{paths:t,direction:e}=this.collisionType,r=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(r,A),c=n*this.camera.computeScreenPixelSizeAt(this.renderLocation),l=y.f.fromScreen(this.camera,i,L);if(Object(s.j)(l))return null;const u=Object(j.d)(M,o),b=Object(d.w)(C,e,u),f=this._calculateModelTransformPosition(k);y.e.fromPositionAndNormal(f,b,F);const p=q;if(!y.e.intersectRay(F,l,p))break;for(const i of t){if(0===i.length)continue;const t=Object(d.l)(I,i[0],o);for(let e=1;e<i.length;e++){const r=Object(d.l)(V,i[e],o),s=y.d.distance2(y.d.fromPoints(t,r,P),p);if(null!=s&&s<c*c){const e=Object(d.e)(O.d.get(),t,r);Object(d.d)(e,e,.5);const i=Object(h.a)(O.d.get());return this.camera.projectToRenderScreen(e,i),i[2]+a}Object(d.j)(t,r)}}break}default:Object(r.a)(this.collisionType)}return null}attach(t={manipulator3D:{}}){var e;if(!this.view._stage)return;const i=t.manipulator3D;if(Object(s.j)(i.engineLayerId)){const t=new D.a({isPickable:!1});this.view._stage.add(t),i.engineLayerId=t.id,this._engineLayer=t}else null!=(e=this.view._stage)&&e.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,Object(s.j)(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object(p.b)(this._location.spatialReference,this.view.spatialReference)||(this.location=new a.a({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(t={manipulator3D:{}}){const e=t.manipulator3D;e.engineLayerReferences--;const i=0===e.engineLayerReferences;i&&(e.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(t){Object(p.n)(this.location,U,t.spatialReference),Object(f.e)(t.extent,U)&&(this.location=this._location)}_evaluateElevationAlignment(t=this.location){if(Object(s.j)(this.elevationInfo))return!1;let e=null,i=0;const r=Object(s.r)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":e=Object(s.r)(Object(v.a)(this.view.elevationProvider,t,"ground"),0);break;case"relative-to-ground":i=Object(s.r)(Object(v.a)(this.view.elevationProvider,t,"ground"),0)+r;break;case"relative-to-scene":i=Object(s.r)(Object(v.a)(this.view.elevationProvider,t,"scene"),0)+r;break;case"absolute-height":i=r}return(i!==this._elevation.offset||e!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=e,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const t=this._getWorldToScreenObjectScale(),e=A;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*t;this._calculateObjectTransform(i,e)}else this._calculateObjectTransform(t,e);const{objectsByState:i}=this._ensureEngineResources(),r=(this.focused?2:1)|(this.selected?8:4),n=this._noDisplayCount>0;for(const{stateMask:s,objects:a}of i){if(n){for(const t of a)t.setVisible(!1);continue}const t=!(0!=(65520&s))||(this.state&s)==(65520&s);if(0!=(15&s)&&(r&s)!=(15&s)||!t)for(const e of a)e.setVisible(!1);else for(const i of a)i.setVisible(!0),i.transformation=e}Object(s.k)(this._engineLayer)&&this._engineLayer.commit()}_ensureEngineResources(){if(Object(s.j)(this._engineResources)){const t=Object(s.q)(this._engineLayer),e=[],i=new Set;this.renderObjects.forEach(({material:t})=>{i.has(t)||(e.push(t),i.add(t))});const r=(t,e)=>{const{geometry:i,material:r,transform:s}=e;Array.isArray(i)?i.forEach(e=>t.addGeometry(e,r,s)):t.addGeometry(i,r,s)},n=new Map;this._renderObjects.forEach(t=>{const e=new w.a({castShadow:!1});r(e,t);const i=t.stateMask||0,s=n.get(i)||[];s.push(e),n.set(i,s)});const a=[];n.forEach((t,e)=>a.push({stateMask:e,objects:t})),this._engineResources={objectsByState:a,layer:t,materials:e}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||Object(s.j)(this._engineResources))return;const{objectsByState:t,layer:e,materials:i}=this._engineResources;i.forEach(t=>{const e=Object(s.q)(this._materialIdReferences),i=e.get(t.id)||0;0===i&&this.view._stage.add(t),e.set(t.id,i+1)}),t.forEach(({objects:t})=>t.forEach(t=>{e.add(t),this.view._stage.add(t)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(t=!1){if(!this._engineResourcesAddedToStage||Object(s.j)(this._engineResources))return;const{objectsByState:e,layer:i,materials:r}=this._engineResources;e.forEach(({objects:t})=>{i.removeMany(t),this.view._stage.removeMany(t)}),r.forEach(t=>{const e=Object(s.q)(this._materialIdReferences),i=e.get(t.id);1===i?(this.view._stage.remove(t),e.delete(t.id)):e.set(t.id,i-1)}),t&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}_getCollisionRadius(t){return this._getFocusedSize(this.radius,!0)*("touch"===t?this.touchMultiplier:1)}_getFocusedSize(t,e){return t*(e?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(t){const e=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(e,z);return Object(d.v)(t,i[12],i[13],i[14])}_calculateModelTransformOffset(t){const e=this._calculateModelTransformPosition(t);return Object(d.i)(t,e,this.renderLocation)}_calculateObjectTransform(t,e){return Object(b.d)(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1),this._worldFrame&&Object(b.l)(e,e,this._worldFrame),Object(b.l)(e,e,this._modelTransform),e[12]+=this.renderLocation[0],e[13]+=this.renderLocation[1],e[14]+=this.renderLocation[2],e[15]=1,Object(s.k)(this._applyObjectTransform)&&this._applyObjectTransform(e),e}get test(){let t=!1;if(Object(s.k)(this._engineResources))for(const e in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[e];for(const e of i.objects)if(e.isVisible){t=!0;break}if(t)break}return{areAnyResourcesVisible:t}}}function E(t){return 0!==t[12]||0!==t[13]||0!==t[14]}const R=Object(h.g)(),P=y.d.create(),L=y.f.create(),M=Object(_.a)(),z=Object(g.b)(),A=Object(g.b)(),F=y.e.create(),I=Object(l.e)(),V=Object(l.e)(),q=Object(l.e)(),C=Object(l.e)(),k=Object(l.e)(),G=Object(l.e)(),U=new a.a({x:0,y:0,z:0,spatialReference:null})},"aS/U":function(t,e,i){"use strict";i.d(e,"a",function(){return b}),i.d(e,"b",function(){return u});var r=i("OIYi"),s=i("Tbkp"),n=i("aQrP"),a=i("Q3fD"),o=i("0nJL"),c=i("0Ect"),h=i("69UF"),l=i("xtdb"),d=i("IlJQ");function u(t){const e=new n.a;return e.include(s.a,{linearDepth:!1}),e.include(d.a.builder,{}),e.include(o.a,t),e.fragment.include(a.a),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.fragment.uniforms.add("color","vec4"),e.attributes.add("position","vec3"),e.varyings.add("vWorldPosition","vec3"),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),t.screenSizeEnabled&&e.attributes.add("offset","vec3"),t.shadingEnabled&&(e.vertex.uniforms.add("viewNormal","mat4"),e.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),e.attributes.add("normal","vec3"),e.varyings.add("vViewNormal","vec3")),e.vertex.code.add(r.a`
    void main(void) {
      vWorldPosition = ${t.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),t.shadingEnabled&&e.vertex.code.add(r.a`
      vec3 worldNormal = normal;
      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;
    `),e.vertex.code.add(r.a`
    ${t.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),t.multipassTerrainEnabled&&(e.fragment.include(c.a),e.include(l.b,t)),e.fragment.code.add(r.a`
    void main() {
      discardBySlice(vWorldPosition);
      ${t.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.fragment.code.add(t.shadingEnabled?r.a`
      vec3 viewNormalNorm = normalize(vViewNormal);
      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
      vec4 finalColor = mix(color, shadedColor, shadingFactor);
    `:r.a`
      vec4 finalColor = color;
    `),e.fragment.code.add(r.a`
      if (finalColor.a < ${r.a.float(h.c)}) {
        discard;
      }
      ${7===t.output?r.a`gl_FragColor = vec4(finalColor.a);`:""}

      ${0===t.output?r.a`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${t.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),e}var b=Object.freeze({__proto__:null,build:u})},"dK/y":function(t,e,i){"use strict";i.d(e,"a",function(){return g}),i.d(e,"b",function(){return j}),i.d(e,"c",function(){return f}),i.d(e,"d",function(){return p}),i.d(e,"e",function(){return _}),i.d(e,"f",function(){return m}),i.d(e,"g",function(){return v});var r=i("srIe"),s=i("5DEt"),n=i("15Hh"),a=i("D8Ta"),o=i("8JEK"),c=i("yvcr"),h=i("08/N"),l=i("uljd"),d=i("024p"),u=i("TnN0"),b=i("k2DL");function f(t,e=4){const i=Object(a.d)(t[0],t[1],t[2],t.length>3?t[3]:1);return new b.a({color:i,transparent:t[3]<1,writeDepth:!0,cullFace:2,renderOccluded:e})}function p(t,e=4){const i=Object(a.d)(t[0],t[1],t[2],4===t.length?t[3]:1);return new d.a({color:i,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:e})}function _(t,e,i){return new u.a({view:t,renderObjects:[{geometry:c.a.createSphereGeometry(1,32,32),material:f(Object(a.d)(e[0],e[1],e[2],null!=i?i:1))}]})}function g(t,e,i,r){const a=Object(s.i)(o.d.get(),t,i),c=j(a,Object(s.f)(o.d.get(),r,a),i,o.a.get());Object(n.a)(c,c);const h=Object(s.l)(o.d.get(),e,c);return Math.atan2(h[1],h[0])}function j(t,e,i,r){const n=Object(s.q)(o.d.get(),t),a=Object(s.q)(o.d.get(),e),c=Object(s.f)(o.d.get(),n,a);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=a[0],r[5]=a[1],r[6]=a[2],r[7]=0,r[8]=c[0],r[9]=c[1],r[10]=c[2],r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}function m(t,e){const i=t.getViewForGraphic(e);return Object(r.k)(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(e,t.spatialReference):null}function v(t,e,i){const s=m(t,i);Object(r.k)(s)?e.elevationAlignedLocation=s:function(t,e){if(Object(r.j)(e))return;const i=Object(l.a)(e);Object(r.j)(i)||(t.location=Object(h.b)(i))}(e,i.geometry)}},k2DL:function(t,e,i){"use strict";i.d(e,"a",function(){return P});var r=i("Cy1f"),s=i("5DEt"),n=i("VeZB"),a=i("QmHG"),o=i("/ADo"),c=i("EVMh"),h=i("1/dN"),l=i("fFEv"),d=i("NbNv"),u=i("WVfK"),b=i("pO5D"),f=i("D8Ta"),p=i("w6Td"),_=i("ypgp"),g=i("2jVe"),j=i("jjdI"),m=i("GJyJ"),v=i("jpeq"),O=i("0nJL"),y=i("dDjh"),w=i("xtdb"),S=i("IlJQ"),x=i("aS/U");class D extends _.a{initializeProgram(t){const e=D.shader.get(),i=this.configuration,r=e.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new j.a(t.rctx,r.generateSource("vertex"),r.generateSource("fragment"),E)}bindPass(t,e,i){const{screenSizeEnabled:r,shadingEnabled:s}=this.configuration,{color:n,shadingTint:a,shadingDirection:o}=e;v.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("color",n),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(w.a)(this.program,t,i)),s&&(this.program.setUniform4fv("shadedColor",this.blendColor(R,a,n)),this.program.setUniform3fv("shadingDirection",o),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix)),r&&S.a.bindPassUniforms(this.program,e,i)}blendColor(t,e,i){const r=1-e[3],s=e[3]+i[3]*r;return 0===s?(t[3]=s,t):(t[0]=(e[0]*e[3]+i[0]*i[3]*r)/s,t[1]=(e[1]*e[3]+i[1]*i[3]*r)/s,t[2]=(e[2]*e[3]+i[2]*i[3]*r)/s,t[3]=i[3],t)}bindDraw(t){v.a.bindView(this.program,t),v.a.bindCamPosition(this.program,t.origin,t.camera.viewInverseTransposeMatrix),O.a.bindUniformsWithOrigin(this.program,this.configuration,t)}setPipelineState(t){const e=this.configuration,i=3===t,r=2===t;return Object(m.d)({blending:0!==e.output&&7!==e.output||!e.transparent?null:i?y.f:Object(y.a)(t),culling:(t=>0!==t&&{face:1===t?1028:1029,mode:2305})(e.cullFace),depthTest:{func:r?513:e.shadingEnabled?515:513},depthWrite:i?e.writeDepth&&m.c:Object(y.c)(t),colorWrite:m.b,polygonOffset:i||r?null:y.d})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}D.shader=new p.a(x.a,()=>i.e(182).then(i.bind(null,"yqaz")));class T extends g.a{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}Object(b.a)([Object(g.b)({count:8})],T.prototype,"output",void 0),Object(b.a)([Object(g.b)({count:3})],T.prototype,"cullFace",void 0),Object(b.a)([Object(g.b)()],T.prototype,"slicePlaneEnabled",void 0),Object(b.a)([Object(g.b)()],T.prototype,"transparent",void 0),Object(b.a)([Object(g.b)()],T.prototype,"writeDepth",void 0),Object(b.a)([Object(g.b)()],T.prototype,"screenSizeEnabled",void 0),Object(b.a)([Object(g.b)()],T.prototype,"shadingEnabled",void 0),Object(b.a)([Object(g.b)({count:4})],T.prototype,"transparencyPassType",void 0),Object(b.a)([Object(g.b)()],T.prototype,"multipassTerrainEnabled",void 0),Object(b.a)([Object(g.b)()],T.prototype,"cullAboveGround",void 0);const E={position:0,normal:1,offset:2},R=Object(f.c)();class P extends d.a{constructor(t){super(t,M),this.supportsEdges=!0,this.techniqueConfig=new T,this._vertexAttributeLocations=E}getTechniqueConfig(t,e){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=e?e.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!e&&e.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!e||e.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(t,e,i,r,n,o,c){if(this.params.screenSizeEnabled){const i=t.vertexAttributes.get("offset"),h={applyToVertex:(t,e,n,a)=>{const o=Object(s.v)(A,i.data[3*a+0],i.data[3*a+1],i.data[3*a+2]),c=Object(s.v)(F,t,e,n);return Object(s.d)(o,o,this.params.screenSize*r.camera.computeRenderPixelSizeAt(o)),Object(s.e)(c,c,o),[c[0],c[1],c[2]]},applyToAabb:t=>{const e=Object(a.b)(t,A);return Object(a.p)(t,this.params.screenSize*r.camera.computeRenderPixelSizeAt(e))}};Object(l.e)(t,e,r,n,o,h,c)}else Object(l.e)(t,e,r,n,o,void 0,c)}getGLMaterial(t){return 0===t.output||7===t.output||4===t.output?new L(t):void 0}createBufferWriter(){return new z(this.params.screenSizeEnabled)}}class L extends h.a{constructor(t){super(t),this.updateParameters()}updateParameters(t){this.technique=this.techniqueRep.acquireAndReleaseExisting(D,this.material.getTechniqueConfig(this.output,t),this.technique)}beginSlot(t){if(4===this.output)return 3===t;let e=3;return this.technique.configuration.transparent&&(e=this.technique.configuration.writeDepth?5:8),t===e}ensureParameters(t){this.updateParameters(t)}bind(t,e){t.bindProgram(this.technique.program),this.technique.bindPass(t,this.material.getPassParameters(),e)}}const M={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:Object(s.q)(Object(r.e)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0,...d.b};class z{constructor(t){this.screenSizeEnabled=t;const e=Object(o.a)().vec3f("position").vec3f("normal");this.screenSizeEnabled&&e.vec3f("offset"),this.vertexBufferLayout=e}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get("position").length}write(t,e,i,r){if(Object(u.c)(e,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,i,r),this.screenSizeEnabled){if(!e.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");{const s=e.vertexAttributes.get("offset"),a=e.indices.get("offset");Object(c.a)(3===s.size);const o=i.getField("offset",n.u);if(!o)throw new Error("unable to acquire view for offset");Object(u.e)(a,s.data,t.invTranspTransformation,o,r)}}}}const A=Object(r.e)(),F=Object(r.e)()},klA5:function(t,e,i){"use strict";i.d(e,"a",function(){return d}),i("wSAH");var r=i("srIe"),s=i("Cy1f"),n=i("5DEt"),a=i("r+FG"),o=i("0Kx6"),c=i("tiP8"),h=i("qXiY");const l=1e-5;class d{constructor(t){this.options=new h.a,this.results=new h.c,this.transform=new h.d,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=l,this.verticalOffset=null,this._ray={origin:Object(s.e)(),direction:Object(s.e)()},this._rayEndPoint=Object(s.e)(),this._rayStartPointTransformed=Object(s.e)(),this._rayEndPointTransformed=Object(s.e)(),this.viewingMode=null==t?1:t}get ray(){return this._ray}get rayBeginPoint(){return this._ray.origin}get rayEndPoint(){return this._rayEndPoint}reset(t,e){this.resetWithRay(o.f.fromPoints(t,e,this._ray))}resetWithRay(t){t!==this._ray&&o.f.copy(t,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(n.e)(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}intersect(t,e,i,s,n,a){this.point=e,this.camera=i,this.filterPredicate=n,this.tolerance=null==s?l:s;const o=Object(h.f)(this.verticalOffset),c=a?t=>{a(t)&&this.intersectObject(t)}:t=>{this.intersectObject(t)};if(t&&t.length>0)for(const h of t){const t=h.getSpatialQueryAccelerator&&h.getSpatialQueryAccelerator();Object(r.k)(t)?(Object(r.k)(o)?t.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,c,o):t.forEachAlongRay(this._ray.origin,this._ray.direction,c),this.options.selectionMode&&this.options.hud&&t.forEachDegenerateObject(c)):h.getObjects().forAll(t=>c(t))}this.sortResults()}intersectObject(t){this._numObjectsTested++;const e=t.geometryRecords;if(!e)return;const i=t.id,s=t.transformation;let o;const l=Object(h.f)(this.verticalOffset);for(const d of e){const{geometry:e,material:u,instanceParameters:b}=d;if(Object(c.d)(b))continue;o=e.id,this.transform.setAndInvalidateLazyTransforms(s,d.getShaderTransformation()),Object(n.l)(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse),Object(n.l)(this._rayEndPointTransformed,this._rayEndPoint,this.transform.inverse);const f=this.transform.transform;Object(r.k)(l)&&(l.objectTransform=this.transform),u.intersect(e,b,this.transform.transform,this,this._rayStartPointTransformed,this._rayEndPointTransformed,(e,s,n,c,l,d)=>{if(e>=0){if(Object(r.k)(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEndPoint,e))return;const u=`Object3D ${i}`;if(l)return void((null==this.results.hud.dist||e<this.results.hud.dist)&&this.results.hud.set(t,u,e,s,a.a,c,d,o,n));const b=i=>i.set(t,u,e,s,f,c,null,o,n);if((null==this.results.min.drapedLayerOrder||c>=this.results.min.drapedLayerOrder)&&(null==this.results.min.dist||e<this.results.min.dist)&&b(this.results.min),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||c<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||e>this.results.max.dist)&&b(this.results.max),2===this.options.store){const t=new h.b(this._ray);b(t),this.results.all.push(t)}}},d.shaderTransformation)}}sortResults(){this.results.all.sort((t,e)=>t.dist!==e.dist?t.dist-e.dist:t.drapedLayerOrder!==e.drapedLayerOrder?(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE):(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE))}}d.DEFAULT_TOLERANCE=l},qXiY:function(t,e,i){"use strict";i.d(e,"a",function(){return j}),i.d(e,"b",function(){return y}),i.d(e,"c",function(){return O}),i.d(e,"d",function(){return m}),i.d(e,"e",function(){return T}),i.d(e,"f",function(){return D});var r=i("srIe"),s=i("Cy1f"),n=i("5DEt"),a=i("15Hh"),o=i("2uVf"),c=i("r+FG"),h=i("sTkM"),l=i("D8Ta"),d=i("HJJS"),u=i("dXfX"),b=i("BPBZ"),f=i("R/jG"),p=i("+JUG"),_=(i("DZ/s"),i("0Kx6")),g=i("WiJz");class j{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2}}class m{constructor(){this._transform=Object(c.b)(),this._transformInverse=new v({value:this._transform},a.a,c.b),this._transformInverseTranspose=new v(this._transformInverse,a.b,c.b),this._transformTranspose=new v({value:this._transform},a.b,c.b),this._transformInverseRotation=new v({value:this._transform},d.b,o.a)}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){Object(a.c)(this._transform,t)}multiplyTransform(t){Object(a.l)(this._transform,this._transform,t)}set(t){Object(a.c)(this._transform,t),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,e){this.setTransformMatrix(t),this.multiplyTransform(e),this.invalidateLazyTransforms()}}class v{constructor(t,e,i){this.original=t,this.update=e,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class O{constructor(){this.min=new y,this.max=new y,this.hud=new y,this.ground=new y}init(t){this.min.init(t),this.max.init(t),this.hud.init(t),this.ground.init(t),this.all=[]}}class y{constructor(t){this.normal=Object(s.e)(),this.transformation=Object(c.b)(),this._ray=_.f.create(),this.init(t)}get ray(){return this._ray}get hasIntersectionPoint(){return null!=this.dist}get distanceInRenderSpace(){if(null!=this.dist)return Object(n.d)(E,this.ray.direction,this.dist),Object(n.o)(E)}getIntersectionPoint(t){return!!this.hasIntersectionPoint&&(Object(n.d)(E,this.ray.direction,this.dist),Object(n.e)(t,this.ray.origin,E),!0)}getTransformedNormal(t){return Object(n.j)(R,this.normal),R[3]=0,Object(u.m)(R,R,this.transformation),Object(n.j)(t,R),Object(n.q)(t,t),t}init(t){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",t?_.f.copy(t,this._ray):this._ray=_.f.create()}set(t,e,i,r,o,c,h,l,d,u){t instanceof g.a&&(t={type:"stage",obj:t}),this.dist=i,Object(n.j)(this.normal,r),Object(a.c)(this.transformation,o),this.target=t,this.name=e,this.drapedLayerOrder=c,this.center=h?Object(s.d)(h):null,this.geometryId=l,this.triangleNr=d,this.drapedLayerGraphicOrder=u}copyFrom(t){_.f.copy(t._ray,this._ray),this.dist=t.dist,this.target=t.target,this.name=t.name,this.drapedLayerOrder=t.drapedLayerOrder,this.center=t.center?Object(s.d)(t.center):null,this.geometryId=t.geometryId,this.triangleNr=t.triangleNr,this.intersector=t.intersector,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,Object(n.j)(this.normal,t.normal),Object(a.c)(this.transformation,t.transformation)}toOwner(t){if(!this.target)return null;switch(this.target.type){case"stage":return w(this.target.obj.metadata,t);case"external":switch(this.intersector){case"PointRenderer":return function(t,e){const i=t.metadata.layerUid;return null!=i?e.map.findLayerByUid(i):null}(this.target,t);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return w(this.target.metadata,t);case"TerrainRenderer":return t.map&&t.map.ground}}return null}toGraphic(t){if(!this.target)return null;switch(this.target.type){case"stage":return S(this.target.obj.metadata,t);case"external":switch(this.intersector){case"PointRenderer":return function(t){return t.metadata.createGraphic()}(this.target);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return S(this.target.metadata,t)}}return null}}function w(t,e){return Object(r.j)(t)||null==t.layerUid?null:Object(r.k)(e.graphicsView)&&t.layerUid===e.graphicsView.graphics3d.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function S(t,e){if(Object(r.j)(t))return null;const i=w(t,e);if(Object(r.j)(i))return null;if(i===e.graphics)return Object(r.k)(e.graphicsView)?Object(r.q)(e.graphicsView.getGraphicFromGraphicUid(t.graphicUid)):null;const s=e.allLayerViews.find(t=>t.layer===i);return s?(a=t,!(n=s)||n.suspended?null:"getGraphicFromIntersectorMetadata"in n&&a?n.getGraphicFromIntersectorMetadata(a):"getGraphicFromGraphicUid"in n&&null!=a.graphicUid?n.getGraphicFromGraphicUid(a.graphicUid):null):null;var n,a}const x=new class{constructor(t=0){this.offset=t,this.sphere=Object(p.b)(),this.tmpVertex=Object(s.e)()}applyToVertex(t,e,i){const r=this.objectTransform.transform;let s=r[0]*t+r[4]*e+r[8]*i+r[12],n=r[1]*t+r[5]*e+r[9]*i+r[13],a=r[2]*t+r[6]*e+r[10]*i+r[14];const o=this.offset/Math.sqrt(s*s+n*n+a*a);s+=s*o,n+=n*o,a+=a*o;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*s+c[4]*n+c[8]*a+c[12],this.tmpVertex[1]=c[1]*s+c[5]*n+c[9]*a+c[13],this.tmpVertex[2]=c[2]*s+c[6]*n+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,e){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r}applyToAabb(t){const e=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*e,t[1]+=t[1]*e,t[2]+=t[2]*e;const i=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*i,t[4]+=t[4]*i,t[5]+=t[5]*i,t}applyToBoundingSphere(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/e;return this.sphere[0]=t[0]+t[0]*i,this.sphere[1]=t[1]+t[1]*i,this.sphere[2]=t[2]+t[2]*i,this.sphere[3]=t[3]+t[3]*this.offset/e,this.sphere}};function D(t){return Object(r.k)(t)?(x.offset=t,x):null}new class{constructor(t=0){this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=Object(s.e)(),this.mbs=Object(l.c)(),this.obb={center:Object(s.e)(),halfSize:Object(f.b)(),quaternion:null}}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,e,i){const r=t,s=e,n=i+this.componentLocalOriginLength,a=this.offset/Math.sqrt(r*r+s*s+n*n);return this.tmpVertex[0]=t+r*a,this.tmpVertex[1]=e+s*a,this.tmpVertex[2]=i+n*a,this.tmpVertex}applyToAabb(t){const e=t[0],i=t[1],r=t[2]+this.componentLocalOriginLength,s=t[3],n=t[4],a=t[5]+this.componentLocalOriginLength,o=this.offset/Math.sqrt(e*e+i*i+r*r);t[0]+=e*o,t[1]+=i*o,t[2]+=r*o;const c=this.offset/Math.sqrt(s*s+n*n+a*a);return t[3]+=s*c,t[4]+=n*c,t[5]+=a*c,t}applyToMbs(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/e;return this.mbs[0]=t[0]+t[0]*i,this.mbs[1]=t[1]+t[1]*i,this.mbs[2]=t[2]+t[2]*i,this.mbs[3]=t[3]+t[3]*this.offset/e,this.mbs}applyToObb(t){const e=t.center,i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);this.obb.center[0]=e[0]+e[0]*i,this.obb.center[1]=e[1]+e[1]*i,this.obb.center[2]=e[2]+e[2]*i,Object(n.t)(this.obb.halfSize,t.halfSize,t.quaternion),Object(n.e)(this.obb.halfSize,this.obb.halfSize,t.center);const r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,Object(n.i)(this.obb.halfSize,this.obb.halfSize,t.center),Object(b.a)(P,t.quaternion),Object(n.t)(this.obb.halfSize,this.obb.halfSize,P),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=t.quaternion,this.obb}},new class{constructor(t=0){this.offset=t,this.tmpVertex=Object(s.e)()}applyToVertex(t,e,i){const r=t+this.localOrigin[0],s=e+this.localOrigin[1],n=i+this.localOrigin[2],a=this.offset/Math.sqrt(r*r+s*s+n*n);return this.tmpVertex[0]=t+r*a,this.tmpVertex[1]=e+s*a,this.tmpVertex[2]=i+n*a,this.tmpVertex}applyToAabb(t){const e=t[0]+this.localOrigin[0],i=t[1]+this.localOrigin[1],r=t[2]+this.localOrigin[2],s=t[3]+this.localOrigin[0],n=t[4]+this.localOrigin[1],a=t[5]+this.localOrigin[2],o=this.offset/Math.sqrt(e*e+i*i+r*r);t[0]+=e*o,t[1]+=i*o,t[2]+=r*o;const c=this.offset/Math.sqrt(s*s+n*n+a*a);return t[3]+=s*c,t[4]+=n*c,t[5]+=a*c,t}};const T="terrain",E=(Object(s.e)(),Object(s.e)()),R=Object(l.c)(),P=Object(h.a)()},tKWm:function(t,e,i){"use strict";i.d(e,"a",function(){return v}),i.d(e,"b",function(){return O}),i.d(e,"c",function(){return _}),i.d(e,"d",function(){return j}),i.d(e,"e",function(){return g}),i.d(e,"f",function(){return p}),i.d(e,"g",function(){return m});var r=i("srIe"),s=i("OKTS"),n=i("qRWG"),a=i("Cy1f"),o=i("5DEt"),c=i("gYg2"),h=i("9AiD"),l=i("8JEK"),d=i("0Kx6"),u=i("qXiY"),b=i("klA5"),f=i("wg3g");function p(t,e){const i=Object(a.e)(),s=Object(a.e)();let o=!1;return a=>{if("start"===a.action){const s=Object(n.j)(a.screenStart,Object(n.c)(l.c.get())),c=d.f.fromScreen(t.state.camera,s,S);Object(r.k)(c)&&(o=d.e.intersectRay(e,c,i))}if(!o)return null;const c=Object(n.j)(a.screenEnd,Object(n.c)(l.c.get())),h=d.f.fromScreen(t.state.camera,c,S);return Object(r.j)(h)?null:d.e.intersectRay(e,h,s)?{...a,renderStart:i,renderEnd:s,plane:e,ray:h}:null}}function _(t,e,i,s=null,a=null){return function(t,e,i,s=null,a=null){let o=null;return h=>{if("start"===h.action&&(o=t.sceneIntersectionHelper.intersectElevationFromScreen(Object(n.g)(h.screenStart.x,h.screenStart.y),e,i,a),Object(r.k)(o)&&Object(r.k)(s)&&!Object(c.n)(o,o,s)))return null;if(Object(r.j)(o))return null;const l=t.sceneIntersectionHelper.intersectElevationFromScreen(Object(n.g)(h.screenEnd.x,h.screenEnd.y),e,i,a);return Object(r.k)(l)?Object(r.k)(s)&&!Object(c.n)(l,l,s)?null:{...h,mapStart:o,mapEnd:l}:null}}(t,i,Object(h.f)(e,t,i),s,a)}function g(t,e,i,r=null,s=null){return _(t,i,Object(h.d)(e),r,s)}function j(t,e,i,s){const n=e.toMap(t.screenStart,{include:[i]});return Object(r.k)(n)?g(e,i,n,s):null}function m(t,e,i){let n=null;const c=new f.a;return c.next(p(t,function(t,e){const i=y,r=w,s=d.e.create();t.renderCoordsHelper.worldUpAtPosition(e,i);const n=Object(o.f)(s,i,Object(o.i)(r,e,t.state.camera.eye));return Object(o.f)(n,n,i),d.e.fromPositionAndNormal(e,n,s)}(t,e))).next(function(t,e){const i=Object(a.e)(),r=Object(o.o)(e);t.renderCoordsHelper.worldUpAtPosition(e,i);const n=Object(a.e)(),c=Object(a.e)(),h=n=>(Object(o.i)(n,n,e),d.h.projectPoint(i,n,n),"global"===t.viewingMode&&Object(o.o)(n)*Object(s.o)(Object(o.g)(i,n))<.001-r&&Object(o.i)(n,Object(o.d)(n,i,.001),e),Object(o.e)(n,n,e),n);return t=>(t.renderStart=h(Object(o.j)(n,t.renderStart)),t.renderEnd=h(Object(o.j)(c,t.renderEnd)),t)}(t,e)).next(function(t,e){const i=t.renderCoordsHelper;return t=>{const s=i.fromRenderCoords(t.renderStart,e),n=i.fromRenderCoords(t.renderEnd,e);return Object(r.k)(s)&&Object(r.k)(n)?{...t,mapStart:s,mapEnd:n}:null}}(t,i)).next(t=>{t.mapEnd.x=t.mapStart.x,t.mapEnd.y=t.mapStart.y,n=t}),t=>(n=null,c.execute(t),n)}function v(t){let e=null;return i=>{switch(i.action){case"start":e=t.disableDisplay();break;case"end":case"cancel":Object(r.k)(e)&&(e.remove(),e=null)}return i}}function O(t,e=null){const i=new b.a(t.state.mode);i.options.selectionMode=!0,i.options.store=0;const s=Object(n.g)(),o={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},c=Object(a.e)(),h=Object(r.r)(e,t.spatialReference),l=e=>{t.map.ground&&t.map.ground.opacity<1?o.exclude.add(u.e):o.exclude.delete(u.e),t.sceneIntersectionHelper.intersectIntersectorScreen(Object(n.j)(e,s),i,o);const r=i.results.min;let a;if(r.getIntersectionPoint(c))a="TerrainRenderer"===r.intersector?0:1;else{if(!i.results.ground.getIntersectionPoint(c))return null;a=0}return{location:t.renderCoordsHelper.fromRenderCoords(c,h),surfaceType:a}};let d;return t=>{if("start"===t.action){const e=l(t.screenStart);d=Object(r.k)(e)?e.location:null}if(Object(r.j)(d))return null;const e=l(t.screenEnd);return Object(r.k)(e)&&Object(r.k)(e.location)?{...t,mapStart:d,mapEnd:e.location,surfaceType:e.surfaceType}:null}}const y=Object(a.e)(),w=Object(a.e)(),S=d.f.create()}}]);