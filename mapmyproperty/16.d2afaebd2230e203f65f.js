(function(){(this||window).webpackJsonp.registerAbsMids({"arcgis-js-api/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":"+wMf","arcgis-js-api/views/3d/layers/graphics/elevationAlignmentUtils":"/9Lg","arcgis-js-api/views/3d/webgl-engine/lib/glUtil3D":"/Bau","arcgis-js-api/renderers/support/clickToleranceUtils":"/E+R","arcgis-js-api/views/3d/layers/graphics/GraphicState":"/NuL","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":"0W55","arcgis-js-api/core/libs/earcut/earcut":"1E+e","esri/core/libs/earcut/earcut":"1E+e","arcgis-js-api/views/3d/interactive/editingTools/manipulatorUtils":"1eTA","arcgis-js-api/views/3d/webgl-engine/lib/doublePrecisionUtils":"1f+t","arcgis-js-api/views/3d/webgl-engine/lighting/SphericalHarmonics":"2Mej","arcgis-js-api/views/3d/interactive/visualElements/VisualElementResources":"2W+Z","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":"2o+p","esri/symbols/support/defaultsJSON":"35hF","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":"3PFg","arcgis-js-api/views/3d/webgl-engine/lib/BoundingInfo":"3RHn","arcgis-js-api/geometry/support/triangulationUtils":"3Zlx","arcgis-js-api/core/libs/gl-matrix-2/factories/vec4f32":"3gjc","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":"3kdR","arcgis-js-api/views/3d/interactive/editingTools/manipulations/Manipulation":"48/q","arcgis-js-api/views/3d/webgl-engine/lib/GeometryUtil":"4ziW","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":"58az","arcgis-js-api/views/3d/interactive/manipulatorUtils":"5T2R","arcgis-js-api/views/3d/webgl-engine/lib/Object3DStateSet":"62Ht","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYAxisManipulation":"6hC7","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":"6t3m","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":"6vp1","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYGraphicManipulation":"73uV","arcgis-js-api/views/3d/webgl-engine/core/shaderModules/interfaces":"7Aei","arcgis-js-api/core/libs/gl-matrix-2/factories/mat4f32":"7Yqx","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":"7zqm","arcgis-js-api/views/3d/webgl-engine/lib/intersectorUtils":"9DjX","arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialTexture":"9FJH","arcgis-js-api/views/3d/webgl-engine/lib/IntervalUtilities":"AASg","arcgis-js-api/views/3d/webgl-engine/lib/GeometryData":"AgDx","arcgis-js-api/views/interactive/Manipulator3D":"AvU8","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveManipulation":"BhkK","arcgis-js-api/views/3d/layers/graphics/graphicUtils":"BwdQ","arcgis-js-api/views/3d/webgl-engine/materials/WaterGLMaterial":"CP88","arcgis-js-api/core/libs/gl-matrix-2/mat2":"CqfC","arcgis-js-api/views/3d/webgl-engine/lib/GeometryRecord":"Cvn+","arcgis-js-api/views/3d/webgl-engine/shaders/ColorMaterial.glsl":"DFuO","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":"DKwL","arcgis-js-api/views/3d/support/debugFlags":"Dk48","esri/views/3d/support/debugFlags":"Dk48","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":"E/g4","arcgis-js-api/views/3d/webgl-engine/lib/DefaultTextureUnits":"EiD/","arcgis-js-api/views/3d/webgl-engine/shaders/ColorMaterialTechnique":"EiS2","arcgis-js-api/views/3d/webgl-engine/lib/DDSUtil":"EyQ4","arcgis-js-api/views/3d/webgl-engine/lib/renderStats":"FLCf","arcgis-js-api/views/3d/webgl-engine/lib/Material":"FNtW","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":"FQ4r","arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialRep":"FU3N","arcgis-js-api/views/3d/webgl-engine/materials/lineStippleUtils":"FbvD","arcgis-js-api/views/3d/interactive/editingTools/manipulations/config":"Fe95","arcgis-js-api/views/3d/interactive/editingTools/visualElementUtils":"G+tB","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/CommonUniformStore":"GDWR","arcgis-js-api/views/3d/layers/graphics/constants":"HbaO","arcgis-js-api/views/3d/webgl-engine/materials/internal/bufferWriterUtils":"ILj8","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":"IwVr","arcgis-js-api/views/3d/layers/graphics/sdfPrimitives":"J2BX","arcgis-js-api/views/3d/webgl-engine/lib/LongVectorMath":"KPBO","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/TextureOnly.glsl":"KQg4","arcgis-js-api/views/3d/webgl-engine/lib/AutoDisposable":"KRuQ","esri/core/colorUtils":"KtQ6","arcgis-js-api/core/colorUtils":"KtQ6","arcgis-js-api/views/3d/interactive/editingTools/ManipulatorState":"Kvb2","arcgis-js-api/core/libs/gl-matrix-2/mat2f64":"KwnQ","arcgis-js-api/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":"LZD4","arcgis-js-api/views/3d/interactive/visualElements/LaserlineVisualElement":"MCHn","arcgis-js-api/views/interactive/GraphicManipulator":"N78w","arcgis-js-api/views/support/drapedUtils":"NbdF","arcgis-js-api/views/3d/webgl-engine/shaders/ShadedColorMaterial.glsl":"NiJV","arcgis-js-api/views/3d/interactive/editingTools/lineGraphicVisualElementUtils":"PLh7","arcgis-js-api/views/3d/interactive/visualElements/LineVisualElement":"PXiz","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":"PaEL","arcgis-js-api/views/3d/webgl-engine/materials/renderers/utils":"PwS/","arcgis-js-api/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":"Px2u","arcgis-js-api/views/3d/webgl-engine/lighting/SceneLighting":"QDiq","arcgis-js-api/views/3d/interactive/visualElements/OutlineVisualElement":"R4nD","arcgis-js-api/views/3d/webgl-engine/materials/RibbonLineMaterial":"RC9r","arcgis-js-api/views/3d/webgl-engine/lib/RenderContext":"Raj5","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":"RdU/","arcgis-js-api/views/3d/webgl-engine/lib/Camera":"RsYQ","arcgis-js-api/views/3d/webgl-engine/shaders/RibbonLineTechnique":"SNs2","arcgis-js-api/views/3d/interactive/editingTools/graphicReshape3D/reshapeUtils":"TCLX","arcgis-js-api/views/3d/interactive/editingTools/snapping/SnapToScene":"TIRl","arcgis-js-api/views/3d/webgl-engine/shaders/LaserlinePath.glsl":"UGy0","arcgis-js-api/views/3d/interactive/editingTools/graphicTransform3D/GraphicScaleRotateTransform":"UdQa","arcgis-js-api/views/3d/webgl-engine/shaders/HUDMaterial.glsl":"VQEQ","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":"W/V4","arcgis-js-api/views/3d/webgl-engine/lib/IdGen":"W0kZ","arcgis-js-api/views/interactive/ManipulatorCollection":"X0Jx","arcgis-js-api/views/3d/interactive/editingTools/settings":"X5J5","arcgis-js-api/views/interactive/InteractiveToolBase":"X7Ps","arcgis-js-api/views/3d/webgl-engine/lib/TextureTechnique":"XcBT","arcgis-js-api/core/tsSupport/makeTemplateObjectHelper":"XsoR","arcgis-js-api/views/3d/webgl-engine/lib/ResizableFloat32Array":"YseA","arcgis-js-api/views/3d/webgl-engine/lib/Object3D":"ZJC8","arcgis-js-api/views/3d/webgl-engine/lib/Layer":"ZO6V","arcgis-js-api/views/3d/webgl-engine/materials/renderers/MergedRenderer":"ZeO9","arcgis-js-api/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":"aExC","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":"aRjO","arcgis-js-api/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":"ama6","arcgis-js-api/views/3d/interactive/visualElements/DrapedVisualElementResources":"as1Q","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":"cj3m","arcgis-js-api/views/3d/webgl-engine/lib/RenderGeometry":"cjy9","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":"cmSR","arcgis-js-api/views/3d/interactive/editingTools/graphicReshape3D/ReshapeOperation":"d0uo","arcgis-js-api/symbols/support/defaults":"dXKx","esri/symbols/support/defaults":"dXKx","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":"dl/g","arcgis-js-api/views/3d/interactive/editingTools/manipulations/moveUtils":"dtql","arcgis-js-api/views/3d/webgl-engine/lib/localOrigin":"eHCP","arcgis-js-api/views/3d/layers/graphics/ElevationContext":"fOZq","arcgis-js-api/views/3d/webgl-engine/shaders/ShadedColorMaterialTechnique":"fQ2U","arcgis-js-api/views/3d/webgl-engine/shaders/LaserlineTechnique":"fUJJ","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":"fese","arcgis-js-api/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":"ff/U","arcgis-js-api/views/3d/support/LaserlinePathData":"gG9S","arcgis-js-api/views/3d/layers/graphics/lineUtils":"hADE","arcgis-js-api/views/3d/support/LaserLineRenderer":"hX2R","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/Laserline.glsl":"hk44","arcgis-js-api/views/3d/webgl-engine/lib/GridLocalOriginFactory":"hkmr","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":"hs8d","arcgis-js-api/views/3d/webgl-engine/materials/internal/waterMaterialUtils":"hsRy","arcgis-js-api/views/3d/interactive/visualElements/PointVisualElement":"i10q","arcgis-js-api/views/3d/terrain/OverlayRenderer":"ij3I","esri/core/libs/gl-matrix-2/vec4f32":"j2SP","arcgis-js-api/core/libs/gl-matrix-2/vec4f32":"j2SP","arcgis-js-api/views/3d/webgl-engine/shaders/WaterSurface.glsl":"jl7D","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":"juLw","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":"lBa0","arcgis-js-api/views/3d/webgl-engine/lib/StencilUtils":"lfQW","arcgis-js-api/views/3d/webgl-engine/lib/Intersector":"m4lJ","arcgis-js-api/views/3d/webgl-engine/lib/Octree":"mYMs","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/Camera.glsl":"naZ0","arcgis-js-api/views/3d/webgl-engine/shaders/RibbonLine.glsl":"ne9J","arcgis-js-api/views/3d/webgl-engine/materials/ColorMaterial":"o5p5","esri/core/libs/gl-matrix-2/mat4f32":"oZZu","arcgis-js-api/core/libs/gl-matrix-2/mat4f32":"oZZu","arcgis-js-api/views/3d/interactive/editingTools/graphicTransform3D/GraphicTransform3DTool":"pESw","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":"pLfv","arcgis-js-api/views/3d/webgl-engine/materials/renderers/Instance":"pbva","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":"piY7","arcgis-js-api/views/3d/webgl-engine/shaders/HUDMaterialTechnique":"pqGg","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveZManipulation":"pvGl","arcgis-js-api/views/3d/webgl-engine/shaders/Laserlines.glsl":"qSzK","arcgis-js-api/views/3d/webgl-engine/lighting/Lightsources":"qUb7","arcgis-js-api/views/3d/interactive/editingTools":"qkUi","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":"quQL","arcgis-js-api/core/libs/gl-matrix-2/types/mat4":"qvwY","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":"rCq5","arcgis-js-api/views/3d/webgl-engine/shaders/LaserlinePathTechnique":"raiv","arcgis-js-api/views/3d/webgl-engine/lib/ComponentUtils":"rjU6","arcgis-js-api/views/3d/interactive/editingTools/graphicMove3D/GraphicMove3DTool":"runW","arcgis-js-api/views/3d/webgl-engine/materials/internal/MaterialUtil":"s6rJ","arcgis-js-api/views/3d/webgl-engine/lib/GLMaterial":"tUyH","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":"uUnu","arcgis-js-api/views/3d/webgl-engine/materials/ShadedColorMaterial":"uZGf","arcgis-js-api/views/3d/interactive/editingTools/manipulatorDragUtils":"uiHv","arcgis-js-api/views/3d/interactive/editingTools/pointGraphicVisualElementUtils":"uinn","arcgis-js-api/views/3d/webgl-engine/materials/WaterTechnique":"v22c","arcgis-js-api/views/3d/support/ElevationProvider":"vA3N","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":"vGsU","arcgis-js-api/core/libs/gl-matrix-2/math/mat2":"vJh7","arcgis-js-api/views/3d/support/imageUtils":"weRx","arcgis-js-api/views/3d/interactive/Manipulator3D":"woUR","arcgis-js-api/views/3d/interactive/editingTools/graphicReshape3D/GraphicReshape3DTool":"x82K","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":"xDGw","arcgis-js-api/views/3d/webgl-engine/materials/HUDMaterial":"xFEL","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":"y68M","arcgis-js-api/views/3d/layers/graphics/featureExpressionInfoUtils":"yVFQ","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":"ybGv","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYDiscManipulation":"yjgM","arcgis-js-api/views/3d/webgl-engine/lib/Texture":"yqrJ","arcgis-js-api/views/3d/webgl-engine/lib/Geometry":"ys4y","arcgis-js-api/core/libs/gl-matrix-2/factories/mat2f64":"z4cv","arcgis-js-api/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":"zZCp","arcgis-js-api/views/3d/webgl-engine/lib/rendererUtils":"znI2"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"+wMf":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("wPX3")],void 0===(i=(function(e,t,n,r){function i(e){return Math.abs(e*e*e)}function o(e,t,n,r){void 0===r&&(r=p);var o=n.parameters,a=n.paddingPixelsOverride;return r.scale=Math.min(o.divisor/(t-o.offset),1),r.factor=i(e),r.minPixelSize=o.minPixelSize,r.paddingPixels=a,r}function a(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function s(e,t){return Math.max(n.lerp(e*t.scale,e,t.factor),a(e,t))}function l(e,t,n){var r=o(e,t,n);return r.minPixelSize=0,r.paddingPixels=0,s(1,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.getSettings=function(e){return new c(e,t.defaultDescription)},t.getLabelSettings=function(e){var n=t.defaultDescription.curvatureDependent;return new c(e,{curvatureDependent:{min:{curvature:n.min.curvature,tiltAngle:n.min.tiltAngle,scaleFallOffFactor:u.curvatureDependent.min.scaleFallOffFactor},max:{curvature:n.max.curvature,tiltAngle:n.max.tiltAngle,scaleFallOffFactor:u.curvatureDependent.max.scaleFallOffFactor}},scaleStart:t.defaultDescription.scaleStart,scaleFallOffRange:t.defaultDescription.scaleFallOffRange,minPixelSize:u.minPixelSize})},t.perspectiveFactor=i,t.scaleFactor=o,t.applyScaleFactor=s,t.applyScaleFactorVec2=function(e,t,r){void 0===r&&(r=[0,0]);var i=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return r[0]=n.lerp(e[0]*i,e[0],t.factor),r[1]=n.lerp(e[1]*i,e[1],t.factor),r},t.precomputeScale=l,t.precomputeScaleFactor=function(e,t,n,r){return r.scale=l(e,t,n),r.factor=0,r.minPixelSize=n.parameters.minPixelSize,r.paddingPixels=n.paddingPixelsOverride,r},t.applyPrecomputedScaleFactorVec2=function(e,t,n){void 0===n&&(n=[0,0]);var r=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return n[0]=e[0]*r,n[1]=e[1]*r,n},t.scale=function(e,t,n,r){return s(e,o(t,n,r))};var c=function(){function e(e,t,n,r){void 0===n&&(n={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}),this.viewingMode=e,this.description=t,this.parameters=n,this._paddingPixelsOverride=r,"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}return Object.defineProperty(e.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0}),e.prototype.update=function(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this.calculateParameters(e,this.parameters),0))},e.prototype.overridePadding=function(t){return t!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.parameters,t):this},e.prototype.calculateParameters=function(e,t){var n=this.description,r=n.scaleStart,i=n.scaleFallOffRange,o=n.minPixelSize,a=e.fovY,s=e.distance,l=this.calculateCurvatureDependentParameters(e),c=this.coverageCompensation(e,l),u=l.tiltAngle,p=l.scaleFallOffFactor,d=Math.sin(u)*s,h=.5*Math.PI-u-a*(.5-r*c),f=d/Math.cos(h),v=(f-p*(d/Math.cos(h+a*i*c)))/(1-p);return t.camera.fovY=e.fovY,t.camera.distance=e.distance,t.offset=v,t.divisor=f-v,t.minPixelSize=o,t},e.prototype.calculateCurvatureDependentParametersLocal=function(e,t){return void 0===t&&(t=d),t.tiltAngle=this.description.curvatureDependent.min.tiltAngle,t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,t},e.prototype.calculateCurvatureDependentParametersGlobal=function(e,t){void 0===t&&(t=d);var i=this.description.curvatureDependent,o=1+e.distance/r.earthRadius,a=Math.sqrt(o*o-1),s=[i.min.curvature,i.max.curvature],l=s[0],c=n.clamp((a-l)/(s[1]-l),0,1),u=[i.min,i.max],p=u[0],h=u[1];return t.tiltAngle=n.lerp(p.tiltAngle,h.tiltAngle,c),t.scaleFallOffFactor=n.lerp(p.scaleFallOffFactor,h.scaleFallOffFactor,c),t},e.prototype.surfaceCoverageCompensationLocal=function(e,t){return(e.fovY-t.tiltAngle)/e.fovY},e.prototype.surfaceCoverageCompensationGlobal=function(e,t){var n=r.earthRadius*r.earthRadius,i=t.tiltAngle+.5*Math.PI,o=e.fovY,a=e.distance,s=a*a+n-2*Math.cos(i)*a*r.earthRadius,l=Math.sqrt(s),c=Math.sqrt(s-n);return(Math.acos(c/l)-Math.asin(r.earthRadius/(l/Math.sin(i)))+.5*o)/o},e}();t.defaultDescription={curvatureDependent:{min:{curvature:n.deg2rad(10),tiltAngle:n.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:n.deg2rad(70),tiltAngle:n.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var u={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};t.copyParameters=function(e,t){return t.camera.distance=e.camera.distance,t.camera.fovY=e.camera.fovY,t.divisor=e.divisor,t.offset=e.offset,t.minPixelSize=e.minPixelSize,t};var p={scale:0,factor:0,minPixelSize:0,paddingPixels:0},d={tiltAngle:0,scaleFallOffFactor:0}}).apply(null,r))||(e.exports=i)},"/9Lg":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("FXVB"),n("1m5D"),n("Rdxj"),n("BwdQ"),n("vA3N"),n("mmEe")],void 0===(i=(function(e,t,n,r,i,o,a,s,l){function c(e,t,r,i,o){var a=e.z||0,l=r.featureExpressionInfoContext;switch(r.mode){case"on-the-ground":var c=s.getElevationAtPoint(t,e,"ground")||0;return o&&(o.verticalDistanceToGround=0,o.sampledElevation=c),c;case"relative-to-ground":c=s.getElevationAtPoint(t,e,"ground")||0;var u=r.calculateOffsetRenderUnits(i);return null==l&&(u+=a),o&&(o.verticalDistanceToGround=u,o.sampledElevation=c),u+c;case"relative-to-scene":return c=s.getElevationAtPoint(t,e,"scene")||0,u=r.calculateOffsetRenderUnits(i),null==l&&(u+=a),o&&(o.verticalDistanceToGround=u,o.sampledElevation=c),u+c;case"absolute-height":if(c=r.calculateOffsetRenderUnits(i),null==l&&(c+=a),o){var p=s.getElevationAtPoint(t,e,"ground")||0;o.verticalDistanceToGround=c-p,o.sampledElevation=p}return c;default:return n.neverReached(r.mode),0}}var u;Object.defineProperty(t,"__esModule",{value:!0}),t.applyPerVertexElevationAlignment=function(e,t,n,r,i,o,a,s,c,u,d){var h,f,v=p[d.mode],g=0;if(l.bufferToBuffer(e,t,n,r,c.spatialReference,i,s)&&(v.requiresAlignment(d)?(g=v.applyElevationAlignmentBuffer(r,i,o,a,s,c,u,d),h=o,f=a):(h=r,f=i),l.bufferToBuffer(h,c.spatialReference,f,o,u.spatialReference,a,s)))return g},t.evaluateElevationAlignmentAtPoint=c,t.elevationModeChangeUpdateType=function(e,t,n){return null==t||null==n?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?u.UPDATE:e.onTheGroundChanged},t.needsElevationUpdates2D=function(e){return"relative-to-ground"===e||"relative-to-scene"===e},t.needsElevationUpdates3D=function(e){return"absolute-height"!==e},t.applyElevationAlignmentForHUD=function(e,t,n,i,o){var s=c(t,n,o,i,h);a.updateVertexAttributeAuxpos1w(e,h.verticalDistanceToGround);var u=h.sampledElevation,p=r.mat4.copy(d,e.objectTransformation);return f[0]=t.x,f[1]=t.y,f[2]=s,l.computeLinearTransformation(t.spatialReference,f,p,i.spatialReference)?e.objectTransformation=p:console.warn("Could not locate symbol object properly, it might be misplaced"),u},function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(u=t.SymbolUpdateType||(t.SymbolUpdateType={}));var p={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,a,s){var l=s.calculateOffsetRenderUnits(a),c=s.featureExpressionInfoContext;t*=3,r*=3;for(var u=0;u<i;++u){var p=e[t+1],d=e[t+2];n[r+0]=e[t+0],n[r+1]=p,n[r+2]=null==c?d+l:l,t+=3,r+=3}return 0},requiresAlignment:function(e){return 0!==e.meterUnitOffset||null!=e.featureExpressionInfoContext}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o){var a=0,s=o.spatialReference;t*=3,r*=3;for(var l=0;l<i;++l){var c=e[t+0],u=e[t+1],p=o.getElevation(c,u,e[t+2],s,"ground")||0;a+=p,n[r+0]=c,n[r+1]=u,n[r+2]=p,t+=3,r+=3}return a/i},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,a,s){var l=0,c=s.calculateOffsetRenderUnits(a),u=s.featureExpressionInfoContext,p=o.spatialReference;t*=3,r*=3;for(var d=0;d<i;++d){var h=e[t+0],f=e[t+1],v=e[t+2],g=o.getElevation(h,f,v,p,"ground")||0;l+=g,n[r+0]=h,n[r+1]=f,n[r+2]=null==u?v+g+c:g+c,t+=3,r+=3}return l/i},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,a,s){var l=0,c=s.calculateOffsetRenderUnits(a),u=s.featureExpressionInfoContext,p=o.spatialReference;t*=3,r*=3;for(var d=0;d<i;++d){var h=e[t+0],f=e[t+1],v=e[t+2],g=o.getElevation(h,f,v,p,"scene")||0;l+=g,n[r+0]=h,n[r+1]=f,n[r+2]=null==u?v+g+c:g+c,t+=3,r+=3}return l/i},requiresAlignment:function(){return!0}}},d=i.mat4f64.create(),h={verticalDistanceToGround:0,sampledElevation:0},f=o.vec3f64.create()}).apply(null,r))||(e.exports=i)},"/Bau":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("ff/U"),n("zZCp"),n("QFi0"),n("Zp3t"),n("z2+Q")],void 0===(i=(function(e,t,n,r,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuadVAO=function(e,t,o){void 0===t&&(t=r.Pos2),void 0===o&&(o=n.Default3D);var s=null;switch(t){case r.Pos2Tex:s=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;case r.Pos2:default:s=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new a(e,o,{geometry:t},{geometry:i.createVertex(e,35044,s)})},t.createEmptyTexture=function(e,t){return void 0===t&&(t=4),new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,n){void 0===n&&(n=4);for(var r=new Uint8Array(n*n*4),i=0;i<r.length;i+=4)r[i+0]=255*t[0],r[i+1]=255*t[1],r[i+2]=255*t[2],r[i+3]=255*t[3];return new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:n,height:n},r)},t.createEmptyDepthTexture=function(e){return new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}}).apply(null,r))||(e.exports=i)},"/E+R":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,n=0,r=0;r<e.length;r++){var i=e[r].size;"number"==typeof i&&(t+=i,n++)}return t/n}(e.stops):t}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateTolerance=function(e){var t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;var o="visualVariables"in t?function(e,t){if(!t)return e;var n=t.filter((function(e){return"size"===e.type})).map((function(t){var n=t.minSize;return(r(t.maxSize,e)+r(n,e))/2})),i=0,o=n.length;if(0===o)return e;for(var a=0;a<o;a++)i+=n[a];var s=Math.floor(i/o);return Math.max(s,e)}(i,t.visualVariables):i;if("simple"===t.type)return n(o,t.symbol);if("unique-value"===t.type){var a=o;return t.uniqueValueInfos.forEach((function(e){a=n(a,e.symbol)})),a}if("class-breaks"===t.type){var s=o;return t.classBreakInfos.forEach((function(e){s=n(s,e.symbol)})),s}return o}}).apply(null,r))||(e.exports=i)},"/NuL":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("BcWh"),n("Vx27")],void 0===(i=(function(e,t,n,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){var n=e.call(this,t)||this;return n.tracking=!1,n.displaying=!1,n.isDraped=!1,n}return r(t,e),n([o.property({constructOnly:!0})],t.prototype,"graphic",void 0),n([o.property()],t.prototype,"tracking",void 0),n([o.property()],t.prototype,"displaying",void 0),n([o.property()],t.prototype,"isDraped",void 0),n([o.subclass("esri.views.3d.layers.graphics.GraphicState")],t)}(o.declared(i.EventedAccessor));t.GraphicState=a}).apply(null,r))||(e.exports=i)},"0W55":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSpacePass=function(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(r.glsl(i||(i=n(["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = position * 0.5 + vec2(0.5);\n    } \n  "],["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = position * 0.5 + vec2(0.5);\n    } \n  "]))))}}).apply(null,r))||(e.exports=i)},"1E+e":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e,t,n,r,i){var o;if(i===h(e,t,n,r)>0)for(var a=t;a<n;a+=r)o=s(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=s(a,e[a],e[a+1],o);return o&&m(o,o.next)&&(l(o),o=o.next),o}function r(e,t){if(void 0===t&&(t=e),!e)return e;var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==p(r.prev,r,r.next))r=r.next;else{if(l(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,s,c,u,p){if(void 0===p&&(p=0),e){!p&&u&&(e=function e(t,n,r,i){for(var o=void 0;o!==t;o=o.next){if(null===(o=o||t).z&&(o.z=g(o.x,o.y,n,r,i)),o.prev.next!==o||o.next.prev!==o)return o.prev.next=o,o.next.prev=o,e(t,n,r,i);o.prevZ=o.prev,o.nextZ=o.next}return t.prevZ.nextZ=null,t.prevZ=null,function(e){for(var t,n=1;;){var r=e,i=void 0;e=null,t=null;for(var o=0;r;){o++,i=r;for(var a=0;a<n&&i;a++)i=i.nextZ;for(var s=n;a>0||s>0&&i;){var l=void 0;0===a?(l=i,i=i.nextZ,s--):0!==s&&i?r.z<=i.z?(l=r,r=r.nextZ,a--):(l=i,i=i.nextZ,s--):(l=r,r=r.nextZ,a--),t?t.nextZ=l:e=l,l.prevZ=t,t=l}r=i}if(t.nextZ=null,n*=2,o<2)return e}}(t)}(e,s,c,u));for(var d=e;e.prev!==e.next;){var h=e.prev,f=e.next;if(u?a(e,s,c,u):o(e))t.push(h.index/n),t.push(e.index/n),t.push(f.index/n),l(e),e=f.next,d=f.next;else if((e=f)===d){p?1===p?i(e=b(e,t,n),t,n,s,c,u,2):2===p&&_(e,t,n,s,c,u):i(r(e),t,n,s,c,u,1);break}}}}function o(e){var t=e.prev,n=e,r=e.next;if(p(t,n,r)>=0)return!1;for(var i=e.next.next,o=i,a=0;i!==e.prev&&(0===a||i!==o);){if(a++,f(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&p(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,n,r){var i=e.prev,o=e,a=e.next;if(p(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,c=g(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,t,n,r),u=g(s,l,t,n,r),d=e.prevZ,h=e.nextZ;d&&d.z>=c&&h&&h.z<=u;){if(d!==e.prev&&d!==e.next&&f(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&p(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,h!==e.prev&&h!==e.next&&f(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&p(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(;d&&d.z>=c;){if(d!==e.prev&&d!==e.next&&f(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&p(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;h&&h.z<=u;){if(h!==e.prev&&h!==e.next&&f(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&p(h.prev,h,h.next)>=0)return!1;h=h.nextZ}return!0}function s(e,t,n,r){var i=new S(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function l(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function c(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function u(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n.prev;var l,c=n,u=n.x,p=n.y,d=1/0;for(r=n.next;r!==c;)i>=r.x&&r.x>=u&&i!==r.x&&f(o<p?i:a,o,u,p,o<p?a:i,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(i-r.x))<d||l===d&&r.x>n.x)&&v(r,e)&&(n=r,d=l),r=r.next;return n}(e,t)){var n=w(t,e);r(n,n.next)}}function p(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function d(e,t,n,r){return!!(m(e,t)&&m(n,r)||m(e,r)&&m(n,t))||p(e,t,n)>0!=p(e,t,r)>0&&p(n,r,e)>0!=p(n,r,t)>0}function h(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}function f(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function v(e,t){return p(e.prev,e,e.next)<0?p(e,t,e.next)>=0&&p(e,e.prev,t)>=0:p(e,t,e.prev)<0||p(e,e.next,t)<0}function g(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function m(e,t){return e.x===t.x&&e.y===t.y}function y(e,t){return e.x-t.x}function b(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!m(i,o)&&d(i,r,r.next,o)&&v(i,o)&&v(o,i)&&(t.push(i.index/n),t.push(r.index/n),t.push(o.index/n),l(r),l(r.next),r=e=o),r=r.next}while(r!==e);return r}function _(e,t,n,o,a,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.index!==c.index&&x(l,c)){var u=w(l,c);return l=r(l,l.next),u=r(u,u.next),i(l,t,n,o,a,s),void i(u,t,n,o,a,s)}c=c.next}l=l.next}while(l!==e)}function x(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var n=e;do{if(n.index!==e.index&&n.next.index!==e.index&&n.index!==t.index&&n.next.index!==t.index&&d(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&v(e,t)&&v(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)}function w(e,t){var n=new S(e.index,e.x,e.y),r=new S(t.index,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}Object.defineProperty(t,"__esModule",{value:!0}),t.earcut=function(e,t,o){var a,s,l,p,d,h=t&&t.length,f=h?t[0]*o:e.length,v=n(e,0,f,o,!0),g=new Array;if(!v||v.next===v.prev)return g;if(h&&(v=function(e,t,i,o){for(var a=new Array,s=0,l=t.length;s<l;s++){var p=n(e,t[s]*o,s<l-1?t[s+1]*o:e.length,o,!1);p===p.next&&(p.steiner=!0),a.push(c(p))}a.sort(y);for(var d=0,h=a;d<h.length;d++)u(h[d],i),i=r(i,i.next);return i}(e,t,v,o)),e.length>80*o){a=l=e[0],s=p=e[1];for(var m=o;m<f;m+=o){var b=e[m],_=e[m+1];a=Math.min(a,b),s=Math.min(s,_),l=Math.max(l,b),p=Math.max(p,_)}d=0!==(d=Math.max(l-a,p-s))?1/d:0}return i(v,g,o,a,s,d),g},t.deviation=function(e,t,n,r){var i=t&&t.length,o=Math.abs(h(e,0,i?t[0]*n:e.length,n));if(i)for(var a=0,s=t.length;a<s;a++)o-=Math.abs(h(e,t[a]*n,a<s-1?t[a+1]*n:e.length,n));var l=0;for(a=0;a<r.length;a+=3){var c=r[a]*n,u=r[a+1]*n,p=r[a+2]*n;l+=Math.abs((e[c]-e[p])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[p+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)};var S=function(e,t,n){this.index=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}).apply(null,r))||(e.exports=i)},"1eTA":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("2Atf"),n("LxLY"),n("DtIM")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.canMoveZ=function(e,t){return void 0===t&&(t=i.getGraphicEffectiveElevationInfo(e)),"on-the-ground"!==t.mode&&!(r.isNone(e.geometry)||!e.geometry.hasZ)},t.disableDisplayOnGrab=function(e,t){var n=null,i=e.events.on("grab-changed",(function(i){r.isSome(n)&&(n.remove(),n=null),"start"===i.action?(n=e.disableDisplay(),t&&t(i)):t&&t(i)}));return{remove:function(){r.isSome(n)&&n.remove(),i.remove()}}}}).apply(null,r))||(e.exports=i)},"1f+t":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e,t,n){for(var r=0;r<n;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDouble=function(e,t){i[0]=e,i[1]=e-i[0],t[0]=i[0],t[1]=i[1]},t.encodeDoubleArray=n,t.decodeDoubleArray=function(e,t,n){for(var r=0;r<n;++r)t[r]=e[2*r]+e[2*r+1]},t.encodeDoubleArraySplit=function(e,t,o,a){for(var s=0;s<a;++s)r[0]=e[s],n(r,i,1),t[s]=i[0],o[s]=i[1]};var r=new Float64Array(1),i=new Float32Array(2)}).apply(null,r))||(e.exports=i)},"2Mej":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("0LE5"),n("Rdxj"),n("KPBO"),n("qUb7")],void 0===(i=(function(e,t,n,r,i,o,a){function s(e){return(e+1)*(e+1)}function l(e){return n.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function c(e,t,n){var r=e[0],i=e[1],o=e[2],a=n||[];return a.length=s(t),t>=0&&(a[0]=.28209479177),t>=1&&(a[1]=.4886025119*r,a[2]=.4886025119*o,a[3]=.4886025119*i),t>=2&&(a[4]=1.09254843059*r*i,a[5]=1.09254843059*i*o,a[6]=.31539156525*(3*o*o-1),a[7]=1.09254843059*r*o,a[8]=.54627421529*(r*r-i*i)),a}function u(e,t){var n=s(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=n;for(var i=0;i<n;i++)r.r[i]=r.g[i]=r.b[i]=0;return r}function p(e,t){for(var n=l(t.r.length),i=0,a=e;i<a.length;i++){var s=a[i];r.vec3.negate(y,s.direction),c(y,n,g),o.elementwiseProduct(g,b),o.scalarProduct(g,s.intensity[0],m),o.add(t.r,m),o.scalarProduct(g,s.intensity[1],m),o.add(t.g,m),o.scalarProduct(g,s.intensity[2],m),o.add(t.b,m)}return t}function d(e,t){c(y,0,g);for(var n=0,r=e;n<r.length;n++){var i=r[n];t.r[0]+=g[0]*b[0]*i.intensity[0]*4*Math.PI,t.g[0]+=g[0]*b[0]*i.intensity[1]*4*Math.PI,t.b[0]+=g[0]*b[0]*i.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.numberOfCoefficients=s,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=l,t.computeCoefficients=c,t.initSHCoefficients=u,t.projectFillLights=p,t.projectAmbientLights=d,t.combineLights=function(e,t,n){u(t,n.sphericalHarmonics.sh),r.vec3.set(n.main.intensity,0,0,0);var i=!1,s=h,l=f,c=v;s.length=0,l.length=0,c.length=0;for(var g=0,m=e;g<m.length;g++)(_=m[g])instanceof a.MainLight&&!i?(r.vec3.copy(n.main.direction,_.direction),n.main.intensity[0]=_.intensity[0],n.main.intensity[1]=_.intensity[1],n.main.intensity[2]=_.intensity[2],n.main.castShadows=_.castShadows,i=!0):_ instanceof a.MainLight||_ instanceof a.FillLight?s.push(_):_ instanceof a.AmbientLight?l.push(_):_ instanceof a.SphericalHarmonicsLight&&c.push(_);p(s,n.sphericalHarmonics.sh),d(l,n.sphericalHarmonics.sh);for(var y=0,b=c;y<b.length;y++){var _=b[y];o.add(n.sphericalHarmonics.sh.r,_.sh.r),o.add(n.sphericalHarmonics.sh.g,_.sh.g),o.add(n.sphericalHarmonics.sh.b,_.sh.b)}};var h=[],f=[],v=[],g=[0],m=[0],y=i.vec3f64.create(),b=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}).apply(null,r))||(e.exports=i)},"2W+Z":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("8MXS"),n("ys4y"),n("ZO6V"),n("ZJC8"),n("yqrJ")],void 0===(i=(function(e,t,n,r,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e){this.resourceFactory=e,this._resources=null,this._hidden=!1,this._attached=!1}return e.prototype.destroy=function(){this._destroyResources()},Object.defineProperty(e.prototype,"object",{get:function(){return n.isSome(this._resources)?this._resources.object:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resources",{get:function(){return n.isSome(this._resources)?this._resources.external:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this._hidden},set:function(e){e!==this._hidden&&(this._hidden=e,this._syncHidden())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())},enumerable:!0,configurable:!0}),e.prototype.recreate=function(){this.attached&&this._createResources()},e.prototype.recreateGeometry=function(){if(this.resourceFactory.recreateGeometry){if(!n.isNone(this._resources)){var e=this._resources.object,t=this.resourceFactory.view._stage;this._resources.external.forEach((function(e){e instanceof i&&t.remove(2,e.id)})),e.removeAllGeometries();for(var r=0,o=this.resourceFactory.recreateGeometry(this._resources.external,e,this._resources.layer);r<o.length;r++)t.add(2,o[r])}}else this.recreate()},e.prototype._createOrDestroyResources=function(){this._attached?this._resources||this._createResources():this._destroyResources()},e.prototype._createResources=function(){var e=this;this._destroyResources();var t=this.resourceFactory.view._stage;if(t){var n=new o("element",{isPickable:!1});t.add(0,n),t.addToViewContent([n.id]);var i=new a({idHint:"element",castShadow:!1}),s=this.resourceFactory.createResources(i,n);s.forEach((function(n){t.add(e._contentTypeFromResource(n),n)})),t.add(1,i),n.addObject(i),this._hidden&&i.hide();var l=this.resourceFactory.cameraChanged?r.init(this.resourceFactory.view.state,"camera",(function(t){return e.resourceFactory.cameraChanged(t)})):null;this._resources={layer:n,object:i,external:s,cameraHandle:l}}},e.prototype._contentTypeFromResource=function(e){return e instanceof i?2:e instanceof s?4:3},e.prototype._destroyResources=function(){var e=this;if(!n.isNone(this._resources)){var t=this.resourceFactory.view._stage;t.remove(1,this._resources.object.id),t.remove(0,this._resources.layer.id),this._resources.external.forEach((function(n){t.remove(e._contentTypeFromResource(n),n.id),"dispose"in n&&n.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}},e.prototype._syncHidden=function(){n.isNone(this._resources)||(this._hidden?this._resources.object.hide():this._resources.object.unhide())},e}();t.VisualElementResources=l}).apply(null,r))||(e.exports=i)},"2o+p":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei"),n("s6rJ")],void 0===(i=(function(e,t,n,r,i){function o(e){e.vertex.code.add(r.glsl(a||(a=n(["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize = 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                      // proportionally scaled padding\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "],["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize = 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                      // proportionally scaled padding\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "])))),e.vertex.code.add(r.glsl(s||(s=n(["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "],["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "])))),e.vertex.code.add(r.glsl(l||(l=n(["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n    }\n  "],["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n    }\n  "])))),e.vertex.code.add(r.glsl(c||(c=n(["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "],["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "])))),e.vertex.code.add(r.glsl(u||(u=n(["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "])))),e.vertex.code.add(r.glsl(p||(p=n(["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "],["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "])))),e.vertex.code.add(r.glsl(d||(d=n(["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "]))))}var a,s,l,c,u,p,d;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSizePerspective=o,function(e){e.bindUniforms=function(e,t){t.screenSizePerspective&&(i.bindScreenSizePerspective(t.screenSizePerspective,e,"screenSizePerspective"),i.bindScreenSizePerspective(t.screenSizePerspectiveAlignment||t.screenSizePerspective,e))}}(o=t.ScreenSizePerspective||(t.ScreenSizePerspective={}))}).apply(null,r))||(e.exports=i)},"35hF":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultColor=[252,146,31,255],t.defaultOutlineColor=[153,153,153,255],t.defaultPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",size:6,color:t.defaultColor,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},t.defaultPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",width:.75,color:t.defaultColor},t.defaultPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},t.defaultTextSymbolJSON={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},t.errorPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},t.errorPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},t.errorPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}}).apply(null,r))||(e.exports=i)},"3PFg":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){function i(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add("instanceFeatureAttribute","vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(r.glsl(o||(o=n(["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "],["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "])))),e.vertex.code.add(r.glsl(s||(s=n(["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "],["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "])),t.vvInstancingEnabled?r.glsl(a||(a=n(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"],["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):e.vertex.code.add(r.glsl(l||(l=n(["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "],["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "])))),t.vvColor?(e.vertex.defines.addInt("VV_COLOR_N",8),e.vertex.code.add(r.glsl(u||(u=n(["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < VV_COLOR_N; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ","\n    "],["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < VV_COLOR_N; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ","\n    "])),t.vvInstancingEnabled?r.glsl(c||(c=n(["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"],["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"]))):""))):e.vertex.code.add(r.glsl(p||(p=n(["\n      vec4 vvColor() { return vec4(1.0); }\n    "],["\n      vec4 vvColor() { return vec4(1.0); }\n    "]))))}var o,a,s,l,c,u,p;Object.defineProperty(t,"__esModule",{value:!0}),t.VisualVariables=i,function(e){function t(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}e.bindUniforms=t,e.bindUniformsWithOpacity=function(e,n){t(e,n),n.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",n.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",n.vvOpacityOpacities))},e.bindUniformsForSymbols=function(e,n){t(e,n),n.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",n.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",n.vvSymbolRotationMatrix))}}(i=t.VisualVariables||(t.VisualVariables={}))}).apply(null,r))||(e.exports=i)},"3RHn":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("KBgh"),n("0LE5"),n("Rdxj"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o){var a=function(){function e(t,n,a,s){this.primitiveIndices=t,this._numIndexPerPrimitive=n,this.indices=a,this._position=s,this.center=i.vec3f64.create(),o.assert(t.length>=1),o.assert(a.length%this._numIndexPerPrimitive==0),o.assert(a.length>=t.length*this._numIndexPerPrimitive),o.assert(3===this._position.size||4===this._position.size);var l=this._position,c=l.data,u=l.offsetIdx,p=l.strideIdx,d=0,h=t.length,f=u+p*a[this._numIndexPerPrimitive*t[d]];for(e.tmpIndices.clear(),e.tmpIndices.push(f),this.bbMin=i.vec3f64.fromValues(c[f],c[f+1],c[f+2]),this.bbMax=i.vec3f64.clone(this.bbMin);d<h;++d)for(var v=this._numIndexPerPrimitive*t[d],g=0;g<this._numIndexPerPrimitive;++g){e.tmpIndices.push(f=u+p*a[v+g]);var m=c[f];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=c[f+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=c[f+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}r.vec3.lerp(this.center,this.bbMin,this.bbMax,.5),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var y=this.bsRadius*this.bsRadius;for(d=0;d<e.tmpIndices.length;++d){var b=c[f=e.tmpIndices.data[d]]-this.center[0],_=c[f+1]-this.center[1],x=c[f+2]-this.center[2],w=b*b+_*_+x*x;if(!(w<=y)){var S=Math.sqrt(w),P=.5*(S-this.bsRadius);this.bsRadius=this.bsRadius+P,y=this.bsRadius*this.bsRadius;var O=P/S;this.center[0]+=b*O,this.center[1]+=_*O,this.center[2]+=x*O}}e.tmpIndices.clear()}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this._children)return this._children;if(r.vec3.squaredDistance(this.bbMin,this.bbMax)>1){for(var t=r.vec3.lerp(i.vec3f64.create(),this.bbMin,this.bbMax,.5),n=this.primitiveIndices.length,o=new Uint8Array(n),a=new Array(8),s=0;s<8;++s)a[s]=0;var l=this._position,c=l.data,u=l.offsetIdx,p=l.strideIdx;for(s=0;s<n;++s){for(var d=0,h=this._numIndexPerPrimitive*this.primitiveIndices[s],f=u+p*this.indices[h],v=c[f],g=c[f+1],m=c[f+2],y=1;y<this._numIndexPerPrimitive;++y){var b=c[f=u+p*this.indices[h+y]],_=c[f+1],x=c[f+2];b<v&&(v=b),_<g&&(g=_),x<m&&(m=x)}v<t[0]&&(d|=1),g<t[1]&&(d|=2),m<t[2]&&(d|=4),o[s]=d,++a[d]}var w=0;for(s=0;s<8;++s)a[s]>0&&++w;if(w<2)return;var S=new Array(8);for(s=0;s<8;++s)S[s]=a[s]>0?new Uint32Array(a[s]):void 0;for(s=0;s<8;++s)a[s]=0;for(s=0;s<n;++s)S[d=o[s]][a[d]++]=this.primitiveIndices[s];for(this._children=new Array(8),s=0;s<8;++s)void 0!==S[s]&&(this._children[s]=new e(S[s],this._numIndexPerPrimitive,this.indices,this._position))}return this._children},e}();return function(e){e.tmpIndices=new n({deallocator:null})}(a||(a={})),a}).apply(null,r))||(e.exports=i)},"3Zlx":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("1E+e"),n("ZPQp"),n("jmRc")],void 0===(i=(function(e,t,n,r,i){function o(e,t,n){for(var i=e.length,o=new Array(i),s=new Array(i),l=new Array(i),c=0,u=0,p=0,d=0,h=0;h<i;++h)d+=e[h].length;for(var f=new Float64Array(3*d),v=0,g=i-1;g>=0;g--){var m=e[g],y=1===n&&!r.isClockwise(m,!1,!1);if(y&&1!==i)o[c++]=m;else{var b=m.length;for(h=0;h<c;++h)b+=o[h].length;var _={index:v,pathLengths:new Array(c+1),count:b,holeIndices:new Array(c)};_.pathLengths[0]=m.length,m.length>0&&(l[p++]={index:v,count:m.length}),v=y?a(m,m.length-1,-1,f,v,m.length,t):a(m,0,1,f,v,m.length,t);for(var x=0;x<c;++x){var w=o[x];_.holeIndices[x]=v,_.pathLengths[x+1]=w.length,w.length>0&&(l[p++]={index:v,count:w.length}),v=a(w,0,1,f,v,w.length,t)}c=0,_.count>0&&(s[u++]=_)}}for(x=0;x<c;++x)(w=o[x]).length>0&&(l[p++]={index:v,count:w.length}),v=a(w,0,1,f,v,w.length,t);return u<i&&(s.length=u),p<i&&(l.length=p),{position:f,polygons:s,outlines:l}}function a(e,t,n,r,i,o,a){i*=3;for(var s=0;s<o;++s){var l=e[t];r[i++]=l[0],r[i++]=l[1],r[i++]=a?l[2]:0,t+=n}return i/3}Object.defineProperty(t,"__esModule",{value:!0}),t.triangulate=function(e){for(var t=o(e.rings,e.hasZ,1),r=[],a=0,s=0,l=function(e){var i=e.index,o=new Float64Array(t.position.buffer,3*i*t.position.BYTES_PER_ELEMENT,3*e.count),l=e.holeIndices.map((function(e){return e-i})),c=new Uint32Array(n.earcut(o,l,3));r.push({position:o,faces:c}),a+=o.length,s+=c.length},c=0,u=t.polygons;c<u.length;c++)l(u[c]);var p=function(e,t,n){if(1===e.length)return e[0];for(var r=new Float64Array(t),i=new Uint32Array(n),o=0,a=0,s=0,l=0,c=e;l<c.length;l++){for(var u=c[l],p=0;p<u.position.length;p++)r[o++]=u.position[p];for(p=0;p<u.faces.length;p++)i[a++]=u.faces[p]+s;s=o/3}return{position:r,faces:i}}(r,a,s),d=i.default(p.position.buffer,6,{originalIndices:p.faces});return p.position=new Float64Array(d.buffer),p.faces=d.indices,p},t.pathsToTriangulationInfo=o}).apply(null,r))||(e.exports=i)},"3gjc":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(){return new Float32Array(4)}function r(e,t,n,r){var i=new Float32Array(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function i(){return n()}function o(){return r(1,1,1,1)}function a(){return r(1,0,0,0)}function s(){return r(0,1,0,0)}function l(){return r(0,0,1,0)}function c(){return r(0,0,0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.clone=function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=r,t.createView=function(e,t){return new Float32Array(e,t,4)},t.zeros=i,t.ones=o,t.unitX=a,t.unitY=s,t.unitZ=l,t.unitW=c,t.ZEROS=i(),t.ONES=o(),t.UNIT_X=a(),t.UNIT_Y=s(),t.UNIT_Z=l(),t.UNIT_W=c()}).apply(null,r))||(e.exports=i)},"3kdR":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("FXVB"),n("oZZu"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,o){function a(e,t){e.vertex.code.add(o.glsl(t.linearDepth?s||(s=n(["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye = view * vec4(pos, 1.0);\n      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "],["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye = view * vec4(pos, 1.0);\n      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "])):l||(l=n(["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "],["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "]))))}Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=a,function(e){function t(e,t,n){r.mat4.translate(c,n,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",c)}e.bindUniformsCustomOrigin=t,e.bindUniforms=function(e,n){t(e,n.origin,n.view)}}(a=t.Transform||(t.Transform={}));var s,l,c=i.mat4f32.create()}).apply(null,r))||(e.exports=i)},"48/q":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("woUR")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._available=!0}return Object.defineProperty(e.prototype,"location",{set:function(e){this.forEachManipulator3D((function(t){return t.location=e}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationAlignedLocation",{set:function(e){this.forEachManipulator3D((function(t){return t.elevationAlignedLocation=e}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{set:function(e){this.forEachManipulator3D((function(t){return t.elevationInfo=e}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"available",{get:function(){return this._available},set:function(e){this._available=e,this.forEachManipulator3D((function(t){return t.available=e}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grabbing",{get:function(){return this.someManipulator((function(e){return e.grabbing}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragging",{get:function(){return this.someManipulator((function(e){return e.dragging}))},enumerable:!0,configurable:!0}),e.prototype.hasManipulator=function(e){return this.someManipulator((function(t){return t===e}))},e.prototype.someManipulator=function(e){var t=!1;return this.forEachManipulator((function(n){!t&&e(n)&&(t=!0)})),t},e.prototype.forEachManipulator3D=function(e){this.forEachManipulator((function(t,r){t instanceof n.Manipulator3D&&e(t,r)}))},e}();t.Manipulation=r}).apply(null,r))||(e.exports=i)},"4ziW":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("0LE5"),n("vlC2"),n("Rdxj"),n("aWgr"),n("83/a"),n("AgDx"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o,a,s,l){var c,u,p,d,h=a.Vec3Compact;!function(e){for(var t=.5,n=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],i=[0,0,1,0,1,1,0,1],o=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],a=new Array(36),c=0;c<6;c++)for(var u=0;u<6;u++)a[6*c+u]=c;var p=new Array(36);for(c=0;c<6;c++)p[6*c+0]=0,p[6*c+1]=1,p[6*c+2]=2,p[6*c+3]=2,p[6*c+4]=3,p[6*c+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(24),c=0;c<8;c++)t[3*c]=n[c][0]*e[0],t[3*c+1]=n[c][1]*e[1],t[3*c+2]=n[c][2]*e[2];var u={};u[l.VertexAttrConstants.POSITION]=new Uint32Array(o),u[l.VertexAttrConstants.NORMAL]=new Uint32Array(a),u[l.VertexAttrConstants.UV0]=new Uint32Array(p);var d={};return d[l.VertexAttrConstants.POSITION]={size:3,data:t},d[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(r)},d[l.VertexAttrConstants.UV0]={size:2,data:new Float32Array(i)},new s.GeometryData(d,u)}}(c||(c={})),function(e){var t=.5,n=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],i=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],o=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(18),a=0;a<6;a++)t[3*a]=n[a][0]*e[0],t[3*a+1]=n[a][1]*e[1],t[3*a+2]=n[a][2]*e[2];var c={};c[l.VertexAttrConstants.POSITION]=new Uint32Array(i),c[l.VertexAttrConstants.NORMAL]=new Uint32Array(o);var u={};return u[l.VertexAttrConstants.POSITION]={size:3,data:t},u[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(r)},new s.GeometryData(u,c)}}(u||(u={})),function(e){var t=.5,i=r.vec3f32.fromValues(-t,0,-t),o=r.vec3f32.fromValues(t,0,-t),a=r.vec3f32.fromValues(0,0,t),c=r.vec3f32.fromValues(0,.5,0),u=r.vec3f32.create(),p=r.vec3f32.create(),d=r.vec3f32.create(),h=r.vec3f32.create(),f=r.vec3f32.create();n.vec3.subtract(u,i,c),n.vec3.subtract(p,i,o),n.vec3.cross(d,u,p),n.vec3.normalize(d,d),n.vec3.subtract(u,o,c),n.vec3.subtract(p,o,a),n.vec3.cross(h,u,p),n.vec3.normalize(h,h),n.vec3.subtract(u,a,c),n.vec3.subtract(p,a,i),n.vec3.cross(f,u,p),n.vec3.normalize(f,f);var v=[i,o,a,c],g=[0,-1,0,d[0],d[1],d[2],h[0],h[1],h[2],f[0],f[1],f[2]],m=[0,1,2,3,1,0,3,2,1,3,0,2],y=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(12),n=0;n<4;n++)t[3*n]=v[n][0]*e[0],t[3*n+1]=v[n][1]*e[1],t[3*n+2]=v[n][2]*e[2];var r={};r[l.VertexAttrConstants.POSITION]=new Uint32Array(m),r[l.VertexAttrConstants.NORMAL]=new Uint32Array(y);var i={};return i[l.VertexAttrConstants.POSITION]={size:3,data:t},i[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(g)},new s.GeometryData(i,r)}}(p||(p={})),function(e){function t(e,t,r,i,o){return!(Math.abs(n.vec3.dot(t,e))>o||(n.vec3.cross(r,e,t),n.vec3.normalize(r,r),n.vec3.cross(i,r,e),n.vec3.normalize(i,i),0))}function d(e,n,r,i,o,a,s){return t(e,n,o,a,s)||t(e,r,o,a,s)||t(e,i,o,a,s)}e.createBoxGeometry=c.createGeometry,e.createDiamondGeometry=u.createGeometry,e.createTetrahedronGeometry=p.createGeometry,e.createSphereGeometry=function(e,t,n,r,i,o,a){e=e||50,r=void 0!==r?r:-Math.PI,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:.5*-Math.PI,a=void 0!==a?a:Math.PI;for(var c=Math.max(3,Math.floor(t)||8),u=Math.max(2,Math.floor(n)||6),p=(c+1)*(u+1),d=new Float32Array(3*p),h=new Float32Array(3*p),f=new Float32Array(2*p),v=[],g=0,m=0;m<=u;m++){for(var y=[],b=m/u,_=o+b*a,x=Math.cos(_),w=0;w<=c;w++){var S=w/c,P=r+S*i,O=Math.cos(P)*x,M=Math.sin(_),A=-Math.sin(P)*x;d[3*g]=O*e,d[3*g+1]=M*e,d[3*g+2]=A*e,h[3*g]=O,h[3*g+1]=M,h[3*g+2]=A,f[2*g]=S,f[2*g+1]=b,y.push(g),++g}v.push(y)}var C=new Uint32Array(2*c*(u-1)*3);for(g=0,m=0;m<u;m++)for(w=0;w<c;w++){var D=v[m][w],R=v[m][w+1],T=v[m+1][w+1],E=v[m+1][w];0===m?(C[g++]=D,C[g++]=T,C[g++]=E):m===u-1?(C[g++]=D,C[g++]=R,C[g++]=T):(C[g++]=D,C[g++]=R,C[g++]=T,C[g++]=T,C[g++]=E,C[g++]=D)}l.assert(g===C.length);var j={};j[l.VertexAttrConstants.POSITION]=C,j[l.VertexAttrConstants.NORMAL]=C,j[l.VertexAttrConstants.UV0]=C;var I={};return I[l.VertexAttrConstants.POSITION]={size:3,data:d},I[l.VertexAttrConstants.NORMAL]={size:3,data:h},I[l.VertexAttrConstants.UV0]={size:2,data:f},new s.GeometryData(I,j)},e.createPolySphereGeometry=function(e,t,n){var r,i,o=e;if(n)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],i=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var a=o*(1+Math.sqrt(5))/2;r=[-o,a,0,o,a,0,-o,-a,0,o,-a,0,0,-o,a,0,o,a,0,-o,-a,0,o,-a,a,0,-o,a,0,o,-a,0,-o,-a,0,o],i=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var c=0;c<r.length;c+=3)h.scale(r,c,e/h.length(r,c));var u={};function p(t,n){var i;t>n&&(t=(i=[n,t])[0],n=i[1]);var o=t.toString()+"."+n.toString();if(u[o])return u[o];var a=r.length;return r.length+=3,h.add(r,3*t,r,3*n,r,a),h.scale(r,a,e/h.length(r,a)),u[o]=a/=3,a}for(c=0;c<t;c++){for(var d=i.length,f=new Uint32Array(4*d),v=0;v<d;v+=3){var g=i[v],m=i[v+1],y=i[v+2],b=p(g,m),_=p(m,y),x=p(y,g),w=4*v;f[w]=g,f[w+1]=b,f[w+2]=x,f[w+3]=m,f[w+4]=_,f[w+5]=b,f[w+6]=y,f[w+7]=x,f[w+8]=_,f[w+9]=b,f[w+10]=_,f[w+11]=x}i=f,u={}}var S=new Float32Array(r);for(c=0;c<S.length;c+=3)h.normalize(S,c);var P={};P[l.VertexAttrConstants.POSITION]=i,P[l.VertexAttrConstants.NORMAL]=i;var O={};return O[l.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(r)},O[l.VertexAttrConstants.NORMAL]={size:3,data:S},new s.GeometryData(O,P)},e.createPointGeometry=function(e,t,n,r,i,o,a,c){var u=t?new Float64Array([t[0],t[1],t[2]]):new Float32Array([0,0,0]),p=e?new Float32Array([e[0],e[1],e[2]]):new Float32Array([0,0,1]),d=o?new Float32Array(o):new Float32Array([0,0]),h=n?new Uint8Array([255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]):new Uint8Array([255,255,255,255]),f=null!=r&&2===r.length?new Float32Array(r):new Float32Array([1,1]),v={};if(v[l.VertexAttrConstants.POSITION]={size:3,data:u},v[l.VertexAttrConstants.NORMAL]={size:3,data:p},v[l.VertexAttrConstants.UV0]={size:d.length,data:d},v[l.VertexAttrConstants.COLOR]={size:4,data:h},v[l.VertexAttrConstants.SIZE]={size:2,data:f},null!=i){var g=new Float32Array([i[0],i[1],i[2],i[3]]);v[l.VertexAttrConstants.AUXPOS1]={size:4,data:g}}if(null!=a){var m=new Float32Array([a[0],a[1],a[2],a[3]]);v[l.VertexAttrConstants.AUXPOS2]={size:4,data:m}}return null!=c?(s.GeometryData.call(c,v,s.GeometryData.DefaultIndices,s.GeometryData.DefaultOffsets,"point"),c):new s.GeometryData(v,s.GeometryData.DefaultIndices,s.GeometryData.DefaultOffsets,"point")},e.updatePointGeometry=function(e,t,n,r,i,o,a,s){var c,u=s.vertexAttributes;return null!=e&&((c=u[l.VertexAttrConstants.NORMAL].data)[0]=e[0],c[1]=e[1],c[2]=e[2]),null!=t&&((c=u[l.VertexAttrConstants.POSITION].data)[0]=t[0],c[1]=t[1],c[2]=t[2]),null!=n&&((c=u[l.VertexAttrConstants.COLOR].data)[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3]),null!=r&&((c=u[l.VertexAttrConstants.SIZE].data)[0]=r[0],c[1]=r[1]),null!=i&&((c=u[l.VertexAttrConstants.AUXPOS1].data)[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3]),null!=o&&((c=u[l.VertexAttrConstants.UV0].data)[0]=o[0],c[1]=o[1]),null!=a&&((c=u[l.VertexAttrConstants.AUXPOS2].data)[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]),s},e.createPointArrayGeometry=function(e,t){for(var n=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),i=new Uint32Array(e.length),o=new Uint32Array(e.length),a=0;a<e.length;a++)n[3*a]=e[a][0],n[3*a+1]=e[a][1],n[3*a+2]=e[a][2],t&&(r[3*a]=t[a][0],r[3*a+1]=t[a][1],r[3*a+2]=t[a][2]),i[a]=a,o[a]=0;t||(r[0]=0,r[1]=1,r[2]=0);var c=new Float32Array(2);c[0]=0,c[1]=0;var u={};u[l.VertexAttrConstants.POSITION]=i,u[l.VertexAttrConstants.NORMAL]=t?i:o,u[l.VertexAttrConstants.UV0]=o;var p={};return p[l.VertexAttrConstants.POSITION]={size:3,data:n},p[l.VertexAttrConstants.NORMAL]={size:3,data:r},p[l.VertexAttrConstants.UV0]={size:2,data:c},new s.GeometryData(p,u,s.GeometryData.DefaultOffsets,"point")},e.createTriangleGeometry=function(){var e=new Float32Array([0,0,0,0,0,100,100,0,0]),t=new Uint32Array([0,1,2]),n=new Float32Array([0,1,0]),r=new Uint32Array([0,0,0]),i=new Float32Array([0,0]),o=new Uint32Array([0,0,0]),a={};a[l.VertexAttrConstants.POSITION]=t,a[l.VertexAttrConstants.NORMAL]=r,a[l.VertexAttrConstants.UV0]=o;var c={};return c[l.VertexAttrConstants.POSITION]={size:3,data:e},c[l.VertexAttrConstants.NORMAL]={size:3,data:n},c[l.VertexAttrConstants.UV0]={size:2,data:i},new s.GeometryData(c,a)},e.createSquareGeometry=function(e){var t=new Float32Array(12);if(e)for(var n=0;n<4;n++)for(var r=0;r<3;r++)t[3*n+r]=e[n][r];else t[0]=-1,t[1]=-1,t[2]=0,t[3]=1,t[4]=-1,t[5]=0,t[6]=1,t[7]=1,t[8]=0,t[9]=-1,t[10]=1,t[11]=0;var i=new Uint32Array([0,1,2,2,3,0]),o=new Float32Array([0,0,1]),a=new Uint32Array([0,0,0,0,0,0]),c=new Float32Array([0,0,1,0,1,1,0,1]),u=new Uint8Array([255,255,255,255]),p={};p[l.VertexAttrConstants.POSITION]=i,p[l.VertexAttrConstants.NORMAL]=a,p[l.VertexAttrConstants.UV0]=i,p[l.VertexAttrConstants.COLOR]=a;var d={};return d[l.VertexAttrConstants.POSITION]={size:3,data:t},d[l.VertexAttrConstants.NORMAL]={size:3,data:o},d[l.VertexAttrConstants.UV0]={size:2,data:c},d[l.VertexAttrConstants.COLOR]={size:4,data:u},new s.GeometryData(d,p)},e.createConeGeometry=function(e,t,n,i,o,a){void 0===o&&(o=!0),void 0===a&&(a=!0);var c=0,u=t,p=e,d=r.vec3f32.fromValues(0,c,0),h=r.vec3f32.fromValues(0,c+p,0),f=r.vec3f32.fromValues(0,-1,0),v=r.vec3f32.fromValues(0,1,0);i&&(c=p,h=r.vec3f32.fromValues(0,0,0),d=r.vec3f32.fromValues(0,c,0),f=r.vec3f32.fromValues(0,1,0),v=r.vec3f32.fromValues(0,-1,0));var g=[h,d],m=[f,v],y=n+2,b=Math.sqrt(p*p+u*u);if(i)for(_=n-1;_>=0;_--)x=_*(2*Math.PI/n),w=r.vec3f32.fromValues(Math.cos(x)*u,c,Math.sin(x)*u),g.push(w),S=r.vec3f32.fromValues(p*Math.cos(x)/b,-u/b,p*Math.sin(x)/b),m.push(S);else for(var _=0;_<n;_++){var x=_*(2*Math.PI/n),w=r.vec3f32.fromValues(Math.cos(x)*u,c,Math.sin(x)*u);g.push(w);var S=r.vec3f32.fromValues(p*Math.cos(x)/b,u/b,p*Math.sin(x)/b);m.push(S)}var P=new Uint32Array(2*(n+2)*3),O=new Uint32Array(2*(n+2)*3),M=0,A=0;if(o){for(_=3;_<g.length;_++)P[M++]=1,P[M++]=_-1,P[M++]=_,O[A++]=0,O[A++]=0,O[A++]=0;P[M++]=g.length-1,P[M++]=2,P[M++]=1,O[A++]=0,O[A++]=0,O[A++]=0}if(a){for(_=3;_<g.length;_++)P[M++]=_,P[M++]=_-1,P[M++]=0,O[A++]=_,O[A++]=_-1,O[A++]=1;P[M++]=0,P[M++]=2,P[M++]=g.length-1,O[A++]=1,O[A++]=2,O[A++]=m.length-1}var C=new Float32Array(3*y);for(_=0;_<y;_++)C[3*_]=g[_][0],C[3*_+1]=g[_][1],C[3*_+2]=g[_][2];var D=new Float32Array(3*y);for(_=0;_<y;_++)D[3*_]=m[_][0],D[3*_+1]=m[_][1],D[3*_+2]=m[_][2];var R={};R[l.VertexAttrConstants.POSITION]=P,R[l.VertexAttrConstants.NORMAL]=O;var T={};return T[l.VertexAttrConstants.POSITION]={size:3,data:C},T[l.VertexAttrConstants.NORMAL]={size:3,data:D},new s.GeometryData(T,R)},e.createCylinderGeometry=function(e,t,i,o,a,c){var u=o?r.vec3f32.clone(o):r.vec3f32.fromValues(1,0,0),p=a?r.vec3f32.clone(a):r.vec3f32.fromValues(0,0,0),d=void 0===c||c,h=r.vec3f32.create();n.vec3.normalize(h,u);var f=r.vec3f32.create();n.vec3.scale(f,h,Math.abs(e));var v=r.vec3f32.create();n.vec3.scale(v,f,-.5),n.vec3.add(v,v,p);var g=r.vec3f32.fromValues(0,1,0);Math.abs(1-n.vec3.dot(h,g))<.2&&n.vec3.set(g,0,0,1);var m=r.vec3f32.create();n.vec3.cross(m,h,g),n.vec3.normalize(m,m),n.vec3.cross(g,m,h);var y=2*i+(d?2:0),b=i+(d?2:0),_=new Float32Array(3*y),x=new Float32Array(3*b),w=new Float32Array(2*y),S=new Uint32Array(3*i*(d?4:2)),P=new Uint32Array(3*i*(d?4:2));d&&(_[3*(y-2)+0]=v[0],_[3*(y-2)+1]=v[1],_[3*(y-2)+2]=v[2],w[2*(y-2)]=0,w[2*(y-2)+1]=0,_[3*(y-1)+0]=_[3*(y-2)+0]+f[0],_[3*(y-1)+1]=_[3*(y-2)+1]+f[1],_[3*(y-1)+2]=_[3*(y-2)+2]+f[2],w[2*(y-1)]=1,w[2*(y-1)+1]=1,x[3*(b-2)+0]=-h[0],x[3*(b-2)+1]=-h[1],x[3*(b-2)+2]=-h[2],x[3*(b-1)+0]=h[0],x[3*(b-1)+1]=h[1],x[3*(b-1)+2]=h[2]);for(var O=function(e,t,n){S[e]=t,P[e]=n},M=0,A=r.vec3f32.create(),C=r.vec3f32.create(),D=0;D<i;D++){var R=D*(2*Math.PI/i);n.vec3.scale(A,g,Math.sin(R)),n.vec3.scale(C,m,Math.cos(R)),n.vec3.add(A,A,C),x[3*D+0]=A[0],x[3*D+1]=A[1],x[3*D+2]=A[2],n.vec3.scale(A,A,t),n.vec3.add(A,A,v),_[3*D+0]=A[0],_[3*D+1]=A[1],_[3*D+2]=A[2],w[2*D+0]=D/i,w[2*D+1]=0,_[3*(D+i)+0]=_[3*D+0]+f[0],_[3*(D+i)+1]=_[3*D+1]+f[1],_[3*(D+i)+2]=_[3*D+2]+f[2],w[2*(D+i)+0]=D/i,w[2*D+1]=1;var T=(D+1)%i;O(M++,D,D),O(M++,D+i,D),O(M++,T,T),O(M++,T,T),O(M++,D+i,D),O(M++,T+i,T)}if(d){for(D=0;D<i;D++)T=(D+1)%i,O(M++,y-2,b-2),O(M++,D,b-2),O(M++,T,b-2);for(D=0;D<i;D++)T=(D+1)%i,O(M++,D+i,b-1),O(M++,y-1,b-1),O(M++,T+i,b-1)}var E={};E[l.VertexAttrConstants.POSITION]=S,E[l.VertexAttrConstants.NORMAL]=P,E[l.VertexAttrConstants.UV0]=S;var j={};return j[l.VertexAttrConstants.POSITION]={size:3,data:_},j[l.VertexAttrConstants.NORMAL]={size:3,data:x},j[l.VertexAttrConstants.UV0]={size:2,data:w},new s.GeometryData(j,E)},e.createTubeGeometry=function(t,n,r,i,o){r=r||10,i=null==i||i,l.assert(t.length>1);for(var a=[],s=[],c=0;c<r;c++){a.push([0,-c-1,-(c+1)%r-1]);var u=c/r*2*Math.PI;s.push([Math.cos(u)*n,Math.sin(u)*n])}return e.createPathExtrusionGeometry(s,t,[[0,0,0]],a,i,o)},e.createPathExtrusionGeometry=function(e,t,a,c,u,p){void 0===p&&(p=r.vec3f32.fromValues(0,0,0));var h=e.length,v=new Float32Array(t.length*h*3+(6*a.length||0)),g=new Float32Array(t.length*h+(2*a.length||0)),m=new Float32Array(t.length*h*3+(a?6:0)),y=(t.length-1)*h*6+3*c.length*2,b=new Uint32Array(y),_=new Uint32Array(y),x=0,w=0,S=0,P=0,O=0,M=r.vec3f32.create(),A=r.vec3f32.create(),C=r.vec3f32.create(),D=r.vec3f32.create(),R=r.vec3f32.create(),T=r.vec3f32.create(),E=r.vec3f32.create(),j=i.vec3f64.create(),I=r.vec3f32.create(),V=r.vec3f32.create(),L=r.vec3f32.create(),z=r.vec3f32.create(),N=r.vec3f32.create(),F=o.plane.create();n.vec3.set(I,0,1,0),n.vec3.subtract(A,t[1],t[0]),n.vec3.normalize(A,A),u?(n.vec3.add(j,t[0],p),n.vec3.normalize(C,j)):n.vec3.set(C,0,0,1),d(A,C,I,I,R,C,f),n.vec3.copy(D,C),n.vec3.copy(z,R);for(var U=0;U<a.length;U++)n.vec3.scale(T,R,a[U][0]),n.vec3.scale(j,C,a[U][2]),n.vec3.add(T,T,j),n.vec3.add(T,T,t[0]),v[x++]=T[0],v[x++]=T[1],v[x++]=T[2],g[S++]=0;for(m[w++]=-A[0],m[w++]=-A[1],m[w++]=-A[2],U=0;U<c.length;U++)b[P++]=c[U][0]>0?c[U][0]:-c[U][0]-1+a.length,b[P++]=c[U][1]>0?c[U][1]:-c[U][1]-1+a.length,b[P++]=c[U][2]>0?c[U][2]:-c[U][2]-1+a.length,_[O++]=0,_[O++]=0,_[O++]=0;for(var G=a.length,H=a.length-1,B=0;B<t.length;B++){var q=!1;B>0&&(n.vec3.copy(M,A),B<t.length-1?(n.vec3.subtract(A,t[B+1],t[B]),n.vec3.normalize(A,A)):q=!0,n.vec3.add(V,M,A),n.vec3.normalize(V,V),n.vec3.add(L,t[B-1],D),o.plane.fromPositionAndNormal(t[B],V,F),o.plane.intersectRay(F,o.ray.wrap(L,M),j)?(n.vec3.subtract(j,j,t[B]),n.vec3.normalize(C,j),n.vec3.cross(R,V,C),n.vec3.normalize(R,R)):d(V,D,z,I,R,C,f),n.vec3.copy(D,C),n.vec3.copy(z,R)),u&&(n.vec3.add(j,t[B],p),n.vec3.normalize(N,j));for(var W=0;W<h;W++)if(n.vec3.scale(T,R,e[W][0]),n.vec3.scale(j,C,e[W][1]),n.vec3.add(T,T,j),n.vec3.normalize(E,T),m[w++]=E[0],m[w++]=E[1],m[w++]=E[2],g[S++]=u?n.vec3.dot(T,N):T[2],n.vec3.add(T,T,t[B]),v[x++]=T[0],v[x++]=T[1],v[x++]=T[2],!q){var k=(W+1)%h;b[P++]=G+W,b[P++]=G+h+W,b[P++]=G+k,b[P++]=G+k,b[P++]=G+h+W,b[P++]=G+h+k;for(var X=0;X<6;X++)_[O++]=b[P-6+X]-H}G+=h}var Z=t[t.length-1];for(U=0;U<a.length;U++)n.vec3.scale(T,R,a[U][0]),n.vec3.scale(j,C,a[U][1]),n.vec3.add(T,T,j),n.vec3.add(T,T,Z),v[x++]=T[0],v[x++]=T[1],v[x++]=T[2],g[S++]=0;var Y=w/3;m[w++]=A[0],m[w++]=A[1],m[w++]=A[2];var K=G-h;for(U=0;U<c.length;U++)b[P++]=c[U][0]>=0?G+c[U][0]:-c[U][0]-1+K,b[P++]=c[U][2]>=0?G+c[U][2]:-c[U][2]-1+K,b[P++]=c[U][1]>=0?G+c[U][1]:-c[U][1]-1+K,_[O++]=Y,_[O++]=Y,_[O++]=Y;var J={};J[l.VertexAttrConstants.POSITION]=b,J[l.VertexAttrConstants.NORMAL]=_;var Q={};return Q[l.VertexAttrConstants.POSITION]={size:3,data:v},Q.zOffset={size:1,data:g},Q[l.VertexAttrConstants.NORMAL]={size:3,data:m},new s.GeometryData(Q,J)},e.createPolylineGeometry=function(e,t){l.assert(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),l.assert(3===e[0].length,"createPolylineGeometry(): malformed vertex"),l.assert(void 0===t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),l.assert(void 0===t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var n=new Float64Array(3*e.length),r=new Uint32Array(2*(e.length-1)),i=0,o=0,a=0;a<e.length;a++){for(var c=0;c<3;c++)n[i++]=e[a][c];a>0&&(r[o++]=a-1,r[o++]=a)}var u={},p={};if(u[l.VertexAttrConstants.POSITION]=r,p[l.VertexAttrConstants.POSITION]={size:3,data:n},t){var d=new Float32Array(3*t.length),h=0;for(a=0;a<e.length;a++)for(c=0;c<3;c++)d[h++]=t[a][c];u[l.VertexAttrConstants.NORMAL]=r,p[l.VertexAttrConstants.NORMAL]={size:3,data:d}}return new s.GeometryData(p,u,s.GeometryData.DefaultOffsets,"line")},e.createExtrudedTriangle=function(e,t,n,r){for(var i,o,a=new Float32Array(18),c=[[-t,0,r/2],[n,0,r/2],[0,e,r/2],[-t,0,-r/2],[n,0,-r/2],[0,e,-r/2]],u=0;u<6;u++)a[3*u]=c[u][0],a[3*u+1]=c[u][1],a[3*u+2]=c[u][2];var p=((i={})[l.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),i),d=((o={})[l.VertexAttrConstants.POSITION]={size:3,data:a},o);return new s.GeometryData(d,p)},e.transformInPlace=function(e,t){for(var r=e.vertexAttributes[l.VertexAttrConstants.POSITION].data,i=0;i<r.length;i+=3)n.vec3.set(v,r[i],r[i+1],r[i+2]),n.vec3.transformMat4(v,v,t),r[i]=v[0],r[i+1]=v[1],r[i+2]=v[2]},e.addVertexColors=function(e,t){var n=t||[1,1,1,1],r=new Uint8Array(4);r[0]=255*n[0],r[1]=255*n[1],r[2]=255*n[2],r[3]=255*(n.length>3?n[3]:1);var i={},o=e.getVertexAttr();for(var a in o)i[a]=o[a];i[l.VertexAttrConstants.COLOR]={size:4,data:r};var c={};for(var a in e.indices)c[a]=e.indices[a];return c[l.VertexAttrConstants.COLOR]=new Uint32Array(c[l.VertexAttrConstants.POSITION].length),new s.GeometryData(i,c,e.componentOffsets,e.primitiveType)},e.addNormals=function(e){for(var t=e.getVertexAttr(),r=e.indices,i=a.Vec3Compact.subtract,o=new Float32Array(r.position.length/3*3),s=t.position.data,c=0,u=r.position,p=new Uint32Array(u.length),d=0;d<u.length;d+=3){i(s,3*u[d],s,3*u[d+2],g,0),i(s,3*u[d],s,3*u[d+1],v,0),n.vec3.cross(v,v,g),n.vec3.normalize(v,v);var h=c/3;o[c++]=v[0],o[c++]=v[1],o[c++]=v[2],p[d]=h,p[d+1]=h,p[d+2]=h}t[l.VertexAttrConstants.NORMAL]={size:3,data:o,offsetIdx:0,strideIdx:3},r[l.VertexAttrConstants.NORMAL]=p},e.cgToGIS=function(e,t){void 0===t&&(t=e);var n=e.getVertexAttr(),r=n.position.data,i=n.normal.data,o=t.getVertexAttr(),a=o.position.data,s=o.normal.data;if(i)for(var l=0;l<i.length;l+=3){var c=i[l+1];s[l+1]=-i[l+2],s[l+2]=c}if(r)for(l=0;l<r.length;l+=3)c=r[l+1],a[l+1]=-r[l+2],a[l+2]=c;return t},e.makeOrthoBasisDirUp=t,e.makeOrthoBasisDirUpFallback=d}(d||(d={}));var f=.99619469809,v=r.vec3f32.create(),g=r.vec3f32.create();return d}).apply(null,r))||(e.exports=i)},"58az":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSpace=function(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(r.glsl(i||(i=n(["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "],["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},"5T2R":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("FXVB"),n("0LE5"),n("O7NG"),n("ZcgO"),n("BwdQ"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5"),n("uZGf"),n("AvU8")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h){function f(e,t){void 0===t&&(t=4);var n=o.vec4f64.fromValues(e[0],e[1],e[2],e.length>3?e[3]:1),r=new d.ShadedColorMaterial({color:n,transparent:e[3]<1,writeDepth:!0,cullFace:2},"manipulator");return r.renderOccluded=t,r}function v(e,t,n,r){var o=i.vec3.normalize(l.sv3d.get(),e),a=i.vec3.normalize(l.sv3d.get(),t),s=i.vec3.cross(l.sv3d.get(),o,a);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=0,r[4]=a[0],r[5]=a[1],r[6]=a[2],r[7]=0,r[8]=s[0],r[9]=s[1],r[10]=s[2],r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function g(e,t){var r=e.getViewForGraphic(t);return n.isSome(r)&&"computeAttachmentOrigin"in r?r.computeAttachmentOrigin(t,e.spatialReference):null}Object.defineProperty(t,"__esModule",{value:!0}),t.createManipulatorMaterial=f,t.createManipulatorOutlineMaterial=function(e,t){void 0===t&&(t=4);var n=o.vec4f64.fromValues(e[0],e[1],e[2],4===e.length?e[3]:1),r=new p({color:n,transparent:!0,writeDepth:!0,cullFace:1},"manipulator-outline");return r.renderOccluded=t,r},t.createSphereManipulator=function(e,t,n){return new h.Manipulator3D({view:e,renderObjects:[{geometry:new c(u.createSphereGeometry(1,32,32),"manipulator"),material:f(o.vec4f64.fromValues(t[0],t[1],t[2],null!=n?n:1))}]})},t.calculateInputRotationTransform=function(e,t,n,o){var a=i.vec3.subtract(l.sv3d.get(),e,n),s=v(a,i.vec3.cross(l.sv3d.get(),o,a),n,l.sm4d.get());r.mat4.invert(s,s);var c=i.vec3.transformMat4(l.sv3d.get(),t,s);return Math.atan2(c[1],c[0])},t.calculateTranslateRotateFromBases=v,t.getGraphicAttachmentOrigin=g,t.placeAtGraphic=function(e,t,r){var i=g(e,r);n.isSome(i)?t.elevationAlignedLocation=i:function(e,t){if(!n.isNone(t)){var r=s.computeCentroid(t);n.isNone(r)||(e.location=a.hydrateGeometry(r))}}(t,r.geometry)}}).apply(null,r))||(e.exports=i)},"62Ht":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("W0kZ")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=new n.IdGen;t.generateObject3DStateId=function(e){return{id:r.gen(0===e?"highlight":"occludee"),channel:e}};var i=function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:0,objectStateId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,n){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:n})},e.prototype.addExternal=function(e,t){this.items.push({type:2,objectStateId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var n=this.items[t];n.objectStateId===e&&(this._removeObjectStateItem(n),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var n=this.items[t];0===n.type&&n.object===e&&(this._removeObjectStateItem(n),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var n=this.items[t];1===n.type&&n.renderGeometry===e&&(this._removeObjectStateItem(n),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach((function(t){e._removeObjectStateItem(t)})),this.items=[]},e.prototype._removeObjectStateItem=function(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}},e}();t.Object3DStateSet=i}).apply(null,r))||(e.exports=i)},"6hC7":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("xhoE"),n("Q2wQ"),n("HZ3d"),n("QDcU"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("DtIM"),n("woUR"),n("uiHv"),n("X5J5"),n("Fe95"),n("48/q"),n("dtql"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w,S,P,O){Object.defineProperty(t,"__esModule",{value:!0});var M=function(e){function t(t){var n=e.call(this)||this;return n._handles=new l,n._arrowManipulatorInfos=new Array,n._opaqueMaterial=n.createMaterial(),n._transparentMaterial=n.createMaterial(.5),n._angle=0,n._scale=1,n._radius=b.DISC_RADIUS,n._updateAfterDrag=!1,n.events=new s,n._tool=t.tool,n._view=t.view,null!=t.radius&&(n._radius=t.radius),n._createManipulators(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return r(t,e),Object.defineProperty(t.prototype,"orthogonalAvailable",{set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0},t.prototype.forEachManipulator=function(e){this._arrowManipulatorInfos.map((function(t){return e(t.manipulator,1)}))},t.prototype.createGraphicDragPipeline=function(e,t){var n=this,r=e.graphic,i=v.getGraphicEffectiveElevationInfo(r),o=u.expect(r.geometry).spatialReference;return x.createGraphicMoveDragPipeline(e,t,(function(e){return n.createDragPipeline(e,i,o)}))},t.prototype.createDragPipeline=function(e,t,n){var r=this;return c.handlesGroup(this._arrowManipulatorInfos.map((function(i,o){return m.createManipulatorDragEventPipeline(i.manipulator,(function(i,a,s,l){var c=a.next(m.screenToMapXYAtLocation(r._view,i.elevationAlignedLocation,t,n)).next(m.constrainToMapAxis(i.location,r.angle+(o+1)*Math.PI*.5)).next(m.addScreenDelta());e(i,c,s,l)}))})))},Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayScale",{get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())},enumerable:!0,configurable:!0}),t.prototype._updateManipulators=function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e)},t.prototype._updateArrowManipulator=function(e,t){var n=e.manipulator,r=e.transform,i=this._radius/b.DISC_RADIUS,o=b.DISC_TRANSLATE_ARROW_SIZE*i,a=Math.sqrt(o*o*3/4),s=P.createExtrudedTriangle(a,o/2,o/2,b.DISC_HEIGHT);P.transformInPlace(s,p.mat4.fromTranslation(w.sm4d.get(),h.vec3.set(w.sv3d.get(),0,-a/3,0)));var l=new S(s,"move-xy-axis-arrow");n.renderObjects=[{geometry:l,material:this._opaqueMaterial,stateMask:2},{geometry:l,material:this._transparentMaterial,stateMask:1}],n.radius=a/3*2*1.2;var c=p.mat4.identity(w.sm4d.get());p.mat4.fromZRotation(c,t*Math.PI/2);var u=p.mat4.identity(w.sm4d.get());p.mat4.fromTranslation(u,h.vec3.set(w.sv3d.get(),0,b.DISC_TRANSLATE_ARROW_OFFSET*i,0)),p.mat4.multiply(r,c,u)},t.prototype._createManipulators=function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()},t.prototype._updateManipulatorTransform=function(){var e=this.angle,t=p.mat4.identity(w.sm4d.get());p.mat4.rotate(t,t,e,f.vec3f64.fromValues(0,0,1));var n=p.mat4.fromScaling(w.sm4d.get(),h.vec3.set(w.sv3d.get(),this.displayScale,this.displayScale,this.displayScale)),r=p.mat4.identity(w.sm4d.get());p.mat4.multiply(r,n,t);for(var i=0,o=this._arrowManipulatorInfos;i<o.length;i++){var a=o[i],s=p.mat4.multiply(w.sm4d.get(),r,a.transform);a.manipulator.modelTransform=s}},t.prototype._createArrowManipulator=function(e){var t=this,n=new g.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:f.vec3f64.fromValues(0,0,1)}}),r={manipulator:n,transform:d.mat4f64.create()};return this._updateArrowManipulator(r,e),this._handles.add(n.events.on("drag",(function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)}))),r},t.prototype.createMaterial=function(e){void 0===e&&(e=1);var t=a.toUnitRGBA(y.colors.main);t[3]*=e;var n=new O({color:t,transparent:1!==e,cullFace:2},"graphic-transform");return n.renderOccluded=2,n},Object.defineProperty(t.prototype,"test",{get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map((function(e){return e.manipulator}))}},enumerable:!0,configurable:!0}),t}(_.Manipulation);t.MoveXYAxisManipulation=M}).apply(null,r))||(e.exports=i)},"6t3m":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.VertexColor=function(e,t){t.attributeColor?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(r.glsl(i||(i=n(["\n      void forwardVertexColor() { vColor = color; }\n    "],["\n      void forwardVertexColor() { vColor = color; }\n    "])))),e.vertex.code.add(r.glsl(o||(o=n(["\n      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }\n    "],["\n      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }\n    "]))))):e.vertex.code.add(r.glsl(a||(a=n(["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "],["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "]))))}}).apply(null,r))||(e.exports=i)},"6vp1":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("DKwL"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){function o(e){e.include(r.RgbaFloatEncoding),e.fragment.code.add(i.glsl(a||(a=n(["\n    float linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "],["\n    float linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "]))))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.ReadLinearDepth=o,function(e){e.bindUniforms=function(e,t){e.setUniform2fv("nearFar",t.nearFar)}}(o=t.ReadLinearDepth||(t.ReadLinearDepth={}))}).apply(null,r))||(e.exports=i)},"73uV":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("xhoE"),n("Q2wQ"),n("HZ3d"),n("2Atf"),n("eIBl"),n("LxLY"),n("uiHv"),n("48/q"),n("dtql"),n("N78w")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(t){var n=e.call(this)||this;return n._handles=new s,n._view=t.view,n._tool=t.tool,n._graphicState=t.graphicState,n._createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return r(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null},t.prototype.forEachManipulator=function(e){e(this._manipulator,1)},t.prototype.createGraphicDragPipeline=function(e){var t=this;return p.createGraphicMoveDragPipeline(this._graphicState,e,(function(e){return t.createDragPipeline(e)}))},t.prototype.createDragPipeline=function(e){var t=this._view,n=this._graphicState.graphic,r=l.isSome(n.geometry)?n.geometry.spatialReference:null;return c.createManipulatorDragEventPipeline(this._manipulator,(function(i,o,a,s){var l=o.next(c.screenToMapXYForGraphic(s,t,n,r)).next(c.addMapDelta()).next(c.addScreenDelta());e(i,l,a,s)}))},t.prototype._createManipulator=function(){this._manipulator=new d.GraphicManipulator({graphic:this._graphicState.graphic,view:this._view,selectable:!0,cursor:"move"})},t}(u.Manipulation);t.MoveXYGraphicManipulation=h}).apply(null,r))||(e.exports=i)},"7Aei":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r="",i=0;i<t.length;i++)r+=e[i]+t[i];return r+e[e.length-1]}Object.defineProperty(t,"__esModule",{value:!0}),t.glsl=n,function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(n=t.glsl||(t.glsl={}))}).apply(null,r))||(e.exports=i)},"7Yqx":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(){var e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.clone=function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.fromValues=function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v){var g=new Float32Array(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=o,g[6]=a,g[7]=s,g[8]=l,g[9]=c,g[10]=u,g[11]=p,g[12]=d,g[13]=h,g[14]=f,g[15]=v,g},t.createView=function(e,t){return new Float32Array(e,t,16)},t.IDENTITY=n()}).apply(null,r))||(e.exports=i)},"7zqm":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.LineStipple=function(e,t){e.defines.addFloat("STIPPLE_ALPHA_COLOR_DISCARD",.001),e.defines.addFloat("STIPPLE_ALPHA_HIGHLIGHT_DISCARD",.5),t.stippleEnabled?function(e,t){e.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleUVMaxEnabled&&e.varyings.add("stipplePatternUvMax","float"),e.varyings.add("stipplePatternUv","float"),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(r.glsl(i||(i=n(["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"],["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"])),t.stippleUVMaxEnabled?"stipplePatternUvClamped = clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":"")),e.fragment.code.add(r.glsl(t.stippleOffColorEnabled?o||(o=n(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "])):a||(a=n(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "]))))}(e,t):function(e){e.fragment.code.add(r.glsl(s||(s=n(["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "],["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "]))))}(e)}}).apply(null,r))||(e.exports=i)},"9DjX":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("YX1r"),n("51bw"),n("FXVB"),n("1m5D"),n("EuvN"),n("lLWD"),n("0LE5"),n("vlC2"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("2eYJ"),n("/dtL"),n("ZJC8")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m){Object.defineProperty(t,"__esModule",{value:!0}),t.sliceFilterPredicate=function(e){return function(t,n,r){return c.vec3.lerp(R,t,n,r),!v.extrusionContainsPoint(e,R)}},t.IntersectorOptions=function(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.storeTerrainResults=!0,this.store=2};var y=function(){function e(){this._transform=a.mat4f64.create(),this._transformInverse=new b({value:this._transform},o.mat4.invert,a.mat4f64.create),this._transformInverseTranspose=new b(this._transformInverse,o.mat4.transpose,a.mat4f64.create),this._transformTranspose=new b({value:this._transform},o.mat4.transpose,a.mat4f64.create),this._transformInverseRotation=new b({value:this._transform},r.mat3.normalFromMat4Legacy,i.mat3f64.create)}return e.prototype.invalidateLazyTransforms=function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()},Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0}),e.prototype.setTransformMatrix=function(e){o.mat4.copy(this._transform,e)},e.prototype.multiplyTransform=function(e){o.mat4.multiply(this._transform,this._transform,e)},e.prototype.set=function(e){o.mat4.copy(this._transform,e),this.invalidateLazyTransforms()},e.prototype.setAndInvalidateLazyTransforms=function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()},e}();t.IntersectorTransform=y;var b=function(){function e(e,t,n){this.original=e,this.update=t,this.dirty=!0,this.transform=n()}return e.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform},enumerable:!0,configurable:!0}),e}(),_=function(){function e(){this.min=new x,this.max=new x,this.hud=new x,this.ground=new x}return e.prototype.init=function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]},e}();t.IntersectorResults=_;var x=function(){function e(e){this.normal=p.vec3f64.create(),this.transformation=a.mat4f64.create(),this._ray=f.ray.create(),this.init(e)}return Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return c.vec3.scale(T,this.ray.direction,this.dist),c.vec3.length(T)},enumerable:!0,configurable:!0}),e.prototype.getIntersectionPoint=function(e){return!!this.hasIntersectionPoint&&(c.vec3.scale(T,this.ray.direction,this.dist),c.vec3.add(e,this.ray.origin,T),!0)},e.prototype.getTransformedNormal=function(e){return c.vec3.copy(E,this.normal),E[3]=0,d.vec4.transformMat4(E,E,this.transformation),c.vec3.copy(e,E),c.vec3.normalize(e,e),e},e.prototype.init=function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?f.ray.copy(e,this._ray):this._ray=f.ray.create()},e.prototype.set=function(e,t,n,r,i,a,s,l,u,d){e instanceof m&&(e={type:"stage",obj:e}),this.dist=n,c.vec3.copy(this.normal,r),o.mat4.copy(this.transformation,i),this.target=e,this.name=t,this.drapedLayerOrder=a,this.center=s?p.vec3f64.clone(s):null,this.geometryId=l,this.triangleNr=u,this.drapedLayerGraphicOrder=d},e.prototype.copyFrom=function(e){f.ray.copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?p.vec3f64.clone(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,c.vec3.copy(this.normal,e.normal),o.mat4.copy(this.transformation,e.transformation)},e.prototype.toOwner=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return w(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e,t){var n=e.metadata.layerUid;return null!=n?t.map.findLayerByUid(n):null}(this.target,e);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return w(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null},e.prototype.toGraphic=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return S(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return this.target.metadata.createGraphic();case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return S(this.target.metadata,e)}}return null},e}();function w(e,t){return n.isNone(e)||null==e.layerUid?null:n.isSome(t.graphicsView)&&e.layerUid===t.graphicsView.mockLayerId?t.graphics:t.map.findLayerByUid(e.layerUid)}function S(e,t){if(n.isNone(e))return null;var r=w(e,t);if(n.isNone(r))return null;if(r===t.graphics)return n.isSome(t.graphicsView)?n.expect(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;var i=t.allLayerViews.find((function(e){return e.layer===r}));return i?function(e,t){return!e||e.suspended?null:"getGraphicFromIntersectorMetadata"in e&&t?e.getGraphicFromIntersectorMetadata(t):"getGraphicFromGraphicUid"in e&&null!=t.graphicUid?e.getGraphicFromGraphicUid(t.graphicUid):null}(i,e):null}t.IntersectorResult=x;var P=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.tmpVertex=p.vec3f64.create()}return e.prototype.applyToVertex=function(e,t,n){var r=e+this.localOrigin[0],i=t+this.localOrigin[1],o=n+this.localOrigin[2],a=this.offset/Math.sqrt(r*r+i*i+o*o);return this.tmpVertex[0]=e+r*a,this.tmpVertex[1]=t+i*a,this.tmpVertex[2]=n+o*a,this.tmpVertex},e.prototype.applyToAABB=function(e){var t=e[0]+this.localOrigin[0],n=e[1]+this.localOrigin[1],r=e[2]+this.localOrigin[2],i=e[3]+this.localOrigin[0],o=e[4]+this.localOrigin[1],a=e[5]+this.localOrigin[2],s=this.offset/Math.sqrt(t*t+n*n+r*r);e[0]+=t*s,e[1]+=n*s,e[2]+=r*s;var l=this.offset/Math.sqrt(i*i+o*o+a*a);return e[3]+=i*l,e[4]+=o*l,e[5]+=a*l,e},e}();t.TerrainVerticalOffsetGlobalViewingMode=P;var O=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=p.vec3f64.create(),this.mbs=h.vec4f64.create(),this.obb={center:p.vec3f64.create(),halfSize:u.vec3f32.create(),quaternion:null}}return Object.defineProperty(e.prototype,"localOrigin",{set:function(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},enumerable:!0,configurable:!0}),e.prototype.applyToVertex=function(e,t,n){var r=e,i=t,o=n+this.componentLocalOriginLength,a=this.offset/Math.sqrt(r*r+i*i+o*o);return this.tmpVertex[0]=e+r*a,this.tmpVertex[1]=t+i*a,this.tmpVertex[2]=n+o*a,this.tmpVertex},e.prototype.applyToAABB=function(e){var t=e[0],n=e[1],r=e[2]+this.componentLocalOriginLength,i=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,s=this.offset/Math.sqrt(t*t+n*n+r*r);e[0]+=t*s,e[1]+=n*s,e[2]+=r*s;var l=this.offset/Math.sqrt(i*i+o*o+a*a);return e[3]+=i*l,e[4]+=o*l,e[5]+=a*l,e},e.prototype.applyToMbs=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=this.offset/t;return this.mbs[0]=e[0]+e[0]*n,this.mbs[1]=e[1]+e[1]*n,this.mbs[2]=e[2]+e[2]*n,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs},e.prototype.applyToObb=function(e){var t=e.center,n=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*n,this.obb.center[1]=t[1]+t[1]*n,this.obb.center[2]=t[2]+t[2]*n,c.vec3.transformQuat(this.obb.halfSize,e.halfSize,e.quaternion),c.vec3.add(this.obb.halfSize,this.obb.halfSize,e.center);var r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,c.vec3.subtract(this.obb.halfSize,this.obb.halfSize,e.center),s.quat.conjugate(j,e.quaternion),c.vec3.transformQuat(this.obb.halfSize,this.obb.halfSize,j),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb},e}();t.I3SVerticalOffsetGlobalViewingMode=O;var M=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.sphere=g.create(),this.tmpVertex=p.vec3f64.create()}return e.prototype.applyToVertex=function(e,t,n){var r=this.objectTransform.transform,i=r[0]*e+r[4]*t+r[8]*n+r[12],o=r[1]*e+r[5]*t+r[9]*n+r[13],a=r[2]*e+r[6]*t+r[10]*n+r[14],s=this.offset/Math.sqrt(i*i+o*o+a*a),l=this.objectTransform.inverse;return this.tmpVertex[0]=l[0]*(i+=i*s)+l[4]*(o+=o*s)+l[8]*(a+=a*s)+l[12],this.tmpVertex[1]=l[1]*i+l[5]*o+l[9]*a+l[13],this.tmpVertex[2]=l[2]*i+l[6]*o+l[10]*a+l[14],this.tmpVertex},e.prototype.applyToMinMax=function(e,t){var n=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*n,e[1]+=e[1]*n,e[2]+=e[2]*n;var r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r},e.prototype.applyToAABB=function(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var n=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*n,e[4]+=e[4]*n,e[5]+=e[5]*n,e},e.prototype.applyToBoundingSphere=function(e,t){var n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/n;return this.sphere.center[0]=t[0]+t[0]*r,this.sphere.center[1]=t[1]+t[1]*r,this.sphere.center[2]=t[2]+t[2]*r,this.sphere.radius=e+e*this.offset/n,this.sphere},e}();t.Object3DVerticalOffsetGlobalViewingMode=M;var A=new M;t.getVerticalOffsetObject3D=function(e){return n.isSome(e)?(A.offset=e,A):null};var C=new O;t.getVerticalOffsetI3S=function(e){return n.isSome(e)?(C.offset=e,C):null};var D=new P;t.getVerticalOffsetTerrain=function(e){return n.isSome(e)?(D.offset=e,D):null},t.TERRAIN_ID="terrain";var R=p.vec3f64.create(),T=p.vec3f64.create(),E=h.vec4f64.create(),j=l.quatf64.create()}).apply(null,r))||(e.exports=i)},"9FJH":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("2Atf"),n("xhoE"),n("EiD/"),n("tUyH"),n("s6rJ")],void 0===(i=(function(e,t,n,r,i,o,a){var s=function(e){function t(t){var n=e.call(this,t)||this,r=t.textureRep;n.textureRep=r,n.textureId=t.textureId,n.initTransparent=!!t.initTextureTransparent;var i=function(e){return a.acquireIfNotUndefined(e,r,n.initTransparent)};return n.glTextureRef=i(n.textureId),t.normalTextureId&&(n.glTextureRefNormal=i(t.normalTextureId)),t.emissiveTextureId&&(n.glTextureRefEmission=i(t.emissiveTextureId)),t.occlusionTextureId&&(n.glTextureRefOcclusion=i(t.occlusionTextureId)),t.metallicRoughnessTextureId&&(n.glTextureRefRoughnessMetallness=i(t.metallicRoughnessTextureId)),n}return r(t,e),t.prototype.dispose=function(){a.releaseIfNotUndefined(this.textureId,this.textureRep)},t.prototype.updateTexture=function(e){e!==this.textureId&&(a.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=e,this.glTextureRef=a.acquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))},t.prototype.bindTexture=function(e,t){null!=this.glTextureRef&&(t.setUniform1i("tex",i.DefaultTextureUnits.DIFFUSE),e.bindTexture(this.glTextureRef.glTexture,i.DefaultTextureUnits.DIFFUSE)),this.glTextureRefNormal&&(t.setUniform1i("normalTexture",i.DefaultTextureUnits.NORMAL),e.bindTexture(this.glTextureRefNormal.glTexture,i.DefaultTextureUnits.NORMAL)),this.glTextureRefEmission&&(t.setUniform1i("texEmission",i.DefaultTextureUnits.EMISSION),e.bindTexture(this.glTextureRefEmission.glTexture,i.DefaultTextureUnits.EMISSION)),this.glTextureRefOcclusion&&(t.setUniform1i("texOcclusion",i.DefaultTextureUnits.OCCLUSION),e.bindTexture(this.glTextureRefOcclusion.glTexture,i.DefaultTextureUnits.OCCLUSION)),this.glTextureRefRoughnessMetallness&&(t.setUniform1i("texMetallicRoughness",i.DefaultTextureUnits.METALLIC_ROUGHNESS),e.bindTexture(this.glTextureRefRoughnessMetallness.glTexture,i.DefaultTextureUnits.METALLIC_ROUGHNESS))},t.prototype.bindTextureScale=function(e,t){var n=this.glTextureRef&&this.glTextureRef.glTexture;n&&n.descriptor.textureCoordinateScaleFactor?t.setUniform2fv("textureCoordinateScaleFactor",n.descriptor.textureCoordinateScaleFactor):t.setUniform2f("textureCoordinateScaleFactor",1,1)},t}(o.GLMaterial);return function(e){e.makeCtorParameters=function(e,t){return n({},e,t)}}(s||(s={})),s}).apply(null,r))||(e.exports=i)},AASg:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){return function(){function e(){}return e.copyIntervals=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];t.push([r[0],r[1]])}return t},e.convertFaceToIndexRange=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];r[0]=r[0]*t,r[1]=r[1]*t+(t-1)}},e.sortIntervals=function(e){return e.sort((function(e,t){return e[0]===t[0]?e[1]>t[1]?1:e[1]<t[1]?-1:0:e[0]>t[0]?1:e[0]<t[0]?-1:0}))},e.intersectIntervals=function(e,t){if(e.length<=0)return[];for(var n=[],r=0;r<e.length;r++){var i=e[r];if(!(i[1]<t[0]||i[0]>t[1])){var o=[i[0],i[1]];o[0]<t[0]&&(o[0]=t[0]),o[1]>t[1]&&(o[1]=t[1]),n.push(o)}}return n},e.mergeIntervals=function(e){if(e.length<=0)return[];var t=[];e=this.sortIntervals(e),t.push(e[0]);for(var n=1;n<e.length;n++){var r=t[t.length-1];r[1]+1<e[n][0]?t.push(e[n]):r[1]<e[n][1]&&(r[1]=e[n][1],t.pop(),t.push(r))}return t},e.invertIntervals=function(e,t){for(var n=[],r=0,i=0;i<e.length;i++){var o=e[i];o[0]>r&&n.push([r,o[0]-1]),r=o[1]+1}return r<=t&&n.push([r,t]),n},e.offsetIntervals=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];n.push([i[0]+t,i[1]+t])}return n},e}()}).apply(null,r))||(e.exports=i)},AgDx:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("rjU6"),n("+nCE"),n("CIy2")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t,o,a,s){void 0===o&&(o=e.DefaultIndices),void 0===a&&(a=e.DefaultOffsets),void 0===s&&(s="triangle");var l={};for(var c in t){var u=t[c],p=u.size;l[c]={data:u.data,size:p,offsetIdx:0,strideIdx:p}}if(o===e.DefaultIndices){var d=function(e){var t=i.getFirstObjectValue(e);return null==t?0:t.data.length/t.size}(l),h=r.generateDefaultIndexArray(d);for(var f in o={},l)o[f]=h}this._id=r.getNewId(),this._vertexAttributes=l,this._indices=o,this._componentOffsets=n.createOffsets(a),this._primitiveType=s}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){var e=i.getFirstObjectValue(this._indices);return null==e?0:e.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0}),e.prototype.getVertexAttr=function(){return this.vertexAttributes},e.prototype.toRenderData=function(){return{id:this._id.toString(),indices:this._indices,vertexAttr:this._vertexAttributes}},e.prototype.getIndices=function(e){return this._indices[e]},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){var e=0;if(this._indices[i.VertexAttrConstants.POSITION]){var t=3;e+=this._indices[i.VertexAttrConstants.POSITION].length*t*4}return this._indices[i.VertexAttrConstants.NORMAL]&&(e+=this._indices[i.VertexAttrConstants.NORMAL].length*(t=3)*4),this._indices[i.VertexAttrConstants.UV0]&&(e+=this._indices[i.VertexAttrConstants.UV0].length*(t=2)*4),this._indices[i.VertexAttrConstants.COLOR]&&(e+=this._indices[i.VertexAttrConstants.COLOR].length*(t=1)*4),e},e.DefaultIndices={},e.DefaultOffsets=new Uint32Array(0),e}();t.GeometryData=o}).apply(null,r))||(e.exports=i)},AvU8:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("2Atf"),n("Gtr7"),n("pcDC"),n("BcWh"),n("LxLY"),n("jBNx"),n("Vx27"),n("1dvD"),n("YX1r"),n("51bw"),n("FXVB"),n("1m5D"),n("W9tT"),n("ab6c"),n("0LE5"),n("Rdxj"),n("lRq4"),n("ZcgO"),n("vA3N"),n("aWgr"),n("mmEe"),n("JjCO"),n("m4lJ"),n("9DjX"),n("ZO6V"),n("ZJC8")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w,S,P,O,M,A,C,D){Object.defineProperty(t,"__esModule",{value:!0});var R=function(e){function t(t){var n=e.call(this,t)||this;return n.hideOnGrab=!1,n.moveOnDrag=!0,n.snapToPointer=!0,n.collisionType={type:"point"},n.collisionPriority=0,n.renderObjects=[],n.autoScaleRenderObjects=!0,n._radius=10,n._worldSized=!1,n._focusMultiplier=2,n._touchMultiplier=2.5,n.interactive=!0,n.selectable=!1,n.cursor=null,n.dragging=!1,n._areAnyEngineObjectsVisible=!1,n.events=new s({target:n}),n._position=b.vec3f64.create(),n._modelTransform=v.mat4f64.create(),n._dragOffset=null,n._dirtyScreenPoint=c.createScreenPoint(),n._dirtyScreenPointArray=c.createScreenPointArray(),n._dirtyRenderScreenPointArray=c.createRenderScreenPointArray3(),n._dirtyOriginScreenPointArray=c.createScreenPointArray(),n._dirtyScreenPixelSize=1,n._screenPositionDirty=!0,n._engineResourcesAddedToStage=!1,n._engineResources=null,n._attached=!1,n._engineLayerId=null,n._materialIdReferences=null,n._hitResult={onSurface:!1,surfaceType:"ground"},n}return r(t,e),t.prototype.initialize=function(){var e=this;this._intersector=new M.Intersector(this.view.viewingMode),this._mapPoint=x.makeDehydratedPoint(0,0,0,this.view.spatialReference),this.events.on("drag",(function(t){return e.drag(t)}))},t.prototype.destroy=function(){this._removeResourcesFromStage(),this._engineResources=null,this._set("view",null),this._camera=null},Object.defineProperty(t.prototype,"alignment",{get:function(){return this._get("alignment")},set:function(e){this._set("alignment",e),this.constructed&&this._refreshMapPoint()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{set:function(e){e!==this._get("visible")&&(this._set("visible",e),this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"worldSized",{get:function(){return this._worldSized},set:function(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focusMultiplier",{get:function(){return this._focusMultiplier},set:function(e){this._focusMultiplier=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchMultiplier",{get:function(){return this._touchMultiplier},set:function(e){this._touchMultiplier=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"modelTransform",{get:function(){return this._modelTransform},set:function(e){T(e)&&(this._screenPositionDirty=!0),f.mat4.copy(this._modelTransform,e),this._updateEngineObject()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._mapPoint,this._mapPoint.spatialReference),this._refreshMapPoint()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mapPoint",{get:function(){return this._mapPoint},set:function(e){x.clonePoint(e,this._mapPoint),this._refreshMapPoint()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grabbing",{set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateEngineObject()),e||(this._dragOffset=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hovering",{set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{set:function(e){e!==this._get("state")&&(this._set("state",e),this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"areAnyEngineObjectsVisible",{get:function(){return this._areAnyEngineObjectsVisible},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"surfaceType",{get:function(){return this._hitResult.onSurface?this._hitResult.surfaceType:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"screenPoint",{get:function(){return this._updateScreenSpaceProperties(),this._dirtyScreenPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_screenPointArray",{get:function(){return this._updateScreenSpaceProperties(),this._dirtyScreenPointArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_renderScreenPointArray",{get:function(){return this._updateScreenSpaceProperties(),this._dirtyRenderScreenPointArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_originScreenPointArray",{get:function(){return this._updateScreenSpaceProperties(),this._dirtyOriginScreenPointArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_screenPixelSize",{get:function(){return this._updateScreenSpaceProperties(),this._dirtyScreenPixelSize},enumerable:!0,configurable:!0}),t.prototype._updateScreenSpaceProperties=function(){if(this._screenPositionDirty){this._screenPositionDirty=!1,this._dirtyScreenPixelSize=this._camera.computeScreenPixelSizeAt(this._position);var e,t=T(this._modelTransform);if(t){var n=this._calculateModelTransformOffset(k);e=y.vec3.add(n,n,this._position)}else e=this._position;this._camera.projectPoint(e,this._dirtyRenderScreenPointArray),this._camera.renderToScreen(this._dirtyRenderScreenPointArray,this._dirtyScreenPointArray),c.screenPointArrayToObject(this._dirtyScreenPointArray,this._dirtyScreenPoint),t?(this._camera.projectPoint(this._position,I),this._camera.renderToScreen(I,this._dirtyOriginScreenPointArray)):g.vec2.copy(this._dirtyOriginScreenPointArray,this._dirtyScreenPointArray)}},t.prototype.intersectionDistance=function(e,t){if(!this._get("visible"))return null;var n=c.screenPointObjectToArray(e,j),r=this._getCollisionRadius(t),i=-1*this._get("collisionPriority");switch(this.collisionType.type){case"point":if(g.vec2.squaredDistance(this._screenPointArray,n)<r*r)return this._renderScreenPointArray[2]+i;break;case"line":for(var o=this.collisionType.paths,s=this._getWorldToScreenObjectScale(),l=this._calculateObjectTransform(s,F),u=r*this._screenPixelSize,p=S.ray.fromScreen(this._camera,n,L),h=0,f=o;h<f.length;h++)if(0!==(E=f[h]).length)for(var v=y.vec3.transformMat4(G,E[0],l),m=1;m<E.length;m++){var b=y.vec3.transformMat4(H,E[m],l);if(null!=(I=S.lineSegment.closestRayDistance2(S.lineSegment.fromPoints(v,b,V),p))&&I<u*u){var _=y.vec3.add(O.sv3d.get(),v,b);y.vec3.scale(_,_,.5);var x=c.castRenderScreenPointArray(O.sv3d.get());return this._camera.projectPoint(_,x),x[2]+i}y.vec3.copy(v,b)}break;case"disc":var w=this.collisionType.direction,P=(s=this._getWorldToScreenObjectScale(),l=this._calculateObjectTransform(s,F),u=r*this._screenPixelSize,p=S.ray.fromScreen(this._camera,n,L),d.mat3.fromMat4(z,l)),M=y.vec3.transformMat3(q,w,P),A=this._calculateModelTransformPosition(W);S.plane.fromPositionAndNormal(A,M,U);var C=B;if(S.plane.intersectRay(U,p,C)&&y.vec3.squaredDistance(C,A)<u*u)return this._renderScreenPointArray[2]+i;break;case"ribbon":var D=this.collisionType;if(o=D.paths,w=D.direction,s=this._getWorldToScreenObjectScale(),l=this._calculateObjectTransform(s,F),u=r*this._camera.computeScreenPixelSizeAt(this._position),p=S.ray.fromScreen(this._camera,n,L),P=d.mat3.fromMat4(z,l),M=y.vec3.transformMat3(q,w,P),A=this._calculateModelTransformPosition(W),S.plane.fromPositionAndNormal(A,M,U),!S.plane.intersectRay(U,p,C=B))break;for(var R=0,T=o;R<T.length;R++){var E;if(0!==(E=T[R]).length)for(v=y.vec3.transformMat4(G,E[0],l),m=1;m<E.length;m++){var I;if(b=y.vec3.transformMat4(H,E[m],l),null!=(I=S.lineSegment.distance2(S.lineSegment.fromPoints(v,b,V),C))&&I<u*u)return _=y.vec3.add(O.sv3d.get(),v,b),y.vec3.scale(_,_,.5),x=c.castRenderScreenPointArray(O.sv3d.get()),this._camera.projectPoint(_,x),x[2]+i;y.vec3.copy(v,b)}}break;default:a.neverReached(this.collisionType)}return null},t.prototype.drag=function(e){if(this.moveOnDrag){var t=c.screenPointObjectToArray(e.screenPoint,j);l.isNone(this._dragOffset)&&this.grabbing&&!this.snapToPointer&&(this._dragOffset=g.vec2.subtract(m.vec2f32.create(),t,this._originScreenPointArray)),l.isSome(this._dragOffset)&&g.vec2.subtract(t,t,this._dragOffset),this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector,"on-the-ground"===this.alignment?E:null);var n=this._intersector.results.min,r=B;n.getIntersectionPoint(r)?(this.position=r,this._hitResult.onSurface=!0,this._hitResult.surfaceType="TerrainRenderer"===n.intersector?"ground":"feature"):this._hitResult.onSurface=!1}},t.prototype.attach=function(e){if(void 0===e&&(e={manipulator3D:{}}),this.view._stage){var t=e.manipulator3D;if(this._engineLayerId=t.engineLayerId,l.isNone(this._engineLayerId)){var n=new C("manipulator-3d",{isPickable:!1});this.view._stage.add(0,n),this.view._stage.addToViewContent([n.id]),this._engineLayerId=n.id,t.engineLayerId=n.id}t.engineLayerReferences=(t.engineLayerReferences||0)+1,this._materialIdReferences=t.materialIdReferences,l.isNone(this._materialIdReferences)&&(this._materialIdReferences=new Map,t.materialIdReferences=this._materialIdReferences),this._camera=this.view.state.camera,this._attached=!0,this._updateEngineObject(),P.canProject(this._mapPoint.spatialReference,this.view.spatialReference)||(this.mapPoint=x.makeDehydratedPoint(0,0,0,this.view.spatialReference))}},t.prototype.detach=function(e){void 0===e&&(e={manipulator3D:{}});var t=e.manipulator3D;t.engineLayerReferences--;var n=0===t.engineLayerReferences;n&&(t.engineLayerId=null),this._removeResourcesFromStage(n),this._engineResources=null,this._engineLayerId=null,this._materialIdReferences=null,this._camera=null,this._attached=!1},t.prototype.onViewChange=function(){this._camera=this.view.state.camera,this._screenPositionDirty=!0,this._updateEngineObject()},t.prototype.onElevationChange=function(e){this.view.renderCoordsHelper.fromRenderCoords(this.position,X,e.spatialReference)&&_.containsPoint(e.extent,X)&&this._refreshMapPoint(!0)},t.prototype._refreshMapPoint=function(e){switch(void 0===e&&(e=!1),this.alignment){case"none":break;case"on-the-ground":var t=w.getElevationAtPoint(this.view.elevationProvider,this.mapPoint,"ground");if(t===this._mapPoint.z&&e)return;this._mapPoint.z=t;break;default:a.neverReached(this.alignment)}this._screenPositionDirty=!0,this._hitResult.onSurface=!1,this.view.renderCoordsHelper.toRenderCoords(this._mapPoint,this._position),this._updateEngineObject()},t.prototype._updateEngineObject=function(){if(this._areAnyEngineObjectsVisible=!1,this._attached)if(!1!==this._get("visible")){var e=this._getWorldToScreenObjectScale(),t=F;if(!0===this._get("autoScaleRenderObjects")){var n=this._getFocusedSize(this._radius,this._focused)*e;this._calculateObjectTransform(n,t)}else this._calculateObjectTransform(e,t);for(var r=this._ensureEngineResources().objectsByState,i=(this._focused?2:1)|(this._get("selected")?8:4),o=this._get("hideOnGrab")&&this._get("grabbing"),a=0,s=r;a<s.length;a++){var l=s[a],c=l.stateMask,u=l.objects;if(o)for(var p=0,d=u;p<d.length;p++)(b=d[p]).hide();else{var h=!(0!=(15&c))||(i&c)==(15&c),f=!(0!=(65520&c))||(this._get("state")&c)==(65520&c);if(h&&f)for(var v=0,g=u;v<g.length;v++)(b=g[v]).unhide(),b.objectTransformation=t,this._areAnyEngineObjectsVisible=!0;else for(var m=0,y=u;m<y.length;m++){var b;(b=y[m]).hide()}}}}else this._removeResourcesFromStage()},t.prototype._ensureEngineResources=function(){if(l.isNone(this._engineResources)){var e=this.view._stage.getContent(0,l.expect(this._engineLayerId)),t=[],n=new Set;this.renderObjects.forEach((function(e){var r=e.material;n.has(r)||(t.push(r),n.add(r))}));var r=new Map;this.renderObjects.forEach((function(e){var t=new D({idHint:"manipulator"});!function(e,t){var n=t.geometry,r=t.material,i=t.transform;Array.isArray(n)?n.forEach((function(t){return e.addGeometry(t,r,i)})):e.addGeometry(n,r,i)}(t,e);var n=e.stateMask||0,i=r.get(n)||[];i.push(t),r.set(n,i)}));var i=[];r.forEach((function(e,t){i.push({stateMask:t,objects:e})})),this._engineResources={objectsByState:i,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources},t.prototype._addResourcesToStage=function(){var e=this;if(!this._engineResourcesAddedToStage&&!l.isNone(this._engineResources)){var t=this._engineResources,n=t.objectsByState,r=t.layer;t.materials.forEach((function(t){var n=l.expect(e._materialIdReferences),r=n.get(t.id)||0;0===r&&e.view._stage.add(3,t),n.set(t.id,r+1)})),n.forEach((function(t){t.objects.forEach((function(t){r.addObject(t),e.view._stage.add(1,t)}))})),this._engineResourcesAddedToStage=!0}},t.prototype._removeResourcesFromStage=function(e){var t=this;if(void 0===e&&(e=!1),this._engineResourcesAddedToStage&&!l.isNone(this._engineResources)){var n=this._engineResources,r=n.layer,i=n.materials;n.objectsByState.forEach((function(e){e.objects.forEach((function(e){r.removeObject(e),t.view._stage.remove(1,e.id)}))})),i.forEach((function(e){var n=l.expect(t._materialIdReferences),r=n.get(e.id);1===r?(t.view._stage.remove(3,e.id),n.delete(e.id)):n.set(e.id,r-1)})),e&&this.view._stage.remove(0,r.id),this._engineResourcesAddedToStage=!1}},t.prototype._getCollisionRadius=function(e){return this._getFocusedSize(this._radius,!0)*("touch"===e?this._touchMultiplier:1)},t.prototype._getFocusedSize=function(e,t){return e*(t?this._focusMultiplier:1)},t.prototype._getWorldToScreenObjectScale=function(){return this._worldSized?1:this._screenPixelSize},t.prototype._calculateModelTransformPosition=function(e){var t=this._getWorldToScreenObjectScale(),n=this._calculateObjectTransform(t,N);return y.vec3.set(e,n[12],n[13],n[14])},t.prototype._calculateModelTransformOffset=function(e){var t=this._calculateModelTransformPosition(e);return y.vec3.subtract(e,t,this._position)},t.prototype._calculateObjectTransform=function(e,t){return f.mat4.set(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),f.mat4.multiply(t,t,this._modelTransform),t[12]+=this._position[0],t[13]+=this._position[1],t[14]+=this._position[2],t[15]=1,t},n([u.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n([u.property({value:"none",nonNullable:!0})],t.prototype,"alignment",null),n([u.property()],t.prototype,"hideOnGrab",void 0),n([u.property()],t.prototype,"moveOnDrag",void 0),n([u.property()],t.prototype,"snapToPointer",void 0),n([u.property()],t.prototype,"collisionType",void 0),n([u.property({type:p.Integer})],t.prototype,"collisionPriority",void 0),n([u.property({constructOnly:!0})],t.prototype,"renderObjects",void 0),n([u.property()],t.prototype,"autoScaleRenderObjects",void 0),n([u.property({value:!0})],t.prototype,"visible",null),n([u.property()],t.prototype,"radius",null),n([u.property()],t.prototype,"worldSized",null),n([u.property()],t.prototype,"focusMultiplier",null),n([u.property()],t.prototype,"touchMultiplier",null),n([u.property()],t.prototype,"interactive",void 0),n([u.property()],t.prototype,"selectable",void 0),n([u.property()],t.prototype,"cursor",void 0),n([u.property({value:!1})],t.prototype,"grabbing",null),n([u.property()],t.prototype,"dragging",void 0),n([u.property({value:!1})],t.prototype,"hovering",null),n([u.property({value:!1})],t.prototype,"selected",null),n([u.property({value:0})],t.prototype,"state",null),n([u.property({dependsOn:["hovering","grabbing"]})],t.prototype,"focused",null),n([u.subclass("esri.views.interactive.Manipulator3D")],t)}(u.declared(o));function T(e){return 0!==e[12]||0!==e[13]||0!==e[14]}t.Manipulator3D=R;var E={include:new Set};E.include.add(A.TERRAIN_ID);var j=c.createScreenPointArray(),I=c.createRenderScreenPointArray3(),V=S.lineSegment.create(),L=S.ray.create(),z=h.mat3f64.create(),N=v.mat4f64.create(),F=v.mat4f64.create(),U=S.plane.create(),G=b.vec3f64.create(),H=b.vec3f64.create(),B=b.vec3f64.create(),q=b.vec3f64.create(),W=b.vec3f64.create(),k=b.vec3f64.create(),X=b.vec3f64.create()}).apply(null,r))||(e.exports=i)},BhkK:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("xhoE"),n("Q2wQ"),n("HZ3d"),n("eIBl"),n("XwIv"),n("H1tY"),n("LxLY"),n("Fe95"),n("48/q"),n("6hC7"),n("yjgM"),n("pvGl")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=function(e){function t(t){var n=e.call(this)||this;n._handles=new a,n._angleDeferred=null,n._interactive=!0;var r=t.tool,i=t.view,o=t.snapToScene,s=t.radius;return n._view=i,n.xyManipulation=new h.MoveXYDiscManipulation({tool:r,view:i,snapToScene:o,radius:s}),n.xyAxisManipulation=new d.MoveXYAxisManipulation({tool:r,view:i,radius:s}),n.zManipulation=new f.MoveZManipulation({tool:r,view:i,radius:s}),n.xyManipulation.available=t.xyAvailable,n.xyAxisManipulation.available=t.xyAxisAvailable,n.zManipulation.available=t.zAvailable,n.autoHideXYAxis(),n.forEachManipulator((function(e){n._handles.add(e.events.on("grab-changed",(function(){return n.updateManipulatorInteractivity()})))})),n}return r(t,e),t.prototype.destroy=function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()},t.prototype.createGraphicDragPipeline=function(e,t){return s.handlesGroup([this.xyManipulation.createGraphicDragPipeline(e,t),this.xyAxisManipulation.createGraphicDragPipeline(e,t),this.zManipulation.createGraphicDragPipeline(e,t)])},t.prototype.createDragPipeline=function(e,t,n){return s.handlesGroup([this.xyManipulation.createDragPipeline(e,t,n),this.xyAxisManipulation.createDragPipeline(e,t,n),this.zManipulation.createDragPipeline(e,n)])},Object.defineProperty(t.prototype,"snapToScene",{set:function(e){this.xyManipulation.snapToScene=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angle",{set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angleDeferred",{set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"interactive",{set:function(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayScale",{set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e},enumerable:!0,configurable:!0}),t.prototype.forEachManipulator=function(e){this.xyManipulation.forEachManipulator((function(t){return e(t,1)})),this.xyAxisManipulation.forEachManipulator((function(t){return e(t,1)})),this.zManipulation.forEachManipulator((function(t){return e(t,0)}))},Object.defineProperty(t.prototype,"xyAxisVisible",{get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e},enumerable:!0,configurable:!0}),t.prototype.autoHideXYAxis=function(){var e=this,t=this.xyAxisManipulation,n=this.xyManipulation;if(!l("esri-mobile")){var r=[];n.forEachManipulator((function(e){return r.push(e)})),t.forEachManipulator((function(e){return r.push(e)}));for(var i=function(){var n=[];e.xyAxisVisible?c.isSome(e._angleDeferred)&&(e.angle=e._angleDeferred()):t.forEachManipulator((function(e){return n.push(e.disableDisplay())})),e._handles.remove(g),e._handles.add(n,g)},o=0,a=r;o<a.length;o++)this._handles.add(a[o].events.on("focus-changed",i));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",i)),i()}},t.prototype.updateManipulatorInteractivity=function(){var e=this,t=this.grabbing;this.forEachManipulator((function(n){n.interactive=!t&&e._interactive||n.grabbing}))},t.radiusForSymbol=function(e){var t=c.isSome(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((function(e){return"icon"===e.type}))?u.DISC_RADIUS_SMALL:u.DISC_RADIUS},t}(p.Manipulation);t.MoveManipulation=v;var g="disable-xy-axis-display"}).apply(null,r))||(e.exports=i)},BwdQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("LxLY"),n("FXVB"),n("1m5D"),n("DIqE"),n("Rdxj"),n("2fXB"),n("O7NG"),n("WRgd"),n("lRq4"),n("0FS0"),n("ZPQp"),n("ZcgO"),n("mmEe")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v){function g(e){var t=e.paths[0];if(!t||0===t.length)return null;var n=h.getPointOnPath(t,h.getPathLength(t)/2);return f.makeDehydratedPoint(n[0],n[1],n[2],e.spatialReference)}function m(e,t,n){var r=n?e:f.clonePoint(e);return t&&e?v.pointToPoint(e,r,t)?r:null:r}function y(e){if(Array.isArray(e)){for(var t=0,n=e;t<n.length;t++)if(!y(n[t]))return!1;return!0}return null==e||e>=0}Object.defineProperty(t,"__esModule",{value:!0}),t.computeCentroid=function(e,t){if("point"===e.type)return m(e,t,!1);if(f.isHydratedGeometry(e))switch(e.type){case"extent":return m(e.center,t,!1);case"polygon":return m(e.centroid,t,!1);case"polyline":return m(g(e),t,!0);case"mesh":return m(e.extent.center,t,!1)}else switch(e.type){case"extent":return m(function(e){var t=n.isFinite(e.zmin);return f.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return m(function(e){var t=e.rings[0];if(!t||0===t.length)return null;var n=d.ringsCentroid(e.rings,e.hasZ);return f.makeDehydratedPoint(n[0],n[1],n[2],e.spatialReference)}(e),t,!0);case"polyline":return m(g(e),t,!0)}},t.enlargeExtent=function(e,t,n){if(e){t||(t=p.create());var r=.5*e.width*(n-1),i=.5*e.height*(n-1);return e.width<1e-7*e.height?r+=i/20:e.height<1e-7*e.width&&(i+=r/20),l.vec4.set(t,e.xmin-r,e.ymin-i,e.xmax+r,e.ymax+i),t}return null},t.updateVertexAttributeAuxpos1w=function(e,t){for(var n=0;n<e.geometries.length;++n){var r=e.geometries[n].data.vertexAttributes.auxpos1;r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(n))}},t.mixinColorAndOpacity=function(e,t){var n=c.vec4f64.clone(c.vec4f64.ONES);return r.isSome(e)&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),r.isSome(t)?n[3]=t:r.isSome(e)&&e.length>3&&(n[3]=e[3]),n},t.overrideColor=function(e,t,n,i,o,a){void 0===a&&(a=[0,0,0,0]);for(var s=0;s<3;++s)a[s]=r.isSome(e)&&null!=e[s]?e[s]:r.isSome(n)&&null!=n[s]?n[s]:o[s];return a[3]=r.isSome(t)?t:r.isSome(i)?i:o[3],a},t.computeObjectScale=function(e,t,n,r){void 0===e&&(e=s.vec3f64.ONES),void 0===r&&(r=1);var i=new Array(3);if(null==t||null==n)i[0]=1,i[1]=1,i[2]=1;else{for(var o=void 0,a=0,l=2;l>=0;l--){var c=e[l],u=void 0,p=null!=c,d=n[l];"symbol-value"===c||0===l&&!o&&!p?u=0!==d?t[l]/d:1:p&&"proportional"!==c&&isFinite(c)&&(u=0!==d?c/d:1),null!=u&&(i[l]=u,o=u,a=Math.max(a,Math.abs(u)))}for(l=2;l>=0;l--)null==i[l]?i[l]=o:0===i[l]&&(i[l]=.001*a)}for(l=2;l>=0;l--)i[l]/=r;return s.vec3f64.fromArray(i)},t.computeSizeWithResourceSize=function(e,t){var n=t.width,r=t.depth,i=t.height,o=t.isPrimitive?10:1;if(null==n&&null==i&&null==r)return[o*e[0],o*e[1],o*e[2]];for(var a,l=s.vec3f64.fromValues(n,r,i),c=0;c<3;c++){var u=l[c];if(null!=u){a=u/e[c];break}}for(c=0;c<3;c++)null==l[c]&&(l[c]=e[c]*a);return l},t.validateSymbolLayerSize=function(e){return null!=e.isPrimitive&&(e=[e.width,e.depth,e.height]),y(e)?null:"Symbol sizes may not be negative values"},t.isValidSize=y,t.computeObjectRotation=function(e,t,n,r){void 0===r&&(r=o.mat4f64.create());var a=e||0,s=t||0,l=n||0;return 0!==a&&i.mat4.rotateZ(r,r,-a/180*Math.PI),0!==s&&i.mat4.rotateX(r,r,s/180*Math.PI),0!==l&&i.mat4.rotateY(r,r,l/180*Math.PI),r},t.demResolutionForBoundingBox=function(e,t){return null!=t.minDemResolution?t.minDemResolution:u.isPoint(e)?t.minDemResolutionForPoints:.01*u.maximumDimension(e)},t.namedAnchorToHUDMaterialAnchorPos={"bottom-left":a.vec2f64.fromValues(0,0),bottom:a.vec2f64.fromValues(.5,0),"bottom-right":a.vec2f64.fromValues(1,0),left:a.vec2f64.fromValues(0,.5),center:a.vec2f64.fromValues(.5,.5),right:a.vec2f64.fromValues(1,.5),"top-left":a.vec2f64.fromValues(0,1),top:a.vec2f64.fromValues(.5,1),"top-right":a.vec2f64.fromValues(1,1)}}).apply(null,r))||(e.exports=i)},CP88:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("2Atf"),n("tUyH"),n("v22c"),n("s6rJ"),n("hsRy")],void 0===(i=(function(e,t,n,r,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return n(t,e),t.prototype.updateParameters=function(){this.params=a.copyParameters(this.material.getParameters()),this.technique=this.techniqueRep.acquireAndReleaseExisting(o.WaterTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){if(2===this.output)return 22===e;if(5===this.output)return null==e;var t=3;return this.params.transparent&&(t=this.params.writeDepth?5:8),e===t},t.prototype.setElapsedTimeUniform=function(e){e.setUniform1f("timeElapsed",.001*this.material.animation.time*this.params.animationSpeed)},t.prototype._updateShadowState=function(e){e.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:e.shadowMappingEnabled}),this.updateParameters())},t.prototype.ensureResources=function(e){return s.waterTextureRepo.ready()||s.waterTextureRepo.loading()||s.waterTextureRepo.initialize(e),s.waterTextureRepo.ready()?2:1},t.prototype.ensureParameters=function(e){0===this.output&&this._updateShadowState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.params),2!==this.output&&0!==this.output||(s.waterTextureRepo.bindRepo(e),this.setElapsedTimeUniform(this.technique.program))},t}(i.GLMaterial);t.WaterGLMaterial=l}).apply(null,r))||(e.exports=i)},CqfC:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("vJh7")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.mat2=n}).apply(null,r))||(e.exports=i)},"Cvn+":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("SyoC"),n("0LE5"),n("W0kZ")],void 0===(i=(function(e,t,n,r,i){return function(){function e(t,n,r,i,o,a){this.id=e._idGen.gen(t&&t.id),this.geometry=t,this.material=n,this.transformation=r,this.instanceParameters=i,this.origin=o,this.shaderTransformation=a}return e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation},e.prototype.computeAttachmentOrigin=function(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(r.vec3.transformMat4(e,e,this.getStaticTransformation()),!0)},e._idGen=new i.IdGen,e.pool=new n(e,!0),e}()}).apply(null,r))||(e.exports=i)},DFuO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("fese"),n("3kdR"),n("6t3m"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,o,a,s){var l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new s.ShaderBuilder;return t.include(i.Transform,{linearDepth:!1}),t.include(o.VertexColor,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(a.glsl(l||(l=n(["\n    void main(void) {\n      vpos = (model * vec4(position, 1.0)).xyz;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "],["\n    void main(void) {\n      vpos = (model * vec4(position, 1.0)).xyz;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])))),t.include(r.Slice,e),t.fragment.uniforms.add("eColor","vec4"),t.fragment.code.add(a.glsl(c||(c=n(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n    }\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n    }\n    "])),e.attributeColor?"gl_FragColor = vColor * eColor;":"gl_FragColor = eColor;")),t}}).apply(null,r))||(e.exports=i)},DKwL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.RgbaFloatEncoding=function(e){var t=r.glsl(i||(i=n(["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT =\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat = 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS = vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0->1 back to 0->255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "],["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT =\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat = 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS = vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0->1 back to 0->255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "])));e.fragment.code.add(t),e.vertex.code.add(t)}}).apply(null,r))||(e.exports=i)},Dk48:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("9opi"),n("qKT0"),n("Gtr7"),n("Vx27")],void 0===(i=(function(e,t,n,r,i,o){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_OUTLINES=!1,t.DECONFLICTOR_SHOW_OUTLINES_INVISIBLE=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_DEBUG_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.TERRAIN_DEBUG_POPUP=!1,t.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,t.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.I3S_TREE_SHOW_TILES=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t.DISABLE_FAST_UPDATES=!1,t.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,t.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,t.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,t}return n(t,e),r([o.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),r([o.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),r([o.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),r([o.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),r([o.property()],t.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0),r([o.property()],t.prototype,"DECONFLICTOR_SHOW_OUTLINES_INVISIBLE",void 0),r([o.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),r([o.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),r([o.property()],t.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),r([o.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),r([o.property()],t.prototype,"TERRAIN_DEBUG_POPUP",void 0),r([o.property()],t.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),r([o.property()],t.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),r([o.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),r([o.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),r([o.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),r([o.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),r([o.property()],t.prototype,"I3S_TREE_SHOW_TILES",void 0),r([o.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),r([o.property()],t.prototype,"DISABLE_FAST_UPDATES",void 0),r([o.property()],t.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),r([o.property()],t.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),r([o.property()],t.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),r([o.subclass("esri.views.3d.support.DebugFlags")],t)}(o.declared(i)))}).apply(null,r))||(e.exports=i)},"E/g4":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,o,a,s,l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.RibbonVertexPosition=function(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(r.glsl(i||(i=n(["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "],["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "]))))):(e.attributes.add("size","float"),e.vertex.code.add(r.glsl(o||(o=n(["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "],["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "]))))),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.defines.addInt("VV_OPACITY_N",8),e.vertex.code.add(r.glsl(a||(a=n(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value <= vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i = 1; i < VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "],["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value <= vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i = 1; i < VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "]))))):e.vertex.code.add(r.glsl(s||(s=n(["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "])))),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.defines.addInt("VV_COLOR_N",8),e.vertex.code.add(r.glsl(l||(l=n(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value <= vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i = 1; i < VV_COLOR_N; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "],["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value <= vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i = 1; i < VV_COLOR_N; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "]))))):(e.attributes.add("color","vec4"),e.vertex.code.add(r.glsl(c||(c=n(["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "])))))}}).apply(null,r))||(e.exports=i)},"EiD/":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultTextureUnits={DIFFUSE:0,NORMAL:1,EMISSION:2,OCCLUSION:3,METALLIC_ROUGHNESS:4,SSAO:6,SHADOW_MAP:7}}).apply(null,r))||(e.exports=i)},EiS2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("qKT0"),n("2Atf"),n("fese"),n("3kdR"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("lfQW"),n("DFuO"),n("G0ER"),n("qbr3")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return n(r,t),r.prototype.initializeProgram=function(e){var t=r.shader.get(),n=this.configuration,i=t.build({attributeColor:n.vertexColors,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new h(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),u.Default3D)},r.prototype.bindPass=function(e,t,n){this.program.setUniform4fv("eColor",t.color)},r.prototype.bindDraw=function(e){a.Transform.bindUniforms(this.program,e),o.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},r.prototype.initializePipeline=function(){var e=this.configuration,t=f.separateBlendingParams(770,1,771,771),n=0===e.output?e.transparent&&t:null,r=function(t){return f.makePipelineState({blending:n,polygonOffset:e.polygonOffset&&g,culling:(r=e.cullFace,0!==r&&{face:1===r?1028:1029,mode:2305}),depthTest:p.depthCompareLess,depthWrite:e.writeDepth&&f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?p.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?t?p.stencilToolMaskBaseParams:p.stencilBaseAllZerosParams:null});var r};return this._occludeeState=r(!0),r(!1)},Object.defineProperty(r.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!0,configurable:!0}),r.shader=new s.ReloadableShaderModule(d,"./ColorMaterial.glsl",e),r}(l.ShaderTechnique);t.ColorMaterialTechnique=v;var g={factor:1,units:1},m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.vertexColors=!1,t.transparent=!1,t.polygonOffset=!1,t.writeDepth=!0,t.sceneHasOcludees=!1,t}return n(t,e),r([c.parameter({count:7})],t.prototype,"output",void 0),r([c.parameter({count:3})],t.prototype,"cullFace",void 0),r([c.parameter()],t.prototype,"slicePlaneEnabled",void 0),r([c.parameter()],t.prototype,"sliceHighlightDisabled",void 0),r([c.parameter()],t.prototype,"vertexColors",void 0),r([c.parameter()],t.prototype,"transparent",void 0),r([c.parameter()],t.prototype,"polygonOffset",void 0),r([c.parameter()],t.prototype,"writeDepth",void 0),r([c.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(c.ShaderTechniqueConfiguration);t.ColorMaterialTechniqueConfiguration=m}).apply(null,r))||(e.exports=i)},EyQ4:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qsST"),n("xoE+"),n("Zp3t")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=n.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function a(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var s=a("DXT1"),l=a("DXT3"),c=a("DXT5");function u(e,t){var n=new Int32Array(e,0,31);if(542327876!==n[0])return o.error("Invalid magic number in DDS header"),null;if(!(4&n[20]))return o.error("Unsupported format, must contain a FourCC code"),null;var i,a,u,p=n[21];switch(p){case s:i=8,a=33776;break;case l:i=16,a=33778;break;case c:i=16,a=33779;break;default:return o.error("Unsupported FourCC code:",(u=p,String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255))),null}var d=1,h=n[4],f=n[3];0==(3&h)&&0==(3&f)||(o.warn("Rounding up compressed texture size to nearest multiple of 4."),h=h+3&-4,f=f+3&-4);var v,g,m=h,y=f;131072&n[2]&&!1!==t&&(d=Math.max(1,n[7])),1===d||r.isPowerOfTwo(h)&&r.isPowerOfTwo(f)||(o.warn("Ignoring mipmaps of non power of two sized compressed texture."),d=1);for(var b=n[1]+4,_=[],x=0;x<d;++x)g=(h+3>>2)*(f+3>>2)*i,v=new Uint8Array(e,b,g),_.push(v),b+=g,h=Math.max(1,h>>1),f=Math.max(1,f>>1);return{textureData:{type:"compressed",levels:_},internalFormat:a,width:m,height:y}}t.createDDSTexture=function(e,t,n,r){var o=u(n,r),a=o.textureData,s=o.internalFormat,l=o.width,c=o.height;t.samplingMode=a.levels.length>1?9987:9729,t.hasMipmap=a.levels.length>1,t.internalFormat=s,t.width=l,t.height=c;var p=new i(e,t,a);return e.bindTexture(p),p},t.createDDSTextureData=u}).apply(null,r))||(e.exports=i)},FLCf:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.makeNewRenderStats=function(){return{triangles:0,drawCalls:0}};var n=function(){function e(){this.materialRenderStats=new Map,this.reset()}return e.prototype.getMaterialRenderStatsObject=function(e){var t=this.materialRenderStats.get(e);return t||this.materialRenderStats.set(e,t={triangles:0,drawCalls:0}),t},e.prototype.getAggregatedStats=function(){var e={materialRenderers:{},total:{triangles:0,drawCalls:0}};return this.materialRenderStats.forEach((function(t,n){e.materialRenderers[n]=t,e.total.drawCalls+=t.drawCalls,e.total.triangles+=t.triangles})),e},e.prototype.reset=function(){this.materialRenderStats.forEach((function(e){e.drawCalls=0,e.triangles=0}))},e}();t.RenderStatsAggregator=n}).apply(null,r))||(e.exports=i)},FNtW:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("W0kZ")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){this.supportsEdges=!1,this._visible=!0,this._renderOccluded=1,this._renderPriority=0,this.id=e._idGen.gen(t)}return e.prototype.dispose=function(){},e.prototype.update=function(e){return!1},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.parametersChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.parametersChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())},enumerable:!0,configurable:!0}),e.prototype.isVisibleInPass=function(e){return!0},e.prototype.isVisible=function(){return this._visible},e.prototype.parametersChanged=function(){n.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)},e._idGen=new r.IdGen,e}();t.Material=i,t.materialPredicate=function(e,t){return e.isVisible()&&e.isVisibleInPass(t.pass)&&0!=(e.renderOccluded&t.renderOccludedMask)}}).apply(null,r))||(e.exports=i)},FQ4r:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){t&&(this._config=function(e){var t=e.__proto__.__configurationParameters||[],n={};n.key=e.key;for(var r=0,i=t;r<i.length;r++){var o=i[r];n[o]=e[o]}return n}(t)),this._program=this.initializeProgram(e),e.commonUniformStore&&(this._commonUniformStore=e.commonUniformStore,this._commonUniformStore.subscribeProgram(this._program)),this._pipeline=this.initializePipeline(e)}return e.prototype.dispose=function(){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose(),this._program=null)},e.prototype.reload=function(e){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose()),this._program=this.initializeProgram(e),this._commonUniformStore&&this._commonUniformStore.subscribeProgram(this._program)},Object.defineProperty(e.prototype,"program",{get:function(){return this._program},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pipeline",{get:function(){return this._pipeline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._config.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"configuration",{get:function(){return this._config},enumerable:!0,configurable:!0}),e.prototype.bindPass=function(e,t,n){},e.prototype.bindMaterial=function(e,t,n){},e.prototype.bindDraw=function(e,t,n){},e.prototype.bindInstance=function(e){},e.prototype.bindPipelineState=function(e){e.setPipelineState(this.pipeline)},e.prototype.ensureAttributeLocations=function(e){this.program.assertCompatibleVertexAttributeLocations(e)},Object.defineProperty(e.prototype,"primitiveType",{get:function(){return 4},enumerable:!0,configurable:!0}),e}();t.ShaderTechnique=n}).apply(null,r))||(e.exports=i)},FU3N:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qsST"),n("LxLY"),n("dl/g"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o){var a=n.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),s=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,o.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}();return function(){function e(e,t,n){this._textureRep=e,this._techniqueRep=t,this.onMaterialChanged=n,this._id2glMaterialRef=new Map}return e.prototype.acquire=function(e,t){this.ownMaterial(e);var n,r=i.getShaderOutputID(e.id,t),o=this._id2glMaterialRef.get(r);return null==o?(n=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t}),o=new s(n),this._id2glMaterialRef.set(r,o)):n=o.getGLMaterial(),o.incRefCnt(),n},e.prototype.release=function(e,t){var n=i.getShaderOutputID(e.id,t),r=this._id2glMaterialRef.get(n);if(r.decRefCnt(),0===r.getRefCnt()){var o=r.getGLMaterial();o&&o.dispose(),this._id2glMaterialRef.delete(n)}},e.prototype.materialChanged=function(e){for(var t=0,n=i.ShaderOutputTypes;t<n.length;t++){var r=n[t];if(5!==r.output&&6!==r.output){var o=this._id2glMaterialRef.get(i.getShaderOutputID(e.id,r.output));if(o&&o.getGLMaterial()){var a=o.getGLMaterial();a.updateParameters&&a.updateParameters()}}}this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.ownMaterial=function(e){r.isSome(e.materialRepository)&&e.materialRepository!==this&&a.error("Material is already owned by a different material repository"),e.materialRepository=this},e}()}).apply(null,r))||(e.exports=i)},FbvD:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("DJpR")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.cache=new Map}return e.prototype.dispose=function(){this.cache.forEach((function(e){n.isSome(e.texture)&&(e.texture.dispose(),e.texture=null)})),this.cache.clear()},e.prototype.acquire=function(e){if(n.isNone(e))return null;var t=this.patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;var o=this.patternToTextureData(e,2),a=o.length/2,s={refCount:1,texture:null,bind:function(e,t){return n.isNone(s.texture)&&(s.texture=new r.Texture(e,{width:o.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},o)),e.bindTexture(s.texture,t),a}};return this.cache.set(t,s),s.bind},e.prototype.release=function(e){if(!n.isNone(e)){var t=this.patternId(e),r=this.cache.get(t);r&&(r.refCount--,0===r.refCount&&(n.isSome(r.texture)&&r.texture.dispose(),this.cache.delete(t)))}},e.prototype.swap=function(e,t){var n=this.acquire(t);return this.release(e),n},e.prototype.bind=function(e,t,r,i,o){var a=n.isSome(i)?i(e,o)*t.pixelRatio:1;r.setUniform1i("stipplePatternTexture",o),r.setUniform1f("stipplePatternPixelSizeInv",1/a)},e.prototype.patternId=function(e){return e.join(",")},e.prototype.patternToTextureData=function(e,t){for(var n=e.reduce((function(e,t){return e+t}))*t,r=new Uint8Array(n),i=!0,o=0,a=0,s=e;a<s.length;a++){for(var l=s[a],c=0;c<l*t;c++)r[o++]=i?255:0;i=!i}return r},e}();t.StippleTextureRepository=i,t.createStipplePattern=function(e){return n.isNone(e)?e:e.slice()},t.createStipplePatternSimple=function(e){return[e,e]}}).apply(null,r))||(e.exports=i)},Fe95:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HANDLE_COLOR=[1,.5,0],t.GEOMETRY_SEGMENTS=128,t.DISC_RADIUS=70,t.DISC_COLLISION_RADIUS=80,t.DISC_HEIGHT=.02,t.DISC_TRANSLATE_ARROW_SIZE=54,t.DISC_TRANSLATE_ARROW_OFFSET=100,t.DISC_RADIUS_SMALL=Math.ceil(t.DISC_RADIUS/3*2),t.RING_RADIUS=160,t.RING_HEIGHT=.5,t.RING_THICKNESS=24,t.INDICATOR_THICKNESS=9,t.INNER_INDICATOR_RADIUS=t.RING_RADIUS+30,t.OUTER_INDICATOR_RADIUS=t.RING_RADIUS+53,t.ROTATE_INDICATOR_ARROW_TIP_LENGTH=60,t.ROTATE_INDICATOR_ARROW_TIP_RADIUS=23,t.ROTATE_INDICATOR_ARC_LENGTH=5*Math.PI/12,t.SCALE_INDICATOR_ARC_LENGTH=1*Math.PI/3,t.DRAG_THRESHOLD_PX=10,t.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE=.2,t.SCALE_INDICATOR_OFFSET1=30,t.SCALE_INDICATOR_OFFSET2=53,t.SCALE_INDICATOR_DIRECTION_BUFFER=.2,t.ROTATE_INDICATOR_DIRECTION_BUFFER=.3,t.RING_INDICATOR_DELAY_MS=200,t.RING_RESET_ANIMATION_SPEED_FACTOR=3,t.ALIGN_ARROWS_SCALE_THRESHOLD=1e6}).apply(null,r))||(e.exports=i)},"G+tB":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("PLh7"),n("uinn")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=function(e){switch(n.expect(e.graphic.geometry).type){case"point":return i.createVisualElements(e);case"polygon":case"polyline":return r.createVisualElements(e);default:return null}}}).apply(null,r))||(e.exports=i)},GDWR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("KY0m")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._uniforms={proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}return e.prototype.dispose=function(){this._uniforms=null},e.prototype.getPrograms=function(e){return this._uniforms[e]||[]},e.prototype.subscribeProgram=function(e){for(var t in this._uniforms)e.hasUniform(t)&&this._uniforms[t].push(e)},e.prototype.unsubscribeProgram=function(e){for(var t in this._uniforms)n.removeUnordered(this._uniforms[t],e)},e}();t.CommonUniformStore=r}).apply(null,r))||(e.exports=i)},HbaO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("O7NG")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultIconElevationOffset=1,t.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2,t.TRANSPARENT_UNIT=n.vec4f64.ZEROS,t.WHITE_UNIT=n.vec4f64.ONES}).apply(null,r))||(e.exports=i)},ILj8:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("VfPl"),n("CIy2")],void 0===(i=(function(e,t,n,r){function i(e,t,n,r,i){var o=n.typedBuffer,a=n.typedBufferStride,s=e.length;if(r*=a,null==i||1===i)for(var l=0;l<s;++l){var c=2*e[l];o[r]=t[c],o[r+1]=t[c+1],r+=a}else for(l=0;l<s;++l){c=2*e[l];for(var u=0;u<i;++u)o[r]=t[c],o[r+1]=t[c+1],r+=a}}function o(e,t,n,r,i){var o=n.typedBuffer,a=n.typedBufferStride,s=e.length;if(r*=a,null==i||1===i)for(var l=0;l<s;++l){var c=3*e[l];o[r]=t[c],o[r+1]=t[c+1],o[r+2]=t[c+2],r+=a}else for(l=0;l<s;++l){c=3*e[l];for(var u=0;u<i;++u)o[r]=t[c],o[r+1]=t[c+1],o[r+2]=t[c+2],r+=a}}function a(e,t,n,r,i){var o=n.typedBuffer,a=n.typedBufferStride,s=e.length;if(r*=a,null==i||1===i)for(var l=0;l<s;++l){var c=4*e[l];o[r]=t[c],o[r+1]=t[c+1],o[r+2]=t[c+2],o[r+3]=t[c+3],r+=a}else for(l=0;l<s;++l){c=4*e[l];for(var u=0;u<i;++u)o[r]=t[c],o[r+1]=t[c+1],o[r+2]=t[c+2],o[r+3]=t[c+3],r+=a}}function s(e,t,n,r,i,a){if(n){var s=n,l=r.typedBuffer,c=r.typedBufferStride,u=e.length;if(i*=c,null==a||1===a)for(var p=0;p<u;++p){var d=t[v=3*e[p]],h=t[v+1],f=t[v+2];l[i]=s[0]*d+s[4]*h+s[8]*f+s[12],l[i+1]=s[1]*d+s[5]*h+s[9]*f+s[13],l[i+2]=s[2]*d+s[6]*h+s[10]*f+s[14],i+=c}else for(p=0;p<u;++p){d=t[v=3*e[p]];for(var v,g=s[0]*d+s[4]*(h=t[v+1])+s[8]*(f=t[v+2])+s[12],m=s[1]*d+s[5]*h+s[9]*f+s[13],y=s[2]*d+s[6]*h+s[10]*f+s[14],b=0;b<a;++b)l[i]=g,l[i+1]=m,l[i+2]=y,i+=c}}else o(e,t,r,i,a)}function l(e,t,n,r,i,a){if(n){var s=r.typedBuffer,l=r.typedBufferStride,c=e.length,u=n[0],p=n[1],d=n[2],h=n[4],f=n[5],v=n[6],g=n[8],m=n[9],y=n[10],b=Math.abs(1-u*u+h*h+g*g)>1e-5||Math.abs(1-p*p+f*f+m*m)>1e-5||Math.abs(1-d*d+v*v+y*y)>1e-5;if(i*=l,null==a||1===a)for(var _=0;_<c;++_){var x=u*(O=t[P=3*e[_]])+h*(M=t[P+1])+g*(A=t[P+2]),w=p*O+f*M+m*A,S=d*O+v*M+y*A;b&&(C=x*x+w*w+S*S)<.999999&&C>1e-6&&(x/=D=Math.sqrt(C),w/=D,S/=D),s[i+0]=x,s[i+1]=w,s[i+2]=S,i+=l}else for(_=0;_<c;++_){var P,O,M,A,C,D,R=u*(O=t[P=3*e[_]])+h*(M=t[P+1])+g*(A=t[P+2]),T=p*O+f*M+m*A,E=d*O+v*M+y*A;b&&(C=R*R+T*T+E*E)<.999999&&C>1e-6&&(R/=D=Math.sqrt(C),T/=D,E/=D);for(var j=0;j<a;++j)s[i+0]=R,s[i+1]=T,s[i+2]=E,i+=l}}else o(e,t,r,i,a)}function c(e,t,n,r,i,o){var a=r.typedBuffer,s=r.typedBufferStride,l=e.length;if(i*=s,null==o||1===o){if(4===n)for(var c=0;c<l;++c){var u=4*e[c];a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=t[u+3],i+=s}else if(3===n)for(c=0;c<l;++c)a[i]=t[u=3*e[c]],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=255,i+=s}else if(4===n)for(c=0;c<l;++c){u=4*e[c];for(var p=0;p<o;++p)a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=t[u+3],i+=s}else if(3===n)for(c=0;c<l;++c)for(u=3*e[c],p=0;p<o;++p)a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=255,i+=s}Object.defineProperty(t,"__esModule",{value:!0}),t.writeBufferVec2=i,t.writeBufferVec3=o,t.writeBufferVec4=a,t.writeBufferMat3f=function(e,t,n,r){var i=n.typedBuffer,o=n.typedBufferStride,a=e.length;r*=o;for(var s=0;s<a;++s){for(var l=9*e[s],c=0;c<9;++c)i[r+c]=t[l+c];r+=o}},t.writeBufferMat4f=function(e,t,n,r){var i=n.typedBuffer,o=n.typedBufferStride,a=e.length;r*=o;for(var s=0;s<a;++s){for(var l=16*e[s],c=0;c<16;++c)i[r+c]=t[l+c];r+=o}},t.writePosition=s,t.writeNormal=l,t.writeColor=c,t.writeMultipliedColor=function(e,t,n,r,i,o,a){var s=i.typedBuffer,l=i.typedBufferStride,c=e.length;if(o*=l,null==a||1===a){if(4===n)for(var u=0;u<c;++u){var p=4*e[u];s[o]=t[p]*r[0],s[o+1]=t[p+1]*r[1],s[o+2]=t[p+2]*r[2],s[o+3]=t[p+3]*r[3],o+=l}else if(3===n){var d=255*r[3];for(u=0;u<c;++u)s[o]=t[p=3*e[u]]*r[0],s[o+1]=t[p+1]*r[1],s[o+2]=t[p+2]*r[2],s[o+3]=d,o+=l}}else if(4===n)for(u=0;u<c;++u){p=4*e[u];for(var h=0;h<a;++h)s[o]=t[p]*r[0],s[o+1]=t[p+1]*r[1],s[o+2]=t[p+2]*r[2],s[o+3]=t[p+3]*r[3],o+=l}else if(3===n)for(d=255*r[3],u=0;u<c;++u)for(p=3*e[u],h=0;h<a;++h)s[o]=t[p]*r[0],s[o+1]=t[p+1]*r[1],s[o+2]=t[p+2]*r[2],s[o+3]=d,o+=l},t.writeDefaultAttributes=function(e,t,o,u,p,d){for(var h=0,f=t.fieldNames;h<f.length;h++){var v=f[h],g=e.vertexAttr[v],m=e.indices[v];if(g&&m)switch(v){case r.VertexAttrConstants.POSITION:r.assert(3===g.size);var y=p.getField(v,n.BufferViewVec3f);y&&s(m,g.data,o,y,d);break;case r.VertexAttrConstants.NORMAL:r.assert(3===g.size);var b=p.getField(v,n.BufferViewVec3f);b&&l(m,g.data,u,b,d);break;case r.VertexAttrConstants.UV0:r.assert(2===g.size);var _=p.getField(v,n.BufferViewVec2f);_&&i(m,g.data,_,d);break;case r.VertexAttrConstants.REGION:r.assert(4===g.size);var x=p.getField(v,n.BufferViewVec4u16);x&&a(m,g.data,x,d);break;case r.VertexAttrConstants.COLOR:r.assert(3===g.size||4===g.size);var w=p.getField(v,n.BufferViewVec4u8);w&&c(m,g.data,g.size,w,d);break;case r.VertexAttrConstants.SYMBOLCOLOR:r.assert(3===g.size||4===g.size);var S=p.getField(v,n.BufferViewVec4u8);S&&c(m,g.data,g.size,S,d);break;case r.VertexAttrConstants.TANGENT:r.assert(4===g.size);var P=p.getField(v,n.BufferViewVec4f);P&&a(m,g.data,P,d)}}}}).apply(null,r))||(e.exports=i)},IwVr:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultMaskAlphaCutoff=.1,t.symbolAlphaCutoff=.001,t.DiscardOrAdjustAlpha=function(e,t){var l=e.fragment;switch(t.alphaDiscardMode){case 0:l.code.add(r.glsl(i||(i=n(["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "]))));break;case 1:l.code.add(r.glsl(o||(o=n(["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a = 1.0;\n        }\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a = 1.0;\n        }\n      "]))));break;case 2:l.uniforms.add("textureAlphaCutoff","float"),l.code.add(r.glsl(a||(a=n(["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }\n      "]))));break;case 3:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(r.glsl(s||(s=n(["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }\n      "]))))}}}).apply(null,r))||(e.exports=i)},J2BX:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("CIy2")],void 0===(i=(function(e,t,n,r){function i(e,t){for(var n=e,i=new Uint8Array(4*n*n),o=n/2-.5,a=t/2,s=0;s<n;s++)for(var l=0;l<n;l++){var c=l+n*s,u=l-o,p=s-o,d=Math.sqrt(u*u+p*p)-a;r.packFloatRGBA(d=d/e+.5,i,4*c)}return i}function o(e,t){return u(e,t,!1)}function a(e,t){return u(e,t,!0)}function s(e,t){return p(e,t,!1)}function l(e,t){return p(e,t,!0)}function c(e,t){for(var n=new Uint8Array(4*e*e),i=Math.sqrt(1.25),o=(e-t)/2,a=0;a<e;a++)for(var s=0;s<e;s++){var l=a*e+s,c=(s-o)/t,u=(a-o+.75)/t,p=Math.max(-(1*c+-.5*u)/i,(1*(c-1)+-.5*-u)/i,-u)*t/e+.5;r.packFloatRGBA(p,n,4*l)}return n}function u(e,t,n){n&&(t/=Math.SQRT2);for(var i=new Uint8Array(4*e*e),o=0;o<e;o++)for(var a=0;a<e;a++){var s=a-.5*e+.25,l=.5*e-o-.75,c=o*e+a;if(n){var u=(s+l)/Math.SQRT2;l=(l-s)/Math.SQRT2,s=u}var p=Math.max(Math.abs(s),Math.abs(l))-.5*t;r.packFloatRGBA(p=p/e+.5,i,4*c)}return i}function p(e,t,n){n&&(t*=Math.SQRT2);for(var i=.5*t,o=new Uint8Array(4*e*e),a=0;a<e;a++)for(var s=0;s<e;s++){var l=s-.5*e,c=.5*e-a-1,u=a*e+s;if(n){var p=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=p}var d=void 0;d=(d=(l=Math.abs(l))>(c=Math.abs(c))?l>i?Math.sqrt((l-i)*(l-i)+c*c):c:c>i?Math.sqrt(l*l+(c-i)*(c-i)):l)/e+.5,r.packFloatRGBA(d,o,4*u)}return o}Object.defineProperty(t,"__esModule",{value:!0}),t.createType=function(e,t,r){switch(e){case"circle":return i(t,r);case"square":return o(t,r);case"cross":return s(t,r);case"x":return l(t,r);case"kite":return a(t,r);case"triangle":return c(t,r);default:return n.neverReached(e),i(t,r)}},t.createCircle=i,t.createSquare=o,t.createKite=a,t.createCross=s,t.createX=l,t.createTriangle=c}).apply(null,r))||(e.exports=i)},KPBO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dotProduct=function(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n},t.elementwiseProduct=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]*t[r];return n},t.scalarProduct=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]*t;return n},t.add=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]+t[r];return n}}).apply(null,r))||(e.exports=i)},KQg4:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("0W55"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(){var e=new o.ShaderBuilder;return e.include(r.ScreenSpacePass),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(i.glsl(a||(a=n(["\n    void main() {\n      vec4 texColor = texture2D(tex, uv);\n      gl_FragColor = texColor * color;\n    }\n  "],["\n    void main() {\n      vec4 texColor = texture2D(tex, uv);\n      gl_FragColor = texColor * color;\n    }\n  "])))),e}}).apply(null,r))||(e.exports=i)},KRuQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("9opi"),n("qKT0"),n("Vx27")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDisposableMixin=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isDisposed=!1,t}return n(t,e),t.prototype.dispose=function(){for(var e=this.__proto__.__managedDisposables__||[],t=e.length-1;t>=0;t--){var n=e[t];this[n]&&"function"==typeof this[n].dispose&&this[n].dispose(),this[n]=null}this._isDisposed=!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),r([i.subclass("esri.views.3d.webgl-engine.lib.AutoDisposableMixin")],t)}(i.declared(e))};var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),r([i.subclass("esri.views.3d.webgl-engine.lib.AutoDisposable")],t)}(i.declared(t.AutoDisposableMixin((function(){}))));t.AutoDisposable=o,t.autoDispose=function(){return function(e,t){e.__managedDisposables__=e.__managedDisposables__||[],e.__managedDisposables__.push(t)}}}).apply(null,r))||(e.exports=i)},KtQ6:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e){return"h"in e&&"s"in e&&"v"in e}function r(e){return"l"in e&&"a"in e&&"b"in e}function i(e){return"l"in e&&"c"in e&&"h"in e}function o(e){return"x"in e&&"y"in e&&"z"in e}Object.defineProperty(t,"__esModule",{value:!0});var a=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],s=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function l(e,t){var n,r,i=[];if(e[0].length!==t.length)throw"dimensions do not match";var o=e.length,a=e[0].length,s=0;for(n=0;n<o;n++){for(s=0,r=0;r<a;r++)s+=e[n][r]*t[r];i.push(s)}return i}function c(e){var t=[e.r/255,e.g/255,e.b/255].map((function(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)})),n=l(a,t);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function u(e){var t=l(s,[e.x/100,e.y/100,e.z/100]).map((function(e){var t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function p(e){var t=[e.x/95.047,e.y/100,e.z/108.883].map((function(e){return e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29}));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function d(e){var t=e.l,n=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((function(e){return e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)}));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function h(e){return p(c(e))}function f(e){return u(d(e))}function v(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:i(e)?function(e){return u(d(function(e){var t=e.c,n=e.h;return{l:e.l,a:t*Math.cos(n),b:t*Math.sin(n)}}(e)))}(e):r(e)?f(e):o(e)?u(e):n(e)?function(e){var t,n=(e.h+360)%360/60,r=e.v/100*255,i=r*(e.s/100),o=i*(1-Math.abs(n%2-1));switch(Math.floor(n)){case 0:t={r:i,g:o,b:0};break;case 1:t={r:o,g:i,b:0};break;case 2:t={r:0,g:i,b:o};break;case 3:t={r:0,g:o,b:i};break;case 4:t={r:o,g:0,b:i};break;case 5:case 6:t={r:i,g:0,b:o};break;default:t={r:0,g:0,b:0}}return t.r=Math.round(t.r+r-i),t.g=Math.round(t.g+r-i),t.b=Math.round(t.b+r-i),t}(e):void 0}t.toRGB=v,t.toHSV=function(e){return n(e)?e:function(e){var t,n,r,i=e.r,o=e.g,a=e.b,s=Math.max(i,o,a),l=s-Math.min(i,o,a);return r=s,0===l?t=0:s===i?t=(o-a)/l%6:s===o?t=(a-i)/l+2:s===a&&(t=(i-o)/l+4),n=0===l?0:l/r,t<0&&(t+=6),{h:t*=60,s:n*=100,v:r*=100/255}}(v(e))},t.toLAB=function(e){return r(e)?e:h(v(e))},t.toLCH=function(e){return i(e)?e:function(e){return function(e){var t=e.l,n=e.a,r=e.b,i=Math.sqrt(n*n+r*r),o=Math.atan2(r,n);return{l:t,c:i,h:o=o>0?o:o+2*Math.PI}}(p(c(e)))}(v(e))},t.toXYZ=function(e){return o(e)?e:c(v(e))},t.darken=function(e,t){var n=h(e);return n.l*=1-t,f(n)}}).apply(null,r))||(e.exports=i)},Kvb2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("woUR")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return e.prototype.update=function(e){var t=this;this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,i){if(0===i&&(t.zManipulator=e),e instanceof r.Manipulator3D&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),n.isNone(t.firstGrabbedXY)&&e.grabbing&&1===i&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=1,i){case 0:t.grabbingState|=2;break;case 1:t.grabbingState|=4}}))},e}();t.ManipulatorState=i}).apply(null,r))||(e.exports=i)},KwnQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("z4cv")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.mat2f64=n}).apply(null,r))||(e.exports=i)},LZD4:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("2B1V"),n("CIy2"),n("ILj8")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PositionLayout=n.newLayout().vec3f(r.VertexAttrConstants.POSITION),t.PositionUVLayout=n.newLayout().vec3f(r.VertexAttrConstants.POSITION).vec2f(r.VertexAttrConstants.UV0),t.PositionColorLayout=n.newLayout().vec3f(r.VertexAttrConstants.POSITION).vec4u8(r.VertexAttrConstants.COLOR);var o=function(){function e(e){this.vertexBufferLayout=e}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices[r.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,n,r){i.writeDefaultAttributes(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,r)},e}();t.DefaultBufferWriter=o}).apply(null,r))||(e.exports=i)},MCHn:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("2Atf"),n("LxLY"),n("0LE5"),n("Rdxj"),n("aWgr"),n("hX2R"),n("qSzK")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e){this.view=null,this._angleCutoff=c.defaultAngleCutoff,this._style={},this._heightPlane=a.vec3f64.create(),this._heightPlaneEnabled=!1,this._heightPlaneHeight=0,this._intersectsLine=s.lineSegment.create(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneBuffers=null;var t=!0;for(var n in e)n in this?"attached"===n?t=e[n]:this[n]=e[n]:console.error("Cannot set unknown property",n);this.attached=t}return e.prototype.destroy=function(){this.disposeRenderer()},Object.defineProperty(e.prototype,"attached",{get:function(){return!!this.renderer},set:function(e){e?this.ensureRenderer():this.disposeRenderer()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angleCutoff",{get:function(){return this._angleCutoff},set:function(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(e){this._style=e,this.syncStyle()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heightPlane",{get:function(){return this._heightPlaneEnabled?this._heightPlane:null},set:function(e){i.isSome(e)?(o.vec3.copy(this._heightPlane,e),this._heightPlaneEnabled=!0):this._heightPlaneEnabled=!1,this.syncRenderer(),this.syncHeightPlane()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heightPlaneHeight",{get:function(){return this._heightPlaneHeight},set:function(e){e!==this._heightPlaneHeight&&(this._heightPlaneHeight=e,this.syncHeightPlane())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsWorldUpAtLocation",{set:function(e){if(i.isNone(e))this.intersectsLine=null;else{var t=this.view.renderCoordsHelper.worldUpAtPosition(e,p);this.intersectsLine=s.lineSegment.fromValues(e,t),this.intersectsLineInfinite=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLine",{get:function(){return this._intersectsLineEnabled?this._intersectsLine:null},set:function(e){i.isSome(e)?(s.lineSegment.copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineInfinite",{get:function(){return this._intersectsLineInfinite},set:function(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathVerticalPlane",{get:function(){return this._pathVerticalPlaneBuffers},set:function(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncRenderer()},enumerable:!0,configurable:!0}),e.prototype.syncRenderer=function(){this.attached&&(this._intersectsLineEnabled||this._heightPlaneEnabled||i.isSome(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()},e.prototype.ensureRenderer=function(){i.isSome(this.renderer)||(this.renderer=new l.LaserLineRenderer(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightPlane(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))},e.prototype.syncStyle=function(){i.isNone(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))},e.prototype.syncAngleCutoff=function(){i.isNone(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})},e.prototype.syncHeightPlane=function(){i.isNone(this.renderer)||(this.renderer.heightPlaneEnabled=this._heightPlaneEnabled,this._heightPlaneEnabled&&(this.renderer.heightPlanePosition=this._heightPlane,this.renderer.heightPlaneHeight=this._heightPlaneHeight))},e.prototype.syncIntersectsLine=function(){i.isNone(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))},e.prototype.syncIntersectsLineInfinite=function(){i.isNone(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)},e.prototype.syncPathVerticalPlane=function(){i.isNone(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=i.isSome(this._pathVerticalPlaneBuffers),i.isSome(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))},e.prototype.disposeRenderer=function(){i.isSome(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)},e}();t.LaserlineVisualElement=u;var p=a.vec3f64.create()}).apply(null,r))||(e.exports=i)},N78w:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("2Atf"),n("Gtr7"),n("BcWh"),n("qsST"),n("LxLY"),n("jBNx"),n("Vx27"),n("W9tT"),n("0LE5"),n("Rdxj"),n("vtMp"),n("DtIM"),n("dXKx"),n("5ldw"),n("NbdF")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y){Object.defineProperty(t,"__esModule",{value:!0});var b=s.getLogger("esri.views.interactive.GraphicManipulator"),_=function(e){function t(t){var n=e.call(this,t)||this;return n.layer=null,n.interactive=!0,n.selectable=!1,n.dragging=!1,n.cursor=null,n.events=new a({target:n}),n._circleCollisionCache=null,n._graphicSymbolChangedHandle=null,n._originalSymbol=null,n}return r(t,e),Object.defineProperty(t.prototype,"graphic",{set:function(e){"mesh"!==l.get(e.geometry,"type")?(this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()):b.error("Mesh geometries are not supported")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elevationInfo",{get:function(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=v.getGraphicEffectiveElevationMode(this.graphic);return new m({mode:t,offset:e?e.offset:0})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focusedSymbol",{set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grabbing",{set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hovering",{set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)},t.prototype.intersectionDistance=function(e){var t=this._get("graphic");if(!1===t.visible)return null;var n=this._get("focusedSymbol"),r=l.isSome(n)?n:t.symbol,i=t.geometry;if(l.isNone(i))return null;var o=this._get("view");return"2d"===o.type?this._intersectDistance2D(e,o,i,r):this._intersectDistance3D(e,o,t)},t.prototype.attach=function(){this.attachSymbolChanged(),l.isSome(this.layer)&&this.layer.add(this.graphic)},t.prototype.detach=function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),l.isSome(this.layer)&&this.layer.remove(this.graphic)},t.prototype.attachSymbolChanged=function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(function(t){l.isSome(t)&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&l.isSome(e.focusedSymbol)&&(e.graphic.symbol=e.focusedSymbol))}),!0)},t.prototype.detachSymbolChanged=function(){l.isSome(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)},t.prototype._updateGraphicSymbol=function(){this.graphic.symbol=this._focused&&l.isSome(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol},t.prototype._resetGraphicSymbol=function(){this.graphic.symbol=this._originalSymbol},t.prototype._intersectDistance2D=function(e,t,n,r){if(r=r||g.getDefaultSymbol2D(n),l.isNone(r))return null;var i=this._circleCollisionCache;if("point"!==n.type||"simple-marker"!==r.type){var o=y.intersectsDrapedGeometry(e,n,t);return l.isSome(o)?1:null}if(l.isNone(i)||!i.originalPoint.equals(n)){var a=n,s=t.spatialReference;f.canProject(a,s)&&(o=f.project(a,s),i={originalPoint:a.clone(),mapPoint:o,radiusPx:c.pt2px(r.size)},this._circleCollisionCache=i)}if(l.isSome(i)){var u=c.screenPointObjectToArray(e,w),d=t.state.toScreen(S,i.mapPoint.x,i.mapPoint.y),h=i.radiusPx;return p.vec2.squaredDistance(u,d)<h*h?1:null}return null},t.prototype._intersectDistance3D=function(e,t,n){var r=t.toMap(e,{include:[n]});if(!r)return null;var i=x;return t.renderCoordsHelper.toRenderCoords(r,i)?d.vec3.distance(i,t.state.camera.eye):null},n([u.property({constructOnly:!0,nonNullable:!0})],t.prototype,"graphic",null),n([u.property({readOnly:!0,dependsOn:["graphic"]})],t.prototype,"elevationInfo",null),n([u.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n([u.property({value:null})],t.prototype,"focusedSymbol",null),n([u.property({constructOnly:!0})],t.prototype,"layer",void 0),n([u.property()],t.prototype,"interactive",void 0),n([u.property()],t.prototype,"selectable",void 0),n([u.property({value:!1})],t.prototype,"grabbing",null),n([u.property()],t.prototype,"dragging",void 0),n([u.property()],t.prototype,"hovering",null),n([u.property({value:!1})],t.prototype,"selected",null),n([u.property()],t.prototype,"cursor",void 0),n([u.subclass("esri.views.interactive.GraphicManipulator")],t)}(u.declared(o));t.GraphicManipulator=_;var x=h.vec3f64.create(),w=c.createScreenPointArray(),S=c.createScreenPointArray()}).apply(null,r))||(e.exports=i)},NbdF:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("TMur"),n("LxLY"),n("8uEs"),n("/E+R")],void 0===(i=(function(e,t,n,r,i,o){function a(e,t,r,o){var a;if(void 0===o&&(o=new n.Extent),"2d"===r.type)a=t*r.resolution;else if("3d"===r.type){var s=r.basemapTerrain,l=s.overlayManager,c=l?l.overlayPixelSizeInMapUnits(e):1;a=s&&!s.spatialReference.equals(r.spatialReference)?i.getMetersPerUnitForSR(s.spatialReference)/i.getMetersPerUnitForSR(r.spatialReference):t*c}var u=e.x-a,p=e.y-a,d=e.x+a,h=e.y+a,f=r.spatialReference;return o.xmin=Math.min(u,d),o.ymin=Math.min(p,h),o.xmax=Math.max(u,d),o.ymax=Math.max(p,h),o.spatialReference=f,o}Object.defineProperty(t,"__esModule",{value:!0}),t.createQueryGeometry=a,t.intersectsDrapedGeometry=function(e,t,n){var i=n.toMap(e);return r.isNone(i)?null:a(i,o.calculateTolerance(),n,s).intersects(t)?i:null};var s=new n.Extent}).apply(null,r))||(e.exports=i)},NiJV:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("fese"),n("3kdR"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,o,a){var s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new a.ShaderBuilder;return t.include(i.Transform,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("viewNormal","mat4").add("model","mat4").add("modelNormal","mat4"),t.fragment.uniforms.add("color","vec4").add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("position","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewNormal","vec3"),t.varyings.add("vViewDirection","vec3"),t.vertex.code.add(o.glsl(s||(s=n(["\n    void main(void) {\n      vWorldPosition = (model * vec4(position, 1.0)).xyz;\n\n      vec3 worldNormal = (modelNormal * vec4(normal, 1)).xyz;\n      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;\n\n      gl_Position = transformPosition(proj, view, vWorldPosition);\n    }\n  "],["\n    void main(void) {\n      vWorldPosition = (model * vec4(position, 1.0)).xyz;\n\n      vec3 worldNormal = (modelNormal * vec4(normal, 1)).xyz;\n      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;\n\n      gl_Position = transformPosition(proj, view, vWorldPosition);\n    }\n  "])))),t.include(r.Slice,e),t.fragment.code.add(o.glsl(l||(l=n(["\n    void main() {\n      discardBySlice(vWorldPosition);\n\n      vec3 viewNormalNorm = normalize(vViewNormal);\n\n      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\n      vec4 colorWithShading = mix(color, shadedColor, shadingFactor);\n\n      gl_FragColor = highlightSlice(colorWithShading, vWorldPosition);\n    }\n    "],["\n    void main() {\n      discardBySlice(vWorldPosition);\n\n      vec3 viewNormalNorm = normalize(vViewNormal);\n\n      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\n      vec4 colorWithShading = mix(color, shadedColor, shadingFactor);\n\n      gl_FragColor = highlightSlice(colorWithShading, vWorldPosition);\n    }\n    "])))),t}}).apply(null,r))||(e.exports=i)},PLh7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("XwIv"),n("xoE+"),n("LxLY"),n("8MXS"),n("0LE5"),n("Rdxj"),n("DtIM"),n("woUR"),n("Kvb2"),n("X5J5"),n("MCHn"),n("PXiz"),n("R4nD"),n("/NuL")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m){function y(e){return a.isSome(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=function(e){var t=e.view,n=e.graphic,r=new m.GraphicState({graphic:n}),c=[],_=function(e,t,n){var r=e.graphic,o=new g.OutlineVisualElement({view:e.view,geometry:y(r)?r.geometry:null,elevationInfo:u.getGraphicEffectiveElevationInfo(r),attached:!1}),a=function(){o.attached=t.displaying&&h.settings.visualElements.lineGraphics.outlineEnabled};return n.push(h.settings.visualElements.lineGraphics.outline.bindStyle(o),t.watch("displaying",a),h.settings.visualElements.lineGraphics.watch("outlineEnabled",a),t.watch("isDraped",(function(e){return o.isDraped=e})),t.on("changed",(function(){return o.geometry=y(r)?r.geometry:null})),i.destroyHandle(o)),a(),o}(e,r,c);return function(e,t,n,r){var c,g=e.graphic,m=e.view,_=u.getGraphicEffectiveElevationInfo(g),x="on-the-ground"===_.mode||!_.offset&&"absolute-height"!==_.mode,w=new d.ManipulatorState,S=new v.LineVisualElement({view:m,infinite:h.settings.visualElements.zVerticalLine.infiniteType,attached:!1}),P=o.deg2rad(h.settings.visualElements.heightPlaneAngleCutoff),O=new f.LaserlineVisualElement({view:m,attached:!1,angleCutoff:P}),M=(c=null,{remove:i.refHandle((function(){return c})).remove,update:function(e){var t=!1;switch(h.settings.zManipulator.enabled){case"always":t=!0;break;case"not-grab-z":t=!e.grabbingState}t&&a.isSome(c)?(c.remove(),c=null):!t&&a.isNone(c)&&a.isSome(e.zManipulator)&&(c=e.zManipulator.disableDisplay())}}),A=h.settings.visualElements.lineGraphics.shadowStyle.bindStyle(t),C=h.settings.visualElements.pointGraphics.shadowStyle.bindStyle(S),D=h.settings.visualElements.heightPlane.bindStyle(O),R=function(){if(w.update(e),M.update(w),S.infinite=h.settings.visualElements.zVerticalLine.infiniteType,!n.displaying||x&&(n.isDraped||!y(g)||!g.geometry.hasZ))return t.laserlineEnabled=!1,S.attached=!1,void(O.attached=!1);!function(e,t,n){var r=!1;switch(h.settings.visualElements.lineGraphics.shadowEnabled){case"always":r=!0;break;case"grab-xy":r=!!(4&t.grabbingState)}n.updateGlobalAlpha(4&t.grabbingState?h.settings.visualElements.laserlineAlphaMultiplier:1),e.laserlineEnabled=r}(t,w,A),function(e,t,n){var r=!1;switch(h.settings.visualElements.pointGraphics.shadowEnabled){case"always":r=!0;break;case"grab-xy":r=!!(4&t.grabbingState)}if(n.updateGlobalAlpha(4&t.grabbingState?h.settings.visualElements.laserlineAlphaMultiplier:1),r||h.settings.visualElements.zVerticalLine.enabled){e.laserlineEnabled=r;var i=1===t.numSelected?t.firstSelected:t.numSelected>1&&a.isSome(t.firstGrabbedXY)?t.firstGrabbedXY:null;a.isSome(i)?(h.settings.visualElements.zVerticalLine.infinite&&(e.worldDownAtLocation=i.renderLocation),e.attached=!0):e.attached=!1}else e.attached=!1}(S,w,C),function(e,t,n,r,i){var o=!1;switch(h.settings.visualElements.heightPlane.enabled){case"always":o=!0;break;case"grab-z":o=!!(2&r.grabbingState)}if(i.updateGlobalAlpha(2&r.grabbingState?h.settings.visualElements.laserlineAlphaMultiplier:1),o)if(r.numSelected>0){l.vec3.set(b,0,0,0);var s=0;e.forEachManipulator((function(e,t){1===t&&e.selected&&e instanceof p.Manipulator3D&&(l.vec3.add(b,b,e.renderLocation),s++)})),s>0?(n.heightPlane=l.vec3.scale(b,b,1/s),n.attached=!0):n.attached=!1}else{var c=t.attachmentOrigin;a.isSome(c)&&e.view.renderCoordsHelper.toRenderCoords(c,b)?(n.heightPlane=b,n.attached=!0):n.attached=!1}else n.attached=!1}(e,t,O,w,D)};r.push(A,s.init(h.settings.visualElements.lineGraphics,"shadowEnabled",R),n.on("changed",R),n.watch("displaying",R),h.settings.visualElements.zVerticalLine.bindStyle(S),h.settings.visualElements.zVerticalLine.watch(["enabled","infinite"],R),C,h.settings.visualElements.pointGraphics.watch("shadowEnabled",R),h.settings.zManipulator.watch("enabled",R),D,h.settings.visualElements.heightPlane.watch("enabled",R),t.events.on("attachment-origin-changed",R),i.destroyHandle(S),i.destroyHandle(O),M);var T=[],E=function(){i.handlesGroup(T).remove(),T.length=0,e.forEachManipulator((function(e){return T.push(e.events.on("grab-changed",R))})),e.forEachManipulator((function(e){return T.push(e.events.on("select-changed",R))})),R()};E(),r.push(e.onManipulatorsChanged(E),i.refHandle((function(){return i.handlesGroup(T)})))}(e,_,r,c),c.push(t.maskOccludee(n)),c.push(t.trackGraphicState(r)),{visualElement:_,remove:function(){i.handlesGroup(c).remove()}}};var b=c.vec3f64.create()}).apply(null,r))||(e.exports=i)},PXiz:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("2Atf"),n("LxLY"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("j2SP"),n("MCHn"),n("2W+Z"),n("aWgr"),n("fXZm"),n("ys4y"),n("4ziW"),n("RC9r"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m){Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(e){var t=this;this.view=null,this._ray=d.ray.create(),this._isWorldDown=!1,this._start=s.vec3f64.create(),this._end=s.vec3f64.fromValues(1,0,0),this._width=1,this._color=c.vec4f32.fromValues(1,0,1,1),this._innerWidth=1,this._innerColor=c.vec4f32.fromValues(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._infinite=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._occludedMode=4,this.resources=new p.VisualElementResources({view:e.view,cameraChanged:function(){return t.updateGeometry()},createResources:function(e){return t.createResources(e)}}),this._laserline=new u.LaserlineVisualElement({view:e.view});var n=!0;for(var r in e)r in this?"attached"===r?n=e[r]:this[r]=e[r]:console.error("Cannot set unknown property",r);this.attached=n}return e.prototype.destroy=function(){this.resources.destroy(),this._laserline.destroy()},Object.defineProperty(e.prototype,"laserlineAttached",{get:function(){return this.attached&&!this.hidden&&this._laserlineEnabled&&i.isSome(this._laserlineStyle)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e,this._laserline.attached=this.laserlineAttached},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached},set:function(e){this.resources.attached=e,this._laserline.attached=this.laserlineAttached},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldDownAtLocation",{set:function(e){this._isWorldDown=!0,a.vec3.copy(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),a.vec3.subtract(this._end,e,this._end),d.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"start",{get:function(){return this._start},set:function(e){this._isWorldDown=!1,a.vec3.exactEquals(this._start,e)||(a.vec3.copy(this._start,e),d.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},set:function(e){this._isWorldDown=!1,a.vec3.exactEquals(this._end,e)||(a.vec3.copy(this._end,e),d.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){l.vec4.exactEquals(e,this._color)||(l.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerWidth",{get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerColor",{get:function(){return this._innerColor},set:function(e){l.vec4.exactEquals(e,this._innerColor)||(l.vec4.copy(this._innerColor,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stipplePattern",{get:function(){return this._stipplePattern},set:function(e){var t=i.isSome(e)!==i.isSome(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stippleOffColor",{get:function(){return this._stippleOffColor},set:function(e){(i.isNone(e)||i.isNone(this._stippleOffColor)||!l.vec4.exactEquals(e,this._stippleOffColor))&&(this._stippleOffColor=i.isSome(e)?c.vec4f32.clone(e):null,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"falloff",{get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"infinite",{get:function(){return this._infinite},set:function(e){e!==this._infinite&&(this._infinite=e,this.updateGeometry())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"laserlineStyle",{get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,i.isSome(e)&&(this._laserline.style=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"laserlineEnabled",{get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(e){e!==this._occludedMode&&(this._occludedMode=e,i.isSome(this.resources.resources)&&(this.resources.resources.material.renderOccluded=e))},enumerable:!0,configurable:!0}),e.prototype.updateMaterial=function(){var e=this.resources.resources;i.isNone(e)||e.material.setParameterValues(this.materialParameters)},Object.defineProperty(e.prototype,"materialParameters",{get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff}},enumerable:!0,configurable:!0}),e.prototype.updateGeometry=function(){var e=this.resources.object;i.isNone(e)||this.updateVertices(e)},e.prototype.updateVertices=function(e){if(this._infinite){var t=this.view.state.camera;switch(h.fromRay(this._ray,b),this._infinite){case 2:b.c0=-Number.MAX_VALUE;break;case 1:case 3:var n=this._ray.origin,r=this.view.elevationProvider.getElevation(n[0],n[1],n[2],this.view.renderCoordsHelper.spatialReference,"ground"),i=this.view.renderCoordsHelper.getAltitude(n);this._isWorldDown&&i<r&&a.vec3.negate(b.ray.direction,b.ray.direction),3===this._infinite&&null!=r&&(b.c1=Math.abs(i-r))}if(!d.frustum.intersectClipRay(t.frustum.planes,b))return void this.updateVertexAttributes(e,this._start,this._end);var o=h.getStart(b,_),s=h.getEnd(b,x);this.updateVertexAttributes(e,o,s),this._laserline.intersectsLine=d.lineSegment.fromPoints(o,s,w)}else this.updateVertexAttributes(e,this._start,this._end),this._laserline.intersectsLine=d.lineSegment.fromPoints(this._start,this._end,w)},e.prototype.updateVertexAttributes=function(e,t,n){var r=e.geometryRecords[0].geometry.data.getVertexAttr()[m.RibbonVertexAttributeConstants.POSITION].data;r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=n[0],r[4]=n[1],r[5]=n[2],e.geometryVertexAttrsUpdated(0)},e.prototype.createResources=function(e){var t=[s.vec3f64.create(),s.vec3f64.create()],n=new f(v.createPolylineGeometry(t),"lineVisualElement"),r=new g(this.materialParameters,"lineVisualElement");return r.renderOccluded=this._occludedMode,e.addGeometry(n,r,o.mat4f64.IDENTITY),this.updateVertices(e),{material:r,geometry:n,forEach:function(e){return e(r),e(n)}}},e}();t.LineVisualElement=y;var b=h.create(),_=s.vec3f64.create(),x=s.vec3f64.create(),w=d.lineSegment.create()}).apply(null,r))||(e.exports=i)},PaEL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){function i(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.code.add(r.glsl(o||(o=n(["\n    void outputHighlight() {\n      vec4 fragCoord = gl_FragCoord;\n\n      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z > sceneDepth + 5e-7) {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "],["\n    void outputHighlight() {\n      vec4 fragCoord = gl_FragCoord;\n\n      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z > sceneDepth + 5e-7) {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "]))))}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.OutputHighlight=i,function(e){e.bindOutputHighlight=function(e,t,n){e.bindTexture(n.highlightDepthTexture,5),t.setUniform1i("depthTex",5),t.setUniform4f("highlightViewportPixelSz",0,0,1/n.viewport[2],1/n.viewport[3])}}(i=t.OutputHighlight||(t.OutputHighlight={}))}).apply(null,r))||(e.exports=i)},"PwS/":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("FXVB"),n("1m5D"),n("rjU6"),n("1f+t"),n("CIy2"),n("Kfys")],void 0===(i=(function(e,t,n,r,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.checkIsHidden=function(e){return!!e.instanceParameters.hidden||!!o.generateVisibleIndexRanges(e.instanceParameters.componentVisibilities,e.componentOffsets)},t.generateRenderGeometryHighlightRanges=function(e){return e.instanceParameters.hidden?null:o.generateHighlightedIndexRanges(e.instanceParameters.componentVisibilities,e.instanceParameters.componentHighlights,e.componentOffsets)},t.doesRenderGeometryHaveHighlights=function(e){return!e.instanceParameters.hidden&&o.hasHighlights(e.instanceParameters.componentVisibilities,e.instanceParameters.componentHighlights,e.componentOffsets)},t.isRenderGeometryHidden=function(e){return!!e.instanceParameters.hidden||o.isAllHidden(e.instanceParameters.componentVisibilities,e.componentOffsets)},t.drawArrays=function(e,t,n,r,i){e.drawArrays(t,n,r),i&&(i.drawCalls++,4===t&&(i.triangles+=r))},t.drawElements=function(e,t,n,r,i,o){var a=l.getBytesPerElement(n);e.drawElements(t,i,n,r*a),o&&(o.drawCalls++,4===t&&(o.triangles+=i))},t.drawArraysFaceRange=function(e,t,n,r,i){for(var o=0,a=0,s=t;a<s.length;a++){var l=s[a],c=l[1]-l[0]+1;o+=c,e.drawArrays(r,l[0]+n,c)}i&&(i.drawCalls+=t.length,4===r&&(i.triangles=o/3))},t.drawElementsFaceRange=function(e,t,n,r,i,o){for(var a=l.getBytesPerElement(i),s=0,c=0,u=t;c<u.length;c++){var p=u[c],d=p[1]-p[0]+1;s+=d,e.drawElements(r,d,i,(p[0]+n)*a)}o&&(o.drawCalls+=t.length,4===r&&(o.triangles+=s/3))},t.acquireMaterials=function(e,t){var n=new Map;return n.set(0,t.acquire(e,0)),n.set(3,t.acquire(e,3)),n.set(2,t.acquire(e,2)),n.set(1,t.acquire(e,1)),n.set(4,t.acquire(e,4)),n},t.releaseMaterials=function(e,t){t.release(e,0),t.release(e,3),t.release(e,2),t.release(e,1),t.release(e,4)},t.calculateTransformRelToOrigin=function(e,t,i){var o=e.origin.vec3;s.setMatrixTranslation3(p,-o[0],-o[1],-o[2]),n.isSome(e.transformation)?r.mat4.multiply(t,p,e.transformation):r.mat4.copy(t,p),i&&(r.mat4.invert(i,t),r.mat4.transpose(i,i))},t.encodeDoubleVec3=function(e,t,n,r,i){c[0]=e.get(t,0),c[1]=e.get(t,1),c[2]=e.get(t,2),a.encodeDoubleArray(c,u,3),n.set(i,0,u[0]),r.set(i,0,u[1]),n.set(i,1,u[2]),r.set(i,1,u[3]),n.set(i,2,u[4]),r.set(i,2,u[5])};var c=new Float64Array(3),u=new Float32Array(6),p=i.mat4f64.create()}).apply(null,r))||(e.exports=i)},Px2u:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("R2Zq"),n("KBgh"),n("FNtW"),n("znI2")],void 0===(i=(function(e,t,n,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){},s=function(){function e(e,t,n){this._rctx=e,this._materialRep=t,this.emitUpdatingChanged=n,this._pendingAddsRemoves=new Map,this._adds=new r,this._removes=new r,this._updates=new r({allocator:function(e){return e||new a},deallocator:function(e){return e.renderGeometry=null,e}}),this._materialRenderers=new Map,this._sortedMaterialRenderers=new r,this._hasHighlights=!1,this._hasWater=!1}return e.prototype.dispose=function(){this._adds.prune(),this._removes.prune(),this._updates.prune()},Object.defineProperty(e.prototype,"updating",{get:function(){return this._pendingAddsRemoves.size>0||this._updates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rendersOccluded",{get:function(){return n.someMap(this._materialRenderers,(function(e){return e.rendersOccluded}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return!this.updating&&0===this._materialRenderers.size},enumerable:!0,configurable:!0}),e.prototype.commitChanges=function(){var e=this,t=!1;if(!this.updating)return!1;this.updateAddsRemoves();var r=o.splitRenderGeometryChangeSetByMaterial({numToAdd:this._adds.length,toAdd:this._adds.data,numToRemove:this._removes.length,toRemove:this._removes.data,numToUpdate:this._updates.length,toUpdate:this._updates.data}),i=!1,a=!1;return r.forEach((function(n,r){var o=e._materialRenderers.get(r);if(!o&&n.toAdd.length>0&&(o=r.createRenderer(e._rctx,e._materialRep),e._materialRenderers.set(r,o),t=!0,i=!0,a=!0),o){var s=i||o.hasHighlights,l=a||o.hasWater;o.modify(n),i=i||s!==o.hasHighlights,a=a||l!==o.hasWater,o.isEmpty&&(e._materialRenderers.delete(r),o.dispose(),t=!0)}})),this._adds.clear(),this._removes.clear(),this._updates.clear(),this._pendingAddsRemoves.clear(),t&&this.updateSortedMaterialRenderers(),i&&(this._hasHighlights=n.someMap(this._materialRenderers,(function(e){return e.hasHighlights}))),a&&(this._hasWater=n.someMap(this._materialRenderers,(function(e){return e.hasWater}))),this.emitUpdatingChanged(),!0},e.prototype.add=function(e){for(var t=0===this._pendingAddsRemoves.size,n=0,r=e;n<r.length;n++)this._pendingAddsRemoves.set(r[n],0);t&&this._pendingAddsRemoves.size>0&&this.emitUpdatingChanged()},e.prototype.remove=function(e){for(var t=0===this._pendingAddsRemoves.size,n=0,r=e;n<r.length;n++){var i=r[n],o=this._pendingAddsRemoves.get(i);0===o?this._pendingAddsRemoves.set(i,2):2!==o&&this._pendingAddsRemoves.set(i,1)}t&&this._pendingAddsRemoves.size>0&&this.emitUpdatingChanged()},e.prototype.modify=function(e,t){for(var n=0===this._updates.length,r=0,i=e;r<i.length;r++){var o=i[r],a=this._updates.pushNew();a.renderGeometry=o,a.updateType=t}n&&this._updates.length>0&&this.emitUpdatingChanged()},e.prototype.updateLogic=function(e){for(var t=!1,n=0;n<this._sortedMaterialRenderers.length;n++){var r=this._sortedMaterialRenderers.data[n].materialRenderer;r.updateLogic&&r.updateLogic(e)&&(t=!0)}return t},e.prototype.draw=function(e,t,n){for(var r=0;r<this._sortedMaterialRenderers.length;r++){var o=this._sortedMaterialRenderers.data[r];if(i.materialPredicate(o.material,e)){var a=n.getMaterialRenderStatsObject(o.materialRenderer.type);o.materialRenderer.render(null,e,t,a)}}},e.prototype.updateSortedMaterialRenderers=function(){var e=this;this._sortedMaterialRenderers.clear(),this._materialRenderers.forEach((function(t,n){e._sortedMaterialRenderers.push({material:n,materialRenderer:t})})),this._sortedMaterialRenderers.sort((function(e,t){return t.material.renderPriority-e.material.renderPriority}))},e.prototype.updateAddsRemoves=function(){var e=this;this._adds.clear(),this._removes.clear(),this._pendingAddsRemoves.forEach((function(t,n){switch(t){case 0:e._adds.push(n);break;case 1:e._removes.push(n)}}));for(var t=0;t<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[t].renderGeometry)?this._updates.removeUnorderedIndex(t):t++},Object.defineProperty(e.prototype,"test",{get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}},enumerable:!0,configurable:!0}),e}();t.SortedRenderGeometryRenderer=s}).apply(null,r))||(e.exports=i)},QDiq:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("0LE5"),n("Rdxj"),n("2Mej")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=r.vec3f64.create(),a=function(){function e(){this._renderLighting={main:{intensity:r.vec3f64.create(),direction:r.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldSunlight={direction:r.vec3f64.create(),ambient:{color:r.vec3f64.create(),intensity:0},diffuse:{color:r.vec3f64.create(),intensity:0}}}return e.prototype.setLightDirectionUniform=function(e){e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)},e.prototype.setUniforms=function(e,t){void 0===t&&(t=!1),e.setUniform1f("lightingFixedFactor",t?(1-this._info.groundLightingFactor)*(1-this._info.globalFactor):0),e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var n=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),e.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),e.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]),e.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),e.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),e.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),e.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),e.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),e.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8]))},e.prototype.set=function(e){this._info=e,i.combineLights(e.lights,this._shOrder,this._renderLighting),n.vec3.negate(this._oldSunlight.direction,this._renderLighting.main.direction);var t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldSunlight.ambient.intensity=1,this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*t,this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*t,this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*t,this._oldSunlight.diffuse.intensity=1;var r=n.vec3.copy(o,this._oldSunlight.diffuse.color);n.vec3.scale(r,r,.4*this._info.globalFactor),n.vec3.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,r)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"old",{get:function(){return this._oldSunlight},enumerable:!0,configurable:!0}),e}();t.SceneLighting=a}).apply(null,r))||(e.exports=i)},R4nD:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("2Atf"),n("BcWh"),n("LxLY"),n("0LE5"),n("Rdxj"),n("2fXB"),n("j2SP"),n("WRgd"),n("ZcgO"),n("as1Q"),n("MCHn"),n("2W+Z"),n("fOZq"),n("hADE"),n("mmEe"),n("ys4y"),n("+nCE"),n("cjy9"),n("RC9r"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w){Object.defineProperty(t,"__esModule",{value:!0});var S=function(){function e(e){var t=this;this.view=null,this._attachmentOrigin=p.makeDehydratedPoint(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new i,this._isDraped=!1,this._geometry=null,this._width=1,this._color=c.vec4f32.fromValues(1,0,1,1),this._innerWidth=1,this._innerColor=c.vec4f32.fromValues(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._occludedMode=8,this.resources=new f.VisualElementResources({view:e.view,createResources:function(e){return t.createResources(e)},recreateGeometry:function(e,n){return e.geometries.length=0,t.recreateGeometry(n,e.material,e.geometries),e.geometries}}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new d.DrapedVisualElementResources({view:e.view,createResources:function(){return t.createDrapedResources()},recreateGeometry:function(e){e.geometries=t.createRenderGeometriesDraped(e.material),t.attachmentOriginChanged()}});var n=!0;for(var r in this._laserline=new h.LaserlineVisualElement({view:e.view}),e)r in this?"attached"===r?n=e[r]:this[r]=e[r]:console.error("Cannot set unknown property",r);this.attached=n}return e.prototype.destroy=function(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()},Object.defineProperty(e.prototype,"isDraped",{get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"laserlineAttached",{get:function(){return this.attached&&!this.hidden&&o.isSome(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e,this.drapedResources.hidden=e,this._laserline.attached=this.laserlineAttached},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this.updateAttached(e)},enumerable:!0,configurable:!0}),e.prototype.updateAttached=function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()},Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){l.vec4.exactEquals(e,this._color)||(l.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerWidth",{get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerColor",{get:function(){return this._innerColor},set:function(e){l.vec4.exactEquals(e,this._innerColor)||(l.vec4.copy(this._innerColor,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stipplePattern",{get:function(){return this._stipplePattern},set:function(e){var t=o.isSome(e)!==o.isSome(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stippleOffColor",{get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&l.vec4.exactEquals(e,this._stippleOffColor)||(this._stippleOffColor=e?c.vec4f32.clone(e):null,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"falloff",{get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"laserlineStyle",{get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,o.isSome(e)&&(this._laserline.style=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"laserlineEnabled",{get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(e){e!==this._occludedMode&&(this._occludedMode=e,o.isSome(this.resources.resources)&&(this.resources.resources.material.renderOccluded=e),o.isSome(this.drapedResources.resources)&&(this.drapedResources.resources.material.renderOccluded=e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attachmentOrigin",{get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=o.isSome(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;a.vec3.set(M,0,0,0);for(var t=w.RibbonVertexAttributeConstants.POSITION,n=0,r=o.expect(this.resources.resources).material.getParameters().isClosed,i=0,s=e;i<s.length;i++){var l=s[i];b.computeAttachmentOriginLines(l.getAttribute(t),l.getIndices(t),r,O)&&(a.vec3.add(M,M,O),n++)}return 0===n?null:(a.vec3.scale(M,M,1/n),this.view.renderCoordsHelper.fromRenderCoords(M,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)},enumerable:!0,configurable:!0}),e.prototype.updateMaterial=function(){o.isSome(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),o.isSome(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)},Object.defineProperty(e.prototype,"isClosed",{get:function(){return o.isSome(this.geometry)&&"polygon"===this.geometry.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"materialParameters",{get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0}},enumerable:!0,configurable:!0}),e.prototype.recreateGeometry=function(e,t,n){for(var r=0,i=this.createRenderGeometries();r<i.length;r++){var o=i[r];e.addGeometry(o,t),n.push(o)}this.attachmentOriginChanged()},e.prototype.attachmentOriginChanged=function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")},e.prototype.createResources=function(e){var t=new x(this.materialParameters,"lineVisualElement");t.renderOccluded=8;var n=[];return this.recreateGeometry(e,t,n),{material:t,geometries:n,forEach:function(e){e(t),n.forEach(e)}}},e.prototype.createDrapedResources=function(){var e=new x(this.materialParameters,"lineVisualElement");return e.renderOccluded=4,{material:e,geometries:this.createRenderGeometriesDraped(e)}},e.prototype.createRenderGeometriesDraped=function(e){var t=this.geometry;if(o.isNone(t))return[];for(var n=[],r=0,i=g.geometryToRenderInfoDraped(t,this.view.basemapTerrain.spatialReference).lines;r<i.length;r++){var s=i[r].position,l=new _(g.createGeometryData({attributeData:{position:s},removeDuplicateStartEnd:this.isClosed?1:0}));l.material=e;var c=u.empty(P);u.expandWithBuffer(c,s),a.vec3.set(l.center,.5*(c[0]+c[3]),.5*(c[1]+c[4]),0),l.bsRadius=.5*Math.sqrt((c[3]-c[0])*(c[3]-c[0])+(c[4]-c[1])*(c[4]-c[1])),n.push(l)}return n},e.prototype.calculateMapBounds=function(e){if(o.isNone(this.resources.resources))return!1;for(var t=this.view.renderCoordsHelper,n=0,r=this.resources.resources.geometries;n<r.length;n++){var i=r[n].data.getAttribute("position"),a=i.data,s=new Float64Array(a.length);m.bufferToBuffer(i.data,t.spatialReference,0,s,this.view.spatialReference,0,a.length/3),u.expandWithBuffer(e,s)}return!0},e.prototype.createRenderGeometries=function(){var e=this.geometry;if(o.isNone(e))return[];for(var t=[],n=[],r=0,i=g.geometryToRenderInfo(e,this.view.elevationProvider,this.view.renderCoordsHelper,v.fromElevationInfo(this.elevationInfo)).lines;r<i.length;r++){var a=i[r],s=a.position,l=g.createGeometryData({attributeData:{position:s,mapPosition:a.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0});t.push(new y(l,"geometryOutlineVisualElement")),n.push(s)}return this._laserline.pathVerticalPlane=n,t},e}();t.OutlineVisualElement=S;var P=u.create(),O=s.vec3f64.create(),M=s.vec3f64.create()}).apply(null,r))||(e.exports=i)},RC9r:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("2Atf"),n("qsST"),n("xoE+"),n("LxLY"),n("jBNx"),n("W9tT"),n("0LE5"),n("Rdxj"),n("aWgr"),n("2B1V"),n("rjU6"),n("+nCE"),n("tUyH"),n("FNtW"),n("CIy2"),n("ama6"),n("s6rJ"),n("ZeO9"),n("SNs2"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w){var S=i.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),P=function(e){function t(t,n){var r=e.call(this,n)||this;return r.techniqueConfig=new w.RibbonLineTechniqueConfiguration,r.params=b.copyParameters(t,M),r.validateParams(),r.params.transparent=r.params.color[3]<1||r.params.transparent,r.layout=r.createLayout(),r}return n(t,e),t.prototype.dispose=function(){},t.prototype.setParameterValues=function(e){for(var t in e)if("cap"!==t){if("join"===t&&"round"===this.params[t]!=("round"===e[t])){S.error("join cannot be changed after creation");continue}if("stipplePattern"===t&&!!this.params[t]!=!!e[t]){S.error("stippledness cannot be changed after creation");continue}this.params[t]=e[t]}else S.error("cap cannot be changed after creation");this.validateParams(),this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getPassParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){this.techniqueConfig.output=e;var t=a.isSome(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.stippleOffColorEnabled=t&&a.isSome(this.params.stippleOffColor),this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.params.join,this.techniqueConfig.roundCaps="round"===this.params.cap,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.params.innerWidth>0&&a.isSome(this.params.innerColor),this.techniqueConfig.falloffEnabled=this.params.falloff>0,this.techniqueConfig.occluder=8===this.renderOccluded,this.techniqueConfig},t.prototype.intersect=function(e,t,n,r,i,o,a,s,l){l?b.intersectDrapedRenderLineGeometry(e,r,o,this.params.width,a):this.intersectLineGeometry(e,t,n,r,this.params.width,a)},t.prototype.intersectLineGeometry=function(e,t,n,r,i,a){if(r.options.selectionMode&&!h.isAllHidden(t.componentVisibilities,e.componentOffsets))if(m.isTranslationMatrix(n)){var s=e.data.getVertexAttr(),u=s[w.RibbonVertexAttributeConstants.POSITION].data,d=i;this.params.vvSizeEnabled?d*=o.clamp(this.params.vvSizeOffset[0]+s[w.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0]):s[w.RibbonVertexAttributeConstants.SIZE]&&(d*=s[w.RibbonVertexAttributeConstants.SIZE].data[0]);var f=r.camera,v=V;l.vec2.copy(v,r.point);var g=d*f.pixelRatio/2+4*f.pixelRatio;c.vec3.set(W[0],v[0]-g,v[1]+g,0),c.vec3.set(W[1],v[0]+g,v[1]+g,0),c.vec3.set(W[2],v[0]+g,v[1]-g,0),c.vec3.set(W[3],v[0]-g,v[1]-g,0);for(var y=0;y<4;y++)f.unprojectPoint(W[y],k[y]);p.plane.fromPoints(f.eye,k[0],k[1],X),p.plane.fromPoints(f.eye,k[1],k[2],Z),p.plane.fromPoints(f.eye,k[2],k[3],Y),p.plane.fromPoints(f.eye,k[3],k[0],K);var b=Number.MAX_VALUE,_=this.params.isClosed?u.length-2:u.length-5;for(y=0;y<_;y+=3){T[0]=u[y]+n[12],T[1]=u[y+1]+n[13],T[2]=u[y+2]+n[14];var x=(y+3)%u.length;if(E[0]=u[x]+n[12],E[1]=u[x+1]+n[13],E[2]=u[x+2]+n[14],!(p.plane.signedDistance(X,T)<0&&p.plane.signedDistance(X,E)<0||p.plane.signedDistance(Z,T)<0&&p.plane.signedDistance(Z,E)<0||p.plane.signedDistance(Y,T)<0&&p.plane.signedDistance(Y,E)<0||p.plane.signedDistance(K,T)<0&&p.plane.signedDistance(K,E)<0)){if(f.projectPoint(T,L),f.projectPoint(E,z),L[2]<0&&z[2]>0){c.vec3.subtract(j,T,E);var P=f.frustum,O=-p.plane.signedDistance(P.planes[4],T)/c.vec3.dot(j,P.planes[4]);c.vec3.scale(j,j,O),c.vec3.add(T,T,j),f.projectPoint(T,L)}else if(L[2]>0&&z[2]<0)c.vec3.subtract(j,E,T),O=-p.plane.signedDistance((P=f.frustum).planes[4],E)/c.vec3.dot(j,P.planes[4]),c.vec3.scale(j,j,O),c.vec3.add(E,E,j),f.projectPoint(E,z);else if(L[2]<0&&z[2]<0)continue;L[2]=0,z[2]=0;var M=p.lineSegment.distance2(p.lineSegment.fromPoints(L,z,U),v);M<b&&(b=M,c.vec3.copy(N,T),c.vec3.copy(F,E))}}var A=r.rayBeginPoint,C=r.rayEndPoint;if(b<g*g){var D=Number.MAX_VALUE;if(p.lineSegment.closestLineSegmentPoint(p.lineSegment.fromPoints(N,F,U),p.lineSegment.fromPoints(A,C,G),I)){c.vec3.subtract(I,I,A);var R=c.vec3.length(I);c.vec3.scale(I,I,1/R),D=R/c.vec3.distance(A,C)}a(D,I)}}else S.error("intersection assumes a translation-only matrix")},t.prototype.computeAttachmentOrigin=function(e,t){var n=e.data,r="getVertexAttr"in n?n.getVertexAttr():"vertexAttr"in n?n.vertexAttr:null;if(!r)return null;var i=w.RibbonVertexAttributeConstants.POSITION,o="getVertexAttr"in n?n.getIndices(i):null;return f.computeAttachmentOriginLines(r[i],o,o&&this.params.isClosed,t)},t.prototype.createLayout=function(){var e=d.newLayout().vec3f(w.RibbonVertexAttributeConstants.POSITION).f32(w.RibbonVertexAttributeConstants.SUBDIVISIONFACTOR).vec2f(w.RibbonVertexAttributeConstants.UV0).vec3f(w.RibbonVertexAttributeConstants.AUXPOS1).vec3f(w.RibbonVertexAttributeConstants.AUXPOS2);return e.f32(this.params.vvSizeEnabled?w.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE:w.RibbonVertexAttributeConstants.SIZE),this.params.vvColorEnabled?e.f32(w.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE):e.vec4f(w.RibbonVertexAttributeConstants.COLOR),this.params.vvOpacityEnabled&&e.f32(w.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE),e},t.prototype.createBufferWriter=function(){return new A(this.layout,this.params)},t.prototype.createRenderer=function(e,t){return new _(e,t,this,w.ribbonVertexAttributeLocations)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new O(e):void 0},t.prototype.validateParams=function(){this.params.width&&this.params.width>1&&(this.params.width=Math.round(this.params.width)),"miter"!==this.params.join&&(this.params.miterLimit=0)},t}(g.Material),O=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return n(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(x.RibbonLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return this.technique.configuration.occluder?3===e||10===e||11===e:0===this.output?(this.targetSlot=this.technique.configuration.writeDepth?5:8,e===this.targetSlot):3===e},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&this._updateOccludeeState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t.prototype.getPipelineState=function(e,t){return t?this.technique.occludeePipeline:this.technique.configuration.occluder?11===e?this.technique.occluderPipelineTransparent:10===e?this.technique.occluderPipelineOpaque:this.technique.occluderPipelineMaskWrite:this.technique.pipeline},t}(v.GLMaterial),M=r({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1},y.Default),A=function(){function e(e,t){if(this.params=t,this.numCapSubdivisions=0,this.numJoinSubdivisions=0,this.vertexBufferLayout=e,!t.isClosed)switch(this.params.cap){case"butt":this.numCapSubdivisions=0;break;case"square":this.numCapSubdivisions=1;break;case"round":this.numCapSubdivisions=D}switch(this.params.join){case"miter":case"bevel":this.numJoinSubdivisions=t.stipplePattern?1:0;break;case"round":this.numJoinSubdivisions=R}}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){var t=e.indices[w.RibbonVertexAttributeConstants.POSITION].length/2+1,n=this.params.isClosed,r=n?2:2*(2*this.numCapSubdivisions+2),i=n?0:1,o=n?t:t-1;if(e.vertexAttr[w.RibbonVertexAttributeConstants.SUBDIVISIONS])for(var a=e.vertexAttr[w.RibbonVertexAttributeConstants.SUBDIVISIONS].data,s=i;s<o;++s)r+=4+2*a[s];else r+=(o-i)*(2*this.numJoinSubdivisions+4);return r+2},e.prototype.write=function(e,t,n,r){var i=this,o=H,a=B,s=q,l=t.vertexAttr[w.RibbonVertexAttributeConstants.POSITION].data,u=t.indices&&t.indices[w.RibbonVertexAttributeConstants.POSITION];u&&u.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var p=null;t.vertexAttr[w.RibbonVertexAttributeConstants.SUBDIVISIONS]&&(p=t.vertexAttr[w.RibbonVertexAttributeConstants.SUBDIVISIONS].data);var d=1,h=0;this.params.vvSizeEnabled?h=t.vertexAttr[w.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]:t.vertexAttr[w.RibbonVertexAttributeConstants.SIZE]&&(d=t.vertexAttr[w.RibbonVertexAttributeConstants.SIZE].data[0]);var f=[1,1,1,1],v=0;this.params.vvColorEnabled?v=t.vertexAttr[w.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE].data[0]:t.vertexAttr[w.RibbonVertexAttributeConstants.COLOR]&&(f=t.vertexAttr[w.RibbonVertexAttributeConstants.COLOR].data);var g=0;this.params.vvOpacityEnabled&&(g=t.vertexAttr[w.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE].data[0]);var m=l.length/3,y=e.transformation,b=new Float32Array(n.buffer),_=this.vertexBufferLayout.stride/4,x=r*_,S=x,P=function(e,t,n,r,o,a){b[x++]=t[0],b[x++]=t[1],b[x++]=t[2],b[x++]=r,b[x++]=o,b[x++]=a,b[x++]=e[0],b[x++]=e[1],b[x++]=e[2],b[x++]=n[0],b[x++]=n[1],b[x++]=n[2],b[x++]=i.params.vvSizeEnabled?h:d,i.params.vvColorEnabled?b[x++]=v:(b[x++]=f[0],b[x++]=f[1],b[x++]=f[2],b[x++]=f[3]),i.params.vvOpacityEnabled&&(b[x++]=g)};x+=_,c.vec3.set(a,l[0],l[1],l[2]),y&&c.vec3.transformMat4(a,a,y);var O=this.params.isClosed;if(O){var M=l.length-3;c.vec3.set(o,l[M],l[M+1],l[M+2]),y&&c.vec3.transformMat4(o,o,y)}else{c.vec3.copy(o,a),c.vec3.set(s,l[3],l[4],l[5]),y&&c.vec3.transformMat4(s,s,y);for(var A=0;A<this.numCapSubdivisions;++A)P(o,a,s,j=1-A/this.numCapSubdivisions,1,-4),P(o,a,s,j,1,4);P(o,a,s,0,0,-4),P(o,a,s,0,0,4),c.vec3.copy(o,a),c.vec3.copy(a,s)}var D=O?m:m-1;for(A=O?0:1;A<D;A++){var R=(A+1)%m*3;c.vec3.set(s,l[R+0],l[R+1],l[R+2]),y&&c.vec3.transformMat4(s,s,y),P(o,a,s,0,1,-1),P(o,a,s,0,1,1);for(var T=p?p[A]:this.numJoinSubdivisions,E=0;E<T;++E)P(o,a,s,j=(E+1)/(T+1),1,-2),P(o,a,s,j,1,2);P(o,a,s,1,0,-2),P(o,a,s,1,0,2),c.vec3.copy(o,a),c.vec3.copy(a,s)}if(O)x=C(b,S+_,b,x,2*_);else for(P(o,a,s,0,1,-5),P(o,a,s,0,1,5),A=0;A<this.numCapSubdivisions;++A){var j;P(o,a,s,j=(A+1)/this.numCapSubdivisions,1,-5),P(o,a,s,j,1,5)}C(b,S+_,b,S,_),x=C(b,x-_,b,x,_)},e}();function C(e,t,n,r,i){for(var o=0;o<i;o++)n[r++]=e[t++];return r}var D=3,R=1,T=u.vec3f64.create(),E=u.vec3f64.create(),j=u.vec3f64.create(),I=u.vec3f64.create(),V=u.vec3f64.create(),L=s.createRenderScreenPointArray3(),z=s.createRenderScreenPointArray3(),N=u.vec3f64.create(),F=u.vec3f64.create(),U=p.lineSegment.create(),G=p.lineSegment.create(),H=u.vec3f64.create(),B=u.vec3f64.create(),q=u.vec3f64.create(),W=[s.createRenderScreenPointArray3(),s.createRenderScreenPointArray3(),s.createRenderScreenPointArray3(),s.createRenderScreenPointArray3()],k=[u.vec3f64.create(),u.vec3f64.create(),u.vec3f64.create(),u.vec3f64.create()],X=p.plane.create(),Z=p.plane.create(),Y=p.plane.create(),K=p.plane.create();return P}).apply(null,r))||(e.exports=i)},Raj5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){var n=function(){function e(e,t,n,i,o,a){this.camera=null,this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=r,this.hasOccludees=!1,this.rctx=e,this.offscreenRenderingHelper=t,this.scenelightingData=n,this.shadowMap=i,this.ssaoHelper=o,this.sliceHelper=a}return e.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=r},Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0}),e}(),r=13;return n}).apply(null,r))||(e.exports=i)},"RdU/":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){function i(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.fragment.code.add(r.glsl(o||(o=n(["\n      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress = computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength = waveParams[2];\n        float flowOffset = waveParams[3];\n\n        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress = computeProgress(uv, time + phaseOffset);\n        float weight = computeWeight(uv, time + phaseOffset);\n\n        vec2 result = uv;\n        result -= flowVector * (progress + flowOffset);\n        result += phaseOffset;\n        result += (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\n      const float TIME_NOISE_STRENGTH = 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength = waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement = time * -_waveDir;\n\n        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal = normalize(normal_A + normal_B);\n        mixNormal.xy *= waveStrength;\n        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec3 getSurfaceNormal(vec2 _uv, float _time) {\n        float waveTextureRepeat = waveParams[1];\n        return getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n      }\n    "],["\n      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress = computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength = waveParams[2];\n        float flowOffset = waveParams[3];\n\n        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress = computeProgress(uv, time + phaseOffset);\n        float weight = computeWeight(uv, time + phaseOffset);\n\n        vec2 result = uv;\n        result -= flowVector * (progress + flowOffset);\n        result += phaseOffset;\n        result += (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\n      const float TIME_NOISE_STRENGTH = 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength = waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement = time * -_waveDir;\n\n        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal = normalize(normal_A + normal_B);\n        mixNormal.xy *= waveStrength;\n        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec3 getSurfaceNormal(vec2 _uv, float _time) {\n        float waveTextureRepeat = waveParams[1];\n        return getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n      }\n    "]))))}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.WaterDistortion=i,function(e){e.bindUniforms=function(e,t){e.setUniform1i("texWaveNormal",0),e.setUniform1i("texWavePerturbation",1),e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}}(i=t.WaterDistortion||(t.WaterDistortion={}))}).apply(null,r))||(e.exports=i)},RsYQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("jBNx"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("AzkI"),n("18xY"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h){Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(e,t,n){void 0===e&&(e=s.vec3f64.create()),void 0===t&&(t=s.vec3f64.create()),void 0===n&&(n=s.vec3f64.fromValues(0,0,1)),this._viewUp=s.vec3f64.create(),this._viewForward=s.vec3f64.create(),this._viewRight=s.vec3f64.create(),this._ray=u.ray.createWrapper(),this._viewport=c.vec4f64.fromValues(0,0,1,1),this._padding=c.vec4f64.fromValues(0,0,0,0),this._fov=55/180*Math.PI,this._near=1,this._far=1e3,this._viewDirty=!0,this._viewMatrix=o.mat4f64.create(),this._projectionDirty=!0,this._projectionMatrix=o.mat4f64.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=o.mat4f64.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=o.mat4f64.create(),this._frustumDirty=!0,this._frustum=u.frustum.create(),this._fullViewport=null,this.pixelRatio=1,this.relativeElevation=0,this._eye=s.vec3f64.clone(e),this._center=s.vec3f64.clone(t),this._up=s.vec3f64.clone(n),this._padding=c.vec4f64.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=s.vec3f64.create()),a.vec3.subtract(this._ray.direction,this.center,this.eye),this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){i.mat4.copy(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(this._near=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._far=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){this._viewport[0]!==(e+=this._padding[3])&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){this._viewport[1]!==(e+=this._padding[2])&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=c.vec4f64.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),l.vec4.copy(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(i.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2),r=n*this.aspect;i.mat4.frustum(this._projectionMatrix,-r*(1+2*this._padding[3]/e),r*(1+2*this._padding[1]/e),-n*(1+2*this._padding[2]/t),n*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){i.mat4.copy(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return h.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=h.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return h.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=h.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return a.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustum",{get:function(){return this._recomputeFrustum(),this._frustum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=o.mat4f64.create()),i.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),i.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation>=0},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){var t=e;return a.vec3.copy(this._eye,t._eye),a.vec3.copy(this._center,t._center),a.vec3.copy(this._up,t._up),l.vec4.copy(this._viewport,t._viewport),l.vec4.copy(this._padding,t._padding),this._near=t._near,this._far=t._far,this._fov=t._fov,this.relativeElevation=e.relativeElevation,this._viewDirty=t._viewDirty,this._viewDirty||(i.mat4.copy(this._viewMatrix,t._viewMatrix),a.vec3.copy(this._viewRight,t._viewRight),a.vec3.copy(this._viewUp,t._viewUp),a.vec3.copy(this._viewForward,t._viewForward)),t._projectionDirty?this._projectionDirty=!0:(i.mat4.copy(this._projectionMatrix,t._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(u.frustum.copy(t._frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?i.mat4.copy(this._viewInverseTransposeMatrix,t._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=o.mat4f64.clone(t._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),t._fullViewport?this._fullViewport?l.vec4.copy(this._fullViewport,t._fullViewport):this._fullViewport=c.vec4f64.clone(t._fullViewport):this._fullViewport=null,this.pixelRatio=e.pixelRatio,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equals=function(e){return g(this._eye,e._eye)&&g(this._center,e._center)&&g(this._up,e._up)&&m(this._viewport,e._viewport)&&m(this._padding,e._padding)&&this._near===e._near&&this._far===e._far&&this._fov===e._fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation},e.prototype.almostEquals=function(e,t,n){void 0===n&&(n=!1);var r,i=a.vec3.distance(this._eye,this._center)*(t||5e-4),o=i*i;return n?(p.directionFromTo(_,e._eye,e._center),p.directionFromTo(x,this._eye,this._center),r=1e-10):(a.vec3.copy(_,e._center),a.vec3.copy(x,this._center),r=o),a.vec3.squaredDistance(e._eye,this._eye)<o&&a.vec3.squaredDistance(_,x)<r&&Math.abs(e._fov-this._fov)<.001&&v(e._padding,this._padding)<.5&&v(e._viewport,this._viewport)<.5&&this.pixelRatio===e.pixelRatio},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0},e.prototype.computeRenderPixelSizeAt=function(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.computeRenderPixelSizeAtDist=function(e){return e*this.perRenderPixelRatio},e.prototype.computeScreenPixelSizeAt=function(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.viewDirectionDistance=function(e){return Math.abs(d.projectPointSignedLength(this.viewForward,a.vec3.subtract(_,e,this._eye)))},e.prototype.computeScreenPixelSizeAtDist=function(e){return e*this.perScreenPixelRatio},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.getScreenCenter=function(e){return void 0===e&&(e=r.createScreenPointArray()),e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e},e.prototype.getRenderCenter=function(e,t,n){return void 0===t&&(t=.5),void 0===n&&(n=.5),e||(e=r.createRenderScreenPointArray3()),e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*n,e.length>2&&(e[2]=.5),e},e.prototype.setGLViewport=function(e){var t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])},e.prototype.applyProjection=function(e,t,r){void 0===r&&(r=!1),e!==y&&a.vec3.copy(y,e),y[3]=1,r&&(t[2]=-y[2]),l.vec4.transformMat4(y,y,this.projectionMatrix),a.vec3.scale(y,y,1/Math.abs(y[3]));var i=this.fullViewport;return t[0]=n.lerp(0,i[0]+i[2],.5+.5*y[0]),t[1]=n.lerp(0,i[1]+i[3],.5+.5*y[1]),r||(t[2]=.5*(y[2]+1)),t},e.prototype.projectPoint=function(e,t){if(y[0]=e[0],y[1]=e[1],y[2]=e[2],y[3]=1,l.vec4.transformMat4(y,y,this.viewProjectionMatrix),0===y[3])return null;a.vec3.scale(y,y,1/Math.abs(y[3]));var r=this.fullViewport;return"x"in t?(t.x=n.lerp(0,r[0]+r[2],.5+.5*y[0]),t.y=n.lerp(0,r[1]+r[3],.5+.5*y[1])):(t[0]=n.lerp(0,r[0]+r[2],.5+.5*y[0]),t[1]=n.lerp(0,r[1]+r[3],.5+.5*y[1]),t.length>2&&(t[2]=.5*(y[2]+1))),t},e.prototype.unprojectPoint=function(e,t){if(i.mat4.multiply(b,this.projectionMatrix,this.viewMatrix),!i.mat4.invert(b,b))return null;var n=this.fullViewport;return y[0]=2*(e[0]-n[0])/n[2]-1,y[1]=2*(e[1]-n[1])/n[3]-1,y[2]=2*e[2]-1,y[3]=1,l.vec4.transformMat4(y,y,b),0===y[3]?null:(t[0]=y[0]/y[3],t[1]=y[1]/y[3],t[2]=y[2]/y[3],t)},e.prototype.computeUp=function(e){"global"===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.screenToRender=function(e,t){var n=this.fullHeight-e[1]*this.pixelRatio;return t[0]=e[0]*this.pixelRatio,t[1]=n,t},e.prototype.renderToScreen=function(e,t){var n=(this.fullHeight-e[1])/this.pixelRatio;return t[0]=e[0]/this.pixelRatio,t[1]=n,t},e.prototype.computeUpGlobal=function(){a.vec3.subtract(_,this.center,this.eye);var e=a.vec3.length(this.center);e<1?(a.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(a.vec3.dot(_,this.center))>.9999*a.vec3.length(_)*e||(a.vec3.cross(this.up,_,this.center),a.vec3.cross(this.up,this.up,_),a.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){p.directionFromTo(_,this.eye,this.center),Math.abs(_[2])<=.9999&&(a.vec3.scale(_,_,_[2]),a.vec3.set(this.up,-_[0],-_[1],1-_[2]),a.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){g(e,t)||(a.vec3.copy(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)},e.prototype._recomputeFrustum=function(){this._frustumDirty&&(u.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)},e.prototype._ensureViewClean=function(){this._viewDirty&&(i.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),a.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),a.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),a.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}();function v(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return n*n+r*r+i*i+o*o}function g(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function m(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}t.default=f;var y=c.vec4f64.create(),b=o.mat4f64.create(),_=s.vec3f64.create(),x=s.vec3f64.create()}).apply(null,r))||(e.exports=i)},SNs2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("qKT0"),n("2Atf"),n("LxLY"),n("LxLY"),n("fese"),n("3kdR"),n("PaEL"),n("3PFg"),n("W/V4"),n("FQ4r"),n("lBa0"),n("lfQW"),n("ne9J"),n("G0ER"),n("qbr3")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m){Object.defineProperty(t,"__esModule",{value:!0}),t.RibbonVertexAttributeConstants={POSITION:"position",SUBDIVISIONFACTOR:"subdivisionFactor",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",SUBDIVISIONS:"subdivisions",COLOR:"color",COLORFEATUREATTRIBUTE:"colorFeatureAttribute",SIZE:"size",SIZEFEATUREATTRIBUTE:"sizeFeatureAttribute",OPACITYFEATUREATTRIBUTE:"opacityFeatureAttribute"},t.ribbonVertexAttributeLocations={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};var y=function(r){function i(e,t){var n=r.call(this,e,t)||this;return n.stipplePattern=null,n.stippleTextureBind=null,n.stippleTextureRepository=e.stippleTextureRepository,n}return n(i,r),i.prototype.initializeProgram=function(e){var n=i.shader.get(),r=this.configuration,o=n.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,stippleEnabled:r.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleUVMaxEnabled:r.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:r.stippleIntegerRepeatsEnabled,roundCaps:r.roundCaps,roundJoins:r.roundJoins,vvColor:r.vvColor,vvSize:r.vvSize,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,falloffEnabled:r.falloffEnabled,innerColorEnabled:r.innerColorEnabled});return new g(e.rctx,o.generateSource("vertex"),o.generateSource("fragment"),t.ribbonVertexAttributeLocations)},i.prototype.dispose=function(){r.prototype.dispose.call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null},i.prototype.bindPass=function(e,t,n){if(4===this.configuration.output&&c.OutputHighlight.bindOutputHighlight(e,this.program,n),this.program.setUniform1f("intrinsicWidth",t.width),this.program.setUniform4fv("intrinsicColor",t.color),this.program.setUniform1f("miterLimit","miter"!==t.join?0:t.miterLimit),this.program.setUniform1f("nearPlane",n.nearFar[0]),this.program.setUniform1f("pixelRatio",n.pixelRatio),this.program.setUniform2fv("screenSize",[n.viewport[2],n.viewport[3]]),u.VisualVariables.bindUniformsWithOpacity(this.program,t),this.stipplePattern!==t.stipplePattern){var r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){var i=a.isSome(this.stippleTextureBind)?this.stippleTextureBind(e,0)*n.pixelRatio:1;if(this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/i),this.configuration.stippleOffColorEnabled){var s=o.expect(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",s[0],s[1],s[2],s.length>3?s[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",t.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",o.unwrapOr(t.innerColor,t.color)),this.program.setUniform1f("innerWidth",t.innerWidth*n.pixelRatio))},i.prototype.bindDraw=function(e){l.Transform.bindUniforms(this.program,e),s.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},i.prototype.initializePipeline=function(){var e=this.configuration,t=m.separateBlendingParams(770,1,771,771),n=e.polygonOffset&&b;if(e.occluder&&(this._occluderPipelineTransparent=m.makePipelineState({blending:t,polygonOffset:n,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:m.defaultColorWriteParams,stencilWrite:null,stencilTest:f.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=m.makePipelineState({polygonOffset:n,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:m.defaultColorWriteParams,stencilWrite:f.stencilWriteMaskOff,stencilTest:f.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=m.makePipelineState({polygonOffset:n,depthTest:f.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:f.stencilWriteMaskOn,stencilTest:f.stencilToolMaskBaseParams})),0===e.output){var r=function(r){return m.makePipelineState({blending:t,polygonOffset:n,depthTest:f.depthCompareLess,depthWrite:!e.transparent&&e.writeDepth&&m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?f.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?r?f.stencilToolMaskBaseParams:e.sceneHasOcludees?f.stencilBaseAllZerosParams:null:null})};return this._occludeePipeline=r(!0),r(!1)}return m.makePipelineState({polygonOffset:n,depthTest:f.depthCompareLess,depthWrite:!e.transparent&&e.writeDepth&&m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams})},Object.defineProperty(i.prototype,"occluderPipelineTransparent",{get:function(){return this._occluderPipelineTransparent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"occluderPipelineOpaque",{get:function(){return this._occluderPipelineOpaque},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"occludeePipeline",{get:function(){return this._occludeePipeline},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"occluderPipelineMaskWrite",{get:function(){return this._occluderPipelineMaskWrite},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"primitiveType",{get:function(){return 5},enumerable:!0,configurable:!0}),i.shader=new p.ReloadableShaderModule(v,"./RibbonLine.glsl",e),i}(d.ShaderTechnique);t.RibbonLineTechnique=y;var b={factor:0,units:-4},_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.occluder=!1,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.vertexColors=!1,t.transparent=!1,t.polygonOffset=!1,t.writeDepth=!1,t.stippleEnabled=!1,t.stippleOffColorEnabled=!1,t.stippleIntegerRepeatsEnabled=!1,t.roundCaps=!1,t.roundJoins=!1,t.vvSize=!1,t.vvColor=!1,t.vvOpacity=!1,t.falloffEnabled=!1,t.innerColorEnabled=!1,t.sceneHasOcludees=!1,t}return n(t,e),r([h.parameter({count:7})],t.prototype,"output",void 0),r([h.parameter()],t.prototype,"occluder",void 0),r([h.parameter()],t.prototype,"slicePlaneEnabled",void 0),r([h.parameter()],t.prototype,"sliceHighlightDisabled",void 0),r([h.parameter()],t.prototype,"vertexColors",void 0),r([h.parameter()],t.prototype,"transparent",void 0),r([h.parameter()],t.prototype,"polygonOffset",void 0),r([h.parameter()],t.prototype,"writeDepth",void 0),r([h.parameter()],t.prototype,"stippleEnabled",void 0),r([h.parameter()],t.prototype,"stippleOffColorEnabled",void 0),r([h.parameter()],t.prototype,"stippleIntegerRepeatsEnabled",void 0),r([h.parameter()],t.prototype,"roundCaps",void 0),r([h.parameter()],t.prototype,"roundJoins",void 0),r([h.parameter()],t.prototype,"vvSize",void 0),r([h.parameter()],t.prototype,"vvColor",void 0),r([h.parameter()],t.prototype,"vvOpacity",void 0),r([h.parameter()],t.prototype,"falloffEnabled",void 0),r([h.parameter()],t.prototype,"innerColorEnabled",void 0),r([h.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(h.ShaderTechniqueConfiguration);t.RibbonLineTechniqueConfiguration=_}).apply(null,r))||(e.exports=i)},TCLX:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("xhoE"),n("KY0m"),n("LxLY"),n("W9tT"),n("DIqE"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("ZPQp"),n("nrlZ")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h){Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(){this.vertices=[],this.edges=[],this.index=null}return e.prototype.makeVertex=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r={pos:e,unnormalizedPos:e,left:t,right:n,type:"vertex",component:this,index:null};return this.vertices.push(r),r},e.prototype.makeEdge=function(e,t){var n={v0:e,v1:t,type:"edge",component:this};return e.right=n,t.left=n,this.edges.push(n),n},e.prototype.removeVertex=function(e){this.vertices.splice(this.vertices.indexOf(e),1),e.left&&this.removeEdge(e.left),e.right&&this.removeEdge(e.right)},e.prototype.removeEdge=function(e){this.edges.splice(this.edges.indexOf(e),1),e.v0.right=null,e.v1.left=null},e}();function v(){return new f}t.Component=f;var g=function(){function e(){}return e.prototype.createNew=function(){return s.vec2f64.create()},e.prototype.fromArray=function(e){return s.vec2f64.fromValues(e[0],e[1])},e.prototype.toArray=function(e){return[e[0],e[1]]},e.prototype.toPoint=function(e,t){return t.x=e[0],t.y=e[1],t.hasZ=!1,t.hasM=!1,t},e.prototype.lerp=function(e,t,n,r){return a.vec2.lerp(r,e,t,n)},e.prototype.addDelta=function(e,t,n){e[0]+=t,e[1]+=n},e}();t.CoordinateHelper2D=g;var m=function(){function e(e){this.ztype=e}return e.prototype.createNew=function(){return c.vec3f64.create()},e.prototype.fromArray=function(e){return c.vec3f64.fromValues(e[0],e[1],e[2]||0)},e.prototype.toArray=function(e){return[e[0],e[1],e[2]]},e.prototype.toPoint=function(e,t){return t.x=e[0],t.y=e[1],0===this.ztype?(t.z=e[2],t.hasZ=!0,t.hasM=!1):(t.m=e[2],t.hasZ=!1,t.hasM=!0),t},e.prototype.lerp=function(e,t,n,r){return l.vec3.lerp(r,e,t,n)},e.prototype.addDelta=function(e,t,n,r){e[0]+=t,e[1]+=n,0===this.ztype&&(e[2]+=r)},e}();t.CoordinateHelper3D=m;var y=function(){function e(){}return e.prototype.createNew=function(){return p.vec4f64.create()},e.prototype.fromArray=function(e){return p.vec4f64.fromValues(e[0],e[1],e[2]||0,e[3]||0)},e.prototype.toArray=function(e){return[e[0],e[1],e[2],e[3]]},e.prototype.toPoint=function(e,t){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t},e.prototype.lerp=function(e,t,n,r){return u.vec4.lerp(r,e,t,n)},e.prototype.addDelta=function(e,t,n,r){e[0]+=t,e[1]+=n,e[2]+=r},e}();t.CoordinateHelper4D=y;var b=function(){function e(e,t,n){this.geometry=e,this.doUnnormalization=t,this.coordinateHelper=n,this.components=[];var r=h.getInfo(this.geometry.spatialReference);this._tmpMapPoint=n.createNew(),r?(this._spanMin=r.valid[0],this._spanMax=r.valid[1],this._span=this._spanMax-this._spanMin):this.doUnnormalization=!1}return e.prototype.addDelta=function(e,t,n,r){this.coordinateHelper.addDelta(e.pos,t,n,r)},e.prototype.getVertexPositionAsPoint=function(e,t){return this.coordinateHelper.toPoint(e.pos,t),t.spatialReference=this.geometry.spatialReference,t},e.prototype.getEdgePosition=function(e,t,n){return void 0===n&&(n=this.coordinateHelper.createNew()),this.coordinateHelper.lerp(e.v0.unnormalizedPos,e.v1.unnormalizedPos,t,n)},e.prototype.getEdgePositionAsPoint=function(e,t,n){var r=this.getEdgePosition(e,t,this._tmpMapPoint);return this.coordinateHelper.toPoint(r,n),n.spatialReference=this.geometry.spatialReference,n},e.prototype.canRemoveVertex=function(e){return!0},e.prototype.removeVertex=function(e){var t=e.component,n=e.left,r=e.right;return t.removeVertex(e),n&&r?t.makeEdge(n.v0,r.v1):null},e.prototype.splitEdge=function(e,t){var n=e.component,r=n.makeVertex(this.getEdgePosition(e,t)),i=e.v0,o=e.v1;return n.removeEdge(e),n.makeEdge(i,r),n.makeEdge(r,o),r},e}();t.ReshapeHelper=b;var _=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;i.geometry=t;for(var o=i.geometry.rings,a=0;a<o.length;++a){for(var s=o[a],l=v(),c=s.length-1,u=0;u<c;++u){var p=r.fromArray(s[u]);l.makeVertex(p).index=u}for(var h=l.vertices.length-1,f=0;f<h;++f)l.makeEdge(l.vertices[f],l.vertices[f+1]);l.makeEdge(l.vertices[l.vertices.length-1],l.vertices[0]),i.doUnnormalization&&d.computeUnnormalizedVertexPositionsOnDateLineCrossing(l.vertices,i._spanMin,i._spanMax,i._span),l.index=a,i.components.push(l)}return i}return r(t,e),t.prototype.canRemoveVertex=function(e){return e.component.vertices.length>3},t.prototype.commit=function(){var e=this,t=[],n=this.coordinateHelper.toArray;return this.components.forEach((function(r,i){r.index=i;var o=[];e.doUnnormalization&&d.computeUnnormalizedVertexPositionsOnDateLineCrossing(r.vertices,e._spanMin,e._spanMax,e._span);var a=r.vertices[0],s=a,l=s,c=0;do{s.index=c++,o.push(n(s.unnormalizedPos)),s=s.right.v1}while(s&&s!==l);o.push(n(a.unnormalizedPos)),t.push(o)})),this.geometry.rings=t,this.geometry},t}(b),x=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;i.geometry=t;for(var o=i.geometry.paths,a=0;a<o.length;++a){for(var s=o[a],l=v(),c=s.length,u=0;u<c;++u){var p=r.fromArray(s[u]);l.makeVertex(p).index=u}for(var h=l.vertices.length-1,f=0;f<h;++f)l.makeEdge(l.vertices[f],l.vertices[f+1]);i.doUnnormalization&&d.computeUnnormalizedVertexPositionsOnDateLineCrossing(l.vertices,i._spanMin,i._spanMax,i._span),l.index=a,i.components.push(l)}return i}return r(t,e),t.prototype.canRemoveVertex=function(e){return e.component.vertices.length>2},t.prototype.commit=function(){var e=this,t=[],n=this.coordinateHelper.toArray;return this.components.forEach((function(r,o){r.index=o;var a=[];e.doUnnormalization&&d.computeUnnormalizedVertexPositionsOnDateLineCrossing(r.vertices,e._spanMin,e._spanMax,e._span);var s=i.find(r.vertices,(function(e){return null==e.left})),l=s,c=0;do{s.index=c++,a.push(n(s.unnormalizedPos)),s=s.right?s.right.v1:null}while(s&&s!==l);t.push(a)})),this.geometry.paths=t,this.geometry},t}(b);t.isReshapeGeometry=function(e){return o.isSome(e)&&("polygon"===e.type||"polyline"===e.type)},t.createReshapeHelper=function(e,t){if(o.isNone(e))return null;var n=function(e){return e.hasZ&&e.hasM?new y:e.hasM?new m(1):e.hasZ?new m(0):new g}(e);return"polygon"===e.type?new _(e,t,n):new x(e,t,n)}}).apply(null,r))||(e.exports=i)},TIRl:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("Q2wQ"),n("HZ3d"),n("2Atf"),n("LxLY"),n("DtIM"),n("uiHv")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new c.EventPipeline,this._enabled=!1}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&s.isSome(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,n=this.snap(this.lastDragEvent.screenEnd);s.isSome(n)&&this.next.execute({action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?n:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd})}this._enabled=e},enumerable:!0,configurable:!0}),e.prototype.snap=function(e){var t=s.isSome(this.view)?this.view.toMap(e,{exclude:[]}):null;return s.isSome(t)&&s.isSome(this.view)&&(t.z=l.getZForElevationMode(t,this.view,this.elevationInfo)),t},e.prototype.createDragEventPipelineStep=function(e,t){var n=this;return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,function(e){if(n.lastDragEvent="end"!==e.action?a({},e):null,n._enabled){var t=n.snap(e.screenEnd);return s.isSome(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}},e}();t.SnapToScene=u}).apply(null,r))||(e.exports=i)},UGy0:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("hk44"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,o){var a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new o.ShaderBuilder;return t.include(r.Laserline,e),t.vertex.uniforms.add("uModelViewMatrix","mat4"),t.vertex.uniforms.add("uProjectionMatrix","mat4"),t.attributes.add("start","vec3"),t.attributes.add("end","vec3"),t.attributes.add("up","vec3"),t.attributes.add("extrude","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add(i.glsl(a||(a=n(["\n  void main() {\n    vec3 pos = mix(start, end, extrude.x);\n\n    vec4 viewPos = uModelViewMatrix * vec4(pos, 1);\n    vec4 projPos = uProjectionMatrix * viewPos;\n    vec2 ndcPos = projPos.xy / projPos.w;\n\n    vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;\n    vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);\n    vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);\n\n    vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);\n    ndcPos += length(lxy) * projExtrudeDir;\n\n    vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));\n    vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;\n\n    vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;\n    vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;\n    vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\n\n    // Add enough padding in the X screen space direction for glow\n    float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\n    ndcPos.x += xPaddingPixels * pixelToNDC.x;\n\n    uv = ndcPos * 0.5 + 0.5;\n    gl_Position = vec4(ndcPos, 0, 1);\n  }\n  "],["\n  void main() {\n    vec3 pos = mix(start, end, extrude.x);\n\n    vec4 viewPos = uModelViewMatrix * vec4(pos, 1);\n    vec4 projPos = uProjectionMatrix * viewPos;\n    vec2 ndcPos = projPos.xy / projPos.w;\n\n    vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;\n    vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);\n    vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);\n\n    vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);\n    ndcPos += length(lxy) * projExtrudeDir;\n\n    vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));\n    vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;\n\n    vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;\n    vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;\n    vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\n\n    // Add enough padding in the X screen space direction for glow\n    float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\n    ndcPos.x += xPaddingPixels * pixelToNDC.x;\n\n    uv = ndcPos * 0.5 + 0.5;\n    gl_Position = vec4(ndcPos, 0, 1);\n  }\n  "])))),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add(i.glsl(s||(s=n(["\n  float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\n    vec3 origin = mix(start, end, 0.5);\n    vec3 basis = end - origin;\n    vec3 posAtOrigin = pos - origin;\n\n    float x = dot(normalize(basis), posAtOrigin);\n    float y = dot(plane.xyz, posAtOrigin);\n\n    float dx = max(abs(x) - length(basis), 0.0);\n    float dy = y;\n\n    float dist = length(vec2(dx, dy));\n\n    float width = fwidth(y);\n    float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;\n    float pixelDist = dist / min(width, maxPixelDistance);\n    return abs(pixelDist);\n  }\n\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\n\n    vec4 color = laserlineProfile(distance);\n    float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\n\n    gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n  }\n  "],["\n  float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\n    vec3 origin = mix(start, end, 0.5);\n    vec3 basis = end - origin;\n    vec3 posAtOrigin = pos - origin;\n\n    float x = dot(normalize(basis), posAtOrigin);\n    float y = dot(plane.xyz, posAtOrigin);\n\n    float dx = max(abs(x) - length(basis), 0.0);\n    float dy = y;\n\n    float dist = length(vec2(dx, dy));\n\n    float width = fwidth(y);\n    float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;\n    float pixelDist = dist / min(width, maxPixelDistance);\n    return abs(pixelDist);\n  }\n\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\n\n    vec4 color = laserlineProfile(distance);\n    float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\n\n    gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n  }\n  "])))),t}}).apply(null,r))||(e.exports=i)},UdQa:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("Q2wQ"),n("HZ3d"),n("2Atf"),n("BcWh"),n("eIBl"),n("xoE+"),n("LxLY"),n("afW+"),n("jBNx"),n("8MXS"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("qysZ"),n("DtIM"),n("woUR"),n("5T2R"),n("uiHv"),n("Fe95"),n("aWgr"),n("AzkI"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w,S,P,O,M,A,C,D){var R;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.Unlocked=1024,e.DelayedFocused=2048,e.TouchInput=32768}(R||(R={}));var T=function(){function e(e){var t=this;this.mode=null,this._handles=new l,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new s,this.getFocused=function(){return t.ringManipulator.focused},this.getScale=function(){return u.isSome(t._scaleRotateDragData)&&"scale"===t._scaleRotateDragData.mode?t._scaleRotateDragData.scale:1},this.tool=e.tool,this.mode=e.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}return e.prototype.destroy=function(){u.isSome(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null},e.prototype.startAnimation=function(e){var t=this;this.cancelActiveAnimation(),e.start();var n=p.addFrameTask({update:function(n){e.update(n.deltaTime)&&t.cancelActiveAnimation()}});this._activeAnimation=a({},e,{frameTask:n})},e.prototype.cancelActiveAnimation=function(){u.isSome(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)},e.prototype.forEachManipulator=function(e){e(this.ringManipulator,2)},e.prototype.createManipulator=function(){var e=this;this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);var t=this.tool.graphicState.graphic,n=w.createManipulatorDragEventPipeline(this.ringManipulator,(function(n,r,i){e._scaleRotateDragData=null;var o=function(e,t){var n=e.allLayerViews.find((function(e){return e.layer===t.layer}));if(u.isNone(t.symbol))return null;var r=t.symbol;return{symbolLayers:r.symbolLayers.map((function(e){var t=null;return"object"===e.type&&(t=e.heading),{heading:t,size:n.getSymbolLayerSize(r,e)}})).toArray()}}(e.tool.view,t);if(u.isNone(o))return e.updateDragState(),null;var a={mode:"none",origin:m.vec3f64.clone(n.renderLocation),angle:0,startAngle:e.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:o};e._scaleRotateDragData=a,e.updateDragState();var s=M.sv3d.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(n.renderLocation,s),r.next(w.screenToRenderPlane(e.tool.view,P.plane.fromPositionAndNormal(n.renderLocation,s))).next((function(n){var r=x.calculateInputRotationTransform(n.renderStart,n.renderEnd,a.origin,n.plane),i=O.cyclicalPI.shortestSignedDiff(a.angle,r);a.angleDir=c.clamp(a.angleDir+i,-S.ROTATE_INDICATOR_DIRECTION_BUFFER,S.ROTATE_INDICATOR_DIRECTION_BUFFER),a.angle=r;var o=function(e,t){var n=g.vec3.subtract(M.sv3d.get(),t.renderStart,e.origin),r=g.vec3.subtract(M.sv3d.get(),t.renderEnd,e.origin),i=g.vec3.length(n),o=g.vec3.length(r);return 0===i?0:o/i}(a,n);if(a.scaleDir=c.clamp(a.scaleDir+(o-a.scale),-S.SCALE_INDICATOR_DIRECTION_BUFFER,S.SCALE_INDICATOR_DIRECTION_BUFFER),a.scale=o,e.onScaleChanged(),"none"===a.mode){var s=e.mode||function(e,t,n,r){var i=e.renderStart,o=e.renderEnd,a=E(i,r,M.sv3d.get()),s=E(o,r,M.sv3d.get());if(g.vec3.squaredDistance(a,s)<S.DRAG_THRESHOLD_PX*S.DRAG_THRESHOLD_PX)return null;var l=g.vec3.subtract(M.sv3d.get(),i,n),c=g.vec3.cross(M.sv3d.get(),l,t),u=i,p=g.vec3.add(M.sv3d.get(),u,c),d=E(n,r,M.sv3d.get()),h=a,f=E(p,r,M.sv3d.get()),v=g.vec3.subtract(M.sv3d.get(),f,h),m=g.vec3.subtract(M.sv3d.get(),a,d),y=P.ray.wrap(h,v),b=P.ray.wrap(d,m);return P.ray.distance2(y,s)<P.ray.distance2(b,s)?"rotate":"scale"}(n,n.plane,a.origin,e.tool.view.state.camera);if(u.isSome(s)){switch(s){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:t,angle:a.angle});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:t,scale:a.scale})}a.mode=s}}if(e.updateDragState(),u.isSome(t.symbol)){var l=t.symbol.clone(),p=0,d=1;switch(a.mode){default:case"none":break;case"scale":d=a.scale;break;case"rotate":p=a.angle}e.applySymbolData(l,a.startSymbolData,p,d),t.symbol=l,e.updateManipulatorTransform()}switch(n.action){case"start":case"update":switch(a.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:t,angle:a.angle});break;case"scale":e.tool.emit("graphic-scale",{graphic:t,scale:a.scale})}break;case"end":switch(a.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:t,angle:a.angle});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:t,scale:a.scale});break;default:case"none":}}"end"===n.action&&(e.startAnimation(j(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState())})),i.next(w.resetSymbol(t)).next((function(){if(u.isSome(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:t,angle:e._scaleRotateDragData.startAngle});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:t,scale:1})}e.startAnimation(j(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null}}))}));this._handles.add(n),this._handles.add([this.ringManipulator.events.on("focus-changed",(function(t){var n,r,i,o,a;"focus"===t.action?e.startAnimation((n=e,r=function(){return e.updateDelayedFocusedState()},i=0,o=null,a=function(){return!1},{start:function(){o=n.getFocused,n.getFocused=a,i=0,r()},update:function(e){return i+=e,!o()||i>S.RING_INDICATOR_DELAY_MS?1:0},destroy:function(){n.getFocused=o,r()}})):e.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(function(e){e.stopPropagation()})),h.init(this.tool.graphicState,"displaying",(function(t){return e.ringManipulator.available=t})),this.tool.graphicState.on("changed",(function(){return x.placeAtGraphic(e.tool.view,e.ringManipulator,t)}))]),x.placeAtGraphic(this.tool.view,this.ringManipulator,t)},e.prototype.onScaleChanged=function(){this.events.emit("scale-changed"),this.updateManipulatorTransform()},e.prototype.updateDelayedFocusedState=function(){this.ringManipulator.updateStateEnabled(R.DelayedFocused,this.getFocused())},e.prototype.updateDragState=function(){if(this.ringManipulator.updateStateEnabled(R.Unlocked,!(u.isSome(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),u.isSome(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(R.ScaleIn|R.ScaleOut,!1),this.ringManipulator.updateStateEnabled(R.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(R.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(R.RotateLeft|R.RotateRight,!1),this.ringManipulator.updateStateEnabled(R.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(R.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(R.ScaleIn|R.ScaleOut|R.RotateLeft|R.RotateRight,!1)},e.prototype.updateManipulatorTransform=function(){var e=f.mat4.identity(M.sm4d.get());f.mat4.rotate(e,e,this.tool.symbolRotationAngle,m.vec3f64.fromValues(0,0,1));var t=this.getScale(),n=f.mat4.fromScaling(M.sm4d.get(),g.vec3.set(M.sv3d.get(),t,t,t)),r=f.mat4.identity(M.sm4d.get());f.mat4.multiply(r,n,e),this.ringManipulator.modelTransform=r},e.prototype.createRingManipulator=function(){for(var e=function(e,t,n){for(var r=[],i=Math.ceil(S.GEOMETRY_SEGMENTS*(t-e)/(2*Math.PI)),o=0;o<i+1;o++){var a=e+o*(t-e)/i;r.push(m.vec3f64.fromValues(n*Math.cos(a),n*Math.sin(a),0))}return r},t=function(t){return e(0,2*Math.PI,t)},n=function(e,t){return new A(C.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,S.RING_HEIGHT/2],[-e/2,S.RING_HEIGHT/2]]}(t),e,[],[],!1),"graphic-transform-ring")},r=t(S.RING_RADIUS),i=n(r,S.RING_THICKNESS),o={left:[],right:[]},a=[],s=0;s<2;s++){var l=(P=s*Math.PI-Math.PI/4)+(O=Math.PI/2-S.ROTATE_INDICATOR_ARC_LENGTH),c=P+Math.PI/2-O,u=n(M=e(l,c,S.INNER_INDICATOR_RADIUS),S.INDICATOR_THICKNESS);a.push(M),a.push(e(l,c,S.OUTER_INDICATOR_RADIUS-S.RING_THICKNESS/2)),o.left.push(u),o.right.push(u);for(var p=0;p<2;p++){var d=0===p,h=v.mat4f64.create();if(d){f.mat4.scale(h,h,[1,-1,1]),f.mat4.rotate(h,h,-l,[0,0,1]);var g=Math.round(S.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE*(M.length-1));h[12]=M[g][0],h[13]=M[g][1],h[14]=M[g][2]}else f.mat4.rotate(h,h,c,[0,0,1]),g=Math.round((1-S.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE)*(M.length-1)),h[12]=M[g][0],h[13]=M[g][1],h[14]=M[g][2];var y=C.createExtrudedTriangle(S.ROTATE_INDICATOR_ARROW_TIP_LENGTH,0,S.ROTATE_INDICATOR_ARROW_TIP_RADIUS,S.RING_HEIGHT);C.transformInPlace(y,h);var x=new A(y,"graphic-transform-ring-rotate");(d?o.left:o.right).push(x)}}var w=[];for(s=0;s<2;s++){l=(P=s*Math.PI-Math.PI/4)+(O=Math.PI/2-S.SCALE_INDICATOR_ARC_LENGTH),c=P+Math.PI/2-O;var P,O,M=e(l,c,S.OUTER_INDICATOR_RADIUS);w.push(n(M,S.INDICATOR_THICKNESS))}var D=t(S.RING_RADIUS+S.SCALE_INDICATOR_OFFSET1),T=t(S.RING_RADIUS+S.SCALE_INDICATOR_OFFSET2),E=n(D,S.INDICATOR_THICKNESS),j=n(T,S.INDICATOR_THICKNESS),I=t(S.RING_RADIUS-S.SCALE_INDICATOR_OFFSET1),V=t(S.RING_RADIUS-S.SCALE_INDICATOR_OFFSET2),L=n(I,S.INDICATOR_THICKNESS),z=n(V,S.INDICATOR_THICKNESS),N=this.createMaterial(),F=this.createMaterial(.66),U=this.createMaterial(.5),G=this.createMaterial(.33),H=[{geometry:i,material:N,stateMask:R.DelayedFocused},{geometry:i,material:U,stateMask:0}];this.mode&&"scale"!==this.mode||(H=H.concat([{geometry:w,material:N,stateMask:R.DelayedFocused|R.Unlocked},{geometry:E,material:F,stateMask:R.DelayedFocused|R.ScaleIn},{geometry:j,material:G,stateMask:R.DelayedFocused|R.ScaleIn},{geometry:L,material:F,stateMask:R.DelayedFocused|R.ScaleOut},{geometry:z,material:G,stateMask:R.DelayedFocused|R.ScaleOut}])),this.mode&&"rotate"!==this.mode||(H=H.concat([{geometry:o.right,material:N,stateMask:R.DelayedFocused|R.Unlocked},{geometry:o.left,material:N,stateMask:R.DelayedFocused|R.RotateLeft},{geometry:o.right,material:N,stateMask:R.DelayedFocused|R.RotateRight}]));var B=[r].concat(a);return new _.Manipulator3D({view:this.tool.view,renderObjects:H,autoScaleRenderObjects:!1,worldOriented:!0,radius:S.RING_THICKNESS,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:b.getGraphicEffectiveElevationInfo(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:B,direction:m.vec3f64.fromValues(0,0,1)}})},e.prototype.createMaterial=function(e){void 0===e&&(e=1);var t=S.HANDLE_COLOR.concat([e]),n=new D({color:t,transparent:1!==e,cullFace:2},"graphic-transform");return n.renderOccluded=2,n},e.prototype.applySymbolData=function(e,t,n,r){var i=this;e.symbolLayers.forEach((function(e,o){var a=t.symbolLayers[o],s=a.heading,l=a.size;"object"===e.type&&(e.heading=(u.isSome(s)?s:0)-y.toDegree(n),u.isSome(l)&&"width"in l&&(l.width=i.enforceNonZeroSize(l.width),l.height=i.enforceNonZeroSize(l.height),l.depth=i.enforceNonZeroSize(l.depth),e.width=l.width*r,e.depth=l.depth*r,e.height=l.height*r))}))},e.prototype.enforceNonZeroSize=function(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)},Object.defineProperty(e.prototype,"test",{get:function(){return{ringManipulator:this.ringManipulator}},enumerable:!0,configurable:!0}),e}();function E(e,t,n){var r=t.projectPoint(e,d.castRenderScreenPointArray(I)),i=t.renderToScreen(r,V);return g.vec3.set(n,i[0],i[1],0)}function j(e,t){var n=null,r=1,i=function(){return r};return{start:function(){r=e.getScale(),n=e.getScale,e.getScale=i,t()},update:function(e){return r+=((r+1)/2-r)*Math.min(e*S.RING_RESET_ANIMATION_SPEED_FACTOR,1),t(),Math.abs(r-1)<.01?1:0},destroy:function(){e.getScale=n,t()}}}t.GraphicScaleRotateTransform=T;var I=m.vec3f64.create(),V=d.createScreenPointArray()}).apply(null,r))||(e.exports=i)},VQEQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("W9tT"),n("DIqE"),n("O7NG"),n("fese"),n("hs8d"),n("uUnu"),n("aRjO"),n("PaEL"),n("3PFg"),n("IwVr"),n("rCq5"),n("DKwL"),n("2o+p"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m){function y(e,t){var n,i,o;return void 0===t&&(t=L),e.textureIsSignedDistanceField?((o=t)[0]=(n=e.anchorPos)[0]*((i=e.distanceFieldBoundingBox)[2]-i[0])+i[0],o[1]=n[1]*(i[3]-i[1])+i[1]):r.vec2.copy(t,e.anchorPos),t}Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new m.ShaderBuilder,r=e.signedDistanceFieldEnabled;if(t.include(s.AlignPixel),t.include(l.HUD,e),t.include(a.Slice,e),6===e.output)return t.include(c.HUDOcclusionPass,e),t;t.include(v.ScreenSizePerspective),t.include(f.RgbaFloatEncoding),t.include(h.ColorConversion,{stages:1}),t.include(p.VisualVariables,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),r&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(g.glsl(x||(x=n(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "],["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),g.glsl(e.screenSizePerspectiveEnabled?b||(b=n(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "],["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "])):_||(_=n(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"],["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var i=g.glsl(w||(w=n(["\n      vec2 uv01 = floor(uv0);\n      vec2 uv = uv0 - uv01;\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "],["\n      vec2 uv01 = floor(uv0);\n      vec2 uv = uv0 - uv01;\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "]))),o=g.glsl(r?S||(S=n(["\n  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"],["\n  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"])):P||(P=n(["\n  posProj += quadOffset;\n  if (inputSize.x == size.x) {\n    posProj = alignToPixelOrigin(posProj, viewport.zw);\n  }"],["\n  posProj += quadOffset;\n  if (inputSize.x == size.x) {\n    posProj = alignToPixelOrigin(posProj, viewport.zw);\n  }"])));t.vertex.code.add(g.glsl(M||(M=n(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "],["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "])),e.occlusionTestEnabled?"if (visible) {":"",i,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",g.glsl.float(d.symbolAlphaCutoff),r?"alphaDiscard = alphaDiscard && outlineColor.a < "+g.glsl.float(d.symbolAlphaCutoff)+";":"",o,e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?g.glsl(O||(O=n(["} else { vtc = vec2(0.0);\n        ",""],["} else { vtc = vec2(0.0);\n        ",""])),e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),t.fragment.uniforms.add("tex","sampler2D"),r&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));var y=e.debugDrawBorder?g.glsl(A||(A=n(["(isBorder > 0.0 ? 0.0 : ",")"],["(isBorder > 0.0 ? 0.0 : ",")"])),g.glsl.float(d.defaultMaskAlphaCutoff)):g.glsl.float(d.defaultMaskAlphaCutoff),L=g.glsl(E||(E=n(["\n    ","\n\n    ","\n\n    ","\n  "],["\n    ","\n\n    ","\n\n    ","\n  "])),e.debugDrawBorder?g.glsl(C||(C=n(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"],["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",r?g.glsl(D||(D=n(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "],["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),y,g.glsl.float(d.symbolAlphaCutoff),y):g.glsl(R||(R=n(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "],["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),y),e.debugDrawBorder?g.glsl(T||(T=n(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"],["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");return 0===e.output&&t.fragment.code.add(g.glsl(j||(j=n(["\n    void main() {\n      ","\n    }\n    "],["\n    void main() {\n      ","\n    }\n    "])),L)),4===e.output&&(t.include(u.OutputHighlight),t.fragment.code.add(g.glsl(V||(V=n(["\n    void main() {\n      ","\n      ","\n    }\n    "],["\n    void main() {\n      ","\n      ","\n    }\n    "])),L,e.binaryHighlightOcclusionEnabled?g.glsl(I||(I=n(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"],["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t},function(e){e.bindUniforms=function(e,t,n){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",o.vec4f64.ZEROS),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize)));var r=n.pixelRatio||1;e.setUniform2f("screenOffset",2*t.screenOffset[0]*r,2*t.screenOffset[1]*r),e.setUniform2fv("anchorPos",y(t))}}(t.HUDMaterial||(t.HUDMaterial={})),t.calculateAnchorPosForRendering=y;var b,_,x,w,S,P,O,M,A,C,D,R,T,E,j,I,V,L=i.vec2f64.create()}).apply(null,r))||(e.exports=i)},"W/V4":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qMld")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){this._relativePath=t,this._moduleRequire=n,this._module=e}return e.prototype.get=function(){return this._module},e.prototype.reload=function(){var e=this,t=this._moduleRequire.toUrl(this._relativePath);return t=t.slice(t.indexOf("esri/")),this._recursivelyInvalidateModuleCache(t),n.create((function(t){e._moduleRequire([e._relativePath],(function(n){e._module=n,t()}))}))},e.prototype._recursivelyInvalidateModuleCache=function(e){if(-1!==e.search("shader")||-1!==e.search("shading")){var t=this._moduleRequire.modules,n=t[e];if(n){var r=n.deps;delete t[e];for(var i=0,o=r;i<o.length;i++){var a=o[i];"esri"===a.pid&&this._recursivelyInvalidateModuleCache(a.mid)}}}},e}();t.ReloadableShaderModule=r}).apply(null,r))||(e.exports=i)},W0kZ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}();t.IdGen=n}).apply(null,r))||(e.exports=i)},X0Jx:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("y4WC"),n("LxLY")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this._isToolEditable=!0,this._manipulators=new r,this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}return Object.defineProperty(e.prototype,"isToolEditable",{set:function(e){this._isToolEditable=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._manipulators.length},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){return void 0===t&&(t=0),this.addMany([e],t)[0]},e.prototype.addMany=function(e,t){var n=this;return void 0===t&&(t=0),e.map((function(e){var r=n._nextManipulatorId++,i={id:r,manipulator:e,visibilityPredicate:t,attached:!1};return n._manipulators.add(i),n._attached&&n._updateManipulatorAttachment(i),r}))},e.prototype.remove=function(e){if("number"==typeof e){for(var t=e,n=0;n<this._manipulators.length;n++)if(this._manipulators.getItemAt(n).id===t){var r=this._manipulators.splice(n,1)[0];return this._detachManipulator(r),r.id}return null}var i=e;for(n=0;n<this._manipulators.length;n++)if(this._manipulators.getItemAt(n).manipulator===i)return r=this._manipulators.splice(n,1)[0],this._detachManipulator(r),r.id;return null},e.prototype.removeAll=function(){var e=this;this._manipulators.forEach((function(t){e._detachManipulator(t)})),this._manipulators.removeAll()},e.prototype.attach=function(){var e=this;this._manipulators.forEach((function(t){e._updateManipulatorAttachment(t)})),this._attached=!0},e.prototype.detach=function(){var e=this;this._manipulators.forEach((function(t){e._detachManipulator(t)})),this._attached=!1},e.prototype.destroy=function(){this._manipulators.forEach((function(e){var t=e.manipulator;t.destroy&&t.destroy()})),this._manipulators.destroy(),this._resourceContexts=null},e.prototype.on=function(e,t){return this._manipulators.on(e,(function(e){t(e)}))},e.prototype.forEach=function(e){for(var t=0,n=this._manipulators.items;t<n.length;t++)e(n[t])},e.prototype.toArray=function(){var e=[];return this.forEach((function(t){return e.push(t.manipulator)})),e},e.prototype.intersect=function(e,t){var n=null,r=Number.MAX_VALUE;return this._manipulators.forEach((function(o){var a=o.id,s=o.manipulator;if(o.attached&&s.interactive){var l=s.intersectionDistance(e,t);i.isSome(l)&&l<r&&(r=l,n=a)}})),n},e.prototype.findById=function(e){if(i.isNone(e))return null;for(var t=0,n=this._manipulators.items;t<n.length;t++){var r=n[t];if(e===r.id)return r.manipulator}return null},e.prototype._updateManipulatorAttachment=function(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)},e.prototype._attachManipulator=function(e){e.attached||(e.manipulator.attach(this._resourceContexts),e.attached=!0)},e.prototype._detachManipulator=function(e){if(e.attached){var t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach(this._resourceContexts),e.attached=!1}},e.prototype._isManipulatorItemVisible=function(e){return 2===e.visibilityPredicate||(this._isToolEditable?0===e.visibilityPredicate:1===e.visibilityPredicate)},e}();t.ManipulatorCollection=o}).apply(null,r))||(e.exports=i)},X5J5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("QDcU"),n("KtQ6"),n("pcDC"),n("XwIv"),n("ycL1"),n("8MXS"),n("Vx27"),n("O7NG"),n("FbvD")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d){function h(e,t){var n=e.clone();return n.a*=t,n}function f(e,t){var n=e.clone(),r=o.toHSV(n);r.s*=t;var i=o.toRGB(r);return n.r=i.r,n.g=i.g,n.b=i.b,n}Object.defineProperty(t,"__esModule",{value:!0}),t.colors={main:new i([255,127,0]),selected:new i([255,255,255]),outline:new i([0,0,0,.5]),selectedOutline:new i([255,255,255])};var v=function(e){function o(n){var r=e.call(this,n)||this;return r.color=t.colors.main,r.height=90,r.coneHeight=40,r.coneWidth=23,r.width=3,r.occludedMode="always",r.enabled="always",r}return r(o,e),Object.defineProperty(o.prototype,"occludedFlag",{get:function(){return T(this.occludedMode)},enumerable:!0,configurable:!0}),n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"color",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:1,max:200,step:1},json:{write:!0}})],o.prototype,"height",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:1,max:60,step:1},json:{write:!0}})],o.prototype,"coneHeight",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:1,max:60,step:1},json:{write:!0}})],o.prototype,"coneWidth",void 0),n([u.property({type:Number,range:{min:0,max:16,step:.5},json:{write:!0}})],o.prototype,"width",void 0),n([u.property({type:["always","transparent","always-transparent"],json:{write:!0}})],o.prototype,"occludedMode",void 0),n([u.property({type:["always","not-grab-z"],json:{write:!0},nonNullable:!0})],o.prototype,"enabled",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.ZManipulatorStyle")],o)}(u.declared(l.JSONSupport)),g=function(e){function o(n){var r=e.call(this,n)||this;return r.size=11,r.outlineSize=1,r.collisionPadding=9,r.color=t.colors.main,r.outlineColor=t.colors.outline,r.occludedMode="always",r.hoverOutlineColor=t.colors.selectedOutline,r}return r(o,e),Object.defineProperty(o.prototype,"renderOccludedFlag",{get:function(){return T(this.occludedMode)},enumerable:!0,configurable:!0}),o.prototype.bindOccludedMode=function(e){var t=this;return c.init(this,"occludedMode",(function(){return e.renderOccluded=t.renderOccludedFlag}))},o.prototype.bindColorMaterial=function(e,t){return s.handlesGroup([c.init(this,e,(function(n){t.setParameterValues({color:D(n),transparent:"color"!==e||n.a<1})})),this.bindOccludedMode(t)])},n([u.property({type:Number,nonNullable:!0,range:{min:1,max:32,step:.5},json:{write:!0}})],o.prototype,"size",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:32,step:.5},json:{write:!0}})],o.prototype,"outlineSize",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:32,step:.5},json:{write:!0}})],o.prototype,"collisionPadding",void 0),n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"color",void 0),n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"outlineColor",void 0),n([u.property({type:["always","transparent"],json:{write:!0}})],o.prototype,"occludedMode",void 0),n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"hoverOutlineColor",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.VertexManipulatorStyle")],o)}(u.declared(l.JSONSupport)),m=function(e){function i(n){var r=e.call(this,n)||this;return r.vertex=new g({color:t.colors.main,outlineColor:t.colors.outline}),r.edge=new g({color:f(h(t.colors.main,2/3),.5),outlineColor:h(t.colors.outline,.5),size:8,collisionPadding:8}),r.selected=new g({color:t.colors.selected,outlineColor:t.colors.outline}),r}return r(i,e),n([u.property({type:g,nonNullable:!0,constructOnly:!0,json:{write:!0}})],i.prototype,"vertex",void 0),n([u.property({type:g,nonNullable:!0,constructOnly:!0,json:{write:!0}})],i.prototype,"edge",void 0),n([u.property({type:g,nonNullable:!0,constructOnly:!0,json:{write:!0}})],i.prototype,"selected",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.ReshapeManipulators")],i)}(u.declared(l.JSONSupport)),y=function(e){function o(n){var r=e.call(this,n)||this;return r.color=t.colors.selected,r.width=1.5,r.stipplePattern="5-5",r.stippleOffColor=t.colors.outline,r.falloff=0,r.innerWidth=1.5,r.innerColor=t.colors.selected,r.occludedMode="transparent",r.occludedLayer="default",r}return r(o,e),o.prototype.bindStyle=function(e){var t=this;return s.handlesGroup([A(this,"color",e,"color",D),A(this,"width",e,"width",C),A(this,"stipplePattern",e,"stipplePattern",R),A(this,"stippleOffColor",e,"stippleOffColor",D),A(this,"falloff",e,"falloff",C),A(this,"innerWidth",e,"innerWidth",C),A(this,"innerColor",e,"innerColor",D),A(this,"occludedMode",e,"occludedMode",(function(e){return T(e,{layer:t.occludedLayer})}))])},n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"color",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:32,step:.5},json:{write:!0}})],o.prototype,"width",void 0),n([u.property({type:String,json:{write:!0,default:null}})],o.prototype,"stipplePattern",void 0),n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"stippleOffColor",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.5},json:{write:!0}})],o.prototype,"falloff",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.5},json:{write:!0}})],o.prototype,"innerWidth",void 0),n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"innerColor",void 0),n([u.property({type:["always","transparent"],json:{write:!0}})],o.prototype,"occludedMode",void 0),n([u.property({type:["default","foreground"],json:{write:!0}})],o.prototype,"occludedLayer",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.LineStyle")],o)}(u.declared(l.JSONSupport)),b=function(e){function o(n){var r=e.call(this,n)||this;return r.color=t.colors.selected,r.size=4,r.outlineSize=1,r.outlineColor=t.colors.outline,r.shape="square",r}return r(o,e),o.prototype.bindStyle=function(e){return s.handlesGroup([A(this,"color",e,"color",D),A(this,"size",e,"size",C),A(this,"outlineSize",e,"outlineSize",C),A(this,"outlineColor",e,"outlineColor",D),A(this,"shape",e,"primitive",C)])},n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"color",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:32,step:.5},json:{write:!0}})],o.prototype,"size",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:32,step:.5},json:{write:!0}})],o.prototype,"outlineSize",void 0),n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"outlineColor",void 0),n([u.property({type:["circle","square","kite","cross","x","triangle"],nonNullable:!0,json:{write:!0}})],o.prototype,"shape",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.PointStyle")],o)}(u.declared(l.JSONSupport)),_=function(e){function o(n){var r=e.call(this,n)||this;return r.innerColor=t.colors.selected,r.innerWidth=1,r.glowColor=t.colors.main,r.glowWidth=8,r.glowFalloff=8,r.globalAlpha=.3,r.globalAlphaContrastBoost=1.5,r.radius=3,r.heightFillColor=t.colors.main,r}return r(o,e),o.prototype.bindStyle=function(e){var t=this,n=1,r=function(){var r={glowColor:i.toUnitRGB(t.glowColor),glowFalloff:t.glowFalloff,glowWidth:t.glowWidth,innerColor:i.toUnitRGB(t.innerColor),innerWidth:t.innerWidth,globalAlpha:t.globalAlpha*n,globalAlphaContrastBoost:t.globalAlphaContrastBoost,intersectsLineRadius:t.radius,heightPlaneFillColor:i.toUnitRGBA(t.heightFillColor)};"style"in e?e.style=r:e.laserlineStyle=r};r();var o=this.watch(this.keys(),r);return{updateGlobalAlpha:function(e){e!==n&&(n=e,r())},remove:function(){o.remove()}}},n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"innerColor",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.5},json:{write:!0}})],o.prototype,"innerWidth",void 0),n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"glowColor",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.5},json:{write:!0}})],o.prototype,"glowWidth",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.5},json:{write:!0}})],o.prototype,"glowFalloff",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:1,step:.01},json:{write:!0}})],o.prototype,"globalAlpha",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:10,step:.25},json:{write:!0}})],o.prototype,"globalAlphaContrastBoost",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.05},json:{write:!0}})],o.prototype,"radius",void 0),n([u.property({type:i,nonNullable:!0,json:{write:!0}})],o.prototype,"heightFillColor",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.LaserlineStyle")],o)}(u.declared(l.JSONSupport)),x=function(e){function i(n){var r=e.call(this,n)||this;return r.outline=new y({color:t.colors.selected,occludedMode:"transparent",occludedLayer:"foreground",stippleOffColor:t.colors.outline,stipplePattern:"5-5",width:1.5}),r.outlineEnabled=!0,r.shadowStyle=new _({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:1}),r.shadowEnabled="always",r}return r(i,e),n([u.property({type:y,constructOnly:!0,nonNullable:!0,json:{write:!0}})],i.prototype,"outline",void 0),n([u.property({type:Boolean,nonNullable:!0,json:{write:!0}})],i.prototype,"outlineEnabled",void 0),n([u.property({type:_,json:{write:!0}})],i.prototype,"shadowStyle",void 0),n([u.property({type:["never","always","grab-xy"],nonNullable:!0,json:{write:!0}})],i.prototype,"shadowEnabled",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.LineGraphics")],i)}(u.declared(l.JSONSupport)),w=function(e){function i(n){var r=e.call(this,n)||this;return r.outline=new b({color:t.colors.selected,outlineColor:t.colors.outline,outlineSize:1,shape:"circle",size:4}),r.outlineEnabled=!0,r.shadowStyle=new _({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:1.5,glowWidth:6,innerColor:t.colors.selected,innerWidth:1,radius:2}),r.shadowEnabled="always",r}return r(i,e),n([u.property({type:b,constructOnly:!0,nonNullable:!0,json:{write:!0}})],i.prototype,"outline",void 0),n([u.property({type:Boolean,nonNullable:!0,json:{write:!0}})],i.prototype,"outlineEnabled",void 0),n([u.property({type:_,json:{write:!0}})],i.prototype,"shadowStyle",void 0),n([u.property({type:["never","always","grab-xy"],nonNullable:!0,json:{write:!0}})],i.prototype,"shadowEnabled",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.PointGraphics")],i)}(u.declared(l.JSONSupport)),S=function(e){function t(t){var n=e.call(this,t)||this;return n.enabled="always",n}return r(t,e),n([u.property({type:["never","always","grab-z"],nonNullable:!0,json:{write:!0}})],t.prototype,"enabled",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.HeightPlane")],t)}(u.declared(_)),P=function(e){function t(t){var n=e.call(this,t)||this;return n.enabled="always",n.infinite="ground",n}return r(t,e),Object.defineProperty(t.prototype,"infiniteType",{get:function(){switch(this.infinite){case"single":return 1;case"double":return 2;case"ground":return 3;default:return a.neverReached(this.infinite),1}},enumerable:!0,configurable:!0}),n([u.property({type:["never","always","grab-z","grab-xy","grab"],nonNullable:!0,json:{write:!0}})],t.prototype,"enabled",void 0),n([u.property({type:["single","double","ground"],nonNullable:!0,json:{write:!0}})],t.prototype,"infinite",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.ZVerticalLine")],t)}(u.declared(y)),O=function(e){function i(n){var r=e.call(this,n)||this;return r.lineGraphics=new x,r.pointGraphics=new w,r.heightPlane=new S({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:1}),r.heightBox=new S({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:0,heightFillColor:t.colors.main}),r.zVerticalLine=new P({color:h(t.colors.main,.5),falloff:2,innerColor:h(t.colors.selected,0),occludedMode:"transparent",stipplePattern:null,width:5,infinite:"ground"}),r.laserlineAlphaMultiplier=1.5,r.heightPlaneAngleCutoff=20,r}return r(i,e),n([u.property({type:x,constructOnly:!0,nonNullable:!0,json:{write:!0}})],i.prototype,"lineGraphics",void 0),n([u.property({type:w,constructOnly:!0,nonNullable:!0,json:{write:!0}})],i.prototype,"pointGraphics",void 0),n([u.property({type:S,constructOnly:!0,nonNullable:!0,json:{write:!0}})],i.prototype,"heightPlane",void 0),n([u.property({type:S,constructOnly:!0,nonNullable:!0,json:{write:!0}})],i.prototype,"heightBox",void 0),n([u.property({type:P,constructOnly:!0,nonNullable:!0,json:{write:!0}})],i.prototype,"zVerticalLine",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:1,max:2,step:.1},json:{write:!0}})],i.prototype,"laserlineAlphaMultiplier",void 0),n([u.property({type:Number,nonNullable:!0,range:{min:0,max:45,step:1},json:{write:!0}})],i.prototype,"heightPlaneAngleCutoff",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.VisualElements")],i)}(u.declared(l.JSONSupport)),M=function(e){function t(t){var n=e.call(this,t)||this;return n.visualElements=new O,n.reshapeManipulators=new m,n.zManipulator=new v,n}return r(t,e),t.prototype.colorToVec4=function(e){return D(e)},n([u.property({type:O,constructOnly:!0,nonNullable:!0,json:{write:!0}})],t.prototype,"visualElements",void 0),n([u.property({type:m,constructOnly:!0,nonNullable:!0,json:{write:!0}})],t.prototype,"reshapeManipulators",void 0),n([u.property({type:v,constructOnly:!0,nonNullable:!0,json:{write:!0}})],t.prototype,"zManipulator",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.settings.Settings")],t)}(u.declared(l.JSONSupport));function A(e,t,n,r,i){return c.init(e,t,(function(e){n[r]=i?i(e):e}))}function C(e){return e}function D(e){return p.vec4f64.fromArray(i.toUnitRGBA(e))}function R(e){if(!e)return null;var t=e.split(/[^0-9]/).map((function(e){return parseFloat(e)}));return d.createStipplePattern(t)}function T(e,t){var n=t&&"foreground"===t.layer;switch(e){case"always":return n?32:16;case"transparent":return n?8:4;case"always-transparent":return 2;default:a.neverReached(e)}return 1}t.settings=new M}).apply(null,r))||(e.exports=i)},X7Ps:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("9opi"),n("qKT0"),n("Gtr7"),n("eIBl"),n("H1tY"),n("qMld"),n("afW+"),n("Vx27"),n("KdBr"),n("X0Jx")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(t){var n=e.call(this,t)||this;return n.attached=!1,n.created=!1,n.completed=!1,n.manipulators=new p.ManipulatorCollection,n.deferCreation=!1,n._editableFlags=new Array,n._manipulatorHandles=new o,n._creationResolver=s.createResolver(),n}return n(t,e),Object.defineProperty(t.prototype,"active",{get:function(){return null!=this.view&&this.view.activeTool===this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSupported",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{set:function(e){this._set("visible",e),e||u.setActive(this,!1),this.attached&&(e?this._show():this._hide())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editable",{get:function(){return this.hasEditableFlag(0)},set:function(e){this.setEditableFlag(0,e)},enumerable:!0,configurable:!0}),t.prototype.attach=function(){!this.attached&&this.isSupported&&(this.manipulators.attach(),this.onAttach(),this.visible&&this.onShow(),this._set("attached",!0))},t.prototype.detach=function(){this.attached&&(this.onHide(),this.onDetach(),this.manipulators.detach(),this._manipulatorHandles.removeAll(),this._set("attached",!1))},t.prototype.handleInputEvent=function(e){this.attached&&this.onInputEvent(e)},t.prototype.destroy=function(){this.manipulators.destroy(),this._manipulatorHandles&&(this._manipulatorHandles.destroy(),this._manipulatorHandles=null),this._set("view",null)},t.prototype.setEditableFlag=function(e,t){this._editableFlags[e]=t,this.manipulators.isToolEditable=this._editableFlags.every((function(e){return null==e||e})),this._updateManipulatorAttachment(),0===e&&this.notifyChange("editable"),this.onEditableChange()},t.prototype.hasEditableFlag=function(e){var t=this._editableFlags[e];return null==t||t},t.prototype.when=function(){return this._creationResolver.promise},t.prototype.rejectCreation=function(e){this._creationResolver.reject(e)},t.prototype.initialize=function(){this.deferCreation||this.complete()},t.prototype.onAttach=function(){},t.prototype.onDetach=function(){},t.prototype.onShow=function(){},t.prototype.onHide=function(){},t.prototype.onEditableChange=function(){},t.prototype.onInputEvent=function(e){},Object.defineProperty(t.prototype,"internallyEditable",{get:function(){return this.hasEditableFlag(0)&&this.hasEditableFlag(1)},enumerable:!0,configurable:!0}),t.prototype.create=function(){var e=this;this.created||(this._set("created",!0),a("esri-native-promise")?this._creationResolver(this):l.schedule((function(){return e._creationResolver(e)})))},t.prototype.complete=function(){this.create(),this._set("completed",!0)},t.prototype._show=function(){this._updateManipulatorAttachment(),this.onShow()},t.prototype._hide=function(){this._updateManipulatorAttachment(),this.onHide()},t.prototype._updateManipulatorAttachment=function(){this.attached&&this.visible?this.manipulators.attach():this.manipulators.detach()},r([c.property({constructOnly:!0})],t.prototype,"view",void 0),r([c.property({dependsOn:["view.activeTool"],readOnly:!0})],t.prototype,"active",null),r([c.property({value:!0})],t.prototype,"visible",null),r([c.property({value:!0})],t.prototype,"editable",null),r([c.property({readOnly:!0})],t.prototype,"attached",void 0),r([c.property({readOnly:!0})],t.prototype,"created",void 0),r([c.property({readOnly:!0})],t.prototype,"completed",void 0),r([c.property({readOnly:!0})],t.prototype,"manipulators",void 0),r([c.property({constructOnly:!0})],t.prototype,"deferCreation",void 0),r([c.subclass("esri.views.interactive.InteractiveToolBase")],t)}(c.declared(i));t.InteractiveToolBase=d}).apply(null,r))||(e.exports=i)},XcBT:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("qKT0"),n("2Atf"),n("KQg4"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("G0ER"),n("qbr3")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return n(r,t),r.prototype.initializeProgram=function(e){var t=r.shader.get().build();return new u(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),c.Default3D)},r.prototype.initializePipeline=function(){return p.makePipelineState(this.configuration.hasAlpha?{blending:p.separateBlendingParams(770,1,771,771),colorWrite:p.defaultColorWriteParams}:{colorWrite:p.defaultColorWriteParams})},r.shader=new a.ReloadableShaderModule(o,"../core/shaderLibrary/util/TextureOnly.glsl",e),r}(s.ShaderTechnique);t.TextureTechnique=d;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasAlpha=!1,t}return n(t,e),r([l.parameter()],t.prototype,"hasAlpha",void 0),t}(l.ShaderTechniqueConfiguration);t.TextureTechniqueConfiguration=h}).apply(null,r))||(e.exports=i)},XsoR:function(e,t,n){var r;void 0===(r=(function(){return function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):(e.raw=t,e)}}).apply(null,[]))||(e.exports=r)},YseA:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){null==e?e=16:e<65536&&(e=n.nextHighestPowerOfTwo(e)),this._array=new Float32Array(e),this._size=0}return e.prototype.resize=function(e,t){if(this._size=e,this._size>this._array.length){for(var n=this._array.length||1;n<this._size;)n*=2;var r=new Float32Array(n);return t&&r.set(this._array),this._array=r,!0}var i=2*this._size;if(i<=this._array.length){for(n=this._array.length;n>=i;)n=Math.floor(n/2);return r=new Float32Array(n),t&&r.set(this._array.subarray(0,n)),this._array=r,!0}return!1},e.prototype.append=function(e){var t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)},e.prototype.erase=function(e,t){for(var n=e;n<t;++n)this._array[n]=0},Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e}();t.ResizableFloat32Array=r}).apply(null,r))||(e.exports=i)},ZJC8:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("AzkI"),n("rjU6"),n("Cvn+"),n("W0kZ"),n("62Ht"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h){var f=function(){function e(t){void 0===t&&(t={}),this._objectTransformation=o.mat4f64.create(),this._bvObjectSpace=new g,this._bvWorldSpace=new g,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._allComponentsHiddenDirty=!0,this._allComponentsVisibleDirty=!0,this.id=e._idGen.gen(t.idHint),this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new v),this.objectTransformation=o.mat4f64.create(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations,t.origins)}return Object.defineProperty(e.prototype,"geometryRecords",{get:function(){return this._geometryRecords},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometries",{get:function(){return this._geometries},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(e){i.mat4.copy(this._objectTransformation,e),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var e=0,t=this._geometryRecords;e<t.length;e++)u.pool.release(t[e]);this._geometryRecords=null,this._geometries=null},e.prototype._initializeGeometryRecords=function(e,t,n,r){if(!Array.isArray(e))return this._geometryRecords=[],void(this._geometries=[]);h.assert(t.length===e.length,"Object3D: materials don't match geometries"),h.assert(n.length===e.length,"Object3D: transformations don't match geometries"),this._geometryRecords=new Array(e.length),this._geometries=e.slice();for(var i=0;i<e.length;i++)this._geometryRecords[i]=u.pool.acquire(e[i],t[i],o.mat4f64.clone(n[i]),{},r&&r[i]);this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){h.assert(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!0,configurable:!0}),e.prototype.getNumGeometryRecords=function(){return this._geometryRecords.length},e.prototype.findGeometryRecords=function(e){for(var t=[],n=0;n<this._geometries.length;n++)this._geometries[n]===e&&t.push(this._geometryRecords[n]);return t},e.prototype.getGeometryRecord=function(e){return h.assert(e>=0&&e<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this._geometryRecords[e]},e.prototype.addGeometry=function(e,t,n,r,i,a){n=n||o.mat4f64.IDENTITY,this._geometries.push(e);var s=u.pool.acquire(e,t,n,r||{},i,a);return this._geometryRecords.push(s),this._hasVolatileTransformation=this._geometryRecords.some((function(e){return!!e.shaderTransformation})),this._notifyDirty("objGeometryAdded",s),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,this._allComponentsVisibleDirty=!0,s},e.prototype.removeGeometry=function(e){var t=this._geometryRecords.splice(e,1)[0];return u.pool.release(t),this._hasVolatileTransformation=this._geometryRecords.some((function(e){return!!e.shaderTransformation})),this._geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,this._allComponentsVisibleDirty=!0,t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this._geometryRecords[e]),this._invalidateBoundingVolume()},e.prototype.isHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1,this._allComponentsHidden=!0;for(var e=0,t=this._geometryRecords;e<t.length;e++){var n=t[e];if(!c.isAllHidden(n.instanceParameters.componentVisibilities,n.geometry.data.componentOffsets)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden},e.prototype.isVisible=function(){if(this._allComponentsVisibleDirty){this._allComponentsVisibleDirty=!1,this._allComponentsVisible=!0;for(var e=0,t=this._geometryRecords;e<t.length;e++){var n=t[e];if(!c.isAllVisible(n.instanceParameters.componentVisibilities,n.geometry.data.componentOffsets)){this._allComponentsVisible=!1;break}}}return this._allComponentsVisible},e.prototype.hide=function(){if(this._allComponentsHiddenDirty||!this._allComponentsHidden){for(var e=0,t=this._geometryRecords;e<t.length;e++){var n=t[e],r=c.hideAllComponents(n.instanceParameters.componentVisibilities);n.instanceParameters.componentVisibilities=r}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!1,this._allComponentsVisibleDirty=!1,this._allComponentsHidden=!0,this._allComponentsVisible=!1}},e.prototype.unhide=function(){if(this._allComponentsVisibleDirty||!this._allComponentsVisible){for(var e=0,t=this._geometryRecords;e<t.length;e++){var n=t[e],r=c.unhideAllComponents(n.instanceParameters.componentVisibilities);n.instanceParameters.componentVisibilities=r}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!1,this._allComponentsVisibleDirty=!1,this._allComponentsHidden=!1,this._allComponentsVisible=!0}},e.prototype.occlude=function(){for(var e=d.generateObject3DStateId(1),t=0,n=this._geometryRecords;t<n.length;t++){var r=n[t];r.instanceParameters.occludees=c.addOccludee(r.instanceParameters.occludees,e)}return this._notifyDirty("occlusionChanged"),e},e.prototype.removeOcclude=function(e){for(var t=0,n=this._geometryRecords;t<n.length;t++){var r=n[t];r.instanceParameters.occludees=c.removeOccludee(r.instanceParameters.occludees,e)}this._notifyDirty("occlusionChanged")},e.prototype.highlight=function(){for(var e=d.generateObject3DStateId(0),t=0,n=this._geometryRecords;t<n.length;t++){var r=n[t];r.instanceParameters.componentHighlights=c.addHighlight(r.instanceParameters.componentHighlights,null,e)}return this._notifyDirty("highlightChanged"),e},e.prototype.removeHighlight=function(e){for(var t=0,n=this._geometryRecords;t<n.length;t++){var r=n[t];r.instanceParameters.componentHighlights=c.removeHighlight(r.instanceParameters.componentHighlights,e)}this._notifyDirty("highlightChanged")},e.prototype.getComponentFromTriangleNr=function(e,t){return h.assert(e>=0&&e<this._geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range"),c.componentFind(this._geometryRecords[e].geometry.data.componentOffsets,3*t)},e.prototype.setGeometryTransformation=function(e,t){h.assert(e>=0&&e<this._geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var n=this._geometryRecords[e];u.pool.release(n);var r=u.pool.acquire(n.geometry,n.material,o.mat4f64.clone(t),n.instanceParameters);this._geometryRecords[e]=r,this._notifyDirty("objGeometryReplaced",[n,r]),this._invalidateBoundingVolume()},e.prototype.getCombinedStaticTransformation=function(e,t){return i.mat4.multiply(r.unwrapOr(t,o.mat4f64.create()),this.objectTransformation,e.getStaticTransformation())},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||o.mat4f64.create(),i.mat4.multiply(t,this.objectTransformation,e.getShaderTransformation()),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this._geometryRecords.length;++e){var t=this._geometries[e],n=this._geometryRecords[e],r=t.boundingInfo;this._calculateTransformedBoundingVolume(r,this._bvObjectSpace,n.getShaderTransformation()),this._calculateTransformedBoundingVolume(r,this._bvWorldSpace,this.getCombinedShaderTransformation(n))}a.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5),a.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);var i=s.vec3f64.create(),o=s.vec3f64.create(),c=l.maxScale(this.objectTransformation);for(e=0;e<this._geometryRecords.length;++e){t=this._geometries[e];var u=this._geometryRecords[e].getShaderTransformation(),p=l.maxScale(u);a.vec3.transformMat4(i,(r=t.boundingInfo).getCenter(),u);var d=a.vec3.distance(i,this._bvObjectSpace.center),h=r.getBSRadius()*p;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,d+h),a.vec3.transformMat4(o,i,this.objectTransformation);var f=a.vec3.distance(o,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,f+h*c)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,n){var r=e.getBBMin(),i=e.getBBMax(),o=s.vec3f64.clone(r),l=s.vec3f64.clone(i);a.vec3.transformMat4(o,o,n),a.vec3.transformMat4(l,l,n);for(var c=0;c<3;++c)t.bbMin[c]=Math.min(t.bbMin[c],o[c],l[c]),t.bbMax[c]=Math.max(t.bbMax[c],o[c],l[c]);for(c=0;c<3;++c){a.vec3.copy(o,r),a.vec3.copy(l,i),o[c]=i[c],l[c]=r[c],a.vec3.transformMat4(o,o,n),a.vec3.transformMat4(l,l,n);for(var u=0;u<3;++u)t.bbMin[u]=Math.min(t.bbMin[u],o[u],l[u]),t.bbMax[u]=Math.max(t.bbMax[u],o[u],l[u])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,n,r){this._parentLayer&&this._parentLayer.notifyDirty(e,t,n=n||1,r||this)},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{hasGeometry:function(t){return e._geometries.indexOf(t)>-1},getGeometryIndex:function(t){return e._geometries.indexOf(t)}}},enumerable:!0,configurable:!0}),e._idGen=new p.IdGen,e}(),v=function(){function e(){this.bbMin=s.vec3f64.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.bbMax=s.vec3f64.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return e.prototype.isEmpty=function(){return this.bbMax[0]<this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<this.bbMin[2]},e}(),g=function(e){function t(){var t=e.call(this)||this;return t.center=s.vec3f64.create(),t.bsRadius=0,t}return n(t,e),t.prototype.init=function(){a.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a.vec3.set(this.center,0,0,0),this.bsRadius=0},t.prototype.getCenter=function(){return this.center},t.prototype.getBSRadius=function(){return this.bsRadius},t}(v);return f}).apply(null,r))||(e.exports=i)},ZO6V:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("KY0m"),n("BcWh"),n("Rdxj"),n("W0kZ"),n("mYMs")],void 0===(i=(function(e,t,n,r,i,o,a,s){return function(e){function t(n,r,i){var a=e.call(this)||this;return a._parentStages=new Map,a._objects=new Set,a.id=t._idGen.gen(n),a.apiLayerUid=i,a.name=n,a.group=(r=r||{}).group||"",a.isVisible=null==r.isVisible||r.isVisible,a.isPickable=null==r.isPickable||r.isPickable,a.isSliceable=!1,a.translation=r.translation?o.vec3f64.clone(r.translation):o.vec3f64.create(),a}return n(t,e),t.prototype.addParentStage=function(e){if(!this._parentStages.has(e)){var t=this.on("dirty",(function(t){e.notifyDirty(t.origin,t.dirtyType,t.subObject)}));this._parentStages.set(e,t)}},t.prototype.removeParentStage=function(e){var t=this._parentStages.get(e);t&&(t.remove(),this._parentStages.delete(e)),this.invalidateSpatialQueryAccelerator()},t.prototype.getName=function(){return this.name},t.prototype.getGroup=function(){return this.group},t.prototype.getTranslation=function(){return this.translation},t.prototype.getObjectIds=function(){return r.keysOfSet(this._objects,(function(e){return e.id}))},t.prototype.getObjects=function(){return r.keysOfSet(this._objects)},t.prototype.addObject=function(e){this._objects.add(e),e.parentLayer=this,this.notifyDirty("layerObjectAdded",e),this._octree&&this._octree.add(e)},t.prototype.hasObject=function(e){return this._objects.has(e)},t.prototype.removeObject=function(e){return!!this._objects.delete(e)&&(e.parentLayer=null,this.notifyDirty("layerObjectRemoved",e),this._octree&&this._octree.remove(e),!0)},t.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},t.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._objects.size>50&&this._createOctree(),this._octree},t.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},t.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)},t.prototype.notifyDirty=function(e,t,n,r){n=n||0,this.emit("dirty",{origin:r||this,dirtyType:e,subObject:t})},t.prototype._createOctree=function(){this._octree=new s({getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(r.keysOfSet(this._objects))},t._idGen=new a.IdGen,t}(i)}).apply(null,r))||(e.exports=i)},ZeO9:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("R2Zq"),n("LxLY"),n("FXVB"),n("1m5D"),n("MzcX"),n("ff/U"),n("AASg"),n("YseA"),n("CIy2"),n("CP88"),n("pbva"),n("PwS/"),n("QFi0"),n("Kfys"),n("z2+Q")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g){var m=function(){function e(e,t,n,r){void 0===r&&(r=s.Default3D),this.type="MergedRenderer",this._dataByOrigin=new Map,this._highlightCount=0,this._hasOccludees=!1,this._rctx=e,this._vertexAttributeLocations=r,this._material=n,this._materialRep=t,this._glMaterials=h.acquireMaterials(this._material,this._materialRep),this._bufferWriter=n.createBufferWriter()}return e.prototype.dispose=function(){h.releaseMaterials(this._material,this._materialRep)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlightCount>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasOccludees",{get:function(){return this._hasOccludees},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasWater",{get:function(){return!this.isEmpty&&n.someMap(this._glMaterials,(function(e){return e instanceof p.WaterGLMaterial}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rendersOccluded",{get:function(){return!this.isEmpty&&1!==this._material.renderOccluded},enumerable:!0,configurable:!0}),e.prototype.modify=function(e){var t=this,n=w;n.clear(),this.updateGeometries(e.toUpdate,n),this.addAndRemoveGeometries(e.toAdd,e.toRemove,n),this.updateHighlightCount(),this.updateOccludeeFlag(),n.forEach((function(e){return t.updateDisplayedIndexRanges(e)}))},e.prototype.addAndRemoveGeometries=function(e,t,n){var r=this,i=this._bufferWriter,o=i.vertexBufferLayout,a=o.stride/4,s=this._dataByOrigin,l=function(e,t,n,r){for(var i=new Map,o=t.vertexBufferLayout.stride/4,a=function(n,r){var a=n.origin,s=e.get(a.id),l=i.get(a.id);null==l&&i.set(a.id,l={optimalCount:null==s?0:s.optimalCount,sparseCount:null==s?0:s.buffer.size,toAdd:[],toRemove:[],origin:a.vec3});var c=t.elementCount(n.data)*o;r?(l.optimalCount+=c,l.sparseCount+=c,l.toAdd.push(n)):(l.optimalCount-=c,l.toRemove.push(n))},s=0,l=n;s<l.length;s++){var c=l[s];a(c,!0)}for(var u=0,p=r;u<p.length;u++)a(c=p[u],!1);return i}(s,i,e,t);l.forEach((function(e,t){l.delete(t);var i=e.optimalCount,c=e.sparseCount,p=s.get(t);if(null==p&&(u.assert(i>0),p=r.createData(o,i,e.origin),s.set(t,p)),0===i)return p.vao.dispose(!0),p.vao=null,void s.delete(t);var d=i<e.sparseCount/2,h=y,f=p.buffer.size,v=p.buffer.array,g=p.buffer.resize(d?i:c,!1);d||g?r.removeAndRebuild(p,e.toRemove,a,v,h):e.toRemove.length>0?(r.removeByErasing(p,e.toRemove,a,h),e.toAdd.length>0&&(h.end=f)):(h.begin=f,h.end=f);var m=b;u.setMatrixTranslation3(m,-e.origin[0],-e.origin[1],-e.origin[2]),r.append(p,e.toAdd,a,m,h);var _=p.vao.vertexBuffers.geometry;if(_.byteSize!==p.buffer.array.buffer.byteLength)_.setData(p.buffer.array);else{var x=h.begin,w=h.end;if(x<w){var S=4*x;_.setSubData(p.buffer.array,S,S,4*w)}}(h.updatedDisplayedIndexRange||p.displayedIndexRanges)&&n.add(p)}))},e.prototype.updateGeometries=function(e,t){for(var n=this._bufferWriter,r=n.vertexBufferLayout.stride/4,i=0,o=e;i<o.length;i++){var a=o[i],s=a.updateType,l=a.renderGeometry,c=this._dataByOrigin.get(l.origin.id),p=c&&c.instances.get(l.uniqueName);if(!p)return;if(1&s&&(p.isHidden=h.checkIsHidden(l),t.add(c)),9&s&&(p.highlightedIndexRanges=h.generateRenderGeometryHighlightRanges(l),c.highlightCount=null),16&s&&(p.hasOccludees=!!l.instanceParameters.occludees),6&s){var d=c.buffer.array,f=c.vao;h.calculateTransformRelToOrigin(l,_,x),n.write({transformation:_,invTranspTransformation:x},l.data,n.vertexBufferLayout.createView(d.buffer),p.from),u.assert(p.from+n.elementCount(l.data)===p.to,"material VBO layout has changed"),f.vertexBuffers.geometry.setSubData(d,p.from*r*4,p.from*r*4,p.to*r*4)}}},e.prototype.updateDisplayedIndexRanges=function(e){e.displayedIndexRanges=[];var t=!0;e.instances.forEach((function(n){n.isHidden?t=!1:e.displayedIndexRanges.push([n.from,n.to-1])})),e.displayedIndexRanges=t?null:l.mergeIntervals(e.displayedIndexRanges)},e.prototype.updateHighlightCount=function(){var e=this;this._highlightCount=0,this._dataByOrigin.forEach((function(t){if(null==t.highlightCount){var n=0;t.instances.forEach((function(e){e.highlightedIndexRanges&&++n})),t.highlightCount=n}e._highlightCount+=t.highlightCount}))},e.prototype.updateOccludeeFlag=function(){this._hasOccludees=n.someMap(this._dataByOrigin,(function(e){return e.hasOccludees=n.someMap(e.instances,(function(e){return e.hasOccludees})),e.hasOccludees}))},e.prototype.updateLogic=function(e){return this._material.update(e)},e.prototype.render=function(e,t,n,r){var i=this,a=this._rctx,s=this._glMaterials.get(t.pass),l=4===t.pass,c=e;if(2===t.pass&&null===c&&(c=22),!s||2!==s.ensureResources(a)||null!=c&&!s.beginSlot(c)||l&&0===this._highlightCount)return!1;s.ensureParameters(n);var u=s.getTechnique(),p=s.getPipelineState(c,!1);a.setPipelineState(p),s.bind(a,n),u.program.setUniformMatrix4fv("model",o.mat4f64.IDENTITY),u.program.hasUniform("modelNormal")&&u.program.setUniformMatrix4fv("modelNormal",o.mat4f64.IDENTITY);var d=!1;return this._dataByOrigin.forEach((function(e){if(!l||0!==e.highlightCount)if(n.origin=e.origin,u.bindDraw(n),u.ensureAttributeLocations(e.vao),a.bindVAO(e.vao),l)d=i.renderHighlightPass(u,e,r)||d;else if(e.hasOccludees){var t=s.getPipelineState(c,!0);d=i.renderDefaultPassWithOccludees(u,e,p,t,r)||d}else d=i.renderDefaultPass(u,e,r)||d})),d},e.prototype.renderDefaultPass=function(e,t,n){var r=this._rctx,i=t.displayedIndexRanges;if(i&&0===i.length)return!1;if(i)h.drawArraysFaceRange(r,i,0,e.primitiveType,n);else{var o=4*t.buffer.size/v.getStride(t.vao.layout.geometry);h.drawArrays(r,e.primitiveType,0,o,n)}return!0},e.prototype.renderDefaultPassWithOccludees=function(e,t,n,r,i){var o=this._rctx,a=t.displayedIndexRanges;return!(a&&0===a.length||(t.instances.forEach((function(t){t.isHidden||(t.hasOccludees&&o.setPipelineState(r),h.drawArrays(o,e.primitiveType,t.from,t.to-t.from,i),t.hasOccludees&&o.setPipelineState(n))})),0))},e.prototype.renderHighlightPass=function(e,t,n){var r=this._rctx,i=!1;return t.instances.forEach((function(t){var o=t.highlightedIndexRanges;if(o&&0!==o.length)for(var a=0;a<o.length;a++){var s=o[a];h.drawArrays(r,e.primitiveType,s?s[0]+t.from:t.from,s?s[1]-s[0]+1:t.to-t.from,n),i=!0}})),i},e.prototype.createData=function(e,t,n){return{instances:new Map,vao:new g(this._rctx,this._vertexAttributeLocations,{geometry:a.glLayout(e)},{geometry:f.createVertex(this._rctx,35044)}),buffer:new c.ResizableFloat32Array(t),optimalCount:0,origin:n,highlightCount:0,hasOccludees:!1}},e.prototype.removeAndRebuild=function(e,t,n,r,i){for(var o=0,a=t;o<a.length;o++){var s=a[o].uniqueName,l=e.instances.get(s);e.optimalCount-=(l.to-l.from)*n,e.instances.delete(s)}var c=0,u=e.buffer.array;i.begin=0,i.end=0;var p=-1,d=-1,h=0;e.instances.forEach((function(e){var t=e.from*n,i=e.to*n,o=i-t;p!==d&&d!==t?(u.set(r.subarray(p,d),h),h+=d-p,p=t):-1===p&&(p=t),d=i,e.from=c/n,e.to=(c+=o)/n})),p!==d&&u.set(r.subarray(p,d),h),i.end=c},e.prototype.removeByErasing=function(e,t,n,r){r.begin=1/0,r.end=-1/0;for(var i=-1,o=-1,a=0,s=t;a<s.length;a++){var l=s[a].uniqueName,c=e.instances.get(l),u=c.from*n,p=c.to*n;i!==o&&o!==u?(e.buffer.erase(i,o),i=u):-1===i&&(i=u),o=p,e.instances.delete(l),e.optimalCount-=p-u,u<r.begin&&(r.begin=u),p>r.end&&(r.end=p)}i!==o&&e.buffer.erase(i,o)},e.prototype.append=function(e,t,n,o,a){a.updatedDisplayedIndexRange=!1;for(var s=this._bufferWriter,l=0,c=t;l<c.length;l++){var p=c[l],f=p.data,v=r.isSome(p.transformation)?i.mat4.multiply(_,o,p.transformation):o;i.mat4.invert(x,v),i.mat4.transpose(x,x);var g=a.end;s.write({transformation:v,invTranspTransformation:x},f,s.vertexBufferLayout.createView(e.buffer.array.buffer),a.end/n);var m=s.elementCount(f)*n,y=g+m;u.assert(null==e.instances.get(p.uniqueName));var b=h.checkIsHidden(p),w=h.generateRenderGeometryHighlightRanges(p),S=!!p.instanceParameters.occludees;w&&(e.highlightCount=null),S&&(e.hasOccludees=e.hasOccludees||!0);var P=new d.Instance(g/n,y/n,b,w,S);e.instances.set(p.uniqueName,P),b&&(a.updatedDisplayedIndexRange=!0),e.optimalCount+=m,a.end+=m}},Object.defineProperty(e.prototype,"test",{get:function(){return{material:this._material}},enumerable:!0,configurable:!0}),e}(),y={updatedDisplayedIndexRange:!1,begin:0,end:0},b=o.mat4f64.create(),_=o.mat4f64.create(),x=o.mat4f64.create(),w=new Set;return m}).apply(null,r))||(e.exports=i)},aExC:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qsST"),n("R2Zq"),n("ULaq")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=n.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder"),a=function(){function e(){this.vertex=new c,this.fragment=new c,this.attributes=new u,this.varyings=new p,this.extensions=new d,this.defines=new h,this._includedModules=new Map}return e.prototype.include=function(e,t){this._includedModules.has(e)?this._includedModules.get(e)!==t&&o.error("Trying to include shader module multiple times with different sets of options."):(this._includedModules.set(e,t),"shaderModule"in e?e.shaderModule(this,t):e(this,t))},e.prototype.generateSource=function(e){var t=this.extensions.generateSource(e),n=this.attributes.generateSource(e),r=this.varyings.generateSource(),i="vertex"===e?this.vertex:this.fragment,o=i.uniforms.generateSource(),a=i.code.generateSource(),s="vertex"===e?v:f,l=this.defines.generateSource().concat(i.defines.generateSource());return"\n"+t.join("\n")+"\n\n"+l.join("\n")+"\n\n"+s+"\n\n"+o.join("\n")+"\n\n"+n.join("\n")+"\n\n"+r.join("\n")+"\n\n"+a.join("\n")},e}();t.ShaderBuilder=a;var s=function(){function e(){this._entries=new Array,this._set=new Set}return e.prototype.add=function(e,t,n){var r=e+"_"+t+"_"+n;return this._set.has(r)||(this._entries.push([e,t,n]),this._set.add(r)),this},e.prototype.generateSource=function(){return this._entries.map((function(e){return"uniform "+e[1]+" "+e[0]+((t=e[2])?"["+t+"]":"")+";";var t}))},e}(),l=function(){function e(){this._entries=new Array}return e.prototype.add=function(e){this._entries.push(e)},e.prototype.generateSource=function(){return this._entries},e}(),c=function(){this.uniforms=new s,this.code=new l,this.defines=new h},u=function(){function e(){this._entries=new Array}return e.prototype.add=function(e,t){this._entries.push([e,t])},e.prototype.generateSource=function(e){return"fragment"===e?[]:this._entries.map((function(e){return"attribute "+e[1]+" "+e[0]+";"}))},e}(),p=function(){function e(){this._entries=new Array}return e.prototype.add=function(e,t){this._entries.push([e,t])},e.prototype.generateSource=function(){return this._entries.map((function(e){return"varying "+e[1]+" "+e[0]+";"}))},e}(),d=function(){function e(){this._entries=new Set}return e.prototype.add=function(e){this._entries.add(e)},e.prototype.generateSource=function(t){var n="vertex"===t?e.WHITELIST_VERTEX:e.WHITELIST_FRAGMENT;return i.valuesOfSet(this._entries).filter((function(e){return n.indexOf(e)>=0})).map((function(e){return"#extension "+e+" : enable"}))},e.WHITELIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],e.WHITELIST_VERTEX=[],e}(),h=function(){function e(){this._entries=new Map}return e.prototype.addInt=function(e,t){var n=t%1==0?t.toFixed(0):t.toString();this._entries.set(e,n)},e.prototype.addFloat=function(e,t){var n=t%1==0?t.toFixed(1):t.toString();this._entries.set(e,n)},e.prototype.generateSource=function(){return r.pairsOfMap(this._entries).map((function(e){return"#define "+e[0]+" "+e[1]}))},e}(),f="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",v="precision highp float;\nprecision highp sampler2D;"}).apply(null,r))||(e.exports=i)},aRjO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.HUDOcclusionPass=function(e){var t=e;t.vertex.code.add(r.glsl(i||(i=n(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "],["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])))),t.fragment.uniforms.add("color","vec4"),t.fragment.code.add(r.glsl(o||(o=n(["\n  void main() {\n    gl_FragColor = color;\n  }\n  "],["\n  void main() {\n    gl_FragColor = color;\n  }\n  "]))))},function(e){e.bindUniforms=function(e){e.setUniform4f("color",1,1,1,1)}}(t.HUDOcclusion||(t.HUDOcclusion={}))}).apply(null,r))||(e.exports=i)},ama6:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("51bw"),n("vlC2")],void 0===(i=(function(e,t,n,r){var i;return function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:r.vec3f32.fromValues(1,1,1),vvSizeMaxSize:r.vec3f32.fromValues(100,100,100),vvSizeOffset:r.vec3f32.fromValues(0,0,0),vvSizeFactor:r.vec3f32.fromValues(1,1,1),vvSizeValue:r.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:n.mat3f64.create()}}(i||(i={})),i}).apply(null,r))||(e.exports=i)},as1Q:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.resourceFactory=e,this._resources=null,this._hidden=!1,this._attached=!1}return e.prototype.destroy=function(){this._destroyResources()},Object.defineProperty(e.prototype,"resources",{get:function(){return n.isSome(this._resources)?this._resources.external:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this._hidden},set:function(e){e!==this._hidden&&(this._hidden=e,this._syncGeometriesToRenderer())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())},enumerable:!0,configurable:!0}),e.prototype.recreate=function(){this.attached&&this._createResources()},e.prototype.recreateGeometry=function(){this.resourceFactory.recreateGeometry?n.isNone(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()},e.prototype._createOrDestroyResources=function(){this._attached?n.isNone(this._resources)&&this._createResources():this._destroyResources()},e.prototype._createResources=function(){this._destroyResources();var e=this.resourceFactory.createResources();this._resources={layerView:{view:this.resourceFactory.view,notifyGraphicUpdate:function(){},watch:function(){return{remove:function(){}}}},external:e,geometriesAdded:!1},this._syncGeometriesToRenderer()},e.prototype._destroyResources=function(){n.isNone(this._resources)||(this.ensureRenderGeometriesRemoved(),this._resources=null)},e.prototype._syncGeometriesToRenderer=function(){this._hidden?this.ensureRenderGeometriesRemoved():this._hidden||this.ensureRenderGeometriesAdded()},e.prototype.ensureRenderGeometriesRemoved=function(){n.isNone(this._resources)||this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)},e.prototype.ensureRenderGeometriesAdded=function(){n.isNone(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)},e}();t.DrapedVisualElementResources=r}).apply(null,r))||(e.exports=i)},cj3m:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("DKwL"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){function o(e){e.include(r.RgbaFloatEncoding),e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("shadowMapNum","int"),e.fragment.uniforms.add("shadowMapDistance","vec4"),e.fragment.uniforms.add("shadowMapMatrix","mat4",4),e.fragment.uniforms.add("depthHalfPixelSz","float"),e.fragment.code.add(i.glsl(a||(a=n(["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize = depthHalfPixelSz;\n      vec4 distance = shadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      if (i >= shadowMapNum) { return 0.0; }\n\n      mat4 mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n\n      // vertex completely outside? -> no shadow\n      vec3 lvpos = 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "],["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize = depthHalfPixelSz;\n      vec4 distance = shadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      if (i >= shadowMapNum) { return 0.0; }\n\n      mat4 mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n\n      // vertex completely outside? -> no shadow\n      vec3 lvpos = 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "]))))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.ReadShadowMap=o,function(e){e.bindUniforms=function(e,t,n){t.shadowMappingEnabled&&(t.shadowMap.bind(e,n),t.shadowMap.bindView(e,t.origin))},e.bindViewCustomOrigin=function(e,t,n){t.shadowMappingEnabled&&t.shadowMap.bindView(e,n)},e.bindView=function(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}}(o=t.ReadShadowMap||(t.ReadShadowMap={}))}).apply(null,r))||(e.exports=i)},cjy9:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("CIzB"),n("AzkI"),n("rjU6"),n("+nCE"),n("62Ht"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d){return function(){function e(e,t,n,r,i,o,s){this.uniqueName=null,this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.componentOffsets=e.componentOffsets,this.boundingInfo=t,this.material=n,this.origin=null,this.center=a.vec3f64.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=i,r&&this.updateTransformation(r,o),this.castShadow=s,this.instanceParameters={}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,n){return t=t||l.maxScale(e),o.vec3.transformMat4(n,this.boundingInfo.getCenter(),e),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentCount",{get:function(){return c.componentCount(this.componentOffsets)},enumerable:!0,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=i.mat4f64.create()),r.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(n.unwrapOr(this.transformation,s.IDENTITY))),this.shaderTransformationDirty=!1),this.shaderTransformation):n.unwrapOr(this.transformation,s.IDENTITY)},e.prototype.computeAttachmentOrigin=function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(n.isSome(this.transformation)&&o.vec3.transformMat4(e,e,this.transformation),!0);var t=this.getIndices(d.VertexAttrConstants.POSITION),r=this.getAttribute(d.VertexAttrConstants.POSITION);return!!u.computeAttachmentOriginTriangles(r,t,e)&&(n.isSome(this.transformation)&&o.vec3.transformMat4(e,e,this.transformation),!0)},e.prototype.getIndices=function(e){return"indices"in this.data?this.data.indices[e]:null},e.prototype.getAttribute=function(e){return"vertexAttr"in this.data?this.data.vertexAttr[e]:null},e.prototype.addHighlight=function(){var e=p.generateObject3DStateId(0),t=this.instanceParameters;return t.componentHighlights=c.addHighlight(t.componentHighlights,null,e),e},e.prototype.removeHighlight=function(e){var t=this.instanceParameters;t.componentHighlights=c.removeHighlight(t.componentHighlights,e)},e}()}).apply(null,r))||(e.exports=i)},cmSR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.ForwardLinearDepth=function(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(r.glsl(i||(i=n(["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "],["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "]))))):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("uCameraNearFar","vec2"),e.vertex.code.add(r.glsl(o||(o=n(["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "],["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "]))))):e.vertex.code.add(r.glsl(a||(a=n(["\n      void forwardLinearDepth() {}\n    "],["\n      void forwardLinearDepth() {}\n    "]))))}}).apply(null,r))||(e.exports=i)},d0uo:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("2Atf"),n("pcDC"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("8MXS"),n("Vx27"),n("0LE5"),n("ZcgO"),n("DtIM"),n("woUR"),n("5T2R"),n("uiHv"),n("1eTA"),n("X5J5"),n("G+tB"),n("TCLX"),n("Fe95"),n("BhkK"),n("dtql"),n("73uV"),n("R4nD"),n("/NuL"),n("JjCO"),n("ys4y"),n("4ziW")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w,S,P,O,M,A,C,D,R){Object.defineProperty(t,"__esModule",{value:!0});var T=function(e){function t(t){var n=e.call(this,t)||this;return n._vertexManipulatorMaterial=g.createManipulatorMaterial(b.settings.colorToVec4(b.settings.reshapeManipulators.vertex.color),b.settings.reshapeManipulators.vertex.renderOccludedFlag),n._vertexManipulatorOutlineMaterial=g.createManipulatorOutlineMaterial(b.settings.colorToVec4(b.settings.reshapeManipulators.vertex.outlineColor),b.settings.reshapeManipulators.vertex.renderOccludedFlag),n._vertexManipulatorHoverOutlineMaterial=g.createManipulatorOutlineMaterial(b.settings.colorToVec4(b.settings.reshapeManipulators.vertex.hoverOutlineColor),b.settings.reshapeManipulators.vertex.renderOccludedFlag),n._edgeManipulatorMaterial=g.createManipulatorMaterial(b.settings.colorToVec4(b.settings.reshapeManipulators.edge.color),b.settings.reshapeManipulators.edge.renderOccludedFlag),n._edgeManipulatorOutlineMaterial=g.createManipulatorOutlineMaterial(b.settings.colorToVec4(b.settings.reshapeManipulators.edge.outlineColor),b.settings.reshapeManipulators.edge.renderOccludedFlag),n._selectedManipulatorMaterial=g.createManipulatorMaterial(b.settings.colorToVec4(b.settings.reshapeManipulators.selected.color),b.settings.reshapeManipulators.selected.renderOccludedFlag),n._selectedManipulatorOutlineMaterial=g.createManipulatorOutlineMaterial(b.settings.colorToVec4(b.settings.reshapeManipulators.selected.outlineColor),b.settings.reshapeManipulators.selected.renderOccludedFlag),n._selectedManipulatorHoverOutlineMaterial=g.createManipulatorOutlineMaterial(b.settings.colorToVec4(b.settings.reshapeManipulators.selected.hoverOutlineColor),b.settings.reshapeManipulators.selected.renderOccludedFlag),n._selectedIndex=0,n._vertexManipulatorGeometry=null,n._vertexManipulatorOutlineGeometry=null,n._edgeManipulatorGeometry=null,n._edgeManipulatorOutlineGeometry=null,n._handles=new s,n._manipulatorHandles=new s,n._manipulatorInfos=[],n._reshapeHelper=null,n._graphicMoveManipulation=null,n._moveManipulation=null,n._numGrabbing=0,n._numDragging=0,n._reshapeEventState=0,n._outlineVisualElement=null,n.tool=null,n.outputGeometry=null,n._vertexLaserLineVisualElement=null,n._emitter.target=null,n}return r(t,e),t.prototype.initialize=function(){var e=this,t=new A.GraphicState({graphic:this.graphic});this._graphicState=t,this._handles.add([t.watch("displaying",(function(t){for(var n=0,r=e._manipulatorInfos;n<r.length;n++)r[n].manipulator.available=t})),b.settings.zManipulator.watch(b.settings.zManipulator.keys(),(function(){return e._recreateManipulators()})),b.settings.reshapeManipulators.vertex.watch(["size","outlineSize","collisionPadding"],(function(){e._vertexManipulatorGeometry=null,e._vertexManipulatorOutlineGeometry=null,e._recreateManipulators()})),b.settings.reshapeManipulators.edge.watch(["size","outlineSize","collisionPadding"],(function(){e._edgeManipulatorGeometry=null,e._edgeManipulatorOutlineGeometry=null,e._recreateManipulators()})),b.settings.reshapeManipulators.watch("hoverSize",(function(){return e._recreateManipulators()})),b.settings.reshapeManipulators.vertex.bindColorMaterial("color",this._vertexManipulatorMaterial),b.settings.reshapeManipulators.vertex.bindColorMaterial("outlineColor",this._vertexManipulatorOutlineMaterial),b.settings.reshapeManipulators.vertex.bindColorMaterial("hoverOutlineColor",this._vertexManipulatorHoverOutlineMaterial),b.settings.reshapeManipulators.edge.bindColorMaterial("color",this._edgeManipulatorMaterial),b.settings.reshapeManipulators.edge.bindColorMaterial("outlineColor",this._edgeManipulatorOutlineMaterial),b.settings.reshapeManipulators.selected.bindColorMaterial("color",this._selectedManipulatorMaterial),b.settings.reshapeManipulators.selected.bindColorMaterial("outlineColor",this._selectedManipulatorOutlineMaterial),b.settings.reshapeManipulators.selected.bindColorMaterial("hoverOutlineColor",this._selectedManipulatorHoverOutlineMaterial),this.view.trackGraphicState(t)])},t.prototype.destroy=function(){this._clear(),this._handles.destroy()},Object.defineProperty(t.prototype,"inputGeometry",{get:function(){return c.isSome(this._reshapeHelper)?this._reshapeHelper.geometry:null},set:function(e){this._recreateManipulators(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manipulators",{get:function(){return this.tool.manipulators},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.tool.view},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphic",{get:function(){return this.tool.graphic},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableZ",{get:function(){return this.tool.enableZ},enumerable:!0,configurable:!0}),t.prototype.removeSelectedVertices=function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.handle.type}));this._removeVertices(e)},t.prototype.manipulatorSelectionChanged=function(){this.emit("manipulators-changed")},t.prototype._clear=function(){this._moveManipulation&&this._moveManipulation.destroy(),this._graphicMoveManipulation&&this._graphicMoveManipulation.destroy(),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._graphicMoveManipulation=null,this._moveManipulation=null,this._reshapeHelper=null,this._numGrabbing=0,this._numDragging=0},t.prototype._recreateManipulators=function(e){if(void 0===e&&(e=this.inputGeometry),this._clear(),this._reshapeHelper=x.createReshapeHelper(e,"global"===this.view.viewingMode),!c.isNone(this._reshapeHelper)){for(var t=f.getGraphicEffectiveElevationInfo(this.graphic),n=0,r=this._reshapeHelper.components;n<r.length;n++){for(var i=r[n],o=0,a=i.vertices;o<a.length;o++)this._createPerVertexManipulator(a[o],t);for(var s=0,l=i.edges;s<l.length;s++)this._createPerVertexManipulator(l[s],t)}this._createGraphicMoveManipulators(t)}},t.prototype._perGraphicManipulatorDragAction=function(e,t){if("end"!==t.action){for(var n=[],r=this._manipulatorInfos.some((function(e){return"vertex"===e.handle.type&&e.manipulator.selected})),i=1===e&&r,o=c.expect(this._reshapeHelper),a=0,s=this._manipulatorInfos;a<s.length;a++)"vertex"===(d=s[a]).handle.type&&(d.manipulator.grabbing||i&&!d.manipulator.selected||(c.expect(o).addDelta(d.handle,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),n.push(d.handle.pos),this._updateManipulatorPosition(d)));if(0!==n.length){for(var l=0,u=0,p=this._manipulatorInfos;u<p.length;u++){var d;"vertex"===(d=p[u]).handle.type&&l++}if(this.outputGeometry=o.commit(),n.length===l){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}}},t.prototype._perVertexManipulatorDragAction=function(e,t){if(this._updateEventState(2),!this.destroyed){var n=t.mapDeltaX,r=t.mapDeltaY,i=t.mapDeltaZ;if(n||r||i){for(var o=[],a=0,s=this._manipulatorInfos;a<s.length;a++){var l=s[a];j(l)&&(l.manipulator.selected&&!l.manipulator.grabbing||l===e)&&o.push(l)}for(var u=c.expect(this._reshapeHelper),p=0,d=o;p<d.length;p++){var h=d[p];u.addDelta(h.handle,n,r,i)}this.outputGeometry=u.commit();for(var f=0,v=o;f<v.length;f++)this._updateManipulatorPosition(h=v[f]);this.emit("reshape",{type:"reshape",mover:this.graphic})}}},t.prototype._updateEventState=function(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t},t.prototype._createGraphicMoveManipulators=function(e){var t=this;this._graphicMoveManipulation=new O.MoveXYGraphicManipulation({tool:this.tool,view:this.view,graphicState:this._graphicState}),this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((function(e,n,r){n.next((function(e){return t._trackNumDragging(e)})).next((function(e){t._perGraphicManipulatorDragAction(0,e)})),r.next(t._cancelDragOperation())}))),this._graphicMoveManipulation.forEachManipulator((function(e){return t._manipulatorHandles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click"),e.stopPropagation()}))])})),this._moveManipulation=new S.MoveManipulation({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&y.canMoveZ(this.graphic),snapToScene:!1,radius:S.MoveManipulation.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((function(e){t._handles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(n){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some((function(e){return e.manipulator.selected}))||t.emit("immediate-click"),n.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var n=c.expect(this.graphic.geometry).spatialReference;this._handles.add([this._moveManipulation.createDragPipeline((function(e,n,r){n.next((function(e){return t._trackNumDragging(e)})).next(m.addMapDelta()).next((function(e){t._perGraphicManipulatorDragAction(1,e)})),r.next(t._cancelDragOperation())}),e,n),u.init(this._graphicState,"displaying",(function(e){t._moveManipulation.xyManipulation.available=e,t._moveManipulation.xyAxisManipulation.available=!0,t._moveManipulation.zManipulation.available=e&&t.enableZ&&y.canMoveZ(t.graphic),t._updateMoveManipulationPosition()})),this._graphicState.on("changed",(function(){return t._updateMoveManipulationPosition()}))]),this._updateMoveManipulationPosition();var r=_.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:function(e){if(!t.destroyed){t._graphicMoveManipulation.forEachManipulator(e);for(var n=0,r=t._manipulatorInfos;n<r.length;n++)e(r[n].manipulator,1);t._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:function(e){return t.on("manipulators-changed",e)}});this._outlineVisualElement=r.visualElement instanceof M.OutlineVisualElement?r.visualElement:null,c.isSome(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(function(){t._graphicState.isDraped||t._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(function(){return t._updateMoveManipulationPosition()}))]),this._manipulatorHandles.add(r)},t.prototype._createPerVertexManipulator=function(e,t){var n=this;if(void 0===t&&(t=f.getGraphicEffectiveElevationInfo(this.graphic)),c.isNone(this._vertexManipulatorGeometry)||c.isNone(this._vertexManipulatorOutlineGeometry)){var r=b.settings.reshapeManipulators.vertex,i=(a=r.size/2)/(s=a+r.collisionPadding);this._vertexManipulatorGeometry=new D(R.createSphereGeometry(i,16,16),"reshape-manipulator");var o=(a+r.outlineSize)/s;this._vertexManipulatorOutlineGeometry=new D(R.createSphereGeometry(o,16,16),"reshape-manipulator-outline")}if(c.isNone(this._edgeManipulatorGeometry)||c.isNone(this._edgeManipulatorOutlineGeometry)){var a,s,u=b.settings.reshapeManipulators.edge;i=(a=u.size/2)/(s=a+u.collisionPadding),this._edgeManipulatorGeometry=new D(R.createSphereGeometry(i,16,16),"reshape-manipulator"),this._edgeManipulatorOutlineGeometry=new D(R.createSphereGeometry(o=(a+u.outlineSize)/s,16,16),"reshape-manipulator-outline")}var p=new v.Manipulator3D({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|V.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|V.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|V.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|V.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|V.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|V.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|V.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(p,e);var d="edge"===e.type?{manipulator:p,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:p,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(d),this.manipulators.add(p),this._updateManipulatorPosition(d),"edge"===d.type){var h=this._getManipulatorInfoFromHandle(d.handle.v0).manipulator.events.on("location-update",(function(){return n._updateManipulatorPosition(d)})),g=this._getManipulatorInfoFromHandle(d.handle.v1).manipulator.events.on("location-update",(function(){return n._updateManipulatorPosition(d)}));d.locationUpdateHandle=l.handlesGroup([h,g]),this._manipulatorHandles.add(d.locationUpdateHandle,p)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(p,!0),p);var y=m.createManipulatorDragEventPipeline(p,(function(e,t,r){t.next((function(e){return n._trackNumDragging(e)})).next((function(e){return I(d)&&n._splitEdgeManipulator(d),e})).next(m.screenToMapXYForGraphicAtLocation(n.view,n.graphic,e.elevationAlignedLocation,e.location.spatialReference)).next(m.addMapDelta()).next((function(e){"vertex"===d.type?n._perVertexManipulatorDragAction(d,e):console.error("drag operation on non-vertex manipulator not allowed")})),r.next(n._cancelDragOperation())}));return this._manipulatorHandles.add(y,p),this._manipulatorHandles.add([p.events.on("immediate-click",(function(e){return n._manipulatorClickCallback(e,d)})),p.events.on("select-changed",(function(){d.selectedIndex=++n._selectedIndex,n._updateMoveManipulationPosition()}))]),this.emit("manipulators-changed"),p},t.prototype._trackNumDragging=function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e},t.prototype._cancelDragOperation=function(){var e=this,t=c.isSome(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return function(){switch(e._numDragging--,e.inputGeometry=t,e.outputGeometry=t,e._reshapeEventState){case 0:break;case 1:e.emit("move",{type:"move",dx:0,dy:0,mover:e.graphic});break;case 2:e.emit("reshape",{type:"reshape",mover:e.graphic})}e.destroyed||e._updateEventState(0)}},t.prototype._setTypeSpecificManipulatorSettings=function(e,t){switch(t.type){case"vertex":e.state=V.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=b.settings.reshapeManipulators.vertex.size/2+b.settings.reshapeManipulators.vertex.collisionPadding;break;case"edge":e.state=V.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=b.settings.reshapeManipulators.edge.size/2+b.settings.reshapeManipulators.edge.collisionPadding;break;default:o.neverReached(t)}},t.prototype._watchAndUpdateGrabState=function(e,t){var n=this;return e.events.on("grab-changed",(function(r){if("start"===r.action)t&&n._updateSelection(e),n._numGrabbing++;else if(n._numGrabbing--,n._updateEventState(0),n.destroyed)return;n._moveManipulation.interactive=!n._numGrabbing}))},t.prototype._clearSelection=function(){for(var e=0,t=this._manipulatorInfos;e<t.length;e++){var n=t[e];n.manipulator.grabbing||(n.manipulator.selected=!1)}},t.prototype._updateSelection=function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))},t.prototype._removeManipulator=function(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))},t.prototype._getManipulatorInfoFromHandle=function(e){if(e)for(var t=0,n=this._manipulatorInfos;t<n.length;t++){var r=n[t];if(e===r.handle)return r}return null},t.prototype._updateManipulatorPosition=function(e){if(e){var t=c.expect(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.getVertexPositionAsPoint(e.handle,L),e.manipulator.grabbing&&c.isSome(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){var n=this._getManipulatorInfoFromHandle(e.handle.v0).manipulator.elevationAlignedLocation,r=this._getManipulatorInfoFromHandle(e.handle.v1).manipulator.elevationAlignedLocation;e.manipulator.elevationAlignedLocation=h.makeDehydratedPoint(n.x+.5*(r.x-n.x),n.y+.5*(r.y-n.y),n.hasZ&&r.hasZ?n.z+.5*(r.z-n.z):void 0,t.geometry.spatialReference)}}},t.prototype._splitEdgeManipulator=function(e){var t=c.expect(this._reshapeHelper),n=t.splitEdge(e.handle,.5);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var r=e;r.handle=n,r.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle),n.left&&this._createPerVertexManipulator(n.left),n.right&&this._createPerVertexManipulator(n.right),this.outputGeometry=t.commit(),this._updateManipulatorPosition(r),this._updateSelection(e.manipulator);var i=t.coordinateHelper.toArray(r.handle.unnormalizedPos);this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:i,componentIndex:c.expect(n.component.index),vertexIndex:c.expect(n.index)}],added:i})},t.prototype._updateMoveManipulationPosition=function(){var e=this,t=C.sv3d.get();d.vec3.set(t,0,0,0);for(var n=0,r=!1,i=null,o=null,a=0,s=this._manipulatorInfos;a<s.length;a++){var l=s[a];j(l)&&(l.manipulator.selected?(n++,d.vec3.add(t,t,l.manipulator.renderLocation),c.isNone(i)||l.selectedIndex>i.selectedIndex?(o=i,i=l):(c.isNone(o)||l.selectedIndex>o.selectedIndex)&&(o=l)):r=!0)}if(this._moveManipulation.xyAxisManipulation.orthogonalAvailable=!0,this._moveManipulation.xyAxisManipulation.available=!0,0!==n){var u=0;if(c.isSome(i)){var p=i.handle.unnormalizedPos,h=c.isSome(o)?o.handle.unnormalizedPos:i.handle.left&&i.handle.left.v0?i.handle.left.v0.unnormalizedPos:null,f=!c.isSome(o)&&i.handle.right&&i.handle.right.v1?i.handle.right.v1.unnormalizedPos:null;h&&f?this._moveManipulation.xyAxisManipulation.available=!1:h?u=E(h,p):f&&(u=E(p,f))}this._moveManipulation.xyAxisManipulation.orthogonalAvailable=1!==n,this._moveManipulation.angle=u,this._moveManipulation.radius=w.DISC_RADIUS_SMALL}else this._moveManipulation.angleDeferred=function(){return P.primaryShapeOrientation(c.expect(e.graphic.geometry))},this._moveManipulation.radius=S.MoveManipulation.radiusForSymbol(this.graphic.symbol);0!==n&&r?(d.vec3.scale(t,t,1/n),L.spatialReference=c.expect(this._reshapeHelper).geometry.spatialReference,this.view.renderCoordsHelper.fromRenderCoords(t,L),this._moveManipulation.elevationAlignedLocation=L):c.isSome(this._outlineVisualElement)&&!this._graphicState.isDraped&&c.isSome(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:g.placeAtGraphic(this.view,this._moveManipulation,this.graphic)},t.prototype._removeVertices=function(e){for(var t=[],n=c.expect(this._reshapeHelper),r=0,i=e;r<i.length;r++){var o=i[r];if("vertex"===o.handle.type&&n.canRemoveVertex(o.handle)){t.push(o.handle),this._removeManipulator(o),this._removeManipulator(this._getManipulatorInfoFromHandle(o.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(o.handle.right));var a=n.removeVertex(o.handle);a&&this._createPerVertexManipulator(a)}}if(t.length>0){var s=t.map((function(e){return{coordinates:n.coordinateHelper.toArray(e.unnormalizedPos),componentIndex:c.expect(e.component.index),vertexIndex:c.expect(e.index)}}));this.outputGeometry=n.commit();var l=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:s.map((function(e){return e.coordinates})),vertices:s}),this.destroyed)return;if(l&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}},t.prototype._manipulatorClickCallback=function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),I(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()},n([p.property({constructOnly:!0})],t.prototype,"tool",void 0),n([p.property()],t.prototype,"inputGeometry",null),n([p.property()],t.prototype,"outputGeometry",void 0),n([p.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.ReshapeOperation")],t)}(p.declared(a.EventedAccessor));function E(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function j(e){return"vertex"===e.handle.type}function I(e){return"edge"===e.handle.type}t.ReshapeOperation=T;var V,L=h.makeDehydratedPoint(0,0,null,null);!function(e){e.Vertex=16,e.Edge=32}(V||(V={}))}).apply(null,r))||(e.exports=i)},dXKx:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("LxLY"),n("x7Wq"),n("CF4u"),n("NsXp"),n("Z91k"),n("35hF")],void 0===(i=(function(e,t,n,r,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultPointSymbol2D=a.fromJSON(l.defaultPointSymbolJSON),t.defaultPolylineSymbol2D=o.fromJSON(l.defaultPolylineSymbolJSON),t.defaultPolygonSymbol2D=i.fromJSON(l.defaultPolygonSymbolJSON),t.defaultTextSymbol2D=s.fromJSON(l.defaultTextSymbolJSON),t.getDefaultSymbol2D=function(e){if(r.isNone(e))return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return t.defaultPointSymbol2D;case"polyline":return t.defaultPolylineSymbol2D;case"polygon":case"extent":return t.defaultPolygonSymbol2D;default:n.neverReached(e)}return null},t.errorPointSymbol2D=a.fromJSON(l.errorPointSymbolJSON),t.errorPolylineSymbol2D=o.fromJSON(l.errorPolylineSymbolJSON),t.errorPolygonSymbol2D=i.fromJSON(l.errorPolygonSymbolJSON)}).apply(null,r))||(e.exports=i)},"dl/g":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("KY0m")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderOutputTypes=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"}],t.getShaderOutputID=function(e,r){return e+"_"+n.find(t.ShaderOutputTypes,(function(e){return e.output===r})).name}}).apply(null,r))||(e.exports=i)},dtql:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("CqfC"),n("KwnQ"),n("W9tT"),n("DIqE"),n("21p4"),n("lRq4"),n("uiHv"),n("AzkI")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0}),t.createGraphicMoveDragPipeline=function(e,t,n){var r=e.graphic,i=function(e,n){return t({action:e,graphic:r,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY})};return n((function(e,t,n){t.next((function(e){return"start"===e.action&&i("start",e),e})).next(c.dragGraphic(r)).next((function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&i("update",e);break;case"end":i("end",e)}return e})),n.next(c.resetGraphic(r)).next((function(){i("end",{screenDeltaX:0,screenDeltaY:0})}))}))},t.primaryShapeOrientation=function(e){if(n.isNone(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=s.convexHull(e),i=t&&t.rings&&t.rings[0];if(!i)return 0;!function(e){for(var t=0,n=0,r=0,i=e;r<i.length;r++){var o=i[r];t+=o[0],n+=o[1]}t/=e.length,n/=e.length;for(var a=0,s=e;a<s.length;a++)(o=s[a])[0]-=t,o[1]-=n}(i);for(var a=[],c=0;c<i.length-1;c++){var f=Math.atan2(i[c+1][1]-i[c][1],i[c+1][0]-i[c][0]),v=u.cyclical2PI.normalize(f)%(Math.PI/2);a.push(v)}for(var g=a.sort((function(e,t){return e-t})),m=null,y=0,b=Number.POSITIVE_INFINITY,_=0,x=g;_<x.length;_++)if((f=x[_])!==m){m=f,r.mat2.fromRotation(p,f),l.empty(d);for(var w=0,S=i;w<S.length;w++)o.vec2.transformMat2(h,S[w],p),l.expandPointInPlace(d,h);var P=l.area(d);((P>b?b/P:P/b)>=.99&&f<y||P<b)&&(y=f,b=P)}return y};var p=i.mat2f64.create(),d=l.create(),h=a.vec2f64.create()}).apply(null,r))||(e.exports=i)},eHCP:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("Rdxj")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.fromVector=function(e,t){return{vec3:n.vec3f64.clone(e),id:t}},t.fromValues=function(e,t,r,i){return{vec3:n.vec3f64.fromValues(e,t,r),id:i}}}).apply(null,r))||(e.exports=i)},fOZq:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("sSIw"),n("yVFQ")],void 0===(i=(function(e,t,n,r,i){return function(){function e(e){this._meterUnitOffset=0,this._renderUnitOffset=0,this.featureExpressionInfoContext=null,e?this.set(e):this.setDefaults()}return Object.defineProperty(e.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0}),e.prototype.setUnit=function(e){this._unit=e,this._metersPerElevationInfoUnit=r.getMetersPerUnit(e)},e.prototype.setDefaults=function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this.featureExpressionInfoContext=null,this.setUnit("meters")},e.prototype.set=function(e){this.mode=e.mode,this._meterUnitOffset=e._meterUnitOffset,this._renderUnitOffset=e._renderUnitOffset,this.featureExpressionInfoContext=e.featureExpressionInfoContext,this.setUnit(e.unit)},e.prototype.setOffsetMeters=function(e){this._meterUnitOffset=e,this._renderUnitOffset=0},e.prototype.setOffsetElevationInfoUnits=function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0},e.prototype.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e},e.prototype.calculateOffsetRenderUnits=function(e){var t=this._meterUnitOffset,n=this.featureExpressionInfoContext;return null!=n&&(t+=i.execute(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset},e.prototype.setFromElevationInfo=function(e){this.mode=e.mode,this.setUnit(e.unit||"meters"),this.setOffsetElevationInfoUnits(n.unwrapOr(e.offset,0))},e.fromElevationInfo=function(t){var r=new e;return n.isSome(t)&&r.setFromElevationInfo(t),r},e}()}).apply(null,r))||(e.exports=i)},fQ2U:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("qKT0"),n("2Atf"),n("O7NG"),n("fese"),n("3kdR"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("NiJV"),n("G0ER"),n("qbr3")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return n(r,t),r.prototype.initializeProgram=function(e){var t=r.shader.get(),n=this.configuration,i=t.build({slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new h(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),p.Default3D)},r.prototype.bindPass=function(e,t,n){var r=t.color,i=t.shadingTint;this.program.setUniform4fv("color",r),this.program.setUniform4fv("shadedColor",this.blendColor(m,i,r)),this.program.setUniform3fv("shadingDirection",t.shadingDirection),this.program.setUniformMatrix4fv("viewNormal",n.viewInvTransp)},r.prototype.blendColor=function(e,t,n){var r=1-t[3],i=t[3]+n[3]*r;return 0===i?(e[3]=i,e):(e[0]=(t[0]*t[3]+n[0]*n[3]*r)/i,e[1]=(t[1]*t[3]+n[1]*n[3]*r)/i,e[2]=(t[2]*t[3]+n[2]*n[3]*r)/i,e[3]=n[3],e)},r.prototype.bindDraw=function(e){s.Transform.bindUniforms(this.program,e),a.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},r.prototype.initializePipeline=function(){var e,t=this.configuration,n=0===t.output?t.transparent&&f.separateBlendingParams(770,1,771,771):null;return f.makePipelineState({blending:n,culling:(e=t.cullFace,0!==e&&{face:1===e?1028:1029,mode:2305}),depthTest:{func:515},depthWrite:t.writeDepth&&f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams})},r.shader=new l.ReloadableShaderModule(d,"./ShadedColorMaterial.glsl",e),r}(c.ShaderTechnique);t.ShadedColorMaterialTechnique=v;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.transparent=!1,t.writeDepth=!0,t}return n(t,e),r([u.parameter({count:7})],t.prototype,"output",void 0),r([u.parameter({count:3})],t.prototype,"cullFace",void 0),r([u.parameter()],t.prototype,"slicePlaneEnabled",void 0),r([u.parameter()],t.prototype,"sliceHighlightDisabled",void 0),r([u.parameter()],t.prototype,"transparent",void 0),r([u.parameter()],t.prototype,"writeDepth",void 0),t}(u.ShaderTechniqueConfiguration);t.ShadedColorMaterialTechniqueConfiguration=g;var m=o.vec4f64.create()}).apply(null,r))||(e.exports=i)},fUJJ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("qKT0"),n("2Atf"),n("xoE+"),n("3gjc"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("qSzK"),n("G0ER"),n("qbr3"),n("qbr3")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return n(r,t),r.prototype.initializeProgram=function(e){var t=r.shader.get().build(this.configuration);return new d(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),u.Default3D)},r.prototype.bind=function(e,t){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*t.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*t.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1);var n=null!=e.angleCutoff?e.angleCutoff:p.defaultAngleCutoff;this.program.setUniform2f("angleCutoff",Math.cos(n),Math.cos(Math.max(0,n-o.deg2rad(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",t.perScreenPixelRatio),this.configuration.heightPlaneHeightEnabled&&this.program.setUniform4fv("heightPlaneFillColor",e.heightPlaneFillColor||a.ONES)},r.prototype.initializePipeline=function(){return f.makePipelineState({blending:h.simpleBlendingParams(1,771),colorWrite:f.defaultColorWriteParams})},r.shader=new s.ReloadableShaderModule(p,"./Laserlines.glsl",e),r}(l.ShaderTechnique);t.LaserlineTechnique=v;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.heightPlaneEnabled=!1,t.heightPlaneHeightEnabled=!1,t.pointDistanceEnabled=!1,t.lineVerticalPlaneEnabled=!1,t.intersectsLineEnabled=!1,t.contrastControlEnabled=!1,t}return n(t,e),r([c.parameter()],t.prototype,"heightPlaneEnabled",void 0),r([c.parameter()],t.prototype,"heightPlaneHeightEnabled",void 0),r([c.parameter()],t.prototype,"pointDistanceEnabled",void 0),r([c.parameter()],t.prototype,"lineVerticalPlaneEnabled",void 0),r([c.parameter()],t.prototype,"intersectsLineEnabled",void 0),r([c.parameter()],t.prototype,"contrastControlEnabled",void 0),t}(c.ShaderTechniqueConfiguration);t.LaserlineTechniqueConfiguration=g}).apply(null,r))||(e.exports=i)},fese:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("LxLY"),n("0LE5"),n("Rdxj"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,o,a){function s(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");var r=a.glsl(l||(l=n(["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel = pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot = dot(slicePlaneBasis1, rel);\n        float basis2Dot = dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front < 0.0\n          && factors.side0 < 0.0\n          && factors.side1 < 0.0\n          && factors.side2 < 0.0\n          && factors.side3 < 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "],["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel = pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot = dot(slicePlaneBasis1, rel);\n        float basis2Dot = dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front < 0.0\n          && factors.side0 < 0.0\n          && factors.side1 < 0.0\n          && factors.side2 < 0.0\n          && factors.side3 < 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "]))),i=a.glsl(c||(c=n(["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors = calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH = 1.0;\n        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor = (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "],["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors = calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH = 1.0;\n        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor = (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "]))),o=t.sliceHighlightDisabled?a.glsl(u||(u=n(["#define highlightSlice(_color_, _pos_) (_color_)"],["#define highlightSlice(_color_, _pos_) (_color_)"]))):a.glsl(p||(p=n(["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "],["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "])),i);t.sliceEnabledForVertexPrograms&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(o)}else{var s=a.glsl(d||(d=n(["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "],["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "])));t.sliceEnabledForVertexPrograms&&e.vertex.code.add(s),e.fragment.code.add(s)}}Object.defineProperty(t,"__esModule",{value:!0}),t.Slice=s,function(e){e.bindUniformsWithOrigin=function(t,n,r){e.bindUniforms(t,n,r.slicePlane,r.origin)},e.bindUniforms=function(e,t,n,a){t.slicePlaneEnabled&&(r.isSome(n)?(a?(i.vec3.subtract(h,n.origin,a),e.setUniform3fv("slicePlaneOrigin",h)):e.setUniform3fv("slicePlaneOrigin",n.origin),e.setUniform3fv("slicePlaneBasis1",n.basis1),e.setUniform3fv("slicePlaneBasis2",n.basis2)):(e.setUniform3fv("slicePlaneBasis1",o.vec3f64.ZEROS),e.setUniform3fv("slicePlaneBasis2",o.vec3f64.ZEROS),e.setUniform3fv("slicePlaneOrigin",o.vec3f64.ZEROS)))}}(s=t.Slice||(t.Slice={}));var l,c,u,p,d,h=o.vec3f64.create()}).apply(null,r))||(e.exports=i)},"ff/U":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,size:4,tangent:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,instanceColor:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}).apply(null,r))||(e.exports=i)},gG9S:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("0LE5"),n("Rdxj"),n("DJpR"),n("MzcX"),n("2B1V"),n("raiv")],void 0===(i=(function(e,t,n,r,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=i.vec3f64.create(),this._dirty=!1,this._count=0,this._vao=null}return Object.defineProperty(e.prototype,"vertices",{set:function(e){for(var t=new Float64Array(3*e.length),n=0,r=0,i=e;r<i.length;r++){var o=i[r];t[n++]=o[0],t[n++]=o[1],t[n++]=o[2]}this.buffers=[t]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffers",{set:function(e){if(this._buffers=e,this._buffers.length>0){var t=this._buffers[0],n=3*Math.floor(t.length/3/2);r.vec3.set(this._origin,t[n+0],t[n+1],t[n+2])}else r.vec3.set(this._origin,0,0,0);this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!0,configurable:!0}),e.prototype.draw=function(e){var t=this.ensureVAO(e);n.isSome(t)&&(e.bindVAO(t),e.drawArrays(4,0,this._count))},e.prototype.dispose=function(){n.isSome(this._vao)&&this._vao.dispose()},e.prototype.ensureVAO=function(e){return n.isNone(this._buffers)?null:(n.isNone(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)},e.prototype.createVAO=function(e,t){var n=this.createDataBuffer(t);return this._dirty=!1,new o.VertexArrayObject(e,l.LaserlinePathTechnique.attributeLocations,{data:a.glLayout(d)},{data:o.BufferObject.createVertex(e,35044,n)})},e.prototype.ensureVertexData=function(e,t){if(this._dirty){var n=this.createDataBuffer(t);e.vertexBuffers.data.setData(n),this._dirty=!1}},e.prototype.numberOfRenderVertices=function(e){return 2*(e.length/3-1)*3},e.prototype.createDataBuffer=function(e){var t=this,n=e.reduce((function(e,n){return e+t.numberOfRenderVertices(n)}),0);this._count=n;for(var i=d.createBuffer(n),o=this._origin,a=0,s=0,l=0,c=e;l<c.length;l++){for(var h=c[l],f=0;f<h.length;f+=3){var v=r.vec3.set(p,h[f+0],h[f+1],h[f+2]);0===f?s=this._renderCoordsHelper.getAltitude(v):this._renderCoordsHelper.setAltitude(s,v);var g=this._renderCoordsHelper.worldUpAtPosition(v,u),m=a+2*f,y=r.vec3.subtract(p,v,o);if(f<h.length-3){i.up.setVec(m,g),i.up.setVec(m+3,g),i.up.setVec(m+5,g);for(var b=0;b<6;b++)i.start.setVec(m+b,y);i.extrude.setValues(m+0,0,-1),i.extrude.setValues(m+1,1,-1),i.extrude.setValues(m+2,1,1),i.extrude.setValues(m+3,0,-1),i.extrude.setValues(m+4,1,1),i.extrude.setValues(m+5,0,1)}if(f>0)for(i.up.setVec(m-2,g),i.up.setVec(m-4,g),i.up.setVec(m-5,g),b=-6;b<0;b++)i.end.setVec(m+b,y)}a+=this.numberOfRenderVertices(h)}return i.buffer},e}();t.LaserlinePathData=c;var u=i.vec3f64.create(),p=i.vec3f64.create(),d=s.newLayout().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude")}).apply(null,r))||(e.exports=i)},hADE:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("2Atf"),n("xoE+"),n("LxLY"),n("rusB"),n("0LE5"),n("Rdxj"),n("3Zlx"),n("HbaO"),n("/9Lg"),n("mmEe"),n("ij3I"),n("AgDx"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f){function v(e,t,n){for(var r=new Array,i=0,o=e;i<o.length;i++){var a=o[i],s=a.count;if(!(s<=1)){var l=3*a.index,c=l+3*s;r.push({position:t.subarray(l,c),mapPosition:n?n.subarray(l,c):void 0})}}return r}Object.defineProperty(t,"__esModule",{value:!0}),t.createGeometryData=function(e){var t={},n={};!function(e,t,n){for(var r=e.attributeData.position,i=(p=r)[0]===p[(d=p.length)-3]&&p[1]===p[d-2]&&p[2]===p[d-1]&&1===e.removeDuplicateStartEnd,a=r.length/3-(i?1:0),s=new Uint32Array(2*(a-1)),l=i?o.slice(r,0,r.length-3):r,c=0,u=0;u<a-1;u++)s[c++]=u,s[c++]=u+1;var p,d;t[f.RibbonVertexAttributeConstants.POSITION]={size:3,data:l,offsetIdx:0,strideIdx:3},n[f.RibbonVertexAttributeConstants.POSITION]=s}(e,n,t);var s=new Uint32Array(t[f.RibbonVertexAttributeConstants.POSITION].length);return function(e,t,n){var r=e.attributeData.mapPosition;i.isNone(r)||(n.mapPos=n[f.RibbonVertexAttributeConstants.POSITION],t.mapPos={size:3,data:r,offsetIdx:0,strideIdx:3})}(e,n,t),function(e,t,n,r){i.isSome(e.attributeData.colorFeature)||(t[f.RibbonVertexAttributeConstants.COLOR]={size:4,data:i.unwrapOr(e.attributeData.color,c.WHITE_UNIT),offsetIdx:0,strideIdx:4},n[f.RibbonVertexAttributeConstants.COLOR]=r)}(e,n,t,s),function(e,t,n,r){i.isSome(e.attributeData.sizeFeature)||(t[f.RibbonVertexAttributeConstants.SIZE]={size:1,data:new Float32Array([i.unwrapOr(e.attributeData.size,1)]),offsetIdx:0,strideIdx:1},n[f.RibbonVertexAttributeConstants.SIZE]=r)}(e,n,t,s),function(e,t,n,r){var o=e.attributeData.colorFeature;i.isNone(o)||(t[f.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE]={size:1,data:new Float32Array([o]),offsetIdx:0,strideIdx:1},n[f.RibbonVertexAttributeConstants.COLOR]=r)}(e,n,t,s),function(e,t,n,r){var o=e.attributeData.sizeFeature;i.isNone(o)||(t[f.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]={size:1,data:new Float32Array([o]),offsetIdx:0,strideIdx:1},n[f.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]=r)}(e,n,t,s),function(e,t,n,r){var o=e.attributeData.opacityFeature;i.isNone(o)||(t[f.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:new Float32Array([o]),offsetIdx:0,strideIdx:1},n[f.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]=r)}(e,n,t,s),function(e,t,n){if("round"===e.join){var o=t[f.RibbonVertexAttributeConstants.POSITION].data,s=o.length/3,l=new Float32Array(s),c=g,u=m;a.vec3.set(c,0,0,0);for(var p=i.unwrapOr(e.uniformSize,1),d=-1;d<s;++d){var h=d<0?s+d:d,v=(d+1)%s;if(a.vec3.set(u,o[3*v+0]-o[3*h+0],o[3*v+1]-o[3*h+1],o[3*v+2]-o[3*h+2]),a.vec3.normalize(u,u),d>=0){var b=(Math.PI-r.acosClamped(a.vec3.dot(c,u)))*y*1*(1.863798+-2.0062872/Math.pow(1+p/18.2313,.8856294));l[d]=Math.max(Math.floor(b),0)}a.vec3.scale(c,u,-1)}t[f.RibbonVertexAttributeConstants.SUBDIVISIONS]={size:1,data:l,offsetIdx:0,strideIdx:1},n[f.RibbonVertexAttributeConstants.SUBDIVISIONS]=n[f.RibbonVertexAttributeConstants.POSITION]}}(e,n,t),new h.GeometryData(n,t,h.GeometryData.DefaultOffsets,"line")},t.geometryToRenderInfo=function(e,t,n,r){var i=l.pathsToTriangulationInfo("polygon"===e.type?e.rings:e.paths,e.hasZ,"polygon"===e.type?1:0),o=i.position,a=i.outlines,s=new Float64Array(o.length),c=u.applyPerVertexElevationAlignment(o,e.spatialReference,0,s,0,o,0,o.length/3,t,n,r),p=null!=c;return{lines:p?v(a,o,s):[],projectionSuccess:p,sampledElevation:c}},t.geometryToRenderInfoDraped=function(e,t){for(var n=l.pathsToTriangulationInfo("polygon"===e.type?e.rings:e.paths,!1,"polygon"===e.type?1:0),r=n.position,i=n.outlines,o=p.bufferToBuffer(r,e.spatialReference,0,r,t,0,r.length/3),a=2;a<r.length;a+=3)r[a]=d.DRAPED_Z;return{lines:o?v(i,r):[],projectionSuccess:o}};var g=s.vec3f64.create(),m=s.vec3f64.create(),y=4/Math.PI}).apply(null,r))||(e.exports=i)},hX2R:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("xoE+"),n("LxLY"),n("DIqE"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("gG9S"),n("/Bau"),n("CIy2"),n("s6rJ"),n("raiv"),n("fUJJ")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g){Object.defineProperty(t,"__esModule",{value:!0});var m=s.vec3f64.create(),y=c.vec4f64.create(),b={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:r.deg2rad(6),globalAlphaContrastBoost:2};function _(e,t,n,r){var i=m,o=y;a.vec3.transformMat4(i,t,r),a.vec3.copy(o,n),o[3]=0,l.vec4.transformMat4(o,o,r),u.plane.fromPositionAndNormal(i,o,e)}var x=function(){function e(e,t,n){void 0===t&&(t={}),void 0===n&&(n={contrastControlEnabled:!1}),this._technique=null,this._projInfo=c.vec4f64.create(),this._zScale=o.vec2f64.create(),this._heightPlaneEnabled=!1,this._heightPlanePosition=s.vec3f64.create(),this._heightPlaneHeight=0,this._pointDistanceEnabled=!1,this._pointDistanceOrigin=s.vec3f64.create(),this._pointDistanceTarget=s.vec3f64.create(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=u.lineSegment.create(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=u.lineSegment.create(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=s.vec3f64.create(),this._tempDir=s.vec3f64.create(),this._tempUp=s.vec3f64.create(),this._tempVec3A=s.vec3f64.create(),this._tempVec3B=s.vec3f64.create(),this._tempVec4=c.vec4f64.create(),this._tempPlane=u.plane.create(),this._tempSphere=u.sphere.create(),this._renderCoordsHelper=e,this._params=f.copyParameters(t,b),this._config=n}return Object.defineProperty(e.prototype,"renderSlots",{get:function(){return[this._config.contrastControlEnabled?17:16]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsLinearDepth",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heightPlaneEnabled",{get:function(){return this._heightPlaneEnabled},set:function(e){e!==this._heightPlaneEnabled&&(this._heightPlaneEnabled=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heightPlanePosition",{get:function(){return this._heightPlanePosition},set:function(e){a.vec3.copy(this._heightPlanePosition,e),this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heightPlaneHeight",{get:function(){return this._heightPlaneHeight},set:function(e){this._heightPlaneHeight!==e&&(this._heightPlaneHeight=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointDistanceEnabled",{get:function(){return this._pointDistanceEnabled},set:function(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointDistanceTarget",{get:function(){return this._pointDistanceTarget},set:function(e){a.vec3.copy(this._pointDistanceTarget,e),this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointDistanceOrigin",{get:function(){return this._pointDistanceOrigin},set:function(e){a.vec3.copy(this._pointDistanceOrigin,e),this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineVerticalPlaneEnabled",{get:function(){return this._lineVerticalPlaneEnabled},set:function(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineVerticalPlaneSegment",{get:function(){return this._lineVerticalPlaneSegment},set:function(e){u.lineSegment.copy(e,this._lineVerticalPlaneSegment),this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineEnabled",{get:function(){return this._intersectsLineEnabled},set:function(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineSegment",{get:function(){return this._intersectsLineSegment},set:function(e){u.lineSegment.copy(e,this._intersectsLineSegment),this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineRadius",{get:function(){return this._intersectsLineRadius},set:function(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineInfinite",{get:function(){return this._intersectsLineInfinite},set:function(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathVerticalPlaneEnabled",{get:function(){return this._pathVerticalPlaneEnabled},set:function(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,i.isSome(this._pathVerticalPlaneData)&&this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathVerticalPlaneVertices",{set:function(e){i.isNone(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new p.LaserlinePathData(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathVerticalPlaneBuffers",{set:function(e){i.isNone(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new p.LaserlinePathData(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()},enumerable:!0,configurable:!0}),e.prototype.setParameterValues=function(e){f.updateParameters(this._params,e)&&this._requestRender()},e.prototype.initializeRenderContext=function(e){this._initContext=e,this._quadVAO=d.createQuadVAO(e.rctx),this._techniqueRepository=e.shaderTechniqueRep,this._techniqueConfig=new g.LaserlineTechniqueConfiguration,this._pathTechniqueConfig=new v.LaserlinePathTechniqueConfiguration},e.prototype.uninitializeRenderContext=function(){this._quadVAO.dispose(),this._quadVAO=null,i.isSome(this._technique)&&this._techniqueRepository.release(this._technique),i.isSome(this._pathVerticalPlaneData)&&this._pathVerticalPlaneData.dispose(),i.isSome(this._pathTechnique)&&this._techniqueRepository.release(this._pathTechnique)},e.prototype.render=function(e){var t=this.heightPlaneEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,n=this.pathVerticalPlaneEnabled;if(!t&&!n)return!0;var r=e.camera;return h.inverseProjectionInfo(r.projectionMatrix,r.fullWidth,r.fullHeight,this._projInfo,this._zScale),t&&this.renderUnified(e),n&&this.renderPath(e),!0},e.prototype.renderUnified=function(e){var t=e.rctx,n=this._selectTechnique(),r=n.program;t.bindProgram(r),n.bindPipelineState(t),this.bindGlobalUniforms(e,r),this.bindHeightPlaneUniforms(e,r),this.bindPointDistanceUniforms(e,r),this.bindLineVerticalPlaneUniforms(e,r),this.bindIntersectsLineUniforms(e,r),n.bind(this._params,e.camera),t.bindVAO(this._quadVAO),t.drawArrays(5,0,4)},e.prototype.renderPath=function(e){if(!i.isNone(this._pathVerticalPlaneData)){this._pathTechniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquireAndReleaseExisting(v.LaserlinePathTechnique,this._pathTechniqueConfig,this._pathTechnique);var t=e.rctx,n=this._pathTechnique,r=n.program;t.bindProgram(r),n.bindPipelineState(t),this.bindGlobalUniforms(e,r),n.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx)}},e.prototype.bindHeightPlaneUniforms=function(e,t){if(this._heightPlaneEnabled){var n=this._heightPlanePosition,r=this._tempVec3A,i=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(n,r),_(i,n,r,e.camera.viewMatrix),t.setUniform4fv("heightPlane",i),t.setUniform1f("heightPlaneHeight",this._heightPlaneHeight)}},e.prototype.bindPointDistanceUniforms=function(e,t){if(this._pointDistanceEnabled){var n=e.camera,r=this._tempSphere;a.vec3.copy(r.center,this._pointDistanceOrigin),a.vec3.transformMat4(r.center,r.center,n.viewMatrix),r.radius=a.vec3.distance(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",r.center[0],r.center[1],r.center[2],r.radius)}},e.prototype.bindLineVerticalPlaneUniforms=function(e,t){if(this._lineVerticalPlaneEnabled){var n=this._renderCoordsHelper,r=e.camera,i=this._tempPlane,o=this._tempVec3A,s=this._tempUp,l=this._tempDir,c=this._tempNormal;u.lineSegment.pointAt(this._lineVerticalPlaneSegment,.5,o),n.worldUpAtPosition(o,s),a.vec3.normalize(l,this._lineVerticalPlaneSegment.vector),a.vec3.cross(c,s,l),a.vec3.normalize(c,c),_(i,this._lineVerticalPlaneSegment.origin,c,r.viewMatrix),t.setUniform4fv("lineVerticalPlane",i);var p=this._tempVec3A;a.vec3.copy(p,this._lineVerticalPlaneSegment.origin),n.setAltitude(0,p),a.vec3.transformMat4(p,p,r.viewMatrix),t.setUniform3fv("lineVerticalStart",p);var d=this._tempVec3B;a.vec3.add(d,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),n.setAltitude(0,d),a.vec3.transformMat4(d,d,r.viewMatrix),t.setUniform3fv("lineVerticalEnd",d)}},e.prototype.bindIntersectsLineUniforms=function(e,t){if(this._intersectsLineEnabled){var n=S,r=P;if(this._intersectsLineInfinite){var i=e.camera;if(u.clipRay.fromRay(u.ray.wrap(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),w),w.c0=-Number.MAX_VALUE,!u.frustum.intersectClipRay(i.frustum.planes,w))return;u.clipRay.getStart(w,n),u.clipRay.getEnd(w,r)}else a.vec3.copy(n,this._intersectsLineSegment.origin),a.vec3.add(r,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);var o=this._tempVec3A;a.vec3.transformMat4(o,n,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",o);var s=this._tempVec4;a.vec3.copy(s,this._intersectsLineSegment.vector),this._tempVec4[3]=0,l.vec4.transformMat4(this._tempVec4,this._tempVec4,e.camera.viewMatrix),a.vec3.transformMat4(r,r,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",r),a.vec3.normalize(s,s),t.setUniform3f("intersectsLineDirection",s[0],s[1],s[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}},e.prototype.bindGlobalUniforms=function(e,t){var n=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2f("nearFar",n.near,n.far),this._heightPlaneEnabled?t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._heightPlanePosition)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.setUniform1i("depthMap",0),e.rctx.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,0),t.setUniform1i("frameColor",1),e.rctx.bindTexture(e.offscreenRenderingHelper.mainColorTexture,1)},e.prototype._requestRender=function(){this._initContext&&this._initContext.requestRender()},e.prototype._selectTechnique=function(){return this._techniqueConfig.heightPlaneEnabled=this.heightPlaneEnabled,this._techniqueConfig.heightPlaneHeightEnabled=0!==this.heightPlaneHeight,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.acquireAndReleaseExisting(g.LaserlineTechnique,this._techniqueConfig,this._technique),this._technique},e}();t.LaserLineRenderer=x;var w=u.clipRay.create(),S=s.vec3f64.create(),P=s.vec3f64.create()}).apply(null,r))||(e.exports=i)},hk44:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("6vp1"),n("58az"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,o){var a,s,l,c,u,p;Object.defineProperty(t,"__esModule",{value:!0}),t.Laserline=function(e,t){e.extensions.add("GL_OES_standard_derivatives"),e.include(r.ReadLinearDepth),e.include(i.CameraSpace),e.fragment.uniforms.add("glowColor","vec3"),e.fragment.uniforms.add("glowWidth","float"),e.fragment.uniforms.add("glowFalloff","float"),e.fragment.uniforms.add("innerColor","vec3"),e.fragment.uniforms.add("innerWidth","float"),e.fragment.uniforms.add("depthMap","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&e.fragment.uniforms.add("globalAlphaContrastBoost","float"),e.fragment.code.add(o.glsl(a||(a=n(["\n  vec4 blendPremultiplied(vec4 source, vec4 dest) {\n    float oneMinusSourceAlpha = 1.0 - source.a;\n\n    return vec4(\n      source.rgb + dest.rgb * oneMinusSourceAlpha,\n      source.a + dest.a * oneMinusSourceAlpha\n    );\n  }\n  "],["\n  vec4 blendPremultiplied(vec4 source, vec4 dest) {\n    float oneMinusSourceAlpha = 1.0 - source.a;\n\n    return vec4(\n      source.rgb + dest.rgb * oneMinusSourceAlpha,\n      source.a + dest.a * oneMinusSourceAlpha\n    );\n  }\n  "])))),e.fragment.code.add(o.glsl(s||(s=n(["\n  vec4 premultipliedColor(vec3 rgb, float alpha) {\n    return vec4(rgb * alpha, alpha);\n  }\n  "],["\n  vec4 premultipliedColor(vec3 rgb, float alpha) {\n    return vec4(rgb * alpha, alpha);\n  }\n  "])))),e.fragment.code.add(o.glsl(l||(l=n(["\n  vec4 laserlineProfile(float dist) {\n    if (dist > glowWidth) {\n      return vec4(0.0);\n    }\n\n    float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\n    float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\n\n    return blendPremultiplied(\n      premultipliedColor(innerColor, innerAlpha),\n      premultipliedColor(glowColor, glowAlpha)\n    );\n  }\n  "],["\n  vec4 laserlineProfile(float dist) {\n    if (dist > glowWidth) {\n      return vec4(0.0);\n    }\n\n    float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\n    float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\n\n    return blendPremultiplied(\n      premultipliedColor(innerColor, innerAlpha),\n      premultipliedColor(glowColor, glowAlpha)\n    );\n  }\n  "])))),e.fragment.code.add(o.glsl(c||(c=n(["\n  bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\n    float depth = linearDepth(depthMap, uv, nearFar);\n\n    if (-depth == nearFar[0]) {\n      return false;\n    }\n\n    pos = reconstructPosition(gl_FragCoord.xy, depth);\n    normal = normalize(cross(dFdx(pos), dFdy(pos)));\n\n    float ddepth = fwidth(depth);\n    depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n\n    return true;\n  }\n  "],["\n  bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\n    float depth = linearDepth(depthMap, uv, nearFar);\n\n    if (-depth == nearFar[0]) {\n      return false;\n    }\n\n    pos = reconstructPosition(gl_FragCoord.xy, depth);\n    normal = normalize(cross(dFdx(pos), dFdy(pos)));\n\n    float ddepth = fwidth(depth);\n    depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n\n    return true;\n  }\n  "])))),e.fragment.code.add(o.glsl(t.contrastControlEnabled?u||(u=n(["\n    float rgbToLuminance(vec3 color) {\n      return dot(vec3(0.2126, 0.7152, 0.0722), color);\n    }\n\n    vec4 laserlineOutput(vec4 color) {\n      float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);\n      float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\n\n      return color * alpha;\n    }\n    "],["\n    float rgbToLuminance(vec3 color) {\n      return dot(vec3(0.2126, 0.7152, 0.0722), color);\n    }\n\n    vec4 laserlineOutput(vec4 color) {\n      float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);\n      float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\n\n      return color * alpha;\n    }\n    "])):p||(p=n(["\n    vec4 laserlineOutput(vec4 color) {\n      return color * globalAlpha;\n    }\n    "],["\n    vec4 laserlineOutput(vec4 color) {\n      return color * globalAlpha;\n    }\n    "]))))}}).apply(null,r))||(e.exports=i)},hkmr:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("1m5D"),n("0LE5"),n("Rdxj"),n("Z4y+"),n("mmEe"),n("ys4y"),n("AgDx"),n("ZO6V"),n("eHCP"),n("ZJC8"),n("CIy2"),n("RC9r")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f){var v=0,g=function(){function e(){this.ROOT_ORIGIN_ID="rg_root_"+v++,this._origins=new Map,this._gridSize=42e5}return e.prototype.getOrigin=function(t){var r=this._origins.get(this.ROOT_ORIGIN_ID);if(null==r){if(n.isSome(e.testOrigin)){var o=e.testOrigin;return this._origins.set(this.ROOT_ORIGIN_ID,p.fromValues(o[0],o[1],o[2],this.ROOT_ORIGIN_ID)),this.getOrigin(t)}var a=p.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,a),a}i.vec3.subtract(m,t,r.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]);var s=this._gridSize;if(m[0]<s&&m[1]<s&&m[2]<s)return r;var l=Math.round(t[0]/s),c=Math.round(t[1]/s),u=Math.round(t[2]/s),d="rg_"+l+"/"+c+"/"+u,h=this._origins.get(d);return h||(h=p.fromValues(l*s,c*s,u*s,d),this._origins.set(d,h)),h},e.prototype._drawOriginBox=function(e){var t=window.view,n=t._stage;if(null==this._object){this._material=new f({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial"),n.add(3,this._material);var i=new u("GridLocalOrigin",{isPickable:!1});n.add(0,i),this._object=new d({idHint:"GridLocalOrigin",castShadow:!1}),n.add(1,this._object),i.addObject(this._object),n.addToViewContent([i.id])}for(var o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=o.length,v=new Float32Array(3*p),g=new Uint32Array(2*(p-1)),m=.5*this._gridSize,y=0;y<p;y++)v[3*y+0]=e[0]+(1&o[y]?m:-m),v[3*y+1]=e[1]+(2&o[y]?m:-m),v[3*y+2]=e[2]+(4&o[y]?m:-m),y>0&&(g[2*y+0]=y-1,g[2*y+1]=y);s.bufferToBuffer(v,a.WebMercator,0,v,t.spatialReference,0,p);var b={};b[h.VertexAttrConstants.POSITION]={size:3,data:v};var _={};_[h.VertexAttrConstants.POSITION]=g;var x=new c.GeometryData(b,_,void 0,"line"),w=new l(x,"GridLocalOriginBox");n.add(2,w),this._object.addGeometry(w,this._material,r.mat4f64.IDENTITY),console.log(this._origins.size,e)},e}(),m=o.vec3f64.create();return function(e){e.testOrigin=null}(g||(g={})),g}).apply(null,r))||(e.exports=i)},hs8d:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.AlignPixel=function(e){var t=r.glsl(i||(i=n(["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "]))),a=r.glsl(o||(o=n(["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "])));e.vertex.code.add(t),e.vertex.code.add(a),e.fragment.code.add(t),e.fragment.code.add(a)}}).apply(null,r))||(e.exports=i)},hsRy:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qsST"),n("qMld"),n("DIqE"),n("weRx"),n("Zp3t")],void 0===(i=(function(e,t,n,r,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=n.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");t.waveAndPertubationTextureUrls=[e.toUrl("../../../../../images/materials/water/normals.jpg"),e.toUrl("../../../../../images/materials/water/perturbation.jpg")],t.defaultWaterMaterialParameters={waveStrength:.06,waveTextureRepeat:32,waveDirection:i.vec2f64.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,.35686,.4,1],transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0},t.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};var l=function(){function e(){this.loadingState=0,this.data=[]}return e.prototype.getTextureProps=function(e,t,n){return void 0===n&&(n=!1),{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:n,maxAnisotropy:8,width:e,height:t}},e.prototype.ready=function(){return 2===this.loadingState},e.prototype.loading=function(){return 1===this.loadingState},e.prototype.initialize=function(e){var n=this;this.loadingState=1,r.all(t.waveAndPertubationTextureUrls.map((function(e){return o.requestImage(e)}))).then((function(t){t.forEach((function(t,r){n.data[r]=new a(e,n.getTextureProps(t.width,t.height,!0),t)})),n.loadingState=2})).catch((function(e){s.error("Failed to load textures for water material.",e),n.loadingState=0}))},e.prototype.bindRepo=function(e){for(var t=0;t<this.data.length;t++)e.bindTexture(this.data[t],t)},e}();t.waterTextureRepo=new l}).apply(null,r))||(e.exports=i)},i10q:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("2Atf"),n("xoE+"),n("LxLY"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("WRgd"),n("2W+Z"),n("/9Lg"),n("fOZq"),n("J2BX"),n("mmEe"),n("JjCO"),n("ys4y"),n("4ziW"),n("yqrJ"),n("CIy2"),n("xFEL")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x){Object.defineProperty(t,"__esModule",{value:!0});var w=function(){function e(e){var t=this;this.view=null,this._geometry=null,this._size=3,this._color=c.vec4f64.fromValues(1,0,1,1),this._primitive="square",this._outlineSize=1,this._outlineColor=c.vec4f64.fromValues(1,1,1,1),this._elevationInfo=null,this.resources=new p.VisualElementResources({view:e.view,createResources:function(e){return t.createResources(e)},recreateGeometry:function(e,n){return e.geometry=t.recreateGeometry(n,e.material),o.isSome(e.geometry)?[e.geometry]:[]}});var n=!0;for(var r in e)r in this?"attached"===r?n=e[r]:this[r]=e[r]:console.error("Cannot set unknown property",r);this.attached=n}return e.prototype.destroy=function(){this.resources.destroy()},Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached},set:function(e){this.resources.attached=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){if(e!==this._size){var t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?o.isSome(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){l.vec4.exactEquals(e,this._color)||(l.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primitive",{get:function(){return this._primitive},set:function(e){this._primitive!==e&&(this._primitive=e,o.isSome(this.resources)&&this.resources.recreate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineSize",{get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(e){l.vec4.exactEquals(e,this._outlineColor)||(l.vec4.copy(this._outlineColor,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()},enumerable:!0,configurable:!0}),e.prototype.updateMaterial=function(){var e=this.resources.resources;o.isNone(e)||e.material.setParameterValues(this.materialParameters(e.texture.id))},e.prototype.updateSizeAttribute=function(){var e=this.resources.resources,t=this.resources.object;if(!o.isNone(e)&&!o.isNone(t)){var n=e.geometry;if(!o.isNone(n)){var r=n.data.getVertexAttr()[_.VertexAttrConstants.SIZE].data,i=this.geometrySize;r[0]=i,r[1]=i,t.geometryVertexAttrsUpdated(0)}}},e.prototype.materialParameters=function(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:P,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1}},Object.defineProperty(e.prototype,"geometrySize",{get:function(){return this._size/S},enumerable:!0,configurable:!0}),e.prototype.recreateGeometry=function(e,t){var n=this.createRenderGeometry();return o.isSome(n)&&e.addGeometry(n,t),n},e.prototype.createResources=function(e){var t=this.createTexture(),n=new x(this.materialParameters(t.id),"pointVisualElement");n.renderOccluded=8;var r=this.recreateGeometry(e,n);return{material:n,texture:t,geometry:r,forEach:function(e){e(t),e(n),o.isSome(this.geometry)&&e(this.geometry)}}},Object.defineProperty(e.prototype,"preferredTextureSize",{get:function(){return i.clamp(i.nextHighestPowerOfTwo(2*this.geometrySize),16,128)},enumerable:!0,configurable:!0}),e.prototype.createTexture=function(){var e=this.preferredTextureSize;return new b(f.createType(this._primitive,e,e*S),"pointVisualElement",{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})},e.prototype.calculateMapBounds=function(e){if(o.isNone(this.resources.resources)||o.isNone(this.resources.resources.geometry))return!1;var t=this.resources.resources.geometry.data.getAttribute("position");return v.vectorToVector(t.data,this.view.renderCoordsHelper.spatialReference,O,this.view.spatialReference),u.expandWithBuffer(e,O),!0},e.prototype.createRenderGeometry=function(){var e=this.geometry;if(o.isNone(e))return null;var t=this.view.renderCoordsHelper,n=d.evaluateElevationAlignmentAtPoint(e,this.view.elevationProvider,h.fromElevationInfo(this.elevationInfo),t),r=a.vec3.set(g.sv3d.get(),e.x,e.y,n),i=g.sv3d.get();v.vectorToVector(r,e.spatialReference,i,t.spatialReference);var s=this.geometrySize,l=y.createPointGeometry(null,i,null,[s,s],[0,0,0,1]);return new m(l)},e}();t.PointVisualElement=w;var S=.5,P=[S/2,S/2,1-S/2,1-S/2],O=s.vec3f64.create()}).apply(null,r))||(e.exports=i)},ij3I:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("9opi"),n("qKT0"),n("qsST"),n("R2Zq"),n("LxLY"),n("KBgh"),n("ULaq"),n("R8EL"),n("FXVB"),n("Rdxj"),n("Dk48"),n("GDWR"),n("y68M"),n("KRuQ"),n("RsYQ"),n("FU3N"),n("/Bau"),n("hkmr"),n("9DjX"),n("Raj5"),n("FLCf"),n("Px2u"),n("XcBT"),n("qUb7"),n("QDiq"),n("FbvD"),n("/f24"),n("Zp3t"),n("Kfys")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w,S,P,O,M,A,C,D,R){Object.defineProperty(t,"__esModule",{value:!0});var T=i.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer"),E=function(e){function i(n){var r=e.call(this)||this;return r._hasHighlights=!1,r._rendersOccluded=!1,r._lighting=new M.SceneLighting,r._localOrigins=new b,r._layerViewHandles=new Map,r._layerRenderers=new Map,r._sortedLayerRenderersDirty=!1,r._sortedLayerRenderers=new s,r._stats=new w.RenderStatsAggregator,r._geometries=new Map,r._renderTargets={},r._uniqueIdx=0,r.longitudeCyclical=null,r._rctx=n.renderingContext,r._renderContext=new x(r._rctx,null,null,null,null,null),r._stippleTextureRepository=new A.StippleTextureRepository,r._shaderTechniqueRepository=new f.ShaderTechniqueRepository({rctx:r._rctx,viewingMode:1,commonUniformStore:new h.CommonUniformStore,stippleTextureRepository:r._stippleTextureRepository}),r._materialRepository=new m(n.textureRepository,r._shaderTechniqueRepository),r._materialRepository.onMaterialChanged=function(e){(e.renderOccluded&t.overlayRenderOccludedFlag)>0!==r._rendersOccluded&&r.updateRendersOccluded(),r.emitContentChanged()},r._compositingHelper=n.compositingHelper,r._bindParameters={slot:null,fovY:0,highlightDepthTexture:y.createEmptyDepthTexture(r._rctx),nearFar:[V.near,V.far],origin:null,pixelRatio:null,proj:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,view:null,viewInvTransp:null,viewport:null,hasOccludees:!1},r._lighting.set({lights:[new O.AmbientLight(p.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0}),r}return n(i,e),i.prototype.dispose=function(){for(var e in this._layerRenderers.forEach((function(e){return e.dispose()})),this._layerRenderers.clear(),this._renderTargets)this._renderTargets[e].dispose();this._renderTargets=null,this._bindParameters.highlightDepthTexture.dispose(),this._bindParameters.highlightDepthTexture=null},i.prototype.disposeRenderTarget=function(e){var t=this._renderTargets[e];t&&t.dispose(),delete this._renderTargets[e]},Object.defineProperty(i.prototype,"updating",{get:function(){return this._sortedLayerRenderersDirty||o.someMap(this._layerRenderers,(function(e){return e.updating}))},enumerable:!0,configurable:!0}),i.prototype.commitChanges=function(){var e=this,t=!1;this._layerRenderers.forEach((function(n,r){if(n.commitChanges()&&(t=!0),n.isEmpty){e._layerRenderers.delete(r),e._sortedLayerRenderersDirty=!0;var i=e._layerViewHandles.get(r);i&&(i.remove(),e._layerViewHandles.delete(r))}})),this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),t=!0),this.emitUpdatingChanged(),t&&(this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded())},i.prototype.getRenderTargetTexture=function(e){var t=this._renderTargets[e];return t?t.colorTexture:null},i.prototype.addGeometries=function(e,t,n){for(var r=0,i=e;r<i.length;r++){var o=i[r];null==o.origin&&(o.origin=this._localOrigins.getOrigin(o.center)),o.uniqueName||(o.uniqueName="ov:"+this._uniqueIdx++),this._geometries.set(o.uniqueName,o)}this.ensureLayerRenderer(t).add(e),2===n&&this.notifyGraphicUpdate(e,t,2)},i.prototype.removeGeometries=function(e,t,n){for(var r=0,i=e;r<i.length;r++)this._geometries.delete(i[r].uniqueName);var o=this._layerRenderers.get(t);o?(o.remove(e),2===n&&this.notifyGraphicUpdate(e,t,2)):T.warn("Attempted to remove geometry for nonexistent layer")},i.prototype.updateGeometries=function(e,t,n){var r=this._layerRenderers.get(t);r?(r.modify(e,n),this.notifyUpdateGeometries(e,t,n)):T.warn("Attempted to update geometry for nonexistent layer")},i.prototype.notifyUpdateGeometries=function(e,t,n){this.notifyGraphicUpdate(e,t,4===n||2===n?2:1===n?1:0)},i.prototype.notifyGraphicUpdate=function(e,t,n){if(0!==n)for(var r=-1,i=0,o=e;i<o.length;i++){var a=o[i].data.graphicUid;a!==r&&(t.notifyGraphicUpdate(a,n),r=a)}},i.prototype.updateHighlights=function(e,t){var n=this._layerRenderers.get(t);n?n.modify(e,8):T.warn("Attempted to update highlights for nonexistent layer")},i.prototype.isEmpty=function(){return 0===this._geometries.size&&!d.OVERLAY_DRAW_DEBUG_TEXTURE},Object.defineProperty(i.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasWater",{get:function(){return o.someMap(this._layerRenderers,(function(e){return e.hasWater}))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rendersOccluded",{get:function(){return this._rendersOccluded},enumerable:!0,configurable:!0}),i.prototype.updateLogic=function(e){var t=!1;return this._layerRenderers.forEach((function(n){n.updateLogic(e)&&(t=!0)})),t},i.prototype.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0},i.prototype.draw=function(e,t){return this.drawPass(0,e,t)},i.prototype.drawWithoutRasterImage=function(e,t){return this.drawPass(0,e,t,2)},i.prototype.drawNormals=function(e,t){return this.drawPass(2,e,t)},i.prototype.drawHighlights=function(e,t){return this.drawPass(4,e,t)},i.prototype.drawOccluded=function(e,t){return this.drawPass(0,e,t,1)},i.prototype.drawPass=function(e,n,r,i){var o=this;if(void 0===i&&(i=0),0===r.numViews)return!1;if(this._pixelRatio=r.pixelRatio*Math.abs(r.views[0].extent[2]-r.views[0].extent[0])/Math.abs(r.views[0].viewport[2]-r.views[0].viewport[0]),this.isEmpty()||4===e&&!this.hasHighlights||2===e&&!this.hasWater)return!1;if(!this.hasNonZeroSizedView(r))return!1;var s=r.width,l=r.height,c=this._renderTargets[n];if(!c)return!1;c.resize(s,l);var u=this._rctx,p=V;if(p.pixelRatio=r.pixelRatio||1,this._renderContext.pass=e,this._bindParameters.pixelRatio=p.pixelRatio,u.bindFramebuffer(c),u.setClearColor(0,0,0,0),u.clearSafe(16384),this.updateLightingUniforms(),1===i&&(this._renderContext.renderOccludedMask=t.overlayRenderOccludedFlag),d.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==i)for(var h=0;h<r.numViews;h++)this.setViewParameters(r.views[h],p),this.drawDebugTexture(s,l,I[r.index%I.length]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forEach((function(t){var n=t.layerView,d=t.renderer;if(2!==i||!a.isSome(n)||0!==n.drapeSourceType){var h=a.isSome(n)&&a.isSome(n.fullOpacity)&&n.fullOpacity<1&&0===e;h&&(o.bindTemporaryFramebuffer(s,l),u.clearSafe(16384));for(var f=0;f<r.numViews;f++)o.setViewParameters(r.views[f],p),d.draw(o._renderContext,o._bindParameters,o._stats);h&&(u.bindFramebuffer(c),o._compositingHelper.composite(o.temporaryTexture,2,a.expect(a.expect(n).fullOpacity)))}})),u.bindFramebuffer(null),c.colorTexture.descriptor.hasMipmap&&c.colorTexture.generateMipmap(),this._renderContext.resetRenderOccludedMask(),!0},i.prototype.createRenderTarget=function(e,t){for(var n=e,r=0;this._renderTargets[n];)n=e+"_"+ ++r;return this._renderTargets[n]=new C(this._rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0}),n},i.prototype.disposeRenderTargetMemory=function(e){var t=this._renderTargets[e];t&&t.resize(0,0)},i.prototype.bindTemporaryFramebuffer=function(e,t){a.isNone(this._temporaryRenderTargetId)&&(this._temporaryRenderTargetId=this.createRenderTarget("temp",!1));var n=this._renderTargets[this._temporaryRenderTargetId];n.resize(e,t),this._rctx.bindFramebuffer(n)},Object.defineProperty(i.prototype,"temporaryTexture",{get:function(){return this._renderTargets[a.expect(this._temporaryRenderTargetId)].colorTexture},enumerable:!0,configurable:!0}),i.prototype.getGpuMemoryUsage=function(){var e=0;for(var t in this._renderTargets)e+=R.getGpuMemoryUsage(this._renderTargets[t]);return e},i.prototype.getStats=function(){return this._stats.getAggregatedStats()},i.prototype.intersect=function(e,t,n){var r=this,i=0;this._geometries.forEach((function(o){if(!n||n(o)){r.intersectRenderGeometry(o,t,0,e,i);var a=r.longitudeCyclical;a&&(o.center[0]-o.bsRadius<a.min&&r.intersectRenderGeometry(o,t,a.range,e,i),o.center[0]+o.bsRadius>a.max&&r.intersectRenderGeometry(o,t,-a.range,e,i)),i++}}))},i.prototype.intersectRenderGeometry=function(e,t,n,r,i){var o=this,s=0;a.isSome(e.transformation)&&(n+=e.transformation[12],s=e.transformation[13]),L[0]=t[0]-n,L[1]=t[1]-s,L[2]=1,z[0]=t[0]-n,z[1]=t[1]-s,z[2]=0,e.pixelRatio=this._pixelRatio,e.material.intersect(e,null,e.getShaderTransformation(),r,L,z,(function(t,n,a){o.addIntersectionResult(a,e.material.renderPriority,i,r,e.data.layerUid,e.data.graphicUid)}),e.calculateShaderTransformation,!0)},i.prototype.addIntersectionResult=function(e,t,n,r,i,o){var a={type:"external",metadata:{layerUid:i,graphicUid:o}},s=function(i){i.set(a,null,r.results.ground.dist,r.results.ground.normal,r.results.ground.transformation,t,null,null,e,n),i.intersector="OverlayRenderer"};if((null==r.results.min.drapedLayerOrder||t>=r.results.min.drapedLayerOrder)&&(null==r.results.min.dist||r.results.ground.dist<=r.results.min.dist)&&s(r.results.min),0!==r.options.store&&(null==r.results.max.drapedLayerOrder||t<r.results.max.drapedLayerOrder)&&(null==r.results.max.dist||r.results.ground.dist>r.results.max.dist)&&s(r.results.max),2===r.options.store){var l=new _.IntersectorResult(r.ray);s(l),r.results.all.push(l)}},i.prototype.ensureLayerRenderer=function(e){var t=this,n=this._layerRenderers.get(e);return n||(n=new S.SortedRenderGeometryRenderer(this._rctx,this._materialRepository,(function(){return t.emitUpdatingChanged()})),this._layerRenderers.set(e,n),this._sortedLayerRenderersDirty=!0,this._layerViewHandles.set(e,e.watch("fullOpacity",(function(){return t.emitContentChanged()})))),n},i.prototype.updateSortedLayerRenderers=function(){var e=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var t=o.firstKeyOfMap(this._layerRenderers).view.allLayerViews,n=l.createSetFromValues(o.valuesOfMap(this._layerRenderers));t.forEach((function(t){var r=t,i=e._layerRenderers.get(r);i&&(e._sortedLayerRenderers.push(new j(r,i)),n.delete(i))})),n.forEach((function(t){e._sortedLayerRenderers.push(new j(null,t))}))}},i.prototype.setViewParameters=function(e,t){t.viewport=e.viewport;var n=e.extent;u.mat4.ortho(t.projectionMatrix,0,n[2]-n[0],0,n[3]-n[1],t.near,t.far),u.mat4.identity(t.viewMatrix),u.mat4.translate(t.viewMatrix,t.viewMatrix,[-e.extent[0],-e.extent[1],0]),t.setGLViewport(this._rctx),this._renderContext.camera=t,this._bindParameters.view=t.viewMatrix,this._bindParameters.proj=t.projectionMatrix,this._bindParameters.viewInvTransp=t.viewInverseTransposeMatrix,this._bindParameters.viewport=t.fullViewport,this._shaderTechniqueRepository.getProgramsUsingUniform("proj").forEach((function(e){e.setUniformMatrix4fv("proj",t.projectionMatrix)}))},i.prototype.updateLightingUniforms=function(){var e=this;this._shaderTechniqueRepository.getProgramsUsingUniform("lightingMainDirection").forEach((function(t){e._lighting.setUniforms(t)}))},i.prototype.hasNonZeroSizedView=function(e){for(var t=0;t<e.numViews;t++){var n=e.views[t];if(n.extent[0]!==n.extent[2]&&n.extent[1]!==n.extent[3])return!0}return!1},i.prototype.emitContentChanged=function(){this.onContentChanged&&this.onContentChanged()},i.prototype.emitUpdatingChanged=function(){this.onUpdatingChanged&&this.onUpdatingChanged()},i.prototype.updateHasHighlights=function(){var e=o.someMap(this._layerRenderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this._hasHighlights))},i.prototype.updateRendersOccluded=function(){var e=o.someMap(this._layerRenderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.onRendersOccludedChanged&&this.onRendersOccludedChanged(this.rendersOccluded))},i.prototype.drawDebugTexture=function(e,t,n){var r=this._rctx;this.ensureDebugPatternResources(e,t);var i=this._debugPatternProgram;r.bindProgram(i),r.setPipelineState(this._debugPatternPipelineState),i.setUniform4f("color",n[0],n[1],n[2],1),i.setUniform1i("tex",0),r.bindTexture(this._debugPatternTexture,0),r.bindVAO(this._quadVAO),r.drawArrays(5,0,R.vertexCount(this._quadVAO,"geometry"))},i.prototype.ensureDebugPatternResources=function(e,t){if(!this._debugPatternTexture){for(var n=new Uint8Array(e*t*4),r=0,i=0;i<t;i++)for(var o=0;o<e;o++){var a=Math.floor(o/10),s=Math.floor(i/10);a<2||s<2||10*a>e-20||10*s>t-20?(n[r++]=255,n[r++]=255,n[r++]=255,n[r++]=255):(n[r++]=255,n[r++]=255,n[r++]=255,n[r++]=1&a&&1&s?1&o^1&i?0:255:1&a^1&s?0:128)}this._debugPatternTexture=new D(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},n);var l=new P.TextureTechniqueConfiguration;l.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(P.TextureTechnique,l,this._debugTextureTechnique),this._debugPatternProgram=this._debugTextureTechnique.program,this._debugPatternPipelineState=this._debugTextureTechnique.pipeline,this._quadVAO=y.createQuadVAO(this._rctx)}},Object.defineProperty(i.prototype,"test",{get:function(){return{layerRenderers:this._layerRenderers}},enumerable:!0,configurable:!0}),r([v.autoDispose()],i.prototype,"_shaderTechniqueRepository",void 0),r([v.autoDispose()],i.prototype,"_stippleTextureRepository",void 0),i}(c.declared(v.AutoDisposable));t.OverlayRenderer=E;var j=function(e,t){this.layerView=e,this.renderer=t},I=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],V=new g.default;V.near=1,V.far=1e4;var L=p.vec3f64.create(),z=p.vec3f64.create();t.DRAPED_Z=-2,t.overlayRenderOccludedFlag=4}).apply(null,r))||(e.exports=i)},j2SP:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("3gjc")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.vec4f32=n}).apply(null,r))||(e.exports=i)},jl7D:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("cmSR"),n("fese"),n("3kdR"),n("pLfv"),n("cj3m"),n("vGsU"),n("RdU/"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p){var d,h,f,v,g,m,y,b,_;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new p.ShaderBuilder;return t.include(o.Transform,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4").add("localOrigin","vec3"),0===e.output&&(t.include(a.NormalUtils,e),t.include(r.ForwardLinearDepth,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),t.vertex.code.add(u.glsl(d||(d=n(["\n      void main(void) {\n        vuv = uv0;\n        vpos = (model * vec4(position, 1.0)).xyz;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "],["\n      void main(void) {\n        vuv = uv0;\n        vpos = (model * vec4(position, 1.0)).xyz;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "])))),t.include(c.WaterDistortion,e),t.include(i.Slice,e),e.receiveShadows&&t.include(s.ReadShadowMap,e),t.include(l.Water,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float"),t.fragment.code.add(u.glsl(h||(h=n(["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec3 tangentNormal = getSurfaceNormal(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormal);\n        vec3 v = -normalize(vpos - camPos);\n        vec3 l = normalize(-lightingMainDirection);\n        "],["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec3 tangentNormal = getSurfaceNormal(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormal);\n        vec3 v = -normalize(vpos - camPos);\n        vec3 l = normalize(-lightingMainDirection);\n        "])))),t.fragment.code.add(u.glsl(e.receiveShadows?f||(f=n(["\n        float shadow = 1.0 - readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow = 1.0 - readShadowMap(vpos, linearDepth);\n      "])):v||(v=n(["\n        float shadow = 1.0;\n      "],["\n        float shadow = 1.0;\n      "])))),t.fragment.code.add(u.glsl(g||(g=n(["\n        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "]))))),2===e.output&&(t.include(a.NormalUtils,e),t.include(c.WaterDistortion,e),t.include(i.Slice,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(u.glsl(m||(m=n(["\n        void main(void) {\n          vuv = uv0;\n          vpos = (model * vec4(position, 1.0)).xyz;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vuv = uv0;\n          vpos = (model * vec4(position, 1.0)).xyz;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])))),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(u.glsl(y||(y=n(["\n        void main() {\n          discardBySlice(vpos);\n          // the created normal is in tangent space\n          vec3 tangentNormal = getSurfaceNormal(vuv, timeElapsed);\n          tangentNormal = normalize(tangentNormal);\n          gl_FragColor = vec4((tangentNormal + vec3(1.0)) * 0.5, 0.0);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n          // the created normal is in tangent space\n          vec3 tangentNormal = getSurfaceNormal(vuv, timeElapsed);\n          tangentNormal = normalize(tangentNormal);\n          gl_FragColor = vec4((tangentNormal + vec3(1.0)) * 0.5, 0.0);\n        }\n    "]))))),5===e.output&&(t.include(a.NormalUtils,e),t.varyings.add("vpos","vec3"),t.vertex.code.add(u.glsl(b||(b=n(["\n        void main(void) {\n          vpos = (model * vec4(position, 1.0)).xyz;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos = (model * vec4(position, 1.0)).xyz;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])))),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(u.glsl(_||(_=n(["\n        void main() {\n          gl_FragColor = waterColor;\n        }\n    "],["\n        void main() {\n          gl_FragColor = waterColor;\n        }\n    "]))))),t}}).apply(null,r))||(e.exports=i)},juLw:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyticalSkyModel=function(e){var t=e.fragment.code;t.add(r.glsl(i||(i=n(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "])))),t.add(r.glsl(o||(o=n(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "],["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "])))),t.add(r.glsl(a||(a=n(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))}}).apply(null,r))||(e.exports=i)},lBa0:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderTechniqueConfiguration=function(){this.key=0},t.parameter=function(e){return void 0===e&&(e={}),function(t,r){var i=t;i.__configurationParameters=i.__configurationParameters||[],i.__configurationParameters.push(r);var o="_"+r;void 0===i.__configurationParameters__offset&&(i.__configurationParameters__offset=0);var a=i.__configurationParameters__offset,s=Math.ceil(n.log2(e.count||2)),l=(1<<s)-1<<a;if(i.__configurationParameters__offset+=s,i.__configurationParameters__offset>=32)throw new Error("ShaderTechniqueConfiguration is too complex, requiring more than 32 bits to encode.\n      Either the configuration must be simplified, or this restriction must be relaxed.(Currently used: "+i.__configurationParameters__offset+")");Object.defineProperty(i,r,{get:function(){return this[o]},set:function(e){this.key=this.key&~l|e<<a&l,this[o]=e}})}}}).apply(null,r))||(e.exports=i)},lfQW:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.depthCompareLess={func:513},t.depthCompareAlways={func:519},t.stencilWriteMaskOn={mask:255},t.stencilWriteMaskOff={mask:0},t.renderWhenBitIsNotSet=function(e){return{function:{func:517,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7680}}},t.replaceBitWhenDepthTestPasses=function(e){return{function:{func:519,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7681}}},t.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},t.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},t.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},t.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}}).apply(null,r))||(e.exports=i)},m4lJ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("H1tY"),n("LxLY"),n("VCyw"),n("1m5D"),n("0LE5"),n("Rdxj"),n("aWgr"),n("9DjX")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=n("dojo-debug-messages"),p=function(){function e(e){this.options=new c.IntersectorOptions,this.results=new c.IntersectorResults,this.transform=new c.IntersectorTransform,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=1e-5,this.verticalOffset=null,this._ray={origin:s.vec3f64.create(),direction:s.vec3f64.create()},this._rayEndPoint=s.vec3f64.create(),this._rayStartPointTransformed=s.vec3f64.create(),this._rayEndPointTransformed=s.vec3f64.create(),this.viewingMode=e||"global"}return Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayEndPoint",{get:function(){return this._rayEndPoint},enumerable:!0,configurable:!0}),e.prototype.reset=function(e,t){this.resetWithRay(l.ray.fromPoints(e,t,this._ray))},e.prototype.resetWithRay=function(e){e!==this._ray&&l.ray.copy(e,this._ray),0!==this.options.verticalOffset?"local"===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,a.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)},e.prototype.intersect=function(e,t,n,o,a,s){var l=this;this.point=t,this.camera=n,this.filterPredicate=a,this.tolerance=null==o?1e-5:o;var p,d=c.getVerticalOffsetObject3D(this.verticalOffset);u&&(p=i());var h=s?function(e){s(e)&&l.intersectObject(e)}:function(e){l.intersectObject(e)};if(e&&e.length>0)for(var f=0,v=e;f<v.length;f++){var g=v[f],m=g.getSpatialQueryAccelerator&&g.getSpatialQueryAccelerator();if(m)r.isSome(d)?m.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,h,d):m.forEachAlongRay(this._ray.origin,this._ray.direction,h),this.options.selectionMode&&this.options.hud&&m.forEachDegenerateObject(h);else for(var y=0,b=g.getObjects();y<b.length;y++)h(b[y])}this.sortResults(),u&&(this.performanceInfo.queryDuration=i()-p,this.performanceInfo.numObjectsTested=this._numObjectsTested)},e.prototype.intersectObject=function(e){var t=this;this._numObjectsTested++;var n=e.geometryRecords;if(n)for(var i,s=e.id,l=e.objectTransformation,u=c.getVerticalOffsetObject3D(this.verticalOffset),p=function(n){var p=n.geometry,h=n.material,f=n.instanceParameters;if(f.hidden)return"continue";i=p.id,d.transform.setAndInvalidateLazyTransforms(l,n.getShaderTransformation()),a.vec3.transformMat4(d._rayStartPointTransformed,d._ray.origin,d.transform.inverse),a.vec3.transformMat4(d._rayEndPointTransformed,d._rayEndPoint,d.transform.inverse);var v=d.transform.transform;r.isSome(u)&&(u.objectTransform=d.transform),h.intersect(p,f,d.transform.transform,d,d._rayStartPointTransformed,d._rayEndPointTransformed,(function(n,a,l,u,p,d){if(n>=0){if(r.isSome(t.filterPredicate)&&!t.filterPredicate(t._ray.origin,t._rayEndPoint,n))return;if(p)return void((null==t.results.hud.dist||n<t.results.hud.dist)&&t.results.hud.set(e,s,n,a,o.mat4f64.IDENTITY,u,d,i,l));var h=function(t){return t.set(e,s,n,a,v,u,null,i,l)};if((null==t.results.min.drapedLayerOrder||u>=t.results.min.drapedLayerOrder)&&(null==t.results.min.dist||n<t.results.min.dist)&&h(t.results.min),0!==t.options.store&&(null==t.results.max.drapedLayerOrder||u<t.results.max.drapedLayerOrder)&&(null==t.results.max.dist||n>t.results.max.dist)&&h(t.results.max),2===t.options.store){var f=new c.IntersectorResult(t._ray);h(f),t.results.all.push(f)}}}),n.shaderTransformation)},d=this,h=0,f=n;h<f.length;h++)p(f[h])},e.prototype.sortResults=function(){this.results.all.sort((function(e,t){return e.dist!==t.dist?e.dist-t.dist:e.drapedLayerOrder!==t.drapedLayerOrder?(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE):(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)}))},e.DEFAULT_TOLERANCE=1e-5,e}();t.Intersector=p}).apply(null,r))||(e.exports=i)},mYMs:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("SyoC"),n("KBgh"),n("0LE5"),n("Rdxj"),n("aWgr"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o,a,s){var l=function(){function e(e,t){this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,this._objectToBoundingSphere=e,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth)),this._root=new c(null,o.vec3f64.fromValues(0,0,0),0)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._degenerateObjects.clear(),this._root=null,c.clearPool(),b[0]=null,O.prune(),T.prune(),E.prune()},e.prototype.add=function(e,t){var n=_(e);this._objectCount+=t=null==t?n.length:t,this._grow(n,t);for(var r=c.acquire(),i=0;i<t;i++){var o=n[i];this._isDegenerate(o)?this._degenerateObjects.add(o):(r.init(this._root),this._add(o,r))}c.release(r)},e.prototype.remove=function(e,t){var n=_(e);this._objectCount-=n.length;for(var r=c.acquire(),i=0,o=n;i<o.length;i++){var a=o[i],s=t||this._boundingSphereFromObject(a,M);this._isValidRadius(s.radius)?(r.init(this._root),this._remove(a,s,r)):this._degenerateObjects.delete(a)}c.release(r),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,n){var r=this,i=a.ray.wrap(e,t);this._forEachNode(this._root,(function(e){if(!r._intersectsNode(i,e))return!1;var t=e.node;return t.terminals.forEach((function(e){r._intersectsObject(i,e)&&n(e)})),null!==t.residents&&t.residents.forEach((function(e){r._intersectsObject(i,e)&&n(e)})),!0}))},e.prototype.forEachAlongRayWithVerticalOffset=function(e,t,n,r){var i=this,o=a.ray.wrap(e,t);this._forEachNode(this._root,(function(e){if(!i._intersectsNodeWithOffset(o,e,r))return!1;var t=e.node;return t.terminals.forEach((function(e){i._intersectsObjectWithOffset(o,e,r)&&n(e)})),null!==t.residents&&t.residents.forEach((function(e){i._intersectsObjectWithOffset(o,e,r)&&n(e)})),!0}))},e.prototype.forEach=function(e){this._forEachNode(this._root,(function(t){var n=t.node;return n.terminals.forEach(e),null!==n.residents&&n.residents.forEach(e),!0})),this._degenerateObjects.forEach(e)},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,n,r,i){return this._findClosest(e,"front-to-back"===t?1:-1,n,r,i)},e.prototype.forEachInDepthRange=function(e,t,n,r,i,o,a,s){this._forEachInDepthRange(e,t,"front-to-back"===n?1:-1,r,i,o,a,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,(function(t){return e(t.node,t.center,2*t.halfSize)}))},e.prototype._intersectsNode=function(e,t){return d(t.center,2*-t.halfSize,S),d(t.center,2*t.halfSize,P),s.rayBoxTest(e.origin,e.direction,S,P)},e.prototype._intersectsNodeWithOffset=function(e,t,n){return d(t.center,2*-t.halfSize,S),d(t.center,2*t.halfSize,P),n.applyToMinMax(S,P),s.rayBoxTest(e.origin,e.direction,S,P)},e.prototype._intersectsObject=function(e,t){var n=this._objectToBoundingSphere.getRadius(t);return!(n>0)||a.sphere.intersectsRay(a.sphere.wrap(n,this._objectToBoundingSphere.getCenter(t)),e)},e.prototype._intersectsObjectWithOffset=function(e,t,n){var r=this._objectToBoundingSphere.getRadius(t);return!(r>0)||a.sphere.intersectsRay(n.applyToBoundingSphere(r,this._objectToBoundingSphere.getCenter(t)),e)},e.prototype._forEachNode=function(e,t){for(var n=c.acquire().init(e),r=[n];0!==r.length;){if(t(n=r.pop())&&!n.isLeaf())for(var i=0;i<n.node.children.length;i++)n.node.children[i]&&r.push(c.acquire().init(n).advance(i));c.release(n)}},e.prototype._forEachNodeDepthOrdered=function(e,t,n,r){void 0===r&&(r=1);var i=c.acquire().init(e),o=[i];for(function(e,t,n){if(!T.length)for(var r=0;r<8;++r)T.push({index:0,distance:0});for(r=0;r<8;++r){var i=g[r];T.data[r].index=r,T.data[r].distance=v(e,t,i)}for(T.sort((function(e,t){return e.distance-t.distance})),n.clear(),r=0;r<8;++r)n.push(T.data[r].index)}(n,r,E);0!==o.length;){if(t(i=o.pop())&&!i.isLeaf())for(var a=7;a>=0;--a){var s=E.data[a];s>=i.node.children.length||i.node.children[s]&&o.push(c.acquire().init(i).advance(s))}c.release(i)}},e.prototype._findClosest=function(e,t,n,r,o){var a=this,s=1/0,l=1/0,c=null,u=f(e,t),p=0,d=function(i){if(++p,!r||r(i)){var o=a._objectToBoundingSphere.getCenter(i),u=a._objectToBoundingSphere.getRadius(i);if(!n||!h(o,u,n)){var d=v(e,t,o),f=d-u;f<s&&(s=f,l=d+u,c=i)}}};return this._forEachNodeDepthOrdered(this._root,(function(r){if(null!=o&&p>=o)return!1;if(n&&h(r.center,r.halfSize*y,n))return!1;if(i.vec3.scale(w,u,r.halfSize),i.vec3.add(w,w,r.center),v(e,t,w)>l)return!1;var a=r.node;return a.terminals.forEach((function(e){d(e)})),null!==a.residents&&a.residents.forEach((function(e){d(e)})),!0}),e,t),c},e.prototype._forEachInDepthRange=function(e,t,n,r,o,a,s,l){var c=this,u=-1/0,p=1/0,d={setRange:function(e){1===n?(u=Math.max(u,e.near),p=Math.min(p,e.far)):(u=Math.max(u,-e.far),p=Math.min(p,-e.near))}};d.setRange(r);var g=v(t,n,e),m=f(t,n),b=f(t,-1*n),_=0,x=function(e){if(++_,!s||s(e)){var r=c._objectToBoundingSphere.getCenter(e),i=c._objectToBoundingSphere.getRadius(e),l=v(t,n,r)-g;l-i>p||l+i<u||a&&h(r,i,a)||o(e,d)}};this._forEachNodeDepthOrdered(this._root,(function(e){if(null!=l&&_>=l)return!1;if(a&&h(e.center,e.halfSize*y,a))return!1;if(i.vec3.scale(w,m,e.halfSize),i.vec3.add(w,w,e.center),v(t,n,w)-g>p)return!1;if(i.vec3.scale(w,b,e.halfSize),i.vec3.add(w,w,e.center),v(t,n,w)-g<u)return!1;var r=e.node;return r.terminals.forEach((function(e){x(e)})),null!==r.residents&&r.residents.forEach((function(e){x(e)})),!0}),t,n)},e.prototype._remove=function(e,t,n){O.clear();var r=n.advanceTo(t,(function(e,t){O.push(e.node),O.push(t)}))?n.node.terminals:n.node.residents;if(r.removeUnordered(e),0===r.length)for(var i=O.length-2;i>=0&&this._purge(O.data[i],O.data[i+1]);i-=2);},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new r({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,M))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var n=0;n<t.length;n++){var r=c.acquire().init(e);this._add(t.data[n],r),c.release(r)}},e.prototype._grow=function(e,t){var n=this;if(0!==t){var r=this._boundingSphereFromObjects(e,t,(function(e,t){return n._boundingSphereFromObject(e,t)}),A);if(this._isValidRadius(r.radius)&&!this._fitsInsideTree(r))if(this._nodeIsEmpty(this._root.node))i.vec3.copy(this._root.center,r.center),this._root.halfSize=1.25*r.radius;else{var o=c.acquire();this._rootBoundsForRootAsSubNode(r,o),this._placingRootViolatesMaxDepth(o)?this._rebuildTree(r,o):this._growRootAsSubNode(o),c.release(o)}}},e.prototype._rebuildTree=function(e,t){var n=this;i.vec3.copy(C.center,t.center),C.radius=t.halfSize;var r=this._boundingSphereFromObjects([e,C],2,(function(e){return e}),D),o=c.acquire().init(this._root);this._root.initFrom(null,r.center,1.25*r.radius),this._forEachNode(o,(function(e){return n.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&n.add(e.node.residents.data,e.node.residents.length),!0})),c.release(o)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,(function(e){return t=Math.max(t,e.depth),!0})),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var n=e.radius,r=e.center,i=-1/0,o=this._root.center,a=this._root.halfSize,s=0;s<3;s++){var l=r[s]+n-(o[s]+a),c=Math.max(0,Math.ceil((o[s]-a-(r[s]-n))/(2*a))),u=Math.max(0,Math.ceil(l/(2*a)))+1,p=Math.pow(2,Math.ceil(Math.log(c+u)*Math.LOG2E));i=Math.max(i,p),R[s].min=c,R[s].max=u}for(s=0;s<3;s++){var d=(i-((c=R[s].min)+(u=R[s].max)))/2;c+=Math.ceil(d),u+=Math.floor(d),x[s]=o[s]-a-c*a*2+(u+c)*a}return t.initFrom(null,x,i*a,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;i.vec3.copy(A.center,this._root.center),A.radius=this._root.halfSize,this._root.init(e),e.advanceTo(A,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,n=0,r=0;r<t.length&&null==e;)e=t[n=r++];for(;r<t.length;)if(t[r++])return-1;return n},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,n=this._root.halfSize,r=e.center;return e.radius<=n&&r[0]>=t[0]-n&&r[0]<=t[0]+n&&r[1]>=t[1]-n&&r[1]<=t[1]+n&&r[2]>=t[2]-n&&r[2]<=t[2]+n},e.prototype._boundingSphereFromObject=function(e,t){return i.vec3.copy(t.center,this._objectToBoundingSphere.getCenter(e)),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,n,r){if(1===t){var o=n(e[0],A);i.vec3.copy(r.center,o.center),r.radius=o.radius}else{S[0]=1/0,S[1]=1/0,S[2]=1/0,P[0]=-1/0,P[1]=-1/0,P[2]=-1/0;for(var a=0;a<t;a++)o=n(e[a],A),this._isValidRadius(o.radius)&&(u(S,o.center,o.radius),p(P,o.center,o.radius));i.vec3.lerp(r.center,S,P,.5),r.radius=Math.max(P[0]-S[0],P[1]-S[1],P[2]-S[2])/2}return r},e}(),c=function(){function e(e,t,n){void 0===n&&(n=0),this.center=o.vec3f64.create(),this.initFrom(e,t,n,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,n,r,o){return void 0===t&&(t=null),void 0===r&&(r=this.halfSize),void 0===o&&(o=this.depth),this.node=t||e.createEmptyNode(),n&&i.vec3.copy(this.center,n),this.halfSize=r,this.depth=o,this},e.prototype.advance=function(t){var n=this.node.children[t];n||(n=e.createEmptyNode(),this.node.children[t]=n),this.node=n,this.halfSize/=2,this.depth++;var r=g[t];return this.center[0]+=r[0]*this.halfSize,this.center[1]+=r[1]*this.halfSize,this.center[2]+=r[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,n){for(void 0===n&&(n=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!n)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var r=this._childIndex(e);t&&t(this,r),this.advance(r)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,n=this.center,r=0,i=0;i<3;i++)n[i]<t[i]&&(r|=1<<i);return r},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new r({shrink:!0}),residents:new r({shrink:!0})}},e.acquire=function(){return e._pool.acquire()},e.release=function(t){e._pool.release(t)},e.clearPool=function(){e._pool.prune()},e._pool=new n(e),e}();function u(e,t,n){e[0]=Math.min(e[0],t[0]-n),e[1]=Math.min(e[1],t[1]-n),e[2]=Math.min(e[2],t[2]-n)}function p(e,t,n){e[0]=Math.max(e[0],t[0]+n),e[1]=Math.max(e[1],t[1]+n),e[2]=Math.max(e[2],t[2]+n)}function d(e,t,n){return(n=n||e)[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n}function h(e,t,n){return!a.frustum.intersectsSphere(n.planes,a.sphere.wrap(t,e))}function f(e,t){for(var n=1/0,r=null,i=0;i<8;++i){var o=v(e,t,m[i]);o<n&&(n=o,r=m[i])}return r}function v(e,t,n){return t*(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])}var g=[o.vec3f64.fromValues(-1,-1,-1),o.vec3f64.fromValues(1,-1,-1),o.vec3f64.fromValues(-1,1,-1),o.vec3f64.fromValues(1,1,-1),o.vec3f64.fromValues(-1,-1,1),o.vec3f64.fromValues(1,-1,1),o.vec3f64.fromValues(-1,1,1),o.vec3f64.fromValues(1,1,1)],m=[o.vec3f64.fromValues(-1,-1,-1),o.vec3f64.fromValues(-1,-1,1),o.vec3f64.fromValues(-1,1,-1),o.vec3f64.fromValues(-1,1,1),o.vec3f64.fromValues(1,-1,-1),o.vec3f64.fromValues(1,-1,1),o.vec3f64.fromValues(1,1,-1),o.vec3f64.fromValues(1,1,1)],y=Math.sqrt(3),b=[null];function _(e){return Array.isArray(e)?e:(b[0]=e,b)}var x=o.vec3f64.create(),w=o.vec3f64.create(),S=o.vec3f64.create(),P=o.vec3f64.create(),O=new r,M={center:o.vec3f64.create(),radius:0},A={center:o.vec3f64.create(),radius:0},C={center:o.vec3f64.create(),radius:0},D={center:o.vec3f64.create(),radius:0},R=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],T=new r,E=new r;return l}).apply(null,r))||(e.exports=i)},naZ0:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,n){e.setUniform3f("camPos",n[3]-t[0],n[7]-t[1],n[11]-t[2])}e.bindUniformsCustomOrigin=t,e.bindUniforms=function(e,n){t(e,n.origin,n.viewInvTransp)}}(t.Camera||(t.Camera={})),function(e){e.bindUniforms=function(e,t){e.setUniform1f("pixelRatio",t.pixelRatio||1),e.setUniform4fv("viewport",t.viewport)}}(t.Viewport||(t.Viewport={}))}).apply(null,r))||(e.exports=i)},ne9J:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("fese"),n("E/g4"),n("7zqm"),n("quQL"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,o,a,s,l){var c,u,p,d,h,f,v,g,m,y,b,_,x,w,S,P,O,M,A,C,D,R,T,E,j;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new l.ShaderBuilder;t.extensions.add("GL_OES_standard_derivatives"),t.include(a.PiUtils),t.include(i.RibbonVertexPosition,e),t.include(o.LineStipple,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4").add("nearPlane","float").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3");var I=e.falloffEnabled,V=e.innerColorEnabled;return V&&t.varyings.add("vLineDistance","float"),I&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),t.vertex.code.add(s.glsl(c||(c=n(["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s = sin(a);\n\t\t\tfloat c = cos(a);\n\t\t\tmat2 m = mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"],["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s = sin(a);\n\t\t\tfloat c = cos(a);\n\t\t\tmat2 m = mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"])))),t.vertex.code.add(s.glsl(u||(u=n(["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc = proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *= screenSize / posNdc.w;\n      return posNdc;\n    }\n"],["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc = proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *= screenSize / posNdc.w;\n      return posNdc;\n    }\n"])))),t.vertex.code.add(s.glsl(p||(p=n(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z > -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z < -nearPlane) {\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z < -nearPlane) {\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z > -nearPlane) {\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z > -nearPlane) {\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n"],["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z > -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z < -nearPlane) {\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z < -nearPlane) {\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z > -nearPlane) {\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z > -nearPlane) {\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n"])))),t.vertex.code.add(s.glsl(d||(d=n(["\n  void main(void) {\n    float coverage = 1.0;\n    vpos = (model * vec4(position, 1.0)).xyz;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n      bool isJoin = abs(uv0.y)-3.0 < 0.0;\n\n      float lineWidth = getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }\n\n      vec4 pos  = view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\n      vec4 prev = view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\n      vec4 next = view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left = (pos.xy - prev.xy);\n      vec2 right = (next.xy - pos.xy);\n\n      float leftLen = length(left);\n      float rightLen = length(right);\n  "],["\n  void main(void) {\n    float coverage = 1.0;\n    vpos = (model * vec4(position, 1.0)).xyz;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n      bool isJoin = abs(uv0.y)-3.0 < 0.0;\n\n      float lineWidth = getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }\n\n      vec4 pos  = view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\n      vec4 prev = view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\n      vec4 next = view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left = (pos.xy - prev.xy);\n      vec2 right = (next.xy - pos.xy);\n\n      float leftLen = length(left);\n      float rightLen = length(right);\n  "])))),e.stippleEnabled&&t.vertex.code.add(s.glsl(h||(h=n(["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos->next, otherwise use prev->pos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection = stippleSegmentInfo.zw;\n    "],["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos->next, otherwise use prev->pos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection = stippleSegmentInfo.zw;\n    "])))),t.vertex.code.add(s.glsl(f||(f=n(['\n    left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir = vec2(0, 0);\n    vec2 joinDisplacementDir = vec2(0, 0);\n    float displacementLen = lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside = ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir = normalize(left + right);\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen > 0.001 && rightLen > 0.001) {\n        float nDotSeg = dot(joinDisplacementDir, left);\n        displacementLen /= length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside && (displacementLen > miterLimit * lineWidth)) {\n    '],['\n    left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir = vec2(0, 0);\n    vec2 joinDisplacementDir = vec2(0, 0);\n    float displacementLen = lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside = ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir = normalize(left + right);\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen > 0.001 && rightLen > 0.001) {\n        float nDotSeg = dot(joinDisplacementDir, left);\n        displacementLen /= length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside && (displacementLen > miterLimit * lineWidth)) {\n    '])))),t.vertex.code.add(s.glsl(e.roundJoins?v||(v=n(["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen < 0.001) {\n          startDir = right;\n        }\n        else{\n          startDir = left;\n        }\n        startDir = normalize(startDir);\n        startDir = PERPENDICULAR(startDir);\n\n        if (rightLen < 0.001) {\n          endDir = left;\n        }\n        else{\n          endDir = right;\n        }\n        endDir = normalize(endDir);\n        endDir = PERPENDICULAR(endDir);\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "],["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen < 0.001) {\n          startDir = right;\n        }\n        else{\n          startDir = left;\n        }\n        startDir = normalize(startDir);\n        startDir = PERPENDICULAR(startDir);\n\n        if (rightLen < 0.001) {\n          endDir = left;\n        }\n        else{\n          endDir = right;\n        }\n        endDir = normalize(endDir);\n        endDir = PERPENDICULAR(endDir);\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "])):g||(g=n(["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen < 0.001) {\n          joinDisplacementDir = right;\n        }\n        else if (rightLen < 0.001) {\n          joinDisplacementDir = left;\n        }\n        else {\n          joinDisplacementDir = isStartVertex ? right : left;\n        }\n        joinDisplacementDir = normalize(joinDisplacementDir);\n        joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n  "],["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen < 0.001) {\n          joinDisplacementDir = right;\n        }\n        else if (rightLen < 0.001) {\n          joinDisplacementDir = left;\n        }\n        else {\n          joinDisplacementDir = isStartVertex ? right : left;\n        }\n        joinDisplacementDir = normalize(joinDisplacementDir);\n        joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n  "])))),t.vertex.code.add(s.glsl(m||(m=n(["\n        displacementLen = lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen < 0.001) {\n      joinDisplacementDir = right;\n    }\n    else if (rightLen < 0.001) {\n      joinDisplacementDir = left;\n    }\n    else {\n      joinDisplacementDir = isStartVertex ? right : left;\n    }\n    joinDisplacementDir = normalize(joinDisplacementDir);\n    joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n    displacementLen = lineWidth;\n\n    capDisplacementDir = isStartVertex ? -right : left;\n  "],["\n        displacementLen = lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen < 0.001) {\n      joinDisplacementDir = right;\n    }\n    else if (rightLen < 0.001) {\n      joinDisplacementDir = left;\n    }\n    else {\n      joinDisplacementDir = isStartVertex ? right : left;\n    }\n    joinDisplacementDir = normalize(joinDisplacementDir);\n    joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n    displacementLen = lineWidth;\n\n    capDisplacementDir = isStartVertex ? -right : left;\n  "])))),t.vertex.code.add(s.glsl(e.roundCaps?y||(y=n(["\n    float angle = subdivisionFactor*PI*0.5;\n    joinDisplacementDir *= cos(angle);\n    capDisplacementDir *= sin(angle);\n    "],["\n    float angle = subdivisionFactor*PI*0.5;\n    joinDisplacementDir *= cos(angle);\n    capDisplacementDir *= sin(angle);\n    "])):b||(b=n(["\n    capDisplacementDir *= subdivisionFactor;\n    "],["\n    capDisplacementDir *= subdivisionFactor;\n    "])))),t.vertex.code.add(s.glsl(S||(S=n(["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy += dpos;\n  "],["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy += dpos;\n  "])),I||V?s.glsl(_||(_=n(["float lineDist = lineWidth * sign(uv0.y) * pos.w;"],["float lineDist = lineWidth * sign(uv0.y) * pos.w;"]))):"",V?s.glsl(x||(x=n(["vLineDistance = lineDist;"],["vLineDistance = lineDist;"]))):"",I?s.glsl(w||(w=n(["vLineDistanceNorm = lineDist / lineWidth;"],["vLineDistanceNorm = lineDist / lineWidth;"]))):"")),e.stippleEnabled&&(t.vertex.code.add(s.glsl(P||(P=n(["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec = pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength = length(stippleSegmentDirection);\n    "],["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec = pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength = length(stippleSegmentDirection);\n    "])))),e.stippleIntegerRepeatsEnabled&&t.vertex.code.add(s.glsl(O||(O=n(["\n      float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats = max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax = roundedNumberOfPatternRepeats;\n      "],["\n      float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats = max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax = roundedNumberOfPatternRepeats;\n      "])))),t.vertex.code.add(s.glsl(M||(M=n(["\n      if (stippleSegmentDirectionLength >= 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv = 1.0;\n        }\n      }\n    "],["\n      if (stippleSegmentDirectionLength >= 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv = 1.0;\n        }\n      }\n    "])),e.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale = roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale = 1.0;"))),t.vertex.code.add(s.glsl(A||(A=n(["\n      // Convert back into NDC\n      pos.xy = pos.xy / screenSize * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      gl_Position = pos;\n    }\n  }\n  "],["\n      // Convert back into NDC\n      pos.xy = pos.xy / screenSize * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      gl_Position = pos;\n    }\n  }\n  "])))),t.include(r.Slice,e),0===e.output&&(t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.code.add(s.glsl(C||(C=n(["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha = getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      vec4 color = intrinsicColor * vColor;\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha = getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      vec4 color = intrinsicColor * vColor;\n    "])))),e.innerColorEnabled&&(t.fragment.uniforms.add("pixelRatio","float"),t.fragment.code.add(s.glsl(D||(D=n(["\n      float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n      float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\n      float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\n      color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n      "],["\n      float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n      float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\n      float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\n      color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n      "]))))),t.fragment.code.add(s.glsl(R||(R=n(["\n      vec4 finalColor = blendStipple(color, stippleAlpha);\n    "],["\n      vec4 finalColor = blendStipple(color, stippleAlpha);\n    "])))),e.falloffEnabled&&t.fragment.code.add(s.glsl(T||(T=n(["\n      finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n      "],["\n      finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n      "])))),t.fragment.code.add(s.glsl(E||(E=n(["\n      gl_FragColor = highlightSlice(finalColor, vpos);\n    }\n    "],["\n      gl_FragColor = highlightSlice(finalColor, vpos);\n    }\n    "]))))),4===e.output&&t.fragment.code.add(s.glsl(j||(j=n(["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "])))),t}}).apply(null,r))||(e.exports=i)},o5p5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("2Atf"),n("xhoE"),n("tUyH"),n("FNtW"),n("LZD4"),n("s6rJ"),n("s6rJ"),n("ZeO9"),n("EiS2")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u){var p=function(e){function t(t,n){var r=e.call(this,n)||this;return r.supportsEdges=!0,r.techniqueConfig=new u.ColorMaterialTechniqueConfiguration,r.params=l.copyParameters(t,h),r}return r(t,e),t.prototype.setParameterValues=function(e){s.updateParameters(this.params,e)&&this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig},t.prototype.getPassParameters=function(){return this.params},t.prototype.intersect=function(e,t,n,r,i,o,a){l.intersectTriangleGeometry(e,t,r,i,o,void 0,a)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new d(e):void 0},t.prototype.createBufferWriter=function(){return new a.DefaultBufferWriter(a.PositionColorLayout)},t.prototype.createRenderer=function(e,t){return new c(e,t,this)},t}(o.Material),d=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return r(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(u.ColorMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&this._updateOccludeeState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t.prototype.getPipelineState=function(e,t){return t?this.technique.opaqueOccludeeState:this.technique.pipeline},t}(i.GLMaterial),h={color:[1,1,1,1],transparent:!1,writeDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1};return p}).apply(null,r))||(e.exports=i)},oZZu:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("7Yqx")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.mat4f32=n}).apply(null,r))||(e.exports=i)},pESw:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("Q2wQ"),n("HZ3d"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("Vx27"),n("qysZ"),n("DtIM"),n("5T2R"),n("1eTA"),n("G+tB"),n("UdQa"),n("Fe95"),n("BhkK"),n("/NuL"),n("X7Ps")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_){Object.defineProperty(t,"__esModule",{value:!0});var x=function(e){function t(t){var n=e.call(this,t)||this;return n.enableZ=!0,n.enableRotation=!0,n.enableScaling=!0,n.type="transform-3d",n.handles=new s,n.scaleRotate=null,n}return r(t,e),t.prototype.initialize=function(){var e=this;this.graphicState=new b.GraphicState({graphic:this.graphic}),this.moveManipulation=new y.MoveManipulation({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&f.canMoveZ(this.graphic),radius:y.MoveManipulation.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((function(t){return e.handles.add(t.events.on("immediate-click",(function(e){return e.stopPropagation()})))})),this.moveManipulation.elevationInfo=d.getGraphicEffectiveElevationInfo(this.graphic),this.moveManipulation.createGraphicDragPipeline(this.graphicState,(function(t){var n={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(t.action){case"start":e.emit("graphic-translate-start",n);break;case"update":e.emit("graphic-translate",n);break;case"end":e.emit("graphic-translate-stop",n)}})),this.moveManipulation.angle=this.symbolRotationAngle,(this.enableScaling||this.enableRotation)&&(this.scaleRotate=new g.GraphicScaleRotateTransform({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate"}),this.handles.add(this.scaleRotate.events.on("scale-changed",(function(){return e.onScaleChanged()})))),this.handles.add([v.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return l.makeHandle()}}),this.graphic.watch("symbol",(function(){return e.updateMoveAngle()})),this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(function(){return e.updateMoveAngle()}))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()},t.prototype.forEachManipulator=function(e){this.moveManipulation.forEachManipulator(e),c.isSome(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)},t.prototype.hideManipulatorsForGraphicState=function(){var e=this;return this.graphicState.watch("displaying",(function(t){e.forEachManipulator((function(e){return e.available=t})),e.moveManipulation.zManipulation.available=t&&e.enableZ&&f.canMoveZ(e.graphic)}))},t.prototype.destroy=function(){this.handles.destroy(),this.moveManipulation.destroy(),c.isSome(this.scaleRotate)&&(this.scaleRotate.destroy(),this.scaleRotate=null),this._set("view",null),this._set("graphic",null)},Object.defineProperty(t.prototype,"snapToScene",{set:function(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolRotationAngle",{get:function(){var e=this.graphic.symbol;if(e){var t=e.symbolLayers.find((function(e){return"object"===e.type}));return p.toRadian(-(t&&t.heading||0))}return 0},enumerable:!0,configurable:!0}),t.prototype.reset=function(){},t.prototype.onDetach=function(){c.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()},t.prototype.onHide=function(){c.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()},t.prototype.onScaleChanged=function(){if(!c.isNone(this.scaleRotate)){var e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}},t.prototype.updateMoveAngle=function(){this.moveManipulation.angle="local"===this.view.viewingMode||this.view.scale<m.ALIGN_ARROWS_SCALE_THRESHOLD?this.symbolRotationAngle:0},t.prototype.onGeometryChanged=function(){h.placeAtGraphic(this.view,this.moveManipulation,this.graphic)},Object.defineProperty(t.prototype,"test",{get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:c.isSome(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}},enumerable:!0,configurable:!0}),n([u.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n([u.property({constructOnly:!0,nonNullable:!0})],t.prototype,"graphic",void 0),n([u.property({constructOnly:!0,nonNullable:!0})],t.prototype,"enableZ",void 0),n([u.property()],t.prototype,"enableRotation",void 0),n([u.property()],t.prototype,"enableScaling",void 0),n([u.property({value:!1})],t.prototype,"snapToScene",null),n([u.property({readOnly:!0})],t.prototype,"type",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransform3DTool")],t)}(u.declared(a.EventedMixin(_.InteractiveToolBase)));t.GraphicTransform3DTool=x}).apply(null,r))||(e.exports=i)},pLfv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.NormalUtils=function(e,t){e.vertex.code.add(r.glsl(0===t.viewingMode?i||(i=n(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "])):o||(o=n(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "])))),e.vertex.code.add(r.glsl(0===t.viewingMode?a||(a=n(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "])):s||(s=n(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = vec3(1.0, 0.0, 0.0);\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = vec3(1.0, 0.0, 0.0);\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "]))))}}).apply(null,r))||(e.exports=i)},pbva:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("FXVB"),n("1m5D")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Instance=function(e,t,i,o,a,s,l){this.from=e,this.to=t,this.isHidden=i,this.highlightedIndexRanges=o,this.hasOccludees=a,this.transformation=s,this.instanceParameters=l,null!=s&&(this.transformationNormal=r.mat4f64.clone(s),n.mat4.invert(this.transformationNormal,this.transformationNormal),n.mat4.transpose(this.transformationNormal,this.transformationNormal))}}).apply(null,r))||(e.exports=i)},piY7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("juLw"),n("quQL"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,o){var a,s,l,c,u,p,d,h,f,v,g;Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicallyBasedRendering=function(e,t){var m=e.fragment.code;e.include(i.PiUtils),3===t.pbrMode||4===t.pbrMode?(m.add(o.glsl(a||(a=n(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "],["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "])),t.useCustomDTRExponentForWater?"2.2":"2.0")),m.add(o.glsl(s||(s=n(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "],["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),m.add(o.glsl(l||(l=n(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "],["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),m.add(o.glsl(c||(c=n(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "],["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),m.add(o.glsl(u||(u=n(["\n    vec3 brdfWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float D = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n      return (D * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "],["\n    vec3 brdfWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float D = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n      return (D * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))))):1!==t.pbrMode&&2!==t.pbrMode||(e.include(r.AnalyticalSkyModel),m.add(o.glsl(p||(p=n(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "],["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),m.add(o.glsl(d||(d=n(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "],["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),m.add(o.glsl(h||(h=n(["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "],["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),m.add(o.glsl(f||(f=n(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "],["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),m.add(o.glsl(v||(v=n(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"],["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"])))),m.add(o.glsl(g||(g=n(["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "],["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "])))))}}).apply(null,r))||(e.exports=i)},pqGg:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("qKT0"),n("2Atf"),n("fese"),n("3kdR"),n("xDGw"),n("uUnu"),n("aRjO"),n("PaEL"),n("3PFg"),n("naZ0"),n("2o+p"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("VQEQ"),n("VQEQ"),n("G0ER"),n("qbr3"),n("qbr3")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w){Object.defineProperty(t,"__esModule",{value:!0});var S=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return n(r,t),r.prototype.initializeProgram=function(e){var t=r.shader.get(),n=this.configuration,i=t.build({output:n.output,viewingMode:e.viewingMode,occlusionTestEnabled:n.occlusionTestEnabled,signedDistanceFieldEnabled:n.sdf,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:n.debugDrawBorder,binaryHighlightOcclusionEnabled:n.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:n.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:n.screenSizePerspective,verticalOffsetEnabled:n.verticalOffset,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!1});return new _(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),m.Default3D)},r.prototype.bindPass=function(e,t,n){this.program.setUniform1f("cameraGroundRelative",n.cameraAboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(n.fovY/2)/(n.viewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",n.viewInvTransp),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),s.VerticalOffset.bindUniforms(this.program,t,n),h.ScreenSizePerspective.bindUniforms(this.program,t),d.Viewport.bindUniforms(this.program,n),6===this.configuration.output?c.HUDOcclusion.bindUniforms(this.program):(l.HUD.bindUniforms(this.program,n),b.HUDMaterial.bindUniforms(this.program,t,n),p.VisualVariables.bindUniforms(this.program,t),this.configuration.occlusionTestEnabled&&l.HUD.bindVisibilityTexture(e,this.program,n)),4===this.configuration.output&&u.OutputHighlight.bindOutputHighlight(e,this.program,n)},r.prototype.bindDraw=function(e){a.Transform.bindUniforms(this.program,e),d.Camera.bindUniforms(this.program,e),o.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},r.prototype.initializePipeline=function(){return w.makePipelineState(4===this.configuration.output?{blending:x.separateBlendingParams(1,1,771,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},colorWrite:w.defaultColorWriteParams}:6===this.configuration.output?{depthTest:{func:515},depthWrite:w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams}:{blending:x.simpleBlendingParams(1,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:this.configuration.depthEnabled?515:519},depthWrite:this.configuration.depthEnabled?w.defaultDepthWriteParams:void 0,colorWrite:w.defaultColorWriteParams})},Object.defineProperty(r.prototype,"primitiveType",{get:function(){return 6===this.configuration.output?0:4},enumerable:!0,configurable:!0}),r.shader=new f.ReloadableShaderModule(y,"./HUDMaterial.glsl",e),r}(v.ShaderTechnique);t.HUDMaterialTechnique=S;var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.occlusionTestEnabled=!0,t.sdf=!1,t.vvSize=!1,t.vvColor=!1,t.verticalOffset=!1,t.screenSizePerspective=!1,t.screenCenterOffsetUnitsEnabled=0,t.debugDrawBorder=!0,t.binaryHighlightOcclusion=!0,t.slicePlaneEnabled=!1,t.polygonOffsetEnabled=!1,t.depthEnabled=!0,t}return n(t,e),r([g.parameter({count:7})],t.prototype,"output",void 0),r([g.parameter()],t.prototype,"occlusionTestEnabled",void 0),r([g.parameter()],t.prototype,"sdf",void 0),r([g.parameter()],t.prototype,"vvSize",void 0),r([g.parameter()],t.prototype,"vvColor",void 0),r([g.parameter()],t.prototype,"verticalOffset",void 0),r([g.parameter()],t.prototype,"screenSizePerspective",void 0),r([g.parameter({count:2})],t.prototype,"screenCenterOffsetUnitsEnabled",void 0),r([g.parameter()],t.prototype,"debugDrawBorder",void 0),r([g.parameter()],t.prototype,"binaryHighlightOcclusion",void 0),r([g.parameter()],t.prototype,"slicePlaneEnabled",void 0),r([g.parameter()],t.prototype,"polygonOffsetEnabled",void 0),r([g.parameter()],t.prototype,"depthEnabled",void 0),t}(g.ShaderTechniqueConfiguration);t.HUDMaterialTechniqueConfiguration=P}).apply(null,r))||(e.exports=i)},pvGl:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("xhoE"),n("Q2wQ"),n("HZ3d"),n("KtQ6"),n("BcWh"),n("eIBl"),n("xoE+"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("woUR"),n("5T2R"),n("uiHv"),n("X5J5"),n("Fe95"),n("48/q"),n("dtql"),n("ys4y"),n("4ziW")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w,S){Object.defineProperty(t,"__esModule",{value:!0});var P=function(e){function t(t){var n=e.call(this)||this;return n._handles=new l,n._radius=b.DISC_RADIUS,n.events=new s,n._tool=t.tool,n._view=t.view,null!=t.radius&&(n._radius=t.radius),n.createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return r(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))},t.prototype.forEachManipulator=function(e){e(this._manipulator,0)},t.prototype.createGraphicDragPipeline=function(e,t){var n=this,r=u.expect(e.graphic.geometry).spatialReference;return x.createGraphicMoveDragPipeline(e,t,(function(e){return n.createDragPipeline(e,r)}))},t.prototype.createDragPipeline=function(e,t){var n=this._view;return m.createManipulatorDragEventPipeline(this._manipulator,(function(r,i,o,a){var s=i.next(m.screenToZConstrained(n,r.renderLocation,t)).next(m.addScreenDelta());e(r,s,o,a)}))},Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this.updateManipulator())},enumerable:!0,configurable:!0}),t.prototype.updateManipulator=function(){var e=this._radius/b.DISC_RADIUS,t=y.settings.zManipulator.height*e,n=y.settings.zManipulator.coneHeight*e,r=y.settings.zManipulator.coneWidth*e,i=y.settings.zManipulator.width*e,o=[f.vec3f64.fromValues(0,0,0),f.vec3f64.fromValues(0,0,t)],s=new w(S.createTubeGeometry(o,i/2,16,!1),"move-z"),l=S.createConeGeometry(n,r/2,16,!1),c=new w(l),u=[f.vec3f64.fromValues(0,0,0),f.vec3f64.fromValues(0,0,t+n)],h=function(e){var n=d.mat4f64.create();return p.mat4.translate(n,n,[0,0,t]),p.mat4.rotateX(n,n,Math.PI/2),n}(),v=function(e,t){var n=a.darken(y.settings.zManipulator.color,t);return[n.r/255,n.g/255,n.b/255,y.settings.zManipulator.color.a*e]},m=g.createManipulatorMaterial(v(1,.25),1),_=g.createManipulatorMaterial(v(1,0),1),x=g.createManipulatorMaterial(v(.7,0),y.settings.zManipulator.occludedFlag),P=g.createManipulatorMaterial(v(.85,0),y.settings.zManipulator.occludedFlag);this._manipulator.renderObjects=[{geometry:c,transform:h,material:m,stateMask:1},{geometry:s,material:m,stateMask:1},{geometry:c,transform:h,material:_,stateMask:2},{geometry:s,material:_,stateMask:2},{geometry:c,transform:h,material:x,stateMask:1},{geometry:s,material:x,stateMask:1},{geometry:c,transform:h,material:P,stateMask:2},{geometry:s,material:P,stateMask:2}],this._manipulator.radius=i/2+2,this._manipulator.collisionType={type:"line",paths:[u]}},t.prototype.createManipulator=function(){var e=this,t=new v.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var n=e._view.state.camera,r=O;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,r);var i=h.vec3.dist(n.eye,r),o=n.computeRenderPixelSizeAtDist(i),a=h.vec3.subtract(M,r,n.eye);h.vec3.normalize(a,a);var s=A;e._view.renderCoordsHelper.worldUpAtPosition(O,s);var l=Math.abs(h.vec3.dot(a,s)),u=h.vec3.cross(M,a,s),p=h.vec3.cross(M,u,s),d=c.clamp(l,.01,1),f=1-Math.sqrt(1-d*d)/d/n.fullWidth,v=y.settings.zManipulator.width*(e._radius/b.DISC_RADIUS);h.vec3.scale(p,h.vec3.normalize(p,p),(1/f-1)*i+o*v),t[12]-=M[0],t[13]-=M[1],t[14]-=M[2]},this._manipulator=t,this.updateManipulator()},t}(_.Manipulation);t.MoveZManipulation=P;var O=f.vec3f64.create(),M=f.vec3f64.create(),A=f.vec3f64.create()}).apply(null,r))||(e.exports=i)},qSzK:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("xoE+"),n("hk44"),n("0W55"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,o,a,s){var l,c,u,p,d,h,f,v,g,m,y,b,_,x;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultAngleCutoff=r.deg2rad(6),t.build=function(e){var t=new s.ShaderBuilder;return t.extensions.add("GL_OES_standard_derivatives"),t.include(o.ScreenSpacePass),t.include(i.Laserline,e),t.fragment.uniforms.add("angleCutoff","vec2"),t.fragment.uniforms.add("globalAlpha","float"),e.heightPlaneEnabled&&t.fragment.uniforms.add("heightPlane","vec4"),e.heightPlaneHeightEnabled&&(t.fragment.uniforms.add("heightPlaneHeight","float"),t.fragment.uniforms.add("heightPlaneFillColor","vec4")),e.pointDistanceEnabled&&t.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&t.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightPlaneEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&t.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&t.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.heightPlaneEnabled||e.lineVerticalPlaneEnabled)&&(e.heightPlaneHeightEnabled&&!e.lineVerticalPlaneEnabled||t.fragment.code.add(a.glsl(l||(l=n(["\n      float planeDistancePixels(vec4 plane, vec3 pos) {\n        float dist = dot(plane.xyz, pos) + plane.w;\n        float width = fwidth(dist);\n        dist /= min(width, maxPixelDistance);\n        return abs(dist);\n      }"],["\n      float planeDistancePixels(vec4 plane, vec3 pos) {\n        float dist = dot(plane.xyz, pos) + plane.w;\n        float width = fwidth(dist);\n        dist /= min(width, maxPixelDistance);\n        return abs(dist);\n      }"])))),e.heightPlaneHeightEnabled&&t.fragment.code.add(a.glsl(c||(c=n(["\n      vec2 boxDistancePixels(vec4 plane, float height, vec3 pos) {\n        float d = dot(plane.xyz, pos);\n\n        float offsetMin = plane.w;\n        float offsetMax = offsetMin - height;\n\n        float dmin = d + offsetMin;\n        float dmax = d + offsetMax;\n\n        float width = fwidth(d);\n\n        float outerDistance = min(abs(dmin), abs(dmax));\n        float innerDistance = max(-dmin, dmax);\n\n        return vec2(innerDistance, outerDistance) / min(width, maxPixelDistance);\n      }"],["\n      vec2 boxDistancePixels(vec4 plane, float height, vec3 pos) {\n        float d = dot(plane.xyz, pos);\n\n        float offsetMin = plane.w;\n        float offsetMax = offsetMin - height;\n\n        float dmin = d + offsetMin;\n        float dmax = d + offsetMax;\n\n        float width = fwidth(d);\n\n        float outerDistance = min(abs(dmin), abs(dmax));\n        float innerDistance = max(-dmin, dmax);\n\n        return vec2(innerDistance, outerDistance) / min(width, maxPixelDistance);\n      }"]))))),e.pointDistanceEnabled&&t.fragment.code.add(a.glsl(u||(u=n(["\n    float sphereDistancePixels(vec4 sphere, vec3 pos) {\n      float dist = distance(sphere.xyz, pos) - sphere.w;\n      float width = fwidth(dist);\n      dist /= min(width, maxPixelDistance);\n      return abs(dist);\n    }\n    "],["\n    float sphereDistancePixels(vec4 sphere, vec3 pos) {\n      float dist = distance(sphere.xyz, pos) - sphere.w;\n      float width = fwidth(dist);\n      dist /= min(width, maxPixelDistance);\n      return abs(dist);\n    }\n    "])))),e.intersectsLineEnabled&&t.fragment.code.add(a.glsl(p||(p=n(["\n    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\n      float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\n      return abs(dist) - radius;\n    }\n    "],["\n    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\n      float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\n      return abs(dist) - radius;\n    }\n    "])))),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.fragment.code.add(a.glsl(d||(d=n(["\n    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\n      vec3 dir = end - start;\n      float t2 = dot(dir, pos - start);\n      float l2 = dot(dir, dir);\n      return t2 >= 0.0 && t2 <= l2;\n    }\n    "],["\n    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\n      vec3 dir = end - start;\n      float t2 = dot(dir, pos - start);\n      float l2 = dot(dir, dir);\n      return t2 >= 0.0 && t2 <= l2;\n    }\n    "])))),t.fragment.code.add(a.glsl(h||(h=n(["\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    vec4 color = vec4(0, 0, 0, 0);\n  "],["\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    vec4 color = vec4(0, 0, 0, 0);\n  "])))),e.heightPlaneEnabled&&(t.fragment.code.add(a.glsl(f||(f=n(["\n    {\n      float heightPlaneAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\n    "],["\n    {\n      float heightPlaneAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\n    "])))),t.fragment.code.add(a.glsl(e.heightPlaneHeightEnabled?v||(v=n(["\n      vec2 heightBoxDistance = boxDistancePixels(heightPlane, heightPlaneHeight, pos);\n      vec4 heightPlaneFill = premultipliedColor(heightPlaneFillColor.rgb, heightPlaneFillColor.a) * clamp(0.5 - heightBoxDistance.x, 0.0, 1.0);\n      vec4 heightPlaneLine = laserlineProfile(heightBoxDistance.y);\n\n      vec4 heightPlaneColor = blendPremultiplied(heightPlaneFill, heightPlaneLine);\n      "],["\n      vec2 heightBoxDistance = boxDistancePixels(heightPlane, heightPlaneHeight, pos);\n      vec4 heightPlaneFill = premultipliedColor(heightPlaneFillColor.rgb, heightPlaneFillColor.a) * clamp(0.5 - heightBoxDistance.x, 0.0, 1.0);\n      vec4 heightPlaneLine = laserlineProfile(heightBoxDistance.y);\n\n      vec4 heightPlaneColor = blendPremultiplied(heightPlaneFill, heightPlaneLine);\n      "])):g||(g=n(["\n      vec4 heightPlaneColor = laserlineProfile(planeDistancePixels(heightPlane, pos));\n      "],["\n      vec4 heightPlaneColor = laserlineProfile(planeDistancePixels(heightPlane, pos));\n      "])))),t.fragment.code.add(a.glsl(m||(m=n(["\n      color = max(color, heightPlaneColor * heightPlaneAlpha);\n    }\n    "],["\n      color = max(color, heightPlaneColor * heightPlaneAlpha);\n    }\n    "]))))),e.pointDistanceEnabled&&t.fragment.code.add(a.glsl(y||(y=n(["\n    {\n      // distance to sphere\n      float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\n      vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\n      float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\n\n      color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n    }\n    "],["\n    {\n      // distance to sphere\n      float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\n      vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\n      float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\n\n      color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n    }\n    "])))),e.lineVerticalPlaneEnabled&&t.fragment.code.add(a.glsl(b||(b=n(["\n    {\n      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\n        float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\n\n        vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\n        float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\n\n        color = max(color, lineVerticalColor * lineVerticalAlpha);\n      }\n    }\n    "],["\n    {\n      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\n        float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\n\n        vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\n        float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\n\n        color = max(color, lineVerticalColor * lineVerticalAlpha);\n      }\n    }\n    "])))),e.intersectsLineEnabled&&t.fragment.code.add(a.glsl(_||(_=n(["\n    {\n      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\n        float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\n        vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\n        float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\n\n        color = max(color, intersectsLineColor * intersectsLineAlpha);\n      }\n    }\n    "],["\n    {\n      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\n        float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\n        vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\n        float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\n\n        color = max(color, intersectsLineColor * intersectsLineAlpha);\n      }\n    }\n    "])))),t.fragment.code.add(a.glsl(x||(x=n(["\n    gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);\n  }\n  "],["\n    gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);\n  }\n  "])))),t}}).apply(null,r))||(e.exports=i)},qUb7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("Rdxj")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MainLight=function(e,t,r){void 0===e&&(e=n.vec3f64.create()),void 0===t&&(t=n.vec3f64.fromValues(.57735,.57735,.57735)),void 0===r&&(r=!0),this.intensity=e,this.direction=t,this.castShadows=r},t.FillLight=function(e,t){void 0===e&&(e=n.vec3f64.create()),void 0===t&&(t=n.vec3f64.fromValues(.57735,.57735,.57735)),this.intensity=n.vec3f64.create(),this.direction=n.vec3f64.create(),this.intensity=e,this.direction=t},t.AmbientLight=function(e){void 0===e&&(e=n.vec3f64.create()),this.intensity=e},t.SphericalHarmonicsLight=function(){this.sh={r:[0],g:[0],b:[0]}}}).apply(null,r))||(e.exports=i)},qkUi:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("runW"),n("x82K"),n("pESw")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicMove3DTool=n.GraphicMove3DTool,t.GraphicReshape3DTool=r.GraphicReshape3DTool,t.GraphicTransform3DTool=i.GraphicTransform3DTool}).apply(null,r))||(e.exports=i)},quQL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.PiUtils=function(e){e.vertex.code.add(r.glsl(i||(i=n(["\n    const float PI = 3.141592653589793;\n  "],["\n    const float PI = 3.141592653589793;\n  "])))),e.fragment.code.add(r.glsl(o||(o=n(["\n    const float PI = 3.141592653589793;\n    const float LIGHT_NORMALIZATION = 1.0 / PI;\n    const float INV_PI = 0.3183098861837907;\n    const float HALF_PI = 1.570796326794897;\n    "],["\n    const float PI = 3.141592653589793;\n    const float LIGHT_NORMALIZATION = 1.0 / PI;\n    const float INV_PI = 0.3183098861837907;\n    const float HALF_PI = 1.570796326794897;\n    "]))))}}).apply(null,r))||(e.exports=i)},qvwY:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e){return e instanceof Float32Array&&e.length>=16}function r(e){return Array.isArray(e)&&e.length>=16}Object.defineProperty(t,"__esModule",{value:!0}),t.isMat4f32=n,t.isMat4f64=r,t.isMat4=function(e){return n(e)||r(e)}}).apply(null,r))||(e.exports=i)},rCq5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConversion=function(e,t){var l=[r.glsl(i||(i=n(["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "],["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "]))),r.glsl(o||(o=n(["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "],["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "]))),r.glsl(a||(a=n(["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "],["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "]))),r.glsl(s||(s=n(["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "],["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "])))];switch(t.stages){case 0:l.forEach((function(t){return e.vertex.code.add(t)}));break;case 1:l.forEach((function(t){return e.fragment.code.add(t)}));break;default:l.forEach((function(t){return e.vertex.code.add(t)})),l.forEach((function(t){return e.fragment.code.add(t)}))}}}).apply(null,r))||(e.exports=i)},raiv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("qKT0"),n("2Atf"),n("FXVB"),n("1m5D"),n("W/V4"),n("FQ4r"),n("lBa0"),n("UGy0"),n("G0ER"),n("qbr3"),n("qbr3")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h){Object.defineProperty(t,"__esModule",{value:!0});var f=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return n(r,t),r.prototype.initializeProgram=function(e){var t=r.shader.get().build(this.configuration);return new p(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),r.attributeLocations)},r.prototype.bind=function(e,t,n){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*n.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*n.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",n.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/n.fullWidth,2/n.fullHeight),this.program.setUniformMatrix4fv("uProjectionMatrix",n.projectionMatrix),o.mat4.translate(g,n.viewMatrix,t),this.program.setUniformMatrix4fv("uModelViewMatrix",g),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1)},r.prototype.initializePipeline=function(){return h.makePipelineState({blending:d.simpleBlendingParams(1,771),colorWrite:h.defaultColorWriteParams})},r.prototype.bindPipelineState=function(e){e.setPipelineState(this.pipeline)},r.shader=new s.ReloadableShaderModule(u,"./LaserlinePath.glsl",e),r.attributeLocations={start:0,end:1,up:2,extrude:3},r}(l.ShaderTechnique);t.LaserlinePathTechnique=f;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.contrastControlEnabled=!1,t}return n(t,e),r([c.parameter()],t.prototype,"contrastControlEnabled",void 0),t}(c.ShaderTechniqueConfiguration);t.LaserlinePathTechniqueConfiguration=v;var g=a.mat4f64.create()}).apply(null,r))||(e.exports=i)},rjU6:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("KY0m"),n("LxLY")],void 0===(i=(function(e,t,n,r){function i(e,t,n,r){if(n>=t)return e;null==e&&(e=c());var i=e.isVisibleBit,o=e.data,a=g(o),s=n/a|0,l=n-a*s,u=(t-1)/a|0,p=o,d=r===i;if(!(n<p.length*a)&&d){var h=s+1,f=Math.ceil(1.5*p.length),v=u+1,m=Math.max(h,f);m=Math.min(m,v),(o=new Uint32Array(m)).set(p)}return s<o.length&&(o[s]=function(e,t,n){return e&~(1<<t)|(n?1:0)<<t}(o[s],l,d)),e.data=o,e}function o(e,t){if(null==e)return!0;var n=e.isVisibleBit,r=e.data,i=g(r);return t<r.length*i?v(n,r,t,i):f(e)}function a(e){return r.isSome(e.component)?e.component:-1}function s(e,t,n,r){o(t,r)&&l(e,n[r],_(n[r+1]))}function l(e,t,n){var r=e.length>0?e[e.length-1]:null;(r?r[1]:-1)>=t||e.push([t,n])}function c(e){return void 0===e&&(e=!0),{isVisibleBit:!e,data:new Uint32Array(0)}}function u(e,t){return!d(e,t,!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.updateVisibility=function(e,t,n,r){return i(e,x(t),n,r)},t.updateVisibilityWithCount=i,t.getVisibility=o,t.hideAllComponents=function(e){if(null==e)return c(!1);e.isVisibleBit=!0;for(var t=0;t<e.data.length;t++)e.data[t]=0;return e},t.unhideAllComponents=function(e){if(null==e)return null;e.isVisibleBit=!1;for(var t=0;t<e.data.length;t++)e.data[t]=0;return e},t.generateVisibleIndexRanges=function(e,t){var n;if(e)if(h(t))if(0===e.data.length)b=[],w=[[t[0],_(t[t.length-1])]],n=f(e)?w:b;else{n=[];for(var r=e.isVisibleBit,i=e.data,o=g(i),a=i.length*o,s=x(t),l=!1,c=0;c<a&&c<s;c++){var u=v(r,i,c,o);if(u!==l){var p=t[c];u?n.push([p,0]):(m=n[n.length-1])[1]=_(p),l=u}}var d=f(e);if(s>a&&d&&!l)n.push([t[a],_(t[s])]);else if(l){var m=n[n.length-1],y=d?s:Math.min(s,a);m[1]=_(t[y])}}else{var b=[],w=null;n=f(e)?w:b}else n=null;return n},t.addOccludee=function(e,t){return(e=e||[]).push({id:t}),e},t.removeOccludee=function(e,t){if(!e)return e;var n=e.filter((function(e){return e.id!==t}));return 0===n.length?null:n},t.addHighlight=function(e,t,n){var r,i={component:t,id:n};(e=e||[]).push(i);for(var o=a(i),s=e.length-1;s>0&&o<a(e[s-1]);)e[s-1]=(r=[e[s],e[s-1]])[0],e[s]=r[1],--s;return e},t.removeHighlight=function(e,t){if(!e)return e;var n=e.filter((function(e){return e.id!==t}));return 0===n.length?null:n},t.generateHighlightedIndexRanges=function(e,t,n){if(!t)return null;if(!h(n))return!e||f(e)?t.map((function(e){return null})):null;for(var i=n[0],o=_(n[n.length-1]),a=[],c=u(e,n),p=0;p<t.length;++p){var d=t[p].component;if(r.isSome(d))s(a,e,n,d);else if(c)l(a,i,o);else for(var v=0;v<x(n);++v)s(a,e,n,v)}return a.length>0?a:null},t.hasHighlights=function(e,t,n){if(!t)return!1;if(!h(n))return!(e&&!f(e))&&t.length>0;for(var i=u(e,n),o=0,a=t;o<a.length;o++){if(r.isSome(a[o].component))return!0;if(i)return!0;if(x(n)>0)return!0}return!1},t.defaultVisibilities=c,t.isAllVisible=u,t.isAllHidden=function(e,t){return!d(e,t,!0)};var p=c();function d(e,t,n){var r=(e=e||p).isVisibleBit,i=e.data,o=n===r,a=x(t);if(0===i.length||0===a)return!o;var s=g(i);if(i.length*s<a&&!o)return!0;for(var l=b(s),c=b(0),u=0;u<i.length-1;u++)if(!o&&i[u]!==l||o&&i[u]!==c)return!0;var d=i.length-1,h=b((a-1)%s+1);return!o&&(i[d]&h)!==h||o&&(i[d]&h)!==c}function h(e){return e.length>0}function f(e){return!e.isVisibleBit}function v(e,t,n,r){var i=n/r|0;return function(e,t){return 0!=(e&1<<t)}(t[i],n-i*r)===e}function g(e){return 8*e.BYTES_PER_ELEMENT}t.createOffsets=function(e){return e instanceof Uint32Array?e:new Uint32Array(e)},t.hasComponents=h;for(var m=[],y=0;y<65;y++)m.push(Math.pow(2,y)-1);function b(e){return m[e]}function _(e){return e-1}function x(e){return Math.max(0,e.length-1)}t.componentCount=x,t.componentFind=function(e,t){var r=n.binaryIndexOf(e,t,!0);return r>=0?r:null}}).apply(null,r))||(e.exports=i)},runW:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("2Atf"),n("y4WC"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("Vx27"),n("ZcgO"),n("DtIM"),n("5T2R"),n("uiHv"),n("1eTA"),n("X5J5"),n("G+tB"),n("I5JL"),n("Fe95"),n("BhkK"),n("dtql"),n("73uV"),n("R4nD"),n("/NuL"),n("X7Ps")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w,S,P,O){Object.defineProperty(t,"__esModule",{value:!0});var M=function(e){this.allGraphics=e,this.type="graphic-move-start"};t.GraphicMoveStartEvent=M;var A=function(e,t,n,r){this.dx=e,this.dy=t,this.dz=n,this.allGraphics=r,this.type="graphic-move"};t.GraphicMoveEvent=A;var C=function(e){this.allGraphics=e,this.type="graphic-move-stop"};t.GraphicMoveStopEvent=C;var D=function(e){function t(t){var n=e.call(this,t)||this;return n.graphics=new o,n.enableZ=!0,n.type="move-3d",n._toolHandles=new s,n._handles=new s,n}return r(t,e),t.prototype.initialize=function(){var e=this;this._toolHandles.add([this.graphics.on("change",(function(){e._refreshManipulators()})),g.settings.zManipulator.watch(g.settings.zManipulator.keys(),(function(){return e._refreshManipulators()}))]),this._refreshManipulators()},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)},t.prototype.reset=function(){},t.prototype._refreshManipulators=function(){var e=this;this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var t=this.graphics.toArray().filter((function(e){return 0===y.isSupportedGraphic(e)})).map((function(e){return new R(e)}));t.length&&(this.createManipulators(t),this.createVisualElements(t),this._handles.add(t.map((function(t){return e.view.trackGraphicState(t.state)}))),this.updateMoveManipulation(t))},t.prototype.createManipulators=function(e){for(var t=this,n=function(n){var o=n.state;n.manipulationXY=new w.MoveXYGraphicManipulation({tool:r,view:r.view,graphicState:o}),n.manipulationXY.forEachManipulator((function(e){return t._handles.add(e.events.on("immediate-click",(function(e){t.emit("immediate-click",i({},e,{graphic:o.graphic})),e.stopPropagation()})))})),r._handles.add(n.manipulationXY.createDragPipeline((function(n,r,i){return t.buildDragEventPipeline(n,r,i,e)})))},r=this,o=0,a=e;o<a.length;o++)n(a[o]);this.createMoveManipulation(e)},t.prototype.createMoveManipulation=function(e){var t=this,n=new _.MoveManipulation({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?_.MoveManipulation.radiusForSymbol(e[0].graphic.symbol):b.DISC_RADIUS});this._moveManipulation=n,n.elevationInfo={mode:"absolute-height",offset:0},n.forEachManipulator((function(e){t._handles.add(e.events.on("immediate-click",(function(r){n.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",i({},r,{graphic:t.graphics.getItemAt(0)})),r.stopPropagation()})))}));for(var r=function(){return t.updateMoveManipulation(e)},o=0,a=e;o<a.length;o++){var s=a[o];this._handles.add([s.state.on("changed",r),s.state.watch("displaying",r)])}var l=e[e.length-1];this._handles.add(l.state.on("changed",(function(){return t.updateMoveManipulationAngle(l)}))),this._handles.add(n.createDragPipeline((function(n,r,i){t.buildDragEventPipeline(n,r,i,e)}),d.getGraphicEffectiveElevationInfo(l.graphic),c.expect(l.graphic.geometry).spatialReference)),this.updateMoveManipulationAngle(l)},t.prototype.createVisualElements=function(e){for(var t=this,n=function(n){var i=m.createVisualElements({view:r.view,graphic:n.graphic,forEachManipulator:function(e){n.manipulationXY.forEachManipulator(e),t._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return l.makeHandle()}});n.geometryRepresentation=i.visualElement,n.geometryRepresentation instanceof S.OutlineVisualElement&&r._handles.add([n.geometryRepresentation.events.on("attachment-origin-changed",(function(){n.state.isDraped||t.updateMoveManipulation(e)})),n.state.watch("isDraped",(function(){return t.updateMoveManipulation(e)}))]),r._handles.add(i)},r=this,i=0,o=e;i<o.length;i++)n(o[i])},t.prototype.updateMoveManipulationAngle=function(e){this._moveManipulation.angleDeferred=function(){return x.primaryShapeOrientation(e.graphic.geometry)}},t.prototype.updateMoveManipulation=function(e){for(var t=p.makeDehydratedPoint(0,0,0,this.view.spatialReference),n=0,r=!1,i=this._moveManipulation,o=0,a=e;o<a.length;o++){var s=a[o];if(s.state.displaying){var l=s.state.graphic;this.enableZ&&v.canMoveZ(l)&&(r=!0);var u=s.geometryRepresentation instanceof S.OutlineVisualElement&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:h.getGraphicAttachmentOrigin(this.view,l);c.isSome(u)&&(t.x+=u.x,t.y+=u.y,t.z+=u.z,n++)}}n>0?(t.x/=n,t.y/=n,t.z/=n,i.location=t,i.xyManipulation.available=!0,i.xyAxisManipulation.available=!0,i.zManipulation.available=r):i.available=!1},t.prototype.buildDragEventPipeline=function(e,t,n,r){var i=this,o=[],a=[],s=null,l=null,c=function(){for(var e=0,t=o;e<t.length;e++)t[e].dragging=!1;o.length=0,a.length=0,s=null,l=null,i._moveManipulation.interactive=!0};t.next((function(t){if("start"===t.action){o.length=0,a.length=0;for(var n=0,c=r;n<c.length;n++){var u=c[n];u.dragging||!u.manipulationXY.hasManipulator(e)&&u.manipulationXY.grabbing||(o.push(u),a.push(u.graphic),u.dragging=!0)}if(0!==a.length&&(i._moveManipulation.interactive=!1,s=f.dragGraphicMany(a),l=f.resetGraphicMany(a),i.emit("graphic-move-start",new M(a)),i.destroyed))return null}return 0!==a.length?t:null})).next((function(e){return s(e)})).next((function(e){switch(e.action){case"start":case"update":if((e.translationX||e.translationY||e.translationZ)&&(i.emit("graphic-move",new A(e.translationX,e.translationY,e.translationZ,a)),i.destroyed))return null;break;case"end":if(i.emit("graphic-move-stop",new C(a)),i.destroyed)return null;c()}})),n.next((function(e){return l(e)})).next((function(){if(i.emit("graphic-move-stop",new C(a)),i.destroyed)return null;c()}))},n([u.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n([u.property({readOnly:!0})],t.prototype,"graphics",void 0),n([u.property({constructOnly:!0,nonNullable:!0})],t.prototype,"enableZ",void 0),n([u.property({readOnly:!0})],t.prototype,"type",void 0),n([u.subclass("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMove3DTool")],t)}(u.declared(a.EventedMixin(O.InteractiveToolBase)));t.GraphicMove3DTool=D;var R=function(){function e(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new P.GraphicState({graphic:e})}return Object.defineProperty(e.prototype,"graphic",{get:function(){return this.state.graphic},enumerable:!0,configurable:!0}),e}()}).apply(null,r))||(e.exports=i)},s6rJ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("2Atf"),n("xoE+"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("WRgd"),n("rjU6"),n("+wMf"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h){Object.defineProperty(t,"__esModule",{value:!0});var f=a.mat4f64.create(),v=u.create(),g=h.VertexAttrConstants;t.intersectTriangleGeometry=function(e,t,n,r,o,a,s){var l=t&&t.componentVisibilities,c=n.tolerance;if(e.componentCount>1)!function(e,t,n,r,o,a,s){var l=P(n,r,m),c=e.componentCount,d=e.componentOffsets,h=e.getIndices(g.POSITION),f=e.getAttribute(g.POSITION),y=e.boundingInfo;if(!y||(u.setMin(v,y.getBBMin()),u.setMax(v,y.getBBMax()),i.isSome(a)&&a.applyToAABB(v),O(v,n,l,o)))for(var b=0;b<c;b++)if(!t||p.getVisibility(t,b)){if(e.getComponentAABB){var x=e.getComponentAABB(b,v);if(i.isSome(a)&&a.applyToAABB(x),!O(x,n,l,o))continue}_(n,r,d[b]/3,d[b+1]/3,h,f,void 0,a,s)}}(e,l,r,o,c,a,s);else if(!l||p.getVisibility(l,0))if(e.boundingInfo)h.assert("triangle"===e.data.primitiveType),function e(t,n,r,o,a,s){var l=P(n,r,m);if(u.setMin(v,t.getBBMin()),u.setMax(v,t.getBBMax()),i.isSome(a)&&a.applyToAABB(v),O(v,n,l,o)){var c=t.getPrimitiveIndices(),p=t.getIndices(),d=t.getPosition(),h=c?c.length:p.length/3;if(h>C){var f=t.getChildren();if(void 0!==f){for(var g=0;g<8;++g)void 0!==f[g]&&e(f[g],n,r,o,a,s);return}}_(n,r,0,h,p,d,c,a,s)}}(e.boundingInfo,r,o,c,a,s);else{var d=e.getIndices(g.POSITION),f=e.getAttribute(g.POSITION);_(r,o,0,d.length/3,d,f,void 0,a,s)}};var m=l.vec3f64.create(),y=Math.pow(2,-52),b=l.vec3f64.create();function _(e,t,n,r,o,a,s,l,c){var u,p,d;if(s)return function(e,t,n,r,o,a,s,l,c){for(var u,p,d,h=a.data,f=a.offsetIdx,v=a.strideIdx,g=e[0],m=e[1],_=e[2],x=t[0]-g,w=t[1]-m,P=t[2]-_,O=n;O<r;++O){var M=s[O],A=3*M,C=f+v*o[A++],D=h[C++],R=h[C++],T=h[C];C=f+v*o[A++];var E=h[C++],j=h[C++],I=h[C];C=f+v*o[A];var V=h[C++],L=h[C++],z=h[C];i.isSome(l)&&(D=(u=l.applyToVertex(D,R,T))[0],R=u[1],T=u[2],E=(p=l.applyToVertex(E,j,I))[0],j=p[1],I=p[2],V=(d=l.applyToVertex(V,L,z))[0],L=d[1],z=d[2]);var N=E-D,F=j-R,U=I-T,G=V-D,H=L-R,B=z-T,q=w*B-H*P,W=P*G-B*x,k=x*H-G*w,X=N*q+F*W+U*k;if(!(Math.abs(X)<=y)){var Z=g-D,Y=m-R,K=_-T,J=Z*q+Y*W+K*k;if(X>0){if(J<0||J>X)continue}else if(J>0||J<X)continue;var Q=Y*U-F*K,$=K*N-U*Z,ee=Z*F-N*Y,te=x*Q+w*$+P*ee;if(X>0){if(te<0||J+te>X)continue}else if(te>0||J+te<X)continue;var ne=(G*Q+H*$+B*ee)/X;ne>=0&&c(ne,S(N,F,U,G,H,B,b),M)}}}(e,t,n,r,o,a,s,l,c);for(var h=a.data,f=a.offsetIdx,v=a.strideIdx,g=e[0],m=e[1],_=e[2],x=t[0]-g,w=t[1]-m,P=t[2]-_,O=n,M=3*n;O<r;++O){var A=f+v*o[M++],C=h[A++],D=h[A++],R=h[A];A=f+v*o[M++];var T=h[A++],E=h[A++],j=h[A];A=f+v*o[M++];var I=h[A++],V=h[A++],L=h[A];i.isSome(l)&&(C=(u=l.applyToVertex(C,D,R))[0],D=u[1],R=u[2],T=(p=l.applyToVertex(T,E,j))[0],E=p[1],j=p[2],I=(d=l.applyToVertex(I,V,L))[0],V=d[1],L=d[2]);var z=T-C,N=E-D,F=j-R,U=I-C,G=V-D,H=L-R,B=w*H-G*P,q=P*U-H*x,W=x*G-U*w,k=z*B+N*q+F*W;if(!(Math.abs(k)<=y)){var X=g-C,Z=m-D,Y=_-R,K=X*B+Z*q+Y*W;if(k>0){if(K<0||K>k)continue}else if(K>0||K<k)continue;var J=Z*F-N*Y,Q=Y*z-F*X,$=X*N-z*Z,ee=x*J+w*Q+P*$;if(k>0){if(ee<0||K+ee>k)continue}else if(ee>0||K+ee<k)continue;var te=(U*J+G*Q+H*$)/k;te>=0&&c(te,S(z,N,F,U,G,H,b),O)}}}t.intersectTriangles=_;var x=l.vec3f64.create(),w=l.vec3f64.create();function S(e,t,n,r,i,o,a){return s.vec3.set(x,e,t,n),s.vec3.set(w,r,i,o),s.vec3.cross(a,x,w),s.vec3.normalize(a,a),a}function P(e,t,n){return s.vec3.set(n,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function O(e,t,n,r){return M(e,t,n,r,1/0)}function M(e,t,n,r,i){var o=(e[0]-r-t[0])*n[0],a=(e[3]+r-t[0])*n[0],s=Math.min(o,a),l=Math.max(o,a),c=(e[1]-r-t[1])*n[1],u=(e[4]+r-t[1])*n[1];if((l=Math.min(l,Math.max(c,u)))<0)return!1;if((s=Math.max(s,Math.min(c,u)))>l)return!1;var p=(e[2]-r-t[2])*n[2],d=(e[5]+r-t[2])*n[2];return!((l=Math.min(l,Math.max(p,d)))<0)&&!((s=Math.max(s,Math.min(p,d)))>l)&&s<i}function A(e){var t=[];return e.forEach((function(e){return t.push(e)})),t}t.computeNormal=S,t.computeInvDir=P,t.intersectAabbInvDir=O,t.intersectAabbInvDirBefore=M,t.transformToWorld=function(e,t,n){return c.vec4.set(n,e[0]-t[0],e[1]-t[1],e[2]-t[2],1)},t.transformToView=function(e,t,n,r){return o.mat4.translate(f,n,t),c.vec4.transformMat4(r,e,f)},t.transformToProjection=function(e,t,n,r){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r[3]=e[3],c.vec4.transformMat4(r,r,t)},t.transformToNDC=function(e,t){return c.vec4.scale(t,e,1/Math.abs(e[3]))},t.verticalOffsetAtDistance=function(e,t,n,i,o){var a=(n.screenLength||0)*e.pixelRatio;o&&(a=d.scale(a,i,t,o));var s=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return r.glClamp(s*t,n.minWorldLength||0,null!=n.maxWorldLength?n.maxWorldLength:1/0)},t.acquireIfNotUndefined=function(e,t,n){if(void 0!==e)return t.acquire(e,n)},t.releaseIfNotUndefined=function(e,t){void 0!==e&&t.release(e)},t.bindScreenSizePerspective=function(e,t,n){if(void 0===n&&(n="screenSizePerspectiveAlignment"),e){var r=e.parameters;t.setUniform4f(n,r.divisor,r.offset,r.minPixelSize,e.paddingPixelsOverride)}},t.copyParameters=function e(t,n){var r=n?e(n):{};for(var i in t){var o=t[i];o&&o.forEach&&(o=A(o)),null==o&&i in r||(r[i]=o)}return r},t.updateParameters=function(e,t){var n=!1;for(var r in t){var i=t[r];void 0!==i&&(n=!0,e[r]=Array.isArray(i)?i.slice():i)}return n},t.intersectDrapedRenderLineGeometry=function(e,t,n,i,o){if(t.options.selectionMode){for(var a=e.getAttribute(g.POSITION).data,s=e.getAttribute(g.SIZE),l=n[0],c=n[1],u=(((s&&s.data[0])+i)/2+4)*e.pixelRatio,p=Number.MAX_VALUE,d=0;d<a.length-5;d+=3){var h=a[d],f=a[d+1],v=l-h,m=c-f,y=a[d+3]-h,b=a[d+4]-f,_=r.clamp((y*v+b*m)/(y*y+b*b),0,1),x=y*_-v,w=b*_-m,S=x*x+w*w;S<p&&(p=S)}p<u*u&&o()}},t.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var C=1e3}).apply(null,r))||(e.exports=i)},tUyH:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("9opi"),n("qKT0"),n("Vx27"),n("KRuQ")],void 0===(i=(function(e,t,n,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){var n=e.call(this)||this;return n.material=t.material,n.techniqueRep=t.techniqueRep,n.output=t.output,n}return n(t,e),t.prototype.getTechnique=function(){return this.technique},t.prototype.getPipelineState=function(e,t){return this.getTechnique().pipeline},t.prototype.ensureResources=function(e){return 2},t.prototype.ensureParameters=function(e){},r([i.subclass("esri.views.3d.webgl-engine.lib.GLMaterial")],t)}(i.declared(o.AutoDisposable));t.GLMaterial=a}).apply(null,r))||(e.exports=i)},uUnu:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("2o+p"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){function o(e,t){var o=e;o.include(r.ScreenSizePerspective),o.attributes.add("position","vec3"),o.attributes.add("normal","vec3"),o.attributes.add("auxpos1","vec4"),o.vertex.uniforms.add("proj","mat4"),o.vertex.uniforms.add("view","mat4"),o.vertex.uniforms.add("viewNormal","mat4"),o.vertex.uniforms.add("model","mat4"),o.vertex.uniforms.add("modelNormal","mat4"),o.vertex.uniforms.add("viewport","vec4"),o.vertex.uniforms.add("camPos","vec3"),o.vertex.uniforms.add("polygonOffset","float"),o.vertex.uniforms.add("cameraGroundRelative","float"),o.vertex.uniforms.add("pixelRatio","float"),o.vertex.uniforms.add("perDistancePixelRatio","float"),o.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&o.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&o.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),o.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),o.vertex.defines.addFloat("SMALL_OFFSET_ANGLE",.984807753012208),o.vertex.code.add(i.glsl(a||(a=n(["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "],["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "])))),o.vertex.code.add(i.glsl(s||(s=n(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = sign(pointGroundDistance);\n\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "],["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = sign(pointGroundDistance);\n\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "])))),o.vertex.code.add(i.glsl(l||(l=n(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "],["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "])))),o.vertex.code.add(i.glsl(p||(p=n(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = (model * vec4(position, 1.0)).xyz;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = (modelNormal * vec4(normal, 1.0)).xyz;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "],["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = (model * vec4(position, 1.0)).xyz;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = (modelNormal * vec4(normal, 1.0)).xyz;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.verticalOffsetEnabled?i.glsl(c||(c=n(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"],["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",1!==t.screenCenterOffsetUnitsEnabled?i.glsl(u||(u=n(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "],["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),o.vertex.code.add(i.glsl(d||(d=n(["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD > 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD = 0.75\n        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n  "],["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD > 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD = 0.75\n        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n  "]))))}var a,s,l,c,u,p,d;Object.defineProperty(t,"__esModule",{value:!0}),t.HUD=o,function(e){!function(e){e[e.OCCLUDED=0]="OCCLUDED",e[e.NOTOCCLUDED=1]="NOTOCCLUDED",e[e.BOTH=2]="BOTH",e[e.COUNT=3]="COUNT"}(e.TransparentRenderStyle||(e.TransparentRenderStyle={})),e.bindUniforms=function(t,n){t.setUniform1f("uRenderTransparentlyOccludedHUD",n.renderTransparentlyOccludedHUD===e.TransparentRenderStyle.OCCLUDED?1:n.renderTransparentlyOccludedHUD===e.TransparentRenderStyle.NOTOCCLUDED?0:.75)},e.bindVisibilityTexture=function(e,t,n){t.setUniform1i("hudVisibilityTexture",1),e.bindTexture(n.hudVisibilityTexture,1),e.setActiveTexture(0)}}(o=t.HUD||(t.HUD={}))}).apply(null,r))||(e.exports=i)},uZGf:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("2Atf"),n("xhoE"),n("0LE5"),n("Rdxj"),n("2B1V"),n("tUyH"),n("FNtW"),n("CIy2"),n("LZD4"),n("s6rJ"),n("s6rJ"),n("ZeO9"),n("fQ2U")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=a.newLayout().vec3f(c.VertexAttrConstants.POSITION).vec3f(c.VertexAttrConstants.NORMAL),g=function(e){function t(t,n){var r=e.call(this,n)||this;return r.supportsEdges=!0,r.techniqueConfig=new f.ShadedColorMaterialTechniqueConfiguration,r.params=d.copyParameters(t,y),r}return r(t,e),t.prototype.setParameterValues=function(e){p.updateParameters(this.params,e)&&this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig},t.prototype.getPassParameters=function(){return this.params},t.prototype.intersect=function(e,t,n,r,i,o,a){d.intersectTriangleGeometry(e,t,r,i,o,void 0,a)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new m(e):void 0},t.prototype.createBufferWriter=function(){return new u.DefaultBufferWriter(v)},t.prototype.createRenderer=function(e,t){return new h(e,t,this)},t}(l.Material);t.ShadedColorMaterial=g;var m=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return r(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(f.ShadedColorMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){if(4===this.output)return 3===e;var t=3;return this.technique.configuration.transparent&&(t=this.technique.configuration.writeDepth?5:8),e===t},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t}(s.GLMaterial),y={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:i.vec3.normalize(o.vec3f64.create(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0}}).apply(null,r))||(e.exports=i)},uiHv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("2Atf"),n("xhoE"),n("TMur"),n("XwIv"),n("xoE+"),n("xoE+"),n("LxLY"),n("jBNx"),n("0LE5"),n("Rdxj"),n("vtMp"),n("DtIM"),n("aWgr"),n("aWgr"),n("mmEe"),n("JjCO"),n("tJCi")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y){function b(e,t){var n=null,r=null;return e.events.on("drag",(function(i){if("cancel"!==i.action){var o={action:i.action,screenStart:i.start,screenEnd:i.screenPoint};"start"===i.action&&l.isNone(n)&&(n=new D,r=new D,t(e,n,r,o)),l.isSome(n)&&n.execute(o),"end"===i.action&&l.isSome(n)&&(n=null,r=null)}else l.isSome(r)&&(r.execute({}),n=null,r=null)}))}function _(e,t){var r=p.vec3f64.create(),i=p.vec3f64.create(),o=!1;return function(a){if("start"===a.action){var s=c.screenPointObjectToArray(a.screenStart,c.castScreenPointArray(m.sv2d.get())),l=v.ray.fromScreen(e.state.camera,s,E);o=v.plane.intersectRay(t,l,r)}if(!o)return null;var u=c.screenPointObjectToArray(a.screenEnd,c.castScreenPointArray(m.sv2d.get())),p=v.ray.fromScreen(e.state.camera,u,E);return v.plane.intersectRay(t,p,i)?n({},a,{renderStart:r,renderEnd:i,plane:t}):null}}function x(e,t,r,i){void 0===i&&(i=null);var o=null;return function(a){if("start"===a.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen(c.createScreenPointArray(a.screenStart.x,a.screenStart.y),t,r),l.isSome(o)&&l.isSome(i)&&!g.pointToPoint(o,o,i)))return null;if(l.isNone(o))return null;var s=e.sceneIntersectionHelper.intersectElevationFromScreen(c.createScreenPointArray(a.screenEnd.x,a.screenEnd.y),t,r);return l.isSome(s)?l.isSome(i)&&!g.pointToPoint(s,s,i)?null:n({},a,{mapStart:o,mapEnd:s}):null}}function w(e,t,n,r){return void 0===r&&(r=null),x(e,n,h.getZForElevationMode(t,e,n),r)}function S(e,t,n,r){return void 0===r&&(r=null),w(e,n,h.getGraphicEffectiveElevationInfo(t),r)}function P(e,t){var r=null,i=l.isSome(e[t])?e[t].spatialReference:null;return function(o){var a,s;if("start"===o.action&&l.isSome(e[t])&&(s=o.mapStart.spatialReference,r=l.isNone(a=e[t])||"mesh"===a.type?null:a.spatialReference.equals(s)?a.clone():d.canProject(a,s)?d.project(a,s):null),l.isNone(r))return null;var c=o.mapEnd.x-o.mapStart.x,u=o.mapEnd.y-o.mapStart.y,p=o.mapEnd.z-o.mapStart.z,h=y.move(r.clone(),c,u,p);return e[t]=h.spatialReference.equals(i)?h:d.project(h,i),n({},o,{translationX:c,translationY:u,translationZ:p})}}function O(e){return P(e,"geometry")}function M(e){var t=l.isSome(e.geometry)?e.geometry.clone():null;return function(n){return e.geometry=t,n}}function A(e,t){var n=p.vec3f64.create(),r=u.vec3.length(t);e.renderCoordsHelper.worldUpAtPosition(t,n);var i=p.vec3f64.create(),o=p.vec3f64.create(),a=function(i){return u.vec3.subtract(i,i,t),f.vector.projectPoint(n,i,i),"global"===e.viewingMode&&u.vec3.length(i)*s.sign(u.vec3.dot(n,i))<.001-r&&u.vec3.subtract(i,u.vec3.scale(i,n,.001),t),u.vec3.add(i,i,t),i};return function(e){return e.renderStart=a(u.vec3.copy(i,e.renderStart)),e.renderEnd=a(u.vec3.copy(o,e.renderEnd)),e}}function C(e,t){var r=e.renderCoordsHelper;return function(e){var o=r.fromRenderCoords(e.renderStart,new i.Point,t),a=r.fromRenderCoords(e.renderEnd,new i.Point,t);return l.isSome(o)&&l.isSome(a)?n({},e,{mapStart:o,mapEnd:a}):null}}Object.defineProperty(t,"__esModule",{value:!0}),t.createManipulatorDragEventPipeline=b,t.createManipulatorDragEventPipelineMany=function(e,t){for(var n=[],r=0,i=e;r<i.length;r++)n.push(b(i[r],t));return o.handlesGroup(n)},t.screenToRenderPlane=_,t.screenToMapXY=x,t.screenToMapXYAtLocation=w,t.screenToMapXYForGraphicAtLocation=S,t.screenToMapXYForGraphic=function(e,t,n,r){var i=t.toMap(e.screenStart,{include:[n]});return l.isSome(i)?S(t,n,i,r):null},t.screenToZConstrained=function(e,t,n){var r=null,i=new D;return i.next(_(e,function(e,t){var n=R,r=T,i=v.plane.create();e.renderCoordsHelper.worldUpAtPosition(t,n);var o=u.vec3.cross(i,n,u.vec3.subtract(r,t,e.state.camera.eye));return u.vec3.cross(o,o,n),v.plane.fromPositionAndNormal(t,o,i)}(e,t))).next(A(e,t)).next(C(e,n)).next((function(e){e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,r=e})),function(e){return r=null,i.execute(e),r}},t.constrainToMapAxis=function(e,t){var n=[e.x,e.y,e.z],r=t,i=[Math.cos(r),Math.sin(r)],o=Math.sqrt(i[0]*i[0]+i[1]*i[1]);if(0===o)return null;i[0]/=o,i[1]/=o;var a=function(e){var t=(e.x-n[0])*i[0]+(e.y-n[1])*i[1];e.x=n[0]+t*i[0],e.y=n[1]+t*i[1]};return function(e){return a(e.mapStart),a(e.mapEnd),e}},t.dragGeometry=P,t.dragGraphic=O,t.dragGraphicMany=function(e){var t=e.map((function(e){return l.unwrap(O(e))})).filter((function(e){return l.isSome(e)}));return function(e){var r=e.mapEnd.x-e.mapStart.x,i=e.mapEnd.y-e.mapStart.y,o=e.mapEnd.z-e.mapStart.z;return t.forEach((function(t){return t(e)})),n({},e,{translationX:r,translationY:i,translationZ:o})}},t.resetGraphic=M,t.resetGraphicMany=function(e){var t=e.map((function(e){return l.unwrap(M(e))})).filter((function(e){return l.isSome(e)}));return function(e){return t.forEach((function(t){return t(e)})),e}},t.resetSymbol=function(e){var t=l.isSome(e.symbol)?e.symbol.clone():null;return function(n){return e.symbol=t,n}},t.horizontalDegreesOfFreedom=3,t.verticalDegreesOfFreedom=4,t.allDegreesOfFreedom=7,t.addMapDelta=function(e){void 0===e&&(e=t.allDegreesOfFreedom);var r=0,i=0,o=0;return function(t){"start"===t.action&&(r=t.mapStart.x,i=t.mapStart.y,o=t.mapStart.z);var a=1&e?t.mapEnd.x-r:0,s=2&e?t.mapEnd.y-i:0,l=4&e?t.mapEnd.z-o:0;return r=t.mapEnd.x,i=t.mapEnd.y,o=t.mapEnd.z,n({},t,{mapDeltaX:a,mapDeltaY:s,mapDeltaZ:l,mapDeltaSpatialReference:t.mapStart.spatialReference})}},t.addScreenDelta=function(e){void 0===e&&(e=t.allDegreesOfFreedom);var r=0,i=0;return function(t){"start"===t.action&&(r=t.screenStart.x,i=t.screenStart.y);var o=1&e?t.screenEnd.x-r:0,a=2&e?t.screenEnd.y-i:0;return r=t.screenEnd.x,i=t.screenEnd.y,n({},t,{screenDeltaX:o,screenDeltaY:a})}},t.dragAtLocation=function(e,t){var n=null,r=0,i=0;return function(o){if("start"===o.action&&((n=e.toScreen(t)).x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(r=o.screenStart.x-n.x,i=o.screenStart.y-n.y)),null==n)return null;var s=a.clamp(o.screenEnd.x-r,0,e.width),l=a.clamp(o.screenEnd.y-i,0,e.height),u=c.createScreenPoint(s,l);return o.screenStart=n,o.screenEnd=u,o}},t.projectToWorldUp=A,t.convertToMapCoordinates=C;var D=function(){function e(){this.execute=function(){}}return e.prototype.next=function(t,n){return void 0===n&&(n=new e),l.isSome(t)&&(this.execute=function(e){var r=t(e);l.isSome(r)&&n.execute(r)}),n},e}();t.EventPipeline=D;var R=p.vec3f64.create(),T=p.vec3f64.create(),E=v.ray.create()}).apply(null,r))||(e.exports=i)},uinn:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("pcDC"),n("XwIv"),n("xoE+"),n("LxLY"),n("0LE5"),n("Rdxj"),n("WRgd"),n("lRq4"),n("DtIM"),n("Kvb2"),n("X5J5"),n("MCHn"),n("PXiz"),n("i10q"),n("/9Lg"),n("fOZq"),n("/NuL"),n("mmEe")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x){function w(e){return s.isSome(e.geometry)&&"point"===e.geometry.type}Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=function(e){var t=e.view,n=new _.GraphicState({graphic:e.graphic}),r=[],c=function(e,t,n){var r=e.graphic,i=new m.PointVisualElement({view:e.view,geometry:w(r)?r.geometry:null,elevationInfo:d.getGraphicEffectiveElevationInfo(r),attached:!1});return function(e,t,n,r){var i=function(){t.attached=n.displaying&&f.settings.visualElements.pointGraphics.outlineEnabled};(function(e,t,n,r){var i=e.view,a=e.graphic,l=null,c=function(){s.isSome(l)&&(l.remove(),l=null),n.isDraped&&w(a)&&(l=function(e,t,n){x.pointToVector(t,S,e.elevationProvider.spatialReference);var r=S[0],i=S[1];return e.elevationProvider.on("elevation-change",(function(e){p.containsXY(e.extent,r,i)&&n()}))}(i,a.geometry,(function(){t.geometry=a.geometry}))),t.geometry=w(a)?a.geometry:null};r.push(n.on("changed",c),o.refHandle((function(){return l}))),c()})(e,t,n,r),r.push(f.settings.visualElements.pointGraphics.outline.bindStyle(t),n.watch("displaying",i),f.settings.visualElements.pointGraphics.watch("outlineEnabled",i)),i()}(e,i,t,n),n.push(o.destroyHandle(i)),i}(e,n,r);return function(e,t,n,r){var c=e.view,p=e.graphic,m=new g.LineVisualElement({view:c,infinite:f.settings.visualElements.zVerticalLine.infiniteType,attached:!1}),_=new v.LaserlineVisualElement({view:c,intersectsLineInfinite:!0,attached:!1}),O=a.deg2rad(f.settings.visualElements.heightPlaneAngleCutoff),M=new v.LaserlineVisualElement({view:c,attached:!1,angleCutoff:O}),A=null,C=d.getGraphicEffectiveElevationInfo(e.graphic),D=b.fromElevationInfo(C),R="on-the-ground"===C.mode||!C.offset&&"absolute-height"!==C.mode,T=new h.ManipulatorState,E=f.settings.visualElements.heightPlane.bindStyle(M),j=f.settings.visualElements.pointGraphics.shadowStyle.bindStyle(_),I=function(){T.update(e);var n=!1;m.infinite=f.settings.visualElements.zVerticalLine.infiniteType;var o=R&&(t.isDraped||!w(p)||!p.geometry.hasZ);if(!o)switch(f.settings.visualElements.pointGraphics.shadowEnabled){case"always":n=!0;break;case"grab-xy":n=!!(4&T.grabbingState)}var a=!1;switch(f.settings.zManipulator.enabled){case"always":a=!0;break;case"not-grab-z":a=!T.grabbingState}a&&s.isSome(A)?(A.remove(),A=null):!a&&s.isNone(A)&&s.isSome(T.zManipulator)&&(A=T.zManipulator.disableDisplay());var d=!0;if(!o&&w(p)){var h=p.geometry,v=y.evaluateElevationAlignmentAtPoint(p.geometry,c.elevationProvider,D,c.renderCoordsHelper);l.vec3.set(S,h.x,h.y,v),x.vectorToVector(S,h.spatialReference,S,c.renderCoordsHelper.spatialReference),m.worldDownAtLocation=S,_.intersectsWorldUpAtLocation=S}else d=!1;var g=u.empty(P),b=!1;if(!o)switch(f.settings.visualElements.heightPlane.enabled){case"always":b=!0;break;case"grab-z":b=!!(2&T.grabbingState)}E.updateGlobalAlpha(2&T.grabbingState?f.settings.visualElements.laserlineAlphaMultiplier:1),b&&t.displaying&&r.calculateMapBounds(g)&&x.vectorToVector(u.getMin(g,S),c.spatialReference,S,c.renderCoordsHelper.spatialReference)?(M.heightPlane=S,M.attached=!0):M.attached=!1;var O=!1;switch(f.settings.visualElements.zVerticalLine.enabled){case"never":O=!1;break;case"always":O=!0;break;case"grab":O=!!(1&T.grabbingState);break;case"grab-xy":O=!!(4&T.grabbingState);break;case"grab-z":O=!!(2&T.grabbingState);break;default:i.neverReached(f.settings.visualElements.zVerticalLine.enabled)}j.updateGlobalAlpha(4&T.grabbingState?f.settings.visualElements.laserlineAlphaMultiplier:1),_.attached=d&&t.displaying&&!o&&n,m.attached=d&&t.displaying&&!o&&n&&O};n.push(f.settings.zManipulator.watch("enabled",I),f.settings.visualElements.pointGraphics.watch("shadowEnabled",I),f.settings.visualElements.zVerticalLine.bindStyle(m),f.settings.visualElements.zVerticalLine.watch(["enabled","infinite"],I),j,t.watch(["displaying","isDraped"],I),t.on("changed",I),o.refHandle((function(){return A})),E),e.forEachManipulator((function(e){n.push(e.events.on("grab-changed",I))})),n.push(o.destroyHandle(_)),n.push(o.destroyHandle(m)),n.push(o.destroyHandle(M)),I()}(e,n,r,c),r.push(t.trackGraphicState(n)),{visualElement:c,remove:function(){o.handlesGroup(r).remove()}}};var S=c.vec3f64.create(),P=u.create()}).apply(null,r))||(e.exports=i)},v22c:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("qKT0"),n("2Atf"),n("fese"),n("3kdR"),n("cj3m"),n("RdU/"),n("naZ0"),n("W/V4"),n("FQ4r"),n("lBa0"),n("EiD/"),n("ff/U"),n("jl7D"),n("G0ER"),n("qbr3")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m){Object.defineProperty(t,"__esModule",{value:!0});var y=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return n(r,t),r.prototype.initializeProgram=function(e){var t=r.shader.get(),n=this.configuration,i=t.build({output:n.output,viewingMode:e.viewingMode,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:n.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0});return new g(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),f.Default3D)},r.prototype.bindPass=function(e,t){0!==this.configuration.output&&2!==this.configuration.output||l.WaterDistortion.bindUniforms(this.program,t),0!==this.configuration.output&&5!==this.configuration.output||this.program.setUniform4fv("waterColor",t.color)},r.prototype.bindDraw=function(e){a.Transform.bindUniforms(this.program,e),0===this.configuration.output&&(c.Camera.bindUniforms(this.program,e),o.Slice.bindUniformsWithOrigin(this.program,this.configuration,e),s.ReadShadowMap.bindUniforms(this.program,e,h.DefaultTextureUnits.SHADOW_MAP))},r.prototype.initializePipeline=function(){var e=this.configuration;return m.makePipelineState(2===e.output?{depthTest:{func:513},depthWrite:e.writeDepth&&m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams}:{blending:e.transparent&&m.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:e.writeDepth&&m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams})},r.shader=new u.ReloadableShaderModule(v,"../shaders/WaterSurface.glsl",e),r}(p.ShaderTechnique);t.WaterTechnique=y;var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.receiveShadows=!1,t.slicePlaneEnabled=!1,t.transparent=!1,t.writeDepth=!1,t}return n(t,e),r([d.parameter({count:7})],t.prototype,"output",void 0),r([d.parameter()],t.prototype,"receiveShadows",void 0),r([d.parameter()],t.prototype,"slicePlaneEnabled",void 0),r([d.parameter()],t.prototype,"transparent",void 0),r([d.parameter()],t.prototype,"writeDepth",void 0),t}(d.ShaderTechniqueConfiguration);t.WaterTechniqueConfiguration=b}).apply(null,r))||(e.exports=i)},vA3N:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getElevationAtPoint=function(e,t,n){return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,n)}}).apply(null,r))||(e.exports=i)},vGsU:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("ybGv"),n("piY7"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),t.Water=function(e,t){e.include(i.PhysicallyBasedRendering,t),e.include(r.Gamma),e.fragment.code.add(o.glsl(a||(a=n(["\n    const vec3 fresnelSky =  vec3(0.02, 1.0, 5.0); // f0, f0max, exp\n    const vec2 fresnelMaterial =  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness = 0.06;\n\n    const vec3 skyZenitColor = vec3(0, 0.6, 0.9);\n    const vec3 skyColor = vec3(0.72, 0.92, 1.0);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon = the dominant color of the sky horizon\n    *   @parameter: cosTheta = the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n = normal facing away from the surface\n    *   @parameter: v = view direction facing away from the surface.\n    *   @parameter: l = light direction facing away from the surface\n    *   @parameter: lightIntensity = light intensity, currently between 0...PI\n    *   @parameter: localUp = a normal for the general direction of the surface\n    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow) {\n\n      vec3 seaWaterColor = linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h = normalize(l + v);\n      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV = max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon = linearizeGamma(skyColor);\n      vec3 skyZenit = linearizeGamma(skyZenitColor);\n      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL = max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      skyColor *= 0.1 + upDotL * 0.9;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier = clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 reflSky = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]) * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular = vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV > 0.0 && upDotL > 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun = brdfWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular = shadingInfo.NdotL * incidentLight * specularSun;\n      }\n      // combining reflected sky, reflected sea and specular highlight.\n      return tonemapACES(reflSky + reflSea + specular);\n    }\n  "],["\n    const vec3 fresnelSky =  vec3(0.02, 1.0, 5.0); // f0, f0max, exp\n    const vec2 fresnelMaterial =  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness = 0.06;\n\n    const vec3 skyZenitColor = vec3(0, 0.6, 0.9);\n    const vec3 skyColor = vec3(0.72, 0.92, 1.0);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon = the dominant color of the sky horizon\n    *   @parameter: cosTheta = the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n = normal facing away from the surface\n    *   @parameter: v = view direction facing away from the surface.\n    *   @parameter: l = light direction facing away from the surface\n    *   @parameter: lightIntensity = light intensity, currently between 0...PI\n    *   @parameter: localUp = a normal for the general direction of the surface\n    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow) {\n\n      vec3 seaWaterColor = linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h = normalize(l + v);\n      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV = max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon = linearizeGamma(skyColor);\n      vec3 skyZenit = linearizeGamma(skyZenitColor);\n      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL = max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      skyColor *= 0.1 + upDotL * 0.9;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier = clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 reflSky = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]) * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular = vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV > 0.0 && upDotL > 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun = brdfWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular = shadingInfo.NdotL * incidentLight * specularSun;\n      }\n      // combining reflected sky, reflected sea and specular highlight.\n      return tonemapACES(reflSky + reflSea + specular);\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},vJh7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qysZ")],void 0===(i=(function(e,t,n){function r(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=r*s+o*l,e[1]=i*s+a*l,e[2]=r*c+o*u,e[3]=i*c+a*u,e}function i(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},t.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*o-i*r;return a?(e[0]=o*(a=1/a),e[1]=-r*a,e[2]=-i*a,e[3]=n*a,e):null},t.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=r,t.rotate=function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l+o*s,e[1]=i*l+a*s,e[2]=r*-s+o*l,e[3]=i*-s+a*l,e},t.scale=function(e,t,n){var r=t[1],i=t[2],o=t[3],a=n[0],s=n[1];return e[0]=t[0]*a,e[1]=r*a,e[2]=i*s,e[3]=o*s,e},t.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},t.subtract=i,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],i=e[1],o=e[2],a=e[3],s=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(r-s)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-l)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-u)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))},t.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},t.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},t.mul=r,t.sub=i}).apply(null,r))||(e.exports=i)},weRx:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("2Atf"),n("zp6E")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0}),t.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),i=new Uint8Array(r),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return new Blob([r],{type:n})},t.requestImage=function(e,t){return r(e,n({responseType:"image"},t)).then((function(e){return e.data}))}}).apply(null,r))||(e.exports=i)},woUR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("2Atf"),n("TMur"),n("pcDC"),n("BcWh"),n("LxLY"),n("jBNx"),n("o2T8"),n("YX1r"),n("51bw"),n("FXVB"),n("1m5D"),n("W9tT"),n("0LE5"),n("Rdxj"),n("lRq4"),n("ZcgO"),n("vA3N"),n("aWgr"),n("mmEe"),n("JjCO"),n("RsYQ"),n("ZO6V"),n("ZJC8")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w,S,P,O){Object.defineProperty(t,"__esModule",{value:!0});var M=function(){function e(e){for(var t in this.camera=new S.default,this._elevation={offset:0,override:0},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=h.mat4f64.create(),this._worldFrame=null,this._renderLocation=g.vec3f64.create(),this._renderLocationDirty=!0,this._elevationAlignedLocation=new i.Point,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new a({target:this}),this._screenLocation={screenPointArray:l.createScreenPointArray(),renderScreenPointArray:l.createRenderScreenPointArray3(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayerId=null,this._materialIdReferences=null,this._location=new i.Point({x:0,y:0,z:0,spatialReference:e.view.spatialReference}),e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}return e.prototype.destroy=function(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null},Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._updateEngineObject()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderObjects",{get:function(){return this._renderObjects},set:function(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"available",{get:function(){return this._available},set:function(e){e!==this._available&&(this._available=e,this._updateEngineObject())},enumerable:!0,configurable:!0}),e.prototype.disableDisplay=function(){var e=this;return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:c.once((function(){e._noDisplayCount--,0===e._noDisplayCount&&e._updateEngineObject()}))}},Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldSized",{get:function(){return this._worldSized},set:function(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"modelTransform",{get:function(){return this._modelTransform},set:function(e){A(e)&&(this._screenLocationDirty=!0),d.mat4.copy(this._modelTransform,e),this._updateEngineObject()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderLocation",{get:function(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=h.mat4f64.create()),x.computeLinearTransformation(this.view.renderSpatialReference,this._renderLocation,this._worldFrame,this.view.renderSpatialReference),this._worldFrame[12]=0,this._worldFrame[13]=0,this._worldFrame[14]=0):this._worldFrame&&(this._worldFrame=null)),this._renderLocation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"location",{get:function(){return this._location},set:function(e){y.clonePoint(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationAlignedLocation",{get:function(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation},set:function(e){y.clonePoint(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})},enumerable:!0,configurable:!0}),e.prototype._updateElevationAlignedLocation=function(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;var e=s.isSome(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1},Object.defineProperty(e.prototype,"grabbing",{get:function(){return this._grabbing},set:function(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hovering",{get:function(){return this._hovering},set:function(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,this._updateEngineObject())},enumerable:!0,configurable:!0}),e.prototype.updateStateEnabled=function(e,t){t?this.state|=e:this.state&=~e},e.prototype._setFocused=function(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))},Object.defineProperty(e.prototype,"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenLocation",{get:function(){return this.ensureScreenLocation(),this._screenLocation},enumerable:!0,configurable:!0}),e.prototype.ensureScreenLocation=function(){if(this._screenLocationDirty){var e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,A(this._modelTransform)){var t=this._calculateModelTransformOffset(U);e=v.vec3.add(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectPoint(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}},Object.defineProperty(e.prototype,"applyObjectTransform",{get:function(){return this._applyObjectTransform},set:function(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()},enumerable:!0,configurable:!0}),e.prototype.intersectionDistance=function(e,t){if(!this.available)return null;var n=l.screenPointObjectToArray(e,C),r=this._getCollisionRadius(t),i=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(f.vec2.squaredDistance(this.screenLocation.screenPointArray,n)<r*r)return this.screenLocation.renderScreenPointArray[2]+i;break;case"line":for(var a=this.collisionType.paths,s=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(s,j),p=r*this.screenLocation.pixelSize,d=_.ray.fromScreen(this.camera,n,R),h=0,g=a;h<g.length;h++)if(0!==(B=g[h]).length)for(var m=v.vec3.transformMat4(V,B[0],c),y=1;y<B.length;y++){var b=v.vec3.transformMat4(L,B[y],c);if(null!=(q=_.lineSegment.closestRayDistance2(_.lineSegment.fromPoints(m,b,D),d))&&q<p*p){var x=v.vec3.add(w.sv3d.get(),m,b);v.vec3.scale(x,x,.5);var S=l.castRenderScreenPointArray(w.sv3d.get());return this.camera.projectPoint(x,S),S[2]+i}v.vec3.copy(m,b)}break;case"disc":var P=this.collisionType.direction,O=(s=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(s,j),p=r*this.screenLocation.pixelSize,d=_.ray.fromScreen(this.camera,n,R),u.mat3.fromMat4(T,c)),M=v.vec3.transformMat3(N,P,O),A=this._calculateModelTransformPosition(F);_.plane.fromPositionAndNormal(A,M,I);var E=z;if(_.plane.intersectRay(I,d,E)&&v.vec3.squaredDistance(E,A)<p*p)return this.screenLocation.renderScreenPointArray[2]+i;break;case"ribbon":var U=this.collisionType;if(a=U.paths,P=U.direction,s=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(s,j),p=r*this.camera.computeScreenPixelSizeAt(this.renderLocation),d=_.ray.fromScreen(this.camera,n,R),O=u.mat3.fromMat4(T,c),M=v.vec3.transformMat3(N,P,O),A=this._calculateModelTransformPosition(F),_.plane.fromPositionAndNormal(A,M,I),!_.plane.intersectRay(I,d,E=z))break;for(var G=0,H=a;G<H.length;G++){var B;if(0!==(B=H[G]).length)for(m=v.vec3.transformMat4(V,B[0],c),y=1;y<B.length;y++){var q;if(b=v.vec3.transformMat4(L,B[y],c),null!=(q=_.lineSegment.distance2(_.lineSegment.fromPoints(m,b,D),E))&&q<p*p)return x=v.vec3.add(w.sv3d.get(),m,b),v.vec3.scale(x,x,.5),S=l.castRenderScreenPointArray(w.sv3d.get()),this.camera.projectPoint(x,S),S[2]+i;v.vec3.copy(m,b)}}break;default:o.neverReached(this.collisionType)}return null},e.prototype.attach=function(e){if(void 0===e&&(e={manipulator3D:{}}),this.view._stage){var t=e.manipulator3D;if(this._engineLayerId=t.engineLayerId,s.isNone(this._engineLayerId)){var n=new P("manipulator-3d",{isPickable:!1});this.view._stage.add(0,n),this.view._stage.addToViewContent([n.id]),this._engineLayerId=n.id,t.engineLayerId=n.id}t.engineLayerReferences=(t.engineLayerReferences||0)+1,this._materialIdReferences=t.materialIdReferences,s.isNone(this._materialIdReferences)&&(this._materialIdReferences=new Map,t.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),x.canProject(this._location.spatialReference,this.view.spatialReference)||(this.location=new i.Point({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}},e.prototype.detach=function(e){void 0===e&&(e={manipulator3D:{}});var t=e.manipulator3D;t.engineLayerReferences--;var n=0===t.engineLayerReferences;n&&(t.engineLayerId=null),this._removeResourcesFromStage(n),this._engineResources=null,this._engineLayerId=null,this._materialIdReferences=null,this._attached=!1},e.prototype.onViewChange=function(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()},e.prototype.onElevationChange=function(e){m.containsPointObject(e.extent,this.location)&&(this.location=this._location)},e.prototype._evaluateElevationAlignment=function(e){if(void 0===e&&(e=this.location),s.isNone(this.elevationInfo))return!1;var t=null,n=0,r=s.unwrapOr(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=b.getElevationAtPoint(this.view.elevationProvider,e,"ground")||0;break;case"relative-to-ground":n=(b.getElevationAtPoint(this.view.elevationProvider,e,"ground")||0)+r;break;case"relative-to-scene":n=(b.getElevationAtPoint(this.view.elevationProvider,e,"scene")||0)+r;break;case"absolute-height":n=r}return(n!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=n,this._elevation.override=t,!0)},e.prototype._updateEngineObject=function(){if(this._attached)if(this.available){var e=this._getWorldToScreenObjectScale(),t=j;if(!0===this.autoScaleRenderObjects){var n=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(n,t)}else this._calculateObjectTransform(e,t);for(var r=this._ensureEngineResources().objectsByState,i=(this.focused?2:1)|(this.selected?8:4),o=this._noDisplayCount>0,a=0,s=r;a<s.length;a++){var l=s[a],c=l.stateMask,u=l.objects;if(o)for(var p=0,d=u;p<d.length;p++)(v=d[p]).hide();else if(0!=(15&c)&&(i&c)!=(15&c)||0!=(65520&c)&&(this.state&c)!=(65520&c))for(var h=0,f=u;h<f.length;h++){var v;(v=f[h]).hide()}else for(var g=0,m=u;g<m.length;g++)(v=m[g]).unhide(),v.objectTransformation=t}}else this._removeResourcesFromStage()},e.prototype._ensureEngineResources=function(){if(s.isNone(this._engineResources)){var e=this.view._stage.getContent(0,s.expect(this._engineLayerId)),t=[],n=new Set;this.renderObjects.forEach((function(e){var r=e.material;n.has(r)||(t.push(r),n.add(r))}));var r=new Map;this.renderObjects.forEach((function(e){var t=new O({idHint:"manipulator",castShadow:!1});!function(e,t){var n=t.geometry,r=t.material,i=t.transform;Array.isArray(n)?n.forEach((function(t){return e.addGeometry(t,r,i)})):e.addGeometry(n,r,i)}(t,e);var n=e.stateMask||0,i=r.get(n)||[];i.push(t),r.set(n,i)}));var i=[];r.forEach((function(e,t){i.push({stateMask:t,objects:e})})),this._engineResources={objectsByState:i,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources},e.prototype._addResourcesToStage=function(){var e=this;if(!this._engineResourcesAddedToStage&&!s.isNone(this._engineResources)){var t=this._engineResources,n=t.objectsByState,r=t.layer;t.materials.forEach((function(t){var n=s.expect(e._materialIdReferences),r=n.get(t.id)||0;0===r&&e.view._stage.add(3,t),n.set(t.id,r+1)})),n.forEach((function(t){t.objects.forEach((function(t){r.addObject(t),e.view._stage.add(1,t)}))})),this._engineResourcesAddedToStage=!0}},e.prototype._removeResourcesFromStage=function(e){var t=this;if(void 0===e&&(e=!1),this._engineResourcesAddedToStage&&!s.isNone(this._engineResources)){var n=this._engineResources,r=n.layer,i=n.materials;n.objectsByState.forEach((function(e){e.objects.forEach((function(e){r.removeObject(e),t.view._stage.remove(1,e.id)}))})),i.forEach((function(e){var n=s.expect(t._materialIdReferences),r=n.get(e.id);1===r?(t.view._stage.remove(3,e.id),n.delete(e.id)):n.set(e.id,r-1)})),e&&this.view._stage.remove(0,r.id),this._engineResourcesAddedToStage=!1}},e.prototype._getCollisionRadius=function(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)},e.prototype._getFocusedSize=function(e,t){return e*(t?this.focusMultiplier:1)},e.prototype._getWorldToScreenObjectScale=function(){return this._worldSized?1:this.screenLocation.pixelSize},e.prototype._calculateModelTransformPosition=function(e){var t=this._getWorldToScreenObjectScale(),n=this._calculateObjectTransform(t,E);return v.vec3.set(e,n[12],n[13],n[14])},e.prototype._calculateModelTransformOffset=function(e){var t=this._calculateModelTransformPosition(e);return v.vec3.subtract(e,t,this.renderLocation)},e.prototype._calculateObjectTransform=function(e,t){return d.mat4.set(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&d.mat4.multiply(t,t,this._worldFrame),d.mat4.multiply(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,s.isSome(this._applyObjectTransform)&&this._applyObjectTransform(t),t},e}();function A(e){return 0!==e[12]||0!==e[13]||0!==e[14]}t.Manipulator3D=M;var C=l.createScreenPointArray(),D=_.lineSegment.create(),R=_.ray.create(),T=p.mat3f64.create(),E=h.mat4f64.create(),j=h.mat4f64.create(),I=_.plane.create(),V=g.vec3f64.create(),L=g.vec3f64.create(),z=g.vec3f64.create(),N=g.vec3f64.create(),F=g.vec3f64.create(),U=g.vec3f64.create()}).apply(null,r))||(e.exports=i)},x82K:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("9opi"),n("BcWh"),n("eIBl"),n("LxLY"),n("8MXS"),n("Vx27"),n("BKZ1"),n("d0uo"),n("TCLX"),n("X7Ps")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(t){var n=e.call(this,t)||this;return n._handles=new o,n._reshapeOperation=null,n._internalGeometryUpdate=!1,n.type="reshape-3d",n._emitter.target=null,n}return r(t,e),t.prototype.destroy=function(){this._handles.removeAll(),this._reshapeOperation&&(this._reshapeOperation.destroy(),this._reshapeOperation=null),this._set("view",null),this._set("graphic",null)},Object.defineProperty(t.prototype,"selectionManagementDisabled",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype._updateGeometry=function(){this._reshapeOperation.inputGeometry=0===c.isSupportedGraphic(this.graphic)&&p.isReshapeGeometry(this.graphic.geometry)?this.graphic.geometry.clone():null},t.prototype._updateGraphic=function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0===c.isSupportedGraphic(this.graphic)){var t=this.watch("graphic.geometry",(function(){!1===e._internalGeometryUpdate&&e._updateGeometry()}),!0);this._handles.add(t,"onGraphicGeometryChange")}},t.prototype.manipulatorSelectionChanged=function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()},t.prototype._onReshapeGeometryChanged=function(){a.isNone(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)},t.prototype.initialize=function(){var e=this;this._reshapeOperation=new u.ReshapeOperation({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)})),this._reshapeOperation.on("move",(function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)})),this._reshapeOperation.on("vertex-add",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)})),this._reshapeOperation.on("vertex-remove",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)})),this._reshapeOperation.on("immediate-click",(function(){return e.emit("immediate-click")})),s.init(this,"graphic",(function(){e._updateGraphic()}),!0)])},t.prototype.handleInputEvent=function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()},t.prototype.reset=function(){},n([l.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n([l.property({constructOnly:!0})],t.prototype,"graphic",void 0),n([l.property({constructOnly:!0,nonNullable:!0,value:!0})],t.prototype,"enableZ",void 0),n([l.property({readOnly:!0})],t.prototype,"type",void 0),n([l.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshape3DTool")],t)}(l.declared(i.EventedMixin(d.InteractiveToolBase)));t.GraphicReshape3DTool=h}).apply(null,r))||(e.exports=i)},xDGw:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("2o+p"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){function o(e,t){var o=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(r.ScreenSizePerspective),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),o.add(i.glsl(p||(p=n(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "],["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),i.glsl(0===t.viewingMode?s||(s=n(["vec3 worldNormal = normalize(worldPos + localOrigin);"],["vec3 worldNormal = normalize(worldPos + localOrigin);"])):l||(l=n(["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"],["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"]))),i.glsl(t.screenSizePerspectiveEnabled?c||(c=n(["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"],["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"])):u||(u=n(["\n          float verticalOffsetScreenHeight = verticalOffset.x;"],["\n          float verticalOffsetScreenHeight = verticalOffset.x;"])))))):o.add(i.glsl(d||(d=n(["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "],["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "]))))}function a(e,t,n,r){return void 0===r&&(r=h),r.screenLength=e.screenLength,r.perDistance=Math.tan(.5*t)/(.5*n),r.minWorldLength=e.minWorldLength,r.maxWorldLength=e.maxWorldLength,r}Object.defineProperty(t,"__esModule",{value:!0}),t.VerticalOffset=o,function(e){e.bindUniforms=function(e,t,n){if(t.verticalOffset){var r=a(t.verticalOffset,n.fovY,n.viewport[3]);e.setUniform4f("verticalOffset",r.screenLength*(n.pixelRatio||1),r.perDistance,r.minWorldLength,r.maxWorldLength)}}}(o=t.VerticalOffset||(t.VerticalOffset={})),t.calculateVerticalOffsetFactors=a;var s,l,c,u,p,d,h={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}}).apply(null,r))||(e.exports=i)},xFEL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE"),n("2Atf"),n("jBNx"),n("YX1r"),n("51bw"),n("FXVB"),n("1m5D"),n("W9tT"),n("DIqE"),n("0LE5"),n("Rdxj"),n("qvwY"),n("lRq4"),n("2B1V"),n("rjU6"),n("+nCE"),n("9FJH"),n("FNtW"),n("+wMf"),n("CIy2"),n("ILj8"),n("s6rJ"),n("ZeO9"),n("VQEQ"),n("pqGg")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w,S,P,O,M){var A=function(e){function t(t,n){var r=e.call(this,n)||this;return r.techniqueConfig=new M.HUDMaterialTechniqueConfiguration,r.params=S.copyParameters(t,Z),r}return n(t,e),t.prototype.dispose=function(){},t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&x.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig},t.prototype.intersect=function(e,t,n,r,i,o,a,s,l){l?this.intersectDrapedHudGeometry(e,o,a,s):this.intersectHudGeometry(e,t,n,r,a,s)},t.prototype.intersectDrapedHudGeometry=function(e,t,n,r){var i=e.getAttribute(x.VertexAttrConstants.POSITION),o=e.getAttribute(x.VertexAttrConstants.SIZE),a=this.params,s=O.calculateAnchorPosForRendering(a),l=1,c=1;if(r){var u=r(B);l=u[0],c=u[5]}l*=e.pixelRatio,c*=e.pixelRatio;for(var p=W*e.pixelRatio,d=0;d<i.data.length/i.size;d++){var h=d*i.size,f=i.data[h],v=i.data[h+1],g=d*o.size;k[0]=o.data[g]*l,k[1]=o.data[g+1]*c;var m=void 0;a.textureIsSignedDistanceField&&(m=a.outlineSize*e.pixelRatio/2),T(t,f,v,k,p,m,a,s)&&n()}},t.prototype.intersectHudGeometry=function(e,t,n,r,i,a){if(r.options.selectionMode&&r.options.hud&&!g.isAllHidden(t.componentVisibilities,e.componentOffsets)){var l,c,u,h,f,v,m,y,b,w,S,P,M,A=e.data,C=this.params,D=1,R=1;if(o.mat3.fromMat4(F,n),a){var j=a(B);D=j[0],R=j[5],c=(l=F)[0],u=l[1],h=l[2],f=l[3],v=l[4],m=l[5],y=l[6],b=l[7],w=l[8],S=1/Math.sqrt(c*c+u*u+h*h),P=1/Math.sqrt(f*f+v*v+m*m),M=1/Math.sqrt(y*y+b*b+w*w),l[0]=c*S,l[1]=u*S,l[2]=h*S,l[3]=f*P,l[4]=v*P,l[5]=m*P,l[6]=y*M,l[7]=b*M,l[8]=w*M}var z=A.getVertexAttr()[x.VertexAttrConstants.POSITION],H=A.getVertexAttr()[x.VertexAttrConstants.SIZE],W=A.getVertexAttr()[x.VertexAttrConstants.NORMAL],X=A.getVertexAttr()[x.VertexAttrConstants.AUXPOS1];x.assert(z.size>=3);var Z=r.point,Y=r.camera,K=O.calculateAnchorPosForRendering(C);D*=Y.pixelRatio,R*=Y.pixelRatio;for(var J="screen"===this.params.centerOffsetUnits,Q=0;Q<z.data.length/z.size;Q++){var $=Q*z.size;p.vec3.set(I,z.data[$],z.data[$+1],z.data[$+2]),p.vec3.transformMat4(I,I,n);var ee=Q*H.size;k[0]=H.data[ee]*D,k[1]=H.data[ee+1]*R,p.vec3.transformMat4(I,I,Y.viewMatrix);var te=Q*X.size;if(p.vec3.set(G,X.data[te+0],X.data[te+1],X.data[te+2]),!J&&(I[0]+=G[0],I[1]+=G[1],0!==G[2])){var ne=G[2];p.vec3.normalize(G,I),p.vec3.subtract(I,I,p.vec3.scale(G,G,ne))}var re=Q*W.size;if(p.vec3.set(V,W.data[re],W.data[re+1],W.data[re+2]),this.applyVerticalOffsetTransformation(I,V,F,Y,E),Y.applyProjection(I,L),L[0]>-1){var ie=Math.floor(L[0])+this.params.screenOffset[0],oe=Math.floor(L[1])+this.params.screenOffset[1];J&&(ie+=G[0],0!==G[1]&&(oe+=_.applyScaleFactor(G[1],E.factorAlignment))),_.applyPrecomputedScaleFactorVec2(k,E.factor,k);var ae=void 0;if(C.textureIsSignedDistanceField&&(ae=C.outlineSize*Y.pixelRatio/2),T(Z,ie,oe,k,q*Y.pixelRatio,ae,C,K)){var se=r.ray;p.vec3.transformMat4(N,I,s.mat4.invert(U,Y.viewMatrix)),L[0]=Z[0],L[1]=Z[1],Y.unprojectPoint(L,I);var le=d.vec3f64.create();p.vec3.copy(le,se.direction);var ce=1/p.vec3.length(le);p.vec3.scale(le,le,ce),i(p.vec3.distance(se.origin,I)*ce,le,-1,1,!0,N)}}}}},t.prototype.computeAttachmentOrigin=function(e,t){var n=e.data,r="getVertexAttr"in n?n.getVertexAttr():"vertexAttr"in n?n.vertexAttr:null;if(!r)return null;var i=x.VertexAttrConstants.POSITION,o=r[i],a="getIndices"in n?n.getIndices(i):"indices"in n?n.indices[i]:null;return m.computeAttachmentOriginPoints(o,a,t)},t.prototype.createBufferWriter=function(){return new K(this)},t.prototype.createRenderer=function(e,t){return new P(e,t,this)},t.prototype.normalAndViewAngle=function(e,t,n,r){return void 0===r&&(r=H),p.vec3.transformMat3(r.normal,e,t),p.vec3.transformMat4(r.normal,r.normal,n.viewInverseTransposeMatrix),r.cosAngle=p.vec3.dot(z,X),r},t.prototype.updateScaleInfo=function(e,t){var n=this.params;n.screenSizePerspective?e.factor=_.precomputeScaleFactor(H.cosAngle,t,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment?e.factorAlignment=_.precomputeScaleFactor(H.cosAngle,t,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)},t.prototype.applyVerticalOffsetTransformation=function(e,t,n,r,i,a){var s=this.params;if(h.isMat4(n)&&(n=o.mat3.fromMat4(F,n)),!s.verticalOffset||!s.verticalOffset.screenLength){if(i&&(s.screenSizePerspective||s.screenSizePerspectiveAlignment)){var l=p.vec3.length(e);this.updateScaleInfo(i,l)}else i&&(i.factor.scale=1,i.factorAlignment.scale=1);return a?p.vec3.copy(a,e):e}var c=this.normalAndViewAngle(t,n,r),u=p.vec3.length(e),d=S.verticalOffsetAtDistance(r,u,s.verticalOffset,c.cosAngle,s.screenSizePerspectiveAlignment||s.screenSizePerspective);return i&&this.updateScaleInfo(i,u),p.vec3.add(a||e,e,p.vec3.scale(c.normal,c.normal,d))},t.prototype.getGLMaterial=function(e){return 0===e.output?new D(e):4===e.output?new R(e):void 0},t.prototype.calculateRelativeScreenBounds=function(e,t,n){return void 0===n&&(n=f.create()),function(e,t,n,r){void 0===r&&(r=j),c.vec2.copy(r,e.anchorPos),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*n,r[1]+=e.screenOffset[1]*n}(this.params,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n},t.shouldRenderVisibilityDuringRenderPass=function(e){return 0===e||4},t}(b.Material),C=function(e){function t(t){var n=e.call(this,y.makeCtorParameters(t,t.material.getParameters()))||this;return n.updateParameters(),n}return n(t,e),t.prototype.beginSlot=function(e){return e===(this.params.drawInSecondSlot?19:18)},t.prototype.updateParameters=function(){this.params=S.copyParameters(this.material.getParameters()),this.updateTexture(this.params.textureId),this.selectProgram()},t.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(M.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.params,t)},t}(y),D=function(e){function t(t){var n=e.call(this,r({},t,{output:0}))||this;return n.isOcclusionSlot=!1,n}return n(t,e),t.prototype.beginSlot=function(e){var t=this.params.drawInSecondSlot?19:18;return this.params.occlusionTest?(this.isOcclusionSlot=12===e,12===e||e===t):(this.isOcclusionSlot=!1,e===t)},t.prototype.getTechnique=function(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique},t.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(M.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique),this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(M.HUDMaterialTechnique,this.material.getTechniqueConfig(6),this.occlusionTechnique)},t.prototype.bind=function(e,t){var n=this.getTechnique();e.bindProgram(n.program),this.isOcclusionSlot||(this.bindTexture(e,n.program),this.bindTextureScale(e,n.program)),n.bindPass(e,this.params,t)},t}(C),R=function(e){function t(t){return e.call(this,r({},t,{output:4}))||this}return n(t,e),t}(C);function T(e,t,n,r,i,o,a,s){var l=t-i-(s[0]>0?r[0]*s[0]:0),c=l+r[0]+2*i,u=n-i-(s[1]>0?r[1]*s[1]:0),p=u+r[1]+2*i;if(a.textureIsSignedDistanceField){var d=a.distanceFieldBoundingBox;l+=r[0]*d[0],u+=r[1]*d[1],c-=r[0]*(1-d[2]),p-=r[1]*(1-d[3]),l-=o,c+=o,u-=o,p+=o}return e[0]>l&&e[0]<c&&e[1]>u&&e[1]<p}var E={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},j=u.vec2f64.create(),I=d.vec3f64.create(),V=d.vec3f64.create(),L=i.createRenderScreenPointArray3(),z=d.vec3f64.create(),N=d.vec3f64.create(),F=a.mat3f64.create(),U=l.mat4f64.create(),G=d.vec3f64.create(),H={normal:z,cosAngle:0},B=l.mat4f64.create(),q=1,W=2,k=[0,0],X=d.vec3f64.fromValues(0,0,1),Z={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:u.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,debugDrawBorder:!1},Y=v.newLayout().vec3f(x.VertexAttrConstants.POSITION).vec3f(x.VertexAttrConstants.NORMAL).vec2f(x.VertexAttrConstants.UV0).vec4u8(x.VertexAttrConstants.COLOR).vec2f(x.VertexAttrConstants.SIZE).vec4f(x.VertexAttrConstants.AUXPOS1).vec4f(x.VertexAttrConstants.AUXPOS2),K=function(){function e(e){this.material=e,this.vertexBufferLayout=Y}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[x.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,n,r){w.writePosition(t.indices[x.VertexAttrConstants.POSITION],t.vertexAttr[x.VertexAttrConstants.POSITION].data,e.transformation,n.position,r,6),w.writeNormal(t.indices[x.VertexAttrConstants.NORMAL],t.vertexAttr[x.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,n.normal,r,6);var i=t.vertexAttr[x.VertexAttrConstants.UV0].data,o=void 0,a=void 0,s=void 0,l=void 0;if(null==i||i.length<4){var c=this.material.getParameters();o=0,a=0,s=c.texCoordScale[0],l=c.texCoordScale[1]}else o=i[0],a=i[1],s=i[2],l=i[3];s=Math.min(1.99999,s+1),l=Math.min(1.99999,l+1);for(var u=t.indices[x.VertexAttrConstants.POSITION].length,p=n.uv0,d=r,h=0;h<u;++h)p.set(d,0,o),p.set(d,1,a),p.set(d+=1,0,s),p.set(d,1,a),p.set(d+=1,0,s),p.set(d,1,l),p.set(d+=1,0,s),p.set(d,1,l),p.set(d+=1,0,o),p.set(d,1,l),p.set(d+=1,0,o),p.set(d,1,a),d+=1;w.writeColor(t.indices[x.VertexAttrConstants.COLOR],t.vertexAttr[x.VertexAttrConstants.COLOR].data,4,n.color,r,6);var f=t.indices[x.VertexAttrConstants.SIZE],v=t.vertexAttr[x.VertexAttrConstants.SIZE].data,g=f.length,m=n.size;for(d=r,h=0;h<g;++h)for(var y=v[2*f[h]],b=v[2*f[h]+1],_=0;_<6;++_)m.set(d,0,y),m.set(d,1,b),d+=1;t.indices[x.VertexAttrConstants.AUXPOS1]&&t.vertexAttr[x.VertexAttrConstants.AUXPOS1]&&w.writeBufferVec4(t.indices[x.VertexAttrConstants.AUXPOS1],t.vertexAttr[x.VertexAttrConstants.AUXPOS1].data,n.auxpos1,r,6),t.indices[x.VertexAttrConstants.AUXPOS2]&&t.vertexAttr[x.VertexAttrConstants.AUXPOS2]&&w.writeBufferVec4(t.indices[x.VertexAttrConstants.AUXPOS2],t.vertexAttr[x.VertexAttrConstants.AUXPOS2].data,n.auxpos2,r,6)},e}();return A}).apply(null,r))||(e.exports=i)},y68M:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("HZ3d"),n("Q2wQ"),n("LxLY"),n("qMld")],void 0===(i=(function(e,t,n,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this._context=e,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=1200}return Object.defineProperty(e.prototype,"viewingMode",{get:function(){return this._context.viewingMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"constructionContext",{get:function(){return this._context},enumerable:!0,configurable:!0}),e.prototype.acquire=function(e,t){var n=t.key,r=this._perConstructorInstances.get(e);r||(r=new Map,this._perConstructorInstances.set(e,r));var i=r.get(n);return void 0===i?(i={technique:new e(this._context,t),refCount:1,refZeroFrame:0},r.set(n,i)):i.refCount+=1,i.technique},e.prototype.acquireAndReleaseExisting=function(e,t,n){return i.isNone(n)?this.acquire(e,t):t.key===n.key&&n instanceof e?n:(this.release(n),this.acquire(e,t))},e.prototype.release=function(e){var t=this._perConstructorInstances.get(e.constructor).get(e.key);t.refCount-=1,0===t.refCount&&(t.refZeroFrame=this._frameCounter)},e.prototype.frameUpdate=function(){var e=this;this._frameCounter++,this._perConstructorInstances.forEach((function(t,n){t.forEach((function(n,r){0===n.refCount&&n.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(n.technique.dispose(),t.delete(r))})),0===t.size&&e._perConstructorInstances.delete(n)}))},e.prototype.getProgramsUsingUniform=function(e){return this._context.commonUniformStore.getPrograms(e)},e.prototype.hotReload=function(){return n(this,void 0,void 0,(function(){var e,t=this;return r(this,(function(i){switch(i.label){case 0:return e=new Array,this._perConstructorInstances.forEach((function(i,o){e.push(function(e,i){return n(t,void 0,void 0,(function(){var t,n=this;return r(this,(function(r){switch(r.label){case 0:return(t=i.shader)?[4,t.reload()]:[3,2];case 1:r.sent(),e.forEach((function(e){e.technique.reload(n._context)})),r.label=2;case 2:return[2]}}))}))}(i,o))})),[4,o.all(e)];case 1:return i.sent(),[2]}}))}))},e}();t.ShaderTechniqueRepository=a}).apply(null,r))||(e.exports=i)},yVFQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("Q2wQ"),n("HZ3d"),n("qsST"),n("ZcgO"),n("sCbS")],void 0===(i=(function(e,t,n,r,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=i.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return null!=e.cachedResult}function c(e){return"0"===e?0:null}t.createContextWithoutExpressionSupport=function(e){var t=e&&e.expression;if("string"==typeof t){var n=c(t);if(null!=n)return{cachedResult:n}}return null},t.createContext=function(e,t,i){return r(this,void 0,void 0,(function(){var r,o,s,l,u;return n(this,(function(n){switch(n.label){case 0:return"string"!=typeof(r=e&&e.expression)?[2,null]:null!=(o=c(r))?[2,{cachedResult:o}]:[4,a.loadArcade()];case 1:return s=n.sent(),u=(l=s.arcadeUtils).createSyntaxTree(r),l.dependsOnView(u)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),[2,{cachedResult:0}]):[2,{arcade:{func:l.createFunction(u),context:l.createExecContext(null,{sr:t}),modules:s}}]}}))}))},t.createFeature=function(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)},t.setContextFeature=function(e,t){if(null!=e&&!l(e)){if(!t||!e.arcade)return void s.errorOncePerTick("Arcade support required but not provided");t._geometry&&(t._geometry=o.hydrateGeometry(t._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}},t.execute=function(e){if(null!=e){if(l(e))return e.cachedResult;var t=e.arcade,n=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0},t.extractExpressionInfo=function(e,t){void 0===t&&(t=!1);var n=e&&e.featureExpressionInfo;return t||"0"===(n&&n.expression)||(n=null),n},t.zeroContext={cachedResult:0}}).apply(null,r))||(e.exports=i)},ybGv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XsoR"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Gamma=function(e){e.fragment.code.add(r.glsl(i||(i=n(["\n    const float GAMMA = 2.2;\n    const float INV_GAMMA = 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "],["\n    const float GAMMA = 2.2;\n    const float INV_GAMMA = 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},yjgM:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qKT0"),n("xhoE"),n("Q2wQ"),n("HZ3d"),n("2Atf"),n("QDcU"),n("eIBl"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("DtIM"),n("woUR"),n("uiHv"),n("X5J5"),n("Fe95"),n("48/q"),n("dtql"),n("TIRl"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w,S,P,O){Object.defineProperty(t,"__esModule",{value:!0});var M=function(e){function t(t){var n=e.call(this)||this;return n._handles=new l,n._snapToScene=new x.SnapToScene,n._discMaterial=n._createMaterial(),n._discMaterialTransparent=n._createMaterial(.5),n._scale=1,n._radius=y.DISC_RADIUS,n._view=t.view,n._tool=t.tool,null!=t.snapToScene&&(n.snapToScene=t.snapToScene),null!=t.radius&&(n._radius=t.radius),n._createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return r(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null},t.prototype.forEachManipulator=function(e){e(this._manipulator,1)},Object.defineProperty(t.prototype,"displayScale",{get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapToScene",{get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())},enumerable:!0,configurable:!0}),t.prototype.createGraphicDragPipeline=function(e,t){var n=this,r=e.graphic,i=f.getGraphicEffectiveElevationInfo(r),o=c.expect(r.geometry).spatialReference;return _.createGraphicMoveDragPipeline(e,t,(function(e){return n.createDragPipeline(e,i,o)}))},t.prototype.createDragPipeline=function(e,t,n){var r=this,i=this._view;return g.createManipulatorDragEventPipeline(this._manipulator,(function(o,a,s,l){var c=a.next(g.dragAtLocation(i,o.elevationAlignedLocation)).next(g.screenToMapXYAtLocation(i,o.elevationAlignedLocation,t,n)).next(r._snapToScene.createDragEventPipelineStep(i,t),r._snapToScene.next).next(g.addScreenDelta());e(o,c,s,l)}))},t.prototype._updateManipulatorTransform=function(){var e=u.mat4.fromScaling(w.sm4d.get(),d.vec3.set(w.sv3d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e},t.prototype._createManipulator=function(){this._manipulator=new v.Manipulator3D({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:h.vec3f64.fromValues(0,0,1)},worldOriented:!0}),this._updateManipulator()},t.prototype._updateManipulator=function(){var e=new S(P.createCylinderGeometry(y.DISC_HEIGHT,1,y.GEOMETRY_SEGMENTS,h.vec3f64.fromValues(0,0,1),h.vec3f64.fromValues(0,0,0)),"graphic-transform-disc"),t=u.mat4.fromScaling(p.mat4f64.create(),h.vec3f64.fromValues(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=y.DISC_COLLISION_RADIUS*(this._radius/y.DISC_RADIUS)},t.prototype._createMaterial=function(e){void 0===e&&(e=1);var t=s.toUnitRGBA(m.colors.main);t[3]*=e;var n=new O({color:t,transparent:1!==e,cullFace:2},"move-xy-disc");return n.renderOccluded=2,n},Object.defineProperty(t.prototype,"test",{get:function(){return{discManipulator:this._manipulator}},enumerable:!0,configurable:!0}),t}(b.Manipulation);t.MoveXYDiscManipulation=M}).apply(null,r))||(e.exports=i)},yqrJ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("Q2wQ"),n("HZ3d"),n("pcDC"),n("ma1f"),n("BcWh"),n("xoE+"),n("xoE+"),n("LxLY"),n("qMld"),n("rusB"),n("jfWY"),n("R6Tp"),n("weRx"),n("EyQ4"),n("/Bau"),n("W0kZ"),n("CIy2"),n("/f24"),n("Zp3t"),n("Kfys"),n("7laH")],void 0===(i=(function(e,t,n,r,i,o,a,s,l,c,u,p,d,h,f,v,g,m,y,b,_,x,w){return function(){function e(t,n,r){this.data=t,this.glTexture=null,this.powerOfTwoStretchInfo=null,this.loadingPromise=null,this.loadingController=null,this.events=new a,this.data=t,this.id=e.idGen.gen(n),this.params=r||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=e.estimateTexMemRequired(this.data,this.params),this.startPreload()}return e.prototype.startPreload=function(){var e=this.data;c.isNone(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))},e.prototype.startPreloadVideoElement=function(e){d.isBlobProtocol(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)},e.prototype.startPreloadImageElement=function(e){d.isDataProtocol(e.src)||d.isBlobProtocol(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)},e.getDataDimensions=function(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e},e.estimateTexMemRequired=function(t,n){if(c.isNone(t))return 0;if(p.isArrayBuffer(t)||p.isUint8Array(t))return t.byteLength;var r=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?e.getDataDimensions(t):n;return(n.mipmap?4/3:1)*r.width*r.height*(n.components||4)||0},e.prototype.dispose=function(){this.data=void 0},Object.defineProperty(e.prototype,"width",{get:function(){return this.params.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.params.height},enumerable:!0,configurable:!0}),e.prototype.createDescriptor=function(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.mipmap&&!this.params.disableAnisotropy?e.parameters.maxMaxAnisotropy:void 0}},e.prototype.load=function(t,n){if(c.isSome(this.glTexture))return this.glTexture;if(c.isSome(this.loadingPromise))return this.loadingPromise;var r=this.data;return c.isNone(r)?(this.glTexture=new _(t,this.createDescriptor(t),null),t.bindTexture(this.glTexture),this.glTexture):"string"==typeof r?this.loadFromURL(t,n,r):r instanceof Image?this.loadFromImageElement(t,n,r):r instanceof HTMLVideoElement?this.loadFromVideoElement(t,n,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this.loadFromImage(t,r,n):(p.isArrayBuffer(r)||p.isUint8Array(r))&&this.params.encoding===e.DDS_ENCODING?this.loadFromDDSData(t,r):p.isUint8Array(r)?this.loadFromPixelData(t,r):p.isArrayBuffer(r)?this.loadFromPixelData(t,new Uint8Array(r)):(i.neverReachedSilent(r),null)},Object.defineProperty(e.prototype,"requiresFrameUpdates",{get:function(){return this.data instanceof HTMLVideoElement},enumerable:!0,configurable:!0}),e.prototype.frameUpdate=function(e,t,n){if(!(this.data instanceof HTMLVideoElement)||c.isNone(this.glTexture))return n;if(this.data.readyState<2||n===this.data.currentTime)return n;if(c.isSome(this.powerOfTwoStretchInfo)){var r=this.powerOfTwoStretchInfo,i=r.framebuffer,o=r.vao,a=r.sourceTexture;a.setData(this.data),this.drawStretchedTexture(e,t,i,o,a,this.glTexture)}else{var s=this.data,l=s.width,u=s.height,p=this.glTexture.descriptor,d=p.width,h=p.height;l!==d||u!==h?this.glTexture.updateData(0,0,0,Math.min(l,d),Math.min(u,h),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime},e.prototype.loadFromDDSData=function(e,t){return this.glTexture=v.createDDSTexture(e,this.createDescriptor(e),t,this.params.mipmap),e.bindTexture(this.glTexture),this.glTexture},e.prototype.loadFromPixelData=function(e,t){y.assert(this.params.width>0&&this.params.height>0);var n=this.createDescriptor(e);return n.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,n.width=this.params.width,n.height=this.params.height,this.glTexture=new _(e,n,t),e.bindTexture(this.glTexture),this.glTexture},e.prototype.loadAsync=function(e){return r(this,void 0,void 0,(function(){var t,r,i,o=this;return n(this,(function(n){return t=u.createAbortController(),this.loadingController=t,r=e(t.signal),this.loadingPromise=r,r.then(i=function(){o.loadingController===t&&(o.loadingController=null),o.loadingPromise===r&&(o.loadingPromise=null)},i),[2,r]}))}))},e.prototype.loadFromURL=function(e,t,i){var o=this;return this.loadAsync((function(a){return r(o,void 0,void 0,(function(){var r;return n(this,(function(n){switch(n.label){case 0:return[4,f.requestImage(i,{signal:a})];case 1:return r=n.sent(),[2,this.loadFromImage(e,r,t)]}}))}))}))},e.prototype.loadFromImageElement=function(e,t,i){var o=this;return i.complete?this.loadFromImage(e,i,t):this.loadAsync((function(a){return r(o,void 0,void 0,(function(){var r;return n(this,(function(n){switch(n.label){case 0:return[4,h.loadImageAsync(i,i.src,!1,a)];case 1:return r=n.sent(),[2,this.loadFromImage(e,r,t)]}}))}))}))},e.prototype.loadFromVideoElement=function(e,t,n){return n.readyState>=2?this.loadFromImage(e,n,t):this.loadFromVideoElementAsync(e,t,n)},e.prototype.loadFromVideoElementAsync=function(e,t,n){var r=this;return this.loadAsync((function(i){return u.create((function(a,s){var l=function(){n.removeEventListener("loadeddata",p),n.removeEventListener("error",d),c.isSome(h)&&h.remove()},p=function(){n.readyState>=2&&(l(),a(r.loadFromImage(e,n,t)))},d=function(e){l(),s(e||new o("Failed to load video"))};n.addEventListener("loadeddata",p),n.addEventListener("error",d);var h=u.onAbort(i,(function(){return d(u.createAbortError())}))}))}))},e.prototype.loadFromImage=function(t,n,r){var i=e.getDataDimensions(n);this.params.width=i.width,this.params.height=i.height;var o=this.createDescriptor(t);return o.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(t,o)||l.isPowerOfTwo(i.width)&&l.isPowerOfTwo(i.height)?(o.width=i.width,o.height=i.height,this.glTexture=new _(t,o,n),t.bindTexture(this.glTexture),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(t,n,i,o,r),t.bindTexture(this.glTexture),this.glTexture)},e.prototype.requiresPowerOfTwo=function(e,t){var n="number"==typeof t.wrapMode?33071===t.wrapMode:33071===t.wrapMode.s&&33071===t.wrapMode.t;return!w.default(e.gl)&&(t.hasMipmap||!n)},e.prototype.makePowerOfTwoTexture=function(e,t,n,r,o){var a,l=n.width,c=n.height,u=s.nextHighestPowerOfTwo(l),p=s.nextHighestPowerOfTwo(c);switch(r.width=u,r.height=p,this.params.powerOfTwoResizeMode){case 2:r.textureCoordinateScaleFactor=[l/u,c/p],(a=new _(e,r)).updateData(0,0,0,l,c,t);break;case 1:case null:case void 0:a=this.stretchToPowerOfTwo(e,t,r,o);break;default:i.neverReached(this.params.powerOfTwoResizeMode)}return r.hasMipmap&&a.generateMipmap(),a},e.prototype.stretchToPowerOfTwo=function(e,t,n,r){var i=new _(e,n),o=new b(e,{colorTarget:0,depthStencilTarget:0},i),a=new _(e,{target:3553,pixelFormat:n.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!n.flipped,maxAnisotropy:8,preMultiplyAlpha:n.preMultiplyAlpha},t),s=g.createQuadVAO(e);return this.drawStretchedTexture(e,r,o,s,a,i),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:s,sourceTexture:a,framebuffer:o}:(s.dispose(!0),a.dispose(),o.detachColorTexture(),e.bindFramebuffer(null),o.dispose()),i},e.prototype.drawStretchedTexture=function(e,t,n,r,i,o){e.bindFramebuffer(n);var a=e.getViewport();e.setViewport(0,0,o.descriptor.width,o.descriptor.height);var s=t.program;e.bindProgram(s),s.setUniform4f("color",1,1,1,1),s.setUniform1i("tex",0),e.bindTexture(i,0),e.bindVAO(r),e.setPipelineState(t.pipeline),e.drawArrays(5,0,x.vertexCount(r,"geometry")),e.bindFramebuffer(null),e.setViewport(a.x,a.y,a.width,a.height)},e.prototype.unload=function(){if(c.isSome(this.powerOfTwoStretchInfo)){var e=this.powerOfTwoStretchInfo,t=e.framebuffer,n=e.sourceTexture;e.vao.dispose(!0),n.dispose(),t.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if(c.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),c.isSome(this.loadingController)){var r=this.loadingController;this.loadingController=null,this.loadingPromise=null,r.abort()}this.events.emit("unloaded")},e.idGen=new m.IdGen,e.DDS_ENCODING="image/vnd-ms.dds",e}()}).apply(null,r))||(e.exports=i)},ys4y:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("3RHn"),n("rjU6"),n("+nCE"),n("W0kZ"),n("CIy2"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o,a,s){return function(){function e(t,n,r){this._boundingInfo=null,this._componentAABBs=null,this._id=e.__idGen.gen(n),this._data=t,this._boundingInfo=r}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.getIndices=function(e){return this.data.getIndices(e)},Object.defineProperty(e.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),e.prototype.getAttribute=function(e){return this.data.getAttribute(e)},Object.defineProperty(e.prototype,"componentCount",{get:function(){return r.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this.data.componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo},enumerable:!0,configurable:!0}),e.prototype.computeAttachmentOrigin=function(e){return"triangle"===this.data.primitiveType?this.computeAttachmentOriginTriangles(e):this.computeAttachmentOriginPoints(e)},e.prototype.computeAttachmentOriginTriangles=function(e){var t=this.getIndices(s.VertexAttrConstants.POSITION),n=this.getAttribute(s.VertexAttrConstants.POSITION);return i.computeAttachmentOriginTriangles(n,t,e)},e.prototype.computeAttachmentOriginPoints=function(e){var t=this.getIndices(s.VertexAttrConstants.POSITION),n=this.getAttribute(s.VertexAttrConstants.POSITION);return i.computeAttachmentOriginPoints(n,t,e)},e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null,this._componentAABBs=null},e.prototype.getComponentAABB=function(e,t){null==this._componentAABBs&&(this._componentAABBs=this._computeComponentAABBs());for(var n=0;n<6;n++)t[n]=this._componentAABBs[6*e+n];return t},e.prototype._computeComponentAABBs=function(){for(var e=this.componentCount,t=new Float32Array(6*e),n=0;n<e;n++)this._calculateAABB(n,t,6*n);return t},e.prototype._calculateAABB=function(e,t,n){for(var r=this.data.getIndices(s.VertexAttrConstants.POSITION),i=this.data.getAttribute(s.VertexAttrConstants.POSITION),o=this.data.componentOffsets,a=o.length?o[e+1]:r.length,l=1/0,c=1/0,u=1/0,p=-1/0,d=-1/0,h=-1/0,f=i.offsetIdx,v=i.strideIdx,g=o.length?o[e]:0;g<a;g++){var m=f+v*r[g],y=i.data[m],b=i.data[m+1],_=i.data[m+2];l=Math.min(l,y),c=Math.min(c,b),u=Math.min(u,_),p=Math.max(p,y),d=Math.max(d,b),h=Math.max(h,_)}t[n]=l,t[n+1]=c,t[n+2]=u,t[n+3]=p,t[n+4]=d,t[n+5]=h},e.prototype._calculateBoundingInfo=function(){var e=this.data.getIndices(s.VertexAttrConstants.POSITION),t=this.data.getAttribute(s.VertexAttrConstants.POSITION),r="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(r);for(var o=0;o<r;++o)e[o]=o}var l=e.length;a.assert(l%r==0,"Indexing error: "+l.toFixed(0)+" not divisible by "+r.toFixed(0));var c=i.generateDefaultIndexArray(l/r);return new n(c,r,e,t)},e.__idGen=new o.IdGen,e}()}).apply(null,r))||(e.exports=i)},z4cv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[1,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3]]},t.fromValues=function(e,t,n,r){return[e,t,n,r]},t.createView=function(e,t){return new Float64Array(e,t,4)}}).apply(null,r))||(e.exports=i)},zZCp:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}).apply(null,r))||(e.exports=i)},znI2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("CIy2")],void 0===(i=(function(e,t,n){function r(e){return n.getFirstObjectValue(e.data.indices).length>=1}Object.defineProperty(t,"__esModule",{value:!0}),t.splitRenderGeometryChangeSetByMaterial=function(e){for(var t=new Map,n=null,i=null,o=function(e){if(e===n)return i;var r=t.get(e);return r||t.set(e,r={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1}),n=e,i=r,r},a=0;a<e.numToAdd;a++)r(s=e.toAdd[a])&&o(s.material).toAdd.push(s);for(a=0;a<e.numToRemove;a++){var s;r(s=e.toRemove[a])&&o(s.material).toRemove.push(s)}for(a=0;a<e.numToUpdate;a++){var l=e.toUpdate[a];r(l.renderGeometry)&&o(l.renderGeometry.material).toUpdate.push(l)}return t}}).apply(null,r))||(e.exports=i)}}]);