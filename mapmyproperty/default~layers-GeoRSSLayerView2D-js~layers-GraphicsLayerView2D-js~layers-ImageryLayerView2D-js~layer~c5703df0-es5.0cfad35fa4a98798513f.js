!function(){function e(e,t,r,i,n,a,s){try{var o=e[a](s),u=o.value}catch(l){return void r(l)}o.done?t(u):Promise.resolve(u).then(i,n)}function t(t){return function(){var r=this,i=arguments;return new Promise((function(n,a){var s=t.apply(r,i);function o(t){e(s,n,a,o,u,"next",t)}function u(t){e(s,n,a,o,u,"throw",t)}o(void 0)}))}}function r(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=l(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){o=!0,a=e})),f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==r)return;var i,n,a=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(i=r.next()).done)&&(a.push(i.value),!t||a.length!==t);s=!0);}catch(u){o=!0,n=u}finally{try{s||null==r.return||r.return()}finally{if(o)throw n}}return a}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=b(e);if(t){var n=b(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return m(this,r)}}function m(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?g(e):t}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"5LEI":function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r("wSAH");var i=r("HJJS"),n=r("rlSK"),a=r("jHF5"),s=function(e){v(r,e);var t=p(r);function r(e,i,s){var o,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s;return d(this,r),(o=t.call(this)).triangleCountReportedInDebug=0,o.transforms={dvs:Object(a.b)(),tileMat3:Object(a.b)()},o.triangleCount=0,o.key=new n.a(e),o.bounds=i,o.size=s,o.coordRange=u,o}return f(r,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"coords",get:function(){return this._coords}},{key:"bounds",get:function(){return this._bounds},set:function(e){this._coords=[e[0],e[3]],this._bounds=e}},{key:"setTransform",value:function(e,t){var r=t/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,a=u(e.toScreenNoRotation([0,0],this.coords),2),s=a[0],o=a[1],l=this.size[0]/this.coordRange[0]*r,c=this.size[1]/this.coordRange[1]*r;Object(i.j)(n,l,0,0,0,c,0,s,o,1),Object(i.g)(this.transforms.dvs,e.displayViewMat3,n)}}]),r}(r("fEsP").a)},KFVX:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("jIHu"),n=function(e){v(r,e);var t=p(r);function r(e,n){return d(this,r),t.call(this,e,n,[i.E,i.E])}return r}(r("5LEI").a)},RXWn:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i=r("f4Nx"),n=r("PNY3"),a=r("KLE9"),s=r("qatw"),l=r("kYAx"),c=r("9w8m");function h(e){if(!e)return null;if("mesh"===e.type)return e.toJSON();var t=null,r=e.spatialReference,u=Object(i.d)(r);if(!u)return e.toJSON();var l,d=r.isWebMercator?102100:4326,h=c.a[d].maxX,f=c.a[d].minX,p=c.a[d].plus180Line,m=c.a[d].minus180Line,g=e.toJSON();if(Object(s.f)(g))l=y(g,h,f);else if(Object(s.e)(g))g.points=g.points.map((function(e){return y(e,h,f)})),l=g;else if(Object(s.d)(g))l=v(g,u);else if(Object(s.g)(g)||Object(s.h)(g)){var _=x;Object(a.a)(_,g);var k={xmin:_[0],ymin:_[1],xmax:_[2],ymax:_[3]},O=Object(c.d)(k.xmin,f)*(2*h),w=0===O?g:function(e,t){var r,i=o(Object(c.b)(e));try{for(i.s();!(r=i.n()).done;){var n,a=o(r.value);try{for(a.s();!(n=a.n()).done;){n.value[0]+=t}}catch(s){a.e(s)}finally{a.f()}}}catch(s){i.e(s)}finally{i.f()}return e}(g,O);k.xmin+=O,k.xmax+=O,Object(n.a)(k,p)&&k.xmax!==h||Object(n.a)(k,m)&&k.xmin!==f?t=w:l=w}else l=e.toJSON();return null!==t?(new b).cut(t,h):l}function v(e,t){if(!t)return e;var r=function(e,t){var r,i=[],n=e.ymin,a=e.ymax,s=e.xmax-e.xmin,o=e.xmin,l=e.xmax,c=u(t.valid,2),d=c[0],h=c[1],f=(r=p(e.xmin,t)).x,v=r.frameId,y=(r=p(e.xmax,t)).x,g=r.frameId,b=f===y&&s>0;if(s>2*h){var x={xmin:o<l?f:y,ymin:n,xmax:h,ymax:a},_={xmin:d,ymin:n,xmax:o<l?y:f,ymax:a},k={xmin:0,ymin:n,xmax:h,ymax:a},O={xmin:d,ymin:n,xmax:0,ymax:a},w=[],j=[];m(x,k)&&w.push(v),m(x,O)&&j.push(v),m(_,k)&&w.push(g),m(_,O)&&j.push(g);for(var D=v+1;D<g;D++)w.push(D),j.push(D);i.push({extent:x,frameIds:[v]},{extent:_,frameIds:[g]},{extent:k,frameIds:w},{extent:O,frameIds:j})}else f>y||b?i.push({extent:{xmin:f,ymin:n,xmax:h,ymax:a},frameIds:[v]},{extent:{xmin:d,ymin:n,xmax:y,ymax:a},frameIds:[g]}):i.push({extent:{xmin:f,ymin:n,xmax:y,ymax:a},frameIds:[v]});return i}(e,t).map((function(e){return e.extent}));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}function y(e,t,r){if(Array.isArray(e)){var i=e[0];if(i>t){var n=Object(c.d)(i,t);e[0]=i+n*(-2*t)}else if(i<r){var a=Object(c.d)(i,r);e[0]=i+a*(-2*r)}}else{var s=e.x;if(s>t){var o=Object(c.d)(s,t);e.x+=o*(-2*t)}else if(s<r){var u=Object(c.d)(s,r);e.x+=u*(-2*r)}}return e}function p(e,t){var r,i=u(t.valid,2),n=i[0],a=i[1],s=2*a,o=0;return e>a?(e-=(r=Math.ceil(Math.abs(e-a)/s))*s,o=r):e<n&&(e+=(r=Math.ceil(Math.abs(e-n)/s))*s,o=-r),{x:e,frameId:o}}function m(e,t){var r=t.xmin,i=t.ymin,n=t.xmax,a=t.ymax;return g(e,r,i)&&g(e,r,a)&&g(e,n,a)&&g(e,n,i)}function g(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}var b=function(){function e(){d(this,e)}return f(e,[{key:"cut",value:function(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var i=r.length,n=-2*t,a=0;a<i;a++){var s=r[a];if(s&&s.length>=this.minPts){var u,l=[],c=o(s);try{for(c.s();!(u=c.n()).done;){var d=u.value;l.push([d[0]+n,d[1]])}}catch(h){c.e(h)}finally{c.f()}r.push(l)}}return this.closed?e.rings=r:e.paths=r,e}}]),e}(),x=Object(l.g)()},Vh9r:function(e,i,a){"use strict";var l=a("pO5D"),c=a("wSAH"),h=a("srIe"),y=(a("6S2I"),a("zqDF"),a("WbKI")),m=a("04ZG"),x=(a("4EHJ"),a("ju1D"),a("9AIY"),a("9MzC")),_=a("/CmD"),k=a("f4Nx"),O=a("WZb1"),w=a("Mu3I"),j=a("Ehki"),D=a("qatw"),T=a("qRWG"),R=a("kYAx"),B=a("psH3"),S=a("kJYu"),I=a("jIHu"),C=a("sq/B"),F=a("RXWn"),z=a("t7mB"),L=a("ZxoT"),A=a("HsO1"),M=a("yN2G");function V(e,t,r){if(!e.allDirty)if(null!=e.from&&null!=e.count){var i=Math.min(e.from,t),n=Math.max(e.from+e.count,t+r)-i;e.from=i,e.count=n}else e.from=t,e.count=r}var P=function(){function e(){d(this,e),this._dirties=Object(M.e)((function(){return{indices:{from:null,count:null,allDirty:!1}}}),(function(){return{vertices:{from:null,count:null,allDirty:!1}}}))}return f(e,[{key:"hasDirty",value:function(){var e,t=o(this._dirties);try{for(t.s();!(e=t.n()).done;){var r=e.value;if(null!==r.data.indices.count||r.data.indices.allDirty)return!0}}catch(i){t.e(i)}finally{t.f()}return!1}},{key:"markAllClean",value:function(){var e,t=o(this._dirties);try{for(t.s();!(e=t.n()).done;){var r=e.value;for(var i in r.data.indices.from=null,r.data.indices.count=null,r.data.indices.allDirty=!1,r.buffers)r.buffers[i].data.vertices.from=null,r.buffers[i].data.vertices.count=null,r.buffers[i].data.vertices.allDirty=!1}}catch(n){t.e(n)}finally{t.f()}}},{key:"markAllDirty",value:function(){var e,t=o(this._dirties);try{for(t.s();!(e=t.n()).done;){var r=e.value;for(var i in r.data.indices.allDirty=!0,r.buffers)r.buffers[i].data.vertices.allDirty=!0}}catch(n){t.e(n)}finally{t.f()}}},{key:"forEach",value:function(e){for(var t=0;t<this._dirties.length;++t){var r=this._dirties[t],i={};for(var n in r.buffers){var a=r.buffers[n].data.vertices;(a.allDirty||null!=a.from&&null!=a.count&&a.count>0)&&(i[n]=a)}var s,o=r.data.indices;((s=o.allDirty||null!=o.from&&null!=o.count&&o.count>0?{indices:o,vertices:i}:{indices:null,vertices:i}).indices||Object.keys(s).length>0)&&e(s,t)}}},{key:"markDirtyIndices",value:function(e,t,r){V(this._dirties[e].data.indices,t,r)}},{key:"markDirtyVertices",value:function(e,t,r,i){V(this._dirties[e].buffers[t].data.vertices,r,i)}}]),e}(),G=function(){function e(t){d(this,e),this._largestRange=null,this._parent=t,this._updateLargestRange()}return f(e,[{key:"largestRange",get:function(){return this._largestRange}},{key:"rangeCreated",value:function(e){(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}},{key:"rangeResized",value:function(e,t){e===this._largestRange?e.count<t&&this._updateLargestRange():(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}},{key:"findBestRange",value:function(e){for(var t=this._parent._freeHead,r=null;null!==t;)t.count>=e&&(!r||t.count-e<r.count-e)&&(r=t),t=t.next;return r}},{key:"findAdjacentRanges",value:function(e,t){for(var r=!0,i=!1,n=null,a=this._parent._freeHead;r&&!i;){var s=null!==a?a.from:this._parent._size;e>=(null!==n?n.from+n.count:0)&&e+t<=s?(r=!1,i=!0):null!==a?(n=a,a=a.next):r=!1}return[n,a]}},{key:"_updateLargestRange",value:function(){for(var e=null,t=this._parent._freeHead;null!==t;)(!e||t.count>e.count)&&(e=t),t=t.next;this._largestRange=e}}]),e}(),U=function(){function e(t,r){d(this,e),this._allocated=0,this._size=t,this._freeHead=t>0?{from:0,count:t,prev:null,next:null}:null,this._bookKeeper=r||new G(this),this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}return f(e,[{key:"allocate",value:function(t){var r=this._bookKeeper.findBestRange(t);if(null===r)return-1;var i=r.from,n=r.count;if(r.from+=t,r.count-=t,this._bookKeeper.rangeResized(r,i,n),this._allocated+=t,0===r.count){var a=null!==r.prev?this._freeHead:r.next;e._removeRange(r),this._freeHead=a}return i}},{key:"free",value:function(t,r){var i=u(this._bookKeeper.findAdjacentRanges(t,r),2),n=i[0],a=i[1],s={from:t,count:r,prev:n,next:a};if(null!==n&&(n.next=s),null!==a&&(a.prev=s),this._bookKeeper.rangeCreated(s),this._allocated-=r,null!==a&&s.from+s.count===a.from){var o=s.from,l=s.count;e._fuse(s,a),e._removeRange(a),this._bookKeeper.rangeResized(s,o,l),this._bookKeeper.rangeResized(a,void 0,0)}if(null!==n&&n.from+n.count===s.from){var c=n.from,d=n.count;e._fuse(n,s),e._removeRange(s),this._bookKeeper.rangeResized(n,c,d),this._bookKeeper.rangeResized(s,void 0,0)}this._freeHead=null!==s.prev?this._freeHead:s}},{key:"fragmentation",get:function(){var e=this._size-this._allocated;return 0===e?0:1-this._bookKeeper.largestRange.count/e}}],[{key:"_removeRange",value:function(e){null!==e.prev?null!==e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.prev.next=null:null!==e.next&&(e.next.prev=null)}},{key:"_fuse",value:function(e,t){e.count+=t.count,e.next=t.next,t.from+=t.count,t.count=0,null!==t.next&&(t.next.prev=e)}}]),e}(),E=["FILL","LINE","MARKER","TEXT","LABEL"],q=function(){function e(t,r,i,n){for(var a in d(this,e),this._strides=t,this._displayList=r,this._freeListsAndStorage={},this._dirtyMap=null,this._dirtyMap=i,t)for(var s in this._freeListsAndStorage[a]={vtxFreeList:n?new U(n):null,idxFreeList:n?new U(n):null,vertexBuffers:{},indexBuffer:n?new Uint32Array(n):null},t[a])this._freeListsAndStorage[a].vertexBuffers[s]={data:n?Object(M.b)(n,t[a][s]):null,stride:t[a][s]}}return f(e,[{key:"delete",value:function(e){var t=E[e.geometryType];this._freeVertices(t,e.vertexFrom,e.vertexCount),this._freeIndices(t,e.indexFrom,e.indexCount),this._displayList.removeFromList(e),e.vertexFrom=void 0,e.indexFrom=void 0}},{key:"setMeshData",value:function(e,t,r,i,n){var a,s,o=E[e.geometryType];e.meshData=null,void 0===e.vertexFrom?(s=t.vertexCount,a=this._allocateVertices(o,s)):t.vertexCount>e.vertexCount?(this._freeVertices(o,e.vertexFrom,e.vertexCount),s=t.vertexCount,a=this._allocateVertices(o,s)):t.vertexCount===e.vertexCount?(a=e.vertexFrom,s=e.vertexCount):(this._freeVertices(o,e.vertexFrom+t.vertexCount,e.vertexCount-t.vertexCount),a=e.vertexFrom,s=t.vertexCount);var u,l,c,d=!0;if(void 0===e.indexFrom?(u=n,c=t.indexCount,l=this._allocateIndices(o,c)):t.indexCount>e.indexCount?(u=this._displayList.removeFromList(e),this._freeIndices(o,e.indexFrom,e.indexCount),c=t.indexCount,l=this._allocateIndices(o,c)):t.indexCount===e.indexCount?(d=!1,l=e.indexFrom,c=e.indexCount):(u=this._displayList.removeFromList(e),this._freeIndices(o,e.indexFrom+t.indexCount,e.indexCount-t.indexCount),l=e.indexFrom,c=t.indexCount),-1!==a&&-1!==l){var h=this._storageFor(o);if(Object(M.d)(a,l,h.vertexBuffers,h.indexBuffer,t,r,i),e.vertexFrom=a,e.indexFrom=l,e.vertexCount=t.vertexCount,e.indexCount=t.indexCount,this._dirtyMap)for(var f in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),r)this._dirtyMap.markDirtyVertices(e.geometryType,f,e.vertexFrom,e.vertexCount);return d&&this._displayList.addToList(e,u),!0}return-1!==a&&this._freeVertices(o,a,s),-1!==l&&this._freeIndices(o,l,c),e.setMeshDataFromBuffers(t,r,i),e.vertexFrom=void 0,e.vertexCount=0,e.indexFrom=void 0,e.indexCount=0,!1}},{key:"tryAddMeshData",value:function(e,t){var r=t.vertexBuffer,i=t.indexBuffer,n=E[e.geometryType],a=this._allocateVertices(n,e.vertexCount);if(-1===a)return this._freeVertices(n,a,e.vertexCount),!1;var s=this._allocateIndices(n,e.indexCount);if(-1===s)return this._freeVertices(n,a,e.vertexCount),this._freeIndices(n,s,e.indexCount),!1;var o=this._storageFor(n);if(Object(M.d)(a,s,o.vertexBuffers,o.indexBuffer,e,r,i),e.vertexFrom=a,e.indexFrom=s,this._dirtyMap)for(var u in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),r)this._dirtyMap.markDirtyVertices(e.geometryType,u,a,e.vertexCount);return this._displayList.addToList(e),!0}},{key:"_allocateVertices",value:function(e,t){var r=this._storageFor(e),i=r.vtxFreeList.allocate(t);return-1===i||r.vtxFreeList.fragmentation>.5?-1:i}},{key:"_freeVertices",value:function(e,t,r){this._storageFor(e).vtxFreeList.free(t,r)}},{key:"_freeIndices",value:function(e,t,r){this._storageFor(e).idxFreeList.free(t,r)}},{key:"_allocateIndices",value:function(e,t){var r=this._storageFor(e),i=r.idxFreeList.allocate(t);return-1===i||r.idxFreeList.fragmentation>.5?-1:i}},{key:"_storageFor",value:function(e){return this._freeListsAndStorage[e]}},{key:"_stridesFor",value:function(e,t){return this._strides[e][t]}}],[{key:"fromTileData",value:function(t,r){var i,n=function(e){for(var t=e.getStrides(),r={},i=0;i<t.length;i++)r[E[i]]=t[i];return r}(t),a=[0,0,0,0,0],s=[0,0,0,0,0],u=o(t.tileDisplayData.displayObjects);try{for(u.s();!(i=u.n()).done;){var l,c=o(i.value.displayRecords);try{for(c.s();!(l=c.n()).done;){var d=l.value;a[d.geometryType]=Math.max(a[d.geometryType],d.vertexFrom+d.vertexCount),s[d.geometryType]=Math.max(s[d.geometryType],d.indexFrom+d.indexCount)}}catch(w){c.e(w)}finally{c.f()}}}catch(w){u.e(w)}finally{u.f()}for(var h=new e(n,t.tileDisplayData.displayList,r,null),f=0;f<t.tileBufferData.geometries.length;++f){var v=a[f],y=s[f],p=t.tileBufferData.geometries[f],m=h._storageFor(E[f]),g=t.tileBufferData.geometries[f].indexBuffer,b=void 0;for(var x in m.indexBuffer=g,m.idxFreeList=new U(g.length),m.idxFreeList.allocate(y),p.vertexBuffer){var _=t.tileBufferData.geometries[f].vertexBuffer[x];m.vertexBuffers[x].data=_.data,m.vertexBuffers[x].stride=_.stride;var k=Object(M.p)(_.stride),O=_.data.length*k/_.stride;b||(b=O)}m.vtxFreeList=new U(b),m.vtxFreeList.allocate(v)}return h}}]),e}(),K=(a("OKTS"),a("n4uK"),a("fOQB")),H=a("D6bk");a("0meK");var N=function(e){v(r,e);var t=p(r);function r(){var e;return d(this,r),(e=t.apply(this,arguments))._data=null,e._displayList=null,e._lastCommitTime=0,e._hasData=!1,e._invalidated=!1,e._wglBuffers=null,e._dirtyMap=new P,e}return f(r,[{key:"destroy",value:function(){s(b(r.prototype),"destroy",this).call(this),this.clear()}},{key:"hasData",get:function(){return!!this._hasData}},{key:"displayObjects",get:function(){var e;return null!=(e=this._displayObjects)?e:[]}},{key:"getGeometry",value:function(e){return this._wglBuffers&&this._wglBuffers.has(e)?this._wglBuffers.get(e):null}},{key:"getDisplayList",value:function(){return this._displayList}},{key:"patch",value:function(e){if(!0===e.clear)return this.clear(),void(this._hasData=!1);var t=e.addOrUpdate,r=e.remove;!this._data&&t&&t.tileDisplayData.displayObjects.length?(t.tileDisplayData.computeDisplayList(),this._dirtyMap=new P,this._dispRecStore=q.fromTileData(t,this._dirtyMap),this._data=t,this._dirtyMap.markAllDirty(),this._hasData=!0,e.end&&this.ready()):this._data&&(t&&t.tileDisplayData.displayObjects.length||r.length)?this._doPatchData(e):e.end&&this.ready(),e.end&&!this._data&&this.clear(),this.requestRender(),this.emit("change")}},{key:"commit",value:function(e){e.time&&e.time===this._lastCommitTime||(this._lastCommitTime=e.time,this.visible&&this._data&&(this._wglBuffers||(this._wglBuffers=new(function(){function e(t){d(this,e),this.geometryMap=Object(M.e)((function(){return{indexBuffer:K.a.createIndex(t,35044),vao:null}}),(function(e,r){return{vertexBuffer:K.a.createVertex(t,M.a[r])}}))}return f(e,[{key:"dispose",value:function(){for(var e=0;e<5;e++){var t=this.geometryMap[e];if(t)for(var r in t.data.vao&&t.data.vao.dispose(!1),t.data.indexBuffer&&t.data.indexBuffer.dispose(),t.buffers)t.buffers[r]&&t.buffers[r].data.vertexBuffer.dispose()}}},{key:"get",value:function(e){var t=this.geometryMap[e];return{draw:function(e,r,i,n,a){if(!t.data.vao){var s={};for(var o in t.buffers)s[o]=t.buffers[o].data.vertexBuffer;t.data.vao=new H.a(e,i,r,s,t.data.indexBuffer)}e.bindVAO(t.data.vao),e.drawElements(4,a,5125,Uint32Array.BYTES_PER_ELEMENT*n),e.bindVAO(null)}}}},{key:"has",value:function(e){return null!=this.geometryMap[e]}},{key:"upload",value:function(e,t){var r=this;t.forEach((function(t,i){r._upload(t,i,e)}))}},{key:"_upload",value:function(e,t,r){if(e.indices&&(e.indices.allDirty?this._uploadIndices(r,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(r,t,e.indices.from,e.indices.count)),e.vertices){var i=e.vertices;for(var n in i){var a=i[n];a.allDirty?this._uploadVertices(r,t,n):null!=a.from&&null!=a.count&&this._uploadVertices(r,t,n,a.from,a.count)}}}},{key:"_uploadVertices",value:function(e,t,r,i,n){var a=this.geometryMap[t];if(a){var s=e.geometries[t].vertexBuffer[r];if(s){var o=s.stride,u=s.data.buffer;a.buffers[r]&&u.byteLength>0&&(null!=i&&null!=n?a.buffers[r].data.vertexBuffer.setSubData(u,i*o,i*o,(i+n)*o):a.buffers[r].data.vertexBuffer.setData(u))}}}},{key:"_uploadIndices",value:function(e,t,r,i){var n=this.geometryMap[t];if(n){var a=e.geometries[t].indexBuffer.buffer;n.data.indexBuffer&&a.byteLength>0&&(null!=r&&null!=i?n.data.indexBuffer.setSubData(a,4*r,4*r,4*(r+i)):n.data.indexBuffer.setData(a))}}}]),e}())(e.context)),(this._dirtyMap.hasDirty()||this._invalidated)&&(this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._dirtyMap.markAllClean())))}},{key:"clear",value:function(){this._data=null,this._displayList=null,this._dispRecStore=null,this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)}},{key:"_doPatchData",value:function(e){this._invalidated=!0,this._patchData(e)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=q.fromTileData(this._data,this._dirtyMap)),this.requestRender()}},{key:"_patchData",value:function(e){var t,r=!0,i=e.addOrUpdate&&e.addOrUpdate.tileDisplayData&&e.addOrUpdate.tileDisplayData.displayObjects||[],n=(e.remove||[]).slice(),a=o(i);try{for(a.s();!(t=a.n()).done;){var s=t.value;null!=s.insertAfter&&n.push(s.id)}}catch(H){a.e(H)}finally{a.f()}var u,l=o(n);try{for(l.s();!(u=l.n()).done;){var c=u.value,d=this._data.tileDisplayData.displayObjectRegistry.get(c);if(d){this._data.tileDisplayData.displayList.removeFromList(d.displayRecords);var h,f=o(d.displayRecords);try{for(f.s();!(h=f.n()).done;){var v=h.value;this._dispRecStore.delete(v)}}catch(H){f.e(H)}finally{f.f()}this._data.tileDisplayData.displayObjectRegistry.delete(c);var y=this._data.tileDisplayData.displayObjects.indexOf(d);this._data.tileDisplayData.displayObjects.splice(y,1)}}}catch(H){l.e(H)}finally{l.f()}var p,m=o(i);try{for(m.s();!(p=m.n()).done;){var g=p.value,b=void 0,x=this._data.tileDisplayData.displayObjectRegistry.get(g.id);if(x){var _=x.displayRecords;x.set(g),x.displayRecords=_;for(var k=x.displayRecords.length,O=0;O<k;++O){var w=x.displayRecords[O],j=g.displayRecords[O];(O>=g.displayRecords.length||w.geometryType!==j.geometryType||w.symbolLevel!==j.symbolLevel||w.zOrder!==j.zOrder||w.materialKey!==j.materialKey)&&(this._dispRecStore.delete(x.displayRecords[O]),O<g.displayRecords.length&&(x.displayRecords[O]=void 0))}x.displayRecords.length=g.displayRecords.length}else{var D=void 0;(x=g.copy()).displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(g.id,x);var T=this._data.tileDisplayData.displayObjects;if(null!=x.insertAfter)if(b={},x.insertAfter>=0){var R=this._data.tileDisplayData.displayObjectRegistry.get(x.insertAfter);R?(D=T.indexOf(R)+1)<T.length?T.splice(D,0,x):(T.push(x),D=T.length):(T.push(x),D=T.length)}else T.unshift(x),D=0;else T.push(x),D=T.length;if(b)for(var B=g.displayRecords.length>0?1:0,S=0,I=D-1;I>=0&&S<B;--I)for(var C=T[I].displayRecords.length-1;C>=0&&S<B;--C){var F=T[I].displayRecords[C],z=this._data.tileDisplayData.displayList.getDPInfoType();b[z]||(b[z]=F,++S)}}for(var L=g.displayRecords.length,A=0;A<L;++A){var M=g.displayRecords[A],V=x.displayRecords[A];V?(V.meshData=M.meshData,V.materialKey=M.materialKey):((V=M.copy()).vertexFrom=void 0,V.indexFrom=void 0,x.displayRecords[A]=V);var P=M.geometryType,G=this._data.tileDisplayData.displayList.getDPInfoType(),U=e.addOrUpdate.tileBufferData.geometries[P],E=U.vertexBuffer,q=U.indexBuffer,K=void 0;b&&(K=b[G]?this._data.tileDisplayData.displayList.splitAfter(b[G]):-1),r=this._dispRecStore.setMeshData(V,M,E,q,K)&&r,b&&null!=V.indexFrom&&null!=V.indexFrom&&(b[G]=V)}}}catch(H){m.e(H)}finally{m.f()}return r}}]),r}(a("KFVX").a),Z=a("n21L"),X=function(){function e(){d(this,e),this._byGeometryType=null}return f(e,[{key:"satisfied",get:function(){return!this._byGeometryType}},{key:"reset",value:function(){this._byGeometryType=null}},{key:"verticesFor",value:function(e){return this._byGeometryType?this._byGeometryType[e].vertices:0}},{key:"indicesFor",value:function(e){return this._byGeometryType?this._byGeometryType[e].indices:0}},{key:"needMore",value:function(e,t,r){if(t||r){this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]);var i=this._byGeometryType[e];i.vertices+=t,i.indices+=r}}}]),e}(),Q=function(){function e(){d(this,e),this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}return f(e,[{key:"clone",value:function(){for(var t=new e,r=0;r<this.geometries.length;r++){var i=this.geometries[r],n=t.geometries[r];for(var a in n.indexBuffer=i.indexBuffer.slice(),n.vertexBuffer={},i.vertexBuffer){var s=i.vertexBuffer[a],o=s.data,u=s.stride;n.vertexBuffer[a]={data:o.slice(),stride:u}}}return t}},{key:"serialize",value:function(){for(var e={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},t=0;t<5;++t)for(var r in this.geometries[t].vertexBuffer)e.geometries[t].vertexBuffer[r]={data:this.geometries[t].vertexBuffer[r].data.buffer,stride:this.geometries[t].vertexBuffer[r].stride};return e}},{key:"getBuffers",value:function(){for(var e=[],t=0;t<5;++t)for(var r in e.push(this.geometries[t].indexBuffer.buffer),this.geometries[t].vertexBuffer)e.push(this.geometries[t].vertexBuffer[r].data.buffer);return e}}],[{key:"deserialize",value:function(t){for(var r=new e,i=0;i<5;++i)for(var n in r.geometries[i].indexBuffer=new Uint32Array(t.geometries[i].indexBuffer),r.geometries[i].vertexBuffer={},t.geometries[i].vertexBuffer)r.geometries[i].vertexBuffer[n]={data:Object(M.c)(t.geometries[i].vertexBuffer[n].data,t.geometries[i].vertexBuffer[n].stride),stride:t.geometries[i].vertexBuffer[n].stride};return r}}]),e}(),Y=function(){function e(){d(this,e),this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}return f(e,[{key:"clear",value:function(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}},{key:"update",value:function(e,t,r){for(var i in e)this.vertexData.set(i,e[i]);for(var n in this.vertexData)null===e[n]&&this.vertexData.delete(n);this.vertexCount=t,this.indexData=r}}]),e}(),J=function(){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;d(this,e),this.id=t,this.geometryType=r,this.materialKey=i,this.minZoom=n,this.maxZoom=a,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}return f(e,[{key:"sortKey",get:function(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}},{key:"clone",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this.id,this.geometryType,this.materialKey);return t.vertexFrom=this.vertexFrom,t.vertexCount=this.vertexCount,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t.zOrder=this.zOrder,t.symbolLevel=this.symbolLevel,t.meshData=this.meshData,t.minZoom=this.minZoom,t.maxZoom=this.maxZoom,t}},{key:"setMeshDataFromBuffers",value:function(e,t,r){var i=new Y;for(var n in t){for(var a=t[n].stride,s=t[n].data,o=[],u=Object(M.p)(a),l=0;l<a*e.vertexCount/u;++l)o[l]=s[l+a*e.vertexFrom/u];i.vertexData.set(n,o)}i.indexData.length=0;for(var c=0;c<e.indexCount;++c)i.indexData[c]=r[c+e.indexFrom]-e.vertexFrom;i.vertexCount=e.vertexCount,this.meshData=i}},{key:"readMeshDataFromBuffers",value:function(e,t){for(var r in this.meshData?this.meshData.clear():this.meshData=new Y,e){for(var i=e[r].stride,n=e[r].data,a=[],s=Object(M.p)(i),o=0;o<i*this.vertexCount/s;++o)a[o]=n[o+i*this.vertexFrom/s];this.meshData.vertexData.set(r,a)}this.meshData.indexData.length=0;for(var u=0;u<this.indexCount;++u)this.meshData.indexData[u]=t[u+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}},{key:"writeMeshDataToBuffers",value:function(e,t,r,i){for(var n in t)for(var a=t[n].stride,s=this.meshData.vertexData.get(n),o=t[n].data,u=Object(M.p)(a),l=0;l<a*this.meshData.vertexCount/u;++l)o[l+a*e/u]=s[l];for(var c=0;c<this.meshData.indexData.length;++c)i[c+r]=this.meshData.indexData[c]+e;this.vertexFrom=e,this.vertexCount=this.meshData.vertexCount,this.indexFrom=r,this.indexCount=this.meshData.indexData.length}},{key:"_computeSortKey",value:function(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}},{key:"serialize",value:function(e){return e.push(this.geometryType),e.push(this.materialKey),e.push(this.vertexFrom),e.push(this.vertexCount),e.push(this.indexFrom),e.push(this.indexCount),e.push(this.minZoom),e.push(this.maxZoom),e}}],[{key:"writeAllMeshDataToBuffers",value:function(e,t,r){var i,n=0,a=0,s=o(e);try{for(s.s();!(i=s.n()).done;){var u=i.value;u.writeMeshDataToBuffers(n,t,a,r),n+=u.vertexCount,a+=u.indexCount}}catch(l){s.e(l)}finally{s.f()}}},{key:"deserialize",value:function(t,r){var i=t.readInt32(),n=t.readInt32(),a=new e(r.id,i,n);return a.vertexFrom=t.readInt32(),a.vertexCount=t.readInt32(),a.indexFrom=t.readInt32(),a.indexCount=t.readInt32(),a.minZoom=t.readInt32(),a.maxZoom=t.readInt32(),a}}]),e}();function W(e,t){if(null!==t){e.push(t.length);var r,i=o(t);try{for(i.s();!(r=i.n()).done;){r.value.serialize(e)}}catch(n){i.e(n)}finally{i.f()}return e}e.push(0)}var $=function(){function e(t){d(this,e),this.insertAfter=null,this.id=t,this.displayRecords=[]}return f(e,[{key:"copy",value:function(){var t=new e(this.id);return t.set(this),t}},{key:"clone",value:function(){var t=new e(this.id);return t.displayRecords=this.displayRecords.map((function(e){return e.clone()})),t.insertAfter=this.insertAfter,t}},{key:"set",value:function(e){this.id=e.id,this.displayRecords=e.displayRecords,this.insertAfter=e.insertAfter}},{key:"serialize",value:function(e){return e.push(this.id),W(e,this.displayRecords),e}}],[{key:"deserialize",value:function(t){var r=t.readInt32(),i=new e(r);return i.displayRecords=function(e,t,r){for(var i=e.readInt32(),n=new Array(i),a=0;a<n.length;a++)n[a]=t.deserialize(e,r);return n}(t,J,{id:r}),i}}]),e}(),ee=a("yE7X");function te(e,t,r){for(var i=arguments.length,n=new Array(i>3?i-3:0),a=3;a<i;a++)n[a-3]=arguments[a];t<e.length?e.splice.apply(e,[t,r].concat(n)):e.push.apply(e,n)}var re=new Map;re.set(ee.c.MAP,[ee.d.FILL,ee.d.LINE,ee.d.MARKER,ee.d.TEXT]),re.set(ee.c.LABEL,[ee.d.LABEL]),re.set(ee.c.LABEL_ALPHA,[ee.d.LABEL]);var ie=function(){function e(){d(this,e),this.symbolLevels=[]}return f(e,[{key:"replay",value:function(e,t,r){var i,n=o(this.symbolLevels);try{for(n.s();!(i=n.n()).done;){var a,s=o(i.value.zLevels);try{for(s.s();!(a=s.n()).done;){var u=a.value.geometryDPInfo.unified;if(u){var l,c=o(u);try{var d=function(){var i=l.value,n=e.painter.getGeometryBrush(i.geometryType),a=t.getGeometry(i.geometryType),s={geometryType:i.geometryType,materialKey:i.materialKey,indexFrom:i.indexFrom,indexCount:i.indexCount,draw:function(e,t,r){a.draw(e,t,r,i.indexFrom,i.indexCount)}};n.prepareState(e,t),n.drawGeometry(e,t,s,r)};for(c.s();!(l=c.n()).done;)d()}catch(h){c.e(h)}finally{c.f()}}}}catch(h){s.e(h)}finally{s.f()}}}catch(h){n.e(h)}finally{n.f()}}},{key:"empty",get:function(){return!this.symbolLevels||0===this.symbolLevels.length}},{key:"clear",value:function(){this.symbolLevels.length=0}},{key:"addToList",value:function(e,t){if(Array.isArray(e)){var r,i=o(e);try{for(i.s();!(r=i.n()).done;){var n=r.value;this._addToList(n,t)}}catch(a){i.e(a)}finally{i.f()}}else this._addToList(e,t)}},{key:"removeFromList",value:function(e){Array.isArray(e)||(e=[e]);var t,r=null,i=o(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;r=this._removeFromList(n)}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"clone",value:function(){var t,r=new e,i=o(this.symbolLevels);try{for(i.s();!(t=i.n()).done;){var n=t.value;r.symbolLevels.push(n.clone())}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"splitAfter",value:function(e){for(var t=this._getDisplayList(e.symbolLevel,e.zOrder),r=t.length,i=e.indexFrom+e.indexCount,n=0;n<r;++n){var a=t[n];if(a.geometryType===e.geometryType&&i>a.indexFrom&&i<=a.indexFrom+a.indexCount){if(i<a.indexFrom+a.indexCount){var s=new ne;s.geometryType=a.geometryType,s.materialKey=a.materialKey,s.indexFrom=i,s.indexCount=a.indexFrom+a.indexCount-i,t.splice(n+1,0,s),a.indexCount=i-a.indexFrom}return n}}}},{key:"_addToList",value:function(e,t){var r=this._getDisplayList(e.symbolLevel,e.zOrder),i=null!=t?t:r.length-1,n=i>=0&&i<r.length?r[i]:null;if(null!==n&&n.materialKey===e.materialKey&&n.indexFrom+n.indexCount===e.indexFrom&&n.geometryType===e.geometryType)n.indexCount+=e.indexCount;else{var a=new ne;a.indexFrom=e.indexFrom,a.indexCount=e.indexCount,a.materialKey=e.materialKey,a.geometryType=e.geometryType,te(r,i+1,0,a)}}},{key:"_removeFromList",value:function(e){for(var t,r=this._getDisplayList(e.symbolLevel,e.zOrder),i=r.length,n=0;n<i;++n){var a=r[n];if(e.indexFrom+e.indexCount>a.indexFrom&&e.indexFrom<a.indexFrom+a.indexCount&&a.geometryType===e.geometryType){t=n;break}}if(void 0!==t){var s=r[t];if(e.indexFrom===s.indexFrom)return s.indexCount-=e.indexCount,s.indexFrom+=e.indexCount,0===s.indexCount&&te(r,t,1),t-1;if(e.indexFrom+e.indexCount===s.indexFrom+s.indexCount)return s.indexCount-=e.indexCount,0===s.indexCount?(te(r,t,1),t-1):t;var o=s.indexFrom,u=e.indexFrom-s.indexFrom,l=e.indexCount,c=s.indexFrom+s.indexCount-(e.indexFrom+e.indexCount);s.indexCount=u;var d=new ne;return d.geometryType=s.geometryType,d.materialKey=s.materialKey,d.indexFrom=o+u+l,d.indexCount=c,te(r,t+1,0,d),t}return null}},{key:"_getDisplayList",value:function(e,t){for(var r,i,n=this.symbolLevels.length,a=0;a<n;a++)if(this.symbolLevels[a].symbolLevel===e){r=this.symbolLevels[a];break}r||((r=new oe).symbolLevel=e,this.symbolLevels.push(r));for(var s=r.zLevels.length,o=0;o<s;o++)if(r.zLevels[o].zLevel===t){i=r.zLevels[o];break}return i||((i=new se).geometryDPInfo=new ae,i.zLevel=t,r.zLevels.push(i)),i.geometryDPInfo.unified||(i.geometryDPInfo.unified=[]),i.geometryDPInfo.unified}},{key:"getDPInfoType",value:function(){return"unified"}}]),e}(),ne=function(){function e(){d(this,e),this.materialKey=null,this.indexFrom=0,this.indexCount=0}return f(e,[{key:"clone",value:function(){var t=new e;return t.geometryType=this.geometryType,t.materialKey=this.materialKey,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t}}]),e}(),ae=function(){function e(){d(this,e),this.fill=null,this.line=null,this.marker=null,this.text=null,this.label=null,this.unified=null}return f(e,[{key:"clone",value:function(){var t=new e;return t.fill=this.fill&&this.fill.map((function(e){return e.clone()})),t.line=this.line&&this.line.map((function(e){return e.clone()})),t.marker=this.marker&&this.marker.map((function(e){return e.clone()})),t.text=this.text&&this.text.map((function(e){return e.clone()})),t.label=this.label&&this.label.map((function(e){return e.clone()})),t.unified=this.unified&&this.unified.map((function(e){return e.clone()})),t}}]),e}(),se=function(){function e(){d(this,e),this.geometryDPInfo=new ae}return f(e,[{key:"clone",value:function(){var t=new e;return t.zLevel=this.zLevel,t.geometryDPInfo=this.geometryDPInfo.clone(),t}}]),e}(),oe=function(){function e(){d(this,e),this.zLevels=[]}return f(e,[{key:"clone",value:function(){var t=new e;t.symbolLevel=this.symbolLevel;var r,i=o(this.zLevels);try{for(i.s();!(r=i.n()).done;){var n=r.value;t.zLevels.push(n.clone())}}catch(a){i.e(a)}finally{i.f()}return t}}]),e}(),ue=ie,le=function(){function e(){d(this,e)}return f(e,[{key:"displayObjectRegistry",get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;var e,t=o(this.displayObjects);try{for(t.s();!(e=t.n()).done;){var r=e.value;this._displayObjectRegistry.set(r.id,r)}}catch(i){t.e(i)}finally{t.f()}}return this._displayObjectRegistry}},{key:"displayList",get:function(){return this._displayList}},{key:"computeDisplayList",value:function(){this._displayList=new ue;var e,t=o(this.displayObjects);try{for(t.s();!(e=t.n()).done;){var r,i=o(e.value.displayRecords);try{for(i.s();!(r=i.n()).done;){var n=r.value;this._displayList.addToList(n)}}catch(a){i.e(a)}finally{i.f()}}}catch(a){t.e(a)}finally{t.f()}}},{key:"clone",value:function(){var t=new e;return this.displayObjects&&(t.displayObjects=this.displayObjects.map((function(e){return e.clone()}))),t}},{key:"serialize",value:function(e){return W(e,this.displayObjects),e}},{key:"_deserializeObjects",value:function(e){for(var t=e.readInt32(),r=new Array(t),i=new Map,n=0;n<r.length;++n){var a=$.deserialize(e);r[n]=a,i.set(a.id,a)}this.displayObjects=r,this._displayList=null,this._displayObjectRegistry=i}}],[{key:"deserialize",value:function(t){var r=new e;return r._deserializeObjects(t),r}}]),e}(),ce=function(){function e(t,r){d(this,e),this.data=t,this.stride=r}return f(e,null,[{key:"decode",value:function(t){return new e(Object(M.c)(t.data,t.stride),t.stride)}},{key:"fromVertexVector",value:function(t){return new e(Object(M.c)(t.data.buffer(),t.stride),t.stride)}}]),e}(),de=function(){function e(t,r,i){d(this,e),this.geometryType=t,this.indexBuffer=new Uint32Array(r),this.namedBuffers=i}return f(e,null,[{key:"decode",value:function(t){var r=t.geometryType,i=t.indexBuffer,n={};for(var a in t.namedBuffers)n[a]=ce.decode(t.namedBuffers[a]);return new e(r,i,n)}},{key:"fromVertexData",value:function(t,r){var i=t.indices,n=Object(M.c)(t.vertices,t.stride);return new e(r,i,{geometry:new ce(n,t.stride)})}},{key:"fromVertexVectors",value:function(t){var r=t.geometryType,i=t.indexVector.buffer(),n={};for(var a in t.namedVectors)n[a]=ce.fromVertexVector(t.namedVectors[a]);return new e(r,i,n)}}]),e}(),he=a("PeSW"),fe=function(){function e(t,r){d(this,e),this.data=t,this.stride=r}return f(e,[{key:"vertexCount",get:function(){var e=this.data.length/(this.stride/4);return e!==(0|e)&&console.debug("Corrupted stride"),e}},{key:"transfer",value:function(e,t){var r=this.data.buffer();e.vertexCount=this.vertexCount,e.data=r,e.stride=this.stride,t.push(r)}}]),e}(),ve=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];d(this,e),this.geometryType=t,this.indexVector=new he.a(Uint32Array,6*r),this.namedVectors={};var n=Object(M.l)(t,i);for(var a in n){var s=n[a],o=void 0;switch(s%4){case 0:case 2:o=new he.a(Uint32Array,s*r);break;case 1:case 3:o=new he.a(Uint8Array,s*r)}this.namedVectors[a]=new fe(o,s)}}return f(e,[{key:"get",value:function(e){return this.namedVectors[e].data}},{key:"getVector",value:function(e){return this.namedVectors[e]}},{key:"transfer",value:function(e,t){var r=this.indexVector.buffer(),i={};for(var n in t.push(r),this.namedVectors){var a=this.namedVectors[n];i[n]={},a.transfer(i[n],t)}e.geometryType=this.geometryType,e.indexBuffer=r,e.namedBuffers=i,this.destroy()}},{key:"intoBuffers",value:function(){var e=de.fromVertexVectors(this);return this.destroy(),e}},{key:"destroy",value:function(){this.indexVector=null,this.namedVectors=null}}]),e}(),ye=new X,pe=new X;function me(e,t){var r={};for(var i in e){var n={data:Object(M.b)(t,e[i]),stride:e[i]};r[i]=n}return r}var ge=function(){function e(){d(this,e),this.tileDisplayData=null,this.tileBufferData=null}return f(e,[{key:"reshuffle",value:function(){ye.reset();var t,r=function(e){var t,r=[[],[],[],[],[]],i=o(e);try{for(i.s();!(t=i.n()).done;){var n,a=o(t.value.displayRecords);try{for(a.s();!(n=a.n()).done;){var s=n.value;r[s.geometryType].push(s)}}catch(u){a.e(u)}finally{a.f()}}}catch(u){i.e(u)}finally{i.f()}return r}(this.tileDisplayData.displayObjects),i=o(r);try{for(i.s();!(t=i.n()).done;){var n,a=o(t.value);try{for(a.s();!(n=a.n()).done;){var s=n.value;s&&ye.needMore(s.geometryType,s.meshData?s.meshData.vertexCount:s.vertexCount,s.meshData?s.meshData.indexData.length:s.indexCount)}}catch(I){a.e(I)}finally{a.f()}}}catch(I){i.e(I)}finally{i.f()}for(var u=r.length,l=new Q,c=0;c<u;++c){l.geometries[c].indexBuffer=new Uint32Array(Math.round(1.5*ye.indicesFor(c)));var d=[];for(var h in this.tileBufferData.geometries[c].vertexBuffer)d.push(this.tileBufferData.geometries[c].vertexBuffer[h].stride);var f=e._computeVertexAlignment(d),v=Math.round(1.5*ye.verticesFor(c)),y=e._align(v,f);for(var p in this.tileBufferData.geometries[c].vertexBuffer){var m=this.tileBufferData.geometries[c].vertexBuffer[p].stride;l.geometries[c].vertexBuffer[p]={stride:m,data:Object(M.b)(y,m)}}}pe.reset(),this.tileDisplayData.displayList.clear();for(var g=0;g<u;++g){var b,x=o(r[g]);try{for(x.s();!(b=x.n()).done;){var _=b.value;if(_.meshData)_.writeMeshDataToBuffers(pe.verticesFor(g),l.geometries[g].vertexBuffer,pe.indicesFor(g),l.geometries[g].indexBuffer),_.meshData=null;else{var k=this.tileBufferData.geometries[g].vertexBuffer,O=this.tileBufferData.geometries[g].indexBuffer,w=l.geometries[g].vertexBuffer,j=l.geometries[g].indexBuffer,D=pe.verticesFor(g),T=pe.indicesFor(g);Object(M.d)(D,T,w,j,_,k,O),_.vertexFrom=D,_.indexFrom=T}pe.needMore(g,_.vertexCount,_.indexCount)}}catch(I){x.e(I)}finally{x.f()}}var R,B=o(this.tileDisplayData.displayObjects);try{for(B.s();!(R=B.n()).done;){var S=R.value;this.tileDisplayData.displayList.addToList(S.displayRecords)}}catch(I){B.e(I)}finally{B.f()}this.tileBufferData=l}},{key:"getStrides",value:function(){for(var e=[],t=0;t<this.tileBufferData.geometries.length;++t){var r=this.tileBufferData.geometries[t];for(var i in e[t]={},r.vertexBuffer)e[t][i]=r.vertexBuffer[i].stride}return e}},{key:"clone",value:function(){var t=new e;return t.tileBufferData=this.tileBufferData.clone(),t.tileDisplayData=this.tileDisplayData.clone(),t}},{key:"_guessSize",value:function(){for(var e=this.tileDisplayData.displayObjects,t=Math.min(e.length,4),r=0,i=0;i<t;i++)r=Math.max(r,e[i].displayRecords.length);return 2*(12*e.length+e.length*r*40)}},{key:"serialize",value:function(){var e=this.tileBufferData.serialize(),t=this.tileBufferData.getBuffers(),r=this.tileDisplayData.serialize(new he.a(Int32Array,this._guessSize())).buffer();return t.push(r),{result:{displayData:r,bufferData:e},transferList:t}}}],[{key:"fromVertexData",value:function(t){var r=[],i={},n=new Map;return Object(M.g)((function(e){var a=t.data[e];if(Object(h.k)(a)){for(var s=Z.a.from(a.records).getCursor();s.next();){var o=s.id,u=s.materialKey,l=s.insertAfter,c=s.indexFrom,d=s.indexCount,f=s.vertexFrom,v=s.vertexCount;if(!n.has(o)){var y=new $(o);y.insertAfter=l,n.set(o,y),r.push(y)}var p=n.get(o),m=new J(o,e,u);m.indexFrom=c,m.indexCount=d,m.vertexFrom=f,m.vertexCount=v,p.displayRecords.push(m)}i[e]=de.fromVertexData(a,e)}else i[e]=new ve(e,0).intoBuffers()})),r.sort((function(e,t){return e.id-t.id})),e.fromMeshData({displayObjects:r,vertexBuffersMap:i})}},{key:"fromMeshData",value:function(t){var r=new e,i=new le,n=new Q;for(var a in i.displayObjects=t.displayObjects,t.vertexBuffersMap){var s=t.vertexBuffersMap[a];n.geometries[a].indexBuffer=s.indexBuffer,n.geometries[a].vertexBuffer=s.namedBuffers}return r.tileDisplayData=i,r.tileBufferData=n,r}},{key:"bind",value:function(t,r){var i=new e;return i.tileDisplayData=t,i.tileBufferData=r,i}},{key:"create",value:function(t,r){var i=new e;i.tileDisplayData=new le,i.tileDisplayData.displayObjects=t;var n,a=[0,0,0,0,0],s=[0,0,0,0,0],u=[[],[],[],[],[]],l=o(t);try{for(l.s();!(n=l.n()).done;){var c,d=o(n.value.displayRecords);try{for(d.s();!(c=d.n()).done;){var h=c.value;u[h.geometryType].push(h),a[h.geometryType]+=h.meshData.vertexCount,s[h.geometryType]+=h.meshData.indexData.length}}catch(g){d.e(g)}finally{d.f()}}}catch(g){l.e(g)}finally{l.f()}for(var f=new Q,v=function(e){return[e.fill||{},e.line||{},e.icon||{},e.text||{},e.label||{}]}(r),y=0;y<5;y++){var p=new Uint32Array(s[y]),m=me(v[y],a[y]);J.writeAllMeshDataToBuffers(u[y],m,p),f.geometries[y]={indexBuffer:p,vertexBuffer:m}}return i.tileBufferData=f,i}},{key:"_align",value:function(e,t){var r=e%t;return 0===r?e:e+(t-r)}},{key:"_computeVertexAlignment",value:function(e){var t,r=!1,i=!1,n=o(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;a%4==2?r=!0:a%4!=0&&(i=!0)}}catch(s){n.e(s)}finally{n.f()}return i?4:r?2:1}}]),e}(),be=a("2AbE"),xe=a("acOm"),_e=a("M08Z"),ke=a("owVx"),Oe=a("Bcjy"),we=a("Dw8i"),je=a("J3nV"),De=a("Swtj"),Te=a("ZlUD"),Re=a("8NDJ"),Be=function(e){v(r,e);var t=p(r);function r(e,i){return d(this,r),t.call(this,e,i,null)}return f(r,[{key:"geometryType",get:function(){var e=this._current;return e?e.geometryType:null}},{key:"insertAfter",get:function(){return this._current.insertAfter}},{key:"readGraphic",value:function(){return this._current}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var e=new r(this.instance,this._features);return this.copyInto(e),e}}],[{key:"from",value:function(e){var t,i=Re.a.createInstance(),n=[],a=o(e.filter((function(e){return!!e.geometry})));try{for(a.s();!(t=a.n()).done;){var s=t.value,u=Object(D.c)(s.geometry);Object(Te.e)(n,[s],u,!1,!1,"uid")}}catch(l){a.e(l)}finally{a.f()}return new r(i,n)}}]),r}(a("Q0oN").a),Se=a("w5u1"),Ie=a("IXLn"),Ce=a("+NQI"),Fe=a("gEht"),ze=a("9w8m"),Le=a("qNUd"),Ae=a("kB+0"),Me=a("V+VG"),Ve=a("gVKr"),Pe=a("AIxD"),Ge=new Ve.a,Ue=new Ve.a;function Ee(e){e.coords.length=0,e.lengths.length=0}var qe=function(){function e(){d(this,e),this.bounds=Object(R.g)(),this.graphic=null,this.size=[0,0,0,0]}return f(e,[{key:"acquire",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;e&&this.set(e,t,r,i,n,a)}},{key:"release",value:function(){this.graphic=null,this.symbolResource=null,this.geometry=null}},{key:"symbol",get:function(){return this.symbolResource.symbol}},{key:"set",value:function(e,t,r,i,n,a){this.graphic=e,this.geometry=r,this.symbolResource=t,this.updateBounds(i,n,a)}},{key:"updateBounds",value:function(e,t,r){Object(_e.c)(this.bounds,this.size,this.symbolResource,this.geometry,e,t,r)}},{key:"getGeometryQuantized",value:function(e){if(Object(D.g)(this.geometry)){var t=this.geometry.rings;if(1===t.length&&2===t[0].length)return Object(Pe.a)(e,{paths:[[t[0][0],t[0][1]]]})}else if(Object(D.h)(this.geometry))return Ee(Ge),Ee(Ue),Object(Te.h)(Ge,this.geometry),Object(Te.q)(Ue,Ge,this.geometry.hasZ,this.geometry.hasM,"esriGeometryPolyline",e.scale[0]),Object(Te.u)(Ge,Ue,this.geometry.hasZ,this.geometry.hasM,"esriGeometryPolyline",e),Object(Te.o)(Ge,this.geometry.hasZ,this.geometry.hasM);return Object(Pe.a)(e,this.geometry)}}],[{key:"acquire",value:function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;return 0===e._pool.length?t=new e:(t=e._pool.pop(),this._set.delete(t)),t.acquire(r,i,n,a,s,o),t}},{key:"release",value:function(e){e&&!this._set.has(e)&&(e.release(),this._pool.push(e),this._set.add(e))}},{key:"getCentroidQuantized",value:function(e,t){if(Object(D.g)(e.geometry)){var r=e.symbol;if(Object(h.j)(r))return null;if(Object(_e.j)(r.type)||Object(_e.l)(r.type)){var i=Object(Me.a)(e.geometry);return Object(Pe.b)(t,{},{x:i[0],y:i[1]},!1,!1)}}return null}}]),e}();qe._pool=[],qe._set=new Set;var Ke=qe,He={minX:0,minY:0,maxX:0,maxY:0},Ne=Object(R.g)(),Ze=[];function Xe(e,t,r,i,n){return He.minX=t,He.minY=r,He.maxX=i,He.maxY=n,e.search(He)}var Qe=a("pdg3");function Ye(e,t,r){if(r.has(e))return r.get(e);var i={tile:t,addedOrModified:[],removed:[]};return r.set(e,i),i}var Je,We,$e=function(e){v(P,e);var i,a,s,l,y,m,b,_,S,M,V=p(P);function P(e){var t;return d(this,P),(t=V.call(this,e))._storage=new De.a,t._displayIds=new Map,t._tiles=new Map,t._graphicStoreUpdate=!1,t._graphicsSet=new Set,t._matcher=Promise.resolve(null),t._tileUpdateSet=new Set,t._tilesToUpdate=new Map,t._graphicIdToAbortController=new Map,t._attached=!1,t._highlightIds=new Map,t._updatingGraphicsTimer=null,t._hashToExpandedSymbol=new Map,t._hashTpExpandedSymbolPromise=new Map,t._processing=!1,t._needsProcessing=!1,t._pendingUpdate={added:new Set,updated:new Set,removed:new Set},t.lastUpdateId=-1,t.updateRequested=!1,t.graphicUpdateHandler=t.graphicUpdateHandler.bind(g(t)),t}return f(P,[{key:"_createMatcher",value:function(e,t){if(e){var r=Object(ke.a)({indexCount:0,fields:{}},"feature",e);this._matcher=Object(Oe.a)(r,t,null)}}},{key:"_createDisplayId",value:function(e){return this._displayIds.has(e)||this._displayIds.set(e,this._storage.createDisplayId()),this._displayIds.get(e)}},{key:"initialize",value:function(){var e=this;this._tileStore=new Se.a(this.view.featuresTilingScheme),this._attributeStore=new be.a({type:"local",initialize:function(t){return Promise.resolve(e.container.attributeView.initialize(t))},update:function(t){return e.container.attributeView.requestUpdate(t)},render:function(){return e.container.requestRender()}},Object(C.a)()),this._graphicStore=new(function(){function e(t,r,i,n,a,s){d(this,e),this._graphics=n,this._onAdd=a,this._onRemove=s,this._index=Object(Ae.a)(9,Object(c.a)("csp-restrictions")?function(e){return{minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this._itemByGraphic=new Map,this._currentLevel=-1/0,this._tileInfoView=t,this._uidFieldName=i;var o=t.getClosestInfoForScale(r);o&&(this._currentLevel=o.level,this._resolution=this._tileInfoView.getTileResolution(o.level));var u=t.spatialReference;this._metersPerUnit=Object(k.i)(u)?Object(Fe.e)(t.spatialReference):1}return f(e,[{key:"hitTest",value:function(e,t,r,i,n){e=Object(Le.b)(e,this._tileInfoView.spatialReference);var a=.5*i*r;Ne[0]=e-a,Ne[1]=t-a,Ne[2]=e+a,Ne[3]=t+a;var s=.5*i*(r+_e.a),u=Xe(this._index,e-s,t-s,e+s,t+s);if(!u||0===u.length)return[];var l,c,d={x:e,y:t},h=[],f=o(u);try{for(f.s();!(c=f.n()).done;){var v=c.value;if(v.graphic.visible)switch(Object(D.c)(v.geometry)){case"esriGeometryPoint":var y=v.symbol;if(!y)continue;var p=v.geometry,m=p.x,g=p.y,b=i*this._metersPerUnit,x=void 0;switch(y.type){case"esriTS":x=Object(_e.f)(m,g,y,v.size,i,n);break;case"expanded-cim":x=Object(_e.d)(m,g,y,i,b,n);break;case"esriSMS":case"esriPMS":x=Object(_e.e)(m,g,y,i,b,n)}Object(Ie.g)(x,d)&&h.push(v);break;case"esriGeometryPolyline":var _=v.symbol;if(!_||!_.layers.length)continue;var k=_.layers[0];l=1.5*i*window.devicePixelRatio*Object(T.h)(k.width),Object(_e.k)(v.geometry,e,t,l)&&h.push(v);break;case"esriGeometryEnvelope":var O=v.geometry,w=Object(R.l)(O.xmin,O.ymin,O.xmax,O.ymax);Object(R.n)(w,Ne)&&h.push(v);break;case"esriGeometryPolygon":if(Object(Ie.g)(v.geometry,d)){h.push(v);break}var j=Object(Ce.b)(v.geometry);if(Math.abs(j.ymax-j.ymin)<5*i||Math.abs(j.xmax-j.xmin)<5*i){var B=Object(R.l)(j.xmin,j.ymin,j.xmax,j.ymax);Object(R.n)(B,Ne)&&h.push(v)}break;case"esriGeometryMultipoint":var S=v.symbol;if(!S)continue;for(var I=v.geometry.points,C=void 0,F=0;F<I.length;F++)if(C="esriTS"===S.type?Object(_e.f)(I[F][0],I[F][1],S,v.size,i,n):Object(_e.e)(I[F][0],I[F][1],S,i,i*this._metersPerUnit,n),Object(Ie.g)(C,d)){h.push(v);break}}}}catch(z){f.e(z)}finally{f.f()}return h.sort((function(e,t){var r=Object(_e.h)(e.graphic),i=Object(_e.h)(t.graphic);return r===i?t.zorder-e.zorder:r-i})),h.map((function(e){return e.graphic}))}},{key:"getGraphicsData",value:function(e,t,r){var i=this._searchForItems(t);if(0===i.length||0===r.length)return[];i.sort((function(e,t){return e.zorder-t.zorder})),i[0].insertAfter=-1;for(var a=1;a<i.length;a++)i[a].insertAfter=i[a-1].graphic.uid;i.sort((function(e,t){return e.graphic.uid-t.graphic.uid})),r.sort((function(e,t){return e.uid-t.uid}));var s,u,l=0,c=0,d=[],h={originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[t.bounds[0],t.bounds[3]]},f=o(r);try{for(f.s();!(u=f.n()).done;){var v=u.value;for(c=-2;l<i.length;)if(s=i[l],l++,v.uid===s.graphic.uid){c=s.insertAfter;break}if(s.geometry&&-2!==c){var y=s.getGeometryQuantized(h),p=n({},s.graphic.attributes);p[this._uidFieldName]=v.uid,null==s.groupId&&(s.groupId=e.createTemplateGroup(s.symbol,null)),d.push({centroid:Ke.getCentroidQuantized(s,h),geometry:y,attributes:p,symbol:s.symbol,groupId:s.groupId,insertAfter:c,zorder:s.zorder})}}}catch(m){f.e(m)}finally{f.f()}return d.sort((function(e,t){return e.zorder-t.zorder})),d}},{key:"queryTileData",value:function(e,t){var r=t.bounds,i=t.resolution,n=this._searchForItems(t),a=[];return this._createTileGraphics(a,e,n,{originPosition:"upperLeft",scale:[i,i],translate:[r[0],r[3]]}),a}},{key:"has",value:function(e){return this._itemByGraphic.has(e)}},{key:"getBounds",value:function(e){return this._itemByGraphic.has(e)?this._itemByGraphic.get(e).bounds:null}},{key:"addOrModify",value:function(e,t,r){if(e){this.has(e)&&this.remove(e),this._onAdd(e);var i=Ke.acquire(e,t,r,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference);return this._itemByGraphic.set(e,i),r&&this._index.insert(i),i.bounds}}},{key:"remove",value:function(e){if(this._itemByGraphic.has(e)){this._onRemove(e);var t=this._itemByGraphic.get(e);this._index.remove(t),this._itemByGraphic.delete(e)}}},{key:"updateZ",value:function(){for(var e,t,r=this._graphics.items,i=0;i<r.length;i++)t=r[i],(e=this._itemByGraphic.get(t))&&(e.zorder=i)}},{key:"update",value:function(e,t,r){var i=this._itemByGraphic.get(e);i.groupId=null;var n=Object(R.c)(i.bounds);return i.size[0]=i.size[1]=0,this._index.remove(i),i.set(e,t,r,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference),r&&this._index.insert(i),{oldBounds:n,newBounds:i.bounds}}},{key:"updateLevel",value:function(e){var t=this;if(this._currentLevel!==e){this._currentLevel=e;var r=this._tileInfoView.getTileResolution(e);this._resolution=r,this._index.clear(),Ze.length=0,this._itemByGraphic.forEach((function(e){e.updateBounds(t._resolution,t._resolution*t._metersPerUnit,t._tileInfoView.spatialReference),e.geometry&&Ze.push(e)})),this._index.load(Ze)}}},{key:"clear",value:function(){this._itemByGraphic.clear(),this._index.clear()}},{key:"_createTileGraphics",value:function(e,t,r,i){var a,s,o,u,l=this._uidFieldName;r.sort((function(e,t){return e.zorder-t.zorder}));for(var c=0;c<r.length;c++){a=(o=r[c]).graphic,s=o.getGeometryQuantized(i),u=0===c?-1:r[c-1].graphic.uid;var d=n({},o.graphic.attributes);d[l]=a.uid,null==o.groupId&&(o.groupId=t.createTemplateGroup(o.symbol,null)),e.push({centroid:Ke.getCentroidQuantized(o,i),geometry:s,attributes:d,symbol:o.symbol,groupId:o.groupId,insertAfter:u,zorder:o.zorder})}}},{key:"_searchForItems",value:function(e){var t=this._tileInfoView.spatialReference,i=e.bounds;if(t.isWrappable){var n=u(Object(ze.c)(t),2),a=n[0],s=n[1],o=Math.abs(i[2]-s)<1e-5,l=Math.abs(i[0]-a)<1e-5;if((!o||!l)&&(o||l)){var c,d=e.resolution;c=Object(R.g)(o?[a,i[1],a+d*_e.a,i[3]]:[s-d*_e.a,i[1],s,i[3]]);var h=Xe(this._index,i[0],i[1],i[2],i[3]),f=Xe(this._index,c[0],c[1],c[2],c[3]);return r(new Set([].concat(r(h),r(f))))}}return Xe(this._index,i[0],i[1],i[2],i[3])}}]),e}())(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,(function(t){e._createDisplayId(t.uid),e._setFilterState(t.uid,t.visible)}),(function(t){var r=e._displayIds.get(t.uid);e._displayIds.delete(t.uid),e._storage.releaseDisplayId(r)}));var t=new we.a(this.container.getMaterialItems.bind(this.container),!0);this._createMatcher(this.renderer,t),this._meshFactory=new je.a(null,this.uid,t),this._templateStore=t,this.watch("renderer",(function(r){e._createMatcher(r,t);var i,n=o(e.graphics);try{for(n.s();!(i=n.n()).done;){var a=i.value;e._pendingUpdate.updated.add(a)}}catch(s){n.e(s)}finally{n.f()}e.requestUpdate()})),this._tileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",(function(){e.graphics.items.length>0&&e._graphicsChangeHandler({target:e.graphics,added:e.graphics.items,removed:[],moved:[]}),e.handles.add(e.graphics.on("change",(function(t){return e._graphicsChangeHandler(t)})),"graphics"),e._attached=!0,e.notifyChange("updating")}))}},{key:"destroy",value:function(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating")),this.container.destroy(),this._set("graphics",null),this._graphicStore.clear(),this._tileStore.destroy(),this._attributeStore=null,this._hashToExpandedSymbol.clear(),this.view=null,this.renderer=null}},{key:"updating",get:function(){return!this._attached||null!==this._updatingGraphicsTimer||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0}},{key:"hitTest",value:function(e,t){if(!this.view||!this.view.position)return Promise.resolve(null);var r=this.view.toMap(Object(T.f)(e,t));return this.searchFeatures(r).then((function(e){return e&&e.length?e[0]:null}))}},{key:"searchFeatures",value:(M=t(regeneratorRuntime.mark((function e(t){var r,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:2,e.abrupt("return",this._graphicStore.hitTest(t.x,t.y,r,this.view.state.resolution,this.view.state.rotation));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"update",value:function(e){var t=e.state,r=this.view.featuresTilingScheme.getClosestInfoForScale(t.scale).level;if(this._graphicStore.updateLevel(r),this._tileStore.setViewState(t),this._graphicStoreUpdate=!0,this.updateRequested=!1,this._pendingUpdate.updated.size>0){if(!this._processing)return void this._updateGraphics();this._needsProcessing=!0}}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback())}},{key:"processUpdate",value:function(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}},{key:"graphicUpdateHandler",value:function(e){var t=e.graphic,r=e.property,i=e.newValue;switch(r){case"attributes":break;case"geometry":case"symbol":this._pendingUpdate.updated.add(t),this.requestUpdate();break;case"visible":this._setFilterState(t.uid,i),this._attributeStore.sendUpdates()}}},{key:"addHighlight",value:function(e){var t,r=o(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(this._highlightIds.has(i)){var n=this._highlightIds.get(i);this._highlightIds.set(i,n+1)}else this._highlightIds.set(i,1)}}catch(a){r.e(a)}finally{r.f()}this._updateHighlight()}},{key:"removeHighlight",value:function(e){var t,r=o(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(this._highlightIds.has(i)){var n=this._highlightIds.get(i)-1;0===n?this._highlightIds.delete(i):this._highlightIds.set(i,n)}}}catch(a){r.e(a)}finally{r.f()}this._updateHighlight()}},{key:"_updateHighlight",value:function(){var e=this,t=Array.from(this._highlightIds.keys()),r=t.map((function(t){return e._displayIds.get(t)}));this._attributeStore.setHighlight(t,r)}},{key:"_getIntersectingTiles",value:function(e){var t=this._graphicStore.getBounds(e);if(!t||0===Object(R.q)(t)||0===Object(R.m)(t))return[];var i=Object(_e.i)(t,this.view.spatialReference);return Object(h.k)(i)?[].concat(r(this._tileStore.boundsIntersections(i[0])),r(this._tileStore.boundsIntersections(i[1]))):this._tileStore.boundsIntersections(t)}},{key:"_updateTile",value:(S=t(regeneratorRuntime.mark((function e(t){var r,i,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.tile,i=this._getGraphicsData(this._templateStore,r,t.addedOrModified),e.next=4,this._processGraphics(r,i);case 4:return n=e.sent,e.abrupt("return",(this._patchTile(r.key,{type:"update",addOrUpdate:n,remove:t.removed,end:!0,clear:!1}),n));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"_patchTile",value:function(e,t){if(this._tiles.has(e)){var r=this._tiles.get(e);this.container.onTileData(r,t),this.container.requestRender()}}},{key:"_graphicsChangeHandler",value:function(e){var t,r=o(e.added);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._pendingUpdate.added.add(i)}}catch(d){r.e(d)}finally{r.f()}var n,a=o(e.moved);try{for(a.s();!(n=a.n()).done;){var s=n.value;this._pendingUpdate.added.add(s)}}catch(d){a.e(d)}finally{a.f()}var u,l=o(e.removed);try{for(l.s();!(u=l.n()).done;){var c=u.value;this._pendingUpdate.added.has(c)?this._pendingUpdate.added.delete(c):this._pendingUpdate.removed.add(c)}}catch(d){l.e(d)}finally{l.f()}this._processing?this._needsProcessing=!0:this._updateGraphics()}},{key:"_getGraphicsToUpdate",value:function(){var e={added:[],removed:[],updated:[]};if(!this.graphics)return e;var t,r=this._pendingUpdate,i=o(this.graphics.items);try{for(i.s();!(t=i.n()).done;){var n=t.value;r.added.has(n)?e.added.push(n):r.updated.has(n)&&e.updated.push(n)}}catch(l){i.e(l)}finally{i.f()}var a,s=o(r.removed);try{for(s.s();!(a=s.n()).done;){var u=a.value;this._graphicStore.has(u)&&e.removed.push(u)}}catch(l){s.e(l)}finally{s.f()}return r.added.clear(),r.removed.clear(),r.updated.clear(),e}},{key:"_updateGraphics",value:(_=t(regeneratorRuntime.mark((function e(){var t,r,i,n,a,s,l,c,d,h,f,v,y,p,m,g,b,x,_,k,O,w,j,D,T,R,B,S,I,C,F,z,L,A,M,V,P,G,U,E;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this._processing=!0,t=this._getGraphicsToUpdate(),r=t.added,i=t.removed,n=t.updated,a=this._tilesToUpdate,e.prev=2,this._graphicStoreUpdate||(s=this.view.state,l=this.view.featuresTilingScheme.getClosestInfoForScale(s.scale).level,this._graphicStore.updateLevel(l),this._tileStore.setViewState(s)),c=[],d=new Array(r.length+i.length),h=0;h<n.length;h++){f=n[h],v=this._getIntersectingTiles(f),y=o(v);try{for(y.s();!(p=y.n()).done;)Ye((m=p.value).id,m,a).removed.push(this._displayIds.get(f.uid))}catch(q){y.e(q)}finally{y.f()}c.push(this._updateGraphic(f,null)),d[h]=f}for(g=n.length,b=0;b<r.length;b++)x=r[b],d[g+b]=x,this._graphicsSet.add(x),c.push(this._addGraphic(x));_=o(i);try{for(_.s();!(k=_.n()).done;){O=k.value,this._abortProcessingGraphic(O.uid),w=this._getIntersectingTiles(O),j=o(w);try{for(j.s();!(D=j.n()).done;)Ye((T=D.value).id,T,a).removed.push(this._displayIds.get(O.uid))}catch(q){j.e(q)}finally{j.f()}this._graphicsSet.delete(O),this._graphicStore.remove(O)}}catch(q){_.e(q)}finally{_.f()}return this._flipUpdatingGraphics(),e.next=13,Promise.all(c);case 13:for(B=0;B<d.length;B++){R=d[B],S=this._getIntersectingTiles(R),I=o(S);try{for(I.s();!(C=I.n()).done;)Ye((F=C.value).id,F,a).addedOrModified.push(R)}catch(q){I.e(q)}finally{I.f()}}this._graphicStore.updateZ(),z=[],L=o(a);try{for(L.s();!(A=L.n()).done;)(M=u(A.value,2))[0],V=M[1],z.push(this._updateTile(V))}catch(q){L.e(q)}finally{L.f()}return e.next=20,Promise.all(z);case 20:e.next=24;break;case 22:e.prev=22,e.t0=e.catch(2);case 24:P=o(i),e.prev=25,P.s();case 27:if((G=P.n()).done){e.next=35;break}return U=G.value,e.next=31,this._getSymbolForGraphic(U,{});case 31:(E=e.sent)&&this._hashToExpandedSymbol.delete(E.hash());case 33:e.next=27;break;case 35:e.next=40;break;case 37:e.prev=37,e.t1=e.catch(25),P.e(e.t1);case 40:return e.prev=40,P.f(),e.finish(40);case 43:a.clear(),this.notifyChange("updating"),this._processing=!1,this._needsProcessing&&(this._needsProcessing=!1,this._updateGraphics());case 44:case"end":return e.stop()}}),e,this,[[2,22],[25,37,40,43]])}))),function(){return _.apply(this,arguments)})},{key:"_getArcadeInfo",value:function(e){var t=(e.attributes?Object.keys(e.attributes):[]).map((function(t){return{name:t,alias:t,type:"string"==typeof e.attributes[t]?"esriFieldTypeString":"esriFieldTypeDouble"}}));return Object(h.j)(e.geometry)?null:{geometryType:Object(D.c)(e.geometry),spatialReference:O.a.fromJSON(e.geometry.spatialReference),fields:t}}},{key:"_getSymbolForGraphic",value:(b=t(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(h.k)(t.symbol)?t.symbol:Object(h.k)(this.renderer)?this.renderer.getSymbolAsync(t,{scale:this.view.scale,abortOptions:r}):this._getNullSymbol(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"_getSymbolResources",value:(m=t(regeneratorRuntime.mark((function e(t,r){var i,n,a,s,o,l,c,d,h,f,v,y,p,m,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.container.stage){e.next=2;break}return e.abrupt("return",Promise.resolve(null));case 2:return e.next=4,this._getSymbolForGraphic(t,r);case 4:if(i=e.sent,n=i.hash(),a=this._hashToExpandedSymbol.get(n)){e.next=28;break}if(!(s=this._hashTpExpandedSymbolPromise.get(n))){e.next=15;break}return e.next=12,s;case 12:a=e.sent,e.next=28;break;case 15:return o=this._getArcadeInfo(t),l=Object(ke.c)(i),s=Object(L.a)(l,o,r),this._hashTpExpandedSymbolPromise.set(n,s),e.prev=17,e.next=20,s;case 20:a=e.sent,this._hashTpExpandedSymbolPromise.delete(n),this._hashToExpandedSymbol.set(n,a),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(17),this._hashTpExpandedSymbolPromise.delete(n),Object(x.u)(e.t0);case 28:if("esriTS"!==a.type){e.next=38;break}for(c=[],d=Object(z.a)(a.text),h=u(d,1),f=h[0],v=0;v<f.length;v++)c.push(f.charCodeAt(v));return y={symbol:a,id:0,glyphIds:c},e.next=34,this.container.getMaterialItems([y]);case 34:return p=e.sent,m=u(p,1),g=m[0].mosaicItem,e.abrupt("return",{symbol:a,mosaicItem:g});case 38:return e.abrupt("return",{symbol:a,mosaicItem:null});case 39:case"end":return e.stop()}}),e,this,[[17,25]])}))),function(e,t){return m.apply(this,arguments)})},{key:"_projectAndNormalizeGeometry",value:(y=t(regeneratorRuntime.mark((function e(t,r){var i,n,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(h.j)(t.geometry)&&"mesh"!==t.geometry.type){e.next=2;break}return e.abrupt("return",Promise.resolve(null));case 2:if(i=t.geometry,!Object(D.g)(i)){e.next=7;break}i.rings=i.rings,e.next=16;break;case 7:if(!Object(D.h)(i)){e.next=11;break}i.paths=i.paths,e.next=16;break;case 11:if(!Object(D.d)(i)){e.next=16;break}return e.next=14,this._getSymbolForGraphic(t,r);case 14:n=e.sent,i=Object(_e.j)(n.type)||Object(_e.l)(n.type)?i.center:j.a.fromExtent(i);case 16:return e.next=18,Object(A.a)(i.spatialReference,this.view.spatialReference);case 18:return a=Object(F.a)(i),s=Object(A.b)(a,i.spatialReference,this.view.spatialReference),e.abrupt("return",(Object(w.a)(s),s));case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"_onTileUpdate",value:function(e){var t=Object(k.d)(this.view.spatialReference);if(e.added&&e.added.length>0){var r,i=o(e.added);try{for(i.s();!(r=i.n()).done;){var n=r.value;this._addNewTile(n,t)}}catch(l){i.e(l)}finally{i.f()}}if(e.removed&&e.removed.length>0){var a,s=o(e.removed);try{for(s.s();!(a=s.n()).done;){var u=a.value;this._removeTile(u.key)}}catch(l){s.e(l)}finally{s.f()}}}},{key:"_addGraphic",value:(l=t(regeneratorRuntime.mark((function e(t){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._abortProcessingGraphic(t.uid),r=Object(x.d)(),this._graphicIdToAbortController.set(t.uid,r),i={signal:r.signal},e.prev=4,e.next=7,this._addOrUpdateGraphic(t,i);case 7:this._graphicIdToAbortController.delete(t.uid),e.next=14;break;case 10:if(e.prev=10,e.t0=e.catch(4),this._graphicIdToAbortController.delete(t.uid),Object(x.m)(e.t0)){e.next=14;break}throw e.t0;case 14:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(e){return l.apply(this,arguments)})},{key:"_updateGraphic",value:(s=t(regeneratorRuntime.mark((function e(t,r){var i,n,a,s,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._projectAndNormalizeGeometry(t,r),n=this._getSymbolResources(t,r),e.next=4,Promise.all([i,n]);case 4:a=e.sent,s=u(a,2),o=s[0],l=s[1],this._graphicStore.addOrModify(t,l,o);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"_addOrUpdateGraphic",value:(a=t(regeneratorRuntime.mark((function e(t,r){var i,n,a,s,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._projectAndNormalizeGeometry(t,r),n=this._getSymbolResources(t,r),e.prev=1,e.next=4,Promise.all([i,n]);case 4:a=e.sent,s=u(a,2),o=s[0],l=s[1],this._addProjectedGraphic(t,l,o),e.next=15;break;case 11:if(e.prev=11,e.t0=e.catch(1),Object(x.m)(e.t0)){e.next=15;break}throw e.t0;case 15:case"end":return e.stop()}}),e,this,[[1,11]])}))),function(e,t){return a.apply(this,arguments)})},{key:"_addProjectedGraphic",value:function(e,t,r){this._graphicsSet.has(e)&&this._graphicStore.addOrModify(e,t,r)}},{key:"_addTile",value:function(e){var t=this.view.featuresTilingScheme.getTileBounds(Object(R.g)(),e),r=new N(e,t);return this._tiles.set(e,r),this.container.addChild(r),r}},{key:"_addNewTile",value:function(e,t){var r=this,i=this._addTile(e.key),n=this._graphicStore.queryTileData(this._templateStore,e);if(t){var a,s=Math.round((t.valid[1]-t.valid[0])/e.resolution),u=o(n);try{for(u.s();!(a=u.n()).done;){var l=a.value;l.geometry&&(Object(D.f)(l.geometry)||Object(D.e)(l.geometry))&&this._wrapPoints(l,s)}}catch(d){u.e(d)}finally{u.f()}}var c=e.key;this._tileUpdateSet.add(e.key),this.notifyChange("updating"),this._processGraphics(e,n).then((function(e){i.patch({type:"update",clear:!1,addOrUpdate:e,remove:[],end:!0}),r._tileUpdateSet.delete(c),r.notifyChange("updating")})).catch((function(e){if(r._tileUpdateSet.delete(c),r.notifyChange("updating"),!Object(x.m)(e))throw e}))}},{key:"_removeTile",value:function(e){if(this._tiles.has(e)){var t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}}},{key:"_setFilterState",value:function(e,t){var r=this._displayIds.get(e),i=this._attributeStore.getHighlightFlag(e);this._attributeStore.setData(r,0,0,i|(t?I.i:0))}},{key:"_getGraphicsData",value:function(e,t,r){var i=Object(k.d)(this.view.spatialReference),n=this._graphicStore.getGraphicsData(e,t,r);if(i){var a,s=Math.round((i.valid[1]-i.valid[0])/t.resolution),u=o(n);try{for(u.s();!(a=u.n()).done;){var l=a.value;l.geometry&&(Object(D.f)(l.geometry)||Object(D.e)(l.geometry))&&this._wrapPoints(l,s)}}catch(c){u.e(c)}finally{u.f()}}return n}},{key:"_wrapPoints",value:function(e,t){var r=e.geometry;Object(D.e)(r)?this._wrapMultipoint(r,t):this._wrapPoint(e,t)}},{key:"_wrapMultipoint",value:function(e,t){var r,i=[],n=0,a=0,s=o(e.points);try{for(s.s();!(r=s.n()).done;){var l=u(r.value,2),c=l[0],d=l[1];if(i.push([c+n,d]),n=0,t===_e.b){var h=5*_e.a;c+a<h?(i.push([t,0]),n=-t):c+a>_e.b-h&&(i.push([-t,0]),n=t)}else c+a<-_e.a?(i.push([t,0]),n=-t):c+a>_e.b+_e.a&&(i.push([-t,0]),n=t);a+=c}}catch(f){s.e(f)}finally{s.f()}e.points=i}},{key:"_wrapPoint",value:function(e,t){var r=e.geometry;if(t===_e.b){var i=5*_e.a;r.x<i?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>_e.b-i&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}else r.x<-_e.a?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>_e.b+_e.a&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}},{key:"_processGraphics",value:(i=t(regeneratorRuntime.mark((function e(t,r,i){var n,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&r.length&&this._meshFactory){e.next=2;break}return e.abrupt("return",null);case 2:return n=Be.from(r),a=this._meshFactory,e.next=6,this._matcher;case 6:return s=e.sent,e.next=9,a.analyzeGraphics(n,s,null,null,i);case 9:return this._attributeStore.sendUpdates(),e.abrupt("return",this._processAnalyzedGraphics(t,n));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return i.apply(this,arguments)})},{key:"_processAnalyzedGraphics",value:function(e,t){for(var r=this._meshFactory,i=t.getApproximateSize(),n=t.getCursor(),a=new xe.a(e.key.id,{features:i,records:i,metrics:0},!1,!1,!1);n.next();){var s=n.readGraphic();s.insertAfter=-1===s.insertAfter?-1:this._displayIds.get(s.insertAfter),s.displayId=this._displayIds.get(s.attributes[this.uid]),r.writeGraphic(a,n)}var o=a.serialize(e.tileInfoView.tileInfo.isWrappable);return 1!==o.length?new ge:ge.fromVertexData(o[0].message)}},{key:"_abortProcessingGraphic",value:function(e){this._graphicIdToAbortController.has(e)&&this._graphicIdToAbortController.get(e).abort()}},{key:"_getNullSymbol",value:function(e){var t=e.geometry;return Object(D.h)(t)?B.d:Object(D.g)(t)||Object(D.d)(t)?B.c:B.b}},{key:"_flipUpdatingGraphics",value:function(){var e=this;this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=setTimeout((function(){e._updatingGraphicsTimer=null,e.notifyChange("updating")}),160),this.notifyChange("updating")}}]),P}((Je=Object(S.b)(_.a),We=function(e){v(r,e);var t=p(r);function r(){var e;return d(this,r),(e=t.apply(this,arguments)).graphics=null,e.renderer=null,e.view=null,e}return r}(Object(Qe.a)(Je)),Object(l.a)([Object(y.b)()],We.prototype,"graphics",void 0),Object(l.a)([Object(y.b)()],We.prototype,"renderer",void 0),Object(l.a)([Object(y.b)()],We.prototype,"updating",void 0),Object(l.a)([Object(y.b)()],We.prototype,"view",void 0),We=Object(l.a)([Object(m.a)("esri.views.layers.GraphicsView")],We)));Object(l.a)([Object(y.b)({constructOnly:!0})],$e.prototype,"requestUpdateCallback",void 0),Object(l.a)([Object(y.b)()],$e.prototype,"container",void 0),Object(l.a)([Object(y.b)({constructOnly:!0})],$e.prototype,"graphics",void 0),Object(l.a)([Object(y.b)()],$e.prototype,"updating",null),Object(l.a)([Object(y.b)()],$e.prototype,"view",void 0),Object(l.a)([Object(y.b)()],$e.prototype,"updateRequested",void 0),$e=Object(l.a)([Object(m.a)("esri.views.2d.layers.support.GraphicsView2D")],$e),i.a=$e},ZyIX:function(e,t,i){"use strict";var a=i("yE7X"),u=i("b3VY"),l=i("7F7D"),c=i("mgI5"),h=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col};t.a=function(e){v(i,e);var t=p(i);function i(e){var r;return d(this,i),(r=t.call(this))._tileInfoView=e,r}return f(i,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(h),this.setStencilReference(),s(b(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state;return n(n({},s(b(i.prototype),"createRenderParams",this).call(this,e)),{},{requiredLevel:this._tileInfoView.getClosestInfoForScale(t.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(t.scale)})}},{key:"prepareRenderPasses",value:function(e){var t=this,n=e.registerRenderPass({name:"stencil",brushes:[l.a],drawPhase:a.c.DEBUG|a.c.MAP|a.c.HIGHLIGHT,target:function(){return t.getStencilTarget()}}),o=e.registerRenderPass({name:"tileInfo",brushes:[u.a],drawPhase:a.c.DEBUG,target:function(){return t.children},has:"esri-tiles-debug"});return[].concat(r(s(b(i.prototype),"prepareRenderPasses",this).call(this,e)),[n,o])}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,r=o(this.children);try{for(r.s();!(t=r.n()).done;){var i=t.value,n=this._tileInfoView.getTileResolution(i.key);i.setTransform(e,n)}}catch(a){r.e(a)}finally{r.f()}}},{key:"setStencilReference",value:function(){var e,t=1,r=o(this.children);try{for(r.s();!(e=r.n()).done;){e.value.stencilRef=t++}}catch(i){r.e(i)}finally{r.f()}}}]),i}(c.a)},by2V:function(e,r,i){"use strict";i.d(r,"a",(function(){return M}));var a=i("9MzC"),u=i("jKdI"),l=i("wSAH"),c=i("srIe"),h=i("6S2I"),y=i("zlDU"),m=i("jIHu"),g=(i("n4uK"),i("GVa1"),i("of9L")),x=i("0meK"),_=i("yN2G"),k=i("l8tk"),O=h.a.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),w=Object(k.b)(k.a,O),j=function(e){return 2147483647&e},D=function(){function e(t,r,i){d(this,e),this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;var n=t.buffer,a=t.pixelType,s=t.textureOnly,o=Object(_.j)(a);this.shared=i,this.pixelType=a,this.size=r,this.textureOnly=s,s||(this.data=new o(Object(c.q)(n))),this._resetRange()}return f(e,[{key:"destroy",value:function(){var e=this;Object(c.b)(this._texture,(function(e){return e.dispose()}));var t=function(t){Object(c.b)(e._fbos[t],(function(e){"0"===t&&e.detachColorTexture(),e.dispose()})),e._fbos[t]=null};for(var r in this._fbos)t(r);this._texture=null}},{key:"_textureDesc",get:function(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}}},{key:"setData",value:function(e,t,r){var i=j(e),n=Object(c.q)(this.data),a=i*this.texelSize+t;!n||a>=n.length||(n[a]=r,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i))}},{key:"getData",value:function(e,t){if(Object(c.j)(this.data))return null;var r=j(e)*this.texelSize+t;return!this.data||r>=this.data.length?null:this.data[r]}},{key:"getTexture",value:function(e){var t=this;return Object(c.r)(this._texture,(function(){return t._initTexture(e)}))}},{key:"getFBO",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(Object(c.j)(this._fbos[t])){var r={colorTarget:0,depthStencilTarget:0},i=0===t?this.getTexture(e):this._textureDesc;this._fbos[t]=new x.a(e,r,i)}return this._fbos[t]}},{key:"locked",get:function(){return!(5121!==this.pixelType||!this.shared||this.textureOnly||!Object(l.a)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}},{key:"updateTexture",value:function(e){if(!this.locked)try{var t=this.dirtyStart,r=this.dirtyEnd;if(t>r)return;this._resetRange();var i=Object(c.q)(this.data).buffer,n=this.getTexture(e),a=(t-t%this.size)/this.size,s=a,o=(r-r%this.size)/this.size,u=a*this.size*4,l=4*(this.size+o*this.size)-u,d=Object(_.j)(this.pixelType),h=d.BYTES_PER_ELEMENT;try{new d(i,u*h,l)}catch(m){}var f=new d(i,u*h,l),v=this.size,p=o-s+1;if(p>this.size)return void O.error(new y.a("mapview-webgl","Out-of-bounds index when updating AttributeData"));n.updateData(0,0,s,v,p,f)}catch(m){}}},{key:"update",value:function(e){var t=e.data,r=e.start,i=e.end;if(Object(c.k)(t))for(var n=this.data,a=r*this.texelSize,s=0;s<t.length;s++)e.layout&1<<s%this.texelSize&&(n[a+s]=t[s]);this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,i)}},{key:"resize",value:function(e,t){var r=this.size;if(this.size=t,this.textureOnly)r!==this.size&&(this._lastTexture=this._texture,this._texture=null);else{var i=Object(_.j)(this.pixelType);this.destroy(),this.data=new i(Object(c.q)(e.buffer))}}},{key:"_resetRange",value:function(){this.dirtyStart=2147483647,this.dirtyEnd=0}},{key:"_initTexture",value:function(e){var t=new g.a(e,this._textureDesc,Object(c.r)(this.data,void 0));if(Object(c.k)(this._lastTexture)&&this._fbos[0]){var r=this._lastTexture.descriptor.width,i=this._lastTexture.descriptor.height,n=this._lastTexture.descriptor.dataType,a=this._lastTexture.descriptor.pixelFormat,s=this.getFBO(e),o=Object(_.k)(n),u=new(Object(_.j)(n))(new ArrayBuffer(r*i*o*this.texelSize)),l=e.getBoundFramebufferObject(),d=e.getViewport(),h=d.x,f=d.y,v=d.width,y=d.height;e.bindFramebuffer(s),s.readPixels(0,0,r,i,a,n,u),t.updateData(0,0,0,2*r,i/2,u),e.setViewport(h,f,v,y),e.bindFramebuffer(l)}return this.destroy(),this._texture=t,this._texture}}]),e}(),T=function(){function e(t){d(this,e),this._onUpdate=t,this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}var r;return f(e,[{key:"initialize",value:function(e){var t=e.blocks,r=e.shared,i=e.size;if(this.shared=r,this.size=i,w("Initializing AttributeStoreView",e),Object(c.j)(this._data))this._data=Object(c.m)(t,(function(e){return new D(e,i,r)}));else for(var n=0;n<this._data.length;n++){var a=this._data[n],s=t[n];Object(c.k)(s)&&(Object(c.j)(a)?this._data[n]=new D(s,i,r):a.resize(s,i))}this._initialized=!0}},{key:"destroy",value:function(){Object(c.b)(this._data,(function(e){return Object(c.m)(e,(function(e){return e.destroy()}))})),Object(c.b)(this._defaultTexture,(function(e){return e.dispose()}))}},{key:"getBlock",value:function(e){return Object(c.j)(this._data)?null:this._data[e]}},{key:"setLabelMinZoom",value:function(e,t){this.setData(e,0,1,t)}},{key:"getLabelMinZoom",value:function(e){return this.getData(e,0,1,255)}},{key:"getFilterFlags",value:function(e){return this.getData(e,0,0,0)}},{key:"getVVSize",value:function(e){return this.getData(e,m.b,0,0)}},{key:"getData",value:function(e,t,r,i){if(!this._data)return 0;var n=Object(c.q)(this._data)[t];if(Object(c.j)(n))return 0;var a=n.getData(e,r);return Object(c.k)(a)?a:i}},{key:"setData",value:function(e,t,r,i){var n=Object(c.q)(this._data)[t];Object(c.q)(n).setData(e,r,i)}},{key:"lockTextureUpload",value:function(){this._locked=!0}},{key:"unlockTextureUpload",value:function(){this._locked=!1}},{key:"forceTextureUpload",value:function(){this._forceNextUpload=!0}},{key:"requestUpdate",value:(r=t(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._pendingAttributeUpdate){e.next=2;break}return e.abrupt("return",void O.error(new y.a("mapview-webgl","Tried to update attribute data with a pending update")));case 2:return r=Object(a.g)(),e.abrupt("return",(w("AttributeStoreView Update Requested",t),this._pendingAttributeUpdate={data:t,resolver:r},r.promise));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"update",value:function(){if(this._initialized&&(this._onUpdate(),Object(c.k)(this._pendingAttributeUpdate))){for(var e=this._pendingAttributeUpdate,t=e.data,r=e.resolver,i=Object(c.q)(this._data),n=function(e){var r=t.blocks[e],n=i[e];Object(c.b)(n,(function(t){return Object(c.b)(r,(function(r){w("Updating block "+e,r),t.update(r)}))}))},a=0;a<t.blocks.length;a++)n(a);this._pendingAttributeUpdate=null,r()}}},{key:"bindTextures",value:function(e){this.update();var t=this._getDefaultTexture(e);if(!this._initialized)return e.bindTexture(t,m.r),e.bindTexture(t,m.s),e.bindTexture(t,m.t),void e.bindTexture(t,m.u);var r=Object(c.q)(this._data);this._locked&&!this._forceNextUpload||(Object(c.h)(r,(function(t){return t.updateTexture(e)})),this._forceNextUpload=!1),e.bindTexture(Object(c.n)(r[0],t,(function(t){return t.getTexture(e)})),m.r),e.bindTexture(Object(c.n)(r[1],t,(function(t){return t.getTexture(e)})),m.s),e.bindTexture(Object(c.n)(r[2],t,(function(t){return t.getTexture(e)})),m.t),e.bindTexture(Object(c.n)(r[3],t,(function(t){return t.getTexture(e)})),m.u)}},{key:"_getDefaultTexture",value:function(e){return Object(c.j)(this._defaultTexture)&&(this._defaultTexture=new g.a(e,{wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array(4))),this._defaultTexture}}]),e}(),R=i("ZyIX"),B=i("nvBr"),S=i("qRWG"),I=i("gEht"),C=i("m0D6"),F=i("sq/B");function z(e,t){var r=t.length;if(e<t[0].value||1===r)return t[0].size;for(var i=1;i<r;i++)if(e<t[i].value)return t[i-1].size+(e-t[i-1].value)/(t[i].value-t[i-1].value)*(t[i].size-t[i-1].size);return t[r-1].size}function L(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(Object(c.j)(t))return e[r+0]=0,e[r+1]=0,e[r+2]=0,void(e[r+3]=0);var i=t.r,n=t.g,a=t.b,s=t.a;e[r+0]=i*s/255,e[r+1]=n*s/255,e[r+2]=a*s/255,e[r+3]=s}var A=function(){function e(){d(this,e),this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.ddColors=new Float32Array(32),this.ddBackgroundColor=new Float32Array(4),this.ddActiveDots=new Float32Array(8),this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1}}return f(e,[{key:"getSizeVVFieldStops",value:function(e){var t=this._vvSizeFieldStops;switch(t.type){case"static":return t;case"level-dependent":return Object(c.r)(t.levels[e],(function(){var r=1/0,i=0;for(var n in t.levels){var a=parseFloat(n),s=Math.abs(e-a);s<r&&(r=s,i=a)}if(r===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};var o=Math.pow(2,(e-i)/2),u=Object(c.q)(t.levels[i]),l=new Float32Array(u.values);return l[2]*=o,l[3]*=o,{sizes:Object(c.q)(u.sizes),values:l}}))}}},{key:"vvMaterialParameters",get:function(){return this._vvMaterialParameters}},{key:"update",value:function(e){Object(c.k)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}},{key:"setInfo",value:function(e,t,r){var i=this;switch(Object(c.k)(r)&&r.forEach((function(e){return i._updateEffects(e)})),this._vvInfo=t,e.type){case"dot-density":this._updateDotDensityInfo(e)}}},{key:"getVariation",value:function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,oesTextureFloat:Object(F.a)().supportsTextureFloat}}},{key:"getVariationHash",value:function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1}},{key:"_updateEffects",value:function(e){Object(c.k)(e)&&e.filter&&e.filter.enabled&&(this.outsideLabelsVisible=e.excludedLabelsVisible)}},{key:"_updateVisualVariables",value:function(e,t){var r=this._vvMaterialParameters;if(r.vvOpacityEnabled=!1,r.vvSizeEnabled=!1,r.vvColorEnabled=!1,r.vvRotationEnabled=!1,e){var i=e.size;if(i){if(r.vvSizeEnabled=!0,i.minMaxValue){var n,a,s=i.minMaxValue;if(Object(_.n)(s.minSize)&&Object(_.n)(s.maxSize))if(Object(_.o)(s.minSize)&&Object(_.o)(s.maxSize))n=Object(S.h)(s.minSize),a=Object(S.h)(s.maxSize);else{var o=t.scale;n=Object(S.h)(z(o,s.minSize.stops)),a=Object(S.h)(z(o,s.maxSize.stops))}this.vvSizeMinMaxValue.set([s.minDataValue,s.maxDataValue,n,a])}if(i.scaleStops&&(this.vvSizeScaleStopsValue=Object(S.h)(z(t.scale,i.scaleStops.stops))),i.unitValue){var u=Object(I.f)(t.spatialReference)/C.a[i.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=u/t.resolution}i.fieldStops&&(this._vvSizeFieldStops=i.fieldStops)}var l=e.color;l&&(r.vvColorEnabled=!0,this.vvColorValues.set(l.values),this.vvColors.set(l.colors));var c=e.opacity;c&&(r.vvOpacityEnabled=!0,this.vvOpacityValues.set(c.values),this.vvOpacities.set(c.opacities));var d=e.rotation;d&&(r.vvRotationEnabled=!0,r.vvRotationType=d.type)}}},{key:"_updateDotDensityInfo",value:function(e){var t=e.attributes;this.ddDotValue=e.dotValue,this.ddDotScale=e.referenceScale,this.ddDotSize=e.dotSize,this.ddDotBlending=e.dotBlendingEnabled,this.ddSeed=e.seed;for(var r=0;r<m.g;r++){var i=r>=t.length?new B.a([0,0,0,0]):t[r].color;L(this.ddColors,i,4*r)}for(var n=0;n<8;n++)this.ddActiveDots[n]=n<e.attributes.length?1:0;L(this.ddBackgroundColor,e.backgroundColor)}}]),e}(),M=function(e){v(l,e);var r,i=p(l);function l(e){var t;return d(this,l),(t=i.call(this,e))._rendererInfo=new A,t._materialItemsRequestQueue=new u.a,t.attributeView=new T((function(){return t.onAttributeStoreUpdate()})),t}return f(l,[{key:"destroy",value:function(){this.removeAllChildren(),this.children.forEach((function(e){return e.destroy()})),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}},{key:"setRendererInfo",value:function(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()}},{key:"getMaterialItems",value:(r=t(regeneratorRuntime.mark((function e(t,r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&0!==t.length){e.next=2;break}return e.abrupt("return",null);case 2:return i=Object(a.g)(),e.abrupt("return",(this._materialItemsRequestQueue.push({items:t,abortOptions:r,resolver:i}),this.requestRender(),i.promise));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"doRender",value:function(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0)for(var t=this._materialItemsRequestQueue.pop();t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop();s(b(l.prototype),"doRender",this).call(this,e)}},{key:"renderChildren",value:function(e){var t,r=o(this.children);try{for(r.s();!(t=r.n()).done;){t.value.commit(e)}}catch(i){r.e(i)}finally{r.f()}this._rendererInfo.update(e.state),s(b(l.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){return n(n({},s(b(l.prototype),"createRenderParams",this).call(this,e)),{},{rendererInfo:this._rendererInfo,attributeView:this.attributeView})}},{key:"onAttributeStoreUpdate",value:function(){}},{key:"_processMaterialItemRequest",value:function(e,t){var r=this,i=t.items,n=t.abortOptions,a=t.resolver,s=e.painter,o=e.pixelRatio,u=i.map((function(e){return s.textureManager.rasterizeItem(e.symbol,o,e.glyphIds,n)}));Promise.all(u).then((function(e){if(r.stage){var t=e.map((function(e,t){return{id:i[t].id,mosaicItem:e}}));a.resolve(t)}else a.reject()}),a.reject)}}]),l}(R.a)},"kvL/":function(e,t,r){"use strict";var i=r("by2V");t.a=function(e){v(r,e);var t=p(r);function r(e){return d(this,r),t.call(this,e)}return f(r,[{key:"hasLabels",get:function(){return!1}},{key:"labelsVisible",get:function(){return!1}},{key:"onTileData",value:function(e,t){e.patch(t),this.contains(e)||this.addChild(e),this.requestRender()}},{key:"onTileError",value:function(e){e.clear(),this.contains(e)||this.addChild(e)}},{key:"_renderChildren",value:function(e,t){var r,i=o(this.children);try{for(i.s();!(r=i.n()).done;){var n=r.value;n.isReady&&n.hasData&&(n.commit(e),e.context.setStencilFunction(514,n.stencilRef,255),n._displayList.replay(e,n,t))}}catch(a){i.e(a)}finally{i.f()}}}]),r}(i.a)}}])}();