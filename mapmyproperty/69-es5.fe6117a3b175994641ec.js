!function(){var e,t;function i(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function n(e,t,i,n,r,a,s){try{var o=e[a](s),l=o.value}catch(c){return void i(c)}o.done?t(l):Promise.resolve(l).then(n,r)}function r(e){return function(){var t=this,i=arguments;return new Promise(function(r,a){var s=e.apply(t,i);function o(e){n(s,r,a,o,l,"next",e)}function l(e){n(s,r,a,o,l,"throw",e)}o(void 0)})}}function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function s(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach(function(t){o(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i){return t&&c(e.prototype,t),i&&c(e,i),e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var i,n=b(e);if(t){var r=b(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return g(this,i)}}function g(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{"7K5q":function(e,t,i){"use strict";i.r(t),i.d(t,"DirectLineMeasurement3DView",function(){return le});var n=i("pO5D"),a=(i("wSAH"),i("srIe")),o=(i("6S2I"),i("zqDF"),i("WbKI")),c=i("04ZG"),h=(i("4EHJ"),i("ju1D"),i("9AIY"),i("/CmD")),g=i("IDUf"),b=i("OKTS"),p=i("qRWG"),m=i("YyOG"),_=(i("G48n"),i("Cy1f")),f=i("5DEt"),O=i("r0DZ"),y=i("N5XI"),j=i("9pTf"),w=i("gEht"),L=i("dhe/"),P=i("M0lq"),z=i("XvKw"),S=i("NUQ5"),E=i("RaGr"),k=i("B3Fv"),C=i("J+o3"),D=i("lObl"),M=i("XBzj"),V=i("r+FG"),A=i("8JEK"),R=i("yvcr"),x=i("X668"),G=i("/ADo"),T=i("1/dN"),H=i("NbNv"),q=i("w6Td"),W=i("ypgp"),I=i("2jVe"),U=i("+h6m"),F=i("jjdI"),Q=i("GJyJ"),B=i("jpeq"),N=i("KrNm"),J=function(e){d(i,e);var t=v(i);function i(e,n){return l(this,i),t.call(this,e,n)}return u(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build();return new F.a(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),U.a)}},{key:"bindPass",value:function(e,t,i){B.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("width",t.width),this.program.setUniform1f("outlineSize",t.outlineSize),this.program.setUniform4fv("outlineColor",t.outlineColor),this.program.setUniform1f("stripeLength",t.stripeLength),this.program.setUniform4fv("stripeEvenColor",t.stripeEvenColor),this.program.setUniform4fv("stripeOddColor",t.stripeOddColor)}},{key:"bindDraw",value:function(e){B.a.bindView(this.program,e)}},{key:"initializePipeline",value:function(){return Object(Q.d)({polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},depthWrite:Q.c,colorWrite:Q.b})}},{key:"primitiveType",get:function(){return 5}}]),i}(W.a);J.shader=new q.a(N.a,function(){return i.e(178).then(i.bind(null,"r091"))});var K=function(e){d(i,e);var t=v(i);function i(){var e;return l(this,i),(e=t.apply(this,arguments)).polygonOffsetEnabled=!1,e}return i}(I.a);Object(n.a)([Object(I.b)()],K.prototype,"polygonOffsetEnabled",void 0);var X=function(e){d(i,e);var t=v(i);function i(e){var n;return l(this,i),(n=t.call(this,e,Z)).techniqueConfig=new K,n}return u(i,[{key:"getTechniqueConfig",value:function(){return this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig}},{key:"dispose",value:function(){}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(){}},{key:"createBufferWriter",value:function(){return new ae}},{key:"getGLMaterial",value:function(e){return 0===e.output?new Y(e):void 0}}]),i}(H.a),Y=function(e){d(i,e);var t=v(i);function i(e){var n;return l(this,i),(n=t.call(this,e)).updateParameters(),n}return u(i,[{key:"updateParameters",value:function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(J,this.material.getTechniqueConfig(),this.technique)}},{key:"beginSlot",value:function(e){return 3===e}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}}]),i}(T.a),Z=s({width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1},H.b),$=Object(G.a)().vec3f("position").vec3f("normal").vec2f("uv0").f32("auxpos1"),ee=Object(_.e)(),te=Object(_.e)(),ie=Object(_.e)(),ne=Object(_.e)(),re=Object(_.e)(),ae=function(){function e(){l(this,e),this.vertexBufferLayout=$}return u(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 2*(e.indices.get("position").length/2+1)}},{key:"write",value:function(e,t,i,n){var r=t.vertexAttributes.get("position").data,a=t.vertexAttributes.get("normal").data,s=r.length/3,o=t&&t.indices&&t.indices.get("position");o&&o.length!==2*(s-1)&&console.warn("MeasurementArrowMaterial does not support indices");for(var l=ee,c=te,u=ie,d=ne,h=re,v=e.transformation,g=e.invTranspTransformation,b=i.position,p=i.normal,m=i.uv0,_=0,O=0;O<s;++O){var y=3*O;if(Object(f.v)(l,r[y],r[y+1],r[y+2]),O<s-1){var j=3*(O+1);Object(f.v)(c,r[j],r[j+1],r[j+2]),Object(f.v)(h,a[j],a[j+1],a[j+2]),Object(f.q)(h,h),Object(f.i)(u,c,l),Object(f.q)(u,u),Object(f.f)(d,h,u),Object(f.q)(d,d)}var w=Object(f.n)(l,c);v&&g&&(Object(f.l)(l,l,v),Object(f.l)(c,c,v),Object(f.l)(d,d,g));var L=n+2*O,P=L+1;b.setVec(L,l),b.setVec(P,l),p.setVec(L,d),p.setVec(P,d),m.set(L,0,_),m.set(L,1,-1),m.set(P,0,_),m.set(P,1,1),O<s-1&&(_+=w)}for(var z=i.auxpos1,S=0;S<2*s;++S)z.set(n+S,_)}}]),e}(),se=function(e){d(i,e);var t=v(i);function i(e){var n;return l(this,i),(n=t.call(this,e))._parameters=oe,n._handles=null,n._origin=Object(_.e)(),n._originTransform=Object(V.b)(),n._arrowCenter=Object(_.e)(),n._renderOccluded=4,n._geometry=null,n._stripeLength=1,n._stripesEnabled=!0,n.applyProps(e),n}return u(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:e}))}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.geometryChanged()}},{key:"stripeLength",get:function(){return this._stripeLength},set:function(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}},{key:"stripesEnabled",get:function(){return this._stripesEnabled},set:function(e){this._stripesEnabled=e,this.attached&&this._arrowMaterial.setParameterValues({stripeEvenColor:this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor})}},{key:"createExternalResources",value:function(){var e=this;this._arrowMaterial=new X({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new O.a,this._handles.add(this.view.state.watch("camera",function(){e.viewChanged()}))}},{key:"destroyExternalResources",value:function(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}},{key:"forEachExternalMaterial",value:function(e){e(this._arrowMaterial)}},{key:"createGeometries",value:function(e){if(!(Object(a.j)(this._geometry)||Object(a.j)(this._geometry.startRenderSpace)||Object(a.j)(this._geometry.endRenderSpace))){var t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this.viewChanged()}}},{key:"_createArrowGeometry",value:function(e,t,i,n){var r=this.view.renderCoordsHelper,a=[],s=[],o=function(e,t){var n=A.d.get();Object(f.i)(n,e,i),a.push(n),s.push(t)};if("euclidean"===n.type){n.eval(.5,this._arrowCenter);var l=A.d.get();r.worldUpAtPosition(this._arrowCenter,l),o(e,l),o(t,l)}else{n.eval(.5,this._arrowCenter);for(var c=this._parameters.arrowSubdivisions+1&-2,u=0;u<c;++u){var d=u/(c-1),h=A.d.get(),v=A.d.get();n.eval(d,h),r.worldUpAtPosition(h,v),o(h,v)}}return R.a.createPolylineGeometry(a,s)}},{key:"geometryChanged",value:function(){this.recreateGeometry()}},{key:"viewChanged",value:function(){if(this.view.ready&&this.attached&&Object(a.k)(this._geometry)){var e=this.view._stage.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*e})}}}]),i}(x.a),oe={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128},le=function(e){d(n,e);var t,i=v(n);function n(e){var t;return l(this,n),(t=i.call(this,e))._params=s({},he),t._handles=new O.a,t._segmentVisualElement=null,t._triangleVisualElement=null,t._rightAngleQuad=null,t._projectedGeodesicLine=null,t._geodesicStartHint=null,t._geodesicEndHint=null,t._segmentLabel=null,t._verticalLabel=null,t._horizontalLabel=null,t._segmentLabelDisplayedMeasurement="euclidean",t._startPosition=Object(_.e)(),t._endPosition=Object(_.e)(),t._cornerPosition=Object(_.e)(),t._startPositionAtSeaLevel=Object(_.e)(),t._endPositionAtSeaLevel=Object(_.e)(),t._viewMode="none",t._geometryDirty=!0,t.state="pending",t.messages=null,t._visualizedMeasurement="auto",t._actualVisualizedMeasurement="euclidean",t._visualElementOrientation="auto",t._triangleOrientationOverride=null,t._triangleCollapseRatioThreshold=.03,t._geodesicDistanceThreshold=1e5,t}return u(n,[{key:"initialize",value:function(){var e=this;this._handles.add(Object(y.whenOnce)(this.view,"ready",function(){return e._initialize()},!0))}},{key:"_initialize",value:function(){var e=this;switch(this.state){case"ready":throw new Error("invalid state");case"destroyed":return}this._segmentVisualElement=new se({attached:!0,view:this.view,geometry:null,renderOccluded:4}),this._triangleVisualElement=new D.a({attached:!0,view:this.view,width:this._params.triangleLineWidth,color:this._params.triangleColor,renderOccluded:4}),this._rightAngleQuad=new E.a({attached:!0,view:this.view,color:de,renderOccluded:4}),this._projectedGeodesicLine=new D.a({attached:!0,view:this.view,width:this._params.geodesicProjectionLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0,stipplePattern:Object(S.c)(this._params.guideStippleLengthPixels),stippleIntegerRepeats:!1,renderOccluded:4}),this._geodesicStartHint=new D.a({attached:!0,view:this.view,width:this._params.guideLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0,stipplePattern:Object(S.c)(this._params.guideStippleLengthPixels),stippleIntegerRepeats:!1,renderOccluded:4}),this._geodesicEndHint=new D.a({attached:!0,view:this.view,width:this._params.guideLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0,stipplePattern:Object(S.c)(this._params.guideStippleLengthPixels),stippleIntegerRepeats:!1,renderOccluded:4}),this._segmentLabel=new C.a({attached:!0,view:this.view,fontSize:this._params.direcLabelFontSize}),this._verticalLabel=new C.a({attached:!0,view:this.view,fontSize:this._params.verticalLabelFontSize}),this._horizontalLabel=new C.a({attached:!0,view:this.view,fontSize:this._params.horizontalLabelFontSize}),this._handles.add([this.dataObject.watch("visible",function(){return e._update(!1)},!0),this.dataObject.watch("startPoint",function(){return e._update()},!0),this.dataObject.watch("endPoint",function(){return e._update()},!0),this.dataObject.watch("measurement",function(){return e._update()},!0),this.dataObject.watch("settings.unit",function(){e._updateLabels(),e._updateSegmentStripeLength()},!0),this.view.state.watch("camera",function(){return e._update()},!0),Object(g.c)(r(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._updateMessageBundle());case 1:case"end":return t.stop()}},t)})))]),this._set("state","ready"),this._updateMessageBundle(),this._update()}},{key:"whenReady",value:(t=r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(y.whenOnce)(this,"ready").then(function(){}));case 1:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"ready",get:function(){return"ready"===this.state}},{key:"viewMode",get:function(){return this._viewMode}},{key:"visualizedMeasurement",get:function(){return this._visualizedMeasurement},set:function(e){e!==this._visualizedMeasurement&&(this._visualizedMeasurement=e,this._update())}},{key:"actualVisualizedMeasurement",get:function(){return this._actualVisualizedMeasurement}},{key:"visualElementsOrientation",get:function(){return this._visualElementOrientation},set:function(e){e!==this._visualElementOrientation&&(this._visualElementOrientation=e,this._update())}},{key:"allowVisualElementsOrientationChange",get:function(){return Object(a.j)(this._triangleOrientationOverride)},set:function(e){Object(a.j)(this._triangleOrientationOverride)!==e&&(Object(a.j)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._getActualVisualElementsOrientation():(this._triangleOrientationOverride=null,this._update()))}},{key:"triangleCollapseRatioThreshold",get:function(){return this._triangleCollapseRatioThreshold},set:function(e){this._triangleCollapseRatioThreshold=e,this._update()}},{key:"geodesicDistanceThreshold",get:function(){return this._geodesicDistanceThreshold},set:function(e){this._geodesicDistanceThreshold=e,this._update()}},{key:"segmentLabel",get:function(){return this._segmentLabel}},{key:"horizontalLabel",get:function(){return this._horizontalLabel}},{key:"verticalLabel",get:function(){return this._verticalLabel}},{key:"testData",get:function(){var e="geodesic"===this.actualVisualizedMeasurement;return{labels:{direct:e?this.horizontalLabel:this.segmentLabel,horizontal:e?this.segmentLabel:this.horizontalLabel,vertical:this.verticalLabel},stripeLength:this._segmentVisualElement.stripeLength}}},{key:"_update",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];switch(this.state){case"destroyed":case"pending":return}var t=this.dataObject.visible;switch(this._geometryDirty=e,this._geometryDirty&&t&&(this._updateGeometryAndViewMode(),this._geometryDirty=!1),this._viewMode){case"none":this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1;break;case"segment":this._segmentVisualElement.visible=t,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1;break;case"segment-and-triangle":this._segmentVisualElement.visible=t,this._triangleVisualElement.visible=t,this._rightAngleQuad.visible=t,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1;break;case"segment-and-projection":this._segmentVisualElement.visible=t,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}this._updateLabels()}},{key:"destroy",value:function(){switch(this.state){case"destroyed":case"pending":return}this._handles.destroy(),this._segmentVisualElement.destroy(),this._segmentVisualElement=null,this._triangleVisualElement.destroy(),this._triangleVisualElement=null,this._rightAngleQuad.destroy(),this._rightAngleQuad=null,this._projectedGeodesicLine.destroy(),this._projectedGeodesicLine=null,this._geodesicStartHint.destroy(),this._geodesicStartHint=null,this._geodesicEndHint.destroy(),this._geodesicEndHint=null,this._segmentLabel.destroy(),this._segmentLabel=null,this._verticalLabel.destroy(),this._verticalLabel=null,this._horizontalLabel.destroy(),this._horizontalLabel=null,this.set("view",null),this._set("state","destroyed")}},{key:"_updateGeometryAndViewMode",value:function(){var e=this.view,t=e.renderCoordsHelper;if(Object(a.j)(this.dataObject.startPoint)||Object(a.j)(this.dataObject.endPoint)||this.dataObject.startPoint.equals(this.dataObject.endPoint))return this._viewMode="none",void(this._actualVisualizedMeasurement="auto"===this._visualizedMeasurement?"euclidean":this._visualizedMeasurement);t.toRenderCoords(this.dataObject.startPoint,this._startPosition),t.toRenderCoords(this.dataObject.endPoint,this._endPosition);var i=this._getActualVisualElementsOrientation(),n=this._updateActualVisualizedMeasurement();this._viewMode=this._computeViewMode(n);var r=this._startPosition,s=this._endPosition,o="above-segment"===i?1:-1,l=o*(t.getAltitude(s)-t.getAltitude(r));l<0&&(r=this._endPosition,s=this._startPosition);var c="geodesic"===n?new M.b(this._startPosition,this._endPosition,t.spatialReference):new M.a(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=c,this._updateSegmentStripeLength(),this._segmentLabelDisplayedMeasurement=n,this._viewMode){case"segment":this._segmentLabel.anchor="above-segment"===i?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:c,sampleLocation:"center"};break;case"segment-and-triangle":var u=this._cornerPosition;t.worldUpAtPosition(r,u),Object(f.d)(u,u,o*Math.abs(l)),Object(f.e)(u,u,r),this._triangleVisualElement.geometry=[[[r[0],r[1],r[2]],[u[0],u[1],u[2]],[s[0],s[1],s[2]]]],this._rightAngleQuad.geometry={previous:r,center:u,next:s};var d=new M.a(r,u),h=new M.a(u,s),v=function(e,t,i,n,r){var a=ge,s=be;r.projectToRenderScreen(i,a),r.projectToRenderScreen(t,s);var o={segment:"bottom",horizontal:"top",vertical:a[0]<s[0]?"left":"right"},l=pe,c=me;if(Object(k.e)(e,i,l,r),Object(k.e)(e,t,c,r),Object(P.g)(l,c)>=ve)o.segment=Object(b.o)(l[1])===Object(b.o)(c[1])?Object(C.b)(o.vertical):o.vertical;else{var u=_e;Object(k.e)(i,t,u,r),Object(P.g)(u,c)>=ve&&(o.segment=Object(b.o)(u[0])===Object(b.o)(c[0])?Object(C.b)(o.horizontal):o.horizontal)}if("below-segment"===n){var d=function(e){return"top"===e?"bottom":"top"};o.segment=d(o.segment),o.horizontal=d(o.horizontal),o.vertical=d(o.vertical)}return o}(r,s,u,i,e.state.camera);this._segmentLabel.geometry={type:"segment",segment:c,sampleLocation:"center"},this._segmentLabel.anchor=v.segment,this._verticalLabel.geometry={type:"segment",segment:d,sampleLocation:"center"},this._verticalLabel.anchor=v.vertical,this._horizontalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._horizontalLabel.anchor=v.horizontal;break;case"segment-and-projection":Object(f.j)(this._startPositionAtSeaLevel,this._startPosition),Object(f.j)(this._endPositionAtSeaLevel,this._endPosition),t.setAltitude(0,this._startPositionAtSeaLevel),t.setAltitude(0,this._endPositionAtSeaLevel);var g=new M.b(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(g),this._geodesicStartHint.setGeometryFromSegment(new M.a(this._startPositionAtSeaLevel,this._startPosition)),this._geodesicEndHint.setGeometryFromSegment(new M.a(this._endPositionAtSeaLevel,this._endPosition)),this._segmentLabel.geometry={type:"segment",segment:g,sampleLocation:"center"},this._segmentLabel.anchor="above-segment"===i?"top":"bottom"}}},{key:"_updateLabels",value:function(){switch(this.state){case"pending":case"destroyed":return}var e=this.messages,t=this.dataObject.measurement;if(Object(a.j)(t)||!e)return this._segmentLabel.visible=!1,this._horizontalLabel.visible=!1,void(this._verticalLabel.visible=!1);var i={verticalDistance:"",horizontalDistance:"",euclideanDistance:"",geodesicDistance:""},n=t.directDistance,r=t.horizontalDistance,s=t.verticalDistance,o=t.geodesicDistance,l=t.geodesicAngle;switch(this.dataObject.settings.unit){case"metric":i.euclideanDistance=n&&Object(L.e)(e,n),i.horizontalDistance=r&&Object(L.e)(e,r),i.verticalDistance=s&&Object(L.f)(e,s),i.geodesicDistance=o&&Object(L.e)(e,o);break;case"imperial":i.euclideanDistance=n&&Object(L.c)(e,n),i.horizontalDistance=r&&Object(L.c)(e,r),i.verticalDistance=s&&Object(L.d)(e,s),i.geodesicDistance=o&&Object(L.c)(e,o);break;case"degrees":var c=l&&Object(L.b)(e,l,"degrees");i.euclideanDistance=c,i.horizontalDistance=c,i.geodesicDistance=c;break;case"degrees-minutes-seconds":i.horizontalDistance=l&&Object(L.a)(l);break;default:var u=this.dataObject.settings.unit;i.euclideanDistance=n&&Object(L.b)(e,n,u),i.horizontalDistance=r&&Object(L.b)(e,r,u),i.verticalDistance=s&&Object(L.b)(e,s,u),i.geodesicDistance=o&&Object(L.b)(e,o,u)}this._segmentLabel.text="euclidean"===this._segmentLabelDisplayedMeasurement?i.euclideanDistance:i.geodesicDistance,this._horizontalLabel.text=i.horizontalDistance,this._verticalLabel.text=i.verticalDistance;var d=this.dataObject.visible;switch(this._viewMode){case"none":this._segmentLabel.visible=!1,this._horizontalLabel.visible=!1,this._verticalLabel.visible=!1;break;case"segment":this._segmentLabel.visible=d,this._horizontalLabel.visible=!1,this._verticalLabel.visible=!1;break;case"segment-and-triangle":this._segmentLabel.visible=d,this._horizontalLabel.visible=d,this._verticalLabel.visible=d;break;case"segment-and-projection":this._segmentLabel.visible=d,this._horizontalLabel.visible=!1,this._verticalLabel.visible=!1}this.notifyChange("segmentLabel"),this.notifyChange("horizontalLabel"),this.notifyChange("verticalLabel")}},{key:"_updateSegmentStripeLength",value:function(){var e=function(e,t){var i=null;if(Object(a.k)(t.measurement)){var n=t.measurement.directDistance;switch(t.settings.unit){case"metric":i=n&&n.toUnit("meters");break;case"imperial":i=n&&n.toUnit(Object(w.s)(n.value,n.unit));break;case"degrees":case"degrees-minutes-seconds":var r=t.measurement.geodesicAngle;i=r&&r.toUnit("degrees");break;default:i=n&&n.toUnit(t.settings.unit)}}if(i){var s=1;return s=Object(b.k)(i.value/30),s*="degrees"===i.unit?Object(j.e)(e.spatialReference).metersPerDegree:Object(w.c)(1,i.unit,"meters")}return null}(this.view,this.dataObject);Object(a.k)(e)?(this._segmentVisualElement.stripeLength=e,this._segmentVisualElement.stripesEnabled=!0):this._segmentVisualElement.stripesEnabled=!1}},{key:"_computeViewMode",value:function(e){var t=this.dataObject,i=t.measurement;if("geodesic"===e){if(!ce(t,this.geodesicDistanceThreshold))return"segment";if(ue(this.view,this._startPosition)||ue(this.view,this._endPosition))return"segment-and-projection"}return Object(a.j)(i)||Math.min(i.verticalDistance.value/i.horizontalDistance.value,i.horizontalDistance.value/i.verticalDistance.value)<this.triangleCollapseRatioThreshold?"segment":"segment-and-triangle"}},{key:"_getActualVisualElementsOrientation",value:function(){return Object(a.k)(this._triangleOrientationOverride)?this._triangleOrientationOverride:"auto"===this.visualElementsOrientation?this.view.state.camera.aboveGround?"above-segment":"below-segment":this.visualElementsOrientation}},{key:"_updateActualVisualizedMeasurement",value:function(){if("auto"===this._visualizedMeasurement){this._actualVisualizedMeasurement="euclidean";var e=this.dataObject.settings.unit;"degrees"!==e&&"degrees-minutes-seconds"!==e||(this._actualVisualizedMeasurement="geodesic"),ce(this.dataObject,this.geodesicDistanceThreshold)&&(this._actualVisualizedMeasurement="geodesic")}else this._actualVisualizedMeasurement=this._visualizedMeasurement;return this._actualVisualizedMeasurement}},{key:"_updateMessageBundle",value:function(){var e=this;Object(m.a)("esri/core/t9n/Units").then(function(t){e.messages=t,e.view&&e._updateLabels()})}}]),n}(h.a);function ce(e,t){return Object(a.k)(e.measurement)&&e.measurement.horizontalDistance&&e.measurement.horizontalDistance.value>t}function ue(e,t){if(!e.state)return!1;var i=e.renderCoordsHelper,n=e.state.camera.computeScreenPixelSizeAt(t);return i.getAltitude(t)/n>=10}Object(n.a)([Object(o.b)({readOnly:!0})],le.prototype,"state",void 0),Object(n.a)([Object(o.b)()],le.prototype,"ready",null),Object(n.a)([Object(o.b)()],le.prototype,"messages",void 0),Object(n.a)([Object(o.b)()],le.prototype,"view",void 0),Object(n.a)([Object(o.b)()],le.prototype,"dataObject",void 0),Object(n.a)([Object(o.b)()],le.prototype,"viewMode",null),Object(n.a)([Object(o.b)()],le.prototype,"segmentLabel",null),Object(n.a)([Object(o.b)()],le.prototype,"horizontalLabel",null),Object(n.a)([Object(o.b)()],le.prototype,"verticalLabel",null),le=Object(n.a)([Object(c.a)("esri.views.3d.interactive.graphics.DirectLineMeasurement3D.DirectLineMeasurement3DView")],le);var de=Object(z.c)(1,.5,0,.75),he={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:de,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:de,guideLineWidth:2,guideLineColor:de,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},ve=Math.cos(Object(b.d)(12)),ge=Object(p.e)(),be=Object(p.e)(),pe=Object(p.d)(),me=Object(p.d)(),_e=Object(p.d)()},KrNm:function(n,r,a){"use strict";a.d(r,"a",function(){return c}),a.d(r,"b",function(){return l});var s=a("OIYi"),o=a("aQrP");function l(){var n=new o.a;n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("width","float"),n.attributes.add("position","vec3"),n.attributes.add("normal","vec3"),n.attributes.add("uv0","vec2"),n.attributes.add("auxpos1","float"),n.varyings.add("vtc","vec2"),n.varyings.add("vlength","float"),n.varyings.add("vradius","float"),n.vertex.code.add(s.a(e||(e=i(["\n    void main(void) {\n      vec3 bitangent = normal;\n\n      vtc = uv0;\n      vlength = auxpos1;\n      vradius = 0.5 * width;\n\n      vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);\n      gl_Position = proj * pos;\n    }\n  "])))),n.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");var r=1/Math.sqrt(2);return n.fragment.code.add(s.a(t||(t=i(["\n    const float INV_SQRT2 = ",";\n\n    vec4 arrowColor(vec2 tc, float len) {\n      float d = INV_SQRT2 * (tc.x - abs(tc.y));\n      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n      d = min(d, 1.0 - abs(tc.y));\n\n      if (d < 0.0) {\n        return vec4(0.0);\n      } else if (d < outlineSize) {\n        return outlineColor;\n      } else {\n        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n      }\n    }\n\n    void main(void) {\n      vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n      vec4 color = arrowColor(ntc, vlength / vradius);\n      if (color.a == 0.0) {\n        discard;\n      }\n      gl_FragColor = color;\n    }\n  "])),s.a.float(r))),n}var c=Object.freeze({__proto__:null,build:l})}}])}();