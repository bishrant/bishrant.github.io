(function(){(this||window).webpackJsonp.registerAbsMids({"arcgis-js-api/views/3d/webgl-engine/lib/geometryDataUtils":"+nCE","arcgis-js-api/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":"+wMf","arcgis-js-api/views/3d/layers/graphics/elevationAlignmentUtils":"/9Lg","arcgis-js-api/renderers/support/clickToleranceUtils":"/E+R","arcgis-js-api/views/3d/layers/graphics/GraphicState":"/NuL","arcgis-js-api/views/3d/support/geometryUtils/sphere":"/dtL","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":"0W55","arcgis-js-api/views/3d/support/geometryUtils/vector":"18xY","arcgis-js-api/core/libs/earcut/earcut":"1E+e","arcgis-js-api/views/3d/interactive/editingTools/manipulatorUtils":"1eTA","arcgis-js-api/views/3d/webgl-engine/lib/doublePrecisionUtils":"1f+t","arcgis-js-api/core/libs/gl-matrix-2/mat4f64":"1m5D","arcgis-js-api/views/3d/webgl-engine/lighting/SphericalHarmonics":"2Mej","arcgis-js-api/views/3d/interactive/visualElements/VisualElementResources":"2W+Z","arcgis-js-api/views/3d/support/geometryUtils/boundedPlane":"2eYJ","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":"2o+p","arcgis-js-api/symbols/support/defaultsJSON":"35hF","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":"3PFg","arcgis-js-api/views/3d/webgl-engine/lib/BoundingInfo":"3RHn","arcgis-js-api/geometry/support/triangulationUtils":"3Zlx","arcgis-js-api/core/libs/gl-matrix-2/factories/vec4f32":"3gjc","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":"3kdR","arcgis-js-api/views/3d/interactive/editingTools/manipulations/Manipulation":"48/q","arcgis-js-api/views/3d/interactive/editingTools/transformGraphic/GraphicTransformTool":"4QR8","arcgis-js-api/views/3d/support/geometryUtils/ray":"4p4v","arcgis-js-api/views/3d/webgl-engine/lib/GeometryUtil":"4ziW","arcgis-js-api/core/libs/gl-matrix-2/mat3f64":"51bw","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":"58az","arcgis-js-api/views/3d/interactive/manipulatorUtils":"5T2R","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYAxisManipulation":"6hC7","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":"6t3m","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":"6vp1","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYGraphicManipulation":"73uV","arcgis-js-api/views/3d/webgl-engine/core/shaderModules/interfaces":"7Aei","arcgis-js-api/core/libs/gl-matrix-2/factories/mat4f32":"7Yqx","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":"7zqm","arcgis-js-api/views/3d/webgl-engine/lib/intersectorUtils":"9DjX","arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialTexture":"9FJH","arcgis-js-api/views/3d/interactive/editingTools/moveGraphic/GraphicMoveTool":"A5GR","arcgis-js-api/views/3d/webgl-engine/lib/GeometryData":"AgDx","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":"B4Pz","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveManipulation":"BhkK","arcgis-js-api/views/3d/layers/graphics/graphicUtils":"BwdQ","arcgis-js-api/views/3d/webgl-engine/lib/Util":"CIy2","arcgis-js-api/core/libs/gl-matrix-2/factories/mat4f64":"CIzB","arcgis-js-api/views/3d/webgl-engine/materials/WaterGLMaterial":"CP88","arcgis-js-api/core/libs/gl-matrix-2/mat2":"CqfC","arcgis-js-api/views/3d/webgl-engine/shaders/ColorMaterial.glsl":"DFuO","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":"DKwL","arcgis-js-api/views/3d/support/debugFlags":"Dk48","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":"E/g4","arcgis-js-api/views/3d/webgl-engine/lib/DefaultTextureUnits":"EiD/","arcgis-js-api/views/3d/webgl-engine/shaders/ColorMaterialTechnique":"EiS2","arcgis-js-api/views/3d/webgl-engine/lib/DDSUtil":"EyQ4","arcgis-js-api/views/3d/webgl-engine/lib/renderStats":"FLCf","arcgis-js-api/views/3d/webgl-engine/lib/Material":"FNtW","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":"FQ4r","arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialRep":"FU3N","arcgis-js-api/views/3d/webgl-engine/materials/lineStippleUtils":"FbvD","arcgis-js-api/views/3d/interactive/editingTools/manipulations/config":"Fe95","arcgis-js-api/views/3d/interactive/editingTools/visualElementUtils":"G+tB","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/CommonUniformStore":"GDWR","arcgis-js-api/views/3d/support/geometryUtils/plane":"GG08","arcgis-js-api/views/3d/support/geometryUtils/axisAngle":"GyfB","arcgis-js-api/views/3d/layers/graphics/constants":"HbaO","arcgis-js-api/views/3d/webgl-engine/materials/internal/bufferWriterUtils":"ILj8","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":"IwVr","arcgis-js-api/views/3d/layers/graphics/sdfPrimitives":"J2BX","arcgis-js-api/views/3d/interactive/editingTools/reshapeGraphic/ReshapeOperation":"JXo2","arcgis-js-api/views/3d/support/stack":"JjCO","arcgis-js-api/views/3d/webgl-engine/lib/LongVectorMath":"KPBO","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/TextureOnly.glsl":"KQg4","arcgis-js-api/views/3d/webgl-engine/lib/AutoDisposable":"KRuQ","arcgis-js-api/core/colorUtils":"KtQ6","arcgis-js-api/views/3d/interactive/editingTools/ManipulatorState":"Kvb2","arcgis-js-api/core/libs/gl-matrix-2/mat2f64":"KwnQ","arcgis-js-api/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":"LZD4","arcgis-js-api/views/3d/interactive/visualElements/LaserlineVisualElement":"MCHn","arcgis-js-api/views/3d/support/geometryUtils/lineSegment":"N5NQ","arcgis-js-api/views/interactive/GraphicManipulator":"N78w","arcgis-js-api/views/support/drapedUtils":"NbdF","arcgis-js-api/views/3d/webgl-engine/shaders/ShadedColorMaterial.glsl":"NiJV","arcgis-js-api/core/ObjectStack":"PHan","arcgis-js-api/views/3d/interactive/editingTools/lineGraphicVisualElementUtils":"PLh7","arcgis-js-api/views/3d/interactive/visualElements/LineVisualElement":"PXiz","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":"PaEL","arcgis-js-api/views/3d/webgl-engine/materials/renderers/utils":"PwS/","arcgis-js-api/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":"Px2u","arcgis-js-api/views/3d/webgl-engine/lighting/SceneLighting":"QDiq","arcgis-js-api/views/3d/interactive/visualElements/OutlineVisualElement":"R4nD","arcgis-js-api/views/3d/webgl-engine/materials/RibbonLineMaterial":"RC9r","arcgis-js-api/views/3d/interactive/editingTools/transformGraphic/GraphicScaleRotateTransform":"RWrl","arcgis-js-api/views/3d/webgl-engine/lib/RenderContext":"Raj5","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":"RdU/","arcgis-js-api/views/3d/webgl-engine/lib/Camera":"RsYQ","arcgis-js-api/views/3d/webgl-engine/shaders/RibbonLineTechnique":"SNs2","arcgis-js-api/views/3d/interactive/visualElements/VerticesVisualElement":"T95R","arcgis-js-api/views/3d/interactive/editingTools/snapping/SnapToScene":"TIRl","arcgis-js-api/views/3d/webgl-engine/shaders/LaserlinePath.glsl":"UGy0","arcgis-js-api/views/3d/webgl-engine/shaders/HUDMaterial.glsl":"VQEQ","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":"W/V4","arcgis-js-api/views/3d/webgl-engine/lib/IdGen":"W0kZ","arcgis-js-api/views/3d/interactive/editingTools/settings":"X5J5","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":"Xakh","arcgis-js-api/views/3d/webgl-engine/lib/TextureTechnique":"XcBT","arcgis-js-api/views/3d/webgl-engine/lib/ResizableFloat32Array":"YseA","arcgis-js-api/views/3d/webgl-engine/lib/Layer":"ZO6V","arcgis-js-api/views/3d/webgl-engine/materials/renderers/MergedRenderer":"ZeO9","arcgis-js-api/views/3d/support/geometryUtils/triangle":"ZjcA","arcgis-js-api/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":"aExC","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":"aRjO","arcgis-js-api/views/3d/support/geometryUtils":"aWgr","arcgis-js-api/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":"ama6","arcgis-js-api/views/3d/interactive/visualElements/DrapedVisualElementResources":"as1Q","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":"cj3m","arcgis-js-api/views/3d/webgl-engine/lib/RenderGeometry":"cjy9","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":"cmSR","arcgis-js-api/views/3d/support/geometryUtils/frustum":"cpxo","arcgis-js-api/symbols/support/defaults":"dXKx","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":"dl/g","arcgis-js-api/views/3d/interactive/editingTools/manipulations/moveUtils":"dtql","arcgis-js-api/views/3d/webgl-engine/lib/localOrigin":"eHCP","arcgis-js-api/views/3d/layers/graphics/ElevationContext":"fOZq","arcgis-js-api/views/3d/webgl-engine/shaders/ShadedColorMaterialTechnique":"fQ2U","arcgis-js-api/views/3d/webgl-engine/shaders/LaserlineTechnique":"fUJJ","arcgis-js-api/views/3d/support/geometryUtils/clipRay":"fXZm","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":"fese","arcgis-js-api/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":"ff/U","arcgis-js-api/views/3d/support/LaserlinePathData":"gG9S","arcgis-js-api/views/3d/layers/graphics/lineUtils":"hADE","arcgis-js-api/views/3d/support/LaserLineRenderer":"hX2R","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/Laserline.glsl":"hk44","arcgis-js-api/views/3d/webgl-engine/lib/GridLocalOriginFactory":"hkmr","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":"hs8d","arcgis-js-api/views/3d/interactive/visualElements/PointVisualElement":"i10q","arcgis-js-api/views/3d/terrain/OverlayRenderer":"ij3I","arcgis-js-api/core/libs/gl-matrix-2/vec4f32":"j2SP","arcgis-js-api/views/3d/webgl-engine/shaders/WaterSurface.glsl":"jl7D","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":"juLw","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":"lBa0","arcgis-js-api/views/3d/webgl-engine/lib/StencilUtils":"lfQW","arcgis-js-api/views/3d/webgl-engine/lib/Octree":"mYMs","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/Camera.glsl":"naZ0","arcgis-js-api/views/3d/webgl-engine/shaders/RibbonLine.glsl":"ne9J","arcgis-js-api/views/3d/webgl-engine/materials/ColorMaterial":"o5p5","arcgis-js-api/core/libs/gl-matrix-2/mat4f32":"oZZu","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":"pLfv","arcgis-js-api/views/3d/webgl-engine/materials/renderers/Instance":"pbva","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":"piY7","arcgis-js-api/views/3d/webgl-engine/shaders/HUDMaterialTechnique":"pqGg","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveZManipulation":"pvGl","arcgis-js-api/views/3d/webgl-engine/shaders/Laserlines.glsl":"qSzK","arcgis-js-api/views/3d/webgl-engine/lighting/Lightsources":"qUb7","arcgis-js-api/views/3d/interactive/editingTools":"qkUi","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":"quQL","arcgis-js-api/core/libs/gl-matrix-2/types/mat4":"qvwY","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":"rCq5","arcgis-js-api/views/3d/webgl-engine/shaders/LaserlinePathTechnique":"raiv","arcgis-js-api/views/3d/webgl-engine/materials/internal/MaterialUtil":"s6rJ","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":"sQDZ","arcgis-js-api/views/3d/webgl-engine/lib/GLMaterial":"tUyH","arcgis-js-api/views/3d/interactive/editingTools/reshapeGraphic/GraphicReshapeTool":"uNfR","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":"uUnu","arcgis-js-api/views/3d/webgl-engine/materials/ShadedColorMaterial":"uZGf","arcgis-js-api/views/3d/interactive/editingTools/draw/DrawGraphicTool":"ub+M","arcgis-js-api/views/3d/interactive/editingTools/pointGraphicVisualElementUtils":"uinn","arcgis-js-api/views/3d/layers/graphics/pointUtils":"v+nG","arcgis-js-api/views/3d/webgl-engine/materials/WaterTechnique":"v22c","arcgis-js-api/views/3d/support/ElevationProvider":"vA3N","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":"vGsU","arcgis-js-api/core/libs/gl-matrix-2/math/mat2":"vJh7","arcgis-js-api/core/VectorStack":"wSO/","arcgis-js-api/views/3d/support/imageUtils":"weRx","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":"xDGw","arcgis-js-api/views/3d/webgl-engine/materials/HUDMaterial":"xFEL","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":"y68M","arcgis-js-api/views/3d/layers/graphics/featureExpressionInfoUtils":"yVFQ","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":"ybGv","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYDiscManipulation":"yjgM","arcgis-js-api/views/3d/webgl-engine/lib/Texture":"yqrJ","arcgis-js-api/views/3d/webgl-engine/lib/Geometry":"ys4y","arcgis-js-api/core/libs/gl-matrix-2/factories/mat2f64":"z4cv","arcgis-js-api/views/3d/webgl-engine/lib/rendererUtils":"znI2"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"+nCE":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("0LE5"),n("Rdxj"),n("ZjcA")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=1,o=null,s=new Uint32Array([0]);t.generateDefaultIndexArray=function(e){if(1===e)return s;if(e>a||null==o){for(;e>a;)a*=2;o=new Uint32Array(a);for(var t=0;t<a;t++)o[t]=t}return new Uint32Array(o.buffer,0,e)},t.computeAttachmentOriginTriangles=function(e,t,r){if(!e)return!1;var a=e.strideIdx,o=e.offsetIdx,s=e.data;n.vec3.set(r,0,0,0),n.vec3.set(d,0,0,0);for(var l=0,f=0,h=0;h<t.length-2;h+=3){var v=t[h+0]*a+o,m=t[h+1]*a+o,g=t[h+2]*a+o;n.vec3.set(c,s[v+0],s[v+1],s[v+2]),n.vec3.set(u,s[m+0],s[m+1],s[m+2]),n.vec3.set(p,s[g+0],s[g+1],s[g+2]);var y=i.areaPoints3d(c,u,p);y?(n.vec3.add(c,c,u),n.vec3.add(c,c,p),n.vec3.scale(c,c,1/3*y),n.vec3.add(r,r,c),l+=y):(n.vec3.add(d,d,c),n.vec3.add(d,d,u),n.vec3.add(d,d,p),f+=3)}return!(0===f&&0===l||(0!==l?(n.vec3.scale(r,r,1/l),0):0===f||(n.vec3.scale(r,d,1/f),0)))},t.computeAttachmentOriginPoints=function(e,t,r){if(!e||!t)return!1;var i=e.strideIdx,a=e.offsetIdx,o=e.data;n.vec3.set(r,0,0,0);for(var s=-1,l=0,c=0;c<t.length;c++){var u=t[c]*i+a;s!==u&&(r[0]+=o[u+0],r[1]+=o[u+1],r[2]+=o[u+2],l++),s=u}return l>1&&n.vec3.scale(r,r,1/l),l>0},t.computeAttachmentOriginLines=function(e,t,r,i){if(!e)return!1;var a=e.strideIdx,o=e.offsetIdx,s=e.data;n.vec3.set(i,0,0,0),n.vec3.set(d,0,0,0);for(var l=0,p=0,f=t?t.length-1:s.length/a-1,h=f+(r?2:0),v=0;v<h;v+=2){var m=v<f?v:f,g=v<f?v+1:0,y=(t?t[m]:m)*a+o,_=(t?t[g]:g)*a+o;c[0]=s[y+0],c[1]=s[y+1],c[2]=s[y+2],u[0]=s[_+0],u[1]=s[_+1],u[2]=s[_+2],n.vec3.scale(c,n.vec3.add(c,c,u),.5);var b=n.vec3.dist(c,u);b>0?(n.vec3.add(i,i,n.vec3.scale(c,c,b)),l+=b):(n.vec3.add(d,d,c),p++)}return 0!==l?(n.vec3.scale(i,i,1/l),!0):0!==p&&(n.vec3.scale(i,d,1/p),!0)};var l=0;t.getNewId=function(){return l++};var c=r.vec3f64.create(),u=r.vec3f64.create(),p=r.vec3f64.create(),d=r.vec3f64.create()}).apply(null,r))||(e.exports=i)},"+wMf":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("wPX3")],void 0===(i=(function(e,t,n,r){function i(e,t,n){var r=n.parameters,i=n.paddingPixelsOverride;return u.scale=Math.min(r.divisor/(t-r.offset),1),u.factor=function(e){return Math.abs(e*e*e)}(e),u.minPixelSize=r.minPixelSize,u.paddingPixels=i,u}function a(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function o(e,t){return Math.max(n.lerp(e*t.scale,e,t.factor),a(e,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.getSettings=function(e){return new s(e,l)},t.getLabelSettings=function(e){var t=l.curvatureDependent;return new s(e,{curvatureDependent:{min:{curvature:t.min.curvature,tiltAngle:t.min.tiltAngle,scaleFallOffFactor:c.curvatureDependent.min.scaleFallOffFactor},max:{curvature:t.max.curvature,tiltAngle:t.max.tiltAngle,scaleFallOffFactor:c.curvatureDependent.max.scaleFallOffFactor}},scaleStart:l.scaleStart,scaleFallOffRange:l.scaleFallOffRange,minPixelSize:c.minPixelSize})},t.applyScaleFactor=o,t.applyScaleFactorVec2=function(e,t,r){void 0===r&&(r=[0,0]);var i=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return r[0]=n.lerp(e[0]*i,e[0],t.factor),r[1]=n.lerp(e[1]*i,e[1],t.factor),r},t.precomputeScaleFactor=function(e,t,n,r){r.scale=function(e,t,n){var r=i(e,t,n);return r.minPixelSize=0,r.paddingPixels=0,o(1,r)}(e,t,n),r.factor=0,r.minPixelSize=n.parameters.minPixelSize,r.paddingPixels=n.paddingPixelsOverride},t.applyPrecomputedScaleFactor=function(e,t,n){void 0===n&&(n=[0,0]);var r=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return n[0]=e[0]*r,n[1]=e[1]*r,n},t.scale=function(e,t,n,r){return o(e,i(t,n,r))};var s=function(){function e(e,t,n,r){void 0===n&&(n={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}),this.viewingMode=e,this.description=t,this.parameters=n,this._paddingPixelsOverride=r,"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}return Object.defineProperty(e.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0}),e.prototype.update=function(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this.calculateParameters(e,this.parameters),0))},e.prototype.overridePadding=function(t){return t!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.parameters,t):this},e.prototype.calculateParameters=function(e,t){var n=this.description,r=n.scaleStart,i=n.scaleFallOffRange,a=n.minPixelSize,o=e.fovY,s=e.distance,l=this.calculateCurvatureDependentParameters(e),c=this.coverageCompensation(e,l),u=l.tiltAngle,p=l.scaleFallOffFactor,d=Math.sin(u)*s,f=.5*Math.PI-u-o*(.5-r*c),h=d/Math.cos(f),v=(h-p*(d/Math.cos(f+o*i*c)))/(1-p);return t.camera.fovY=e.fovY,t.camera.distance=e.distance,t.offset=v,t.divisor=h-v,t.minPixelSize=a,t},e.prototype.calculateCurvatureDependentParametersLocal=function(e,t){return void 0===t&&(t=p),t.tiltAngle=this.description.curvatureDependent.min.tiltAngle,t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,t},e.prototype.calculateCurvatureDependentParametersGlobal=function(e,t){void 0===t&&(t=p);var i=this.description.curvatureDependent,a=1+e.distance/r.earthRadius,o=Math.sqrt(a*a-1),s=[i.min.curvature,i.max.curvature],l=s[0],c=n.clamp((o-l)/(s[1]-l),0,1),u=[i.min,i.max],d=u[0],f=u[1];return t.tiltAngle=n.lerp(d.tiltAngle,f.tiltAngle,c),t.scaleFallOffFactor=n.lerp(d.scaleFallOffFactor,f.scaleFallOffFactor,c),t},e.prototype.surfaceCoverageCompensationLocal=function(e,t){return(e.fovY-t.tiltAngle)/e.fovY},e.prototype.surfaceCoverageCompensationGlobal=function(e,t){var n=r.earthRadius*r.earthRadius,i=t.tiltAngle+.5*Math.PI,a=e.fovY,o=e.distance,s=o*o+n-2*Math.cos(i)*o*r.earthRadius,l=Math.sqrt(s),c=Math.sqrt(s-n);return(Math.acos(c/l)-Math.asin(r.earthRadius/(l/Math.sin(i)))+.5*a)/a},e}(),l={curvatureDependent:{min:{curvature:n.deg2rad(10),tiltAngle:n.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:n.deg2rad(70),tiltAngle:n.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},c={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14},u={scale:0,factor:0,minPixelSize:0,paddingPixels:0},p={tiltAngle:0,scaleFallOffFactor:0}}).apply(null,r))||(e.exports=i)},"/9Lg":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("FXVB"),n("1m5D"),n("Rdxj"),n("BwdQ"),n("vA3N"),n("mmEe")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){function c(e,t,r,i,a){var o=e.z||0;switch(r.mode){case"on-the-ground":var l=s.getElevationAtPoint(t,e,"ground")||0;return a&&(a.verticalDistanceToGround=0,a.sampledElevation=l),l;case"relative-to-ground":l=s.getElevationAtPoint(t,e,"ground")||0;var c=r.geometryZWithOffset(o,i);return a&&(a.verticalDistanceToGround=c,a.sampledElevation=l),c+l;case"relative-to-scene":return l=s.getElevationAtPoint(t,e,"scene")||0,c=r.geometryZWithOffset(o,i),a&&(a.verticalDistanceToGround=c,a.sampledElevation=l),c+l;case"absolute-height":if(c=r.geometryZWithOffset(o,i),a){var u=s.getElevationAtPoint(t,e,"ground")||0;a.verticalDistanceToGround=c-u,a.sampledElevation=u}return c;default:return n.neverReached(r.mode),0}}var u;Object.defineProperty(t,"__esModule",{value:!0}),t.applyPerVertexElevationAlignment=function(e,t,n,r,i,a,o,s,c,u,d){var f,h,v=p[d.mode],m=0;if(l.bufferToBuffer(e,t,n,r,c.spatialReference,i,s)&&(v.requiresAlignment(d)?(m=v.applyElevationAlignmentBuffer(r,i,a,o,s,c,u,d),f=a,h=o):(f=r,h=i),l.bufferToBuffer(f,c.spatialReference,h,a,u.spatialReference,o,s)))return m},t.evaluateElevationAlignmentAtPoint=c,t.elevationModeChangeUpdateType=function(e,t,n){return null==t||null==n?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?u.UPDATE:e.onTheGroundChanged},t.needsElevationUpdates2D=function(e){return"relative-to-ground"===e||"relative-to-scene"===e},t.needsElevationUpdates3D=function(e){return"absolute-height"!==e},t.applyElevationAlignmentForHUD=function(e,t,n,i,a){var s=c(t,n,a,i,f);o.updateVertexAttributeAuxpos1w(e,f.verticalDistanceToGround);var u=f.sampledElevation,p=r.mat4.copy(d,e.objectTransformation);return h[0]=t.x,h[1]=t.y,h[2]=s,l.computeLinearTransformation(t.spatialReference,h,p,i.spatialReference)?e.objectTransformation=p:console.warn("Could not locate symbol object properly, it might be misplaced"),u},function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(u=t.SymbolUpdateType||(t.SymbolUpdateType={}));var p={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var l=s.calculateOffsetRenderUnits(o),c=s.featureExpressionInfoContext;t*=3,r*=3;for(var u=0;u<i;++u){var p=e[t+1],d=e[t+2];n[r+0]=e[t+0],n[r+1]=p,n[r+2]=null==c?d+l:l,t+=3,r+=3}return 0},requiresAlignment:function(e){return 0!==e.meterUnitOffset||null!=e.featureExpressionInfoContext}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a){var o=0,s=a.spatialReference;t*=3,r*=3;for(var l=0;l<i;++l){var c=e[t+0],u=e[t+1],p=a.getElevation(c,u,e[t+2],s,"ground")||0;o+=p,n[r+0]=c,n[r+1]=u,n[r+2]=p,t+=3,r+=3}return o/i},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var l=0,c=s.calculateOffsetRenderUnits(o),u=s.featureExpressionInfoContext,p=a.spatialReference;t*=3,r*=3;for(var d=0;d<i;++d){var f=e[t+0],h=e[t+1],v=e[t+2],m=a.getElevation(f,h,v,p,"ground")||0;l+=m,n[r+0]=f,n[r+1]=h,n[r+2]=null==u?v+m+c:m+c,t+=3,r+=3}return l/i},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var l=0,c=s.calculateOffsetRenderUnits(o),u=s.featureExpressionInfoContext,p=a.spatialReference;t*=3,r*=3;for(var d=0;d<i;++d){var f=e[t+0],h=e[t+1],v=e[t+2],m=a.getElevation(f,h,v,p,"scene")||0;l+=m,n[r+0]=f,n[r+1]=h,n[r+2]=null==u?v+m+c:m+c,t+=3,r+=3}return l/i},requiresAlignment:function(){return!0}}},d=i.mat4f64.create(),f={verticalDistanceToGround:0,sampledElevation:0},h=a.vec3f64.create()}).apply(null,r))||(e.exports=i)},"/Bau":function(e,t){},"/E+R":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,n=0,r=0;r<e.length;r++){var i=e[r].size;"number"==typeof i&&(t+=i,n++)}return t/n}(e.stops):t}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateTolerance=function(e){var t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;var a="visualVariables"in t?function(e,t){if(!t)return e;var n=t.filter((function(e){return"size"===e.type})).map((function(t){var n=t.minSize;return(r(t.maxSize,e)+r(n,e))/2})),i=0,a=n.length;if(0===a)return e;for(var o=0;o<a;o++)i+=n[o];var s=Math.floor(i/a);return Math.max(s,e)}(i,t.visualVariables):i;if("simple"===t.type)return n(a,t.symbol);if("unique-value"===t.type){var o=a;return t.uniqueValueInfos.forEach((function(e){o=n(o,e.symbol)})),o}if("class-breaks"===t.type){var s=a;return t.classBreakInfos.forEach((function(e){s=n(s,e.symbol)})),s}return a}}).apply(null,r))||(e.exports=i)},"/NuL":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("BcWh"),n("Vx27")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){var n=e.call(this,t)||this;return n.tracking=!1,n.displaying=!1,n.isDraped=!1,n}return n.__extends(t,e),n.__decorate([i.property({constructOnly:!0})],t.prototype,"graphic",void 0),n.__decorate([i.property()],t.prototype,"tracking",void 0),n.__decorate([i.property()],t.prototype,"displaying",void 0),n.__decorate([i.property()],t.prototype,"isDraped",void 0),n.__decorate([i.subclass("esri.views.3d.layers.graphics.GraphicState")],t)}(r.EventedAccessor);t.GraphicState=a}).apply(null,r))||(e.exports=i)},"/dtL":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("qsST"),n("xoE+"),n("PHan"),n("FXVB"),n("0LE5"),n("Rdxj"),n("aWgr"),n("AzkI"),n("JjCO"),n("4p4v")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var f=r.getLogger("esri.views.3d.support.geometryUtils.sphere");function h(e){return e?{radius:e.radius,center:l.vec3f64.clone(e.center)}:{radius:1,center:l.vec3f64.create()}}function v(e,t){return void 0===t&&(t=h()),m(e.radius,e.center,t)}function m(e,t,n){return void 0===n&&(n=h()),s.vec3.copy(n.center,t),n.radius=e,n}function g(e,t,n){var r=s.vec3.subtract(p.sv3d.get(),t.origin,e.center),i=s.vec3.dot(t.direction,t.direction),a=2*s.vec3.dot(t.direction,r),o=a*a-4*i*(s.vec3.dot(r,r)-e.radius*e.radius);if(o<0)return!1;var l=Math.sqrt(o),c=(-a-l)/(2*i),u=(-a+l)/(2*i);return(c<0||u<c&&u>0)&&(c=u),!(c<0||(n&&s.vec3.add(n,t.origin,s.vec3.scale(p.sv3d.get(),t.direction,c)),0))}function y(e,t,n){var r=p.sv3d.get(),i=p.sm4d.get();s.vec3.cross(r,t.origin,t.direction),s.vec3.cross(n,r,t.origin),s.vec3.scale(n,n,1/s.vec3.length(n)*e.radius);var a=b(e,t.origin),l=c.vector.angle(t.origin,n);return o.mat4.identity(i),o.mat4.rotate(i,i,l+a,r),s.vec3.transformMat4(n,n,i),n}function _(e,t,n){var r=s.vec3.subtract(p.sv3d.get(),t,e.center),i=s.vec3.scale(p.sv3d.get(),r,e.radius/s.vec3.length(r));return s.vec3.add(n,i,e.center)}function b(e,t){var n=s.vec3.subtract(p.sv3d.get(),t,e.center),r=s.vec3.length(n),a=e.radius+Math.abs(e.radius-r);return i.acosClamped(e.radius/a)}t.create=h,t.wrap=function(e,t){var n=O.get();return n.radius=e,n.center=t||M,n},t.copy=v,t.fromValues=m,t.elevate=function(e,t,n){return e!==n&&s.vec3.copy(n.center,e.center),n.radius=e.radius+t,n},t.setExtent=function(e,t,n){return f.error("sphere.setExtent is not yet supported"),e===n?n:v(e,n)},t.intersectRay=g,t.intersectScreen=function(e,t,n,r){return g(e,d.fromScreenAtEye(t,n,P),r)},t.intersectsRay=function(e,t){return g(e,t,null)},t.intersectRayClosestSilhouette=function(e,t,n){if(g(e,t,n))return n;var r=y(e,t,p.sv3d.get());return s.vec3.add(n,t.origin,s.vec3.scale(p.sv3d.get(),t.direction,s.vec3.distance(t.origin,r)/s.vec3.length(t.direction))),n},t.closestPointOnSilhouette=y,t.closestPoint=function(e,t,n){return g(e,t,n)?n:(d.closestPoint(t,e.center,n),_(e,n,n))},t.projectPoint=_,t.distanceToSilhouette=function(e,t){var n=s.vec3.subtract(p.sv3d.get(),t,e.center),r=s.vec3.squaredLength(n);return Math.sqrt(Math.abs(r-e.radius*e.radius))},t.angleToSilhouette=b;var x=l.vec3f64.create();function w(e,t,r,i){var a=s.vec3.subtract(x,t,e.center);switch(r){case 0:var o=(l=u.cartesianToSpherical(a,x))[2];return s.vec3.set(i,-Math.sin(o),Math.cos(o),0);case 1:var l,c=(l=u.cartesianToSpherical(a,x))[1],p=(o=l[2],Math.sin(c));return s.vec3.set(i,-p*Math.cos(o),-p*Math.sin(o),Math.cos(c));case 2:return s.vec3.normalize(i,a);default:return void n.neverReached(r)}}function S(e,t){var n=s.vec3.subtract(C,t,e.center);return s.vec3.length(n)-e.radius}t.axisAt=w,t.altitudeAt=S,t.setAltitudeAt=function(e,t,n,r){var i=S(e,t),a=w(e,t,2,C),o=s.vec3.scale(C,a,n-i);return s.vec3.add(r,t,o),r};var O=new a.ObjectStack((function(){return{center:null,radius:0}})),P=d.create(),M=l.vec3f64.create(),C=l.vec3f64.create();Object.freeze(M)}).apply(null,r))||(e.exports=i)},"0W55":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSpacePass=function(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = position * 0.5 + vec2(0.5);\n    } \n  "],["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = position * 0.5 + vec2(0.5);\n    } \n  "]))))}}).apply(null,r))||(e.exports=i)},"18xY":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("0LE5"),n("Rdxj")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.projectPoint=function(e,t,n){var i=r.vec3.dot(e,t)/r.vec3.dot(e,e);return r.vec3.scale(n,e,i)},t.projectPointSignedLength=function(e,t){return r.vec3.dot(e,t)/r.vec3.length(e)},t.angle=function(e,t){var i=r.vec3.dot(e,t)/(r.vec3.length(e)*r.vec3.length(t));return-n.acosClamped(i)},t.angleAroundAxis=function(e,t,i){r.vec3.normalize(a,e),r.vec3.normalize(o,t);var s=r.vec3.dot(a,o),l=n.acosClamped(s),c=r.vec3.cross(a,a,o);return r.vec3.dot(c,i)<0?2*Math.PI-l:l};var a=i.vec3f64.create(),o=i.vec3f64.create()}).apply(null,r))||(e.exports=i)},"1E+e":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e,t,n,r,i){var a;if(i===f(e,t,n,r)>0)for(var o=t;o<n;o+=r)a=s(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=s(o,e[o],e[o+1],a);return a&&g(a,a.next)&&(l(a),a=a.next),a}function r(e,t){if(void 0===t&&(t=e),!e)return e;var n,r=e;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==p(r.prev,r,r.next))r=r.next;else{if(l(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,s,c,u,p){if(void 0===p&&(p=0),e){!p&&u&&(e=function e(t,n,r,i){for(var a=void 0;a!==t;a=a.next){if(null===(a=a||t).z&&(a.z=m(a.x,a.y,n,r,i)),a.prev.next!==a||a.next.prev!==a)return a.prev.next=a,a.next.prev=a,e(t,n,r,i);a.prevZ=a.prev,a.nextZ=a.next}return t.prevZ.nextZ=null,t.prevZ=null,function(e){for(var t,n=1;;){var r=e,i=void 0;e=null,t=null;for(var a=0;r;){a++,i=r;for(var o=0;o<n&&i;o++)i=i.nextZ;for(var s=n;o>0||s>0&&i;){var l=void 0;0===o?(l=i,i=i.nextZ,s--):0!==s&&i?r.z<=i.z?(l=r,r=r.nextZ,o--):(l=i,i=i.nextZ,s--):(l=r,r=r.nextZ,o--),t?t.nextZ=l:e=l,l.prevZ=t,t=l}r=i}if(t.nextZ=null,n*=2,a<2)return e}}(t)}(e,s,c,u));for(var d=e;e.prev!==e.next;){var f=e.prev,h=e.next;if(u?o(e,s,c,u):a(e))t.push(f.index/n),t.push(e.index/n),t.push(h.index/n),l(e),e=h.next,d=h.next;else if((e=h)===d){p?1===p?i(e=_(e,t,n),t,n,s,c,u,2):2===p&&b(e,t,n,s,c,u):i(r(e),t,n,s,c,u,1);break}}}}function a(e){var t=e.prev,n=e,r=e.next;if(p(t,n,r)>=0)return!1;for(var i=e.next.next,a=i,o=0;i!==e.prev&&(0===o||i!==a);){if(o++,h(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&p(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function o(e,t,n,r){var i=e.prev,a=e,o=e.next;if(p(i,a,o)>=0)return!1;for(var s=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,l=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,c=m(i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,t,n,r),u=m(s,l,t,n,r),d=e.prevZ,f=e.nextZ;d&&d.z>=c&&f&&f.z<=u;){if(d!==e.prev&&d!==e.next&&h(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&p(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==e.prev&&f!==e.next&&h(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&p(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=c;){if(d!==e.prev&&d!==e.next&&h(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&p(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=u;){if(f!==e.prev&&f!==e.next&&h(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&p(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function s(e,t,n,r){var i=new S(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function l(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function c(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function u(e,t){if(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n.prev;var l,c=n,u=n.x,p=n.y,d=1/0;for(r=n.next;r!==c;)i>=r.x&&r.x>=u&&i!==r.x&&h(a<p?i:o,a,u,p,a<p?o:i,a,r.x,r.y)&&((l=Math.abs(a-r.y)/(i-r.x))<d||l===d&&r.x>n.x)&&v(r,e)&&(n=r,d=l),r=r.next;return n}(e,t)){var n=w(t,e);r(n,n.next)}}function p(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function d(e,t,n,r){return!!(g(e,t)&&g(n,r)||g(e,r)&&g(n,t))||p(e,t,n)>0!=p(e,t,r)>0&&p(n,r,e)>0!=p(n,r,t)>0}function f(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}function h(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function v(e,t){return p(e.prev,e,e.next)<0?p(e,t,e.next)>=0&&p(e,e.prev,t)>=0:p(e,t,e.prev)<0||p(e,e.next,t)<0}function m(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e,t){return e.x===t.x&&e.y===t.y}function y(e,t){return e.x-t.x}function _(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!g(i,a)&&d(i,r,r.next,a)&&v(i,a)&&v(a,i)&&(t.push(i.index/n),t.push(r.index/n),t.push(a.index/n),l(r),l(r.next),r=e=a),r=r.next}while(r!==e);return r}function b(e,t,n,a,o,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.index!==c.index&&x(l,c)){var u=w(l,c);return l=r(l,l.next),u=r(u,u.next),i(l,t,n,a,o,s),void i(u,t,n,a,o,s)}c=c.next}l=l.next}while(l!==e)}function x(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var n=e;do{if(n.index!==e.index&&n.next.index!==e.index&&n.index!==t.index&&n.next.index!==t.index&&d(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&v(e,t)&&v(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)}function w(e,t){var n=new S(e.index,e.x,e.y),r=new S(t.index,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}Object.defineProperty(t,"__esModule",{value:!0}),t.earcut=function(e,t,a){var o,s,l,p,d,f=t&&t.length,h=f?t[0]*a:e.length,v=n(e,0,h,a,!0),m=new Array;if(!v||v.next===v.prev)return m;if(f&&(v=function(e,t,i,a){for(var o=new Array,s=0,l=t.length;s<l;s++){var p=n(e,t[s]*a,s<l-1?t[s+1]*a:e.length,a,!1);p===p.next&&(p.steiner=!0),o.push(c(p))}o.sort(y);for(var d=0,f=o;d<f.length;d++)u(f[d],i),i=r(i,i.next);return i}(e,t,v,a)),e.length>80*a){o=l=e[0],s=p=e[1];for(var g=a;g<h;g+=a){var _=e[g],b=e[g+1];o=Math.min(o,_),s=Math.min(s,b),l=Math.max(l,_),p=Math.max(p,b)}d=0!==(d=Math.max(l-o,p-s))?1/d:0}return i(v,m,a,o,s,d),m},t.deviation=function(e,t,n,r){var i=t&&t.length,a=Math.abs(f(e,0,i?t[0]*n:e.length,n));if(i)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(f(e,t[o]*n,o<s-1?t[o+1]*n:e.length,n));var l=0;for(o=0;o<r.length;o+=3){var c=r[o]*n,u=r[o+1]*n,p=r[o+2]*n;l+=Math.abs((e[c]-e[p])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[p+1]-e[c+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)};var S=function(e,t,n){this.index=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}).apply(null,r))||(e.exports=i)},"1eTA":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("DtIM")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0}),t.canMoveZ=function(e,t){return void 0===t&&(t=r.getGraphicEffectiveElevationInfo(e)),"on-the-ground"!==t.mode&&!(n.isNone(e.geometry)||!e.geometry.hasZ)},t.disableDisplayOnGrab=function(e,t){var r=null,i=e.events.on("grab-changed",(function(i){n.isSome(r)&&(r.remove(),r=null),"start"===i.action?(r=e.disableDisplay(),t&&t(i)):t&&t(i)}));return{remove:function(){n.isSome(r)&&r.remove(),i.remove()}}}}).apply(null,r))||(e.exports=i)},"1f+t":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e,t,n){for(var r=0;r<n;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDouble=function(e,t){i[0]=e,i[1]=e-i[0],t[0]=i[0],t[1]=i[1]},t.encodeDoubleArray=n,t.decodeDoubleArray=function(e,t,n){for(var r=0;r<n;++r)t[r]=e[2*r]+e[2*r+1]},t.encodeDoubleArraySplit=function(e,t,a,o){for(var s=0;s<o;++s)r[0]=e[s],n(r,i,1),t[s]=i[0],a[s]=i[1]};var r=new Float64Array(1),i=new Float32Array(2)}).apply(null,r))||(e.exports=i)},"1m5D":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("CIzB")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.mat4f64=n}).apply(null,r))||(e.exports=i)},"2Mej":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("0LE5"),n("Rdxj"),n("KPBO"),n("qUb7")],void 0===(i=(function(e,t,n,r,i,a,o){function s(e){return(e+1)*(e+1)}function l(e){return n.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function c(e,t,n){var r=e[0],i=e[1],a=e[2],o=n||[];return o.length=s(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*a,o[3]=.4886025119*i),t>=2&&(o[4]=1.09254843059*r*i,o[5]=1.09254843059*i*a,o[6]=.31539156525*(3*a*a-1),o[7]=1.09254843059*r*a,o[8]=.54627421529*(r*r-i*i)),o}function u(e,t){var n=s(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=n;for(var i=0;i<n;i++)r.r[i]=r.g[i]=r.b[i]=0;return r}function p(e,t){for(var n=l(t.r.length),i=0,o=e;i<o.length;i++){var s=o[i];r.vec3.negate(y,s.direction),c(y,n,m),a.elementwiseProduct(m,_),a.scalarProduct(m,s.intensity[0],g),a.add(t.r,g),a.scalarProduct(m,s.intensity[1],g),a.add(t.g,g),a.scalarProduct(m,s.intensity[2],g),a.add(t.b,g)}return t}function d(e,t){c(y,0,m);for(var n=0,r=e;n<r.length;n++){var i=r[n];t.r[0]+=m[0]*_[0]*i.intensity[0]*4*Math.PI,t.g[0]+=m[0]*_[0]*i.intensity[1]*4*Math.PI,t.b[0]+=m[0]*_[0]*i.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.numberOfCoefficients=s,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=l,t.computeCoefficients=c,t.initSHCoefficients=u,t.projectFillLights=p,t.projectAmbientLights=d,t.combineLights=function(e,t,n){u(t,n.sphericalHarmonics.sh),r.vec3.set(n.main.intensity,0,0,0);var i=!1,s=f,l=h,c=v;s.length=0,l.length=0,c.length=0;for(var m=0,g=e;m<g.length;m++)(b=g[m])instanceof o.MainLight&&!i?(r.vec3.copy(n.main.direction,b.direction),n.main.intensity[0]=b.intensity[0],n.main.intensity[1]=b.intensity[1],n.main.intensity[2]=b.intensity[2],n.main.castShadows=b.castShadows,i=!0):b instanceof o.MainLight||b instanceof o.FillLight?s.push(b):b instanceof o.AmbientLight?l.push(b):b instanceof o.SphericalHarmonicsLight&&c.push(b);p(s,n.sphericalHarmonics.sh),d(l,n.sphericalHarmonics.sh);for(var y=0,_=c;y<_.length;y++){var b=_[y];a.add(n.sphericalHarmonics.sh.r,b.sh.r),a.add(n.sphericalHarmonics.sh.g,b.sh.g),a.add(n.sphericalHarmonics.sh.b,b.sh.b)}};var f=[],h=[],v=[],m=[0],g=[0],y=i.vec3f64.create(),_=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}).apply(null,r))||(e.exports=i)},"2W+Z":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("8MXS"),n("ys4y"),n("ZO6V"),n("ZJC8"),n("yqrJ")],void 0===(i=(function(e,t,n,r,i,a,o,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e){this.resourceFactory=e,this._resources=null,this._hidden=!1,this._attached=!1}return e.prototype.destroy=function(){this._destroyResources()},Object.defineProperty(e.prototype,"object",{get:function(){return n.isSome(this._resources)?this._resources.object:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resources",{get:function(){return n.isSome(this._resources)?this._resources.external:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this._hidden},set:function(e){e!==this._hidden&&(this._hidden=e,this._syncHidden())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())},enumerable:!0,configurable:!0}),e.prototype.recreate=function(){this.attached&&this._createResources()},e.prototype.recreateGeometry=function(){if(this.resourceFactory.recreateGeometry){if(!n.isNone(this._resources)){var e=this._resources.object,t=this.resourceFactory.view._stage;this._resources.external.forEach((function(e){e instanceof i&&t.remove(2,e.id)})),e.removeAllGeometries();for(var r=0,a=this.resourceFactory.recreateGeometry(this._resources.external,e,this._resources.layer);r<a.length;r++)t.add(2,a[r])}}else this.recreate()},e.prototype._createOrDestroyResources=function(){this._attached?this._resources||this._createResources():this._destroyResources()},e.prototype._createResources=function(){var e=this;this._destroyResources();var t=this.resourceFactory.view._stage;if(t){var n=new a("element",{isPickable:!1});t.add(0,n),t.addToViewContent([n.id]);var i=new o({idHint:"element",castShadow:!1}),s=this.resourceFactory.createResources(i,n);s.forEach((function(n){t.add(e._contentTypeFromResource(n),n)})),t.add(1,i),n.addObject(i),this._hidden&&i.setVisible(!1);var l=this.resourceFactory.cameraChanged?r.init(this.resourceFactory.view.state,"camera",(function(t){return e.resourceFactory.cameraChanged(t)})):null;this._resources={layer:n,object:i,external:s,cameraHandle:l}}},e.prototype._contentTypeFromResource=function(e){return e instanceof i?2:e instanceof s?4:3},e.prototype._destroyResources=function(){var e=this;if(!n.isNone(this._resources)){var t=this.resourceFactory.view._stage;t.remove(1,this._resources.object.id),t.remove(0,this._resources.layer.id),this._resources.external.forEach((function(n){t.remove(e._contentTypeFromResource(n),n.id),"dispose"in n&&n.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}},e.prototype._syncHidden=function(){n.isNone(this._resources)||this._resources.object.setVisible(!this._hidden)},e}();t.VisualElementResources=l}).apply(null,r))||(e.exports=i)},"2eYJ":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("qsST"),n("xoE+"),n("PHan"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("AzkI"),n("JjCO"),n("N5NQ"),n("GG08"),n("4p4v"),n("18xY")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v){Object.defineProperty(t,"__esModule",{value:!0});var m=r.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function g(e){return void 0===e&&(e=t.UP),{plane:f.create(e.plane),origin:c.vec3f64.clone(e.origin),basis1:c.vec3f64.clone(e.basis1),basis2:c.vec3f64.clone(e.basis2)}}function y(e,t){return void 0===t&&(t=g()),_(e.origin,e.basis1,e.basis2,t)}function _(e,t,n,r){return void 0===r&&(r=g()),l.vec3.copy(r.origin,e),l.vec3.copy(r.basis1,t),l.vec3.copy(r.basis2,n),b(r),function(e,t){Math.abs(l.vec3.dot(e.basis1,e.basis2)/(l.vec3.length(e.basis1)*l.vec3.length(e.basis2)))>1e-6&&m.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(l.vec3.dot(e.basis1,T(e)))>1e-6&&m.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-l.vec3.dot(T(e),e.origin)-e.plane[3])>1e-6&&m.warn(t,"Plane offset is not consistent with plane origin")}(r,"fromValues()"),r}function b(e){f.fromVectorsAndPoint(e.basis2,e.basis1,e.origin,e.plane)}function x(e,t,n){e!==n&&y(e,n);var r=l.vec3.scale(p.sv3d.get(),T(e),t);return l.vec3.add(n.origin,n.origin,r),n.plane[3]-=t,n}function w(e,t){void 0===t&&(t=g());var n=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return l.vec3.set(t.origin,e[0]+n,e[1]+r,0),l.vec3.set(t.basis1,n,0,0),l.vec3.set(t.basis2,0,r,0),f.fromValues(0,0,1,0,t.plane),t}function S(e,t,n){return!!f.intersectRay(e.plane,t,n)&&R(e,n)}function O(e,t,n){var r=V.get();I(e,t,r,V.get());for(var a=Number.POSITIVE_INFINITY,o=0,s=F;o<s.length;o++){var c=E(e,s[o],z.get()),d=p.sv3d.get();if(f.intersectLineSegment(r,c,d)){var h=u.directionFromTo(p.sv3d.get(),t.origin,d),v=Math.abs(i.acosClamped(l.vec3.dot(t.direction,h)));v<a&&(a=v,l.vec3.copy(n,d))}}return a===Number.POSITIVE_INFINITY?P(e,t,n):n}function P(e,t,n){if(S(e,t,n))return n;var r=V.get(),i=V.get();I(e,t,r,i);for(var a=Number.POSITIVE_INFINITY,o=0,s=F;o<s.length;o++){var c=E(e,s[o],z.get()),u=p.sv3d.get();if(f.intersectLineSegmentClamp(r,c,u)){var d=h.distance2(t,u);if(!f.isPointInside(i,u))continue;d<a&&(a=d,l.vec3.copy(n,u))}}return A(e,t.origin)<a&&M(e,t.origin,n),n}function M(e,t,n){var r=f.projectPoint(e.plane,t,p.sv3d.get()),i=d.projectPointClamp(j(e,e.basis1),r,-1,1,p.sv3d.get()),a=d.projectPointClamp(j(e,e.basis2),r,-1,1,p.sv3d.get());return l.vec3.subtract(n,l.vec3.add(p.sv3d.get(),i,a),e.origin),n}function C(e,t,n){var r=e.origin,i=e.basis1,a=e.basis2,o=l.vec3.subtract(p.sv3d.get(),t,r),s=v.projectPointSignedLength(i,o),c=v.projectPointSignedLength(a,o),u=v.projectPointSignedLength(T(e),o);return l.vec3.set(n,s,c,u)}function A(e,t){var n=C(e,t,p.sv3d.get()),r=e.basis2,i=l.vec3.length(e.basis1),a=l.vec3.length(r),o=Math.max(Math.abs(n[0])-i,0),s=Math.max(Math.abs(n[1])-a,0),c=n[2];return o*o+s*s+c*c}function D(e,t){var n=-e.plane[3];return v.projectPointSignedLength(T(e),t)-n}function T(e){return f.normal(e.plane)}function R(e,t){var n=l.vec3.subtract(p.sv3d.get(),t,e.origin),r=l.vec3.squaredLength(e.basis1),i=l.vec3.squaredLength(e.basis2),a=l.vec3.dot(e.basis1,n),o=l.vec3.dot(e.basis2,n);return-a-r<0&&a-r<0&&-o-i<0&&o-i<0}function j(e,t){var n=z.get();return l.vec3.copy(n.origin,e.origin),l.vec3.copy(n.vector,t),n}function E(e,t,n){var r=e.basis1,i=e.basis2,a=e.origin,o=l.vec3.scale(p.sv3d.get(),r,t.origin[0]),s=l.vec3.scale(p.sv3d.get(),i,t.origin[1]);l.vec3.add(n.origin,o,s),l.vec3.add(n.origin,n.origin,a);var c=l.vec3.scale(p.sv3d.get(),r,t.direction[0]),u=l.vec3.scale(p.sv3d.get(),i,t.direction[1]);return l.vec3.scale(n.vector,l.vec3.add(c,c,u),2),n}function I(e,t,n,r){var i=T(e);f.fromVectorsAndPoint(i,t.direction,t.origin,n),f.fromVectorsAndPoint(f.normal(n),i,t.origin,r)}t.BoundedPlaneClass=function(){this.plane=f.create(),this.origin=c.vec3f64.create(),this.basis1=c.vec3f64.create(),this.basis2=c.vec3f64.create()},t.create=g,t.wrap=function(e,t,n){var r=N.get();return r.origin=e,r.basis1=t,r.basis2=n,r.plane=f.wrap(0,0,0,0),b(r),r},t.copy=y,t.fromValues=_,t.updateUnboundedPlane=b,t.elevate=x,t.setExtent=function(e,t,n){return w(t,n),x(n,D(e,e.origin),n),n},t.fromAABoundingRect=w,t.intersectRay=S,t.intersectRayClosestSilhouette=function(e,t,n){if(S(e,t,n))return n;var r=O(e,t,p.sv3d.get());return l.vec3.add(n,t.origin,l.vec3.scale(p.sv3d.get(),t.direction,l.vec3.distance(t.origin,r)/l.vec3.length(t.direction))),n},t.closestPointOnSilhouette=O,t.closestPoint=P,t.projectPoint=M,t.projectPointLocal=C,t.distance2=A,t.distance=function(e,t){return Math.sqrt(A(e,t))},t.distanceToSilhouette=function(e,t){for(var n=Number.NEGATIVE_INFINITY,r=0,i=F;r<i.length;r++){var a=E(e,i[r],z.get()),o=d.distance2(a,t);o>n&&(n=o)}return Math.sqrt(n)},t.extrusionContainsPoint=function(e,t){return f.isPointInside(e.plane,t)&&R(e,t)},t.axisAt=function(e,t,r,i){return function(e,t,r){switch(t){case 0:l.vec3.copy(r,e.basis1),l.vec3.normalize(r,r);break;case 1:l.vec3.copy(r,e.basis2),l.vec3.normalize(r,r);break;case 2:l.vec3.copy(r,T(e));break;default:n.neverReached(t)}return r}(e,r,i)},t.altitudeAt=D,t.setAltitudeAt=function(e,t,n,r){var i=D(e,t),a=l.vec3.scale(L,T(e),n-i);return l.vec3.add(r,t,a),r},t.equals=function(e,t){return l.vec3.equals(e.basis1,t.basis1)&&l.vec3.equals(e.basis2,t.basis2)&&l.vec3.equals(e.origin,t.origin)},t.transform=function(e,t,n){return e!==n&&y(e,n),o.mat4.invert(U,t),o.mat4.transpose(U,U),l.vec3.transformMat4(n.basis1,e.basis1,U),l.vec3.transformMat4(n.basis2,e.basis2,U),l.vec3.transformMat4(n.plane,e.plane,U),l.vec3.transformMat4(n.origin,e.origin,t),f.setOffsetFromPoint(n.plane,n.origin,n.plane),n},t.rotate=function(e,t,n,r){return e!==r&&y(e,r),o.mat4.rotate(G,o.mat4.identity(G),t,n),l.vec3.transformMat4(r.basis1,e.basis1,G),l.vec3.transformMat4(r.basis2,e.basis2,G),b(r),r},t.normal=T,t.UP={plane:f.create(),origin:c.vec3f64.fromValues(0,0,0),basis1:c.vec3f64.fromValues(1,0,0),basis2:c.vec3f64.fromValues(0,1,0)};var V=new a.ObjectStack(f.create),z=new a.ObjectStack(d.create),L=c.vec3f64.create(),N=new a.ObjectStack((function(){return{origin:null,basis1:null,basis2:null,plane:null}})),F=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],U=s.mat4f64.create(),G=s.mat4f64.create()}).apply(null,r))||(e.exports=i)},"2o+p":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei"),n("s6rJ")],void 0===(i=(function(e,t,n,r,i){function a(e){e.vertex.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize = 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "],["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize = 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "])))),e.vertex.code.add(r.glsl(s||(s=n.__makeTemplateObject(["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "],["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "])))),e.vertex.code.add(r.glsl(l||(l=n.__makeTemplateObject(["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "],["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "])))),e.vertex.code.add(r.glsl(c||(c=n.__makeTemplateObject(["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "],["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "])))),e.vertex.code.add(r.glsl(u||(u=n.__makeTemplateObject(["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "],["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "])))),e.vertex.code.add(r.glsl(p||(p=n.__makeTemplateObject(["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "],["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "])))),e.vertex.code.add(r.glsl(d||(d=n.__makeTemplateObject(["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "]))))}var o,s,l,c,u,p,d;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSizePerspective=a,function(e){e.bindUniforms=function(e,t){t.screenSizePerspective&&(i.bindScreenSizePerspective(t.screenSizePerspective,e,"screenSizePerspective"),i.bindScreenSizePerspective(t.screenSizePerspectiveAlignment||t.screenSizePerspective,e,"screenSizePerspectiveAlignment"))}}(a=t.ScreenSizePerspective||(t.ScreenSizePerspective={}))}).apply(null,r))||(e.exports=i)},"35hF":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultColor=[252,146,31,255],t.defaultOutlineColor=[153,153,153,255],t.defaultPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",size:6,color:t.defaultColor,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},t.defaultPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",width:.75,color:t.defaultColor},t.defaultPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},t.defaultTextSymbolJSON={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},t.errorPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},t.errorPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},t.errorPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}}).apply(null,r))||(e.exports=i)},"3PFg":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){function i(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add("instanceFeatureAttribute","vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "],["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "])))),e.vertex.code.add(r.glsl(s||(s=n.__makeTemplateObject(["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "],["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "])),t.vvInstancingEnabled?r.glsl(o||(o=n.__makeTemplateObject(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"],["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):e.vertex.code.add(r.glsl(l||(l=n.__makeTemplateObject(["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "],["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "])))),t.vvColor?(e.vertex.defines.addInt("VV_COLOR_N",8),e.vertex.code.add(r.glsl(u||(u=n.__makeTemplateObject(["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < VV_COLOR_N; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ","\n    "],["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < VV_COLOR_N; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ","\n    "])),t.vvInstancingEnabled?r.glsl(c||(c=n.__makeTemplateObject(["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"],["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"]))):""))):e.vertex.code.add(r.glsl(p||(p=n.__makeTemplateObject(["\n      vec4 vvColor() { return vec4(1.0); }\n    "],["\n      vec4 vvColor() { return vec4(1.0); }\n    "]))))}var a,o,s,l,c,u,p;Object.defineProperty(t,"__esModule",{value:!0}),t.VisualVariables=i,function(e){function t(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}e.bindUniforms=t,e.bindUniformsWithOpacity=function(e,n){t(e,n),n.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",n.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",n.vvOpacityOpacities))},e.bindUniformsForSymbols=function(e,n){t(e,n),n.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",n.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",n.vvSymbolRotationMatrix))}}(i=t.VisualVariables||(t.VisualVariables={}))}).apply(null,r))||(e.exports=i)},"3RHn":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("KBgh"),n("0LE5"),n("Rdxj"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,a){var o=function(){function e(t,n,o,s){this.primitiveIndices=t,this._numIndexPerPrimitive=n,this.indices=o,this._position=s,this.center=i.vec3f64.create(),a.assert(t.length>=1),a.assert(o.length%this._numIndexPerPrimitive==0),a.assert(o.length>=t.length*this._numIndexPerPrimitive),a.assert(3===this._position.size||4===this._position.size);var l=this._position,c=l.data,u=l.offsetIdx,p=l.strideIdx,d=0,f=t.length,h=u+p*o[this._numIndexPerPrimitive*t[d]];for(e.tmpIndices.clear(),e.tmpIndices.push(h),this.bbMin=i.vec3f64.fromValues(c[h],c[h+1],c[h+2]),this.bbMax=i.vec3f64.clone(this.bbMin);d<f;++d)for(var v=this._numIndexPerPrimitive*t[d],m=0;m<this._numIndexPerPrimitive;++m){e.tmpIndices.push(h=u+p*o[v+m]);var g=c[h];this.bbMin[0]=Math.min(g,this.bbMin[0]),this.bbMax[0]=Math.max(g,this.bbMax[0]),g=c[h+1],this.bbMin[1]=Math.min(g,this.bbMin[1]),this.bbMax[1]=Math.max(g,this.bbMax[1]),g=c[h+2],this.bbMin[2]=Math.min(g,this.bbMin[2]),this.bbMax[2]=Math.max(g,this.bbMax[2])}r.vec3.lerp(this.center,this.bbMin,this.bbMax,.5),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var y=this.bsRadius*this.bsRadius;for(d=0;d<e.tmpIndices.length;++d){var _=c[h=e.tmpIndices.data[d]]-this.center[0],b=c[h+1]-this.center[1],x=c[h+2]-this.center[2],w=_*_+b*b+x*x;if(!(w<=y)){var S=Math.sqrt(w),O=.5*(S-this.bsRadius);this.bsRadius=this.bsRadius+O,y=this.bsRadius*this.bsRadius;var P=O/S;this.center[0]+=_*P,this.center[1]+=b*P,this.center[2]+=x*P}}e.tmpIndices.clear()}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this._children)return this._children;if(r.vec3.squaredDistance(this.bbMin,this.bbMax)>1){for(var t=r.vec3.lerp(i.vec3f64.create(),this.bbMin,this.bbMax,.5),n=this.primitiveIndices.length,a=new Uint8Array(n),o=new Array(8),s=0;s<8;++s)o[s]=0;var l=this._position,c=l.data,u=l.offsetIdx,p=l.strideIdx;for(s=0;s<n;++s){for(var d=0,f=this._numIndexPerPrimitive*this.primitiveIndices[s],h=u+p*this.indices[f],v=c[h],m=c[h+1],g=c[h+2],y=1;y<this._numIndexPerPrimitive;++y){var _=c[h=u+p*this.indices[f+y]],b=c[h+1],x=c[h+2];_<v&&(v=_),b<m&&(m=b),x<g&&(g=x)}v<t[0]&&(d|=1),m<t[1]&&(d|=2),g<t[2]&&(d|=4),a[s]=d,++o[d]}var w=0;for(s=0;s<8;++s)o[s]>0&&++w;if(w<2)return;var S=new Array(8);for(s=0;s<8;++s)S[s]=o[s]>0?new Uint32Array(o[s]):void 0;for(s=0;s<8;++s)o[s]=0;for(s=0;s<n;++s)S[d=a[s]][o[d]++]=this.primitiveIndices[s];for(this._children=new Array(8),s=0;s<8;++s)void 0!==S[s]&&(this._children[s]=new e(S[s],this._numIndexPerPrimitive,this.indices,this._position))}return this._children},e}();return function(e){e.tmpIndices=new n({deallocator:null})}(o||(o={})),o}).apply(null,r))||(e.exports=i)},"3Zlx":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("1E+e"),n("ZPQp"),n("jmRc")],void 0===(i=(function(e,t,n,r,i){function a(e,t,n){for(var i=e.length,a=new Array(i),s=new Array(i),l=new Array(i),c=0,u=0,p=0,d=0,f=0;f<i;++f)d+=e[f].length;for(var h=new Float64Array(3*d),v=0,m=i-1;m>=0;m--){var g=e[m],y=1===n&&!r.isClockwise(g,!1,!1);if(y&&1!==i)a[c++]=g;else{var _=g.length;for(f=0;f<c;++f)_+=a[f].length;var b={index:v,pathLengths:new Array(c+1),count:_,holeIndices:new Array(c)};b.pathLengths[0]=g.length,g.length>0&&(l[p++]={index:v,count:g.length}),v=y?o(g,g.length-1,-1,h,v,g.length,t):o(g,0,1,h,v,g.length,t);for(var x=0;x<c;++x){var w=a[x];b.holeIndices[x]=v,b.pathLengths[x+1]=w.length,w.length>0&&(l[p++]={index:v,count:w.length}),v=o(w,0,1,h,v,w.length,t)}c=0,b.count>0&&(s[u++]=b)}}for(x=0;x<c;++x)(w=a[x]).length>0&&(l[p++]={index:v,count:w.length}),v=o(w,0,1,h,v,w.length,t);return u<i&&(s.length=u),p<i&&(l.length=p),{position:h,polygons:s,outlines:l}}function o(e,t,n,r,i,a,o){i*=3;for(var s=0;s<a;++s){var l=e[t];r[i++]=l[0],r[i++]=l[1],r[i++]=o?l[2]:0,t+=n}return i/3}Object.defineProperty(t,"__esModule",{value:!0}),t.triangulate=function(e){for(var t=a(e.rings,e.hasZ,1),r=[],o=0,s=0,l=function(e){var i=e.index,a=new Float64Array(t.position.buffer,3*i*t.position.BYTES_PER_ELEMENT,3*e.count),l=e.holeIndices.map((function(e){return e-i})),c=new Uint32Array(n.earcut(a,l,3));r.push({position:a,faces:c}),o+=a.length,s+=c.length},c=0,u=t.polygons;c<u.length;c++)l(u[c]);var p=function(e,t,n){if(1===e.length)return e[0];for(var r=new Float64Array(t),i=new Uint32Array(n),a=0,o=0,s=0,l=0,c=e;l<c.length;l++){for(var u=c[l],p=0;p<u.position.length;p++)r[a++]=u.position[p];for(p=0;p<u.faces.length;p++)i[o++]=u.faces[p]+s;s=a/3}return{position:r,faces:i}}(r,o,s),d=i.default(p.position.buffer,6,{originalIndices:p.faces});return p.position=new Float64Array(d.buffer),p.faces=d.indices,p},t.pathsToTriangulationInfo=a}).apply(null,r))||(e.exports=i)},"3gjc":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(){return new Float32Array(4)}function r(e,t,n,r){var i=new Float32Array(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function i(){return n()}function a(){return r(1,1,1,1)}function o(){return r(1,0,0,0)}function s(){return r(0,1,0,0)}function l(){return r(0,0,1,0)}function c(){return r(0,0,0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.clone=function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=r,t.createView=function(e,t){return new Float32Array(e,t,4)},t.zeros=i,t.ones=a,t.unitX=o,t.unitY=s,t.unitZ=l,t.unitW=c,t.ZEROS=i(),t.ONES=a(),t.UNIT_X=o(),t.UNIT_Y=s(),t.UNIT_Z=l(),t.UNIT_W=c()}).apply(null,r))||(e.exports=i)},"3kdR":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("FXVB"),n("oZZu"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,a){function o(e,t){e.vertex.code.add(a.glsl(t.linearDepth?s||(s=n.__makeTemplateObject(["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye = view * vec4(pos, 1.0);\n      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "],["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye = view * vec4(pos, 1.0);\n      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "])):l||(l=n.__makeTemplateObject(["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "],["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "]))))}Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=o,function(e){function t(e,t,n){r.mat4.translate(c,n,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",c)}e.bindUniformsCustomOrigin=t,e.bindUniforms=function(e,n){t(e,n.origin,n.view)}}(o=t.Transform||(t.Transform={}));var s,l,c=i.mat4f32.create()}).apply(null,r))||(e.exports=i)},"48/q":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("woUR")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._available=!0}return Object.defineProperty(e.prototype,"location",{set:function(e){this.forEachManipulator3D((function(t){return t.location=e}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationAlignedLocation",{set:function(e){this.forEachManipulator3D((function(t){return t.elevationAlignedLocation=e}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{set:function(e){this.forEachManipulator3D((function(t){return t.elevationInfo=e}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"available",{get:function(){return this._available},set:function(e){this._available=e,this.forEachManipulator3D((function(t){return t.available=e}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grabbing",{get:function(){return this.someManipulator((function(e){return e.grabbing}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragging",{get:function(){return this.someManipulator((function(e){return e.dragging}))},enumerable:!0,configurable:!0}),e.prototype.hasManipulator=function(e){return this.someManipulator((function(t){return t===e}))},e.prototype.someManipulator=function(e){var t=!1;return this.forEachManipulator((function(n){!t&&e(n)&&(t=!0)})),t},e.prototype.forEachManipulator3D=function(e){this.forEachManipulator((function(t,r){t instanceof n.Manipulator3D&&e(t,r)}))},e}();t.Manipulation=r}).apply(null,r))||(e.exports=i)},"4QR8":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("Vx27"),n("qysZ"),n("DtIM"),n("5T2R"),n("1eTA"),n("G+tB"),n("Fe95"),n("BhkK"),n("RWrl"),n("/NuL"),n("X7Ps")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g){Object.defineProperty(t,"__esModule",{value:!0});var y=function(e){function t(t){var n=e.call(this,t)||this;return n.enableZ=!0,n.enableRotation=!0,n.enableScaling=!0,n.type="transform-3d",n.handles=new i,n.scaleRotate=null,n}return n.__extends(t,e),t.prototype.initialize=function(){var e=this;this.graphicState=new m.GraphicState({graphic:this.graphic}),this.moveManipulation=new h.MoveManipulation({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&p.canMoveZ(this.graphic),radius:h.MoveManipulation.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((function(t){return e.handles.add(t.events.on("immediate-click",(function(e){return e.stopPropagation()})))})),this.moveManipulation.elevationInfo=c.getGraphicEffectiveElevationInfo(this.graphic),this.moveManipulation.createGraphicDragPipeline(this.graphicState,(function(t){var n={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(t.action){case"start":e.emit("graphic-translate-start",n);break;case"update":e.emit("graphic-translate",n);break;case"end":e.emit("graphic-translate-stop",n)}})),this.moveManipulation.angle=this.symbolRotationAngle,(this.enableScaling||this.enableRotation)&&(this.scaleRotate=new v.GraphicScaleRotateTransform({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate"}),this.handles.add(this.scaleRotate.events.on("scale-changed",(function(){return e.onScaleChanged()})))),this.handles.add([d.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return a.makeHandle()}}),this.graphic.watch("symbol",(function(){return e.updateMoveAngle()})),this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(function(){return e.updateMoveAngle()}))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()},t.prototype.forEachManipulator=function(e){this.moveManipulation.forEachManipulator(e),o.isSome(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)},t.prototype.hideManipulatorsForGraphicState=function(){var e=this;return this.graphicState.watch("displaying",(function(t){e.forEachManipulator((function(e){return e.available=t})),e.moveManipulation.zManipulation.available=t&&e.enableZ&&p.canMoveZ(e.graphic)}))},t.prototype.destroy=function(){this.handles.destroy(),this.moveManipulation.destroy(),o.isSome(this.scaleRotate)&&(this.scaleRotate.destroy(),this.scaleRotate=null),this._set("view",null),this._set("graphic",null)},Object.defineProperty(t.prototype,"snapToScene",{set:function(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolRotationAngle",{get:function(){var e=this.graphic.symbol;if(e){var t=e.symbolLayers.find((function(e){return"object"===e.type}));return l.toRadian(-(t&&t.heading||0))}return 0},enumerable:!0,configurable:!0}),t.prototype.reset=function(){},t.prototype.onDetach=function(){o.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()},t.prototype.onHide=function(){o.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()},t.prototype.onScaleChanged=function(){if(!o.isNone(this.scaleRotate)){var e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}},t.prototype.updateMoveAngle=function(){this.moveManipulation.angle="local"===this.view.viewingMode||this.view.scale<f.ALIGN_ARROWS_SCALE_THRESHOLD?this.symbolRotationAngle:0},t.prototype.onGeometryChanged=function(){u.placeAtGraphic(this.view,this.moveManipulation,this.graphic)},Object.defineProperty(t.prototype,"test",{get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:o.isSome(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}},enumerable:!0,configurable:!0}),n.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"graphic",void 0),n.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"enableZ",void 0),n.__decorate([s.property()],t.prototype,"enableRotation",void 0),n.__decorate([s.property()],t.prototype,"enableScaling",void 0),n.__decorate([s.property({value:!1})],t.prototype,"snapToScene",null),n.__decorate([s.property({readOnly:!0})],t.prototype,"type",void 0),n.__decorate([s.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],t)}(r.EventedMixin(g.InteractiveToolBase));t.GraphicTransformTool=y}).apply(null,r))||(e.exports=i)},"4p4v":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("PHan"),n("jBNx"),n("W9tT"),n("0LE5"),n("Rdxj"),n("JjCO")],void 0===(i=(function(e,t,n,r,i,a,o,s){function l(e){return e?{origin:o.vec3f64.clone(e.origin),direction:o.vec3f64.clone(e.direction)}:{origin:o.vec3f64.create(),direction:o.vec3f64.create()}}function c(e,t,n){return void 0===n&&(n=l()),a.vec3.copy(n.origin,e),a.vec3.copy(n.direction,t),n}function u(e,t,n){void 0===n&&(n=l());var o=r.castRenderScreenPointArray3(i.vec2.copy(s.sv3d.get(),t));o[2]=0,e.unprojectPoint(o,n.origin);var c=r.castRenderScreenPointArray3(i.vec2.copy(s.sv3d.get(),t));c[2]=1;var u=e.unprojectPoint(c,s.sv3d.get());return a.vec3.subtract(n.direction,u,n.origin),n}function p(e,t,n){void 0===n&&(n=l()),a.vec3.copy(n.origin,e.eye);var r=a.vec3.set(s.sv3d.get(),t[0],t[1],1),i=e.unprojectPoint(r,s.sv3d.get());return a.vec3.subtract(n.direction,i,n.origin),n}function d(e,t){var n=a.vec3.cross(s.sv3d.get(),a.vec3.normalize(s.sv3d.get(),e.direction),a.vec3.subtract(s.sv3d.get(),t,e.origin));return a.vec3.dot(n,n)}function f(){return{origin:null,direction:null}}Object.defineProperty(t,"__esModule",{value:!0}),t.create=l,t.wrap=function(e,t){var n=h.get();return n.origin=e,n.direction=t,n},t.copy=function(e,t){return void 0===t&&(t=l()),c(e.origin,e.direction,t)},t.fromPoints=function(e,t,n){return void 0===n&&(n=l()),a.vec3.copy(n.origin,e),a.vec3.subtract(n.direction,t,e),n},t.fromValues=c,t.fromScreen=function(e,t,n){return void 0===n&&(n=l()),u(e,e.screenToRender(t,r.castRenderScreenPointArray3(s.sv3d.get())),n)},t.fromRender=u,t.fromScreenAtEye=function(e,t,n){return void 0===n&&(n=l()),p(e,e.screenToRender(t,r.castRenderScreenPointArray3(s.sv3d.get())),n)},t.fromRenderAtEye=p,t.distance2=d,t.distance=function(e,t){return Math.sqrt(d(e,t))},t.closestPoint=function(e,t,n){var r=a.vec3.dot(e.direction,a.vec3.subtract(n,t,e.origin));return a.vec3.add(n,e.origin,a.vec3.scale(n,e.direction,r)),n},t.createWrapper=f;var h=new n.ObjectStack(f)}).apply(null,r))||(e.exports=i)},"4ziW":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("0LE5"),n("vlC2"),n("Rdxj"),n("aWgr"),n("83/a"),n("AgDx"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){var c,u,p,d,f=o.Vec3Compact;!function(e){for(var t=.5,n=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],i=[0,0,1,0,1,1,0,1],a=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],o=new Array(36),c=0;c<6;c++)for(var u=0;u<6;u++)o[6*c+u]=c;var p=new Array(36);for(c=0;c<6;c++)p[6*c+0]=0,p[6*c+1]=1,p[6*c+2]=2,p[6*c+3]=2,p[6*c+4]=3,p[6*c+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(24),c=0;c<8;c++)t[3*c]=n[c][0]*e[0],t[3*c+1]=n[c][1]*e[1],t[3*c+2]=n[c][2]*e[2];var u={};u[l.VertexAttrConstants.POSITION]=new Uint32Array(a),u[l.VertexAttrConstants.NORMAL]=new Uint32Array(o),u[l.VertexAttrConstants.UV0]=new Uint32Array(p);var d={};return d[l.VertexAttrConstants.POSITION]={size:3,data:t},d[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(r)},d[l.VertexAttrConstants.UV0]={size:2,data:new Float32Array(i)},new s.GeometryData(d,u)}}(c||(c={})),function(e){var t=.5,n=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],i=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],a=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(18),o=0;o<6;o++)t[3*o]=n[o][0]*e[0],t[3*o+1]=n[o][1]*e[1],t[3*o+2]=n[o][2]*e[2];var c={};c[l.VertexAttrConstants.POSITION]=new Uint32Array(i),c[l.VertexAttrConstants.NORMAL]=new Uint32Array(a);var u={};return u[l.VertexAttrConstants.POSITION]={size:3,data:t},u[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(r)},new s.GeometryData(u,c)}}(u||(u={})),function(e){var t=.5,i=r.vec3f32.fromValues(-t,0,-t),a=r.vec3f32.fromValues(t,0,-t),o=r.vec3f32.fromValues(0,0,t),c=r.vec3f32.fromValues(0,.5,0),u=r.vec3f32.create(),p=r.vec3f32.create(),d=r.vec3f32.create(),f=r.vec3f32.create(),h=r.vec3f32.create();n.vec3.subtract(u,i,c),n.vec3.subtract(p,i,a),n.vec3.cross(d,u,p),n.vec3.normalize(d,d),n.vec3.subtract(u,a,c),n.vec3.subtract(p,a,o),n.vec3.cross(f,u,p),n.vec3.normalize(f,f),n.vec3.subtract(u,o,c),n.vec3.subtract(p,o,i),n.vec3.cross(h,u,p),n.vec3.normalize(h,h);var v=[i,a,o,c],m=[0,-1,0,d[0],d[1],d[2],f[0],f[1],f[2],h[0],h[1],h[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],y=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(12),n=0;n<4;n++)t[3*n]=v[n][0]*e[0],t[3*n+1]=v[n][1]*e[1],t[3*n+2]=v[n][2]*e[2];var r={};r[l.VertexAttrConstants.POSITION]=new Uint32Array(g),r[l.VertexAttrConstants.NORMAL]=new Uint32Array(y);var i={};return i[l.VertexAttrConstants.POSITION]={size:3,data:t},i[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(m)},new s.GeometryData(i,r)}}(p||(p={})),function(e){e.createBoxGeometry=c.createGeometry,e.createDiamondGeometry=u.createGeometry,e.createTetrahedronGeometry=p.createGeometry,e.createSphereGeometry=function(e,t,n,r,i,a,o){e=e||50,r=void 0!==r?r:-Math.PI,i=void 0!==i?i:2*Math.PI,a=void 0!==a?a:.5*-Math.PI,o=void 0!==o?o:Math.PI;for(var c=Math.max(3,Math.floor(t)||8),u=Math.max(2,Math.floor(n)||6),p=(c+1)*(u+1),d=new Float32Array(3*p),f=new Float32Array(3*p),h=new Float32Array(2*p),v=[],m=0,g=0;g<=u;g++){for(var y=[],_=g/u,b=a+_*o,x=Math.cos(b),w=0;w<=c;w++){var S=w/c,O=r+S*i,P=Math.cos(O)*x,M=Math.sin(b),C=-Math.sin(O)*x;d[3*m]=P*e,d[3*m+1]=M*e,d[3*m+2]=C*e,f[3*m]=P,f[3*m+1]=M,f[3*m+2]=C,h[2*m]=S,h[2*m+1]=_,y.push(m),++m}v.push(y)}var A=new Uint32Array(2*c*(u-1)*3);for(m=0,g=0;g<u;g++)for(w=0;w<c;w++){var D=v[g][w],T=v[g][w+1],R=v[g+1][w+1],j=v[g+1][w];0===g?(A[m++]=D,A[m++]=R,A[m++]=j):g===u-1?(A[m++]=D,A[m++]=T,A[m++]=R):(A[m++]=D,A[m++]=T,A[m++]=R,A[m++]=R,A[m++]=j,A[m++]=D)}l.assert(m===A.length);var E={};E[l.VertexAttrConstants.POSITION]=A,E[l.VertexAttrConstants.NORMAL]=A,E[l.VertexAttrConstants.UV0]=A;var I={};return I[l.VertexAttrConstants.POSITION]={size:3,data:d},I[l.VertexAttrConstants.NORMAL]={size:3,data:f},I[l.VertexAttrConstants.UV0]={size:2,data:h},new s.GeometryData(I,E)},e.createPolySphereGeometry=function(e,t,n){var r,i,a=e;if(n)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],i=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var o=a*(1+Math.sqrt(5))/2;r=[-a,o,0,a,o,0,-a,-o,0,a,-o,0,0,-a,o,0,a,o,0,-a,-o,0,a,-o,o,0,-a,o,0,a,-o,0,-a,-o,0,a],i=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var c=0;c<r.length;c+=3)f.scale(r,c,e/f.length(r,c));var u={};function p(t,n){var i;t>n&&(t=(i=[n,t])[0],n=i[1]);var a=t.toString()+"."+n.toString();if(u[a])return u[a];var o=r.length;return r.length+=3,f.add(r,3*t,r,3*n,r,o),f.scale(r,o,e/f.length(r,o)),u[a]=o/=3,o}for(c=0;c<t;c++){for(var d=i.length,h=new Uint32Array(4*d),v=0;v<d;v+=3){var m=i[v],g=i[v+1],y=i[v+2],_=p(m,g),b=p(g,y),x=p(y,m),w=4*v;h[w]=m,h[w+1]=_,h[w+2]=x,h[w+3]=g,h[w+4]=b,h[w+5]=_,h[w+6]=y,h[w+7]=x,h[w+8]=b,h[w+9]=_,h[w+10]=b,h[w+11]=x}i=h,u={}}var S=new Float32Array(r);for(c=0;c<S.length;c+=3)f.normalize(S,c);var O={};O[l.VertexAttrConstants.POSITION]=i,O[l.VertexAttrConstants.NORMAL]=i;var P={};return P[l.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(r)},P[l.VertexAttrConstants.NORMAL]={size:3,data:S},new s.GeometryData(P,O)},e.createPointGeometry=function(e,t,n,r,i,a,o,c){var u=t?new Float64Array([t[0],t[1],t[2]]):new Float32Array([0,0,0]),p=e?new Float32Array([e[0],e[1],e[2]]):new Float32Array([0,0,1]),d=a?new Float32Array(a):new Float32Array([0,0]),f=n?new Uint8Array([255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]):new Uint8Array([255,255,255,255]),h=null!=r&&2===r.length?new Float32Array(r):new Float32Array([1,1]),v={};if(v[l.VertexAttrConstants.POSITION]={size:3,data:u},v[l.VertexAttrConstants.NORMAL]={size:3,data:p},v[l.VertexAttrConstants.UV0]={size:d.length,data:d},v[l.VertexAttrConstants.COLOR]={size:4,data:f},v[l.VertexAttrConstants.SIZE]={size:2,data:h},null!=i){var m=new Float32Array([i[0],i[1],i[2],i[3]]);v[l.VertexAttrConstants.AUXPOS1]={size:4,data:m}}if(null!=o){var g=new Float32Array([o[0],o[1],o[2],o[3]]);v[l.VertexAttrConstants.AUXPOS2]={size:4,data:g}}return null!=c?(s.GeometryData.call(c,v,s.GeometryData.DefaultIndices,"point"),c):new s.GeometryData(v,s.GeometryData.DefaultIndices,"point")},e.updatePointGeometry=function(e,t,n,r,i,a,o,s){var c,u=s.vertexAttributes;return null!=e&&((c=u[l.VertexAttrConstants.NORMAL].data)[0]=e[0],c[1]=e[1],c[2]=e[2]),null!=t&&((c=u[l.VertexAttrConstants.POSITION].data)[0]=t[0],c[1]=t[1],c[2]=t[2]),null!=n&&((c=u[l.VertexAttrConstants.COLOR].data)[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3]),null!=r&&((c=u[l.VertexAttrConstants.SIZE].data)[0]=r[0],c[1]=r[1]),null!=i&&((c=u[l.VertexAttrConstants.AUXPOS1].data)[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3]),null!=a&&((c=u[l.VertexAttrConstants.UV0].data)[0]=a[0],c[1]=a[1]),null!=o&&((c=u[l.VertexAttrConstants.AUXPOS2].data)[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=o[3]),s},e.createPointArrayGeometry=function(e,t){for(var n=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),i=new Uint32Array(e.length),a=new Uint32Array(e.length),o=0;o<e.length;o++)n[3*o]=e[o][0],n[3*o+1]=e[o][1],n[3*o+2]=e[o][2],t&&(r[3*o]=t[o][0],r[3*o+1]=t[o][1],r[3*o+2]=t[o][2]),i[o]=o,a[o]=0;t||(r[0]=0,r[1]=1,r[2]=0);var c=new Float32Array(2);c[0]=0,c[1]=0;var u={};u[l.VertexAttrConstants.POSITION]=i,u[l.VertexAttrConstants.NORMAL]=t?i:a,u[l.VertexAttrConstants.UV0]=a;var p={};return p[l.VertexAttrConstants.POSITION]={size:3,data:n},p[l.VertexAttrConstants.NORMAL]={size:3,data:r},p[l.VertexAttrConstants.UV0]={size:2,data:c},new s.GeometryData(p,u,"point")},e.createTriangleGeometry=function(){var e=new Float32Array([0,0,0,0,0,100,100,0,0]),t=new Uint32Array([0,1,2]),n=new Float32Array([0,1,0]),r=new Uint32Array([0,0,0]),i=new Float32Array([0,0]),a=new Uint32Array([0,0,0]),o={};o[l.VertexAttrConstants.POSITION]=t,o[l.VertexAttrConstants.NORMAL]=r,o[l.VertexAttrConstants.UV0]=a;var c={};return c[l.VertexAttrConstants.POSITION]={size:3,data:e},c[l.VertexAttrConstants.NORMAL]={size:3,data:n},c[l.VertexAttrConstants.UV0]={size:2,data:i},new s.GeometryData(c,o)};var t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function d(e,t,r,i,a){return!(Math.abs(n.vec3.dot(t,e))>a||(n.vec3.cross(r,e,t),n.vec3.normalize(r,r),n.vec3.cross(i,r,e),n.vec3.normalize(i,i),0))}function g(e,t,n,r,i,a,o){return d(e,t,i,a,o)||d(e,n,i,a,o)||d(e,r,i,a,o)}e.createSquareGeometry=function(e){var n,r;void 0===e&&(e=t);for(var i=new Float64Array(12),a=0;a<4;a++)for(var o=0;o<3;o++)i[3*a+o]=e[a][o];var c=new Uint32Array([0,1,2,2,3,0]),u=new Float32Array([0,0,1]),p=new Uint32Array([0,0,0,0,0,0]),d=new Float32Array([0,0,1,0,1,1,0,1]),f=new Uint8Array([255,255,255,255]),h=((n={})[l.VertexAttrConstants.POSITION]=c,n[l.VertexAttrConstants.NORMAL]=p,n[l.VertexAttrConstants.UV0]=c,n[l.VertexAttrConstants.COLOR]=p,n),v=((r={})[l.VertexAttrConstants.POSITION]={size:3,data:i},r[l.VertexAttrConstants.NORMAL]={size:3,data:u},r[l.VertexAttrConstants.UV0]={size:2,data:d},r[l.VertexAttrConstants.COLOR]={size:4,data:f},r);return new s.GeometryData(v,h)},e.createConeGeometry=function(e,t,n,i,a,o){void 0===a&&(a=!0),void 0===o&&(o=!0);var c=0,u=t,p=e,d=r.vec3f32.fromValues(0,c,0),f=r.vec3f32.fromValues(0,c+p,0),h=r.vec3f32.fromValues(0,-1,0),v=r.vec3f32.fromValues(0,1,0);i&&(c=p,f=r.vec3f32.fromValues(0,0,0),d=r.vec3f32.fromValues(0,c,0),h=r.vec3f32.fromValues(0,1,0),v=r.vec3f32.fromValues(0,-1,0));var m=[f,d],g=[h,v],y=n+2,_=Math.sqrt(p*p+u*u);if(i)for(b=n-1;b>=0;b--)x=b*(2*Math.PI/n),w=r.vec3f32.fromValues(Math.cos(x)*u,c,Math.sin(x)*u),m.push(w),S=r.vec3f32.fromValues(p*Math.cos(x)/_,-u/_,p*Math.sin(x)/_),g.push(S);else for(var b=0;b<n;b++){var x=b*(2*Math.PI/n),w=r.vec3f32.fromValues(Math.cos(x)*u,c,Math.sin(x)*u);m.push(w);var S=r.vec3f32.fromValues(p*Math.cos(x)/_,u/_,p*Math.sin(x)/_);g.push(S)}var O=new Uint32Array(2*(n+2)*3),P=new Uint32Array(2*(n+2)*3),M=0,C=0;if(a){for(b=3;b<m.length;b++)O[M++]=1,O[M++]=b-1,O[M++]=b,P[C++]=0,P[C++]=0,P[C++]=0;O[M++]=m.length-1,O[M++]=2,O[M++]=1,P[C++]=0,P[C++]=0,P[C++]=0}if(o){for(b=3;b<m.length;b++)O[M++]=b,O[M++]=b-1,O[M++]=0,P[C++]=b,P[C++]=b-1,P[C++]=1;O[M++]=0,O[M++]=2,O[M++]=m.length-1,P[C++]=1,P[C++]=2,P[C++]=g.length-1}var A=new Float32Array(3*y);for(b=0;b<y;b++)A[3*b]=m[b][0],A[3*b+1]=m[b][1],A[3*b+2]=m[b][2];var D=new Float32Array(3*y);for(b=0;b<y;b++)D[3*b]=g[b][0],D[3*b+1]=g[b][1],D[3*b+2]=g[b][2];var T={};T[l.VertexAttrConstants.POSITION]=O,T[l.VertexAttrConstants.NORMAL]=P;var R={};return R[l.VertexAttrConstants.POSITION]={size:3,data:A},R[l.VertexAttrConstants.NORMAL]={size:3,data:D},new s.GeometryData(R,T)},e.createCylinderGeometry=function(e,t,i,a,o,c){var u=a?r.vec3f32.clone(a):r.vec3f32.fromValues(1,0,0),p=o?r.vec3f32.clone(o):r.vec3f32.fromValues(0,0,0),d=void 0===c||c,f=r.vec3f32.create();n.vec3.normalize(f,u);var h=r.vec3f32.create();n.vec3.scale(h,f,Math.abs(e));var v=r.vec3f32.create();n.vec3.scale(v,h,-.5),n.vec3.add(v,v,p);var m=r.vec3f32.fromValues(0,1,0);Math.abs(1-n.vec3.dot(f,m))<.2&&n.vec3.set(m,0,0,1);var g=r.vec3f32.create();n.vec3.cross(g,f,m),n.vec3.normalize(g,g),n.vec3.cross(m,g,f);var y=2*i+(d?2:0),_=i+(d?2:0),b=new Float32Array(3*y),x=new Float32Array(3*_),w=new Float32Array(2*y),S=new Uint32Array(3*i*(d?4:2)),O=new Uint32Array(3*i*(d?4:2));d&&(b[3*(y-2)+0]=v[0],b[3*(y-2)+1]=v[1],b[3*(y-2)+2]=v[2],w[2*(y-2)]=0,w[2*(y-2)+1]=0,b[3*(y-1)+0]=b[3*(y-2)+0]+h[0],b[3*(y-1)+1]=b[3*(y-2)+1]+h[1],b[3*(y-1)+2]=b[3*(y-2)+2]+h[2],w[2*(y-1)]=1,w[2*(y-1)+1]=1,x[3*(_-2)+0]=-f[0],x[3*(_-2)+1]=-f[1],x[3*(_-2)+2]=-f[2],x[3*(_-1)+0]=f[0],x[3*(_-1)+1]=f[1],x[3*(_-1)+2]=f[2]);for(var P=function(e,t,n){S[e]=t,O[e]=n},M=0,C=r.vec3f32.create(),A=r.vec3f32.create(),D=0;D<i;D++){var T=D*(2*Math.PI/i);n.vec3.scale(C,m,Math.sin(T)),n.vec3.scale(A,g,Math.cos(T)),n.vec3.add(C,C,A),x[3*D+0]=C[0],x[3*D+1]=C[1],x[3*D+2]=C[2],n.vec3.scale(C,C,t),n.vec3.add(C,C,v),b[3*D+0]=C[0],b[3*D+1]=C[1],b[3*D+2]=C[2],w[2*D+0]=D/i,w[2*D+1]=0,b[3*(D+i)+0]=b[3*D+0]+h[0],b[3*(D+i)+1]=b[3*D+1]+h[1],b[3*(D+i)+2]=b[3*D+2]+h[2],w[2*(D+i)+0]=D/i,w[2*D+1]=1;var R=(D+1)%i;P(M++,D,D),P(M++,D+i,D),P(M++,R,R),P(M++,R,R),P(M++,D+i,D),P(M++,R+i,R)}if(d){for(D=0;D<i;D++)R=(D+1)%i,P(M++,y-2,_-2),P(M++,D,_-2),P(M++,R,_-2);for(D=0;D<i;D++)R=(D+1)%i,P(M++,D+i,_-1),P(M++,y-1,_-1),P(M++,R+i,_-1)}var j={};j[l.VertexAttrConstants.POSITION]=S,j[l.VertexAttrConstants.NORMAL]=O,j[l.VertexAttrConstants.UV0]=S;var E={};return E[l.VertexAttrConstants.POSITION]={size:3,data:b},E[l.VertexAttrConstants.NORMAL]={size:3,data:x},E[l.VertexAttrConstants.UV0]={size:2,data:w},new s.GeometryData(E,j)},e.createTubeGeometry=function(t,n,r,i,a){r=r||10,i=null==i||i,l.assert(t.length>1);for(var o=[],s=[],c=0;c<r;c++){o.push([0,-c-1,-(c+1)%r-1]);var u=c/r*2*Math.PI;s.push([Math.cos(u)*n,Math.sin(u)*n])}return e.createPathExtrusionGeometry(s,t,[[0,0,0]],o,i,a)},e.createPathExtrusionGeometry=function(e,t,o,c,u,p){void 0===p&&(p=r.vec3f32.fromValues(0,0,0));var d=e.length,f=new Float32Array(t.length*d*3+(6*o.length||0)),v=new Float32Array(t.length*d+(2*o.length||0)),m=new Float32Array(t.length*d*3+(o?6:0)),y=(t.length-1)*d*6+3*c.length*2,_=new Uint32Array(y),b=new Uint32Array(y),x=0,w=0,S=0,O=0,P=0,M=r.vec3f32.create(),C=r.vec3f32.create(),A=r.vec3f32.create(),D=r.vec3f32.create(),T=r.vec3f32.create(),R=r.vec3f32.create(),j=r.vec3f32.create(),E=i.vec3f64.create(),I=r.vec3f32.create(),V=r.vec3f32.create(),z=r.vec3f32.create(),L=r.vec3f32.create(),N=r.vec3f32.create(),F=a.plane.create();n.vec3.set(I,0,1,0),n.vec3.subtract(C,t[1],t[0]),n.vec3.normalize(C,C),u?(n.vec3.add(E,t[0],p),n.vec3.normalize(A,E)):n.vec3.set(A,0,0,1),g(C,A,I,I,T,A,h),n.vec3.copy(D,A),n.vec3.copy(L,T);for(var U=0;U<o.length;U++)n.vec3.scale(R,T,o[U][0]),n.vec3.scale(E,A,o[U][2]),n.vec3.add(R,R,E),n.vec3.add(R,R,t[0]),f[x++]=R[0],f[x++]=R[1],f[x++]=R[2],v[S++]=0;for(m[w++]=-C[0],m[w++]=-C[1],m[w++]=-C[2],U=0;U<c.length;U++)_[O++]=c[U][0]>0?c[U][0]:-c[U][0]-1+o.length,_[O++]=c[U][1]>0?c[U][1]:-c[U][1]-1+o.length,_[O++]=c[U][2]>0?c[U][2]:-c[U][2]-1+o.length,b[P++]=0,b[P++]=0,b[P++]=0;for(var G=o.length,H=o.length-1,k=0;k<t.length;k++){var B=!1;k>0&&(n.vec3.copy(M,C),k<t.length-1?(n.vec3.subtract(C,t[k+1],t[k]),n.vec3.normalize(C,C)):B=!0,n.vec3.add(V,M,C),n.vec3.normalize(V,V),n.vec3.add(z,t[k-1],D),a.plane.fromPositionAndNormal(t[k],V,F),a.plane.intersectRay(F,a.ray.wrap(z,M),E)?(n.vec3.subtract(E,E,t[k]),n.vec3.normalize(A,E),n.vec3.cross(T,V,A),n.vec3.normalize(T,T)):g(V,D,L,I,T,A,h),n.vec3.copy(D,A),n.vec3.copy(L,T)),u&&(n.vec3.add(E,t[k],p),n.vec3.normalize(N,E));for(var q=0;q<d;q++)if(n.vec3.scale(R,T,e[q][0]),n.vec3.scale(E,A,e[q][1]),n.vec3.add(R,R,E),n.vec3.normalize(j,R),m[w++]=j[0],m[w++]=j[1],m[w++]=j[2],v[S++]=u?n.vec3.dot(R,N):R[2],n.vec3.add(R,R,t[k]),f[x++]=R[0],f[x++]=R[1],f[x++]=R[2],!B){var W=(q+1)%d;_[O++]=G+q,_[O++]=G+d+q,_[O++]=G+W,_[O++]=G+W,_[O++]=G+d+q,_[O++]=G+d+W;for(var Z=0;Z<6;Z++)b[P++]=_[O-6+Z]-H}G+=d}var X=t[t.length-1];for(U=0;U<o.length;U++)n.vec3.scale(R,T,o[U][0]),n.vec3.scale(E,A,o[U][1]),n.vec3.add(R,R,E),n.vec3.add(R,R,X),f[x++]=R[0],f[x++]=R[1],f[x++]=R[2],v[S++]=0;var Y=w/3;m[w++]=C[0],m[w++]=C[1],m[w++]=C[2];var Q=G-d;for(U=0;U<c.length;U++)_[O++]=c[U][0]>=0?G+c[U][0]:-c[U][0]-1+Q,_[O++]=c[U][2]>=0?G+c[U][2]:-c[U][2]-1+Q,_[O++]=c[U][1]>=0?G+c[U][1]:-c[U][1]-1+Q,b[P++]=Y,b[P++]=Y,b[P++]=Y;var J={};J[l.VertexAttrConstants.POSITION]=_,J[l.VertexAttrConstants.NORMAL]=b;var K={};return K[l.VertexAttrConstants.POSITION]={size:3,data:f},K.zOffset={size:1,data:v},K[l.VertexAttrConstants.NORMAL]={size:3,data:m},new s.GeometryData(K,J)},e.createPolylineGeometry=function(e,t){l.assert(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),l.assert(3===e[0].length,"createPolylineGeometry(): malformed vertex"),l.assert(void 0===t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),l.assert(void 0===t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var n=new Float64Array(3*e.length),r=new Uint32Array(2*(e.length-1)),i=0,a=0,o=0;o<e.length;o++){for(var c=0;c<3;c++)n[i++]=e[o][c];o>0&&(r[a++]=o-1,r[a++]=o)}var u={},p={};if(u[l.VertexAttrConstants.POSITION]=r,p[l.VertexAttrConstants.POSITION]={size:3,data:n},t){var d=new Float32Array(3*t.length),f=0;for(o=0;o<e.length;o++)for(c=0;c<3;c++)d[f++]=t[o][c];u[l.VertexAttrConstants.NORMAL]=r,p[l.VertexAttrConstants.NORMAL]={size:3,data:d}}return new s.GeometryData(p,u,"line")},e.createExtrudedTriangle=function(e,t,n,r){for(var i,a,o=new Float32Array(18),c=[[-t,0,r/2],[n,0,r/2],[0,e,r/2],[-t,0,-r/2],[n,0,-r/2],[0,e,-r/2]],u=0;u<6;u++)o[3*u]=c[u][0],o[3*u+1]=c[u][1],o[3*u+2]=c[u][2];var p=((i={})[l.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),i),d=((a={})[l.VertexAttrConstants.POSITION]={size:3,data:o},a);return new s.GeometryData(d,p)},e.transformInPlace=function(e,t){for(var r=e.vertexAttributes[l.VertexAttrConstants.POSITION].data,i=0;i<r.length;i+=3)n.vec3.set(v,r[i],r[i+1],r[i+2]),n.vec3.transformMat4(v,v,t),r[i]=v[0],r[i+1]=v[1],r[i+2]=v[2]},e.addVertexColors=function(e,t){var n=t||[1,1,1,1],r=new Uint8Array(4);r[0]=255*n[0],r[1]=255*n[1],r[2]=255*n[2],r[3]=255*(n.length>3?n[3]:1);var i={},a=e.getVertexAttr();for(var o in a)i[o]=a[o];i[l.VertexAttrConstants.COLOR]={size:4,data:r};var c={};for(var o in e.indices)c[o]=e.indices[o];return c[l.VertexAttrConstants.COLOR]=new Uint32Array(c[l.VertexAttrConstants.POSITION].length),new s.GeometryData(i,c,e.primitiveType)},e.addNormals=function(e){for(var t=e.getVertexAttr(),r=e.indices,i=o.Vec3Compact.subtract,a=new Float32Array(r.position.length/3*3),s=t.position.data,c=0,u=r.position,p=new Uint32Array(u.length),d=0;d<u.length;d+=3){i(s,3*u[d],s,3*u[d+2],m,0),i(s,3*u[d],s,3*u[d+1],v,0),n.vec3.cross(v,v,m),n.vec3.normalize(v,v);var f=c/3;a[c++]=v[0],a[c++]=v[1],a[c++]=v[2],p[d]=f,p[d+1]=f,p[d+2]=f}t[l.VertexAttrConstants.NORMAL]={size:3,data:a,offsetIdx:0,strideIdx:3},r[l.VertexAttrConstants.NORMAL]=p},e.cgToGIS=function(e,t){void 0===t&&(t=e);var n=e.getVertexAttr(),r=n.position.data,i=n.normal.data,a=t.getVertexAttr(),o=a.position.data,s=a.normal.data;if(i)for(var l=0;l<i.length;l+=3){var c=i[l+1];s[l+1]=-i[l+2],s[l+2]=c}if(r)for(l=0;l<r.length;l+=3)c=r[l+1],o[l+1]=-r[l+2],o[l+2]=c;return t},e.makeOrthoBasisDirUp=d,e.makeOrthoBasisDirUpFallback=g}(d||(d={}));var h=.99619469809,v=r.vec3f32.create(),m=r.vec3f32.create();return d}).apply(null,r))||(e.exports=i)},"51bw":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xf8T")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.mat3f64=n}).apply(null,r))||(e.exports=i)},"58az":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSpace=function(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "],["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},"5T2R":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("FXVB"),n("0LE5"),n("O7NG"),n("ZcgO"),n("woUR"),n("BwdQ"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5"),n("uZGf")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f){function h(e,t){void 0===t&&(t=4);var n=a.vec4f64.fromValues(e[0],e[1],e[2],e.length>3?e[3]:1),r=new f.ShadedColorMaterial({color:n,transparent:e[3]<1,writeDepth:!0,cullFace:2},"manipulator");return r.renderOccluded=t,r}function v(e,t,n,r){var a=i.vec3.normalize(c.sv3d.get(),e),o=i.vec3.normalize(c.sv3d.get(),t),s=i.vec3.cross(c.sv3d.get(),a,o);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=0,r[4]=o[0],r[5]=o[1],r[6]=o[2],r[7]=0,r[8]=s[0],r[9]=s[1],r[10]=s[2],r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function m(e,t){var r=e.getViewForGraphic(t);return n.isSome(r)&&"computeAttachmentOrigin"in r?r.computeAttachmentOrigin(t,e.spatialReference):null}Object.defineProperty(t,"__esModule",{value:!0}),t.createManipulatorMaterial=h,t.createManipulatorOutlineMaterial=function(e,t){void 0===t&&(t=4);var n=a.vec4f64.fromValues(e[0],e[1],e[2],4===e.length?e[3]:1),r=new d({color:n,transparent:!0,writeDepth:!0,cullFace:1},"manipulator-outline");return r.renderOccluded=t,r},t.createSphereManipulator=function(e,t,n){return new s.Manipulator3D({view:e,renderObjects:[{geometry:new u(p.createSphereGeometry(1,32,32),"manipulator"),material:h(a.vec4f64.fromValues(t[0],t[1],t[2],null!=n?n:1))}]})},t.calculateInputRotationTransform=function(e,t,n,a){var o=i.vec3.subtract(c.sv3d.get(),e,n),s=v(o,i.vec3.cross(c.sv3d.get(),a,o),n,c.sm4d.get());r.mat4.invert(s,s);var l=i.vec3.transformMat4(c.sv3d.get(),t,s);return Math.atan2(l[1],l[0])},t.calculateTranslateRotateFromBases=v,t.getGraphicAttachmentOrigin=m,t.placeAtGraphic=function(e,t,r){var i=m(e,r);n.isSome(i)?t.elevationAlignedLocation=i:function(e,t){if(!n.isNone(t)){var r=l.computeCentroid(t);n.isNone(r)||(e.location=o.hydrateGeometry(r))}}(t,r.geometry)}}).apply(null,r))||(e.exports=i)},"62Ht":function(e,t){},"6hC7":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("QDcU"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("DtIM"),n("woUR"),n("B3XD"),n("X5J5"),n("Fe95"),n("48/q"),n("dtql"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x,w,S){Object.defineProperty(t,"__esModule",{value:!0});var O=function(e){function t(t){var n=e.call(this)||this;return n._handles=new a,n._arrowManipulatorInfos=new Array,n._opaqueMaterial=n.createMaterial(),n._transparentMaterial=n.createMaterial(.5),n._angle=0,n._scale=1,n._radius=m.DISC_RADIUS,n._updateAfterDrag=!1,n.events=new i,n._tool=t.tool,n._view=t.view,null!=t.radius&&(n._radius=t.radius),n._createManipulators(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return n.__extends(t,e),Object.defineProperty(t.prototype,"orthogonalAvailable",{set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0},t.prototype.forEachManipulator=function(e){this._arrowManipulatorInfos.map((function(t){return e(t.manipulator,1)}))},t.prototype.createGraphicDragPipeline=function(e,t){var n=this,r=e.graphic,i=d.getGraphicEffectiveElevationInfo(r),a=s.unwrap(r.geometry).spatialReference;return y.createGraphicMoveDragPipeline(e,t,(function(e){return n.createDragPipeline(e,i,a)}))},t.prototype.createDragPipeline=function(e,t,n){var r=this;return o.handlesGroup(this._arrowManipulatorInfos.map((function(i,a){return S.createManipulatorDragEventPipeline(i.manipulator,(function(i,o,s,l){var c=o.next(h.screenToMapXYAtLocation(r._view,i.elevationAlignedLocation,t,n)).next(S.constrainToMapAxis(i.location,r.angle+(a+1)*Math.PI*.5)).next(S.addScreenDelta());e(i,c,s,l)}))})))},Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayScale",{get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())},enumerable:!0,configurable:!0}),t.prototype._updateManipulators=function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()},t.prototype._updateArrowManipulator=function(e,t){var n=e.manipulator,r=e.transform,i=this._radius/m.DISC_RADIUS,a=m.DISC_TRANSLATE_ARROW_SIZE*i,o=Math.sqrt(a*a*3/4),s=x.createExtrudedTriangle(o,a/2,a/2,m.DISC_HEIGHT);x.transformInPlace(s,l.mat4.fromTranslation(_.sm4d.get(),u.vec3.set(_.sv3d.get(),0,-o/3,0)));var c=new b(s,"move-xy-axis-arrow");n.renderObjects=[{geometry:c,material:this._opaqueMaterial,stateMask:2},{geometry:c,material:this._transparentMaterial,stateMask:1}],n.radius=o/3*2*1.2;var p=l.mat4.identity(_.sm4d.get());l.mat4.fromZRotation(p,t*Math.PI/2);var d=l.mat4.identity(_.sm4d.get());l.mat4.fromTranslation(d,u.vec3.set(_.sv3d.get(),0,m.DISC_TRANSLATE_ARROW_OFFSET*i,0)),l.mat4.multiply(r,p,d)},t.prototype._createManipulators=function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()},t.prototype._updateManipulatorTransform=function(){var e=this.angle,t=l.mat4.identity(_.sm4d.get());l.mat4.rotate(t,t,e,p.vec3f64.fromValues(0,0,1));var n=l.mat4.fromScaling(_.sm4d.get(),u.vec3.set(_.sv3d.get(),this.displayScale,this.displayScale,this.displayScale)),r=l.mat4.identity(_.sm4d.get());l.mat4.multiply(r,n,t);for(var i=0,a=this._arrowManipulatorInfos;i<a.length;i++){var o=a[i],s=l.mat4.multiply(_.sm4d.get(),r,o.transform);o.manipulator.modelTransform=s}},t.prototype._createArrowManipulator=function(e){var t=this,n=new f.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:p.vec3f64.fromValues(0,0,1)}}),r={manipulator:n,transform:c.mat4f64.create()};return this._updateArrowManipulator(r,e),this._handles.add(n.events.on("drag",(function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)}))),r},t.prototype.createMaterial=function(e){void 0===e&&(e=1);var t=r.toUnitRGBA(v.colors.main);t[3]*=e;var n=new w({color:t,transparent:1!==e,cullFace:2},"graphic-transform");return n.renderOccluded=2,n},Object.defineProperty(t.prototype,"test",{get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map((function(e){return e.manipulator}))}},enumerable:!0,configurable:!0}),t}(g.Manipulation);t.MoveXYAxisManipulation=O}).apply(null,r))||(e.exports=i)},"6t3m":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a,o;Object.defineProperty(t,"__esModule",{value:!0}),t.VertexColor=function(e,t){t.attributeColor?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n      void forwardVertexColor() { vColor = color; }\n    "],["\n      void forwardVertexColor() { vColor = color; }\n    "])))),e.vertex.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }\n    "],["\n      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }\n    "]))))):e.vertex.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "],["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "]))))}}).apply(null,r))||(e.exports=i)},"6vp1":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("DKwL"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){function a(e){e.include(r.RgbaFloatEncoding),e.fragment.code.add(i.glsl(o||(o=n.__makeTemplateObject(["\n    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "],["\n    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "]))))}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ReadLinearDepth=a,function(e){e.bindUniforms=function(e,t){e.setUniform2fv("nearFar",t.nearFar)}}(a=t.ReadLinearDepth||(t.ReadLinearDepth={}))}).apply(null,r))||(e.exports=i)},"73uV":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("eIBl"),n("LxLY"),n("B3XD"),n("48/q"),n("dtql"),n("bz+r"),n("N78w")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t){var n=e.call(this)||this;return n._handles=new r,n._view=t.view,n._tool=t.tool,n._graphicState=t.graphicState,n._createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return n.__extends(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null},t.prototype.forEachManipulator=function(e){e(this._manipulator,1)},t.prototype.createGraphicDragPipeline=function(e){var t=this;return s.createGraphicMoveDragPipeline(this._graphicState,e,(function(e){return t.createDragPipeline(e)}))},t.prototype.createDragPipeline=function(e){var t=this._view,n=this._graphicState.graphic,r=i.isSome(n.geometry)?n.geometry.spatialReference:null;return l.createManipulatorDragEventPipeline(this._manipulator,(function(i,o,s,c){var u=o.next(a.screenToMapXYForGraphic(c,t,n,r)).next(l.addMapDelta()).next(l.addScreenDelta());e(i,u,s,c)}))},t.prototype._createManipulator=function(){this._manipulator=new c.GraphicManipulator({graphic:this._graphicState.graphic,view:this._view,selectable:!0,cursor:"move"})},t}(o.Manipulation);t.MoveXYGraphicManipulation=u}).apply(null,r))||(e.exports=i)},"7Aei":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r="",i=0;i<t.length;i++)r+=e[i]+t[i];return r+e[e.length-1]}Object.defineProperty(t,"__esModule",{value:!0}),t.glsl=n,function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(n=t.glsl||(t.glsl={}))}).apply(null,r))||(e.exports=i)},"7Yqx":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(){var e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.clone=function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.fromValues=function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v){var m=new Float32Array(16);return m[0]=e,m[1]=t,m[2]=n,m[3]=r,m[4]=i,m[5]=a,m[6]=o,m[7]=s,m[8]=l,m[9]=c,m[10]=u,m[11]=p,m[12]=d,m[13]=f,m[14]=h,m[15]=v,m},t.createView=function(e,t){return new Float32Array(e,t,16)},t.IDENTITY=n()}).apply(null,r))||(e.exports=i)},"7zqm":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.LineStipple=function(e,t){e.defines.addFloat("STIPPLE_ALPHA_COLOR_DISCARD",.001),e.defines.addFloat("STIPPLE_ALPHA_HIGHLIGHT_DISCARD",.5),t.stippleEnabled?function(e,t){e.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleUVMaxEnabled&&e.varyings.add("stipplePatternUvMax","float"),e.varyings.add("stipplePatternUv","float"),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"],["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"])),t.stippleUVMaxEnabled?"stipplePatternUvClamped = clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":"")),e.fragment.code.add(r.glsl(t.stippleOffColorEnabled?a||(a=n.__makeTemplateObject(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "])):o||(o=n.__makeTemplateObject(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "]))))}(e,t):function(e){e.fragment.code.add(r.glsl(s||(s=n.__makeTemplateObject(["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "],["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "]))))}(e)}}).apply(null,r))||(e.exports=i)},"9DjX":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("YX1r"),n("51bw"),n("FXVB"),n("1m5D"),n("EuvN"),n("lLWD"),n("0LE5"),n("vlC2"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("2eYJ"),n("/dtL"),n("ZJC8")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g){Object.defineProperty(t,"__esModule",{value:!0}),t.sliceFilterPredicate=function(e){return function(t,n,r){return c.vec3.lerp(T,t,n,r),!v.extrusionContainsPoint(e,T)}},t.IntersectorOptions=function(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.storeTerrainResults=!0,this.store=2};var y=function(){function e(){this._transform=o.mat4f64.create(),this._transformInverse=new _({value:this._transform},a.mat4.invert,o.mat4f64.create),this._transformInverseTranspose=new _(this._transformInverse,a.mat4.transpose,o.mat4f64.create),this._transformTranspose=new _({value:this._transform},a.mat4.transpose,o.mat4f64.create),this._transformInverseRotation=new _({value:this._transform},r.mat3.normalFromMat4Legacy,i.mat3f64.create)}return e.prototype.invalidateLazyTransforms=function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()},Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0}),e.prototype.setTransformMatrix=function(e){a.mat4.copy(this._transform,e)},e.prototype.multiplyTransform=function(e){a.mat4.multiply(this._transform,this._transform,e)},e.prototype.set=function(e){a.mat4.copy(this._transform,e),this.invalidateLazyTransforms()},e.prototype.setAndInvalidateLazyTransforms=function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()},e}();t.IntersectorTransform=y;var _=function(){function e(e,t,n){this.original=e,this.update=t,this.dirty=!0,this.transform=n()}return e.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform},enumerable:!0,configurable:!0}),e}(),b=function(){function e(){this.min=new x,this.max=new x,this.hud=new x,this.ground=new x}return e.prototype.init=function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]},e}();t.IntersectorResults=b;var x=function(){function e(e){this.normal=p.vec3f64.create(),this.transformation=o.mat4f64.create(),this._ray=h.ray.create(),this.init(e)}return Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return c.vec3.scale(R,this.ray.direction,this.dist),c.vec3.length(R)},enumerable:!0,configurable:!0}),e.prototype.getIntersectionPoint=function(e){return!!this.hasIntersectionPoint&&(c.vec3.scale(R,this.ray.direction,this.dist),c.vec3.add(e,this.ray.origin,R),!0)},e.prototype.getTransformedNormal=function(e){return c.vec3.copy(j,this.normal),j[3]=0,d.vec4.transformMat4(j,j,this.transformation),c.vec3.copy(e,j),c.vec3.normalize(e,e),e},e.prototype.init=function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?h.ray.copy(e,this._ray):this._ray=h.ray.create()},e.prototype.set=function(e,t,n,r,i,o,s,l,u,d){e instanceof g&&(e={type:"stage",obj:e}),this.dist=n,c.vec3.copy(this.normal,r),a.mat4.copy(this.transformation,i),this.target=e,this.name=t,this.drapedLayerOrder=o,this.center=s?p.vec3f64.clone(s):null,this.geometryId=l,this.triangleNr=u,this.drapedLayerGraphicOrder=d},e.prototype.copyFrom=function(e){h.ray.copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?p.vec3f64.clone(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,c.vec3.copy(this.normal,e.normal),a.mat4.copy(this.transformation,e.transformation)},e.prototype.toOwner=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return w(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e,t){var n=e.metadata.layerUid;return null!=n?t.map.findLayerByUid(n):null}(this.target,e);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return w(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null},e.prototype.toGraphic=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return S(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return this.target.metadata.createGraphic();case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return S(this.target.metadata,e)}}return null},e}();function w(e,t){return n.isNone(e)||null==e.layerUid?null:n.isSome(t.graphicsView)&&e.layerUid===t.graphicsView.mockLayerId?t.graphics:t.map.findLayerByUid(e.layerUid)}function S(e,t){if(n.isNone(e))return null;var r=w(e,t);if(n.isNone(r))return null;if(r===t.graphics)return n.isSome(t.graphicsView)?n.unwrap(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;var i=t.allLayerViews.find((function(e){return e.layer===r}));return i?function(e,t){return!e||e.suspended?null:"getGraphicFromIntersectorMetadata"in e&&t?e.getGraphicFromIntersectorMetadata(t):"getGraphicFromGraphicUid"in e&&null!=t.graphicUid?e.getGraphicFromGraphicUid(t.graphicUid):null}(i,e):null}t.IntersectorResult=x;var O=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.tmpVertex=p.vec3f64.create()}return e.prototype.applyToVertex=function(e,t,n){var r=e+this.localOrigin[0],i=t+this.localOrigin[1],a=n+this.localOrigin[2],o=this.offset/Math.sqrt(r*r+i*i+a*a);return this.tmpVertex[0]=e+r*o,this.tmpVertex[1]=t+i*o,this.tmpVertex[2]=n+a*o,this.tmpVertex},e.prototype.applyToAABB=function(e){var t=e[0]+this.localOrigin[0],n=e[1]+this.localOrigin[1],r=e[2]+this.localOrigin[2],i=e[3]+this.localOrigin[0],a=e[4]+this.localOrigin[1],o=e[5]+this.localOrigin[2],s=this.offset/Math.sqrt(t*t+n*n+r*r);e[0]+=t*s,e[1]+=n*s,e[2]+=r*s;var l=this.offset/Math.sqrt(i*i+a*a+o*o);return e[3]+=i*l,e[4]+=a*l,e[5]+=o*l,e},e}();t.TerrainVerticalOffsetGlobalViewingMode=O;var P=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=p.vec3f64.create(),this.mbs=f.vec4f64.create(),this.obb={center:p.vec3f64.create(),halfSize:u.vec3f32.create(),quaternion:null}}return Object.defineProperty(e.prototype,"localOrigin",{set:function(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},enumerable:!0,configurable:!0}),e.prototype.applyToVertex=function(e,t,n){var r=e,i=t,a=n+this.componentLocalOriginLength,o=this.offset/Math.sqrt(r*r+i*i+a*a);return this.tmpVertex[0]=e+r*o,this.tmpVertex[1]=t+i*o,this.tmpVertex[2]=n+a*o,this.tmpVertex},e.prototype.applyToAABB=function(e){var t=e[0],n=e[1],r=e[2]+this.componentLocalOriginLength,i=e[3],a=e[4],o=e[5]+this.componentLocalOriginLength,s=this.offset/Math.sqrt(t*t+n*n+r*r);e[0]+=t*s,e[1]+=n*s,e[2]+=r*s;var l=this.offset/Math.sqrt(i*i+a*a+o*o);return e[3]+=i*l,e[4]+=a*l,e[5]+=o*l,e},e.prototype.applyToMbs=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=this.offset/t;return this.mbs[0]=e[0]+e[0]*n,this.mbs[1]=e[1]+e[1]*n,this.mbs[2]=e[2]+e[2]*n,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs},e.prototype.applyToObb=function(e){var t=e.center,n=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*n,this.obb.center[1]=t[1]+t[1]*n,this.obb.center[2]=t[2]+t[2]*n,c.vec3.transformQuat(this.obb.halfSize,e.halfSize,e.quaternion),c.vec3.add(this.obb.halfSize,this.obb.halfSize,e.center);var r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,c.vec3.subtract(this.obb.halfSize,this.obb.halfSize,e.center),s.quat.conjugate(E,e.quaternion),c.vec3.transformQuat(this.obb.halfSize,this.obb.halfSize,E),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb},e}();t.I3SVerticalOffsetGlobalViewingMode=P;var M=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.sphere=m.create(),this.tmpVertex=p.vec3f64.create()}return e.prototype.applyToVertex=function(e,t,n){var r=this.objectTransform.transform,i=r[0]*e+r[4]*t+r[8]*n+r[12],a=r[1]*e+r[5]*t+r[9]*n+r[13],o=r[2]*e+r[6]*t+r[10]*n+r[14],s=this.offset/Math.sqrt(i*i+a*a+o*o),l=this.objectTransform.inverse;return this.tmpVertex[0]=l[0]*(i+=i*s)+l[4]*(a+=a*s)+l[8]*(o+=o*s)+l[12],this.tmpVertex[1]=l[1]*i+l[5]*a+l[9]*o+l[13],this.tmpVertex[2]=l[2]*i+l[6]*a+l[10]*o+l[14],this.tmpVertex},e.prototype.applyToMinMax=function(e,t){var n=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*n,e[1]+=e[1]*n,e[2]+=e[2]*n;var r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r},e.prototype.applyToAABB=function(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var n=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*n,e[4]+=e[4]*n,e[5]+=e[5]*n,e},e.prototype.applyToBoundingSphere=function(e,t){var n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/n;return this.sphere.center[0]=t[0]+t[0]*r,this.sphere.center[1]=t[1]+t[1]*r,this.sphere.center[2]=t[2]+t[2]*r,this.sphere.radius=e+e*this.offset/n,this.sphere},e}();t.Object3DVerticalOffsetGlobalViewingMode=M;var C=new M;t.getVerticalOffsetObject3D=function(e){return n.isSome(e)?(C.offset=e,C):null};var A=new P;t.getVerticalOffsetI3S=function(e){return n.isSome(e)?(A.offset=e,A):null};var D=new O;t.getVerticalOffsetTerrain=function(e){return n.isSome(e)?(D.offset=e,D):null},t.TERRAIN_ID="terrain";var T=p.vec3f64.create(),R=p.vec3f64.create(),j=f.vec4f64.create(),E=l.quatf64.create()}).apply(null,r))||(e.exports=i)},"9FJH":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("EiD/"),n("tUyH")],void 0===(i=(function(e,t,n,r,i,a){return function(e){function t(t){var n=e.call(this,t)||this;return n._textureIDs=new Set,n._textureRepository=t.textureRep,n._textureId=t.textureId,n._initTransparent=!!t.initTextureTransparent,n._texture=n._acquireIfNotUndefined(n._textureId),n._textureNormal=n._acquireIfNotUndefined(t.normalTextureId),n._textureEmissive=n._acquireIfNotUndefined(t.emissiveTextureId),n._textureOcclusion=n._acquireIfNotUndefined(t.occlusionTextureId),n._textureMetallicRoughness=n._acquireIfNotUndefined(t.metallicRoughnessTextureId),n}return n.__extends(t,e),t.prototype.dispose=function(){var e=this;this._textureIDs.forEach((function(t){return e._textureRepository.release(t)})),this._textureIDs.clear()},t.prototype.updateTexture=function(e){e!==this._textureId&&(this._releaseIfNotUndefined(this._textureId),this._textureId=e,this._texture=this._acquireIfNotUndefined(this._textureId))},t.prototype.bindTexture=function(e,t){r.isSome(this._texture)&&(t.setUniform1i("tex",i.DefaultTextureUnits.DIFFUSE),e.bindTexture(this._texture.glTexture,i.DefaultTextureUnits.DIFFUSE)),r.isSome(this._textureNormal)&&(t.setUniform1i("normalTexture",i.DefaultTextureUnits.NORMAL),e.bindTexture(this._textureNormal.glTexture,i.DefaultTextureUnits.NORMAL)),r.isSome(this._textureEmissive)&&(t.setUniform1i("texEmission",i.DefaultTextureUnits.EMISSION),e.bindTexture(this._textureEmissive.glTexture,i.DefaultTextureUnits.EMISSION)),r.isSome(this._textureOcclusion)&&(t.setUniform1i("texOcclusion",i.DefaultTextureUnits.OCCLUSION),e.bindTexture(this._textureOcclusion.glTexture,i.DefaultTextureUnits.OCCLUSION)),r.isSome(this._textureMetallicRoughness)&&(t.setUniform1i("texMetallicRoughness",i.DefaultTextureUnits.METALLIC_ROUGHNESS),e.bindTexture(this._textureMetallicRoughness.glTexture,i.DefaultTextureUnits.METALLIC_ROUGHNESS))},t.prototype.bindTextureScale=function(e,t){var n=r.isSome(this._texture)&&this._texture.glTexture;n&&n.descriptor.textureCoordinateScaleFactor?t.setUniform2fv("textureCoordinateScaleFactor",n.descriptor.textureCoordinateScaleFactor):t.setUniform2f("textureCoordinateScaleFactor",1,1)},t.prototype._acquireIfNotUndefined=function(e){if(!r.isNone(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)},t.prototype._releaseIfNotUndefined=function(e){void 0!==e&&(this._textureIDs.delete(e),this._textureRepository.release(e))},t}(a.GLMaterial)}).apply(null,r))||(e.exports=i)},A5GR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("y4WC"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("Vx27"),n("ZcgO"),n("DtIM"),n("5T2R"),n("1eTA"),n("G+tB"),n("Fe95"),n("BhkK"),n("dtql"),n("73uV"),n("qflc"),n("R4nD"),n("/NuL"),n("bz+r"),n("X7Ps")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x,w){Object.defineProperty(t,"__esModule",{value:!0});var S=function(e){this.allGraphics=e,this.type="graphic-move-start"};t.GraphicMoveStartEvent=S;var O=function(e,t,n){this.dx=e,this.dy=t,this.allGraphics=n,this.type="graphic-move"};t.GraphicMoveEvent=O;var P=function(e){this.allGraphics=e,this.type="graphic-move-stop"};t.GraphicMoveStopEvent=P;var M=function(e){function t(t){var n=e.call(this,t)||this;return n.graphics=new r,n.enableZ=!0,n.type="move-3d",n._toolHandles=new a,n._handles=new a,n}return n.__extends(t,e),t.prototype.initialize=function(){var e=this;this._toolHandles.add([this.graphics.on("change",(function(){return e._refreshManipulators()}))]),this._refreshManipulators()},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)},t.prototype.reset=function(){},t.prototype._refreshManipulators=function(){var e=this;this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var t=this.graphics.toArray().filter((function(e){return 0===y.isSupportedGraphic(e)})).map((function(e){return new C(e)}));t.length&&(this.createManipulators(t),this.createVisualElements(t),this._handles.add(t.map((function(t){return e.view.trackGraphicState(t.state)}))),this.updateMoveManipulation(t))},t.prototype.createManipulators=function(e){for(var t=this,r=function(r){var a=r.state;r.manipulationXY=new g.MoveXYGraphicManipulation({tool:i,view:i.view,graphicState:a}),r.manipulationXY.forEachManipulator((function(e){return t._handles.add(e.events.on("immediate-click",(function(e){t.emit("immediate-click",n.__assign(n.__assign({},e),{graphic:a.graphic})),e.stopPropagation()})))})),i._handles.add(r.manipulationXY.createDragPipeline((function(n,r,i){return t.buildDragEventPipeline(n,r,i,e)})))},i=this,a=0,o=e;a<o.length;a++)r(o[a]);this.createMoveManipulation(e)},t.prototype.createMoveManipulation=function(e){var t=this,r=new v.MoveManipulation({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?v.MoveManipulation.radiusForSymbol(e[0].graphic.symbol):h.DISC_RADIUS});this._moveManipulation=r,r.elevationInfo={mode:"absolute-height",offset:0},r.forEachManipulator((function(e){t._handles.add(e.events.on("immediate-click",(function(i){r.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",n.__assign(n.__assign({},i),{graphic:t.graphics.getItemAt(0)})),i.stopPropagation()})))}));for(var i=function(){return t.updateMoveManipulation(e)},a=0,o=e;a<o.length;a++){var l=o[a];this._handles.add([l.state.on("changed",i),l.state.watch("displaying",i)])}var c=e[e.length-1];this._handles.add(c.state.on("changed",(function(){return t.updateMoveManipulationAngle(c)}))),this._handles.add(r.createDragPipeline((function(n,r,i){t.buildDragEventPipeline(n,r,i,e)}),u.getGraphicEffectiveElevationInfo(c.graphic),s.unwrap(c.graphic.geometry).spatialReference)),this.updateMoveManipulationAngle(c)},t.prototype.createVisualElements=function(e){for(var t=this,n=function(n){var i=f.createVisualElements({view:r.view,graphic:n.graphic,forEachManipulator:function(e){n.manipulationXY.forEachManipulator(e),t._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return o.makeHandle()}});n.geometryRepresentation=i.visualElement,n.geometryRepresentation instanceof _.OutlineVisualElement&&r._handles.add([n.geometryRepresentation.events.on("attachment-origin-changed",(function(){n.state.isDraped||t.updateMoveManipulation(e)})),n.state.watch("isDraped",(function(){return t.updateMoveManipulation(e)}))]),r._handles.add(i)},r=this,i=0,a=e;i<a.length;i++)n(a[i])},t.prototype.updateMoveManipulationAngle=function(e){this._moveManipulation.angleDeferred=function(){return m.primaryShapeOrientation(e.graphic.geometry)}},t.prototype.updateMoveManipulation=function(e){for(var t=c.makeDehydratedPoint(0,0,0,this.view.spatialReference),n=0,r=!1,i=this._moveManipulation,a=0,o=e;a<o.length;a++){var l=o[a];if(l.state.displaying){var u=l.state.graphic;this.enableZ&&d.canMoveZ(u)&&(r=!0);var f=l.geometryRepresentation instanceof _.OutlineVisualElement&&!l.state.isDraped?l.geometryRepresentation.attachmentOrigin:p.getGraphicAttachmentOrigin(this.view,u);s.isSome(f)&&(t.x+=f.x,t.y+=f.y,t.z+=f.z,n++)}}n>0?(t.x/=n,t.y/=n,t.z/=n,i.location=t,i.xyManipulation.available=!0,i.xyAxisManipulation.available=!0,i.zManipulation.available=r):i.available=!1},t.prototype.buildDragEventPipeline=function(e,t,n,r){var i=this,a=[],o=[],s=null,l=null,c=function(){for(var e=0,t=a;e<t.length;e++)t[e].dragging=!1;a.length=0,o.length=0,s=null,l=null,i._moveManipulation.interactive=!0};t.next((function(t){if("start"===t.action){a.length=0,o.length=0;for(var n=0,c=r;n<c.length;n++){var u=c[n];u.dragging||!u.manipulationXY.hasManipulator(e)&&u.manipulationXY.grabbing||(a.push(u),o.push(u.graphic),u.dragging=!0)}if(0!==o.length&&(i._moveManipulation.interactive=!1,s=x.dragGraphicMany(o),l=x.resetGraphicMany(o),i.emit("graphic-move-start",new S(o)),i.destroyed))return null}return 0!==o.length?t:null})).next((function(e){return s(e)})).next((function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=i.view.toScreen(e.mapStart),n=i.view.toScreen(e.mapEnd);if(i.emit("graphic-move",new O(n.x-t.x,n.y-t.y,o)),i.destroyed)return null}break;case"end":if(i.emit("graphic-move-stop",new P(o)),i.destroyed)return null;c()}})),n.next((function(e){return l(e)})).next((function(){if(i.emit("graphic-move-stop",new P(o)),i.destroyed)return null;c()}))},n.__decorate([l.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n.__decorate([l.property({readOnly:!0})],t.prototype,"graphics",void 0),n.__decorate([l.property({constructOnly:!0,nonNullable:!0})],t.prototype,"enableZ",void 0),n.__decorate([l.property({readOnly:!0})],t.prototype,"type",void 0),n.__decorate([l.subclass("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],t)}(i.EventedMixin(w.InteractiveToolBase));t.GraphicMoveTool=M;var C=function(){function e(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new b.GraphicState({graphic:e})}return Object.defineProperty(e.prototype,"graphic",{get:function(){return this.state.graphic},enumerable:!0,configurable:!0}),e}()}).apply(null,r))||(e.exports=i)},AgDx:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("+nCE"),n("CIy2")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,i,a){void 0===i&&(i=e.DefaultIndices),void 0===a&&(a="triangle");var o={};for(var s in t){var l=t[s],c=l.size;o[s]={data:l.data,size:c,offsetIdx:0,strideIdx:c}}if(i===e.DefaultIndices){var u=function(e){var t=r.getFirstObjectValue(e);return null==t?0:t.data.length/t.size}(o),p=n.generateDefaultIndexArray(u);for(var d in i={},o)i[d]=p}this._id=n.getNewId(),this._vertexAttributes=o,this._indices=i,this._primitiveType=a}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){var e=r.getFirstObjectValue(this._indices);return null==e?0:e.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0}),e.prototype.getVertexAttr=function(){return this.vertexAttributes},e.prototype.toRenderData=function(){return{id:this._id.toString(),indices:this._indices,vertexAttr:this._vertexAttributes}},e.prototype.getIndices=function(e){return this._indices[e]},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){var e=0;if(this._indices[r.VertexAttrConstants.POSITION]){var t=3;e+=this._indices[r.VertexAttrConstants.POSITION].length*t*4}return this._indices[r.VertexAttrConstants.NORMAL]&&(e+=this._indices[r.VertexAttrConstants.NORMAL].length*(t=3)*4),this._indices[r.VertexAttrConstants.UV0]&&(e+=this._indices[r.VertexAttrConstants.UV0].length*(t=2)*4),this._indices[r.VertexAttrConstants.COLOR]&&(e+=this._indices[r.VertexAttrConstants.COLOR].length*(t=1)*4),e},e.DefaultIndices={},e}();t.GeometryData=i}).apply(null,r))||(e.exports=i)},B3XD:function(e,t){},B4Pz:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.FoamIntensity=function(e){e.fragment.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor =  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "],["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor =  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "]))))},t.FoamColor=function(e){e.fragment.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "],["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},BhkK:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("eIBl"),n("XwIv"),n("H1tY"),n("LxLY"),n("Fe95"),n("48/q"),n("6hC7"),n("yjgM"),n("pvGl")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(t){var n=e.call(this)||this;n._handles=new r,n._angleDeferred=null,n._interactive=!0;var i=t.tool,a=t.view,o=t.snapToScene,s=t.radius;return n._view=a,n.xyManipulation=new u.MoveXYDiscManipulation({tool:i,view:a,snapToScene:o,radius:s}),n.xyAxisManipulation=new c.MoveXYAxisManipulation({tool:i,view:a,radius:s}),n.zManipulation=new p.MoveZManipulation({tool:i,view:a,radius:s}),n.xyManipulation.available=t.xyAvailable,n.xyAxisManipulation.available=t.xyAxisAvailable,n.zManipulation.available=t.zAvailable,n.autoHideXYAxis(),n.forEachManipulator((function(e){n._handles.add(e.events.on("grab-changed",(function(){return n.updateManipulatorInteractivity()})))})),n}return n.__extends(t,e),t.prototype.destroy=function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()},t.prototype.createGraphicDragPipeline=function(e,t){return i.handlesGroup([this.xyManipulation.createGraphicDragPipeline(e,t),this.xyAxisManipulation.createGraphicDragPipeline(e,t),this.zManipulation.createGraphicDragPipeline(e,t)])},t.prototype.createDragPipeline=function(e,t,n){return i.handlesGroup([this.xyManipulation.createDragPipeline(e,t,n),this.xyAxisManipulation.createDragPipeline(e,t,n),this.zManipulation.createDragPipeline(e,n)])},Object.defineProperty(t.prototype,"snapToScene",{set:function(e){this.xyManipulation.snapToScene=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angle",{set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angleDeferred",{set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"interactive",{set:function(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayScale",{set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e},enumerable:!0,configurable:!0}),t.prototype.forEachManipulator=function(e){this.xyManipulation.forEachManipulator((function(t){return e(t,1)})),this.xyAxisManipulation.forEachManipulator((function(t){return e(t,1)})),this.zManipulation.forEachManipulator((function(t){return e(t,0)}))},Object.defineProperty(t.prototype,"xyAxisVisible",{get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e},enumerable:!0,configurable:!0}),t.prototype.autoHideXYAxis=function(){var e=this,t=this.xyAxisManipulation,n=this.xyManipulation;if(!a("esri-mobile")){var r=[];n.forEachManipulator((function(e){return r.push(e)})),t.forEachManipulator((function(e){return r.push(e)}));for(var i=function(){var n=[];e.xyAxisVisible?o.isSome(e._angleDeferred)&&(e.angle=e._angleDeferred()):t.forEachManipulator((function(e){return n.push(e.disableDisplay())})),e._handles.remove(f),e._handles.add(n,f)},s=0,l=r;s<l.length;s++)this._handles.add(l[s].events.on("focus-changed",i));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",i)),i()}},t.prototype.updateManipulatorInteractivity=function(){var e=this,t=this.grabbing;this.forEachManipulator((function(n){n.interactive=!t&&e._interactive||n.grabbing}))},t.radiusForSymbol=function(e){var t=o.isSome(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((function(e){return"icon"===e.type}))?s.DISC_RADIUS_SMALL:s.DISC_RADIUS},t}(l.Manipulation);t.MoveManipulation=d;var f="disable-xy-axis-display"}).apply(null,r))||(e.exports=i)},BwdQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("LxLY"),n("FXVB"),n("1m5D"),n("DIqE"),n("Rdxj"),n("2fXB"),n("O7NG"),n("WRgd"),n("lRq4"),n("0FS0"),n("ZPQp"),n("ZcgO"),n("mmEe")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v){function m(e){var t=e.paths[0];if(!t||0===t.length)return null;var n=f.getPointOnPath(t,f.getPathLength(t)/2);return h.makeDehydratedPoint(n[0],n[1],n[2],e.spatialReference)}function g(e,t,n){var r=n?e:h.clonePoint(e);return t&&e?v.pointToPoint(e,r,t)?r:null:r}function y(e){if(Array.isArray(e)){for(var t=0,n=e;t<n.length;t++)if(!y(n[t]))return!1;return!0}return null==e||e>=0}Object.defineProperty(t,"__esModule",{value:!0}),t.computeCentroid=function(e,t){if("point"===e.type)return g(e,t,!1);if(h.isHydratedGeometry(e))switch(e.type){case"extent":return g(e.center,t,!1);case"polygon":return g(e.centroid,t,!1);case"polyline":return g(m(e),t,!0);case"mesh":return g(e.extent.center,t,!1)}else switch(e.type){case"extent":return g(function(e){var t=n.isFinite(e.zmin);return h.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return g(function(e){var t=e.rings[0];if(!t||0===t.length)return null;var n=d.ringsCentroid(e.rings,e.hasZ);return h.makeDehydratedPoint(n[0],n[1],n[2],e.spatialReference)}(e),t,!0);case"polyline":return g(m(e),t,!0)}},t.enlargeExtent=function(e,t,n){if(e){t||(t=p.create());var r=.5*e.width*(n-1),i=.5*e.height*(n-1);return e.width<1e-7*e.height?r+=i/20:e.height<1e-7*e.width&&(i+=r/20),l.vec4.set(t,e.xmin-r,e.ymin-i,e.xmax+r,e.ymax+i),t}return null},t.updateVertexAttributeAuxpos1w=function(e,t){for(var n=0;n<e.geometries.length;++n){var r=e.geometries[n].data.vertexAttributes.auxpos1;r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(n))}},t.mixinColorAndOpacity=function(e,t){var n=c.vec4f64.clone(c.vec4f64.ONES);return r.isSome(e)&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),r.isSome(t)?n[3]=t:r.isSome(e)&&e.length>3&&(n[3]=e[3]),n},t.overrideColor=function(e,t,n,i,a,o){void 0===o&&(o=[0,0,0,0]);for(var s=0;s<3;++s)o[s]=r.isSome(e)&&null!=e[s]?e[s]:r.isSome(n)&&null!=n[s]?n[s]:a[s];return o[3]=r.isSome(t)?t:r.isSome(i)?i:a[3],o},t.computeObjectScale=function(e,t,n,r){void 0===e&&(e=s.vec3f64.ONES),void 0===r&&(r=1);var i=new Array(3);if(null==t||null==n)i[0]=1,i[1]=1,i[2]=1;else{for(var a=void 0,o=0,l=2;l>=0;l--){var c=e[l],u=void 0,p=null!=c,d=n[l];"symbol-value"===c||0===l&&!a&&!p?u=0!==d?t[l]/d:1:p&&"proportional"!==c&&isFinite(c)&&(u=0!==d?c/d:1),null!=u&&(i[l]=u,a=u,o=Math.max(o,Math.abs(u)))}for(l=2;l>=0;l--)null==i[l]?i[l]=a:0===i[l]&&(i[l]=.001*o)}for(l=2;l>=0;l--)i[l]/=r;return s.vec3f64.fromArray(i)},t.computeSizeWithResourceSize=function(e,t){var n=t.width,r=t.depth,i=t.height,a=t.isPrimitive?10:1;if(null==n&&null==i&&null==r)return[a*e[0],a*e[1],a*e[2]];for(var o,l=s.vec3f64.fromValues(n,r,i),c=0;c<3;c++){var u=l[c];if(null!=u){o=u/e[c];break}}for(c=0;c<3;c++)null==l[c]&&(l[c]=e[c]*o);return l},t.validateSymbolLayerSize=function(e){return null!=e.isPrimitive&&(e=[e.width,e.depth,e.height]),y(e)?null:"Symbol sizes may not be negative values"},t.isValidSize=y,t.computeObjectRotation=function(e,t,n,r){void 0===r&&(r=a.mat4f64.create());var o=e||0,s=t||0,l=n||0;return 0!==o&&i.mat4.rotateZ(r,r,-o/180*Math.PI),0!==s&&i.mat4.rotateX(r,r,s/180*Math.PI),0!==l&&i.mat4.rotateY(r,r,l/180*Math.PI),r},t.demResolutionForBoundingBox=function(e,t){return null!=t.minDemResolution?t.minDemResolution:u.isPoint(e)?t.minDemResolutionForPoints:.01*u.maximumDimension(e)},t.namedAnchorToHUDMaterialAnchorPos={"bottom-left":o.vec2f64.fromValues(0,0),bottom:o.vec2f64.fromValues(.5,0),"bottom-right":o.vec2f64.fromValues(1,0),left:o.vec2f64.fromValues(0,.5),center:o.vec2f64.fromValues(.5,.5),right:o.vec2f64.fromValues(1,.5),"top-left":o.vec2f64.fromValues(0,1),top:o.vec2f64.fromValues(.5,1),"top-right":o.vec2f64.fromValues(1,1)}}).apply(null,r))||(e.exports=i)},CIy2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("FXVB"),n("W9tT"),n("DIqE"),n("Rdxj"),n("2fXB"),n("O7NG")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=l.vec4f64.create(),u=function(){function e(e){this.message=e}return e.prototype.toString=function(){return"AssertException: "+this.message},e}();function p(e,t){if(!e){t=t||"assert";var n=new Error(t);throw n.stack&&console.log(n.stack),new u(t)}}function d(e){for(var t in e)return t}function f(e,t){e[12]=t[0],e[13]=t[1],e[14]=t[2]}function h(e,t){void 0===t&&(t=0);for(var n=0,r=0;r<4;r++)n+=e[t+r]*m[r];return n}t.AssertException=u,t.VertexAttrConstants={POSITION:"position",NORMAL:"normal",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",TANGENT:"tangent"},t.assert=p,t.verify=function(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))},t.encodeInt16=function(e){return n.clamp(Math.round(32767*e),-32767,32767)},t.encodeNormal=function(e,t){var n=Math.abs(e[0]),r=Math.abs(e[1]),i=1/(n+r+Math.abs(e[2])),a=n*i,o=r*i,s=Math.min(e[2]*i,0);t[0]=(e[0]<0?-1:1)*(a-s),t[1]=(e[1]<0?-1:1)*(o-s)},t.fallbackIfUndefined=function(e,t){return void 0===e?t:e},t.hex2rgb=function(e){return[((e=Math.floor(e))>>16&255)/255,(e>>8&255)/255,(255&e)/255]},t.rgb2hex=function(e){return"0x"+((n.clamp(Math.round(255*e[0]),0,255)<<16)+(n.clamp(Math.round(255*e[1]),0,255)<<8)+n.clamp(Math.round(255*e[2]),0,255)).toString(16)},t.dec2hex=function(e){var t=e.toString(16);return"00000000".substr(0,8-t.length)+t},t.rayTriangle3D=function(e,t,n,r,i,a,s,l,c){void 0===c&&(c=o.vec3f64.create());var u=r[s]-n[a],p=r[s+1]-n[a+1],d=r[s+2]-n[a+2],f=i[l]-n[a],h=i[l+1]-n[a+1],v=i[l+2]-n[a+2],m=t[1]*v-h*t[2],g=t[2]*f-v*t[0],y=t[0]*h-f*t[1],_=u*m+p*g+d*y;if(_>-1e-5&&_<1e-5)return!1;var b=1/_,x=e[0]-n[a],w=e[1]-n[a+1],S=e[2]-n[a+2];if(c[1]=b*(x*m+w*g+S*y),c[1]<0||c[1]>1)return!1;var O=w*d-p*S,P=S*u-d*x,M=x*p-u*w;return c[2]=b*(t[0]*O+t[1]*P+t[2]*M),!(c[2]<0||c[1]+c[2]>1||(c[0]=b*(f*O+h*P+v*M),0))},t.rayBoxTest=function(e,t,n,r){var i,a=(n[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];a>o&&(i=a,a=o,o=i);var s=(n[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(s>l&&(i=s,s=l,l=i),a>l||s>o)return!1;s>a&&(a=s),l<o&&(o=l);var c=(n[2]-e[2])/t[2],u=(r[2]-e[2])/t[2];return c>u&&(i=c,c=u,u=i),!(a>u||c>o||(u<o&&(o=u),o<0))},t.rayRay2D=function(e,t,n,r,i,o){void 0===o&&(o=a.vec2f64.create());var s=(r[i]-n[i])*(t[0]-e[0])-(r[0]-n[0])*(t[i]-e[i]);if(0===s)return!1;var l=((r[0]-n[0])*(e[i]-n[i])-(r[i]-n[i])*(e[0]-n[0]))/s;return o[0]=e[0]+l*(t[0]-e[0]),o[1]=e[i]+l*(t[i]-e[i]),!0},t.project=function(e,t,n,r,i){i||(i=e),c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=1,s.vec4.transformMat4(c,c,t),i.length>2&&(i[2]=-c[2]),s.vec4.transformMat4(c,c,n),p(0!==c[3]),i[0]=c[0]/c[3],i[1]=c[1]/c[3],i[2]=c[2]/c[3],i[0]=(.5*i[0]+.5)*r[2]+r[0],i[1]=(.5*i[1]+.5)*r[3]+r[1]},t.getFirstObjectKey=d,t.getFirstObjectValue=function(e){return e[d(e)]},t.objectEmpty=function(e){for(var t in e)return!1;return!0},t.logWithBase=function(e,t){return Math.log(e)/Math.log(t)},t.setMatrixTranslation=f,t.setMatrixTranslation3=function(e,t,n,r){e[12]=t,e[13]=n,e[14]=r},t.getMatrixTranslation=function(e,t){return void 0===t&&(t=o.vec3f64.create()),t[0]=e[12],t[1]=e[13],t[2]=e[14],t},t.createTranslationMatrix=function(e,t){return f(e=r.mat4.identity(e),t),e},t.isTranslationMatrix=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]},t.fovx2fovy=function(e,t,n){return 2*Math.atan(n*Math.tan(.5*e)/t)},t.fovy2fovx=function(e,t,n){return 2*Math.atan(t*Math.tan(.5*e)/n)},t.fovx2fovd=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/t)},t.fovy2fovd=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/n)},t.fovd2fovx=function(e,t,n){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+n*n))},t.fovd2fovy=function(e,t,n){return 2*Math.atan(n*Math.tan(.5*e)/Math.sqrt(t*t+n*n))},t.packFloatRGBA=function(e,t,r){void 0===r&&(r=0);for(var i,a=n.clamp(e,0,g),o=0;o<4;o++)t[r+o]=Math.floor(256*((i=a*v[o])-Math.floor(i)))},t.unpackFloatRGBA=h;var v=[1,256,65536,16777216],m=[1/256,1/65536,1/16777216,1/4294967296],g=h(new Uint8ClampedArray([255,255,255,255]));t.inverseProjectionInfo=function(e,t,n,r,a){var o=e;0===e[11]?(r[0]=2/(t*o[0]),r[1]=2/(n*o[5]),r[2]=(1+o[12])/o[0],r[3]=(1+o[13])/o[5],i.vec2.set(a,0,1)):(r[0]=-2/(t*o[0]),r[1]=-2/(n*o[5]),r[2]=(1-o[8])/o[0],r[3]=(1-o[9])/o[5],i.vec2.set(a,1,0))}}).apply(null,r))||(e.exports=i)},CIzB:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},t.fromValues=function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v){return[e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v]},t.createView=function(e,t){return new Float64Array(e,t,16)},t.IDENTITY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}).apply(null,r))||(e.exports=i)},CP88:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("tUyH"),n("v22c"),n("s6rJ")],void 0===(i=(function(e,t,n,r,i,a){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return n.__extends(t,e),t.prototype.updateParameters=function(){this.params=a.copyParameters(this.material.getParameters()),this.technique=this.techniqueRep.acquireAndReleaseExisting(i.WaterTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){if(2===this.output)return 22===e;if(5===this.output)return null==e;var t=3;return this.params.transparent&&(t=this.params.writeDepth?5:8),e===t},t.prototype.setElapsedTimeUniform=function(e){e.setUniform1f("timeElapsed",.001*this.material.animation.time*this.params.animationSpeed)},t.prototype._updateShadowState=function(e){e.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:e.shadowMappingEnabled}),this.updateParameters())},t.prototype._updateSSRState=function(e){e.ssrEnabled!==this.params.ssrEnabled&&(this.material.setParameterValues({ssrEnabled:e.ssrEnabled}),this.updateParameters())},t.prototype.ensureResources=function(e){return this.technique.ensureResource(e)},t.prototype.ensureParameters=function(e){0===this.output&&(this._updateShadowState(e),this._updateSSRState(e))},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.params,t),2!==this.output&&0!==this.output||this.setElapsedTimeUniform(this.technique.program)},t}(r.GLMaterial);t.WaterGLMaterial=o}).apply(null,r))||(e.exports=i)},CqfC:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("vJh7")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.mat2=n}).apply(null,r))||(e.exports=i)},DFuO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("3kdR"),n("6t3m"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o,s){var l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new s.ShaderBuilder;return t.include(i.Transform,{linearDepth:!1}),t.include(a.VertexColor,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(o.glsl(l||(l=n.__makeTemplateObject(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "],["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])))),t.include(r.Slice,e),t.fragment.uniforms.add("eColor","vec4"),t.fragment.code.add(o.glsl(c||(c=n.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n    }\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n    }\n    "])),e.attributeColor?"gl_FragColor = vColor * eColor;":"gl_FragColor = eColor;")),t}}).apply(null,r))||(e.exports=i)},DKwL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.RgbaFloatEncoding=function(e){var t=r.glsl(i||(i=n.__makeTemplateObject(["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT =\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat = 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS = vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0->1 back to 0->255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "],["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT =\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat = 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS = vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0->1 back to 0->255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "])));e.fragment.code.add(t),e.vertex.code.add(t)}}).apply(null,r))||(e.exports=i)},Dk48:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("Gtr7"),n("Vx27")],void 0===(i=(function(e,t,n,r,i){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_VISIBLE=!1,t.DECONFLICTOR_SHOW_INVISIBLE=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_DEBUG_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.TERRAIN_DEBUG_POPUP=!1,t.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,t.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.I3S_TREE_SHOW_TILES=!1,t.I3S_SHOW_MODIFICATIONS=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t.DISABLE_FAST_UPDATES=!1,t.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,t.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,t.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,t}return n.__extends(t,e),n.__decorate([i.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),n.__decorate([i.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),n.__decorate([i.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),n.__decorate([i.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),n.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),n.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),n.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),n.__decorate([i.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),n.__decorate([i.property()],t.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),n.__decorate([i.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),n.__decorate([i.property()],t.prototype,"TERRAIN_DEBUG_POPUP",void 0),n.__decorate([i.property()],t.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),n.__decorate([i.property()],t.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),n.__decorate([i.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),n.__decorate([i.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),n.__decorate([i.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),n.__decorate([i.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),n.__decorate([i.property()],t.prototype,"I3S_TREE_SHOW_TILES",void 0),n.__decorate([i.property()],t.prototype,"I3S_SHOW_MODIFICATIONS",void 0),n.__decorate([i.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),n.__decorate([i.property()],t.prototype,"DISABLE_FAST_UPDATES",void 0),n.__decorate([i.property()],t.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),n.__decorate([i.property()],t.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),n.__decorate([i.property()],t.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),n.__decorate([i.subclass("esri.views.3d.support.DebugFlags")],t)}(r))}).apply(null,r))||(e.exports=i)},"E/g4":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a,o,s,l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.RibbonVertexPosition=function(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "],["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "]))))):(e.attributes.add("size","float"),e.vertex.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "],["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "]))))),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.defines.addInt("VV_OPACITY_N",8),e.vertex.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value <= vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i = 1; i < VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "],["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value <= vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i = 1; i < VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "]))))):e.vertex.code.add(r.glsl(s||(s=n.__makeTemplateObject(["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "])))),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.defines.addInt("VV_COLOR_N",8),e.vertex.code.add(r.glsl(l||(l=n.__makeTemplateObject(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value <= vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i = 1; i < VV_COLOR_N; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "],["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value <= vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i = 1; i < VV_COLOR_N; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "]))))):(e.attributes.add("color","vec4"),e.vertex.code.add(r.glsl(c||(c=n.__makeTemplateObject(["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "])))))}}).apply(null,r))||(e.exports=i)},"EiD/":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultTextureUnits={DIFFUSE:0,NORMAL:1,EMISSION:2,OCCLUSION:3,METALLIC_ROUGHNESS:4,SSAO:6,SHADOW_MAP:7}}).apply(null,r))||(e.exports=i)},EiS2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("3kdR"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("lfQW"),n("DFuO"),n("G0ER"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d,f){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get(),r=this.configuration,i=n.build({attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new d(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),c.Default3D)},t.prototype.bindPass=function(e,t,n){this.program.setUniform4fv("eColor",t.color)},t.prototype.bindDraw=function(e){a.Transform.bindUniforms(this.program,e),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){var e=this.configuration,t=f.separateBlendingParams(770,1,771,771),n=0===e.output?e.transparent&&t:null,r=function(t){return f.makePipelineState({blending:n,polygonOffset:e.polygonOffset&&v,culling:(r=e.cullFace,0!==r&&{face:1===r?1028:1029,mode:2305}),depthTest:u.depthCompareLess,depthWrite:e.writeDepth&&f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?u.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?t?u.stencilToolMaskBaseParams:u.stencilBaseAllZerosParams:null});var r};return this._occludeeState=r(!0),r(!1)},Object.defineProperty(t.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!0,configurable:!0}),t.shader=new o.ReloadableShaderModule(p,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("DFuO")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(s.ShaderTechnique);t.ColorMaterialTechnique=h;var v={factor:1,units:1},m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.vertexColors=!1,t.transparent=!1,t.polygonOffset=!1,t.writeDepth=!0,t.sceneHasOcludees=!1,t}return r.__extends(t,e),r.__decorate([l.parameter({count:7})],t.prototype,"output",void 0),r.__decorate([l.parameter({count:3})],t.prototype,"cullFace",void 0),r.__decorate([l.parameter()],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([l.parameter()],t.prototype,"sliceHighlightDisabled",void 0),r.__decorate([l.parameter()],t.prototype,"vertexColors",void 0),r.__decorate([l.parameter()],t.prototype,"transparent",void 0),r.__decorate([l.parameter()],t.prototype,"polygonOffset",void 0),r.__decorate([l.parameter()],t.prototype,"writeDepth",void 0),r.__decorate([l.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(l.ShaderTechniqueConfiguration);t.ColorMaterialTechniqueConfiguration=m}).apply(null,r))||(e.exports=i)},EyQ4:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qsST"),n("xoE+"),n("Zp3t")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function o(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var s=o("DXT1"),l=o("DXT3"),c=o("DXT5");function u(e,t){var n=new Int32Array(e,0,31);if(542327876!==n[0])return a.error("Invalid magic number in DDS header"),null;if(!(4&n[20]))return a.error("Unsupported format, must contain a FourCC code"),null;var i,o,u,p=n[21];switch(p){case s:i=8,o=33776;break;case l:i=16,o=33778;break;case c:i=16,o=33779;break;default:return a.error("Unsupported FourCC code:",(u=p,String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255))),null}var d=1,f=n[4],h=n[3];0==(3&f)&&0==(3&h)||(a.warn("Rounding up compressed texture size to nearest multiple of 4."),f=f+3&-4,h=h+3&-4);var v,m,g=f,y=h;131072&n[2]&&!1!==t&&(d=Math.max(1,n[7])),1===d||r.isPowerOfTwo(f)&&r.isPowerOfTwo(h)||(a.warn("Ignoring mipmaps of non power of two sized compressed texture."),d=1);for(var _=n[1]+4,b=[],x=0;x<d;++x)m=(f+3>>2)*(h+3>>2)*i,v=new Uint8Array(e,_,m),b.push(v),_+=m,f=Math.max(1,f>>1),h=Math.max(1,h>>1);return{textureData:{type:"compressed",levels:b},internalFormat:o,width:g,height:y}}t.createDDSTexture=function(e,t,n,r){var a=u(n,r),o=a.textureData,s=a.internalFormat,l=a.width,c=a.height;t.samplingMode=o.levels.length>1?9987:9729,t.hasMipmap=o.levels.length>1,t.internalFormat=s,t.width=l,t.height=c;var p=new i(e,t,o);return e.bindTexture(p),p},t.createDDSTextureData=u}).apply(null,r))||(e.exports=i)},FLCf:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.makeNewRenderStats=function(){return{triangles:0,drawCalls:0}},t.addToRenderStats=function(e,t,n){n&&(n.drawCalls+=e,n.triangles+=t)};var n=function(){function e(){this.materialRenderStats=new Map,this.reset()}return e.prototype.getMaterialRenderStatsObject=function(e){var t=this.materialRenderStats.get(e);return t||this.materialRenderStats.set(e,t={triangles:0,drawCalls:0}),t},e.prototype.getAggregatedStats=function(){var e={materialRenderers:{},total:{triangles:0,drawCalls:0}};return this.materialRenderStats.forEach((function(t,n){e.materialRenderers[n]=t,e.total.drawCalls+=t.drawCalls,e.total.triangles+=t.triangles})),e},e.prototype.reset=function(){this.materialRenderStats.forEach((function(e){e.drawCalls=0,e.triangles=0}))},e}();t.RenderStatsAggregator=n}).apply(null,r))||(e.exports=i)},FNtW:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("W0kZ")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){this.supportsEdges=!1,this._visible=!0,this._renderOccluded=1,this._renderPriority=0,this._insertOrder=0,this.id=e._idGen.gen(t)}return e.prototype.dispose=function(){},e.prototype.update=function(e){return!1},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.parametersChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.parametersChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"insertOrder",{get:function(){return this._insertOrder},set:function(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())},enumerable:!0,configurable:!0}),e.prototype.isVisibleInPass=function(e){return!0},e.prototype.isVisible=function(){return this._visible},e.prototype.parametersChanged=function(){n.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)},e._idGen=new r.IdGen,e}();t.Material=i,t.materialPredicate=function(e,t){return e.isVisible()&&e.isVisibleInPass(t.pass)&&0!=(e.renderOccluded&t.renderOccludedMask)}}).apply(null,r))||(e.exports=i)},FQ4r:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){t&&(this._config=function(e){var t=e.__proto__.__configurationParameters||[],n={};n.key=e.key;for(var r=0,i=t;r<i.length;r++){var a=i[r];n[a]=e[a]}return n}(t)),this._program=this.initializeProgram(e),e.commonUniformStore&&(this._commonUniformStore=e.commonUniformStore,this._commonUniformStore.subscribeProgram(this._program)),this._pipeline=this.initializePipeline(e)}return e.prototype.dispose=function(){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose(),this._program=null)},e.prototype.reload=function(e){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose()),this._program=this.initializeProgram(e),this._commonUniformStore&&this._commonUniformStore.subscribeProgram(this._program)},Object.defineProperty(e.prototype,"program",{get:function(){return this._program},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pipeline",{get:function(){return this._pipeline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._config.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"configuration",{get:function(){return this._config},enumerable:!0,configurable:!0}),e.prototype.bindPass=function(e,t,n){},e.prototype.bindMaterial=function(e,t,n){},e.prototype.bindDraw=function(e,t,n){},e.prototype.bindPipelineState=function(e){e.setPipelineState(this.pipeline)},e.prototype.ensureAttributeLocations=function(e){this.program.assertCompatibleVertexAttributeLocations(e)},Object.defineProperty(e.prototype,"primitiveType",{get:function(){return 4},enumerable:!0,configurable:!0}),e}();t.ShaderTechnique=n}).apply(null,r))||(e.exports=i)},FU3N:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qsST"),n("LxLY"),n("dl/g"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,a){var o=n.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),s=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,a.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}();return function(){function e(e,t,n){this._textureRep=e,this._techniqueRep=t,this.onMaterialChanged=n,this._id2glMaterialRef=new Map}return e.prototype.acquire=function(e,t){this.ownMaterial(e);var n,r=i.getShaderOutputID(e.id,t),a=this._id2glMaterialRef.get(r);return null==a?(n=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t}),a=new s(n),this._id2glMaterialRef.set(r,a)):n=a.getGLMaterial(),a.incRefCnt(),n},e.prototype.release=function(e,t){var n=i.getShaderOutputID(e.id,t),r=this._id2glMaterialRef.get(n);if(r.decRefCnt(),0===r.getRefCnt()){var a=r.getGLMaterial();a&&a.dispose(),this._id2glMaterialRef.delete(n)}},e.prototype.materialChanged=function(e){for(var t=0,n=i.ShaderOutputTypes;t<n.length;t++){var r=n[t];if(5!==r.output&&6!==r.output){var a=this._id2glMaterialRef.get(i.getShaderOutputID(e.id,r.output));if(a&&a.getGLMaterial()){var o=a.getGLMaterial();o.updateParameters&&o.updateParameters()}}}this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.ownMaterial=function(e){r.isSome(e.materialRepository)&&e.materialRepository!==this&&o.error("Material is already owned by a different material repository"),e.materialRepository=this},e}()}).apply(null,r))||(e.exports=i)},FbvD:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("DJpR")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.cache=new Map}return e.prototype.dispose=function(){this.cache.forEach((function(e){n.isSome(e.texture)&&(e.texture.dispose(),e.texture=null)})),this.cache.clear()},e.prototype.acquire=function(e){if(n.isNone(e))return null;var t=this.patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;var a=this.patternToTextureData(e,2),o=a.length/2,s={refCount:1,texture:null,bind:function(e,t){return n.isNone(s.texture)&&(s.texture=new r.Texture(e,{width:a.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},a)),e.bindTexture(s.texture,t),o}};return this.cache.set(t,s),s.bind},e.prototype.release=function(e){if(!n.isNone(e)){var t=this.patternId(e),r=this.cache.get(t);r&&(r.refCount--,0===r.refCount&&(n.isSome(r.texture)&&r.texture.dispose(),this.cache.delete(t)))}},e.prototype.swap=function(e,t){var n=this.acquire(t);return this.release(e),n},e.prototype.bind=function(e,t,r,i,a){var o=n.isSome(i)?i(e,a)*t.pixelRatio:1;r.setUniform1i("stipplePatternTexture",a),r.setUniform1f("stipplePatternPixelSizeInv",1/o)},e.prototype.patternId=function(e){return e.join(",")},e.prototype.patternToTextureData=function(e,t){for(var n=e.reduce((function(e,t){return e+t}))*t,r=new Uint8Array(n),i=!0,a=0,o=0,s=e;o<s.length;o++){for(var l=s[o],c=0;c<l*t;c++)r[a++]=i?255:0;i=!i}return r},e}();t.StippleTextureRepository=i,t.createStipplePattern=function(e){return n.isNone(e)?e:e.slice()},t.createStipplePatternSimple=function(e){return[e,e]}}).apply(null,r))||(e.exports=i)},Fe95:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HANDLE_COLOR=[1,.5,0],t.GEOMETRY_SEGMENTS=128,t.DISC_RADIUS=70,t.DISC_COLLISION_RADIUS=80,t.DISC_HEIGHT=.02,t.DISC_TRANSLATE_ARROW_SIZE=54,t.DISC_TRANSLATE_ARROW_OFFSET=100,t.DISC_RADIUS_SMALL=Math.ceil(t.DISC_RADIUS/3*2),t.RING_RADIUS=160,t.RING_HEIGHT=.5,t.RING_THICKNESS=24,t.INDICATOR_THICKNESS=9,t.INNER_INDICATOR_RADIUS=t.RING_RADIUS+30,t.OUTER_INDICATOR_RADIUS=t.RING_RADIUS+53,t.ROTATE_INDICATOR_ARROW_TIP_LENGTH=60,t.ROTATE_INDICATOR_ARROW_TIP_RADIUS=23,t.ROTATE_INDICATOR_ARC_LENGTH=5*Math.PI/12,t.SCALE_INDICATOR_ARC_LENGTH=1*Math.PI/3,t.DRAG_THRESHOLD_PX=10,t.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE=.2,t.SCALE_INDICATOR_OFFSET1=30,t.SCALE_INDICATOR_OFFSET2=53,t.SCALE_INDICATOR_DIRECTION_BUFFER=.2,t.ROTATE_INDICATOR_DIRECTION_BUFFER=.3,t.RING_INDICATOR_DELAY_MS=200,t.RING_RESET_ANIMATION_SPEED_FACTOR=3,t.ALIGN_ARROWS_SCALE_THRESHOLD=1e6}).apply(null,r))||(e.exports=i)},"G+tB":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("PLh7"),n("uinn")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=function(e){switch(n.unwrap(e.graphic.geometry).type){case"point":return i.createVisualElements(e);case"polygon":case"polyline":return r.createVisualElements(e);default:return null}}}).apply(null,r))||(e.exports=i)},GDWR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("KY0m")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._uniforms={proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}return e.prototype.dispose=function(){this._uniforms=null},e.prototype.getPrograms=function(e){return this._uniforms[e]||[]},e.prototype.subscribeProgram=function(e){for(var t in this._uniforms)e.hasUniform(t)&&this._uniforms[t].push(e)},e.prototype.unsubscribeProgram=function(e){for(var t in this._uniforms)n.removeUnordered(this._uniforms[t],e)},e}();t.CommonUniformStore=r}).apply(null,r))||(e.exports=i)},GG08:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("0LE5"),n("JjCO")],void 0===(i=(function(e,t,n,r,i){function a(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function o(e,t){return void 0===t&&(t=a()),s(e[0],e[1],e[2],e[3],t)}function s(e,t,n,r,i){return void 0===i&&(i=a()),i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function l(e,t,n){void 0===n&&(n=a()),r.vec3.copy(n,t);var i=r.vec3.dot(t,t);return Math.abs(i-1)>1e-5&&i>1e-12&&r.vec3.scale(n,n,1/Math.sqrt(i)),c(n,e,n),n}function c(e,t,n){return e!==n&&o(e,n),n[3]=-r.vec3.dot(n,t),n}function u(e,t,n,o){return void 0===o&&(o=a()),l(n,r.vec3.cross(i.sv3d.get(),t,e),o)}function p(e,t,n){var a=r.vec3.scale(i.sv3d.get(),e,r.vec3.dot(e,t));return r.vec3.subtract(n,t,a),n}function d(e,t){return r.vec3.dot(e,t)+e[3]}function f(e,t,i,a,o,s){var l=r.vec3.dot(e,i);if(0===l)return!1;var c=-(r.vec3.dot(e,t)+e[3])/l;return o&&(c=a?Math.max(0,c):n.clamp(c,0,1)),!(c<0||!a&&c>1||(r.vec3.add(s,t,r.vec3.scale(s,i,c)),0))}Object.defineProperty(t,"__esModule",{value:!0}),t.create=a,t.wrap=function(e,t,n,r){return s(e,t,n,r,i.sv4d.get())},t.copy=o,t.fromValues=s,t.fromNormalAndOffset=function(e,t,n){return void 0===n&&(n=a()),r.vec3.copy(n,e),n[3]=t,n},t.fromPositionAndNormal=l,t.fromPoints=function(e,t,n,o){return void 0===o&&(o=a()),u(r.vec3.subtract(i.sv3d.get(),e,t),r.vec3.subtract(i.sv3d.get(),n,t),e,o)},t.setOffsetFromPoint=c,t.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},t.fromVectorsAndPoint=u,t.intersectRay=function(e,t,n){return f(e,t.origin,t.direction,!0,!1,n)},t.intersectLineSegment=function(e,t,n){return f(e,t.origin,t.vector,!1,!1,n)},t.intersectLineSegmentClamp=function(e,t,n){return f(e,t.origin,t.vector,!1,!0,n)},t.isSphereFullyInside=function(e,t){var n=t.radius;return d(e,t.center)-n>=0},t.isSphereFullyOutside=function(e,t){var n=t.radius;return d(e,t.center)+n<0},t.isPointInside=function(e,t){return d(e,t)>=0},t.isPointOutside=function(e,t){return d(e,t)<0},t.isAABBFullyInside=function(e,t){return e[0]*(e[0]>0?t[0]:t[3])+e[1]*(e[1]>0?t[1]:t[4])+e[2]*(e[2]>0?t[2]:t[5])+e[3]>=0},t.clip=function(e,t){var n=r.vec3.dot(e,t.ray.direction),i=-d(e,t.ray.origin);if(i<0&&n>=0)return!1;if(n>-1e-6&&n<1e-6)return i>0;if((i<0||n<0)&&!(i<0&&n<0))return!0;var a=i/n;return n>0?a<t.c1&&(t.c1=a):a>t.c0&&(t.c0=a),t.c0<=t.c1},t.clipInfinite=function(e,t){var n=r.vec3.dot(e,t.ray.direction),i=-d(e,t.ray.origin);if(n>-1e-6&&n<1e-6)return i>0;var a=i/n;return n>0?a<t.c1&&(t.c1=a):a>t.c0&&(t.c0=a),t.c0<=t.c1},t.projectPoint=function(e,t,n){var a=r.vec3.scale(i.sv3d.get(),e,-e[3]),o=p(e,r.vec3.subtract(i.sv3d.get(),t,a),i.sv3d.get());return r.vec3.add(n,o,a),n},t.projectVector=p,t.distance=function(e,t){return Math.abs(d(e,t))},t.signedDistance=d,t.normal=function(e){return e},t.UP=[0,0,1,0]}).apply(null,r))||(e.exports=i)},GyfB:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("0LE5"),n("JjCO"),n("18xY")],void 0===(i=(function(e,t,n,r,i){function a(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function o(e,t,n,r,i){return void 0===i&&(i=a()),i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}Object.defineProperty(t,"__esModule",{value:!0}),t.create=a,t.wrap=function(e,t,n,i){return o(e,t,n,i,r.sv4d.get())},t.wrapAxisAngle=function(e,t){return o(e[0],e[1],e[2],t,r.sv4d.get())},t.copy=function(e,t){return void 0===t&&(t=a()),o(e[0],e[1],e[2],e[3],t)},t.fromValues=o,t.fromAxisAndAngle=function(e,t,r){return void 0===r&&(r=a()),n.vec3.copy(r,e),r[3]=t,r},t.fromPoints=function(e,t,r){return void 0===r&&(r=a()),n.vec3.cross(r,e,t),n.vec3.normalize(r,r),r[3]=i.angle(e,t),r},t.UP=[0,0,1,0]}).apply(null,r))||(e.exports=i)},HbaO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("O7NG")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultIconElevationOffset=1,t.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2,t.TRANSPARENT_UNIT=n.vec4f64.ZEROS,t.WHITE_UNIT=n.vec4f64.ONES}).apply(null,r))||(e.exports=i)},ILj8:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("VfPl"),n("CIy2")],void 0===(i=(function(e,t,n,r){function i(e,t,n,r,i){var a=n.typedBuffer,o=n.typedBufferStride,s=e.length;if(r*=o,null==i||1===i)for(var l=0;l<s;++l){var c=2*e[l];a[r]=t[c],a[r+1]=t[c+1],r+=o}else for(l=0;l<s;++l){c=2*e[l];for(var u=0;u<i;++u)a[r]=t[c],a[r+1]=t[c+1],r+=o}}function a(e,t,n,r,i){var a=n.typedBuffer,o=n.typedBufferStride,s=e.length;if(r*=o,null==i||1===i)for(var l=0;l<s;++l){var c=3*e[l];a[r]=t[c],a[r+1]=t[c+1],a[r+2]=t[c+2],r+=o}else for(l=0;l<s;++l){c=3*e[l];for(var u=0;u<i;++u)a[r]=t[c],a[r+1]=t[c+1],a[r+2]=t[c+2],r+=o}}function o(e,t,n,r,i){var a=n.typedBuffer,o=n.typedBufferStride,s=e.length;if(r*=o,null==i||1===i)for(var l=0;l<s;++l){var c=4*e[l];a[r]=t[c],a[r+1]=t[c+1],a[r+2]=t[c+2],a[r+3]=t[c+3],r+=o}else for(l=0;l<s;++l){c=4*e[l];for(var u=0;u<i;++u)a[r]=t[c],a[r+1]=t[c+1],a[r+2]=t[c+2],a[r+3]=t[c+3],r+=o}}function s(e,t,n,r,i,o){if(n){var s=n,l=r.typedBuffer,c=r.typedBufferStride,u=e.length;if(i*=c,null==o||1===o)for(var p=0;p<u;++p){var d=t[v=3*e[p]],f=t[v+1],h=t[v+2];l[i]=s[0]*d+s[4]*f+s[8]*h+s[12],l[i+1]=s[1]*d+s[5]*f+s[9]*h+s[13],l[i+2]=s[2]*d+s[6]*f+s[10]*h+s[14],i+=c}else for(p=0;p<u;++p){d=t[v=3*e[p]];for(var v,m=s[0]*d+s[4]*(f=t[v+1])+s[8]*(h=t[v+2])+s[12],g=s[1]*d+s[5]*f+s[9]*h+s[13],y=s[2]*d+s[6]*f+s[10]*h+s[14],_=0;_<o;++_)l[i]=m,l[i+1]=g,l[i+2]=y,i+=c}}else a(e,t,r,i,o)}function l(e,t,n,r,i,o){if(n){var s=r.typedBuffer,l=r.typedBufferStride,c=e.length,u=n[0],p=n[1],d=n[2],f=n[4],h=n[5],v=n[6],m=n[8],g=n[9],y=n[10],_=Math.abs(1-u*u+f*f+m*m)>1e-5||Math.abs(1-p*p+h*h+g*g)>1e-5||Math.abs(1-d*d+v*v+y*y)>1e-5;if(i*=l,null==o||1===o)for(var b=0;b<c;++b){var x=u*(P=t[O=3*e[b]])+f*(M=t[O+1])+m*(C=t[O+2]),w=p*P+h*M+g*C,S=d*P+v*M+y*C;_&&(A=x*x+w*w+S*S)<.999999&&A>1e-6&&(x/=D=Math.sqrt(A),w/=D,S/=D),s[i+0]=x,s[i+1]=w,s[i+2]=S,i+=l}else for(b=0;b<c;++b){var O,P,M,C,A,D,T=u*(P=t[O=3*e[b]])+f*(M=t[O+1])+m*(C=t[O+2]),R=p*P+h*M+g*C,j=d*P+v*M+y*C;_&&(A=T*T+R*R+j*j)<.999999&&A>1e-6&&(T/=D=Math.sqrt(A),R/=D,j/=D);for(var E=0;E<o;++E)s[i+0]=T,s[i+1]=R,s[i+2]=j,i+=l}}else a(e,t,r,i,o)}function c(e,t,n,r,i,a){var o=r.typedBuffer,s=r.typedBufferStride,l=e.length;if(i*=s,null==a||1===a){if(4===n)for(var c=0;c<l;++c){var u=4*e[c];o[i]=t[u],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=t[u+3],i+=s}else if(3===n)for(c=0;c<l;++c)o[i]=t[u=3*e[c]],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=255,i+=s}else if(4===n)for(c=0;c<l;++c){u=4*e[c];for(var p=0;p<a;++p)o[i]=t[u],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=t[u+3],i+=s}else if(3===n)for(c=0;c<l;++c)for(u=3*e[c],p=0;p<a;++p)o[i]=t[u],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=255,i+=s}Object.defineProperty(t,"__esModule",{value:!0}),t.writeBufferVec2=i,t.writeBufferVec3=a,t.writeBufferVec4=o,t.writeBufferMat3f=function(e,t,n,r){var i=n.typedBuffer,a=n.typedBufferStride,o=e.length;r*=a;for(var s=0;s<o;++s){for(var l=9*e[s],c=0;c<9;++c)i[r+c]=t[l+c];r+=a}},t.writeBufferMat4f=function(e,t,n,r){var i=n.typedBuffer,a=n.typedBufferStride,o=e.length;r*=a;for(var s=0;s<o;++s){for(var l=16*e[s],c=0;c<16;++c)i[r+c]=t[l+c];r+=a}},t.writePosition=s,t.writeNormal=l,t.writeColor=c,t.writeMultipliedColor=function(e,t,n,r,i,a,o){var s=i.typedBuffer,l=i.typedBufferStride,c=e.length;if(a*=l,null==o||1===o){if(4===n)for(var u=0;u<c;++u){var p=4*e[u];s[a]=t[p]*r[0],s[a+1]=t[p+1]*r[1],s[a+2]=t[p+2]*r[2],s[a+3]=t[p+3]*r[3],a+=l}else if(3===n){var d=255*r[3];for(u=0;u<c;++u)s[a]=t[p=3*e[u]]*r[0],s[a+1]=t[p+1]*r[1],s[a+2]=t[p+2]*r[2],s[a+3]=d,a+=l}}else if(4===n)for(u=0;u<c;++u){p=4*e[u];for(var f=0;f<o;++f)s[a]=t[p]*r[0],s[a+1]=t[p+1]*r[1],s[a+2]=t[p+2]*r[2],s[a+3]=t[p+3]*r[3],a+=l}else if(3===n)for(d=255*r[3],u=0;u<c;++u)for(p=3*e[u],f=0;f<o;++f)s[a]=t[p]*r[0],s[a+1]=t[p+1]*r[1],s[a+2]=t[p+2]*r[2],s[a+3]=d,a+=l},t.writeDefaultAttributes=function(e,t,a,u,p,d){for(var f=0,h=t.fieldNames;f<h.length;f++){var v=h[f],m=e.vertexAttr[v],g=e.indices[v];if(m&&g)switch(v){case r.VertexAttrConstants.POSITION:r.assert(3===m.size);var y=p.getField(v,n.BufferViewVec3f);y&&s(g,m.data,a,y,d);break;case r.VertexAttrConstants.NORMAL:r.assert(3===m.size);var _=p.getField(v,n.BufferViewVec3f);_&&l(g,m.data,u,_,d);break;case r.VertexAttrConstants.UV0:r.assert(2===m.size);var b=p.getField(v,n.BufferViewVec2f);b&&i(g,m.data,b,d);break;case r.VertexAttrConstants.COLOR:r.assert(3===m.size||4===m.size);var x=p.getField(v,n.BufferViewVec4u8);x&&c(g,m.data,m.size,x,d);break;case r.VertexAttrConstants.SYMBOLCOLOR:r.assert(3===m.size||4===m.size);var w=p.getField(v,n.BufferViewVec4u8);w&&c(g,m.data,m.size,w,d);break;case r.VertexAttrConstants.TANGENT:r.assert(4===m.size);var S=p.getField(v,n.BufferViewVec4f);S&&o(g,m.data,S,d)}}}}).apply(null,r))||(e.exports=i)},IwVr:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultMaskAlphaCutoff=.1,t.symbolAlphaCutoff=.001,t.DiscardOrAdjustAlpha=function(e,t){var l=e.fragment;switch(t.alphaDiscardMode){case 0:l.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "]))));break;case 1:l.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a = 1.0;\n        }\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a = 1.0;\n        }\n      "]))));break;case 2:l.uniforms.add("textureAlphaCutoff","float"),l.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }\n      "]))));break;case 3:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(r.glsl(s||(s=n.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }\n      "]))))}}}).apply(null,r))||(e.exports=i)},J2BX:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("CIy2")],void 0===(i=(function(e,t,n,r){function i(e,t){for(var n=e,i=new Uint8Array(4*n*n),a=n/2-.5,o=t/2,s=0;s<n;s++)for(var l=0;l<n;l++){var c=l+n*s,u=l-a,p=s-a,d=Math.sqrt(u*u+p*p)-o;r.packFloatRGBA(d=d/e+.5,i,4*c)}return i}function a(e,t){return u(e,t,!1)}function o(e,t){return u(e,t,!0)}function s(e,t){return p(e,t,!1)}function l(e,t){return p(e,t,!0)}function c(e,t){for(var n=new Uint8Array(4*e*e),i=Math.sqrt(1.25),a=(e-t)/2,o=0;o<e;o++)for(var s=0;s<e;s++){var l=o*e+s,c=(s-a)/t,u=(o-a+.75)/t,p=Math.max(-(1*c+-.5*u)/i,(1*(c-1)+-.5*-u)/i,-u)*t/e+.5;r.packFloatRGBA(p,n,4*l)}return n}function u(e,t,n){n&&(t/=Math.SQRT2);for(var i=new Uint8Array(4*e*e),a=0;a<e;a++)for(var o=0;o<e;o++){var s=o-.5*e+.25,l=.5*e-a-.75,c=a*e+o;if(n){var u=(s+l)/Math.SQRT2;l=(l-s)/Math.SQRT2,s=u}var p=Math.max(Math.abs(s),Math.abs(l))-.5*t;r.packFloatRGBA(p=p/e+.5,i,4*c)}return i}function p(e,t,n){n&&(t*=Math.SQRT2);for(var i=.5*t,a=new Uint8Array(4*e*e),o=0;o<e;o++)for(var s=0;s<e;s++){var l=s-.5*e,c=.5*e-o-1,u=o*e+s;if(n){var p=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=p}var d=void 0;d=(d=(l=Math.abs(l))>(c=Math.abs(c))?l>i?Math.sqrt((l-i)*(l-i)+c*c):c:c>i?Math.sqrt(l*l+(c-i)*(c-i)):l)/e+.5,r.packFloatRGBA(d,a,4*u)}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.createType=function(e,t,r){switch(e){case"circle":return i(t,r);case"square":return a(t,r);case"cross":return s(t,r);case"x":return l(t,r);case"kite":return o(t,r);case"triangle":return c(t,r);default:return n.neverReached(e),i(t,r)}},t.createCircle=i,t.createSquare=a,t.createKite=o,t.createCross=s,t.createX=l,t.createTriangle=c}).apply(null,r))||(e.exports=i)},JXo2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("pcDC"),n("BcWh"),n("eIBl"),n("XwIv"),n("LxLY"),n("8MXS"),n("Vx27"),n("0LE5"),n("ZcgO"),n("DtIM"),n("woUR"),n("5T2R"),n("B3XD"),n("1eTA"),n("X5J5"),n("G+tB"),n("YsOV"),n("Fe95"),n("BhkK"),n("dtql"),n("73uV"),n("R4nD"),n("/NuL"),n("JjCO"),n("ys4y"),n("4ziW"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x,w,S,O,P,M,C,A,D){Object.defineProperty(t,"__esModule",{value:!0});var T=function(e){function t(t){var n=e.call(this,t)||this;return n._vertexManipulatorMaterial=h.createManipulatorMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.vertex.color),g.settings.reshapeManipulators.vertex.renderOccludedFlag),n._vertexManipulatorOutlineMaterial=h.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.vertex.outlineColor),g.settings.reshapeManipulators.vertex.renderOccludedFlag),n._vertexManipulatorHoverOutlineMaterial=h.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.vertex.hoverOutlineColor),g.settings.reshapeManipulators.vertex.renderOccludedFlag),n._edgeManipulatorMaterial=h.createManipulatorMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.edge.color),g.settings.reshapeManipulators.edge.renderOccludedFlag),n._edgeManipulatorOutlineMaterial=h.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.edge.outlineColor),g.settings.reshapeManipulators.edge.renderOccludedFlag),n._selectedManipulatorMaterial=h.createManipulatorMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.selected.color),g.settings.reshapeManipulators.selected.renderOccludedFlag),n._selectedManipulatorOutlineMaterial=h.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.selected.outlineColor),g.settings.reshapeManipulators.selected.renderOccludedFlag),n._selectedManipulatorHoverOutlineMaterial=h.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.selected.hoverOutlineColor),g.settings.reshapeManipulators.selected.renderOccludedFlag),n._selectedIndex=0,n._vertexManipulatorGeometry=null,n._vertexManipulatorOutlineGeometry=null,n._edgeManipulatorGeometry=null,n._edgeManipulatorOutlineGeometry=null,n._handles=new a,n._manipulatorHandles=new a,n._manipulatorInfos=[],n._reshapeHelper=null,n._graphicMoveManipulation=null,n._moveManipulation=null,n._numGrabbing=0,n._numDragging=0,n._reshapeEventState=0,n._outlineVisualElement=null,n.tool=null,n.outputGeometry=null,n._vertexLaserLineVisualElement=null,n}return n.__extends(t,e),t.prototype.initialize=function(){var e=this,t=new P.GraphicState({graphic:this.graphic});this._graphicState=t,this._handles.add([t.watch("displaying",(function(t){for(var n=0,r=e._manipulatorInfos;n<r.length;n++)r[n].manipulator.available=t})),this.view.trackGraphicState(t)])},t.prototype.destroy=function(){this._clear(),this._handles.destroy()},Object.defineProperty(t.prototype,"inputGeometry",{get:function(){return s.isSome(this._reshapeHelper)?this._reshapeHelper.geometry:null},set:function(e){this._recreateManipulators(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manipulators",{get:function(){return this.tool.manipulators},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.tool.view},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphic",{get:function(){return this.tool.graphic},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableZ",{get:function(){return this.tool.enableZ},enumerable:!0,configurable:!0}),t.prototype.removeSelectedVertices=function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.handle.type}));this._removeVertices(e)},t.prototype.manipulatorSelectionChanged=function(){this.emit("manipulators-changed")},t.prototype._clear=function(){this._moveManipulation&&this._moveManipulation.destroy(),this._graphicMoveManipulation&&this._graphicMoveManipulation.destroy(),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._graphicMoveManipulation=null,this._moveManipulation=null,this._reshapeHelper=null,this._numGrabbing=0,this._numDragging=0},t.prototype._recreateManipulators=function(e){if(void 0===e&&(e=this.inputGeometry),this._clear(),!s.isNone(e)){this._reshapeHelper=new z(_.EditGeometry.fromGeometry(e,this.view.viewingMode),e.type);for(var t=d.getGraphicEffectiveElevationInfo(this.graphic),n=0,r=this._reshapeHelper.data.components;n<r.length;n++){for(var i=r[n],a=0,o=i.vertices;a<o.length;a++)this._createPerVertexManipulator(o[a],t);for(var l=0,c=i.edges;l<c.length;l++)this._createPerVertexManipulator(c[l],t)}this._createGraphicMoveManipulators(t)}},t.prototype._perGraphicManipulatorDragAction=function(e,t){if("end"!==t.action){for(var n=[],r=this._manipulatorInfos.some((function(e){return"vertex"===e.handle.type&&e.manipulator.selected})),i=1===e&&r,a=s.unwrap(this._reshapeHelper),o=0,l=this._manipulatorInfos;o<l.length;o++)"vertex"===(d=l[o]).handle.type&&(d.manipulator.grabbing||i&&!d.manipulator.selected||(s.unwrap(a).moveVertices([d.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),n.push(d.handle.pos),this._updateManipulatorPosition(d)));if(0!==n.length){for(var c=0,u=0,p=this._manipulatorInfos;u<p.length;u++){var d;"vertex"===(d=p[u]).handle.type&&c++}if(this.outputGeometry=a.geometry,n.length===c){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}}},t.prototype._perVertexManipulatorDragAction=function(e,t){if(this._updateEventState(2),!this.destroyed){var n=t.mapDeltaX,r=t.mapDeltaY,i=t.mapDeltaZ;if(n||r||i){for(var a=[],o=0,l=this._manipulatorInfos;o<l.length;o++){var c=l[o];j(c)&&(c.manipulator.selected&&!c.manipulator.grabbing||c===e)&&a.push(c)}for(var u=s.unwrap(this._reshapeHelper),p=0,d=a;p<d.length;p++){var f=d[p];u.moveVertices([f.handle],n,r,i)}this.outputGeometry=u.geometry;for(var h=0,v=a;h<v.length;h++)this._updateManipulatorPosition(f=v[h]);this.emit("reshape",{type:"reshape",mover:this.graphic})}}},t.prototype._updateEventState=function(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t},t.prototype._createGraphicMoveManipulators=function(e){var t=this;this._graphicMoveManipulation=new S.MoveXYGraphicManipulation({tool:this.tool,view:this.view,graphicState:this._graphicState}),this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((function(e,n,r){n.next((function(e){return t._trackNumDragging(e)})).next((function(e){t._perGraphicManipulatorDragAction(0,e)})),r.next(t._cancelDragOperation())}))),this._graphicMoveManipulation.forEachManipulator((function(e){return t._manipulatorHandles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click"),e.stopPropagation()}))])})),this._moveManipulation=new x.MoveManipulation({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&m.canMoveZ(this.graphic),snapToScene:!1,radius:x.MoveManipulation.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((function(e){t._handles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(n){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some((function(e){return e.manipulator.selected}))||t.emit("immediate-click"),n.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var n=s.unwrap(this.graphic.geometry).spatialReference;this._handles.add([this._moveManipulation.createDragPipeline((function(e,n,r){n.next((function(e){return t._trackNumDragging(e)})).next(D.addMapDelta()).next((function(e){t._perGraphicManipulatorDragAction(1,e)})),r.next(t._cancelDragOperation())}),e,n),l.init(this._graphicState,"displaying",(function(e){t._moveManipulation.xyManipulation.available=e,t._moveManipulation.xyAxisManipulation.available=!0,t._moveManipulation.zManipulation.available=e&&t.enableZ&&m.canMoveZ(t.graphic),t._updateMoveManipulationPosition()})),this._graphicState.on("changed",(function(){return t._updateMoveManipulationPosition()}))]),this._updateMoveManipulationPosition();var r=y.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:function(e){if(!t.destroyed){t._graphicMoveManipulation.forEachManipulator(e);for(var n=0,r=t._manipulatorInfos;n<r.length;n++)e(r[n].manipulator,1);t._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:function(e){return t.on("manipulators-changed",e)}});this._outlineVisualElement=r.visualElement instanceof O.OutlineVisualElement?r.visualElement:null,s.isSome(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(function(){t._graphicState.isDraped||t._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(function(){return t._updateMoveManipulationPosition()}))]),this._manipulatorHandles.add(r)},t.prototype._createPerVertexManipulator=function(e,t){var n=this;if(void 0===t&&(t=d.getGraphicEffectiveElevationInfo(this.graphic)),s.isNone(this._vertexManipulatorGeometry)||s.isNone(this._vertexManipulatorOutlineGeometry)){var r=g.settings.reshapeManipulators.vertex,i=(l=r.size/2)/(c=l+r.collisionPadding);this._vertexManipulatorGeometry=new C(A.createSphereGeometry(i,16,16),"reshape-manipulator");var a=(l+r.outlineSize)/c;this._vertexManipulatorOutlineGeometry=new C(A.createSphereGeometry(a,16,16),"reshape-manipulator-outline")}if(s.isNone(this._edgeManipulatorGeometry)||s.isNone(this._edgeManipulatorOutlineGeometry)){var l,c,u=g.settings.reshapeManipulators.edge;i=(l=u.size/2)/(c=l+u.collisionPadding),this._edgeManipulatorGeometry=new C(A.createSphereGeometry(i,16,16),"reshape-manipulator"),this._edgeManipulatorOutlineGeometry=new C(A.createSphereGeometry(a=(l+u.outlineSize)/c,16,16),"reshape-manipulator-outline")}var p=new f.Manipulator3D({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|I.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|I.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|I.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|I.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|I.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|I.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|I.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(p,e,t);var h="edge"===e.type?{manipulator:p,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:p,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(h),this.manipulators.add(p),this._updateManipulatorPosition(h),"edge"===h.type){var m=this._getManipulatorInfoFromHandle(h.handle.left).manipulator.events.on("location-update",(function(){return n._updateManipulatorPosition(h)})),y=this._getManipulatorInfoFromHandle(h.handle.right).manipulator.events.on("location-update",(function(){return n._updateManipulatorPosition(h)}));h.locationUpdateHandle=o.handlesGroup([m,y]),this._manipulatorHandles.add(h.locationUpdateHandle,p)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(p,!0),p);var _=D.createManipulatorDragEventPipeline(p,(function(e,t,r){t.next((function(e){return n._trackNumDragging(e)})).next((function(e){return E(h)&&n._splitEdgeManipulator(h),e})).next(v.screenToMapXYForGraphicAtLocation(n.view,n.graphic,e.elevationAlignedLocation,e.location.spatialReference)).next(D.addMapDelta()).next((function(e){"vertex"===h.type?n._perVertexManipulatorDragAction(h,e):console.error("drag operation on non-vertex manipulator not allowed")})),r.next(n._cancelDragOperation())}));return this._manipulatorHandles.add(_,p),this._manipulatorHandles.add([p.events.on("immediate-click",(function(e){return n._manipulatorClickCallback(e,h)})),p.events.on("select-changed",(function(){h.selectedIndex=++n._selectedIndex,n._updateMoveManipulationPosition()}))]),this.emit("manipulators-changed"),p},t.prototype._trackNumDragging=function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e},t.prototype._cancelDragOperation=function(){var e=this,t=s.isSome(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return function(){switch(e._numDragging--,e.inputGeometry=t,e.outputGeometry=t,e._reshapeEventState){case 0:break;case 1:e.emit("move",{type:"move",dx:0,dy:0,mover:e.graphic});break;case 2:e.emit("reshape",{type:"reshape",mover:e.graphic})}e.destroyed||e._updateEventState(0)}},t.prototype._setTypeSpecificManipulatorSettings=function(e,t,n){switch(t.type){case"vertex":e.state=I.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=g.settings.reshapeManipulators.vertex.size/2+g.settings.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=n;break;case"edge":e.state=I.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=g.settings.reshapeManipulators.edge.size/2+g.settings.reshapeManipulators.edge.collisionPadding,e.elevationInfo={mode:"absolute-height",offset:0};break;default:r.neverReached(t)}},t.prototype._watchAndUpdateGrabState=function(e,t){var n=this;return e.events.on("grab-changed",(function(r){if("start"===r.action)t&&n._updateSelection(e),n._numGrabbing++;else if(n._numGrabbing--,n._updateEventState(0),n.destroyed)return;n._moveManipulation.interactive=!n._numGrabbing}))},t.prototype._clearSelection=function(){for(var e=0,t=this._manipulatorInfos;e<t.length;e++){var n=t[e];n.manipulator.grabbing||(n.manipulator.selected=!1)}},t.prototype._updateSelection=function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))},t.prototype._removeManipulator=function(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))},t.prototype._getManipulatorInfoFromHandle=function(e){if(e)for(var t=0,n=this._manipulatorInfos;t<n.length;t++){var r=n[t];if(e===r.handle)return r}return null},t.prototype._updateManipulatorPosition=function(e){if(e){var t=s.unwrap(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.data.coordinateHelper.toPoint(e.handle.pos,V),e.manipulator.grabbing&&s.isSome(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){var n=this._getManipulatorInfoFromHandle(e.handle.left).manipulator.elevationAlignedLocation,r=this._getManipulatorInfoFromHandle(e.handle.right).manipulator.elevationAlignedLocation;e.manipulator.elevationAlignedLocation=p.makeDehydratedPoint(n.x+.5*(r.x-n.x),n.y+.5*(r.y-n.y),n.hasZ&&r.hasZ?n.z+.5*(r.z-n.z):void 0,t.geometry.spatialReference)}}},t.prototype._splitEdgeManipulator=function(e){var t=s.unwrap(this._reshapeHelper),n=s.unwrap(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var r=e;r.handle=n,r.type="vertex";var i=d.getGraphicEffectiveElevationInfo(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,i),n.left&&this._createPerVertexManipulator(n.left),n.right&&this._createPerVertexManipulator(n.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(r),this._updateSelection(e.manipulator);var a=t.data.coordinateHelper.toArray(r.handle.pos),o=t.data.components.indexOf(n.component);this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:a,componentIndex:o,vertexIndex:s.unwrap(n.index)}],added:a})},t.prototype._updateMoveManipulationPosition=function(){var e=this,t=M.sv3d.get();u.vec3.set(t,0,0,0);for(var n=0,r=!1,i=null,a=null,o=0,l=this._manipulatorInfos;o<l.length;o++){var c=l[o];j(c)&&(c.manipulator.selected?(n++,u.vec3.add(t,t,c.manipulator.renderLocation),s.isNone(i)||c.selectedIndex>i.selectedIndex?(a=i,i=c):(s.isNone(a)||c.selectedIndex>a.selectedIndex)&&(a=c)):r=!0)}if(this._moveManipulation.xyAxisManipulation.orthogonalAvailable=!0,this._moveManipulation.xyAxisManipulation.available=!0,0!==n){var p=0;if(s.isSome(i)){var d=i.handle.pos,f=s.isSome(a)?a.handle.pos:i.handle.left&&i.handle.left.left?i.handle.left.left.pos:null,v=!s.isSome(a)&&i.handle.right&&i.handle.right.right?i.handle.right.right.pos:null;f&&v?this._moveManipulation.xyAxisManipulation.available=!1:f?p=R(f,d):v&&(p=R(d,v))}this._moveManipulation.xyAxisManipulation.orthogonalAvailable=1!==n,this._moveManipulation.angle=p,this._moveManipulation.radius=b.DISC_RADIUS_SMALL}else this._moveManipulation.angleDeferred=function(){return w.primaryShapeOrientation(s.unwrap(e.graphic.geometry))},this._moveManipulation.radius=x.MoveManipulation.radiusForSymbol(this.graphic.symbol);0!==n&&r?(u.vec3.scale(t,t,1/n),V.spatialReference=s.unwrap(this._reshapeHelper).geometry.spatialReference,this.view.renderCoordsHelper.fromRenderCoords(t,V),this._moveManipulation.elevationAlignedLocation=V):s.isSome(this._outlineVisualElement)&&!this._graphicState.isDraped&&s.isSome(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:h.placeAtGraphic(this.view,this._moveManipulation,this.graphic)},t.prototype._removeVertices=function(e){for(var t=[],n=s.unwrap(this._reshapeHelper),r=0,i=e;r<i.length;r++){var a=i[r];if("vertex"===a.handle.type&&n.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.right));var o=s.unwrap(n.removeVertices([a.handle]).removedVertices[0].createdEdge);o&&this._createPerVertexManipulator(o)}}if(t.length>0){var l=t.map((function(e){var t=n.data.components.indexOf(e.component);return{coordinates:n.data.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:s.unwrap(e.index)}}));this.outputGeometry=n.geometry;var c=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:l.map((function(e){return e.coordinates})),vertices:l}),this.destroyed)return;if(c&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}},t.prototype._manipulatorClickCallback=function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),E(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()},n.__decorate([c.property({constructOnly:!0})],t.prototype,"tool",void 0),n.__decorate([c.property()],t.prototype,"inputGeometry",null),n.__decorate([c.property()],t.prototype,"outputGeometry",void 0),n.__decorate([c.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.ReshapeOperation")],t)}(i.EventedAccessor);function R(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function j(e){return"vertex"===e.handle.type}function E(e){return"edge"===e.handle.type}t.ReshapeOperation=T;var I,V=p.makeDehydratedPoint(0,0,null,null);!function(e){e.Vertex=16,e.Edge=32}(I||(I={}));var z=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.type=n,r._geometry=null,r}return n.__extends(t,e),Object.defineProperty(t.prototype,"geometry",{get:function(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.data.toPolyline();break;case"polygon":this._geometry=this.data.toPolygon()}this._dirty=!1}return this._geometry},enumerable:!0,configurable:!0}),t}(_.EditGeometryHelper);t.ReshapeGeometryHelper=z}).apply(null,r))||(e.exports=i)},JjCO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("wSO/")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.sv2d=n.VectorStack.createVec2f64(),t.sv3d=n.VectorStack.createVec3f64(),t.sv4d=n.VectorStack.createVec4f64(),t.sm3d=n.VectorStack.createMat3f64(),t.sm4d=n.VectorStack.createMat4f64(),t.sq4d=n.VectorStack.createQuatf64()}).apply(null,r))||(e.exports=i)},KPBO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dotProduct=function(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n},t.elementwiseProduct=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]*t[r];return n},t.scalarProduct=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]*t;return n},t.add=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]+t[r];return n}}).apply(null,r))||(e.exports=i)},KQg4:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("0W55"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a){var o;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(){var e=new a.ShaderBuilder;return e.include(r.ScreenSpacePass),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(i.glsl(o||(o=n.__makeTemplateObject(["\n    void main() {\n      vec4 texColor = texture2D(tex, uv);\n      gl_FragColor = texColor * color;\n    }\n  "],["\n    void main() {\n      vec4 texColor = texture2D(tex, uv);\n      gl_FragColor = texColor * color;\n    }\n  "])))),e}}).apply(null,r))||(e.exports=i)},KRuQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDisposableMixin=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isDisposed=!1,t}return n.__extends(t,e),t.prototype.dispose=function(){for(var e=this.__proto__.__managedDisposables__||[],t=e.length-1;t>=0;t--){var n=e[t];this[n]&&"function"==typeof this[n].dispose&&this[n].dispose(),this[n]=null}this._isDisposed=!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),t}(e)};var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(t.AutoDisposableMixin((function(){})));t.AutoDisposable=r,t.autoDispose=function(){return function(e,t){e.hasOwnProperty("__managedDisposables__")||(e.__managedDisposables__=e.__managedDisposables__?e.__managedDisposables__.slice():[]),e.__managedDisposables__.push(t)}}}).apply(null,r))||(e.exports=i)},KtQ6:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e){return"h"in e&&"s"in e&&"v"in e}function r(e){return"l"in e&&"a"in e&&"b"in e}function i(e){return"l"in e&&"c"in e&&"h"in e}function a(e){return"x"in e&&"y"in e&&"z"in e}Object.defineProperty(t,"__esModule",{value:!0});var o=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],s=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function l(e,t){var n,r,i=[];if(e[0].length!==t.length)throw"dimensions do not match";var a=e.length,o=e[0].length,s=0;for(n=0;n<a;n++){for(s=0,r=0;r<o;r++)s+=e[n][r]*t[r];i.push(s)}return i}function c(e){var t=[e.r/255,e.g/255,e.b/255].map((function(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)})),n=l(o,t);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function u(e){var t=l(s,[e.x/100,e.y/100,e.z/100]).map((function(e){var t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function p(e){var t=[e.x/95.047,e.y/100,e.z/108.883].map((function(e){return e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29}));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function d(e){var t=e.l,n=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((function(e){return e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)}));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function f(e){return p(c(e))}function h(e){return u(d(e))}function v(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:i(e)?function(e){return u(d(function(e){var t=e.c,n=e.h;return{l:e.l,a:t*Math.cos(n),b:t*Math.sin(n)}}(e)))}(e):r(e)?h(e):a(e)?u(e):n(e)?function(e){var t,n=(e.h+360)%360/60,r=e.v/100*255,i=r*(e.s/100),a=i*(1-Math.abs(n%2-1));switch(Math.floor(n)){case 0:t={r:i,g:a,b:0};break;case 1:t={r:a,g:i,b:0};break;case 2:t={r:0,g:i,b:a};break;case 3:t={r:0,g:a,b:i};break;case 4:t={r:a,g:0,b:i};break;case 5:case 6:t={r:i,g:0,b:a};break;default:t={r:0,g:0,b:0}}return t.r=Math.round(t.r+r-i),t.g=Math.round(t.g+r-i),t.b=Math.round(t.b+r-i),t}(e):void 0}t.toRGB=v,t.toHSV=function(e){return n(e)?e:function(e){var t,n,r,i=e.r,a=e.g,o=e.b,s=Math.max(i,a,o),l=s-Math.min(i,a,o);return r=s,0===l?t=0:s===i?t=(a-o)/l%6:s===a?t=(o-i)/l+2:s===o&&(t=(i-a)/l+4),n=0===l?0:l/r,t<0&&(t+=6),{h:t*=60,s:n*=100,v:r*=100/255}}(v(e))},t.toLAB=function(e){return r(e)?e:f(v(e))},t.toLCH=function(e){return i(e)?e:function(e){return function(e){var t=e.l,n=e.a,r=e.b,i=Math.sqrt(n*n+r*r),a=Math.atan2(r,n);return{l:t,c:i,h:a=a>0?a:a+2*Math.PI}}(p(c(e)))}(v(e))},t.toXYZ=function(e){return a(e)?e:c(v(e))},t.darken=function(e,t){var n=f(e);return n.l*=1-t,h(n)}}).apply(null,r))||(e.exports=i)},Kvb2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("woUR")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return e.prototype.update=function(e){var t=this;this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,i){if(0===i&&(t.zManipulator=e),e instanceof r.Manipulator3D&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),n.isNone(t.firstGrabbedXY)&&e.grabbing&&1===i&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=1,i){case 0:t.grabbingState|=2;break;case 1:t.grabbingState|=4}}))},e}();t.ManipulatorState=i}).apply(null,r))||(e.exports=i)},KwnQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("z4cv")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.mat2f64=n}).apply(null,r))||(e.exports=i)},LZD4:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("2B1V"),n("CIy2"),n("ILj8")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PositionLayout=n.newLayout().vec3f(r.VertexAttrConstants.POSITION),t.PositionUVLayout=n.newLayout().vec3f(r.VertexAttrConstants.POSITION).vec2f(r.VertexAttrConstants.UV0),t.PositionColorLayout=n.newLayout().vec3f(r.VertexAttrConstants.POSITION).vec4u8(r.VertexAttrConstants.COLOR);var a=function(){function e(e){this.vertexBufferLayout=e}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices[r.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,n,r){i.writeDefaultAttributes(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,r)},e}();t.DefaultBufferWriter=a}).apply(null,r))||(e.exports=i)},MCHn:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("0LE5"),n("Rdxj"),n("aWgr"),n("hX2R"),n("qSzK")],void 0===(i=(function(e,t,n,r,i,a,o,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e){this.view=null,this._angleCutoff=s.defaultAngleCutoff,this._style={},this._heightManifoldTarget=i.vec3f64.create(),this._heightManifoldEnabled=!1,this._intersectsLine=a.lineSegment.create(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneBuffers=null;var t=!0;for(var n in e)n in this?"attached"===n?t=e[n]:this[n]=e[n]:console.error("Cannot set unknown property",n);this.attached=t}return e.prototype.destroy=function(){this.disposeRenderer()},Object.defineProperty(e.prototype,"attached",{get:function(){return!!this.renderer},set:function(e){e?this.ensureRenderer():this.disposeRenderer()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angleCutoff",{get:function(){return this._angleCutoff},set:function(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(e){this._style=e,this.syncStyle()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heightManifoldTarget",{get:function(){return this._heightManifoldEnabled?this._heightManifoldTarget:null},set:function(e){n.isSome(e)?(r.vec3.copy(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsWorldUpAtLocation",{set:function(e){if(n.isNone(e))this.intersectsLine=null;else{var t=this.view.renderCoordsHelper.worldUpAtPosition(e,c);this.intersectsLine=a.lineSegment.fromValues(e,t),this.intersectsLineInfinite=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLine",{get:function(){return this._intersectsLineEnabled?this._intersectsLine:null},set:function(e){n.isSome(e)?(a.lineSegment.copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineInfinite",{get:function(){return this._intersectsLineInfinite},set:function(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathVerticalPlane",{get:function(){return this._pathVerticalPlaneBuffers},set:function(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncRenderer()},enumerable:!0,configurable:!0}),e.prototype.syncRenderer=function(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||n.isSome(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()},e.prototype.ensureRenderer=function(){n.isSome(this.renderer)||(this.renderer=new o.LaserLineRenderer(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))},e.prototype.syncStyle=function(){n.isNone(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))},e.prototype.syncAngleCutoff=function(){n.isNone(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})},e.prototype.syncHeightManifold=function(){n.isNone(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))},e.prototype.syncIntersectsLine=function(){n.isNone(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))},e.prototype.syncIntersectsLineInfinite=function(){n.isNone(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)},e.prototype.syncPathVerticalPlane=function(){n.isNone(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=n.isSome(this._pathVerticalPlaneBuffers),n.isSome(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))},e.prototype.disposeRenderer=function(){n.isSome(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)},e}();t.LaserlineVisualElement=l;var c=i.vec3f64.create()}).apply(null,r))||(e.exports=i)},N5NQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("PHan"),n("0LE5"),n("Rdxj"),n("JjCO")],void 0===(i=(function(e,t,n,r,i,a,o){function s(e){return e?{origin:a.vec3f64.clone(e.origin),vector:a.vec3f64.clone(e.vector)}:{origin:a.vec3f64.create(),vector:a.vec3f64.create()}}function l(e,t){var n=h.get();return n.origin=e,n.vector=t,n}function c(e,t,n){return void 0===n&&(n=s()),i.vec3.copy(n.origin,e),i.vec3.copy(n.vector,t),n}function u(e,t){var r=i.vec3.subtract(o.sv3d.get(),t,e.origin),a=i.vec3.dot(e.vector,r),s=i.vec3.dot(e.vector,e.vector),l=n.clamp(a/s,0,1),c=i.vec3.subtract(o.sv3d.get(),i.vec3.scale(o.sv3d.get(),e.vector,l),r);return i.vec3.dot(c,c)}function p(e,t,r,a,s){var l=e.vector,c=e.origin,u=i.vec3.subtract(o.sv3d.get(),t,c),p=i.vec3.length(l),d=i.vec3.dot(l,u)/p;return i.vec3.scale(s,l,n.clamp(d,r,a)),i.vec3.add(s,s,e.origin)}function d(e,t,r,a){var s=e.origin,l=i.vec3.add(o.sv3d.get(),s,e.vector),c=t.origin,u=i.vec3.add(o.sv3d.get(),c,t.vector),p=o.sv3d.get(),d=o.sv3d.get();if(p[0]=s[0]-c[0],p[1]=s[1]-c[1],p[2]=s[2]-c[2],d[0]=u[0]-c[0],d[1]=u[1]-c[1],d[2]=u[2]-c[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;var f=o.sv3d.get();if(f[0]=l[0]-s[0],f[1]=l[1]-s[1],f[2]=l[2]-s[2],Math.abs(f[0])<1e-6&&Math.abs(f[1])<1e-6&&Math.abs(f[2])<1e-6)return!1;var h=p[0]*d[0]+p[1]*d[1]+p[2]*d[2],v=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],m=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],g=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],y=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*g-v*v;if(Math.abs(y)<1e-6)return!1;var _=(h*v-m*g)/y,b=(h+v*_)/g;r&&(_=n.clamp(_,0,1),b=n.clamp(b,0,1));var x=o.sv3d.get(),w=o.sv3d.get();return x[0]=s[0]+_*f[0],x[1]=s[1]+_*f[1],x[2]=s[2]+_*f[2],w[0]=c[0]+b*d[0],w[1]=c[1]+b*d[1],w[2]=c[2]+b*d[2],a.tA=_,a.tB=b,a.pA=x,a.pB=w,a.distance2=i.vec3.squaredDistance(x,w),!0}Object.defineProperty(t,"__esModule",{value:!0}),t.create=s,t.wrap=l,t.copy=function(e,t){return void 0===t&&(t=s()),c(e.origin,e.vector,t)},t.fromValues=c,t.fromPoints=function(e,t,n){return void 0===n&&(n=s()),i.vec3.copy(n.origin,e),i.vec3.subtract(n.vector,t,e),n},t.distance2=u,t.distance=function(e,t){return Math.sqrt(u(e,t))},t.projectPoint=function(e,t,n){return p(e,t,0,1,n)},t.pointAt=function(e,t,n){return i.vec3.add(n,e.origin,i.vec3.scale(n,e.vector,t))},t.projectPointClamp=p,t.closestRayDistance2=function(e,t){if(d(e,l(t.origin,t.direction),!1,f)){var n=f.tA,r=f.pB;if(n>=0&&n<=1)return f.distance2;if(n<0)return i.vec3.squaredDistance(e.origin,r);if(n>1)return i.vec3.squaredDistance(i.vec3.add(o.sv3d.get(),e.origin,e.vector),r)}return null},t.closestLineSegmentPoint=function(e,t,n){return!!d(e,t,!0,f)&&(i.vec3.copy(n,f.pA),!0)},t.closestLineSegmentDistance2=function(e,t){return d(e,t,!0,f)?f.distance2:null};var f={tA:0,tB:0,pA:a.vec3f64.create(),pB:a.vec3f64.create(),distance2:0},h=new r.ObjectStack((function(){return{origin:null,vector:null}}))}).apply(null,r))||(e.exports=i)},N78w:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("Gtr7"),n("BcWh"),n("qsST"),n("LxLY"),n("jBNx"),n("Vx27"),n("W9tT"),n("0LE5"),n("Rdxj"),n("vtMp"),n("DtIM"),n("dXKx"),n("5ldw"),n("NbdF")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m){Object.defineProperty(t,"__esModule",{value:!0});var g=a.getLogger("esri.views.interactive.GraphicManipulator"),y=function(e){function t(t){var n=e.call(this,t)||this;return n.layer=null,n.interactive=!0,n.selectable=!1,n.grabbable=!0,n.dragging=!1,n.cursor=null,n.events=new i.EventEmitter,n._circleCollisionCache=null,n._graphicSymbolChangedHandle=null,n._originalSymbol=null,n}return n.__extends(t,e),Object.defineProperty(t.prototype,"graphic",{set:function(e){"mesh"!==o.get(e.geometry,"type")?(this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()):g.error("Mesh geometries are not supported")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elevationInfo",{get:function(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=f.getGraphicEffectiveElevationMode(this.graphic);return new v({mode:t,offset:e?e.offset:0})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focusedSymbol",{set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grabbing",{set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hovering",{set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)},t.prototype.intersectionDistance=function(e){var t=this._get("graphic");if(!1===t.visible)return null;var n=this._get("focusedSymbol"),r=o.isSome(n)?n:t.symbol,i=t.geometry;if(o.isNone(i))return null;var a=this._get("view");return"2d"===a.type?this._intersectDistance2D(e,a,i,r):this._intersectDistance3D(e,a,t)},t.prototype.attach=function(){this.attachSymbolChanged(),o.isSome(this.layer)&&this.layer.add(this.graphic)},t.prototype.detach=function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),o.isSome(this.layer)&&this.layer.remove(this.graphic)},t.prototype.attachSymbolChanged=function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(function(t){o.isSome(t)&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&o.isSome(e.focusedSymbol)&&(e.graphic.symbol=e.focusedSymbol))}),!0)},t.prototype.detachSymbolChanged=function(){o.isSome(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)},t.prototype._updateGraphicSymbol=function(){this.graphic.symbol=this._focused&&o.isSome(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol},t.prototype._resetGraphicSymbol=function(){this.graphic.symbol=this._originalSymbol},t.prototype._intersectDistance2D=function(e,t,n,r){if(r=r||h.getDefaultSymbol2D(n),o.isNone(r))return null;var i=this._circleCollisionCache;if("point"!==n.type||"simple-marker"!==r.type){var a=m.intersectsDrapedGeometry(e,n,t);return o.isSome(a)?1:null}if(o.isNone(i)||!i.originalPoint.equals(n)){var l=n,u=t.spatialReference;d.canProject(l,u)&&(a=d.project(l,u),i={originalPoint:l.clone(),mapPoint:a,radiusPx:s.pt2px(r.size)},this._circleCollisionCache=i)}if(o.isSome(i)){var p=s.screenPointObjectToArray(e,b),f=t.state.toScreen(x,i.mapPoint.x,i.mapPoint.y),v=i.radiusPx;return c.vec2.squaredDistance(p,f)<v*v?1:null}return null},t.prototype._intersectDistance3D=function(e,t,n){var r=t.toMap(e,{include:[n]});if(!r)return null;var i=_;return t.renderCoordsHelper.toRenderCoords(r,i)?u.vec3.distance(i,t.state.camera.eye):null},n.__decorate([l.property({constructOnly:!0,nonNullable:!0})],t.prototype,"graphic",null),n.__decorate([l.property({readOnly:!0,dependsOn:["graphic"]})],t.prototype,"elevationInfo",null),n.__decorate([l.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n.__decorate([l.property({value:null})],t.prototype,"focusedSymbol",null),n.__decorate([l.property({constructOnly:!0})],t.prototype,"layer",void 0),n.__decorate([l.property()],t.prototype,"interactive",void 0),n.__decorate([l.property()],t.prototype,"selectable",void 0),n.__decorate([l.property()],t.prototype,"grabbable",void 0),n.__decorate([l.property({value:!1})],t.prototype,"grabbing",null),n.__decorate([l.property()],t.prototype,"dragging",void 0),n.__decorate([l.property()],t.prototype,"hovering",null),n.__decorate([l.property({value:!1})],t.prototype,"selected",null),n.__decorate([l.property()],t.prototype,"cursor",void 0),n.__decorate([l.subclass("esri.views.interactive.GraphicManipulator")],t)}(r);t.GraphicManipulator=y;var _=p.vec3f64.create(),b=s.createScreenPointArray(),x=s.createScreenPointArray()}).apply(null,r))||(e.exports=i)},NbdF:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("TMur"),n("LxLY"),n("8uEs"),n("/E+R")],void 0===(i=(function(e,t,n,r,i,a){function o(e,t,r,a){var o;if(void 0===a&&(a=new n.Extent),"2d"===r.type)o=t*r.resolution;else if("3d"===r.type){var s=r.basemapTerrain,l=s.overlayManager,c=l?l.overlayPixelSizeInMapUnits(e):1;o=s&&!s.spatialReference.equals(r.spatialReference)?i.getMetersPerUnitForSR(s.spatialReference)/i.getMetersPerUnitForSR(r.spatialReference):t*c}var u=e.x-o,p=e.y-o,d=e.x+o,f=e.y+o,h=r.spatialReference;return a.xmin=Math.min(u,d),a.ymin=Math.min(p,f),a.xmax=Math.max(u,d),a.ymax=Math.max(p,f),a.spatialReference=h,a}Object.defineProperty(t,"__esModule",{value:!0}),t.createQueryGeometry=o,t.intersectsDrapedGeometry=function(e,t,n){var i=n.toMap(e);return r.isNone(i)?null:o(i,a.calculateTolerance(),n,s).intersects(t)?i:null};var s=new n.Extent}).apply(null,r))||(e.exports=i)},NiJV:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("3kdR"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o){var s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new o.ShaderBuilder;return t.include(i.Transform,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("viewNormal","mat4"),t.fragment.uniforms.add("color","vec4").add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("position","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewNormal","vec3"),t.varyings.add("vViewDirection","vec3"),t.vertex.code.add(a.glsl(s||(s=n.__makeTemplateObject(["\n    void main(void) {\n      vWorldPosition = position;\n\n      vec3 worldNormal = normal;\n      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;\n\n      gl_Position = transformPosition(proj, view, vWorldPosition);\n    }\n  "],["\n    void main(void) {\n      vWorldPosition = position;\n\n      vec3 worldNormal = normal;\n      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;\n\n      gl_Position = transformPosition(proj, view, vWorldPosition);\n    }\n  "])))),t.include(r.Slice,e),t.fragment.code.add(a.glsl(l||(l=n.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vWorldPosition);\n\n      vec3 viewNormalNorm = normalize(vViewNormal);\n\n      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\n      vec4 colorWithShading = mix(color, shadedColor, shadingFactor);\n\n      gl_FragColor = highlightSlice(colorWithShading, vWorldPosition);\n    }\n    "],["\n    void main() {\n      discardBySlice(vWorldPosition);\n\n      vec3 viewNormalNorm = normalize(vViewNormal);\n\n      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\n      vec4 colorWithShading = mix(color, shadedColor, shadingFactor);\n\n      gl_FragColor = highlightSlice(colorWithShading, vWorldPosition);\n    }\n    "])))),t}}).apply(null,r))||(e.exports=i)},PHan:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("6DRN")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.allocator=e,this.items=[],this.itemsPtr=0,this.tickHandle=n.before((function(){return t.reset()})),this.grow()}return e.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null),this.items=null},e.prototype.get=function(){return 0===this.itemsPtr&&n((function(){})),this.itemsPtr===this.items.length&&this.grow(),this.items[this.itemsPtr++]},e.prototype.reset=function(){var e=Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*i);this.items.length=Math.min(e,this.items.length),this.itemsPtr=0},e.prototype.grow=function(){for(var e=0;e<Math.max(8,Math.min(this.items.length,i));e++)this.items.push(this.allocator())},e}();t.ObjectStack=r;var i=1024;t.default=r}).apply(null,r))||(e.exports=i)},PLh7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XwIv"),n("xoE+"),n("LxLY"),n("0LE5"),n("Rdxj"),n("DtIM"),n("woUR"),n("Kvb2"),n("X5J5"),n("MCHn"),n("PXiz"),n("R4nD"),n("/NuL")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h){function v(e){return i.isSome(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=function(e){var t=e.view,o=e.graphic,g=new h.GraphicState({graphic:o}),y=[],_=function(e,t,r){var i=e.graphic,a=new f.OutlineVisualElement({view:e.view,geometry:v(i)?i.geometry:null,elevationInfo:s.getGraphicEffectiveElevationInfo(i),attached:!1});u.settings.visualElements.lineGraphics.shadowStyle.apply(a);var o=function(){a.attached=t.displaying};return u.settings.visualElements.lineGraphics.outline.apply(a),r.push(t.watch("displaying",o),t.watch("isDraped",(function(e){return a.isDraped=e})),t.on("changed",(function(){return a.geometry=v(i)?i.geometry:null})),n.destroyHandle(a)),o(),a}(e,g,y);return function(e,t,o,f){var h=e.graphic,g=e.view,y=s.getGraphicEffectiveElevationInfo(h),_="on-the-ground"===y.mode||!y.offset&&"absolute-height"!==y.mode,b=new c.ManipulatorState,x=new d.LineVisualElement({view:g,infinite:u.settings.visualElements.zVerticalLine.infiniteType,attached:!1});u.settings.visualElements.pointGraphics.shadowStyle.apply(x);var w=r.deg2rad(u.settings.visualElements.heightPlaneAngleCutoff),S=new p.LaserlineVisualElement({view:g,attached:!1,angleCutoff:w});u.settings.visualElements.heightPlane.apply(S);var O=1,P=1,M=function(){if(b.update(e),!o.displaying||_&&(o.isDraped||!v(h)||!h.geometry.hasZ))return t.laserlineEnabled=!1,x.attached=!1,void(S.attached=!1);t.laserlineEnabled=!0;var n=4&b.grabbingState?u.settings.visualElements.laserlineAlphaMultiplier:1;n!==O&&(O=n,u.settings.visualElements.lineGraphics.shadowStyle.apply(t,n),u.settings.visualElements.pointGraphics.shadowStyle.apply(x,n));var r=2&b.grabbingState?u.settings.visualElements.laserlineAlphaMultiplier:1;r!==P&&(P=r,u.settings.visualElements.heightPlane.apply(S,r)),function(e,t){var n=1===t.numSelected?t.firstSelected:t.numSelected>1&&i.isSome(t.firstGrabbedXY)?t.firstGrabbedXY:null;i.isSome(n)?(u.settings.visualElements.zVerticalLine.infinite&&(e.worldDownAtLocation=n.renderLocation),e.attached=!0):e.attached=!1}(x,b),function(e,t,n,r){if(r.numSelected>0){a.vec3.set(m,0,0,0);var o=0;e.forEachManipulator((function(e,t){1===t&&e.selected&&e instanceof l.Manipulator3D&&(a.vec3.add(m,m,e.renderLocation),o++)})),o>0?(n.heightManifoldTarget=a.vec3.scale(m,m,1/o),n.attached=!0):n.attached=!1}else{var s=t.attachmentOrigin;i.isSome(s)&&e.view.renderCoordsHelper.toRenderCoords(s,m)?(n.heightManifoldTarget=m,n.attached=!0):n.attached=!1}}(e,t,S,b)};u.settings.visualElements.zVerticalLine.apply(x),f.push(o.on("changed",M),o.watch("displaying",M),t.events.on("attachment-origin-changed",M),n.destroyHandle(x),n.destroyHandle(S));var C=[],A=function(){n.handlesGroup(C).remove(),C.length=0,e.forEachManipulator((function(e){return C.push(e.events.on("grab-changed",M))})),e.forEachManipulator((function(e){return C.push(e.events.on("select-changed",M))})),M()};A(),f.push(e.onManipulatorsChanged(A),n.refHandle((function(){return n.handlesGroup(C)})))}(e,_,g,y),y.push(t.maskOccludee(o)),y.push(t.trackGraphicState(g)),{visualElement:_,remove:function(){n.handlesGroup(y).remove()}}};var m=o.vec3f64.create()}).apply(null,r))||(e.exports=i)},PXiz:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("j2SP"),n("MCHn"),n("2W+Z"),n("aWgr"),n("fXZm"),n("ys4y"),n("4ziW"),n("RC9r"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v){Object.defineProperty(t,"__esModule",{value:!0});var m=function(){function e(e){var t=this;this.view=null,this._ray=u.ray.create(),this._isWorldDown=!1,this._start=a.vec3f64.create(),this._end=a.vec3f64.fromValues(1,0,0),this._width=1,this._color=s.vec4f32.fromValues(1,0,1,1),this._innerWidth=1,this._innerColor=s.vec4f32.fromValues(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._infinite=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._occludedMode=4,this.resources=new c.VisualElementResources({view:e.view,cameraChanged:function(){return t.updateGeometry()},createResources:function(e){return t.createResources(e)}}),this._laserline=new l.LaserlineVisualElement({view:e.view});var n=!0;for(var r in e)r in this?"attached"===r?n=e[r]:this[r]=e[r]:console.error("Cannot set unknown property",r);this.attached=n}return e.prototype.destroy=function(){this.resources.destroy(),this._laserline.destroy()},Object.defineProperty(e.prototype,"laserlineAttached",{get:function(){return this.attached&&!this.hidden&&this._laserlineEnabled&&n.isSome(this._laserlineStyle)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e,this._laserline.attached=this.laserlineAttached},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached},set:function(e){this.resources.attached=e,this._laserline.attached=this.laserlineAttached},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldDownAtLocation",{set:function(e){this._isWorldDown=!0,i.vec3.copy(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),i.vec3.subtract(this._end,e,this._end),u.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"start",{get:function(){return this._start},set:function(e){this._isWorldDown=!1,i.vec3.exactEquals(this._start,e)||(i.vec3.copy(this._start,e),u.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},set:function(e){this._isWorldDown=!1,i.vec3.exactEquals(this._end,e)||(i.vec3.copy(this._end,e),u.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){o.vec4.exactEquals(e,this._color)||(o.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerWidth",{get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerColor",{get:function(){return this._innerColor},set:function(e){o.vec4.exactEquals(e,this._innerColor)||(o.vec4.copy(this._innerColor,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stipplePattern",{get:function(){return this._stipplePattern},set:function(e){var t=n.isSome(e)!==n.isSome(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stippleOffColor",{get:function(){return this._stippleOffColor},set:function(e){(n.isNone(e)||n.isNone(this._stippleOffColor)||!o.vec4.exactEquals(e,this._stippleOffColor))&&(this._stippleOffColor=n.isSome(e)?s.vec4f32.clone(e):null,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"falloff",{get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"infinite",{get:function(){return this._infinite},set:function(e){e!==this._infinite&&(this._infinite=e,this.updateGeometry())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"laserlineStyle",{get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,n.isSome(e)&&(this._laserline.style=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"laserlineEnabled",{get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(e){e!==this._occludedMode&&(this._occludedMode=e,n.isSome(this.resources.resources)&&(this.resources.resources.material.renderOccluded=e))},enumerable:!0,configurable:!0}),e.prototype.updateMaterial=function(){var e=this.resources.resources;n.isNone(e)||e.material.setParameterValues(this.materialParameters)},Object.defineProperty(e.prototype,"materialParameters",{get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff}},enumerable:!0,configurable:!0}),e.prototype.updateGeometry=function(){var e=this.resources.object;n.isNone(e)||this.updateVertices(e)},e.prototype.updateVertices=function(e){if(this._infinite){var t=this.view.state.camera;switch(p.fromRay(this._ray,g),this._infinite){case 2:g.c0=-Number.MAX_VALUE;break;case 1:case 3:var n=this._ray.origin,r=this.view.elevationProvider.getElevation(n[0],n[1],n[2],this.view.renderCoordsHelper.spatialReference,"ground"),a=this.view.renderCoordsHelper.getAltitude(n);this._isWorldDown&&a<r&&i.vec3.negate(g.ray.direction,g.ray.direction),3===this._infinite&&null!=r&&(g.c1=Math.abs(a-r))}if(!u.frustum.intersectClipRay(t.frustum.planes,g))return void this.updateVertexAttributes(e,this._start,this._end);var o=p.getStart(g,y),s=p.getEnd(g,_);this.updateVertexAttributes(e,o,s),this._laserline.intersectsLine=u.lineSegment.fromPoints(o,s,b)}else this.updateVertexAttributes(e,this._start,this._end),this._laserline.intersectsLine=u.lineSegment.fromPoints(this._start,this._end,b)},e.prototype.updateVertexAttributes=function(e,t,n){var r=e.geometryRecords[0].geometry.data.getVertexAttr()[v.RibbonVertexAttributeConstants.POSITION].data;r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=n[0],r[4]=n[1],r[5]=n[2],e.geometryVertexAttrsUpdated(0)},e.prototype.createResources=function(e){var t=[a.vec3f64.create(),a.vec3f64.create()],n=new d(f.createPolylineGeometry(t),"lineVisualElement"),i=new h(this.materialParameters,"lineVisualElement");return i.renderOccluded=this._occludedMode,e.addGeometry(n,i,r.mat4f64.IDENTITY),this.updateVertices(e),{material:i,geometry:n,forEach:function(e){return e(i),e(n)}}},e}();t.LineVisualElement=m;var g=p.create(),y=a.vec3f64.create(),_=a.vec3f64.create(),b=u.lineSegment.create()}).apply(null,r))||(e.exports=i)},PaEL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){function i(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n    void outputHighlight() {\n      vec4 fragCoord = gl_FragCoord;\n\n      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z > sceneDepth + 5e-7) {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "],["\n    void outputHighlight() {\n      vec4 fragCoord = gl_FragCoord;\n\n      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z > sceneDepth + 5e-7) {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "]))))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.OutputHighlight=i,function(e){e.bindOutputHighlight=function(e,t,n){e.bindTexture(n.highlightDepthTexture,5),t.setUniform1i("depthTex",5),t.setUniform4f("highlightViewportPixelSz",0,0,1/n.viewport[2],1/n.viewport[3])}}(i=t.OutputHighlight||(t.OutputHighlight={}))}).apply(null,r))||(e.exports=i)},"PwS/":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("LxLY"),n("FXVB"),n("1m5D"),n("1f+t"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,a,o,s){Object.defineProperty(t,"__esModule",{value:!0}),t.addObject3DStateID=function(e,t){return n.isNone(e)&&(e=[]),e.push(t),e},t.removeObject3DStateID=function(e,t){if(n.isNone(e))return e;var r=e.filter((function(e){return e!==t}));return 0===r.length?null:r},t.isInstanceHidden=function(e){return!!r.isSome(e)&&!e.visible},t.acquireMaterials=function(e,t){var n=new Map;return n.set(0,t.acquire(e,0)),n.set(3,t.acquire(e,3)),n.set(2,t.acquire(e,2)),n.set(1,t.acquire(e,1)),n.set(4,t.acquire(e,4)),n},t.releaseMaterials=function(e,t){t.release(e,0),t.release(e,3),t.release(e,2),t.release(e,1),t.release(e,4)},t.calculateTransformRelToOrigin=function(e,t,n){var a=e.origin.vec3;s.setMatrixTranslation3(u,-a[0],-a[1],-a[2]),r.isSome(e.transformation)?i.mat4.multiply(t,u,e.transformation):i.mat4.copy(t,u),n&&(i.mat4.invert(n,t),i.mat4.transpose(n,n))},t.encodeDoubleVec3=function(e,t,n,r,i){l[0]=e.get(t,0),l[1]=e.get(t,1),l[2]=e.get(t,2),o.encodeDoubleArray(l,c,3),n.set(i,0,c[0]),r.set(i,0,c[1]),n.set(i,1,c[2]),r.set(i,1,c[3]),n.set(i,2,c[4]),r.set(i,2,c[5])};var l=new Float64Array(3),c=new Float32Array(6),u=a.mat4f64.create()}).apply(null,r))||(e.exports=i)},Px2u:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("Gtr7"),n("R2Zq"),n("LxLY"),n("KBgh"),n("Vx27"),n("FNtW"),n("znI2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._pendingAddsRemoves=new Map,t._adds=new o,t._removes=new o,t._updates=new o({allocator:function(e){return e||new u},deallocator:function(e){return e.renderGeometry=null,e}}),t._materialRenderers=new Map,t._sortedMaterialRenderers=new o,t._hasHighlights=!1,t._hasWater=!1,t}return n.__extends(t,e),t.prototype.dispose=function(){this._adds.prune(),this._removes.prune(),this._updates.prune(),this._materialRenderers&&(this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear())},Object.defineProperty(t.prototype,"updating",{get:function(){return this._pendingAddsRemoves.size>0||this._updates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rendersOccluded",{get:function(){return i.someMap(this._materialRenderers,(function(e){return e.rendersOccluded}))},enumerable:!0,configurable:!0}),t.prototype.stopAnimationsAtTime=function(e){this._sortedMaterialRenderers.forEach((function(t){return a.applySome(t.material.animation,(function(t){return t.stopAtTime(e)}))}))},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!this.updating&&0===this._materialRenderers.size},enumerable:!0,configurable:!0}),t.prototype.commitChanges=function(){var e=this,t=!1;if(!this.updating)return!1;this.updateAddsRemoves();var n=c.splitRenderGeometryChangeSetByMaterial({numToAdd:this._adds.length,toAdd:this._adds.data,numToRemove:this._removes.length,toRemove:this._removes.data,numToUpdate:this._updates.length,toUpdate:this._updates.data}),r=!1,a=!1;return n.forEach((function(n,i){var o=e._materialRenderers.get(i);if(!o&&n.toAdd.length>0&&(o=i.createRenderer(e.rctx,e.materialRepository),e._materialRenderers.set(i,o),t=!0,r=!0,a=!0),o){var s=r||o.hasHighlights,l=a||o.hasWater;o.modify(n),r=r||s!==o.hasHighlights,a=a||l!==o.hasWater,o.isEmpty&&(e._materialRenderers.delete(i),o.dispose(),t=!0)}})),this._adds.clear(),this._removes.clear(),this._updates.clear(),this._pendingAddsRemoves.clear(),t&&this.updateSortedMaterialRenderers(),r&&(this._hasHighlights=i.someMap(this._materialRenderers,(function(e){return e.hasHighlights}))),a&&(this._hasWater=i.someMap(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0},t.prototype.add=function(e){for(var t=0===this._pendingAddsRemoves.size,n=0,r=e;n<r.length;n++)this._pendingAddsRemoves.set(r[n],0);t&&this._pendingAddsRemoves.size>0&&this.notifyChange("updating")},t.prototype.remove=function(e){for(var t=0===this._pendingAddsRemoves.size,n=0,r=e;n<r.length;n++){var i=r[n],a=this._pendingAddsRemoves.get(i);0===a?this._pendingAddsRemoves.set(i,2):2!==a&&this._pendingAddsRemoves.set(i,1)}t&&this._pendingAddsRemoves.size>0&&this.notifyChange("updating")},t.prototype.modify=function(e,t){for(var n=0===this._updates.length,r=0,i=e;r<i.length;r++){var a=i[r],o=this._updates.pushNew();o.renderGeometry=a,o.updateType=t}n&&this._updates.length>0&&this.notifyChange("updating")},t.prototype.updateLogic=function(e){for(var t=!1,n=0;n<this._sortedMaterialRenderers.length;n++){var r=this._sortedMaterialRenderers.data[n].materialRenderer;r.updateLogic&&r.updateLogic(e)&&(t=!0)}return t},t.prototype.draw=function(e,t,n){for(var r=0;r<this._sortedMaterialRenderers.length;r++){var i=this._sortedMaterialRenderers.data[r];if(l.materialPredicate(i.material,e)){var a=n.getMaterialRenderStatsObject(i.materialRenderer.type);i.materialRenderer.render(null,e,t,a)}}},t.prototype.updateSortedMaterialRenderers=function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(n,r){r.insertOrder=t++,e._sortedMaterialRenderers.push({material:r,materialRenderer:n})})),this._sortedMaterialRenderers.sort((function(e,t){var n=t.material.renderPriority-e.material.renderPriority;return 0!==n?n:e.material.insertOrder-t.material.insertOrder}))},t.prototype.updateAddsRemoves=function(){var e=this;this._adds.clear(),this._removes.clear(),this._pendingAddsRemoves.forEach((function(t,n){switch(t){case 0:e._adds.push(n);break;case 1:e._removes.push(n)}}));for(var t=0;t<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[t].renderGeometry)?this._updates.removeUnorderedIndex(t):t++},Object.defineProperty(t.prototype,"test",{get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}},enumerable:!0,configurable:!0}),n.__decorate([s.property()],t.prototype,"rctx",void 0),n.__decorate([s.property()],t.prototype,"materialRepository",void 0),n.__decorate([s.property()],t.prototype,"updating",null),n.__decorate([s.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],t)}(r);t.SortedRenderGeometryRenderer=p}).apply(null,r))||(e.exports=i)},QDiq:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("0LE5"),n("Rdxj"),n("2Mej")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=r.vec3f64.create(),o=function(){function e(){this._renderLighting={main:{intensity:r.vec3f64.create(),direction:r.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldSunlight={direction:r.vec3f64.create(),ambient:{color:r.vec3f64.create(),intensity:0},diffuse:{color:r.vec3f64.create(),intensity:0}}}return e.prototype.setLightDirectionUniform=function(e){e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)},e.prototype.setUniforms=function(e,t){void 0===t&&(t=!1),e.setUniform1f("lightingFixedFactor",t?(1-this._info.groundLightingFactor)*(1-this._info.globalFactor):0),e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var n=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),e.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),e.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]),e.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),e.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),e.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),e.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),e.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),e.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8]))},e.prototype.set=function(e){this._info=e,i.combineLights(e.lights,this._shOrder,this._renderLighting),n.vec3.negate(this._oldSunlight.direction,this._renderLighting.main.direction);var t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldSunlight.ambient.intensity=1,this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*t,this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*t,this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*t,this._oldSunlight.diffuse.intensity=1;var r=n.vec3.copy(a,this._oldSunlight.diffuse.color);n.vec3.scale(r,r,.4*this._info.globalFactor),n.vec3.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,r)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"old",{get:function(){return this._oldSunlight},enumerable:!0,configurable:!0}),e}();t.SceneLighting=o}).apply(null,r))||(e.exports=i)},R4nD:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("BcWh"),n("LxLY"),n("0LE5"),n("Rdxj"),n("2fXB"),n("j2SP"),n("WRgd"),n("ZcgO"),n("as1Q"),n("MCHn"),n("2W+Z"),n("fOZq"),n("hADE"),n("mmEe"),n("ys4y"),n("+nCE"),n("cjy9"),n("RC9r"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b){Object.defineProperty(t,"__esModule",{value:!0});var x=function(){function e(e){var t=this;this.view=null,this._attachmentOrigin=c.makeDehydratedPoint(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new n,this._isDraped=!1,this._geometry=null,this._width=1,this._color=s.vec4f32.fromValues(1,0,1,1),this._innerWidth=1,this._innerColor=s.vec4f32.fromValues(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._occludedMode=8,this.resources=new d.VisualElementResources({view:e.view,createResources:function(e){return t.createResources(e)},recreateGeometry:function(e,n){return e.geometries.length=0,t.recreateGeometry(n,e.material,e.geometries),e.geometries}}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new u.DrapedVisualElementResources({view:e.view,createResources:function(){return t.createDrapedResources()},recreateGeometry:function(e){e.geometries=t.createRenderGeometriesDraped(e.material),t.attachmentOriginChanged()}});var r=!0;for(var i in this._laserline=new p.LaserlineVisualElement({view:e.view}),e)i in this?"attached"===i?r=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=r}return e.prototype.destroy=function(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()},Object.defineProperty(e.prototype,"isDraped",{get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"laserlineAttached",{get:function(){return this.attached&&!this.hidden&&r.isSome(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e,this.drapedResources.hidden=e,this._laserline.attached=this.laserlineAttached},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this.updateAttached(e)},enumerable:!0,configurable:!0}),e.prototype.updateAttached=function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()},Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){o.vec4.exactEquals(e,this._color)||(o.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerWidth",{get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerColor",{get:function(){return this._innerColor},set:function(e){o.vec4.exactEquals(e,this._innerColor)||(o.vec4.copy(this._innerColor,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stipplePattern",{get:function(){return this._stipplePattern},set:function(e){var t=r.isSome(e)!==r.isSome(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stippleOffColor",{get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&o.vec4.exactEquals(e,this._stippleOffColor)||(this._stippleOffColor=e?s.vec4f32.clone(e):null,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"falloff",{get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"laserlineStyle",{get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,r.isSome(e)&&(this._laserline.style=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"laserlineEnabled",{get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(e){e!==this._occludedMode&&(this._occludedMode=e,r.isSome(this.resources.resources)&&(this.resources.resources.material.renderOccluded=e),r.isSome(this.drapedResources.resources)&&(this.drapedResources.resources.material.renderOccluded=e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attachmentOrigin",{get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=r.isSome(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;i.vec3.set(O,0,0,0);for(var t=b.RibbonVertexAttributeConstants.POSITION,n=0,a=r.unwrap(this.resources.resources).material.getParameters().isClosed,o=0,s=e;o<s.length;o++){var l=s[o];g.computeAttachmentOriginLines(l.getAttribute(t),l.getIndices(t),a,S)&&(i.vec3.add(O,O,S),n++)}return 0===n?null:(i.vec3.scale(O,O,1/n),this.view.renderCoordsHelper.fromRenderCoords(O,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)},enumerable:!0,configurable:!0}),e.prototype.updateMaterial=function(){r.isSome(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),r.isSome(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)},Object.defineProperty(e.prototype,"isClosed",{get:function(){return r.isSome(this.geometry)&&"polygon"===this.geometry.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"materialParameters",{get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0}},enumerable:!0,configurable:!0}),e.prototype.recreateGeometry=function(e,t,n){for(var r=0,i=this.createRenderGeometries();r<i.length;r++){var a=i[r];e.addGeometry(a,t),n.push(a)}this.attachmentOriginChanged()},e.prototype.attachmentOriginChanged=function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")},e.prototype.createResources=function(e){var t=new _(this.materialParameters,"lineVisualElement");t.renderOccluded=8;var n=[];return this.recreateGeometry(e,t,n),{material:t,geometries:n,forEach:function(e){e(t),n.forEach(e)}}},e.prototype.createDrapedResources=function(){var e=new _(this.materialParameters,"lineVisualElement");return e.renderOccluded=4,{material:e,geometries:this.createRenderGeometriesDraped(e)}},e.prototype.createRenderGeometriesDraped=function(e){var t=this.geometry;if(r.isNone(t))return[];for(var n=[],a=0,o=h.geometryToRenderInfoDraped(t,this.view.basemapTerrain.spatialReference).lines;a<o.length;a++){var s=o[a].position,c=new y(h.createGeometryData({attributeData:{position:s},removeDuplicateStartEnd:this.isClosed?1:0}));c.material=e;var u=l.empty(w);l.expandWithBuffer(u,s),i.vec3.set(c.center,.5*(u[0]+u[3]),.5*(u[1]+u[4]),0),c.bsRadius=.5*Math.sqrt((u[3]-u[0])*(u[3]-u[0])+(u[4]-u[1])*(u[4]-u[1])),n.push(c)}return n},e.prototype.calculateMapBounds=function(e){if(r.isNone(this.resources.resources))return!1;for(var t=this.view.renderCoordsHelper,n=0,i=this.resources.resources.geometries;n<i.length;n++){var a=i[n].data.getAttribute("position"),o=a.data,s=new Float64Array(o.length);v.bufferToBuffer(a.data,t.spatialReference,0,s,this.view.spatialReference,0,o.length/3),l.expandWithBuffer(e,s)}return!0},e.prototype.createRenderGeometries=function(){var e=this.geometry;if(r.isNone(e))return[];for(var t=[],n=[],i=0,a=h.geometryToRenderInfo(e,this.view.elevationProvider,this.view.renderCoordsHelper,f.ElevationContext.fromElevationInfo(this.elevationInfo)).lines;i<a.length;i++){var o=a[i],s=o.position,l=h.createGeometryData({attributeData:{position:s,mapPosition:o.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0});t.push(new m(l,"geometryOutlineVisualElement")),n.push(s)}return this._laserline.pathVerticalPlane=n,t},e}();t.OutlineVisualElement=x;var w=l.create(),S=a.vec3f64.create(),O=a.vec3f64.create()}).apply(null,r))||(e.exports=i)},RC9r:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("qsST"),n("xoE+"),n("LxLY"),n("jBNx"),n("W9tT"),n("0LE5"),n("Rdxj"),n("aWgr"),n("2B1V"),n("+nCE"),n("tUyH"),n("FNtW"),n("CIy2"),n("ama6"),n("s6rJ"),n("ZeO9"),n("PwS/"),n("SNs2"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x){var w=r.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),S=function(e){function t(t,n){var r=e.call(this,n)||this;return r.techniqueConfig=new x.RibbonLineTechniqueConfiguration,r.params=g.copyParameters(t,P),r.validateParams(),r.params.transparent=r.params.color[3]<1||r.params.transparent,r.layout=r.createLayout(),r}return n.__extends(t,e),t.prototype.dispose=function(){},t.prototype.setParameterValues=function(e){for(var t in e)if("cap"!==t){if("join"===t&&"round"===this.params[t]!=("round"===e[t])){w.error("join cannot be changed after creation");continue}if("stipplePattern"===t&&!!this.params[t]!=!!e[t]){w.error("stippledness cannot be changed after creation");continue}this.params[t]=e[t]}else w.error("cap cannot be changed after creation");this.validateParams(),this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getPassParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){this.techniqueConfig.output=e;var t=a.isSome(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.stippleOffColorEnabled=t&&a.isSome(this.params.stippleOffColor),this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.params.join,this.techniqueConfig.roundCaps="round"===this.params.cap,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.params.innerWidth>0&&a.isSome(this.params.innerColor),this.techniqueConfig.falloffEnabled=this.params.falloff>0,this.techniqueConfig.occluder=8===this.renderOccluded,this.techniqueConfig},t.prototype.intersect=function(e,t,n,r,i,a,o,s,l){l?this.intersectDrapedLineGeometry(e,r,a,o):this.intersectLineGeometry(e,t,n,r,this.params.width,o)},t.prototype.intersectDrapedLineGeometry=function(e,t,n,r){if(t.options.selectionMode){var a=e.getAttribute(x.RibbonVertexAttributeConstants.POSITION).data,o=e.getAttribute(x.RibbonVertexAttributeConstants.SIZE),s=this.params.width;if(this.params.vvSizeEnabled){var l=e.getAttribute(x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE).data[0];s*=i.clamp(this.params.vvSizeOffset[0]+l*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else o&&(s*=o.data[0]);for(var c=n[0],u=n[1],p=(s/2+4)*e.pixelRatio,d=Number.MAX_VALUE,f=0;f<a.length-5;f+=3){var h=a[f],v=a[f+1],m=c-h,g=u-v,y=a[f+3]-h,_=a[f+4]-v,b=i.clamp((y*m+_*g)/(y*y+_*_),0,1),w=y*b-m,S=_*b-g,O=w*w+S*S;O<d&&(d=O)}d<p*p&&r()}},t.prototype.intersectLineGeometry=function(e,t,n,r,a,o){if(r.options.selectionMode&&!_.isInstanceHidden(t))if(v.isTranslationMatrix(n)){var c=e.data.getVertexAttr(),p=c[x.RibbonVertexAttributeConstants.POSITION].data,d=a;this.params.vvSizeEnabled?d*=i.clamp(this.params.vvSizeOffset[0]+c[x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0]):c[x.RibbonVertexAttributeConstants.SIZE]&&(d*=c[x.RibbonVertexAttributeConstants.SIZE].data[0]);var f=r.camera,h=I;s.vec2.copy(h,r.point);var m=d*f.pixelRatio/2+4*f.pixelRatio;l.vec3.set(B[0],h[0]-m,h[1]+m,0),l.vec3.set(B[1],h[0]+m,h[1]+m,0),l.vec3.set(B[2],h[0]+m,h[1]-m,0),l.vec3.set(B[3],h[0]-m,h[1]-m,0);for(var g=0;g<4;g++)f.unprojectPoint(B[g],q[g]);u.plane.fromPoints(f.eye,q[0],q[1],W),u.plane.fromPoints(f.eye,q[1],q[2],Z),u.plane.fromPoints(f.eye,q[2],q[3],X),u.plane.fromPoints(f.eye,q[3],q[0],Y);var y=Number.MAX_VALUE,b=this.params.isClosed?p.length-2:p.length-5;for(g=0;g<b;g+=3){T[0]=p[g]+n[12],T[1]=p[g+1]+n[13],T[2]=p[g+2]+n[14];var S=(g+3)%p.length;if(R[0]=p[S]+n[12],R[1]=p[S+1]+n[13],R[2]=p[S+2]+n[14],!(u.plane.signedDistance(W,T)<0&&u.plane.signedDistance(W,R)<0||u.plane.signedDistance(Z,T)<0&&u.plane.signedDistance(Z,R)<0||u.plane.signedDistance(X,T)<0&&u.plane.signedDistance(X,R)<0||u.plane.signedDistance(Y,T)<0&&u.plane.signedDistance(Y,R)<0)){if(f.projectPoint(T,V),f.projectPoint(R,z),V[2]<0&&z[2]>0){l.vec3.subtract(j,T,R);var O=f.frustum,P=-u.plane.signedDistance(O.planes[4],T)/l.vec3.dot(j,u.plane.normal(O.planes[4]));l.vec3.scale(j,j,P),l.vec3.add(T,T,j),f.projectPoint(T,V)}else if(V[2]>0&&z[2]<0)l.vec3.subtract(j,R,T),P=-u.plane.signedDistance((O=f.frustum).planes[4],R)/l.vec3.dot(j,u.plane.normal(O.planes[4])),l.vec3.scale(j,j,P),l.vec3.add(R,R,j),f.projectPoint(R,z);else if(V[2]<0&&z[2]<0)continue;V[2]=0,z[2]=0;var M=u.lineSegment.distance2(u.lineSegment.fromPoints(V,z,F),h);M<y&&(y=M,l.vec3.copy(L,T),l.vec3.copy(N,R))}}var C=r.rayBeginPoint,A=r.rayEndPoint;if(y<m*m){var D=Number.MAX_VALUE;if(u.lineSegment.closestLineSegmentPoint(u.lineSegment.fromPoints(L,N,F),u.lineSegment.fromPoints(C,A,U),E)){l.vec3.subtract(E,E,C);var G=l.vec3.length(E);l.vec3.scale(E,E,1/G),D=G/l.vec3.distance(C,A)}o(D,E)}}else w.error("intersection assumes a translation-only matrix")},t.prototype.computeAttachmentOrigin=function(e,t){var n=e.data,r="getVertexAttr"in n?n.getVertexAttr():"vertexAttr"in n?n.vertexAttr:null;if(!r)return null;var i=x.RibbonVertexAttributeConstants.POSITION,a="getVertexAttr"in n?n.getIndices(i):null;return d.computeAttachmentOriginLines(r[i],a,a&&this.params.isClosed,t)},t.prototype.createLayout=function(){var e=p.newLayout().vec3f(x.RibbonVertexAttributeConstants.POSITION).f32(x.RibbonVertexAttributeConstants.SUBDIVISIONFACTOR).vec2f(x.RibbonVertexAttributeConstants.UV0).vec3f(x.RibbonVertexAttributeConstants.AUXPOS1).vec3f(x.RibbonVertexAttributeConstants.AUXPOS2);return e.f32(this.params.vvSizeEnabled?x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE:x.RibbonVertexAttributeConstants.SIZE),this.params.vvColorEnabled?e.f32(x.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE):e.vec4f(x.RibbonVertexAttributeConstants.COLOR),this.params.vvOpacityEnabled&&e.f32(x.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE),e},t.prototype.createBufferWriter=function(){return new M(this.layout,this.params)},t.prototype.createRenderer=function(e,t){return new y(e,t,this,x.ribbonVertexAttributeLocations)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new O(e):void 0},t.prototype.validateParams=function(){"miter"!==this.params.join&&(this.params.miterLimit=0)},t}(h.Material),O=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return n.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(b.RibbonLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return this.technique.configuration.occluder?3===e||10===e||11===e:0===this.output?(this.targetSlot=this.technique.configuration.writeDepth?5:8,e===this.targetSlot):3===e},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&this._updateOccludeeState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t.prototype.getPipelineState=function(e,t){return t?this.technique.occludeePipeline:this.technique.configuration.occluder?11===e?this.technique.occluderPipelineTransparent:10===e?this.technique.occluderPipelineOpaque:this.technique.occluderPipelineMaskWrite:this.technique.pipeline},t}(f.GLMaterial),P=n.__assign({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1},m.Default),M=function(){function e(e,t){if(this.params=t,this.numCapSubdivisions=0,this.numJoinSubdivisions=0,this.vertexBufferLayout=e,!t.isClosed)switch(this.params.cap){case"butt":this.numCapSubdivisions=0;break;case"square":this.numCapSubdivisions=1;break;case"round":this.numCapSubdivisions=A}switch(this.params.join){case"miter":case"bevel":this.numJoinSubdivisions=t.stipplePattern?1:0;break;case"round":this.numJoinSubdivisions=D}}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){var t=e.indices[x.RibbonVertexAttributeConstants.POSITION].length/2+1,n=this.params.isClosed,r=n?2:2*(2*this.numCapSubdivisions+2),i=n?0:1,a=n?t:t-1;if(e.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS])for(var o=e.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS].data,s=i;s<a;++s)r+=4+2*o[s];else r+=(a-i)*(2*this.numJoinSubdivisions+4);return r+2},e.prototype.write=function(e,t,n,r){var i=this,a=G,o=H,s=k,c=t.vertexAttr[x.RibbonVertexAttributeConstants.POSITION].data,u=t.indices&&t.indices[x.RibbonVertexAttributeConstants.POSITION];u&&u.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var p=null;t.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS]&&(p=t.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS].data);var d=1,f=0;this.params.vvSizeEnabled?f=t.vertexAttr[x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]:t.vertexAttr[x.RibbonVertexAttributeConstants.SIZE]&&(d=t.vertexAttr[x.RibbonVertexAttributeConstants.SIZE].data[0]);var h=[1,1,1,1],v=0;this.params.vvColorEnabled?v=t.vertexAttr[x.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE].data[0]:t.vertexAttr[x.RibbonVertexAttributeConstants.COLOR]&&(h=t.vertexAttr[x.RibbonVertexAttributeConstants.COLOR].data);var m=0;this.params.vvOpacityEnabled&&(m=t.vertexAttr[x.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE].data[0]);var g=c.length/3,y=e.transformation,_=new Float32Array(n.buffer),b=this.vertexBufferLayout.stride/4,w=r*b,S=w,O=function(e,t,n,r,a,o){_[w++]=t[0],_[w++]=t[1],_[w++]=t[2],_[w++]=r,_[w++]=a,_[w++]=o,_[w++]=e[0],_[w++]=e[1],_[w++]=e[2],_[w++]=n[0],_[w++]=n[1],_[w++]=n[2],_[w++]=i.params.vvSizeEnabled?f:d,i.params.vvColorEnabled?_[w++]=v:(_[w++]=h[0],_[w++]=h[1],_[w++]=h[2],_[w++]=h[3]),i.params.vvOpacityEnabled&&(_[w++]=m)};w+=b,l.vec3.set(o,c[0],c[1],c[2]),y&&l.vec3.transformMat4(o,o,y);var P=this.params.isClosed;if(P){var M=c.length-3;l.vec3.set(a,c[M],c[M+1],c[M+2]),y&&l.vec3.transformMat4(a,a,y)}else{l.vec3.copy(a,o),l.vec3.set(s,c[3],c[4],c[5]),y&&l.vec3.transformMat4(s,s,y);for(var A=0;A<this.numCapSubdivisions;++A)O(a,o,s,E=1-A/this.numCapSubdivisions,1,-4),O(a,o,s,E,1,4);O(a,o,s,0,0,-4),O(a,o,s,0,0,4),l.vec3.copy(a,o),l.vec3.copy(o,s)}var D=P?g:g-1;for(A=P?0:1;A<D;A++){var T=(A+1)%g*3;l.vec3.set(s,c[T+0],c[T+1],c[T+2]),y&&l.vec3.transformMat4(s,s,y),O(a,o,s,0,1,-1),O(a,o,s,0,1,1);for(var R=p?p[A]:this.numJoinSubdivisions,j=0;j<R;++j)O(a,o,s,E=(j+1)/(R+1),1,-2),O(a,o,s,E,1,2);O(a,o,s,1,0,-2),O(a,o,s,1,0,2),l.vec3.copy(a,o),l.vec3.copy(o,s)}if(P)w=C(_,S+b,_,w,2*b);else for(O(a,o,s,0,1,-5),O(a,o,s,0,1,5),A=0;A<this.numCapSubdivisions;++A){var E;O(a,o,s,E=(A+1)/this.numCapSubdivisions,1,-5),O(a,o,s,E,1,5)}C(_,S+b,_,S,b),w=C(_,w-b,_,w,b)},e}();function C(e,t,n,r,i){for(var a=0;a<i;a++)n[r++]=e[t++];return r}var A=3,D=1,T=c.vec3f64.create(),R=c.vec3f64.create(),j=c.vec3f64.create(),E=c.vec3f64.create(),I=c.vec3f64.create(),V=o.createRenderScreenPointArray3(),z=o.createRenderScreenPointArray3(),L=c.vec3f64.create(),N=c.vec3f64.create(),F=u.lineSegment.create(),U=u.lineSegment.create(),G=c.vec3f64.create(),H=c.vec3f64.create(),k=c.vec3f64.create(),B=[o.createRenderScreenPointArray3(),o.createRenderScreenPointArray3(),o.createRenderScreenPointArray3(),o.createRenderScreenPointArray3()],q=[c.vec3f64.create(),c.vec3f64.create(),c.vec3f64.create(),c.vec3f64.create()],W=u.plane.create(),Z=u.plane.create(),X=u.plane.create(),Y=u.plane.create();return S}).apply(null,r))||(e.exports=i)},RWrl:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("BcWh"),n("eIBl"),n("xoE+"),n("LxLY"),n("afW+"),n("jBNx"),n("8MXS"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("qysZ"),n("DtIM"),n("woUR"),n("5T2R"),n("B3XD"),n("Fe95"),n("aWgr"),n("AzkI"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x,w,S,O,P,M){var C;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.Unlocked=1024,e.DelayedFocused=2048,e.TouchInput=32768}(C||(C={}));var A=function(){function e(e){var t=this;this.mode=null,this._handles=new i,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new r,this.getFocused=function(){return t.ringManipulator.focused},this.getScale=function(){return o.isSome(t._scaleRotateDragData)&&"scale"===t._scaleRotateDragData.mode?t._scaleRotateDragData.scale:1},this.tool=e.tool,this.mode=e.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}return e.prototype.destroy=function(){o.isSome(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null},e.prototype.startAnimation=function(e){var t=this;this.cancelActiveAnimation(),e.start();var r=s.addFrameTask({update:function(n){e.update(n.deltaTime)&&t.cancelActiveAnimation()}});this._activeAnimation=n.__assign(n.__assign({},e),{frameTask:r})},e.prototype.cancelActiveAnimation=function(){o.isSome(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)},e.prototype.forEachManipulator=function(e){e(this.ringManipulator,2)},e.prototype.createManipulator=function(){var e=this;this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);var t=this.tool.graphicState.graphic,n=M.createManipulatorDragEventPipeline(this.ringManipulator,(function(n,r,i){e._scaleRotateDragData=null;var s=function(e,t){var n=e.allLayerViews.find((function(e){return e.layer===t.layer}));if(o.isNone(t.symbol))return null;var r=t.symbol;return{symbolLayers:r.symbolLayers.map((function(e){var t=null;return"object"===e.type&&(t=e.heading),{heading:t,size:n.getSymbolLayerSize(r,e)}})).toArray()}}(e.tool.view,t);if(o.isNone(s))return e.updateDragState(),null;var l={mode:"none",origin:f.vec3f64.clone(n.renderLocation),angle:0,startAngle:e.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:s};e._scaleRotateDragData=l,e.updateDragState();var c=w.sv3d.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(n.renderLocation,c),r.next(y.screenToRenderPlane(e.tool.view,b.plane.fromPositionAndNormal(n.renderLocation,c))).next((function(n){var r=b.plane.normal(n.plane),i=g.calculateInputRotationTransform(n.renderStart,n.renderEnd,l.origin,r),s=x.cyclicalPI.shortestSignedDiff(l.angle,i);l.angleDir=a.clamp(l.angleDir+s,-_.ROTATE_INDICATOR_DIRECTION_BUFFER,_.ROTATE_INDICATOR_DIRECTION_BUFFER),l.angle=i;var c=function(e,t){var n=d.vec3.subtract(w.sv3d.get(),t.renderStart,e.origin),r=d.vec3.subtract(w.sv3d.get(),t.renderEnd,e.origin),i=d.vec3.length(n),a=d.vec3.length(r);return 0===i?0:a/i}(l,n);if(l.scaleDir=a.clamp(l.scaleDir+(c-l.scale),-_.SCALE_INDICATOR_DIRECTION_BUFFER,_.SCALE_INDICATOR_DIRECTION_BUFFER),l.scale=c,e.onScaleChanged(),"none"===l.mode){var u=e.mode||function(e,t,n,r){var i=e.renderStart,a=e.renderEnd,o=D(i,r,w.sv3d.get()),s=D(a,r,w.sv3d.get());if(d.vec3.squaredDistance(o,s)<_.DRAG_THRESHOLD_PX*_.DRAG_THRESHOLD_PX)return null;var l=d.vec3.subtract(w.sv3d.get(),i,n),c=d.vec3.cross(w.sv3d.get(),l,t),u=i,p=d.vec3.add(w.sv3d.get(),u,c),f=D(n,r,w.sv3d.get()),h=o,v=D(p,r,w.sv3d.get()),m=d.vec3.subtract(w.sv3d.get(),v,h),g=d.vec3.subtract(w.sv3d.get(),o,f),y=b.ray.wrap(h,m),x=b.ray.wrap(f,g);return b.ray.distance2(y,s)<b.ray.distance2(x,s)?"rotate":"scale"}(n,n.plane,l.origin,e.tool.view.state.camera);if(o.isSome(u)){switch(u){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:t,angle:l.angle});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:t,scale:l.scale})}l.mode=u}}if(e.updateDragState(),o.isSome(t.symbol)){var p=t.symbol.clone(),f=0,h=1;switch(l.mode){default:case"none":break;case"scale":h=l.scale;break;case"rotate":f=l.angle}e.applySymbolData(p,l.startSymbolData,f,h),t.symbol=p,e.updateManipulatorTransform()}switch(n.action){case"start":case"update":switch(l.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:t,angle:l.angle});break;case"scale":e.tool.emit("graphic-scale",{graphic:t,scale:l.scale})}break;case"end":switch(l.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:t,angle:l.angle});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:t,scale:l.scale});break;default:case"none":}}"end"===n.action&&(e.startAnimation(T(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState())})),i.next(M.resetSymbol(t)).next((function(){if(o.isSome(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:t,angle:e._scaleRotateDragData.startAngle});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:t,scale:1})}e.startAnimation(T(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null}}))}));this._handles.add(n),this._handles.add([this.ringManipulator.events.on("focus-changed",(function(t){var n,r,i,a,o;"focus"===t.action?e.startAnimation((n=e,r=function(){return e.updateDelayedFocusedState()},i=0,a=null,o=function(){return!1},{start:function(){a=n.getFocused,n.getFocused=o,i=0,r()},update:function(e){return i+=e,!a()||i>_.RING_INDICATOR_DELAY_MS?1:0},destroy:function(){n.getFocused=a,r()}})):e.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(function(e){e.stopPropagation()})),c.init(this.tool.graphicState,"displaying",(function(t){return e.ringManipulator.available=t})),this.tool.graphicState.on("changed",(function(){return g.placeAtGraphic(e.tool.view,e.ringManipulator,t)}))]),g.placeAtGraphic(this.tool.view,this.ringManipulator,t)},e.prototype.onScaleChanged=function(){this.events.emit("scale-changed"),this.updateManipulatorTransform()},e.prototype.updateDelayedFocusedState=function(){this.ringManipulator.updateStateEnabled(C.DelayedFocused,this.getFocused())},e.prototype.updateDragState=function(){if(this.ringManipulator.updateStateEnabled(C.Unlocked,!(o.isSome(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),o.isSome(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(C.ScaleIn|C.ScaleOut,!1),this.ringManipulator.updateStateEnabled(C.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(C.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(C.RotateLeft|C.RotateRight,!1),this.ringManipulator.updateStateEnabled(C.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(C.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(C.ScaleIn|C.ScaleOut|C.RotateLeft|C.RotateRight,!1)},e.prototype.updateManipulatorTransform=function(){var e=u.mat4.identity(w.sm4d.get());u.mat4.rotate(e,e,this.tool.symbolRotationAngle,f.vec3f64.fromValues(0,0,1));var t=this.getScale(),n=u.mat4.fromScaling(w.sm4d.get(),d.vec3.set(w.sv3d.get(),t,t,t)),r=u.mat4.identity(w.sm4d.get());u.mat4.multiply(r,n,e),this.ringManipulator.modelTransform=r},e.prototype.createRingManipulator=function(){for(var e=function(e,t,n){for(var r=[],i=Math.ceil(_.GEOMETRY_SEGMENTS*(t-e)/(2*Math.PI)),a=0;a<i+1;a++){var o=e+a*(t-e)/i;r.push(f.vec3f64.fromValues(n*Math.cos(o),n*Math.sin(o),0))}return r},t=function(t){return e(0,2*Math.PI,t)},r=function(e,t){return new S(O.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,_.RING_HEIGHT/2],[-e/2,_.RING_HEIGHT/2]]}(t),e,[],[],!1),"graphic-transform-ring")},i=t(_.RING_RADIUS),a=r(i,_.RING_THICKNESS),o={left:[],right:[]},s=[],l=0;l<2;l++){var c=(A=l*Math.PI-Math.PI/4)+(D=Math.PI/2-_.ROTATE_INDICATOR_ARC_LENGTH),d=A+Math.PI/2-D,h=r(T=e(c,d,_.INNER_INDICATOR_RADIUS),_.INDICATOR_THICKNESS);s.push(T),s.push(e(c,d,_.OUTER_INDICATOR_RADIUS-_.RING_THICKNESS/2)),o.left.push(h),o.right.push(h);for(var g=0;g<2;g++){var y=0===g,b=p.mat4f64.create();if(y){u.mat4.scale(b,b,[1,-1,1]),u.mat4.rotate(b,b,-c,[0,0,1]);var x=Math.round(_.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE*(T.length-1));b[12]=T[x][0],b[13]=T[x][1],b[14]=T[x][2]}else u.mat4.rotate(b,b,d,[0,0,1]),x=Math.round((1-_.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE)*(T.length-1)),b[12]=T[x][0],b[13]=T[x][1],b[14]=T[x][2];var w=O.createExtrudedTriangle(_.ROTATE_INDICATOR_ARROW_TIP_LENGTH,0,_.ROTATE_INDICATOR_ARROW_TIP_RADIUS,_.RING_HEIGHT);O.transformInPlace(w,b);var P=new S(w,"graphic-transform-ring-rotate");(y?o.left:o.right).push(P)}}var M=[];for(l=0;l<2;l++){c=(A=l*Math.PI-Math.PI/4)+(D=Math.PI/2-_.SCALE_INDICATOR_ARC_LENGTH),d=A+Math.PI/2-D;var A,D,T=e(c,d,_.OUTER_INDICATOR_RADIUS);M.push(r(T,_.INDICATOR_THICKNESS))}var R=t(_.RING_RADIUS+_.SCALE_INDICATOR_OFFSET1),j=t(_.RING_RADIUS+_.SCALE_INDICATOR_OFFSET2),E=r(R,_.INDICATOR_THICKNESS),I=r(j,_.INDICATOR_THICKNESS),V=t(_.RING_RADIUS-_.SCALE_INDICATOR_OFFSET1),z=t(_.RING_RADIUS-_.SCALE_INDICATOR_OFFSET2),L=r(V,_.INDICATOR_THICKNESS),N=r(z,_.INDICATOR_THICKNESS),F=this.createMaterial(),U=this.createMaterial(.66),G=this.createMaterial(.5),H=this.createMaterial(.33),k=[{geometry:a,material:F,stateMask:C.DelayedFocused},{geometry:a,material:G,stateMask:0}];this.mode&&"scale"!==this.mode||(k=k.concat([{geometry:M,material:F,stateMask:C.DelayedFocused|C.Unlocked},{geometry:E,material:U,stateMask:C.DelayedFocused|C.ScaleIn},{geometry:I,material:H,stateMask:C.DelayedFocused|C.ScaleIn},{geometry:L,material:U,stateMask:C.DelayedFocused|C.ScaleOut},{geometry:N,material:H,stateMask:C.DelayedFocused|C.ScaleOut}])),this.mode&&"rotate"!==this.mode||(k=k.concat([{geometry:o.right,material:F,stateMask:C.DelayedFocused|C.Unlocked},{geometry:o.left,material:F,stateMask:C.DelayedFocused|C.RotateLeft},{geometry:o.right,material:F,stateMask:C.DelayedFocused|C.RotateRight}]));var B=n.__spreadArrays([i],s);return new m.Manipulator3D({view:this.tool.view,renderObjects:k,autoScaleRenderObjects:!1,worldOriented:!0,radius:_.RING_THICKNESS,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:v.getGraphicEffectiveElevationInfo(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:B,direction:f.vec3f64.fromValues(0,0,1)}})},e.prototype.createMaterial=function(e){void 0===e&&(e=1);var t=n.__spreadArrays(_.HANDLE_COLOR,[e]),r=new P({color:t,transparent:1!==e,cullFace:2},"graphic-transform");return r.renderOccluded=2,r},e.prototype.applySymbolData=function(e,t,n,r){var i=this;e.symbolLayers.forEach((function(e,a){var s=t.symbolLayers[a],l=s.heading,c=s.size;"object"===e.type&&(e.heading=(o.isSome(l)?l:0)-h.toDegree(n),o.isSome(c)&&"width"in c&&(c.width=i.enforceNonZeroSize(c.width),c.height=i.enforceNonZeroSize(c.height),c.depth=i.enforceNonZeroSize(c.depth),e.width=c.width*r,e.depth=c.depth*r,e.height=c.height*r))}))},e.prototype.enforceNonZeroSize=function(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)},Object.defineProperty(e.prototype,"test",{get:function(){return{ringManipulator:this.ringManipulator}},enumerable:!0,configurable:!0}),e}();function D(e,t,n){var r=t.projectPoint(e,l.castRenderScreenPointArray(R)),i=t.renderToScreen(r,j);return d.vec3.set(n,i[0],i[1],0)}function T(e,t){var n=null,r=1,i=function(){return r};return{start:function(){r=e.getScale(),n=e.getScale,e.getScale=i,t()},update:function(e){return r+=((r+1)/2-r)*Math.min(e*_.RING_RESET_ANIMATION_SPEED_FACTOR,1),t(),Math.abs(r-1)<.01?1:0},destroy:function(){e.getScale=n,t()}}}t.GraphicScaleRotateTransform=A;var R=f.vec3f64.create(),j=l.createScreenPointArray()}).apply(null,r))||(e.exports=i)},Raj5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){var n=function(){function e(e,t,n,i,a,o){this.camera=null,this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=r,this.hasOccludees=!1,this.rctx=e,this.offscreenRenderingHelper=t,this.scenelightingData=n,this.shadowMap=i,this.ssaoHelper=a,this.sliceHelper=o}return e.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=r},Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0}),e}(),r=13;return n}).apply(null,r))||(e.exports=i)},"RdU/":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("B4Pz"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){function a(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(r.FoamIntensity),e.fragment.code.add(i.glsl(o||(o=n.__makeTemplateObject(["\n      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress = computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength = waveParams[2];\n        float flowOffset = waveParams[3];\n\n        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress = computeProgress(uv, time + phaseOffset);\n        float weight = computeWeight(uv, time + phaseOffset);\n\n        vec2 result = uv;\n        result -= flowVector * (progress + flowOffset);\n        result += phaseOffset;\n        result += (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\n      const float TIME_NOISE_STRENGTH = 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength = waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement = time * -_waveDir;\n\n        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal = normalize(normal_A + normal_B);\n        mixNormal.xy *= waveStrength;\n        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat = waveParams[1];\n        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  = normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "],["\n      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress = computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength = waveParams[2];\n        float flowOffset = waveParams[3];\n\n        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress = computeProgress(uv, time + phaseOffset);\n        float weight = computeWeight(uv, time + phaseOffset);\n\n        vec2 result = uv;\n        result -= flowVector * (progress + flowOffset);\n        result += phaseOffset;\n        result += (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\n      const float TIME_NOISE_STRENGTH = 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength = waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement = time * -_waveDir;\n\n        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal = normalize(normal_A + normal_B);\n        mixNormal.xy *= waveStrength;\n        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat = waveParams[1];\n        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  = normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "]))))}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.WaterDistortion=a,function(e){e.bindUniforms=function(e,t){e.setUniform1i("texWaveNormal",0),e.setUniform1i("texWavePerturbation",1),e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}}(a=t.WaterDistortion||(t.WaterDistortion={}))}).apply(null,r))||(e.exports=i)},RsYQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("jBNx"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("AzkI"),n("18xY"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f){Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function e(e,t,n){void 0===e&&(e=s.vec3f64.create()),void 0===t&&(t=s.vec3f64.create()),void 0===n&&(n=s.vec3f64.fromValues(0,0,1)),this._viewUp=s.vec3f64.create(),this._viewForward=s.vec3f64.create(),this._viewRight=s.vec3f64.create(),this._ray=u.ray.createWrapper(),this._viewport=c.vec4f64.fromValues(0,0,1,1),this._padding=c.vec4f64.fromValues(0,0,0,0),this._fov=55/180*Math.PI,this._near=1,this._far=1e3,this._viewDirty=!0,this._viewMatrix=a.mat4f64.create(),this._projectionDirty=!0,this._projectionMatrix=a.mat4f64.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=a.mat4f64.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=a.mat4f64.create(),this._frustumDirty=!0,this._frustum=u.frustum.create(),this._fullViewport=null,this.pixelRatio=1,this.relativeElevation=0,this._eye=s.vec3f64.clone(e),this._center=s.vec3f64.clone(t),this._up=s.vec3f64.clone(n),this._padding=c.vec4f64.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=s.vec3f64.create()),o.vec3.subtract(this._ray.direction,this.center,this.eye),this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){i.mat4.copy(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(this._near=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._far=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){this._viewport[0]!==(e+=this._padding[3])&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){this._viewport[1]!==(e+=this._padding[2])&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=c.vec4f64.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),l.vec4.copy(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(i.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2),r=n*this.aspect;i.mat4.frustum(this._projectionMatrix,-r*(1+2*this._padding[3]/e),r*(1+2*this._padding[1]/e),-n*(1+2*this._padding[2]/t),n*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){i.mat4.copy(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return f.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=f.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return f.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=f.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return o.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustum",{get:function(){return this._recomputeFrustum(),this._frustum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=a.mat4f64.create()),i.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),i.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),e.prototype.depthNDCToWorld=function(e){return 2*this.near*this.far/(this.far+this.near-(2*e-1)*(this.far-this.near))},Object.defineProperty(e.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation>=0},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){var t=e;return o.vec3.copy(this._eye,t._eye),o.vec3.copy(this._center,t._center),o.vec3.copy(this._up,t._up),l.vec4.copy(this._viewport,t._viewport),l.vec4.copy(this._padding,t._padding),this._near=t._near,this._far=t._far,this._fov=t._fov,this.relativeElevation=e.relativeElevation,this._viewDirty=t._viewDirty,this._viewDirty||(i.mat4.copy(this._viewMatrix,t._viewMatrix),o.vec3.copy(this._viewRight,t._viewRight),o.vec3.copy(this._viewUp,t._viewUp),o.vec3.copy(this._viewForward,t._viewForward)),t._projectionDirty?this._projectionDirty=!0:(i.mat4.copy(this._projectionMatrix,t._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(u.frustum.copy(t._frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?i.mat4.copy(this._viewInverseTransposeMatrix,t._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=a.mat4f64.clone(t._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),t._fullViewport?this._fullViewport?l.vec4.copy(this._fullViewport,t._fullViewport):this._fullViewport=c.vec4f64.clone(t._fullViewport):this._fullViewport=null,this.pixelRatio=e.pixelRatio,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equals=function(e){return o.vec3.exactEquals(this._eye,e._eye)&&o.vec3.exactEquals(this._center,e._center)&&o.vec3.exactEquals(this._up,e._up)&&l.vec4.exactEquals(this._viewport,e._viewport)&&l.vec4.exactEquals(this._padding,e._padding)&&this._near===e._near&&this._far===e._far&&this._fov===e._fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation},e.prototype.almostEquals=function(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e._fov-this._fov)>=.001)return!1;o.vec3.sub(g,e._eye,e._center),o.vec3.sub(y,this._eye,this._center);var t=o.vec3.dot(g,y),n=o.vec3.sqrLen(g),r=o.vec3.sqrLen(y);return t*t>=(1-1e-10)*n*r&&o.vec3.sqrDist(e._eye,this._eye)<5e-4*Math.max(n,r)*5e-4&&l.vec4.squaredDistance(e._padding,this._padding)<.5&&l.vec4.squaredDistance(e._viewport,this._viewport)<.5},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0},e.prototype.computeRenderPixelSizeAt=function(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.computeRenderPixelSizeAtDist=function(e){return e*this.perRenderPixelRatio},e.prototype.computeScreenPixelSizeAt=function(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.viewDirectionDistance=function(e){return Math.abs(d.projectPointSignedLength(this.viewForward,o.vec3.subtract(g,e,this._eye)))},e.prototype.computeScreenPixelSizeAtDist=function(e){return e*this.perScreenPixelRatio},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.getScreenCenter=function(e){return void 0===e&&(e=r.createScreenPointArray()),e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e},e.prototype.getRenderCenter=function(e,t,n){return void 0===t&&(t=.5),void 0===n&&(n=.5),e||(e=r.createRenderScreenPointArray3()),e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*n,e.length>2&&(e[2]=.5),e},e.prototype.setGLViewport=function(e){var t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])},e.prototype.applyProjection=function(e,t,r){void 0===r&&(r=!1),e!==v&&o.vec3.copy(v,e),v[3]=1,r&&(t[2]=-v[2]),l.vec4.transformMat4(v,v,this.projectionMatrix),o.vec3.scale(v,v,1/Math.abs(v[3]));var i=this.fullViewport;return t[0]=n.lerp(0,i[0]+i[2],.5+.5*v[0]),t[1]=n.lerp(0,i[1]+i[3],.5+.5*v[1]),r||(t[2]=.5*(v[2]+1)),t},e.prototype.projectPoint=function(e,t){if(v[0]=e[0],v[1]=e[1],v[2]=e[2],v[3]=1,l.vec4.transformMat4(v,v,this.viewProjectionMatrix),0===v[3])return null;o.vec3.scale(v,v,1/Math.abs(v[3]));var r=this.fullViewport;return"x"in t?(t.x=n.lerp(0,r[0]+r[2],.5+.5*v[0]),t.y=n.lerp(0,r[1]+r[3],.5+.5*v[1])):(t[0]=n.lerp(0,r[0]+r[2],.5+.5*v[0]),t[1]=n.lerp(0,r[1]+r[3],.5+.5*v[1]),t.length>2&&(t[2]=.5*(v[2]+1))),t},e.prototype.unprojectPoint=function(e,t){if(i.mat4.multiply(m,this.projectionMatrix,this.viewMatrix),!i.mat4.invert(m,m))return null;var n=this.fullViewport;return v[0]=2*(e[0]-n[0])/n[2]-1,v[1]=2*(e[1]-n[1])/n[3]-1,v[2]=2*e[2]-1,v[3]=1,l.vec4.transformMat4(v,v,m),0===v[3]?null:(t[0]=v[0]/v[3],t[1]=v[1]/v[3],t[2]=v[2]/v[3],t)},e.prototype.computeUp=function(e){"global"===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.screenToRender=function(e,t){var n=this.fullHeight-e[1]*this.pixelRatio;return t[0]=e[0]*this.pixelRatio,t[1]=n,t},e.prototype.renderToScreen=function(e,t){var n=(this.fullHeight-e[1])/this.pixelRatio;return t[0]=e[0]/this.pixelRatio,t[1]=n,t},e.prototype.computeUpGlobal=function(){o.vec3.subtract(g,this.center,this.eye);var e=o.vec3.length(this.center);e<1?(o.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(o.vec3.dot(g,this.center))>.9999*o.vec3.length(g)*e||(o.vec3.cross(this.up,g,this.center),o.vec3.cross(this.up,this.up,g),o.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){p.directionFromTo(g,this.eye,this.center),Math.abs(g[2])<=.9999&&(o.vec3.scale(g,g,g[2]),o.vec3.set(this.up,-g[0],-g[1],1-g[2]),o.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){o.vec3.exactEquals(e,t)||(o.vec3.copy(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)},e.prototype._recomputeFrustum=function(){this._frustumDirty&&(u.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)},e.prototype._ensureViewClean=function(){this._viewDirty&&(i.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),o.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),o.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),o.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}();t.default=h;var v=c.vec4f64.create(),m=a.mat4f64.create(),g=s.vec3f64.create(),y=s.vec3f64.create()}).apply(null,r))||(e.exports=i)},SNs2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("LxLY"),n("fese"),n("3kdR"),n("PaEL"),n("3PFg"),n("W/V4"),n("FQ4r"),n("lBa0"),n("lfQW"),n("ne9J"),n("G0ER"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d,f,h,v,m){Object.defineProperty(t,"__esModule",{value:!0}),t.RibbonVertexAttributeConstants={POSITION:"position",SUBDIVISIONFACTOR:"subdivisionFactor",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",SUBDIVISIONS:"subdivisions",COLOR:"color",COLORFEATUREATTRIBUTE:"colorFeatureAttribute",SIZE:"size",SIZEFEATUREATTRIBUTE:"sizeFeatureAttribute",OPACITYFEATUREATTRIBUTE:"opacityFeatureAttribute"},t.ribbonVertexAttributeLocations={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};var g=function(e){function p(t,n){var r=e.call(this,t,n)||this;return r.stipplePattern=null,r.stippleTextureBind=null,r.stippleTextureRepository=t.stippleTextureRepository,r}return r.__extends(p,e),p.prototype.initializeProgram=function(e){var n=p.shader.get(),r=this.configuration,i=n.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,stippleEnabled:r.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleUVMaxEnabled:r.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:r.stippleIntegerRepeatsEnabled,roundCaps:r.roundCaps,roundJoins:r.roundJoins,vvColor:r.vvColor,vvSize:r.vvSize,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,falloffEnabled:r.falloffEnabled,innerColorEnabled:r.innerColorEnabled});return new v(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),t.ribbonVertexAttributeLocations)},p.prototype.dispose=function(){e.prototype.dispose.call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null},p.prototype.bindPass=function(e,t,n){if(4===this.configuration.output&&l.OutputHighlight.bindOutputHighlight(e,this.program,n),this.program.setUniform1f("intrinsicWidth",t.width),this.program.setUniform4fv("intrinsicColor",t.color),this.program.setUniform1f("miterLimit","miter"!==t.join?0:t.miterLimit),this.program.setUniform1f("nearPlane",n.nearFar[0]),this.program.setUniform1f("pixelRatio",n.pixelRatio),this.program.setUniform2fv("screenSize",[n.viewport[2],n.viewport[3]]),c.VisualVariables.bindUniformsWithOpacity(this.program,t),this.stipplePattern!==t.stipplePattern){var r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){var o=a.isSome(this.stippleTextureBind)?this.stippleTextureBind(e,0)*n.pixelRatio:1;if(this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/o),this.configuration.stippleOffColorEnabled){var s=i.unwrap(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",s[0],s[1],s[2],s.length>3?s[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",t.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",i.unwrapOr(t.innerColor,t.color)),this.program.setUniform1f("innerWidth",t.innerWidth*n.pixelRatio))},p.prototype.bindDraw=function(e){s.Transform.bindUniforms(this.program,e),o.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},p.prototype.initializePipeline=function(){var e=this.configuration,t=m.separateBlendingParams(770,1,771,771),n=e.polygonOffset&&y;if(e.occluder&&(this._occluderPipelineTransparent=m.makePipelineState({blending:t,polygonOffset:n,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:m.defaultColorWriteParams,stencilWrite:null,stencilTest:f.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=m.makePipelineState({polygonOffset:n,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:m.defaultColorWriteParams,stencilWrite:f.stencilWriteMaskOff,stencilTest:f.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=m.makePipelineState({polygonOffset:n,depthTest:f.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:f.stencilWriteMaskOn,stencilTest:f.stencilToolMaskBaseParams})),0===e.output){var r=function(r){return m.makePipelineState({blending:t,polygonOffset:n,depthTest:f.depthCompareLess,depthWrite:!e.transparent&&e.writeDepth&&m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?f.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?r?f.stencilToolMaskBaseParams:e.sceneHasOcludees?f.stencilBaseAllZerosParams:null:null})};return this._occludeePipeline=r(!0),r(!1)}return m.makePipelineState({polygonOffset:n,depthTest:f.depthCompareLess,depthWrite:!e.transparent&&e.writeDepth&&m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams})},Object.defineProperty(p.prototype,"occluderPipelineTransparent",{get:function(){return this._occluderPipelineTransparent},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"occluderPipelineOpaque",{get:function(){return this._occluderPipelineOpaque},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"occludeePipeline",{get:function(){return this._occludeePipeline},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"occluderPipelineMaskWrite",{get:function(){return this._occluderPipelineMaskWrite},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"primitiveType",{get:function(){return 5},enumerable:!0,configurable:!0}),p.shader=new u.ReloadableShaderModule(h,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("ne9J")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),p}(p.ShaderTechnique);t.RibbonLineTechnique=g;var y={factor:0,units:-4},_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.occluder=!1,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.vertexColors=!1,t.transparent=!1,t.polygonOffset=!1,t.writeDepth=!1,t.stippleEnabled=!1,t.stippleOffColorEnabled=!1,t.stippleIntegerRepeatsEnabled=!1,t.roundCaps=!1,t.roundJoins=!1,t.vvSize=!1,t.vvColor=!1,t.vvOpacity=!1,t.falloffEnabled=!1,t.innerColorEnabled=!1,t.sceneHasOcludees=!1,t}return r.__extends(t,e),r.__decorate([d.parameter({count:7})],t.prototype,"output",void 0),r.__decorate([d.parameter()],t.prototype,"occluder",void 0),r.__decorate([d.parameter()],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"sliceHighlightDisabled",void 0),r.__decorate([d.parameter()],t.prototype,"vertexColors",void 0),r.__decorate([d.parameter()],t.prototype,"transparent",void 0),r.__decorate([d.parameter()],t.prototype,"polygonOffset",void 0),r.__decorate([d.parameter()],t.prototype,"writeDepth",void 0),r.__decorate([d.parameter()],t.prototype,"stippleEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"stippleOffColorEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"stippleIntegerRepeatsEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"roundCaps",void 0),r.__decorate([d.parameter()],t.prototype,"roundJoins",void 0),r.__decorate([d.parameter()],t.prototype,"vvSize",void 0),r.__decorate([d.parameter()],t.prototype,"vvColor",void 0),r.__decorate([d.parameter()],t.prototype,"vvOpacity",void 0),r.__decorate([d.parameter()],t.prototype,"falloffEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"innerColorEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(d.ShaderTechniqueConfiguration);t.RibbonLineTechniqueConfiguration=_}).apply(null,r))||(e.exports=i)},T95R:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("BcWh"),n("LxLY"),n("jBNx"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("WRgd"),n("X5J5"),n("as1Q"),n("2W+Z"),n("fOZq"),n("v+nG"),n("mmEe"),n("RsYQ"),n("ys4y"),n("4ziW"),n("o5p5"),n("uZGf")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x,w){Object.defineProperty(t,"__esModule",{value:!0});var S=function(){function e(e){var t=this;this.view=null,this.camera=new y.default,this.events=new n,this._isDraped=!1,this._vertices=null,this._spatialReference=null,this._color=d.settings.colorToVec4(d.settings.reshapeManipulators.vertex.color),this._elevationInfo=null,this._occludedMode=8,this.resources=new h.VisualElementResources({view:e.view,createResources:function(e){return t.createResources(e)},recreateGeometry:function(e,n){return e.geometries.length=0,t.recreateGeometry(n,e.vertexMaterial,e.vertexOutlineMaterial,e.geometries),e.geometries}}),this.drapedResources=new f.DrapedVisualElementResources({view:e.view,createResources:function(){return t.createDrapedResources()},recreateGeometry:function(e){}});var r=!0;for(var i in e)i in this?"attached"===i?r=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=r}return e.prototype.onViewChange=function(){this.camera.copyFrom(this.view.state.camera)},e.prototype.destroy=function(){this.resources.destroy(),this.drapedResources.destroy()},Object.defineProperty(e.prototype,"isDraped",{get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e,this.drapedResources.hidden=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this.updateAttached(e)},enumerable:!0,configurable:!0}),e.prototype.updateAttached=function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e},Object.defineProperty(e.prototype,"vertices",{get:function(){return this._vertices},set:function(e){this._vertices=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){c.vec4.exactEquals(e,this._color)||(c.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(e){e!==this._occludedMode&&(this._occludedMode=e,r.isSome(this.resources.resources)&&(this.resources.resources.vertexMaterial.renderOccluded=e,this.resources.resources.vertexOutlineMaterial.renderOccluded=e),r.isSome(this.drapedResources.resources))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexMaterialParameters",{get:function(){return{color:this._color,transparent:this._color[3]<1}},enumerable:!0,configurable:!0}),e.prototype.updateMaterial=function(){r.isSome(this.resources.resources)&&this.resources.resources.vertexMaterial.setParameterValues(this.vertexMaterialParameters)},e.prototype.recreateGeometry=function(e,t,n,r){for(var i=0,a=this.createRenderGeometries();i<a.length;i++){var o=a[i];e.addGeometry(o.vertexGeometry,t,o.xform),r.push(o.vertexGeometry),e.addGeometry(o.vertexOutlineGeometry,n,o.xform),r.push(o.vertexOutlineGeometry)}},e.prototype.createResources=function(e){var t=this.color,n=u.vec4f64.fromValues(t[0],t[1],t[2],t.length>3?t[3]:1),r=new w.ShadedColorMaterial({color:n,transparent:t[3]<1,writeDepth:!0,cullFace:2},"manipulator");r.renderOccluded=d.settings.reshapeManipulators.vertex.renderOccludedFlag;var i=d.settings.colorToVec4(d.settings.reshapeManipulators.vertex.outlineColor),a=u.vec4f64.fromValues(i[0],i[1],i[2],4===i.length?i[3]:1),o=new x({color:a,transparent:!0,writeDepth:!0,cullFace:1},"manipulator-outline");o.renderOccluded=d.settings.reshapeManipulators.vertex.renderOccludedFlag;var s=[];return this.recreateGeometry(e,r,o,s),{vertexMaterial:r,vertexOutlineMaterial:o,geometries:s,forEach:function(e){e(r),e(o),s.forEach(e)}}},e.prototype.createDrapedResources=function(){return{geometries:null}},e.prototype.calculateMapBounds=function(e){if(r.isNone(this.resources.resources))return!1;for(var t=this.view.renderCoordsHelper,n=0,i=this.resources.resources.geometries;n<i.length;n++){var a=i[n].data.getAttribute("position"),o=a.data,s=new Float64Array(o.length);g.bufferToBuffer(a.data,t.spatialReference,0,s,this.view.spatialReference,0,o.length/3),p.expandWithBuffer(e,s)}return!0},e.prototype.computeScreenLocation=function(e,t){return t.pixelSize=this.camera.computeScreenPixelSizeAt(e),this.camera.projectPoint(e,t.renderScreenPointArray),this.camera.renderToScreen(t.renderScreenPointArray,t.screenPointArray),t},e.prototype.computeTransform=function(e,t){var n=o.mat4f64.create(),r=t*this.computeScreenLocation(e,O).pixelSize;return a.mat4.set(n,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1),n[12]+=e[0],n[13]+=e[1],n[14]+=e[2],n[15]=1,n},e.prototype.createRenderGeometries=function(){var e=this.vertices;if(r.isNone(e)||0===e.length)return[];if(!this.view.state||!this.view.state.camera)return[];this.camera.copyFrom(this.view.state.camera);for(var t=d.settings.reshapeManipulators.vertex,n=t.size/2,i=n+t.collisionPadding,a=n/i,o=(n+t.outlineSize)/i,l=m.geometryToRenderInfo(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,v.ElevationContext.fromElevationInfo(this.elevationInfo)),c=[],u=l.numVertices,p=l.position,f=0;f<u;++f){var h=new _(b.createSphereGeometry(a,16,16),"VerticesVisualElement-vertex"),g=new _(b.createSphereGeometry(o,16,16),"VerticesVisualElement-vertexOutline"),y=s.vec3.set(P,p[3*f+0],p[3*f+1],p[3*f+2]),x=this.computeTransform(y,i);c.push({vertexGeometry:h,vertexOutlineGeometry:g,xform:x})}return c},e}();t.VerticesVisualElement=S;var O={screenPointArray:i.createScreenPointArray(),renderScreenPointArray:i.createRenderScreenPointArray3(),pixelSize:0},P=l.vec3f64.create()}).apply(null,r))||(e.exports=i)},TIRl:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("DtIM"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new a.EventPipeline,this._enabled=!1}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&r.isSome(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,n=this.snap(this.lastDragEvent.screenEnd);r.isSome(n)&&this.next.execute({action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?n:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd})}this._enabled=e},enumerable:!0,configurable:!0}),e.prototype.snap=function(e){var t=r.isSome(this.view)?this.view.toMap(e,{exclude:[]}):null;return r.isSome(t)&&r.isSome(this.view)&&(t.z=i.getZForElevationMode(t,this.view,this.elevationInfo)),t},e.prototype.createDragEventPipelineStep=function(e,t){var i=this;return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,function(e){if(i.lastDragEvent="end"!==e.action?n.__assign({},e):null,i._enabled){var t=i.snap(e.screenEnd);return r.isSome(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}},e}();t.SnapToScene=o}).apply(null,r))||(e.exports=i)},UGy0:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("hk44"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a){var o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new a.ShaderBuilder;return t.include(r.Laserline,e),t.vertex.uniforms.add("uModelViewMatrix","mat4"),t.vertex.uniforms.add("uProjectionMatrix","mat4"),t.attributes.add("start","vec3"),t.attributes.add("end","vec3"),t.attributes.add("up","vec3"),t.attributes.add("extrude","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add(i.glsl(o||(o=n.__makeTemplateObject(["\n  void main() {\n    vec3 pos = mix(start, end, extrude.x);\n\n    vec4 viewPos = uModelViewMatrix * vec4(pos, 1);\n    vec4 projPos = uProjectionMatrix * viewPos;\n    vec2 ndcPos = projPos.xy / projPos.w;\n\n    vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;\n    vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);\n    vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);\n\n    vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);\n    ndcPos += length(lxy) * projExtrudeDir;\n\n    vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));\n    vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;\n\n    vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;\n    vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;\n    vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\n\n    // Add enough padding in the X screen space direction for glow\n    float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\n    ndcPos.x += xPaddingPixels * pixelToNDC.x;\n\n    uv = ndcPos * 0.5 + 0.5;\n    gl_Position = vec4(ndcPos, 0, 1);\n  }\n  "],["\n  void main() {\n    vec3 pos = mix(start, end, extrude.x);\n\n    vec4 viewPos = uModelViewMatrix * vec4(pos, 1);\n    vec4 projPos = uProjectionMatrix * viewPos;\n    vec2 ndcPos = projPos.xy / projPos.w;\n\n    vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;\n    vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);\n    vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);\n\n    vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);\n    ndcPos += length(lxy) * projExtrudeDir;\n\n    vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));\n    vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;\n\n    vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;\n    vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;\n    vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\n\n    // Add enough padding in the X screen space direction for glow\n    float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\n    ndcPos.x += xPaddingPixels * pixelToNDC.x;\n\n    uv = ndcPos * 0.5 + 0.5;\n    gl_Position = vec4(ndcPos, 0, 1);\n  }\n  "])))),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add(i.glsl(s||(s=n.__makeTemplateObject(["\n  float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\n    vec3 origin = mix(start, end, 0.5);\n    vec3 basis = end - origin;\n    vec3 posAtOrigin = pos - origin;\n\n    float x = dot(normalize(basis), posAtOrigin);\n    float y = dot(plane.xyz, posAtOrigin);\n\n    float dx = max(abs(x) - length(basis), 0.0);\n    float dy = y;\n\n    float dist = length(vec2(dx, dy));\n\n    float width = fwidth(y);\n    float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;\n    float pixelDist = dist / min(width, maxPixelDistance);\n    return abs(pixelDist);\n  }\n\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\n\n    vec4 color = laserlineProfile(distance);\n    float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\n\n    gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n  }\n  "],["\n  float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\n    vec3 origin = mix(start, end, 0.5);\n    vec3 basis = end - origin;\n    vec3 posAtOrigin = pos - origin;\n\n    float x = dot(normalize(basis), posAtOrigin);\n    float y = dot(plane.xyz, posAtOrigin);\n\n    float dx = max(abs(x) - length(basis), 0.0);\n    float dy = y;\n\n    float dist = length(vec2(dx, dy));\n\n    float width = fwidth(y);\n    float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;\n    float pixelDist = dist / min(width, maxPixelDistance);\n    return abs(pixelDist);\n  }\n\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\n\n    vec4 color = laserlineProfile(distance);\n    float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\n\n    gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n  }\n  "])))),t}}).apply(null,r))||(e.exports=i)},VQEQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("W9tT"),n("DIqE"),n("O7NG"),n("fese"),n("hs8d"),n("uUnu"),n("aRjO"),n("PaEL"),n("3PFg"),n("IwVr"),n("rCq5"),n("DKwL"),n("2o+p"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g){function y(e,t){var n,i,a;return void 0===t&&(t=z),e.textureIsSignedDistanceField?((a=t)[0]=(n=e.anchorPos)[0]*((i=e.distanceFieldBoundingBox)[2]-i[0])+i[0],a[1]=n[1]*(i[3]-i[1])+i[1]):r.vec2.copy(t,e.anchorPos),t}Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new g.ShaderBuilder,r=e.signedDistanceFieldEnabled;if(t.include(s.AlignPixel),t.include(l.HUD,e),t.include(o.Slice,e),6===e.output)return t.include(c.HUDOcclusionPass,e),t;t.include(v.ScreenSizePerspective),t.include(h.RgbaFloatEncoding),t.include(f.ColorConversion,{stages:1}),t.include(p.VisualVariables,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),r&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(m.glsl(x||(x=n.__makeTemplateObject(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "],["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),m.glsl(e.screenSizePerspectiveEnabled?_||(_=n.__makeTemplateObject(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "],["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "])):b||(b=n.__makeTemplateObject(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"],["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var i=m.glsl(w||(w=n.__makeTemplateObject(["\n      vec2 uv01 = floor(uv0);\n      vec2 uv = uv0 - uv01;\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "],["\n      vec2 uv01 = floor(uv0);\n      vec2 uv = uv0 - uv01;\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "]))),a=m.glsl(r?S||(S=n.__makeTemplateObject(["\n  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"],["\n  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"])):O||(O=n.__makeTemplateObject(["\n  posProj += quadOffset;\n  if (inputSize.x == size.x) {\n    posProj = alignToPixelOrigin(posProj, viewport.zw);\n  }"],["\n  posProj += quadOffset;\n  if (inputSize.x == size.x) {\n    posProj = alignToPixelOrigin(posProj, viewport.zw);\n  }"])));t.vertex.code.add(m.glsl(M||(M=n.__makeTemplateObject(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "],["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "])),e.occlusionTestEnabled?"if (visible) {":"",i,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",m.glsl.float(d.symbolAlphaCutoff),r?"alphaDiscard = alphaDiscard && outlineColor.a < "+m.glsl.float(d.symbolAlphaCutoff)+";":"",a,e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?m.glsl(P||(P=n.__makeTemplateObject(["} else { vtc = vec2(0.0);\n        ",""],["} else { vtc = vec2(0.0);\n        ",""])),e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),t.fragment.uniforms.add("tex","sampler2D"),r&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));var y=e.debugDrawBorder?m.glsl(C||(C=n.__makeTemplateObject(["(isBorder > 0.0 ? 0.0 : ",")"],["(isBorder > 0.0 ? 0.0 : ",")"])),m.glsl.float(d.defaultMaskAlphaCutoff)):m.glsl.float(d.defaultMaskAlphaCutoff),z=m.glsl(j||(j=n.__makeTemplateObject(["\n    ","\n\n    ","\n\n    ","\n  "],["\n    ","\n\n    ","\n\n    ","\n  "])),e.debugDrawBorder?m.glsl(A||(A=n.__makeTemplateObject(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"],["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",r?m.glsl(D||(D=n.__makeTemplateObject(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "],["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),y,m.glsl.float(d.symbolAlphaCutoff),y):m.glsl(T||(T=n.__makeTemplateObject(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "],["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),y),e.debugDrawBorder?m.glsl(R||(R=n.__makeTemplateObject(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"],["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");return 0===e.output&&t.fragment.code.add(m.glsl(E||(E=n.__makeTemplateObject(["\n    void main() {\n      ","\n    }\n    "],["\n    void main() {\n      ","\n    }\n    "])),z)),4===e.output&&(t.include(u.OutputHighlight),t.fragment.code.add(m.glsl(V||(V=n.__makeTemplateObject(["\n    void main() {\n      ","\n      ","\n    }\n    "],["\n    void main() {\n      ","\n      ","\n    }\n    "])),z,e.binaryHighlightOcclusionEnabled?m.glsl(I||(I=n.__makeTemplateObject(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"],["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t},function(e){e.bindUniforms=function(e,t,n){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",a.vec4f64.ZEROS),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize)));var r=n.pixelRatio||1;e.setUniform2f("screenOffset",2*t.screenOffset[0]*r,2*t.screenOffset[1]*r),e.setUniform2fv("anchorPos",y(t))}}(t.HUDMaterial||(t.HUDMaterial={})),t.calculateAnchorPosForRendering=y;var _,b,x,w,S,O,P,M,C,A,D,T,R,j,E,I,V,z=i.vec2f64.create()}).apply(null,r))||(e.exports=i)},"W/V4":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this._module=e,this._loadModule=t}return e.prototype.get=function(){return this._module},e.prototype.reload=function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return e=this,[4,this._loadModule()];case 1:return e._module=t.sent(),[2,this._module]}}))}))},e}();t.ReloadableShaderModule=r}).apply(null,r))||(e.exports=i)},W0kZ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}();t.IdGen=n}).apply(null,r))||(e.exports=i)},X5J5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("QDcU"),n("KtQ6"),n("pcDC"),n("O7NG"),n("FbvD")],void 0===(i=(function(e,t,n,r,i,a,o,s){function l(e,t){var n=e.clone();return n.a*=t,n}function c(e,t){var n=e.clone(),r=i.toHSV(n);r.s*=t;var a=i.toRGB(r);return n.r=a.r,n.g=a.g,n.b=a.b,n}function u(e,t){if(t)for(var n in t)e[n]=t[n]}Object.defineProperty(t,"__esModule",{value:!0}),t.colors={main:new r([255,127,0]),selected:new r([255,255,255]),staged:new r([12,207,255]),outline:new r([0,0,0,.5]),selectedOutline:new r([255,255,255])};var p=function(){function e(e){this.color=t.colors.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.occludedMode="always",u(this,e)}return Object.defineProperty(e.prototype,"occludedFlag",{get:function(){return S(this.occludedMode)},enumerable:!0,configurable:!0}),e}(),d=function(){function e(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=t.colors.main,this.outlineColor=t.colors.outline,this.occludedMode="always",this.hoverOutlineColor=t.colors.selectedOutline,u(this,e)}return Object.defineProperty(e.prototype,"renderOccludedFlag",{get:function(){return S(this.occludedMode)},enumerable:!0,configurable:!0}),e.prototype.apply=function(e,t){var n=this[e];t.setParameterValues({color:w(n),transparent:"color"!==e||n.a<1}),t.renderOccluded=this.renderOccludedFlag},e}(),f=function(e){this.vertex=new d({color:t.colors.main,outlineColor:t.colors.outline}),this.edge=new d({color:c(l(t.colors.main,2/3),.5),outlineColor:l(t.colors.outline,.5),size:8,collisionPadding:8}),this.selected=new d({color:t.colors.selected,outlineColor:t.colors.outline}),u(this,e)},h=function(){function e(e){this.color=t.colors.selected,this.width=1.5,this.stipplePattern=s.createStipplePattern([5,5]),this.stippleOffColor=t.colors.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=t.colors.selected,this.occludedMode="transparent",this.occludedLayer="default",u(this,e)}return e.prototype.apply=function(e){e.color=w(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=w(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=w(this.innerColor),e.occludedMode=S(this.occludedMode,{layer:this.occludedLayer})},e}(),v=function(){function e(e){this.color=t.colors.selected,this.size=4,this.outlineSize=1,this.outlineColor=t.colors.outline,this.shape="square",u(this,e)}return e.prototype.apply=function(e){e.color=w(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=w(this.outlineColor),e.primitive=this.shape},e}(),m=function(){function e(e){this.innerColor=t.colors.selected,this.innerWidth=1,this.glowColor=t.colors.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=t.colors.main,u(this,e)}return e.prototype.apply=function(e,t){void 0===t&&(t=1);var n={glowColor:r.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:r.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=n:e.laserlineStyle=n},e}(),g=function(e){this.outline=new h({color:t.colors.selected,occludedMode:"transparent",occludedLayer:"foreground",stippleOffColor:t.colors.outline,stipplePattern:s.createStipplePattern([5,5]),width:1.5}),this.staged=new h({color:t.colors.selected,occludedMode:"transparent",occludedLayer:"foreground",innerColor:t.colors.staged,stippleOffColor:t.colors.outline,stipplePattern:s.createStipplePattern([5,5]),width:1.5}),this.shadowStyle=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:1}),u(this,e)},y=function(e){this.outline=new v({color:t.colors.selected,outlineColor:t.colors.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:1.5,glowWidth:6,innerColor:t.colors.selected,innerWidth:1,radius:2}),u(this,e)},_=function(e){function t(t){var n=e.call(this)||this;return n.infinite="ground",u(n,t),n}return n.__extends(t,e),Object.defineProperty(t.prototype,"infiniteType",{get:function(){switch(this.infinite){case"single":return 1;case"double":return 2;case"ground":return 3;default:return a.neverReached(this.infinite),1}},enumerable:!0,configurable:!0}),t}(h),b=function(e){this.lineGraphics=new g,this.pointGraphics=new y,this.heightPlane=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:1}),this.heightBox=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:0,heightFillColor:t.colors.main}),this.zVerticalLine=new _({color:l(t.colors.main,.5),falloff:2,innerColor:l(t.colors.selected,0),occludedMode:"transparent",stipplePattern:null,width:5,infinite:"ground"}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,u(this,e)},x=function(){function e(e){this.visualElements=new b,this.reshapeManipulators=new f,this.zManipulator=new p,u(this,e)}return e.prototype.colorToVec4=function(e){return w(e)},e}();function w(e){return o.vec4f64.fromArray(r.toUnitRGBA(e))}function S(e,t){var n=t&&"foreground"===t.layer;switch(e){case"always":return n?32:16;case"transparent":return n?8:4;case"always-transparent":return 2;default:a.neverReached(e)}return 1}t.settings=new x}).apply(null,r))||(e.exports=i)},Xakh:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){function i(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "],["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "]))))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.Reprojection=i,function(e){e.bindUniforms=function(e,t,n){e.setUniform1i("lastFrameColorMap",n.lastFrameColorTextureID),t.bindTexture(n.lastFrameColorTexture,n.lastFrameColorTextureID),e.setUniformMatrix4fv("reprojectionMat",n.reprojectionMat),e.setUniformMatrix4fv("rpProjectionMat",n.rpProjectionMat)}}(i=t.Reprojection||(t.Reprojection={}))}).apply(null,r))||(e.exports=i)},XcBT:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("KQg4"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("G0ER"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get().build();return new c(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),l.Default3D)},t.prototype.initializePipeline=function(){return u.makePipelineState(this.configuration.hasAlpha?{blending:u.separateBlendingParams(770,1,771,771),colorWrite:u.defaultColorWriteParams}:{colorWrite:u.defaultColorWriteParams})},t.shader=new a.ReloadableShaderModule(i,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("KQg4")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(o.ShaderTechnique);t.TextureTechnique=p;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasAlpha=!1,t}return r.__extends(t,e),r.__decorate([s.parameter()],t.prototype,"hasAlpha",void 0),t}(s.ShaderTechniqueConfiguration);t.TextureTechniqueConfiguration=d}).apply(null,r))||(e.exports=i)},YseA:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){null==e?e=16:e<65536&&(e=n.nextHighestPowerOfTwo(e)),this._array=new Float32Array(e),this._size=0}return e.prototype.resize=function(e,t){if(this._size=e,this._size>this._array.length){for(var n=this._array.length||1;n<this._size;)n*=2;var r=new Float32Array(n);return t&&r.set(this._array),this._array=r,!0}var i=2*this._size;if(i<=this._array.length){for(n=this._array.length;n>=i;)n=Math.floor(n/2);return r=new Float32Array(n),t&&r.set(this._array.subarray(0,n)),this._array=r,!0}return!1},e.prototype.append=function(e){var t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)},e.prototype.erase=function(e,t){for(var n=e;n<t;++n)this._array[n]=0},Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e}();t.ResizableFloat32Array=r}).apply(null,r))||(e.exports=i)},ZJC8:function(e,t){},ZO6V:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("KY0m"),n("BcWh"),n("Rdxj"),n("W0kZ"),n("mYMs")],void 0===(i=(function(e,t,n,r,i,a,o,s){return function(e){function t(n,r,i){var o=e.call(this)||this;return o._parentStages=new Map,o._objects=new Set,o.id=t._idGen.gen(n),o.apiLayerUid=i,o.name=n,o.group=(r=r||{}).group||"",o.isVisible=null==r.isVisible||r.isVisible,o.isPickable=null==r.isPickable||r.isPickable,o.isSliceable=!1,o.translation=r.translation?a.vec3f64.clone(r.translation):a.vec3f64.create(),o}return n.__extends(t,e),t.prototype.addParentStage=function(e){if(!this._parentStages.has(e)){var t=this.on("dirty",(function(t){e.notifyDirty(t.origin,t.dirtyType,t.subObject)}));this._parentStages.set(e,t)}},t.prototype.removeParentStage=function(e){var t=this._parentStages.get(e);t&&(t.remove(),this._parentStages.delete(e)),this.invalidateSpatialQueryAccelerator()},t.prototype.getName=function(){return this.name},t.prototype.getGroup=function(){return this.group},t.prototype.getTranslation=function(){return this.translation},t.prototype.getObjectIds=function(){return r.keysOfSet(this._objects,(function(e){return e.id}))},t.prototype.getObjects=function(){return r.keysOfSet(this._objects)},t.prototype.addObject=function(e){this._objects.add(e),e.parentLayer=this,this.notifyDirty("layerObjectAdded",e),this._octree&&this._octree.add(e)},t.prototype.hasObject=function(e){return this._objects.has(e)},t.prototype.removeObject=function(e){return!!this._objects.delete(e)&&(e.parentLayer=null,this.notifyDirty("layerObjectRemoved",e),this._octree&&this._octree.remove(e),!0)},t.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},t.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._objects.size>50&&this._createOctree(),this._octree},t.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},t.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)},t.prototype.notifyDirty=function(e,t,n,r){n=n||0,this.emit("dirty",{origin:r||this,dirtyType:e,subObject:t})},t.prototype._createOctree=function(){this._octree=new s({getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(r.keysOfSet(this._objects))},t._idGen=new o.IdGen,t}(i)}).apply(null,r))||(e.exports=i)},ZeO9:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("R2Zq"),n("R2Zq"),n("LxLY"),n("LxLY"),n("FXVB"),n("1m5D"),n("MzcX"),n("ff/U"),n("FLCf"),n("YseA"),n("CIy2"),n("CP88"),n("pbva"),n("PwS/"),n("QFi0"),n("Kfys"),n("z2+Q")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y){var _=function(){function e(e,t,n,r){void 0===r&&(r=c.Default3D),this.type="MergedRenderer",this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._rctx=e,this._vertexAttributeLocations=r,this._material=n,this._materialRep=t,this._glMaterials=v.acquireMaterials(this._material,this._materialRep),this._bufferWriter=n.createBufferWriter()}return e.prototype.dispose=function(){v.releaseMaterials(this._material,this._materialRep),this._dataByOrigin&&(this._dataByOrigin.forEach((function(e){e.vao.dispose(!0),e.vao=null})),this._dataByOrigin.clear(),this._dataByOrigin=null),this._glMaterials&&(this._glMaterials.forEach((function(e){e&&e.dispose()})),this._glMaterials.clear(),this._glMaterials=null)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasOccludees",{get:function(){return this._hasOccludees},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasWater",{get:function(){return!this.isEmpty&&r.someMap(this._glMaterials,(function(e){return e instanceof f.WaterGLMaterial}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rendersOccluded",{get:function(){return!this.isEmpty&&1!==this._material.renderOccluded},enumerable:!0,configurable:!0}),e.prototype.modify=function(e){this.updateGeometries(e.toUpdate),this.addAndRemoveGeometries(e.toAdd,e.toRemove),this.updateRenderCommands()},e.prototype.addAndRemoveGeometries=function(e,t){var n=this,r=this._bufferWriter,i=r.vertexBufferLayout,a=i.stride/4,o=this._dataByOrigin,s=function(e,t,n,r){for(var i=new Map,a=t.vertexBufferLayout.stride/4,o=function(n,r){var o=n.origin,s=e.get(o.id),l=i.get(o.id);null==l&&i.set(o.id,l={optimalCount:null==s?0:s.optimalCount,sparseCount:null==s?0:s.buffer.size,toAdd:[],toRemove:[],origin:o.vec3});var c=t.elementCount(n.data)*a;r?(l.optimalCount+=c,l.sparseCount+=c,l.toAdd.push(n)):(l.optimalCount-=c,l.toRemove.push(n))},s=0,l=n;s<l.length;s++){var c=l[s];o(c,!0)}for(var u=0,p=r;u<p.length;u++)o(c=p[u],!1);return i}(o,r,e,t);s.forEach((function(e,t){s.delete(t);var r=e.optimalCount,l=e.sparseCount,c=o.get(t);if(null==c&&(d.assert(r>0),c=n.createData(i,r,e.origin),o.set(t,c)),0===r)return c.vao.dispose(!0),c.vao=null,void o.delete(t);var u=r<e.sparseCount/2,p=b,f=c.buffer.size,h=c.buffer.array,v=c.buffer.resize(u?r:l,!1);u||v?n.removeAndRebuild(c,e.toRemove,a,h,p):e.toRemove.length>0?(n.removeByErasing(c,e.toRemove,a,p),e.toAdd.length>0&&(p.end=f)):(p.begin=f,p.end=f);var m=x;d.setMatrixTranslation3(m,-e.origin[0],-e.origin[1],-e.origin[2]),n.append(c,e.toAdd,a,m,p);var g=c.vao.vertexBuffers.geometry;if(g.byteSize!==c.buffer.array.buffer.byteLength)g.setData(c.buffer.array);else{var y=p.begin,_=p.end;if(y<_){var w=4*y;g.setSubData(c.buffer.array,w,w,4*_)}}c.drawCommandsDirty=!0}))},e.prototype.updateGeometries=function(e){for(var t=this._bufferWriter,n=t.vertexBufferLayout.stride/4,r=0,i=e;r<i.length;r++){var a=i[r],o=a.updateType,s=a.renderGeometry,l=this._dataByOrigin.get(s.origin.id),c=l&&l.instances.get(s.uniqueName);if(!c)return;if(1&o&&(c.isVisible=s.instanceParameters.visible),9&o&&(c.hasHighlights=!!s.instanceParameters.highlights&&s.instanceParameters.visible),16&o&&(c.hasOccludees=!!s.instanceParameters.occludees),6&o){var u=l.buffer.array,p=l.vao;v.calculateTransformRelToOrigin(s,w,S),t.write({transformation:w,invTranspTransformation:S},s.data,t.vertexBufferLayout.createView(u.buffer),c.from),d.assert(c.from+t.elementCount(s.data)===c.to,"material VBO layout has changed"),p.vertexBuffers.geometry.setSubData(u,c.from*n*4,c.from*n*4,c.to*n*4)}l.drawCommandsDirty=!0}},e.prototype.updateRenderCommands=function(){this._dataByOrigin.forEach((function(e){e.hasHiddenInstances=r.someMap(e.instances,(function(e){return!e.isVisible})),e.hasHighlights=r.someMap(e.instances,(function(e){return e.isVisible&&e.hasHighlights})),e.hasOccludees=r.someMap(e.instances,(function(e){return e.isVisible&&e.hasOccludees}))})),this._hasHighlights=r.someMap(this._dataByOrigin,(function(e){return e.hasHighlights})),this._hasOccludees=r.someMap(this._dataByOrigin,(function(e){return e.hasOccludees})),this._dataByOrigin.forEach((function(e){e.drawCommandsDirty&&(function(e){if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.stats={default:0,highlight:0,occludees:0},0!==e.instances.size){if(!(e.hasOccludees||e.hasHighlights||e.hasHiddenInstances)){var t=4*e.buffer.size/g.getStride(e.vao.layout.geometry);return e.drawCommandsDefault=[{first:0,count:t}],void(e.stats={default:t,highlight:0,occludees:0})}var r=h.sortInstancesAccordingToRange(n.valuesOfMap(e.instances));e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[];for(var i=0,a=r;i<a.length;i++){var o=a[i];o.isVisible&&(h.addOrMerge(o.hasOccludees?e.drawCommandsOccludees:e.drawCommandsDefault,o),o.hasHighlights&&h.addOrMerge(e.drawCommandsHighlight,o))}var s=function(e){for(var t=0,n=0,r=e;n<r.length;n++)t+=r[n].count;return t/3};e.stats={default:s(e.drawCommandsDefault),highlight:s(e.drawCommandsHighlight),occludees:s(e.drawCommandsOccludees)}}}(e),e.drawCommandsDirty=!1)}))},e.prototype.updateLogic=function(e){return this._material.update(e)},e.prototype.render=function(e,t,n,r){var o=this,s=this._rctx,l=this._glMaterials.get(t.pass),c=4===t.pass,p=e;if(2===t.pass&&null===p&&(p=22),!l||2!==l.ensureResources(s)||null!=p&&!l.beginSlot(p)||c&&!this._hasHighlights)return!1;l.ensureParameters(n);var d=l.getTechnique(),f=l.getPipelineState(p,!1);s.setPipelineState(f),l.bind(s,n);var h=!1;return this._dataByOrigin.forEach((function(e){if(!(i.isNone(e.drawCommandsDefault)&&i.isNone(e.drawCommandsHighlight)&&i.isNone(e.drawCommandsOccludees))&&(!c||e.hasHighlights)){n.origin=e.origin,d.bindDraw(n),d.ensureAttributeLocations(e.vao),s.bindVAO(e.vao);var t=d.primitiveType,v=c?e.drawCommandsHighlight:e.drawCommandsDefault,m=c?e.stats.highlight:e.stats.default;if(a.isSome(v)&&(o.renderCommands(s,t,v),u.addToRenderStats(v.length,m,r),h=!0),!c&&a.isSome(v=e.drawCommandsOccludees)){var g=l.getPipelineState(p,!0);s.setPipelineState(g),o.renderCommands(s,t,v),s.setPipelineState(f),u.addToRenderStats(v.length,e.stats.occludees,r),h=!0}}})),h},e.prototype.renderCommands=function(e,t,n){for(var r=0;r<n.length;r++)e.drawArrays(t,n[r].first,n[r].count)},e.prototype.createData=function(e,t,n){return{instances:new Map,vao:new y(this._rctx,this._vertexAttributeLocations,{geometry:l.glLayout(e)},{geometry:m.createVertex(this._rctx,35044)}),buffer:new p.ResizableFloat32Array(t),optimalCount:0,origin:n,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,stats:{default:0,highlight:0,occludees:0}}},e.prototype.removeAndRebuild=function(e,t,n,r,i){for(var a=0,o=t;a<o.length;a++){var s=o[a].uniqueName,l=e.instances.get(s);e.optimalCount-=(l.to-l.from)*n,e.instances.delete(s)}var c=0,u=e.buffer.array;i.begin=0,i.end=0;var p=-1,d=-1,f=0;e.instances.forEach((function(e){var t=e.from*n,i=e.to*n,a=i-t;p!==d&&d!==t?(u.set(r.subarray(p,d),f),f+=d-p,p=t):-1===p&&(p=t),d=i,e.from=c/n,e.to=(c+=a)/n})),p!==d&&u.set(r.subarray(p,d),f),i.end=c},e.prototype.removeByErasing=function(e,t,n,r){r.begin=1/0,r.end=-1/0;for(var i=-1,a=-1,o=0,s=t;o<s.length;o++){var l=s[o].uniqueName,c=e.instances.get(l),u=c.from*n,p=c.to*n;i!==a&&a!==u?(e.buffer.erase(i,a),i=u):-1===i&&(i=u),a=p,e.instances.delete(l),e.optimalCount-=p-u,u<r.begin&&(r.begin=u),p>r.end&&(r.end=p)}i!==a&&e.buffer.erase(i,a)},e.prototype.append=function(e,t,n,r,i){for(var s=this._bufferWriter,l=0,c=t;l<c.length;l++){var u=c[l],p=a.isSome(u.transformation)?o.mat4.multiply(w,r,u.transformation):r;o.mat4.invert(S,p),o.mat4.transpose(S,S);var f=i.end;s.write({transformation:p,invTranspTransformation:S},u.data,s.vertexBufferLayout.createView(e.buffer.array.buffer),i.end/n);var v=s.elementCount(u.data)*n,m=f+v;d.assert(null==e.instances.get(u.uniqueName));var g=u.instanceParameters.visible,y=new h.Instance(f/n,m/n,g,!!u.instanceParameters.highlights&&g,!!u.instanceParameters.occludees);e.instances.set(u.uniqueName,y),e.optimalCount+=v,i.end+=v}},Object.defineProperty(e.prototype,"test",{get:function(){return{material:this._material,glMaterials:this._glMaterials}},enumerable:!0,configurable:!0}),e}(),b={begin:0,end:0},x=s.mat4f64.create(),w=s.mat4f64.create(),S=s.mat4f64.create();return _}).apply(null,r))||(e.exports=i)},ZjcA:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("PHan"),n("W9tT"),n("0LE5"),n("Rdxj"),n("JjCO"),n("N5NQ")],void 0===(i=(function(e,t,n,r,i,a,o,s){function l(e){return e?{p0:a.vec3f64.clone(e.p0),p1:a.vec3f64.clone(e.p1),p2:a.vec3f64.clone(e.p2)}:{p0:a.vec3f64.create(),p1:a.vec3f64.create(),p2:a.vec3f64.create()}}function c(e,t,n,r){return void 0===r&&(r=l()),i.vec3.copy(r.p0,e),i.vec3.copy(r.p1,t),i.vec3.copy(r.p2,n),r}function u(e,t,n){var i=r.vec2.distance(e,t),a=r.vec2.distance(t,n),o=r.vec2.distance(n,e),s=(i+a+o)/2,l=s*(s-i)*(s-a)*(s-o);return l<=0?0:Math.sqrt(l)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=l,t.wrap=function(e,t,n){var r=d.get();return r.p0=e,r.p1=t,r.p2=n,r},t.copy=function(e,t){return void 0===t&&(t=l()),c(e.p0,e.p1,e.p2,t)},t.fromValues=c,t.distance2=function(e,t){var n=e.p0,r=e.p1,a=e.p2,l=i.vec3.subtract(o.sv3d.get(),r,n),c=i.vec3.subtract(o.sv3d.get(),a,r),u=i.vec3.subtract(o.sv3d.get(),n,a),d=i.vec3.subtract(o.sv3d.get(),t,n),f=i.vec3.subtract(o.sv3d.get(),t,r),h=i.vec3.subtract(o.sv3d.get(),t,a),v=i.vec3.cross(l,l,u),m=i.vec3.dot(i.vec3.cross(o.sv3d.get(),l,v),d),g=i.vec3.dot(i.vec3.cross(o.sv3d.get(),c,v),f),y=i.vec3.dot(i.vec3.cross(o.sv3d.get(),u,v),h);if(m>0&&g>0&&y>0){var _=i.vec3.dot(v,d);return _*_/i.vec3.dot(v,v)}var b=s.distance2(s.fromValues(n,l,p.get()),t),x=s.distance2(s.fromValues(r,c,p.get()),t),w=s.distance2(s.fromValues(a,u,p.get()),t);return Math.min(b,x,w)},t.intersectRay=function(e,t,n){var r=t.direction,a=t.origin,o=e.p0,s=e.p1,l=e.p2,c=s[0]-o[0],u=s[1]-o[1],p=s[2]-o[2],d=l[0]-o[0],f=l[1]-o[1],h=l[2]-o[2],v=r[1]*h-f*r[2],m=r[2]*d-h*r[0],g=r[0]*f-d*r[1],y=c*v+u*m+p*g;if(y>-1e-5&&y<1e-5)return!1;var _=1/y,b=a[0]-o[0],x=a[1]-o[1],w=a[2]-o[2],S=_*(b*v+x*m+w*g);if(S<0||S>1)return!1;var O=x*p-u*w,P=w*c-p*b,M=b*u-c*x,C=_*(r[0]*O+r[1]*P+r[2]*M);return!(C<0||S+C>1||(n&&(i.vec3.scale(n,r,_*(d*O+f*P+h*M)),i.vec3.add(n,a,n)),0))},t.areaPoints2d=u,t.area2d=function(e){return u(e.p0,e.p1,e.p2)},t.areaPoints3d=function(e,t,n){return i.vec3.subtract(f,t,e),i.vec3.subtract(h,n,e),i.vec3.length(i.vec3.cross(f,f,h))/2};var p=new n.ObjectStack(s.create),d=new n.ObjectStack((function(){return{p0:null,p1:null,p2:null}})),f=a.vec3f64.create(),h=a.vec3f64.create()}).apply(null,r))||(e.exports=i)},aExC:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qsST"),n("R2Zq"),n("ULaq")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder"),o=function(){function e(){this.vertex=new c,this.fragment=new c,this.attributes=new u,this.varyings=new p,this.extensions=new d,this.defines=new f,this._includedModules=new Map}return e.prototype.include=function(e,t){this._includedModules.has(e)?this._includedModules.get(e)!==t&&a.error("Trying to include shader module multiple times with different sets of options."):(this._includedModules.set(e,t),"shaderModule"in e?e.shaderModule(this,t):e(this,t))},e.prototype.generateSource=function(e){var t=this.extensions.generateSource(e),n=this.attributes.generateSource(e),r=this.varyings.generateSource(),i="vertex"===e?this.vertex:this.fragment,a=i.uniforms.generateSource(),o=i.code.generateSource(),s="vertex"===e?v:h,l=this.defines.generateSource().concat(i.defines.generateSource());return"\n"+t.join("\n")+"\n\n"+l.join("\n")+"\n\n"+s+"\n\n"+a.join("\n")+"\n\n"+n.join("\n")+"\n\n"+r.join("\n")+"\n\n"+o.join("\n")},e}();t.ShaderBuilder=o;var s=function(){function e(){this._entries=new Array,this._set=new Set}return e.prototype.add=function(e,t,n){var r=e+"_"+t+"_"+n;return this._set.has(r)||(this._entries.push([e,t,n]),this._set.add(r)),this},e.prototype.generateSource=function(){return this._entries.map((function(e){return"uniform "+e[1]+" "+e[0]+((t=e[2])?"["+t+"]":"")+";";var t}))},e}(),l=function(){function e(){this._entries=new Array}return e.prototype.add=function(e){this._entries.push(e)},e.prototype.generateSource=function(){return this._entries},e}(),c=function(){this.uniforms=new s,this.code=new l,this.defines=new f},u=function(){function e(){this._entries=new Array}return e.prototype.add=function(e,t){this._entries.push([e,t])},e.prototype.generateSource=function(e){return"fragment"===e?[]:this._entries.map((function(e){return"attribute "+e[1]+" "+e[0]+";"}))},e}(),p=function(){function e(){this._entries=new Array}return e.prototype.add=function(e,t){this._entries.push([e,t])},e.prototype.generateSource=function(){return this._entries.map((function(e){return"varying "+e[1]+" "+e[0]+";"}))},e}(),d=function(){function e(){this._entries=new Set}return e.prototype.add=function(e){this._entries.add(e)},e.prototype.generateSource=function(t){var n="vertex"===t?e.WHITELIST_VERTEX:e.WHITELIST_FRAGMENT;return i.valuesOfSet(this._entries).filter((function(e){return n.indexOf(e)>=0})).map((function(e){return"#extension "+e+" : enable"}))},e.WHITELIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],e.WHITELIST_VERTEX=[],e}(),f=function(){function e(){this._entries=new Map}return e.prototype.addInt=function(e,t){var n=t%1==0?t.toFixed(0):t.toString();this._entries.set(e,n)},e.prototype.addFloat=function(e,t){var n=t%1==0?t.toFixed(1):t.toString();this._entries.set(e,n)},e.prototype.generateSource=function(){return r.pairsOfMap(this._entries).map((function(e){return"#define "+e[0]+" "+e[1]}))},e}(),h="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",v="precision highp float;\nprecision highp sampler2D;"}).apply(null,r))||(e.exports=i)},aRjO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.HUDOcclusionPass=function(e){var t=e;t.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "],["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])))),t.fragment.uniforms.add("color","vec4"),t.fragment.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n  void main() {\n    gl_FragColor = color;\n  }\n  "],["\n  void main() {\n    gl_FragColor = color;\n  }\n  "]))))},function(e){e.bindUniforms=function(e){e.setUniform4f("color",1,1,1,1)}}(t.HUDOcclusion||(t.HUDOcclusion={}))}).apply(null,r))||(e.exports=i)},aWgr:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("GyfB"),n("2eYJ"),n("fXZm"),n("cpxo"),n("N5NQ"),n("GG08"),n("4p4v"),n("/dtL"),n("ZjcA"),n("18xY")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0}),t.plane=s,t.boundedPlane=r,t.triangle=u,t.lineSegment=o,t.ray=l,t.clipRay=i,t.sphere=c,t.frustum=a,t.vector=p,t.axisAngle=n}).apply(null,r))||(e.exports=i)},ama6:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("51bw"),n("vlC2")],void 0===(i=(function(e,t,n,r){var i;return function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:r.vec3f32.fromValues(1,1,1),vvSizeMaxSize:r.vec3f32.fromValues(100,100,100),vvSizeOffset:r.vec3f32.fromValues(0,0,0),vvSizeFactor:r.vec3f32.fromValues(1,1,1),vvSizeValue:r.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:n.mat3f64.create()}}(i||(i={})),i}).apply(null,r))||(e.exports=i)},as1Q:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.resourceFactory=e,this._resources=null,this._hidden=!1,this._attached=!1}return e.prototype.destroy=function(){this._destroyResources()},Object.defineProperty(e.prototype,"resources",{get:function(){return n.isSome(this._resources)?this._resources.external:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this._hidden},set:function(e){e!==this._hidden&&(this._hidden=e,this._syncGeometriesToRenderer())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())},enumerable:!0,configurable:!0}),e.prototype.recreate=function(){this.attached&&this._createResources()},e.prototype.recreateGeometry=function(){this.resourceFactory.recreateGeometry?n.isNone(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()},e.prototype._createOrDestroyResources=function(){this._attached?n.isNone(this._resources)&&this._createResources():this._destroyResources()},e.prototype._createResources=function(){this._destroyResources();var e=this.resourceFactory.createResources();this._resources={layerView:{view:this.resourceFactory.view,notifyGraphicUpdate:function(){},watch:function(){return{remove:function(){}}}},external:e,geometriesAdded:!1},this._syncGeometriesToRenderer()},e.prototype._destroyResources=function(){n.isNone(this._resources)||(this.ensureRenderGeometriesRemoved(),this._resources=null)},e.prototype._syncGeometriesToRenderer=function(){this._hidden?this.ensureRenderGeometriesRemoved():this._hidden||this.ensureRenderGeometriesAdded()},e.prototype.ensureRenderGeometriesRemoved=function(){n.isNone(this._resources)||this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)},e.prototype.ensureRenderGeometriesAdded=function(){n.isNone(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)},e}();t.DrapedVisualElementResources=r}).apply(null,r))||(e.exports=i)},cj3m:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("DKwL"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){function a(e){e.include(r.RgbaFloatEncoding),e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("shadowMapNum","int"),e.fragment.uniforms.add("shadowMapDistance","vec4"),e.fragment.uniforms.add("shadowMapMatrix","mat4",4),e.fragment.uniforms.add("depthHalfPixelSz","float"),e.fragment.code.add(i.glsl(o||(o=n.__makeTemplateObject(["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize = depthHalfPixelSz;\n      vec4 distance = shadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      if (i >= shadowMapNum) { return 0.0; }\n\n      mat4 mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n\n      // vertex completely outside? -> no shadow\n      vec3 lvpos = 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "],["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize = depthHalfPixelSz;\n      vec4 distance = shadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      if (i >= shadowMapNum) { return 0.0; }\n\n      mat4 mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n\n      // vertex completely outside? -> no shadow\n      vec3 lvpos = 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "]))))}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ReadShadowMap=a,function(e){e.bindUniforms=function(e,t,n){t.shadowMappingEnabled&&(t.shadowMap.bind(e,n),t.shadowMap.bindView(e,t.origin))},e.bindViewCustomOrigin=function(e,t,n){t.shadowMappingEnabled&&t.shadowMap.bindView(e,n)},e.bindView=function(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}}(a=t.ReadShadowMap||(t.ReadShadowMap={}))}).apply(null,r))||(e.exports=i)},cjy9:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("CIzB"),n("AzkI"),n("+nCE"),n("62Ht"),n("CIy2"),n("PwS/")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d){return function(){function e(e,t,n,r,i,a,s){this.uniqueName=null,this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.boundingInfo=t,this.material=n,this.origin=null,this.center=o.vec3f64.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=i,r&&this.updateTransformation(r,a),this.castShadow=s,this.instanceParameters={highlights:null,occludees:null,visible:!0}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,n){return t=t||l.maxScale(e),a.vec3.transformMat4(n,this.boundingInfo.getCenter(),e),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=i.mat4f64.create()),r.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(n.unwrapOr(this.transformation,s.IDENTITY))),this.shaderTransformationDirty=!1),this.shaderTransformation):n.unwrapOr(this.transformation,s.IDENTITY)},e.prototype.computeAttachmentOrigin=function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(n.isSome(this.transformation)&&a.vec3.transformMat4(e,e,this.transformation),!0);var t=this.getIndices(p.VertexAttrConstants.POSITION),r=this.getAttribute(p.VertexAttrConstants.POSITION);return!!c.computeAttachmentOriginTriangles(r,t,e)&&(n.isSome(this.transformation)&&a.vec3.transformMat4(e,e,this.transformation),!0)},e.prototype.getIndices=function(e){return"indices"in this.data?this.data.indices[e]:null},e.prototype.getAttribute=function(e){return"vertexAttr"in this.data?this.data.vertexAttr[e]:null},e.prototype.addHighlight=function(){var e=u.generateObject3DStateId(0),t=this.instanceParameters;return t.highlights=d.addObject3DStateID(t.highlights,e),e},e.prototype.removeHighlight=function(e){var t=this.instanceParameters;t.highlights=d.removeObject3DStateID(t.highlights,e)},e}()}).apply(null,r))||(e.exports=i)},cmSR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a,o;Object.defineProperty(t,"__esModule",{value:!0}),t.ForwardLinearDepth=function(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "],["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "]))))):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("uCameraNearFar","vec2"),e.vertex.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "],["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "]))))):e.vertex.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n      void forwardLinearDepth() {}\n    "],["\n      void forwardLinearDepth() {}\n    "]))))}}).apply(null,r))||(e.exports=i)},cpxo:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("PHan"),n("FXVB"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("JjCO"),n("fXZm"),n("GG08")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u){function p(e){if(e){var t=e.planes,n=e.points;return{planes:[u.create(t[0]),u.create(t[1]),u.create(t[2]),u.create(t[3]),u.create(t[4]),u.create(t[5])],points:[a.vec3f64.clone(n[0]),a.vec3f64.clone(n[1]),a.vec3f64.clone(n[2]),a.vec3f64.clone(n[3]),a.vec3f64.clone(n[4]),a.vec3f64.clone(n[5]),a.vec3f64.clone(n[6]),a.vec3f64.clone(n[7])]}}return{planes:[u.create(),u.create(),u.create(),u.create(),u.create(),u.create()],points:[a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create()]}}function d(e,t,n){void 0===n&&(n=p());for(var r=0;r<6;r++)u.copy(e[r],n.planes[r]);for(r=0;r<8;r++)i.vec3.copy(n.points[r],t[r]);return n}function f(e){var t=e.planes,n=e.points;u.fromPoints(n[4],n[0],n[3],t[0]),u.fromPoints(n[1],n[5],n[6],t[1]),u.fromPoints(n[4],n[5],n[1],t[2]),u.fromPoints(n[3],n[2],n[6],t[3]),u.fromPoints(n[0],n[1],n[2],t[4]),u.fromPoints(n[5],n[4],n[7],t[5])}function h(e,t){for(var n=0;n<6;n++)if(!u.clip(e[n],t))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.create=p,t.copy=function(e,t){return void 0===t&&(t=p()),d(e.planes,e.points,t)},t.fromValues=d,t.fromMatrix=function(e,t,n){void 0===n&&(n=p());var a=n.points,s=r.mat4.multiply(l.sm4d.get(),t,e);r.mat4.invert(s,s);for(var c=0;c<8;++c){var u=o.vec4.transformMat4(l.sv4d.get(),v[c],s);i.vec3.set(a[c],u[0]/u[3],u[1]/u[3],u[2]/u[3])}return f(n),n},t.recomputePlanes=f,t.intersectsSphere=function(e,t){for(var n=0;n<6;n++)if(u.isSphereFullyInside(e[n],t))return!1;return!0},t.intersectsRay=function(e,t){return h(e,c.fromRay(t,m.get()))},t.intersectClipRay=function(e,t){for(var n=0;n<6;n++)if(!u.clipInfinite(e[n],t))return!1;return!0},t.intersectsLineSegment=function(e,t,n){return h(e,c.fromLineSegmentAndDirection(t,n,m.get()))},t.intersectsPoint=function(e,t){for(var n=0;n<6;n++)if(u.signedDistance(e[n],t)>0)return!1;return!0},t.intersectsAABB=function(e,t){for(var n=0;n<6;n++)if(u.isAABBFullyInside(e[n],t))return!1;return!0},t.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};var v=[s.vec4f64.fromValues(-1,-1,-1,1),s.vec4f64.fromValues(1,-1,-1,1),s.vec4f64.fromValues(1,1,-1,1),s.vec4f64.fromValues(-1,1,-1,1),s.vec4f64.fromValues(-1,-1,1,1),s.vec4f64.fromValues(1,-1,1,1),s.vec4f64.fromValues(1,1,1,1),s.vec4f64.fromValues(-1,1,1,1)],m=new n.ObjectStack(c.create)}).apply(null,r))||(e.exports=i)},dXKx:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("LxLY"),n("x7Wq"),n("CF4u"),n("NsXp"),n("Z91k"),n("35hF")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultPointSymbol2D=o.fromJSON(l.defaultPointSymbolJSON),t.defaultPolylineSymbol2D=a.fromJSON(l.defaultPolylineSymbolJSON),t.defaultPolygonSymbol2D=i.fromJSON(l.defaultPolygonSymbolJSON),t.defaultTextSymbol2D=s.fromJSON(l.defaultTextSymbolJSON),t.getDefaultSymbol2D=function(e){if(r.isNone(e))return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return t.defaultPointSymbol2D;case"polyline":return t.defaultPolylineSymbol2D;case"polygon":case"extent":return t.defaultPolygonSymbol2D;default:n.neverReached(e)}return null},t.errorPointSymbol2D=o.fromJSON(l.errorPointSymbolJSON),t.errorPolylineSymbol2D=a.fromJSON(l.errorPolylineSymbolJSON),t.errorPolygonSymbol2D=i.fromJSON(l.errorPolygonSymbolJSON)}).apply(null,r))||(e.exports=i)},"dl/g":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("KY0m")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderOutputTypes=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"}],t.getShaderOutputID=function(e,r){return e+"_"+n.find(t.ShaderOutputTypes,(function(e){return e.output===r})).name}}).apply(null,r))||(e.exports=i)},dtql:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("CqfC"),n("KwnQ"),n("W9tT"),n("DIqE"),n("21p4"),n("lRq4"),n("AzkI"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0}),t.createGraphicMoveDragPipeline=function(e,t,n){var r=e.graphic,i=function(e,n){return t({action:e,graphic:r,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY})};return n((function(e,t,n){t.next((function(e){return"start"===e.action&&i("start",e),e})).next(u.dragGraphic(r)).next((function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&i("update",e);break;case"end":i("end",e)}return e})),n.next(u.resetGraphic(r)).next((function(){i("end",{screenDeltaX:0,screenDeltaY:0})}))}))},t.primaryShapeOrientation=function(e){if(n.isNone(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=s.convexHull(e),i=t&&t.rings&&t.rings[0];if(!i)return 0;!function(e){for(var t=0,n=0,r=0,i=e;r<i.length;r++){var a=i[r];t+=a[0],n+=a[1]}t/=e.length,n/=e.length;for(var o=0,s=e;o<s.length;o++)(a=s[o])[0]-=t,a[1]-=n}(i);for(var o=[],u=0;u<i.length-1;u++){var h=Math.atan2(i[u+1][1]-i[u][1],i[u+1][0]-i[u][0]),v=c.cyclical2PI.normalize(h)%(Math.PI/2);o.push(v)}for(var m=o.sort((function(e,t){return e-t})),g=null,y=0,_=Number.POSITIVE_INFINITY,b=0,x=m;b<x.length;b++)if((h=x[b])!==g){g=h,r.mat2.fromRotation(p,h),l.empty(d);for(var w=0,S=i;w<S.length;w++)a.vec2.transformMat2(f,S[w],p),l.expandPointInPlace(d,f);var O=l.area(d);((O>_?_/O:O/_)>=.99&&h<y||O<_)&&(y=h,_=O)}return y};var p=i.mat2f64.create(),d=l.create(),f=o.vec2f64.create()}).apply(null,r))||(e.exports=i)},eHCP:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("Rdxj")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.fromVector=function(e,t){return{vec3:n.vec3f64.clone(e),id:t}},t.fromValues=function(e,t,r,i){return{vec3:n.vec3f64.fromValues(e,t,r),id:i}}}).apply(null,r))||(e.exports=i)},fOZq:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("sSIw"),n("yVFQ")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return Object.defineProperty(e.prototype,"featureExpressionInfoContext",{get:function(){return this._featureExpressionInfoContext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=r.getMetersPerUnit(e)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"},Object.defineProperty(e.prototype,"offsetMeters",{set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offsetElevationInfoUnits",{set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0},enumerable:!0,configurable:!0}),e.prototype.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e},e.prototype.geometryZWithOffset=function(e,t){var n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n},e.prototype.calculateOffsetRenderUnits=function(e){var t=this._meterUnitOffset,n=this.featureExpressionInfoContext;return null!=n&&(t+=i.execute(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset},e.prototype.setFromElevationInfo=function(e){this.mode=e.mode,this.unit=e.unit||"meters",this.offsetElevationInfoUnits=n.unwrapOr(e.offset,0)},e.prototype.updateFeatureExpressionInfoContext=function(e,t,r){if(n.isNone(e))this._featureExpressionInfoContext=null;else{var a=e&&e.arcade;a&&n.isSome(t)&&n.isSome(r)?(this._featureExpressionInfoContext=i.clone(e),i.setContextFeature(this._featureExpressionInfoContext,i.createFeature(a.modules,t,r))):this._featureExpressionInfoContext=e}},e.fromElevationInfo=function(t){var r=new e;return n.isSome(t)&&r.setFromElevationInfo(t),r},e}();t.ElevationContext=a}).apply(null,r))||(e.exports=i)},fQ2U:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("O7NG"),n("fese"),n("3kdR"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("NiJV"),n("G0ER"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d,f){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get(),r=this.configuration,i=n.build({slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new d(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),u.Default3D)},t.prototype.bindPass=function(e,t,n){var r=t.color,i=t.shadingTint;this.program.setUniform4fv("color",r),this.program.setUniform4fv("shadedColor",this.blendColor(m,i,r)),this.program.setUniform3fv("shadingDirection",t.shadingDirection),this.program.setUniformMatrix4fv("viewNormal",n.viewInvTransp)},t.prototype.blendColor=function(e,t,n){var r=1-t[3],i=t[3]+n[3]*r;return 0===i?(e[3]=i,e):(e[0]=(t[0]*t[3]+n[0]*n[3]*r)/i,e[1]=(t[1]*t[3]+n[1]*n[3]*r)/i,e[2]=(t[2]*t[3]+n[2]*n[3]*r)/i,e[3]=n[3],e)},t.prototype.bindDraw=function(e){o.Transform.bindUniforms(this.program,e),a.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){var e,t=this.configuration,n=0===t.output?t.transparent&&f.separateBlendingParams(770,1,771,771):null;return f.makePipelineState({blending:n,culling:(e=t.cullFace,0!==e&&{face:1===e?1028:1029,mode:2305}),depthTest:{func:515},depthWrite:t.writeDepth&&f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams})},t.shader=new s.ReloadableShaderModule(p,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("NiJV")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(l.ShaderTechnique);t.ShadedColorMaterialTechnique=h;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.transparent=!1,t.writeDepth=!0,t}return r.__extends(t,e),r.__decorate([c.parameter({count:7})],t.prototype,"output",void 0),r.__decorate([c.parameter({count:3})],t.prototype,"cullFace",void 0),r.__decorate([c.parameter()],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([c.parameter()],t.prototype,"sliceHighlightDisabled",void 0),r.__decorate([c.parameter()],t.prototype,"transparent",void 0),r.__decorate([c.parameter()],t.prototype,"writeDepth",void 0),t}(c.ShaderTechniqueConfiguration);t.ShadedColorMaterialTechniqueConfiguration=v;var m=i.vec4f64.create()}).apply(null,r))||(e.exports=i)},fUJJ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("xoE+"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("qSzK"),n("G0ER"),n("qbr3"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get().build(this.configuration);return new u(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),l.Default3D)},t.prototype.bind=function(e,t){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*t.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*t.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1);var n=null!=e.angleCutoff?e.angleCutoff:c.defaultAngleCutoff;this.program.setUniform2f("angleCutoff",Math.cos(n),Math.cos(Math.max(0,n-i.deg2rad(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",t.perScreenPixelRatio)},t.prototype.initializePipeline=function(){return d.makePipelineState({blending:p.simpleBlendingParams(1,771),colorWrite:d.defaultColorWriteParams})},t.shader=new a.ReloadableShaderModule(c,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("qSzK")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(o.ShaderTechnique);t.LaserlineTechnique=f;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.heightManifoldEnabled=!1,t.pointDistanceEnabled=!1,t.lineVerticalPlaneEnabled=!1,t.intersectsLineEnabled=!1,t.contrastControlEnabled=!1,t}return r.__extends(t,e),r.__decorate([s.parameter()],t.prototype,"heightManifoldEnabled",void 0),r.__decorate([s.parameter()],t.prototype,"pointDistanceEnabled",void 0),r.__decorate([s.parameter()],t.prototype,"lineVerticalPlaneEnabled",void 0),r.__decorate([s.parameter()],t.prototype,"intersectsLineEnabled",void 0),r.__decorate([s.parameter()],t.prototype,"contrastControlEnabled",void 0),t}(s.ShaderTechniqueConfiguration);t.LaserlineTechniqueConfiguration=h}).apply(null,r))||(e.exports=i)},fXZm:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("PHan"),n("0LE5"),n("JjCO"),n("4p4v")],void 0===(i=(function(e,t,n,r,i,a){function o(e){return e?{ray:a.create(e.ray),c0:e.c0,c1:e.c1}:{ray:a.create(),c0:0,c1:Number.MAX_VALUE}}function s(e,t,n,r){return void 0===r&&(r=o()),a.copy(e,r.ray),r.c0=t,r.c1=n,r}function l(e,t,n){void 0===n&&(n=o());var i=r.vec3.length(e.vector);return a.fromValues(e.origin,t,n.ray),n.c0=0,n.c1=i,n}function c(e,t,n){return r.vec3.add(n,e.ray.origin,r.vec3.scale(n,e.ray.direction,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.create=o,t.wrap=function(e,t,n){var r=u.get();return r.ray=e,r.c0=t,r.c1=n,r},t.copy=function(e,t){return void 0===t&&(t=o()),s(e.ray,e.c0,e.c1,t)},t.fromValues=s,t.fromRay=function(e,t){return void 0===t&&(t=o()),a.copy(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t},t.fromLineSegment=function(e,t){return void 0===t&&(t=o()),l(e,r.vec3.normalize(i.sv3d.get(),e.vector),t)},t.fromLineSegmentAndDirection=l,t.getStart=function(e,t){return c(e,e.c0,t)},t.getEnd=function(e,t){return c(e,e.c1,t)},t.getAt=c;var u=new n.ObjectStack((function(){return{c0:0,c1:0,ray:null}}))}).apply(null,r))||(e.exports=i)},fese:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("0LE5"),n("Rdxj"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,a,o){function s(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");var r=o.glsl(l||(l=n.__makeTemplateObject(["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel = pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot = dot(slicePlaneBasis1, rel);\n        float basis2Dot = dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front < 0.0\n          && factors.side0 < 0.0\n          && factors.side1 < 0.0\n          && factors.side2 < 0.0\n          && factors.side3 < 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "],["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel = pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot = dot(slicePlaneBasis1, rel);\n        float basis2Dot = dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front < 0.0\n          && factors.side0 < 0.0\n          && factors.side1 < 0.0\n          && factors.side2 < 0.0\n          && factors.side3 < 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "]))),i=o.glsl(c||(c=n.__makeTemplateObject(["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors = calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH = 1.0;\n        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor = (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "],["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors = calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH = 1.0;\n        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor = (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "]))),a=t.sliceHighlightDisabled?o.glsl(u||(u=n.__makeTemplateObject(["#define highlightSlice(_color_, _pos_) (_color_)"],["#define highlightSlice(_color_, _pos_) (_color_)"]))):o.glsl(p||(p=n.__makeTemplateObject(["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "],["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "])),i);t.sliceEnabledForVertexPrograms&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(a)}else{var s=o.glsl(d||(d=n.__makeTemplateObject(["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "],["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "])));t.sliceEnabledForVertexPrograms&&e.vertex.code.add(s),e.fragment.code.add(s)}}Object.defineProperty(t,"__esModule",{value:!0}),t.Slice=s,function(e){e.bindUniformsWithOrigin=function(t,n,r){e.bindUniforms(t,n,r.slicePlane,r.origin)},e.bindUniforms=function(e,t,n,o){t.slicePlaneEnabled&&(r.isSome(n)?(o?(i.vec3.subtract(f,n.origin,o),e.setUniform3fv("slicePlaneOrigin",f)):e.setUniform3fv("slicePlaneOrigin",n.origin),e.setUniform3fv("slicePlaneBasis1",n.basis1),e.setUniform3fv("slicePlaneBasis2",n.basis2)):(e.setUniform3fv("slicePlaneBasis1",a.vec3f64.ZEROS),e.setUniform3fv("slicePlaneBasis2",a.vec3f64.ZEROS),e.setUniform3fv("slicePlaneOrigin",a.vec3f64.ZEROS)))}}(s=t.Slice||(t.Slice={}));var l,c,u,p,d,f=a.vec3f64.create()}).apply(null,r))||(e.exports=i)},"ff/U":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D={position:0,normal:1,uv0:2,color:3,size:4,tangent:4,auxpos1:5,symbolColor:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,instanceColor:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}).apply(null,r))||(e.exports=i)},gG9S:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("0LE5"),n("Rdxj"),n("DJpR"),n("MzcX"),n("2B1V"),n("raiv")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=i.vec3f64.create(),this._dirty=!1,this._count=0,this._vao=null}return Object.defineProperty(e.prototype,"vertices",{set:function(e){for(var t=new Float64Array(3*e.length),n=0,r=0,i=e;r<i.length;r++){var a=i[r];t[n++]=a[0],t[n++]=a[1],t[n++]=a[2]}this.buffers=[t]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffers",{set:function(e){if(this._buffers=e,this._buffers.length>0){var t=this._buffers[0],n=3*Math.floor(t.length/3/2);r.vec3.set(this._origin,t[n+0],t[n+1],t[n+2])}else r.vec3.set(this._origin,0,0,0);this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!0,configurable:!0}),e.prototype.draw=function(e){var t=this.ensureVAO(e);n.isSome(t)&&(e.bindVAO(t),e.drawArrays(4,0,this._count))},e.prototype.dispose=function(){n.isSome(this._vao)&&this._vao.dispose()},e.prototype.ensureVAO=function(e){return n.isNone(this._buffers)?null:(n.isNone(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)},e.prototype.createVAO=function(e,t){var n=this.createDataBuffer(t);return this._dirty=!1,new a.VertexArrayObject(e,l.LaserlinePathTechnique.attributeLocations,{data:o.glLayout(d)},{data:a.BufferObject.createVertex(e,35044,n)})},e.prototype.ensureVertexData=function(e,t){if(this._dirty){var n=this.createDataBuffer(t);e.vertexBuffers.data.setData(n),this._dirty=!1}},e.prototype.numberOfRenderVertices=function(e){return 2*(e.length/3-1)*3},e.prototype.createDataBuffer=function(e){var t=this,n=e.reduce((function(e,n){return e+t.numberOfRenderVertices(n)}),0);this._count=n;for(var i=d.createBuffer(n),a=this._origin,o=0,s=0,l=0,c=e;l<c.length;l++){for(var f=c[l],h=0;h<f.length;h+=3){var v=r.vec3.set(p,f[h+0],f[h+1],f[h+2]);0===h?s=this._renderCoordsHelper.getAltitude(v):this._renderCoordsHelper.setAltitude(s,v);var m=this._renderCoordsHelper.worldUpAtPosition(v,u),g=o+2*h,y=r.vec3.subtract(p,v,a);if(h<f.length-3){i.up.setVec(g,m),i.up.setVec(g+3,m),i.up.setVec(g+5,m);for(var _=0;_<6;_++)i.start.setVec(g+_,y);i.extrude.setValues(g+0,0,-1),i.extrude.setValues(g+1,1,-1),i.extrude.setValues(g+2,1,1),i.extrude.setValues(g+3,0,-1),i.extrude.setValues(g+4,1,1),i.extrude.setValues(g+5,0,1)}if(h>0)for(i.up.setVec(g-2,m),i.up.setVec(g-4,m),i.up.setVec(g-5,m),_=-6;_<0;_++)i.end.setVec(g+_,y)}o+=this.numberOfRenderVertices(f)}return i.buffer},e}();t.LaserlinePathData=c;var u=i.vec3f64.create(),p=i.vec3f64.create(),d=s.newLayout().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude")}).apply(null,r))||(e.exports=i)},hADE:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("LxLY"),n("rusB"),n("0LE5"),n("Rdxj"),n("3Zlx"),n("HbaO"),n("/9Lg"),n("mmEe"),n("ij3I"),n("AgDx"),n("SNs2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f){function h(e,t,n){for(var r=new Array,i=0,a=e;i<a.length;i++){var o=a[i],s=o.count;if(!(s<=1)){var l=3*o.index,c=l+3*s;r.push({position:t.subarray(l,c),mapPosition:n?n.subarray(l,c):void 0})}}return r}Object.defineProperty(t,"__esModule",{value:!0}),t.createGeometryData=function(e){var t={},o={};!function(e,t,n){for(var r=e.attributeData.position,a=(p=r)[0]===p[(d=p.length)-3]&&p[1]===p[d-2]&&p[2]===p[d-1]&&1===e.removeDuplicateStartEnd,o=r.length/3-(a?1:0),s=new Uint32Array(2*(o-1)),l=a?i.slice(r,0,r.length-3):r,c=0,u=0;u<o-1;u++)s[c++]=u,s[c++]=u+1;var p,d;t[f.RibbonVertexAttributeConstants.POSITION]={size:3,data:l,offsetIdx:0,strideIdx:3},n[f.RibbonVertexAttributeConstants.POSITION]=s}(e,o,t);var s=new Uint32Array(t[f.RibbonVertexAttributeConstants.POSITION].length);return function(e,t,n){var i=e.attributeData.mapPosition;r.isNone(i)||(n.mapPos=n[f.RibbonVertexAttributeConstants.POSITION],t.mapPos={size:3,data:i,offsetIdx:0,strideIdx:3})}(e,o,t),function(e,t,n,i){r.isSome(e.attributeData.colorFeature)||(t[f.RibbonVertexAttributeConstants.COLOR]={size:4,data:r.unwrapOr(e.attributeData.color,l.WHITE_UNIT),offsetIdx:0,strideIdx:4},n[f.RibbonVertexAttributeConstants.COLOR]=i)}(e,o,t,s),function(e,t,n,i){r.isSome(e.attributeData.sizeFeature)||(t[f.RibbonVertexAttributeConstants.SIZE]={size:1,data:new Float32Array([r.unwrapOr(e.attributeData.size,1)]),offsetIdx:0,strideIdx:1},n[f.RibbonVertexAttributeConstants.SIZE]=i)}(e,o,t,s),function(e,t,n,i){var a=e.attributeData.colorFeature;r.isNone(a)||(t[f.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE]={size:1,data:new Float32Array([a]),offsetIdx:0,strideIdx:1},n[f.RibbonVertexAttributeConstants.COLOR]=i)}(e,o,t,s),function(e,t,n,i){var a=e.attributeData.sizeFeature;r.isNone(a)||(t[f.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]={size:1,data:new Float32Array([a]),offsetIdx:0,strideIdx:1},n[f.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]=i)}(e,o,t,s),function(e,t,n,i){var a=e.attributeData.opacityFeature;r.isNone(a)||(t[f.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:new Float32Array([a]),offsetIdx:0,strideIdx:1},n[f.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]=i)}(e,o,t,s),function(e,t,i){if("round"===e.join){var o=t[f.RibbonVertexAttributeConstants.POSITION].data,s=o.length/3,l=new Float32Array(s),c=v,u=m;a.vec3.set(c,0,0,0);for(var p=r.unwrapOr(e.uniformSize,1),d=-1;d<s;++d){var h=d<0?s+d:d,y=(d+1)%s;if(a.vec3.set(u,o[3*y+0]-o[3*h+0],o[3*y+1]-o[3*h+1],o[3*y+2]-o[3*h+2]),a.vec3.normalize(u,u),d>=0){var _=(Math.PI-n.acosClamped(a.vec3.dot(c,u)))*g*1*(1.863798+-2.0062872/Math.pow(1+p/18.2313,.8856294));l[d]=Math.max(Math.floor(_),0)}a.vec3.scale(c,u,-1)}t[f.RibbonVertexAttributeConstants.SUBDIVISIONS]={size:1,data:l,offsetIdx:0,strideIdx:1},i[f.RibbonVertexAttributeConstants.SUBDIVISIONS]=i[f.RibbonVertexAttributeConstants.POSITION]}}(e,o,t),new d.GeometryData(o,t,"line")},t.geometryToRenderInfo=function(e,t,n,r){var i=s.pathsToTriangulationInfo("polygon"===e.type?e.rings:e.paths,e.hasZ,"polygon"===e.type?1:0),a=i.position,o=i.outlines,l=new Float64Array(a.length),u=c.applyPerVertexElevationAlignment(a,e.spatialReference,0,l,0,a,0,a.length/3,t,n,r),p=null!=u;return{lines:p?h(o,a,l):[],projectionSuccess:p,sampledElevation:u}},t.geometryToRenderInfoDraped=function(e,t){for(var n=s.pathsToTriangulationInfo("polygon"===e.type?e.rings:e.paths,!1,"polygon"===e.type?1:0),r=n.position,i=n.outlines,a=u.bufferToBuffer(r,e.spatialReference,0,r,t,0,r.length/3),o=2;o<r.length;o+=3)r[o]=p.DRAPED_Z;return{lines:a?h(i,r):[],projectionSuccess:a}};var v=o.vec3f64.create(),m=o.vec3f64.create(),g=4/Math.PI}).apply(null,r))||(e.exports=i)},hX2R:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("LxLY"),n("DIqE"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("gG9S"),n("/Bau"),n("CIy2"),n("s6rJ"),n("raiv"),n("fUJJ")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v){Object.defineProperty(t,"__esModule",{value:!0});var m=o.vec3f64.create(),g=l.vec4f64.create(),y={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:n.deg2rad(6),globalAlphaContrastBoost:2};function _(e,t,n,r){var i=m,o=g;a.vec3.transformMat4(i,t,r),a.vec3.copy(o,n),o[3]=0,s.vec4.transformMat4(o,o,r),c.plane.fromPositionAndNormal(i,o,e)}var b=function(){function e(e,t,n){void 0===t&&(t={}),void 0===n&&(n={contrastControlEnabled:!1}),this._technique=null,this._projInfo=l.vec4f64.create(),this._zScale=i.vec2f64.create(),this._heightManifoldEnabled=!1,this._heightManifoldTarget=o.vec3f64.create(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=o.vec3f64.create(),this._pointDistanceTarget=o.vec3f64.create(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=c.lineSegment.create(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=c.lineSegment.create(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=o.vec3f64.create(),this._tempDir=o.vec3f64.create(),this._tempUp=o.vec3f64.create(),this._tempVec3A=o.vec3f64.create(),this._tempVec3B=o.vec3f64.create(),this._tempVec4=l.vec4f64.create(),this._tempPlane=c.plane.create(),this._tempSphere=c.sphere.create(),this._renderCoordsHelper=e,this._params=f.copyParameters(t,y),this._config=n}return Object.defineProperty(e.prototype,"renderSlots",{get:function(){return[this._config.contrastControlEnabled?17:16]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsLinearDepth",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heightManifoldEnabled",{get:function(){return this._heightManifoldEnabled},set:function(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heightManifoldTarget",{get:function(){return this._heightManifoldTarget},set:function(e){a.vec3.copy(this._heightManifoldTarget,e),this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointDistanceEnabled",{get:function(){return this._pointDistanceEnabled},set:function(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointDistanceTarget",{get:function(){return this._pointDistanceTarget},set:function(e){a.vec3.copy(this._pointDistanceTarget,e),this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointDistanceOrigin",{get:function(){return this._pointDistanceOrigin},set:function(e){a.vec3.copy(this._pointDistanceOrigin,e),this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineVerticalPlaneEnabled",{get:function(){return this._lineVerticalPlaneEnabled},set:function(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineVerticalPlaneSegment",{get:function(){return this._lineVerticalPlaneSegment},set:function(e){c.lineSegment.copy(e,this._lineVerticalPlaneSegment),this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineEnabled",{get:function(){return this._intersectsLineEnabled},set:function(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineSegment",{get:function(){return this._intersectsLineSegment},set:function(e){c.lineSegment.copy(e,this._intersectsLineSegment),this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineRadius",{get:function(){return this._intersectsLineRadius},set:function(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsLineInfinite",{get:function(){return this._intersectsLineInfinite},set:function(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathVerticalPlaneEnabled",{get:function(){return this._pathVerticalPlaneEnabled},set:function(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,r.isSome(this._pathVerticalPlaneData)&&this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathVerticalPlaneVertices",{set:function(e){r.isNone(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new u.LaserlinePathData(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathVerticalPlaneBuffers",{set:function(e){r.isNone(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new u.LaserlinePathData(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()},enumerable:!0,configurable:!0}),e.prototype.setParameterValues=function(e){f.updateParameters(this._params,e)&&this._requestRender()},e.prototype.initializeRenderContext=function(e){this._initContext=e,this._quadVAO=p.createQuadVAO(e.rctx),this._techniqueRepository=e.shaderTechniqueRep,this._techniqueConfig=new v.LaserlineTechniqueConfiguration,this._pathTechniqueConfig=new h.LaserlinePathTechniqueConfiguration},e.prototype.uninitializeRenderContext=function(){this._quadVAO.dispose(),this._quadVAO=null,r.isSome(this._technique)&&this._techniqueRepository.release(this._technique),r.isSome(this._pathVerticalPlaneData)&&this._pathVerticalPlaneData.dispose(),r.isSome(this._pathTechnique)&&this._techniqueRepository.release(this._pathTechnique)},e.prototype.render=function(e){var t=this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,n=this.pathVerticalPlaneEnabled;if(!t&&!n)return!0;var r=e.camera;return d.inverseProjectionInfo(r.projectionMatrix,r.fullWidth,r.fullHeight,this._projInfo,this._zScale),t&&this.renderUnified(e),n&&this.renderPath(e),!0},e.prototype.renderUnified=function(e){var t=e.rctx,n=this._selectTechnique(),r=n.program;t.bindProgram(r),n.bindPipelineState(t),this.bindGlobalUniforms(e,r),this.bindHeightManifoldUniforms(e,r),this.bindPointDistanceUniforms(e,r),this.bindLineVerticalPlaneUniforms(e,r),this.bindIntersectsLineUniforms(e,r),n.bind(this._params,e.camera),t.bindVAO(this._quadVAO),t.drawArrays(5,0,4)},e.prototype.renderPath=function(e){if(!r.isNone(this._pathVerticalPlaneData)){this._pathTechniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquireAndReleaseExisting(h.LaserlinePathTechnique,this._pathTechniqueConfig,this._pathTechnique);var t=e.rctx,n=this._pathTechnique,i=n.program;t.bindProgram(i),n.bindPipelineState(t),this.bindGlobalUniforms(e,i),n.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx)}},e.prototype.bindHeightManifoldUniforms=function(e,t){if(this.heightManifoldEnabled){var n=this._tempVec3A,r=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,n),_(r,this._heightManifoldTarget,n,e.camera.viewMatrix),t.setUniform4fv("heightPlane",r)}},e.prototype.bindPointDistanceUniforms=function(e,t){if(this._pointDistanceEnabled){var n=e.camera,r=this._tempSphere;a.vec3.copy(r.center,this._pointDistanceOrigin),a.vec3.transformMat4(r.center,r.center,n.viewMatrix),r.radius=a.vec3.distance(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",r.center[0],r.center[1],r.center[2],r.radius)}},e.prototype.bindLineVerticalPlaneUniforms=function(e,t){if(this._lineVerticalPlaneEnabled){var n=this._renderCoordsHelper,r=e.camera,i=this._tempPlane,o=this._tempVec3A,s=this._tempUp,l=this._tempDir,u=this._tempNormal;c.lineSegment.pointAt(this._lineVerticalPlaneSegment,.5,o),n.worldUpAtPosition(o,s),a.vec3.normalize(l,this._lineVerticalPlaneSegment.vector),a.vec3.cross(u,s,l),a.vec3.normalize(u,u),_(i,this._lineVerticalPlaneSegment.origin,u,r.viewMatrix),t.setUniform4fv("lineVerticalPlane",i);var p=this._tempVec3A;a.vec3.copy(p,this._lineVerticalPlaneSegment.origin),n.setAltitude(0,p),a.vec3.transformMat4(p,p,r.viewMatrix),t.setUniform3fv("lineVerticalStart",p);var d=this._tempVec3B;a.vec3.add(d,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),n.setAltitude(0,d),a.vec3.transformMat4(d,d,r.viewMatrix),t.setUniform3fv("lineVerticalEnd",d)}},e.prototype.bindIntersectsLineUniforms=function(e,t){if(this._intersectsLineEnabled){var n=w,r=S;if(this._intersectsLineInfinite){var i=e.camera;if(c.clipRay.fromRay(c.ray.wrap(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),x),x.c0=-Number.MAX_VALUE,!c.frustum.intersectClipRay(i.frustum.planes,x))return;c.clipRay.getStart(x,n),c.clipRay.getEnd(x,r)}else a.vec3.copy(n,this._intersectsLineSegment.origin),a.vec3.add(r,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);var o=this._tempVec3A;a.vec3.transformMat4(o,n,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",o);var l=this._tempVec4;a.vec3.copy(l,this._intersectsLineSegment.vector),this._tempVec4[3]=0,s.vec4.transformMat4(this._tempVec4,this._tempVec4,e.camera.viewMatrix),a.vec3.transformMat4(r,r,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",r),a.vec3.normalize(l,l),t.setUniform3f("intersectsLineDirection",l[0],l[1],l[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}},e.prototype.bindGlobalUniforms=function(e,t){var n=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2f("nearFar",n.near,n.far),this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.setUniform1i("depthMap",0),e.rctx.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,0),t.setUniform1i("frameColor",1),e.rctx.bindTexture(e.offscreenRenderingHelper.mainColorTexture,1)},e.prototype._requestRender=function(){this._initContext&&this._initContext.requestRender()},e.prototype._selectTechnique=function(){return this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.acquireAndReleaseExisting(v.LaserlineTechnique,this._techniqueConfig,this._technique),this._technique},e}();t.LaserLineRenderer=b;var x=c.clipRay.create(),w=o.vec3f64.create(),S=o.vec3f64.create()}).apply(null,r))||(e.exports=i)},hk44:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("6vp1"),n("58az"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,a){var o,s,l,c,u,p;Object.defineProperty(t,"__esModule",{value:!0}),t.Laserline=function(e,t){e.extensions.add("GL_OES_standard_derivatives"),e.include(r.ReadLinearDepth),e.include(i.CameraSpace),e.fragment.uniforms.add("glowColor","vec3"),e.fragment.uniforms.add("glowWidth","float"),e.fragment.uniforms.add("glowFalloff","float"),e.fragment.uniforms.add("innerColor","vec3"),e.fragment.uniforms.add("innerWidth","float"),e.fragment.uniforms.add("depthMap","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&e.fragment.uniforms.add("globalAlphaContrastBoost","float"),e.fragment.code.add(a.glsl(o||(o=n.__makeTemplateObject(["\n  vec4 blendPremultiplied(vec4 source, vec4 dest) {\n    float oneMinusSourceAlpha = 1.0 - source.a;\n\n    return vec4(\n      source.rgb + dest.rgb * oneMinusSourceAlpha,\n      source.a + dest.a * oneMinusSourceAlpha\n    );\n  }\n  "],["\n  vec4 blendPremultiplied(vec4 source, vec4 dest) {\n    float oneMinusSourceAlpha = 1.0 - source.a;\n\n    return vec4(\n      source.rgb + dest.rgb * oneMinusSourceAlpha,\n      source.a + dest.a * oneMinusSourceAlpha\n    );\n  }\n  "])))),e.fragment.code.add(a.glsl(s||(s=n.__makeTemplateObject(["\n  vec4 premultipliedColor(vec3 rgb, float alpha) {\n    return vec4(rgb * alpha, alpha);\n  }\n  "],["\n  vec4 premultipliedColor(vec3 rgb, float alpha) {\n    return vec4(rgb * alpha, alpha);\n  }\n  "])))),e.fragment.code.add(a.glsl(l||(l=n.__makeTemplateObject(["\n  vec4 laserlineProfile(float dist) {\n    if (dist > glowWidth) {\n      return vec4(0.0);\n    }\n\n    float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\n    float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\n\n    return blendPremultiplied(\n      premultipliedColor(innerColor, innerAlpha),\n      premultipliedColor(glowColor, glowAlpha)\n    );\n  }\n  "],["\n  vec4 laserlineProfile(float dist) {\n    if (dist > glowWidth) {\n      return vec4(0.0);\n    }\n\n    float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\n    float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\n\n    return blendPremultiplied(\n      premultipliedColor(innerColor, innerAlpha),\n      premultipliedColor(glowColor, glowAlpha)\n    );\n  }\n  "])))),e.fragment.code.add(a.glsl(c||(c=n.__makeTemplateObject(["\n  bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\n    float depth = linearDepthFromTexture(depthMap, uv, nearFar);\n\n    if (-depth == nearFar[0]) {\n      return false;\n    }\n\n    pos = reconstructPosition(gl_FragCoord.xy, depth);\n    normal = normalize(cross(dFdx(pos), dFdy(pos)));\n\n    float ddepth = fwidth(depth);\n    depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n\n    return true;\n  }\n  "],["\n  bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\n    float depth = linearDepthFromTexture(depthMap, uv, nearFar);\n\n    if (-depth == nearFar[0]) {\n      return false;\n    }\n\n    pos = reconstructPosition(gl_FragCoord.xy, depth);\n    normal = normalize(cross(dFdx(pos), dFdy(pos)));\n\n    float ddepth = fwidth(depth);\n    depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n\n    return true;\n  }\n  "])))),e.fragment.code.add(a.glsl(t.contrastControlEnabled?u||(u=n.__makeTemplateObject(["\n    float rgbToLuminance(vec3 color) {\n      return dot(vec3(0.2126, 0.7152, 0.0722), color);\n    }\n\n    vec4 laserlineOutput(vec4 color) {\n      float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);\n      float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\n\n      return color * alpha;\n    }\n    "],["\n    float rgbToLuminance(vec3 color) {\n      return dot(vec3(0.2126, 0.7152, 0.0722), color);\n    }\n\n    vec4 laserlineOutput(vec4 color) {\n      float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);\n      float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\n\n      return color * alpha;\n    }\n    "])):p||(p=n.__makeTemplateObject(["\n    vec4 laserlineOutput(vec4 color) {\n      return color * globalAlpha;\n    }\n    "],["\n    vec4 laserlineOutput(vec4 color) {\n      return color * globalAlpha;\n    }\n    "]))))}}).apply(null,r))||(e.exports=i)},hkmr:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("1m5D"),n("0LE5"),n("Rdxj"),n("Z4y+"),n("mmEe"),n("ys4y"),n("AgDx"),n("ZO6V"),n("eHCP"),n("ZJC8"),n("CIy2"),n("RC9r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h){var v=0,m=function(){function e(){this.ROOT_ORIGIN_ID="rg_root_"+v++,this._origins=new Map,this._gridSize=42e5}return e.prototype.getOrigin=function(t){var r=this._origins.get(this.ROOT_ORIGIN_ID);if(null==r){if(n.isSome(e.testOrigin)){var a=e.testOrigin;return this._origins.set(this.ROOT_ORIGIN_ID,p.fromValues(a[0],a[1],a[2],this.ROOT_ORIGIN_ID)),this.getOrigin(t)}var o=p.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,o),o}i.vec3.subtract(g,t,r.vec3),g[0]=Math.abs(g[0]),g[1]=Math.abs(g[1]),g[2]=Math.abs(g[2]);var s=this._gridSize;if(g[0]<s&&g[1]<s&&g[2]<s)return r;var l=Math.round(t[0]/s),c=Math.round(t[1]/s),u=Math.round(t[2]/s),d="rg_"+l+"/"+c+"/"+u,f=this._origins.get(d);return f||(f=p.fromValues(l*s,c*s,u*s,d),this._origins.set(d,f)),f},e.prototype._drawOriginBox=function(e){var t=window.view,n=t._stage;if(null==this._object){this._material=new h({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial"),n.add(3,this._material);var i=new u("GridLocalOrigin",{isPickable:!1});n.add(0,i),this._object=new d({idHint:"GridLocalOrigin",castShadow:!1}),n.add(1,this._object),i.addObject(this._object),n.addToViewContent([i.id])}for(var a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=a.length,v=new Float32Array(3*p),m=new Uint32Array(2*(p-1)),g=.5*this._gridSize,y=0;y<p;y++)v[3*y+0]=e[0]+(1&a[y]?g:-g),v[3*y+1]=e[1]+(2&a[y]?g:-g),v[3*y+2]=e[2]+(4&a[y]?g:-g),y>0&&(m[2*y+0]=y-1,m[2*y+1]=y);s.bufferToBuffer(v,o.WebMercator,0,v,t.spatialReference,0,p);var _={};_[f.VertexAttrConstants.POSITION]={size:3,data:v};var b={};b[f.VertexAttrConstants.POSITION]=m;var x=new c.GeometryData(_,b,"line"),w=new l(x,"GridLocalOriginBox");n.add(2,w),this._object.addGeometry(w,this._material,r.mat4f64.IDENTITY),console.log(this._origins.size,e)},e}(),g=a.vec3f64.create();return function(e){e.testOrigin=null}(m||(m={})),m}).apply(null,r))||(e.exports=i)},hs8d:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.AlignPixel=function(e){var t=r.glsl(i||(i=n.__makeTemplateObject(["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "]))),o=r.glsl(a||(a=n.__makeTemplateObject(["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "])));e.vertex.code.add(t),e.vertex.code.add(o),e.fragment.code.add(t),e.fragment.code.add(o)}}).apply(null,r))||(e.exports=i)},i10q:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("LxLY"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("WRgd"),n("2W+Z"),n("/9Lg"),n("fOZq"),n("J2BX"),n("mmEe"),n("JjCO"),n("ys4y"),n("4ziW"),n("yqrJ"),n("CIy2"),n("xFEL")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_){Object.defineProperty(t,"__esModule",{value:!0});var b=function(){function e(e){var t=this;this.view=null,this._geometry=null,this._size=3,this._color=s.vec4f64.fromValues(1,0,1,1),this._primitive="square",this._outlineSize=1,this._outlineColor=s.vec4f64.fromValues(1,1,1,1),this._elevationInfo=null,this.resources=new c.VisualElementResources({view:e.view,createResources:function(e){return t.createResources(e)},recreateGeometry:function(e,n){return e.geometry=t.recreateGeometry(n,e.material),r.isSome(e.geometry)?[e.geometry]:[]}});var n=!0;for(var i in e)i in this?"attached"===i?n=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=n}return e.prototype.destroy=function(){this.resources.destroy()},Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached},set:function(e){this.resources.attached=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){if(e!==this._size){var t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?r.isSome(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){o.vec4.exactEquals(e,this._color)||(o.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primitive",{get:function(){return this._primitive},set:function(e){this._primitive!==e&&(this._primitive=e,r.isSome(this.resources)&&this.resources.recreate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineSize",{get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(e){o.vec4.exactEquals(e,this._outlineColor)||(o.vec4.copy(this._outlineColor,e),this.updateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()},enumerable:!0,configurable:!0}),e.prototype.updateMaterial=function(){var e=this.resources.resources;r.isNone(e)||e.material.setParameterValues(this.materialParameters(e.texture.id))},e.prototype.updateSizeAttribute=function(){var e=this.resources.resources,t=this.resources.object;if(!r.isNone(e)&&!r.isNone(t)){var n=e.geometry;if(!r.isNone(n)){var i=n.data.getVertexAttr()[y.VertexAttrConstants.SIZE].data,a=this.geometrySize;i[0]=a,i[1]=a,t.geometryVertexAttrsUpdated(0)}}},e.prototype.materialParameters=function(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:w,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1}},Object.defineProperty(e.prototype,"geometrySize",{get:function(){return this._size/x},enumerable:!0,configurable:!0}),e.prototype.recreateGeometry=function(e,t){var n=this.createRenderGeometry();return r.isSome(n)&&e.addGeometry(n,t),n},e.prototype.createResources=function(e){var t=this.createTexture(),n=new _.default(this.materialParameters(t.id),"pointVisualElement");n.renderOccluded=8;var i=this.recreateGeometry(e,n);return{material:n,texture:t,geometry:i,forEach:function(e){e(t),e(n),r.isSome(this.geometry)&&e(this.geometry)}}},Object.defineProperty(e.prototype,"preferredTextureSize",{get:function(){return n.clamp(n.nextHighestPowerOfTwo(2*this.geometrySize),16,128)},enumerable:!0,configurable:!0}),e.prototype.createTexture=function(){var e=this.preferredTextureSize;return new g(d.createType(this._primitive,e,e*x),"pointVisualElement",{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})},e.prototype.calculateMapBounds=function(e){if(r.isNone(this.resources.resources)||r.isNone(this.resources.resources.geometry))return!1;var t=this.resources.resources.geometry.data.getAttribute("position");return f.vectorToVector(t.data,this.view.renderCoordsHelper.spatialReference,S,this.view.spatialReference),l.expandWithBuffer(e,S),!0},e.prototype.createRenderGeometry=function(){var e=this.geometry;if(r.isNone(e))return null;var t=this.view.renderCoordsHelper,n=u.evaluateElevationAlignmentAtPoint(e,this.view.elevationProvider,p.ElevationContext.fromElevationInfo(this.elevationInfo),t),a=i.vec3.set(h.sv3d.get(),e.x,e.y,n),o=h.sv3d.get();f.vectorToVector(a,e.spatialReference,o,t.spatialReference);var s=this.geometrySize,l=m.createPointGeometry(null,o,null,[s,s],[0,0,0,1]);return new v(l)},e}();t.PointVisualElement=b;var x=.5,w=[x/2,x/2,1-x/2,1-x/2],S=a.vec3f64.create()}).apply(null,r))||(e.exports=i)},ij3I:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("Gtr7"),n("eIBl"),n("qsST"),n("R2Zq"),n("LxLY"),n("KBgh"),n("ULaq"),n("8MXS"),n("Vx27"),n("FXVB"),n("Rdxj"),n("Dk48"),n("GDWR"),n("y68M"),n("KRuQ"),n("RsYQ"),n("FU3N"),n("/Bau"),n("hkmr"),n("9DjX"),n("Raj5"),n("FLCf"),n("Px2u"),n("XcBT"),n("qUb7"),n("QDiq"),n("FbvD"),n("/f24"),n("Zp3t"),n("Kfys")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x,w,S,O,P,M,C,A,D,T,R,j){Object.defineProperty(t,"__esModule",{value:!0});var E=a.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer"),I=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._hasHighlights=!1,t._rendersOccluded=!1,t._hasWater=!1,t._lighting=new A.SceneLighting,t._localOrigins=new x,t._handles=new i,t._layerRenderers=new Map,t._sortedLayerRenderersDirty=!1,t._sortedLayerRenderers=new l,t._stats=new O.RenderStatsAggregator,t._geometries=new Map,t._renderTargets={},t._uniqueIdx=0,t.longitudeCyclical=null,t}return n.__extends(r,e),r.prototype.initialize=function(){var e=this;this._rctx=this.renderView.renderingContext,this._renderContext=new S(this._rctx,null,null,null,null,null),this._stippleTextureRepository=new D.StippleTextureRepository,this.waterTextureRepository=this.renderView.waterTextureRepository,this._shaderTechniqueRepository=new m.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:1,commonUniformStore:new v.CommonUniformStore,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),u.init(this.waterTextureRepository,"loadingState",(function(){return e.emitContentChanged()})),this._materialRepository=new _(this.renderView.textureRepository,this._shaderTechniqueRepository),this._materialRepository.onMaterialChanged=function(n){(n.renderOccluded&t.overlayRenderOccludedFlag)>0!==e._rendersOccluded&&e.updateRendersOccluded(),e.emitContentChanged(),e.notifyChange("updating")},this._compositingHelper=this.renderView.compositingHelper,this._bindParameters={slot:null,fovY:0,highlightDepthTexture:b.createEmptyDepthTexture(this._rctx),nearFar:[L.near,L.far],origin:null,pixelRatio:null,proj:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,view:null,viewInvTransp:null,viewport:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrViewMat:null,rpProjectionMat:null,ssrEnabled:!1},this._lighting.set({lights:[new C.AmbientLight(f.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})},r.prototype.dispose=function(){for(var e in this._handles.destroy(),this._layerRenderers.forEach((function(e){return e.dispose()})),this._layerRenderers.clear(),this._renderTargets)this._renderTargets[e].dispose();this._renderTargets=null,this._bindParameters.highlightDepthTexture.dispose(),this._bindParameters.highlightDepthTexture=null,this._shaderTechniqueRepository.dispose(),this._shaderTechniqueRepository=null},r.prototype.disposeRenderTarget=function(e){var t=this._renderTargets[e];t&&t.dispose(),delete this._renderTargets[e]},Object.defineProperty(r.prototype,"updating",{get:function(){return this._sortedLayerRenderersDirty||o.someMap(this._layerRenderers,(function(e){return e.updating}))||this.waterTextureRepository.updating},enumerable:!0,configurable:!0}),r.prototype.commitChanges=function(){var e=this,t=!1;this._layerRenderers.forEach((function(n,r){n.commitChanges()&&(t=!0),n.isEmpty&&(e._layerRenderers.delete(r),e._sortedLayerRenderersDirty=!0,e._handles.remove(r))})),this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),t=!0),this.notifyChange("updating"),t&&(this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())},r.prototype.getRenderTargetTexture=function(e){var t=this._renderTargets[e];return t?t.colorTexture:null},r.prototype.addGeometries=function(e,t,n){for(var r=0,i=e;r<i.length;r++){var a=i[r];null==a.origin&&(a.origin=this._localOrigins.getOrigin(a.center)),a.uniqueName||(a.uniqueName="ov:"+this._uniqueIdx++),this._geometries.set(a.uniqueName,a)}this.ensureLayerRenderer(t).add(e),2===n&&this.notifyGraphicUpdate(e,t,2)},r.prototype.removeGeometries=function(e,t,n){for(var r=0,i=e;r<i.length;r++)this._geometries.delete(i[r].uniqueName);var a=this._layerRenderers.get(t);a?(a.remove(e),2===n&&this.notifyGraphicUpdate(e,t,2)):E.warn("Attempted to remove geometry for nonexistent layer")},r.prototype.updateGeometries=function(e,t,n){var r=this._layerRenderers.get(t);r?(r.modify(e,n),this.notifyUpdateGeometries(e,t,n)):E.warn("Attempted to update geometry for nonexistent layer")},r.prototype.notifyUpdateGeometries=function(e,t,n){this.notifyGraphicUpdate(e,t,4===n||2===n?2:1===n?1:0)},r.prototype.notifyGraphicUpdate=function(e,t,n){if(0!==n)for(var r=-1,i=0,a=e;i<a.length;i++){var o=a[i].data.graphicUid;o!==r&&(t.notifyGraphicUpdate(o,n),r=o)}},r.prototype.updateHighlights=function(e,t){var n=this._layerRenderers.get(t);n?n.modify(e,8):E.warn("Attempted to update highlights for nonexistent layer")},r.prototype.isEmpty=function(){return 0===this._geometries.size&&!h.OVERLAY_DRAW_DEBUG_TEXTURE},Object.defineProperty(r.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rendersOccluded",{get:function(){return this._rendersOccluded},enumerable:!0,configurable:!0}),r.prototype.updateLogic=function(e){var t=!1;return this._layerRenderers.forEach((function(n){n.updateLogic(e)&&(t=!0)})),t},r.prototype.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0},r.prototype.draw=function(e,t){return this.drawPass(0,e,t)},r.prototype.drawWithoutRasterImage=function(e,t){return this.drawPass(0,e,t,2)},r.prototype.drawNormals=function(e,t){return this.drawPass(2,e,t)},r.prototype.drawHighlights=function(e,t){return this.drawPass(4,e,t)},r.prototype.drawOccluded=function(e,t){return this.drawPass(0,e,t,1)},r.prototype.drawPass=function(e,n,r,i){var a=this;if(void 0===i&&(i=0),0===r.numViews)return!1;if(this._pixelRatio=r.pixelRatio*Math.abs(r.views[0].extent[2]-r.views[0].extent[0])/Math.abs(r.views[0].viewport[2]-r.views[0].viewport[0]),this.isEmpty()||4===e&&!this.hasHighlights||2===e&&!this.hasWater)return!1;if(!this.hasNonZeroSizedView(r))return!1;var o=r.width,l=r.height,c=this._renderTargets[n];if(!c)return!1;c.resize(o,l);var u=this._rctx,p=L;if(p.pixelRatio=r.pixelRatio||1,this._renderContext.pass=e,this._bindParameters.pixelRatio=p.pixelRatio,u.bindFramebuffer(c),u.setClearColor(0,0,0,0),u.clearSafe(16384),this.updateLightingUniforms(),1===i&&(this._renderContext.renderOccludedMask=t.overlayRenderOccludedFlag),h.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==i)for(var d=0;d<r.numViews;d++)this.setViewParameters(r.views[d],p),this.drawDebugTexture(o,l,z[r.index%z.length]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forEach((function(t){var n=t.layerView,d=t.renderer;if(2!==i||!s.isSome(n)||0!==n.drapeSourceType){var f=s.isSome(n)&&s.isSome(n.fullOpacity)&&n.fullOpacity<1&&0===e;f&&(a.bindTemporaryFramebuffer(o,l),u.clearSafe(16384));for(var h=0;h<r.numViews;h++)a.setViewParameters(r.views[h],p),d.draw(a._renderContext,a._bindParameters,a._stats);f&&(u.bindFramebuffer(c),a._compositingHelper.composite(a.temporaryTexture,2,s.unwrap(s.unwrap(n).fullOpacity)))}})),u.bindFramebuffer(null),c.colorTexture.descriptor.hasMipmap&&c.colorTexture.generateMipmap(),this._renderContext.resetRenderOccludedMask(),!0},r.prototype.createRenderTarget=function(e,t){for(var n=e,r=0;this._renderTargets[n];)n=e+"_"+ ++r;return this._renderTargets[n]=new T(this._rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0}),n},r.prototype.disposeRenderTargetMemory=function(e){var t=this._renderTargets[e];t&&t.resize(0,0)},r.prototype.bindTemporaryFramebuffer=function(e,t){s.isNone(this._temporaryRenderTargetId)&&(this._temporaryRenderTargetId=this.createRenderTarget("temp",!1));var n=this._renderTargets[this._temporaryRenderTargetId];n.resize(e,t),this._rctx.bindFramebuffer(n)},Object.defineProperty(r.prototype,"temporaryTexture",{get:function(){return this._renderTargets[s.unwrap(this._temporaryRenderTargetId)].colorTexture},enumerable:!0,configurable:!0}),r.prototype.getGpuMemoryUsage=function(){var e=0;for(var t in this._renderTargets)e+=j.getGpuMemoryUsage(this._renderTargets[t]);return e},r.prototype.getStats=function(){return this._stats.getAggregatedStats()},r.prototype.hotReloadShaders=function(){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(e){switch(e.label){case 0:return[4,this._shaderTechniqueRepository.hotReload()];case 1:return e.sent(),[2]}}))}))},r.prototype.intersect=function(e,t,n){var r=this,i=0;this._geometries.forEach((function(a){if(!n||n(a)){r.intersectRenderGeometry(a,t,0,e,i);var o=r.longitudeCyclical;o&&(a.center[0]-a.bsRadius<o.min&&r.intersectRenderGeometry(a,t,o.range,e,i),a.center[0]+a.bsRadius>o.max&&r.intersectRenderGeometry(a,t,-o.range,e,i)),i++}}))},r.prototype.intersectRenderGeometry=function(e,t,n,r,i){var a=this,o=0;s.isSome(e.transformation)&&(n+=e.transformation[12],o=e.transformation[13]),N[0]=t[0]-n,N[1]=t[1]-o,N[2]=1,F[0]=t[0]-n,F[1]=t[1]-o,F[2]=0,e.pixelRatio=this._pixelRatio,e.material.intersect(e,null,e.getShaderTransformation(),r,N,F,(function(t,n,o){a.addIntersectionResult(o,e.material.renderPriority,i,r,e.data.layerUid,e.data.graphicUid)}),e.calculateShaderTransformation,!0)},r.prototype.addIntersectionResult=function(e,t,n,r,i,a){var o={type:"external",metadata:{layerUid:i,graphicUid:a}},s=function(i){i.set(o,null,r.results.ground.dist,r.results.ground.normal,r.results.ground.transformation,t,null,null,e,n),i.intersector="OverlayRenderer"};if((null==r.results.min.drapedLayerOrder||t>=r.results.min.drapedLayerOrder)&&(null==r.results.min.dist||r.results.ground.dist<=r.results.min.dist)&&s(r.results.min),0!==r.options.store&&(null==r.results.max.drapedLayerOrder||t<r.results.max.drapedLayerOrder)&&(null==r.results.max.dist||r.results.ground.dist>r.results.max.dist)&&s(r.results.max),2===r.options.store){var l=new w.IntersectorResult(r.ray);s(l),r.results.all.push(l)}},r.prototype.stopAnimationsAtTime=function(e){this._sortedLayerRenderers.forEach((function(t){return t.renderer.stopAnimationsAtTime(e)}))},r.prototype.ensureLayerRenderer=function(e){var t=this,n=this._layerRenderers.get(e);return n||(n=new P.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,n),this._sortedLayerRenderersDirty=!0,this._handles.add([e.watch("fullOpacity",(function(){return t.emitContentChanged()})),u.init(n,"updating",(function(){return t.notifyChange("updating")}))],e)),n},r.prototype.updateSortedLayerRenderers=function(){var e=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var t=o.firstKeyOfMap(this._layerRenderers).view.allLayerViews,n=c.SetFromValues(o.valuesOfMap(this._layerRenderers));t.forEach((function(t){var r=t,i=e._layerRenderers.get(r);i&&(e._sortedLayerRenderers.push(new V(r,i)),n.delete(i))})),n.forEach((function(t){e._sortedLayerRenderers.push(new V(null,t))}))}},r.prototype.setViewParameters=function(e,t){t.viewport=e.viewport;var n=e.extent;d.mat4.ortho(t.projectionMatrix,0,n[2]-n[0],0,n[3]-n[1],t.near,t.far),d.mat4.identity(t.viewMatrix),d.mat4.translate(t.viewMatrix,t.viewMatrix,[-e.extent[0],-e.extent[1],0]),t.setGLViewport(this._rctx),this._renderContext.camera=t,this._bindParameters.view=t.viewMatrix,this._bindParameters.proj=t.projectionMatrix,this._bindParameters.viewInvTransp=t.viewInverseTransposeMatrix,this._bindParameters.viewport=t.fullViewport,this._shaderTechniqueRepository.getProgramsUsingUniform("proj").forEach((function(e){e.setUniformMatrix4fv("proj",t.projectionMatrix)}))},r.prototype.updateLightingUniforms=function(){var e=this;this._shaderTechniqueRepository.getProgramsUsingUniform("lightingMainDirection").forEach((function(t){e._lighting.setUniforms(t)}))},r.prototype.hasNonZeroSizedView=function(e){for(var t=0;t<e.numViews;t++){var n=e.views[t];if(n.extent[0]!==n.extent[2]&&n.extent[1]!==n.extent[3])return!0}return!1},r.prototype.emitContentChanged=function(){this.onContentChanged&&this.onContentChanged()},r.prototype.updateHasWater=function(){var e=o.someMap(this._layerRenderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e)},r.prototype.updateHasHighlights=function(){var e=o.someMap(this._layerRenderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this._hasHighlights))},r.prototype.updateRendersOccluded=function(){var e=o.someMap(this._layerRenderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.onRendersOccludedChanged&&this.onRendersOccludedChanged(this.rendersOccluded))},r.prototype.drawDebugTexture=function(e,t,n){var r=this._rctx;this.ensureDebugPatternResources(e,t);var i=this._debugPatternProgram;r.bindProgram(i),r.setPipelineState(this._debugPatternPipelineState),i.setUniform4f("color",n[0],n[1],n[2],1),i.setUniform1i("tex",0),r.bindTexture(this._debugPatternTexture,0),r.bindVAO(this._quadVAO),r.drawArrays(5,0,j.vertexCount(this._quadVAO,"geometry"))},r.prototype.ensureDebugPatternResources=function(e,t){if(!this._debugPatternTexture){for(var n=new Uint8Array(e*t*4),r=0,i=0;i<t;i++)for(var a=0;a<e;a++){var o=Math.floor(a/10),s=Math.floor(i/10);o<2||s<2||10*o>e-20||10*s>t-20?(n[r++]=255,n[r++]=255,n[r++]=255,n[r++]=255):(n[r++]=255,n[r++]=255,n[r++]=255,n[r++]=1&o&&1&s?1&a^1&i?0:255:1&o^1&s?0:128)}this._debugPatternTexture=new R(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},n);var l=new M.TextureTechniqueConfiguration;l.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(M.TextureTechnique,l,this._debugTextureTechnique),this._debugPatternProgram=this._debugTextureTechnique.program,this._debugPatternPipelineState=this._debugTextureTechnique.pipeline,this._quadVAO=b.createQuadVAO(this._rctx)}},Object.defineProperty(r.prototype,"test",{get:function(){return{layerRenderers:this._layerRenderers}},enumerable:!0,configurable:!0}),n.__decorate([g.autoDispose()],r.prototype,"_shaderTechniqueRepository",void 0),n.__decorate([g.autoDispose()],r.prototype,"_stippleTextureRepository",void 0),n.__decorate([p.property(),g.autoDispose()],r.prototype,"waterTextureRepository",void 0),n.__decorate([p.property()],r.prototype,"renderView",void 0),n.__decorate([p.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating"]})],r.prototype,"updating",null),n.__decorate([p.subclass("esri.views.3d.terrain.OverlayRenderer")],r)}(g.AutoDisposableMixin(r));t.OverlayRenderer=I;var V=function(e,t){this.layerView=e,this.renderer=t},z=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],L=new y.default;L.near=1,L.far=1e4;var N=f.vec3f64.create(),F=f.vec3f64.create();t.DRAPED_Z=-2,t.overlayRenderOccludedFlag=4}).apply(null,r))||(e.exports=i)},j2SP:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("3gjc")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.vec4f32=n}).apply(null,r))||(e.exports=i)},jl7D:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("cmSR"),n("fese"),n("3kdR"),n("pLfv"),n("cj3m"),n("vGsU"),n("RdU/"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p){var d,f,h,v,m,g,y,_,b;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new p.ShaderBuilder;return t.include(a.Transform,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),0===e.output&&(t.include(o.NormalUtils,e),t.include(r.ForwardLinearDepth,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),t.vertex.code.add(u.glsl(d||(d=n.__makeTemplateObject(["\n      void main(void) {\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "],["\n      void main(void) {\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "])))),t.include(c.WaterDistortion,e),t.include(i.Slice,e),e.receiveShadows&&t.include(s.ReadShadowMap,e),t.include(l.Water,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.code.add(u.glsl(f||(f=n.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        vec3 l = normalize(-lightingMainDirection);\n        "],["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        vec3 l = normalize(-lightingMainDirection);\n        "])))),t.fragment.code.add(u.glsl(e.receiveShadows?h||(h=n.__makeTemplateObject(["\n        float shadow = 1.0 - readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow = 1.0 - readShadowMap(vpos, linearDepth);\n      "])):v||(v=n.__makeTemplateObject(["\n        float shadow = 1.0;\n      "],["\n        float shadow = 1.0;\n      "])))),t.fragment.code.add(u.glsl(m||(m=n.__makeTemplateObject(["\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "]))))),2===e.output&&(t.include(o.NormalUtils,e),t.include(c.WaterDistortion,e),t.include(i.Slice,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(u.glsl(g||(g=n.__makeTemplateObject(["\n        void main(void) {\n          vuv = uv0;\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vuv = uv0;\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])))),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(u.glsl(y||(y=n.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "]))))),5===e.output&&(t.include(o.NormalUtils,e),t.varyings.add("vpos","vec3"),t.vertex.code.add(u.glsl(_||(_=n.__makeTemplateObject(["\n        void main(void) {\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])))),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(u.glsl(b||(b=n.__makeTemplateObject(["\n        void main() {\n          gl_FragColor = waterColor;\n        }\n    "],["\n        void main() {\n          gl_FragColor = waterColor;\n        }\n    "]))))),t}}).apply(null,r))||(e.exports=i)},juLw:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a,o;Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyticalSkyModel=function(e){var t=e.fragment.code;t.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "])))),t.add(r.glsl(a||(a=n.__makeTemplateObject(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "],["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "])))),t.add(r.glsl(o||(o=n.__makeTemplateObject(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))}}).apply(null,r))||(e.exports=i)},lBa0:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderTechniqueConfiguration=function(){this.key=0},t.parameter=function(e){return void 0===e&&(e={}),function(t,r){var i=t;i.__configurationParameters=i.__configurationParameters||[],i.__configurationParameters.push(r);var a="_"+r;void 0===i.__configurationParameters__offset&&(i.__configurationParameters__offset=0);var o=i.__configurationParameters__offset,s=Math.ceil(n.log2(e.count||2)),l=(1<<s)-1<<o;if(i.__configurationParameters__offset+=s,i.__configurationParameters__offset>=32)throw new Error("ShaderTechniqueConfiguration is too complex, requiring more than 32 bits to encode.\n      Either the configuration must be simplified, or this restriction must be relaxed.(Currently used: "+i.__configurationParameters__offset+")");Object.defineProperty(i,r,{get:function(){return this[a]},set:function(e){this.key=this.key&~l|e<<o&l,this[a]=e}})}}}).apply(null,r))||(e.exports=i)},lfQW:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.depthCompareLess={func:513},t.depthCompareAlways={func:519},t.stencilWriteMaskOn={mask:255},t.stencilWriteMaskOff={mask:0},t.renderWhenBitIsNotSet=function(e){return{function:{func:517,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7680}}},t.replaceBitWhenDepthTestPasses=function(e){return{function:{func:519,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7681}}},t.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},t.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},t.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},t.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}}).apply(null,r))||(e.exports=i)},mYMs:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("SyoC"),n("KBgh"),n("0LE5"),n("Rdxj"),n("aWgr"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,a,o,s){var l=function(){function e(e,t){this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,this._objectToBoundingSphere=e,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth)),this._root=new c(null,a.vec3f64.fromValues(0,0,0),0)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._degenerateObjects.clear(),this._root=null,c.clearPool(),_[0]=null,P.prune(),R.prune(),j.prune()},e.prototype.add=function(e,t){var n=b(e);this._objectCount+=t=null==t?n.length:t,this._grow(n,t);for(var r=c.acquire(),i=0;i<t;i++){var a=n[i];this._isDegenerate(a)?this._degenerateObjects.add(a):(r.init(this._root),this._add(a,r))}c.release(r)},e.prototype.remove=function(e,t){var n=b(e);this._objectCount-=n.length;for(var r=c.acquire(),i=0,a=n;i<a.length;i++){var o=a[i],s=t||this._boundingSphereFromObject(o,M);this._isValidRadius(s.radius)?(r.init(this._root),this._remove(o,s,r)):this._degenerateObjects.delete(o)}c.release(r),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,n){var r=this,i=o.ray.wrap(e,t);this._forEachNode(this._root,(function(e){if(!r._intersectsNode(i,e))return!1;var t=e.node;return t.terminals.forEach((function(e){r._intersectsObject(i,e)&&n(e)})),null!==t.residents&&t.residents.forEach((function(e){r._intersectsObject(i,e)&&n(e)})),!0}))},e.prototype.forEachAlongRayWithVerticalOffset=function(e,t,n,r){var i=this,a=o.ray.wrap(e,t);this._forEachNode(this._root,(function(e){if(!i._intersectsNodeWithOffset(a,e,r))return!1;var t=e.node;return t.terminals.forEach((function(e){i._intersectsObjectWithOffset(a,e,r)&&n(e)})),null!==t.residents&&t.residents.forEach((function(e){i._intersectsObjectWithOffset(a,e,r)&&n(e)})),!0}))},e.prototype.forEach=function(e){this._forEachNode(this._root,(function(t){var n=t.node;return n.terminals.forEach(e),null!==n.residents&&n.residents.forEach(e),!0})),this._degenerateObjects.forEach(e)},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,n,r,i){return this._findClosest(e,"front-to-back"===t?1:-1,n,r,i)},e.prototype.forEachInDepthRange=function(e,t,n,r,i,a,o,s){this._forEachInDepthRange(e,t,"front-to-back"===n?1:-1,r,i,a,o,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,(function(t){return e(t.node,t.center,2*t.halfSize)}))},e.prototype._intersectsNode=function(e,t){return d(t.center,2*-t.halfSize,S),d(t.center,2*t.halfSize,O),s.rayBoxTest(e.origin,e.direction,S,O)},e.prototype._intersectsNodeWithOffset=function(e,t,n){return d(t.center,2*-t.halfSize,S),d(t.center,2*t.halfSize,O),n.applyToMinMax(S,O),s.rayBoxTest(e.origin,e.direction,S,O)},e.prototype._intersectsObject=function(e,t){var n=this._objectToBoundingSphere.getRadius(t);return!(n>0)||o.sphere.intersectsRay(o.sphere.wrap(n,this._objectToBoundingSphere.getCenter(t)),e)},e.prototype._intersectsObjectWithOffset=function(e,t,n){var r=this._objectToBoundingSphere.getRadius(t);return!(r>0)||o.sphere.intersectsRay(n.applyToBoundingSphere(r,this._objectToBoundingSphere.getCenter(t)),e)},e.prototype._forEachNode=function(e,t){for(var n=c.acquire().init(e),r=[n];0!==r.length;){if(t(n=r.pop())&&!n.isLeaf())for(var i=0;i<n.node.children.length;i++)n.node.children[i]&&r.push(c.acquire().init(n).advance(i));c.release(n)}},e.prototype._forEachNodeDepthOrdered=function(e,t,n,r){void 0===r&&(r=1);var i=c.acquire().init(e),a=[i];for(function(e,t,n){if(!R.length)for(var r=0;r<8;++r)R.push({index:0,distance:0});for(r=0;r<8;++r){var i=m[r];R.data[r].index=r,R.data[r].distance=v(e,t,i)}for(R.sort((function(e,t){return e.distance-t.distance})),n.clear(),r=0;r<8;++r)n.push(R.data[r].index)}(n,r,j);0!==a.length;){if(t(i=a.pop())&&!i.isLeaf())for(var o=7;o>=0;--o){var s=j.data[o];s>=i.node.children.length||i.node.children[s]&&a.push(c.acquire().init(i).advance(s))}c.release(i)}},e.prototype._findClosest=function(e,t,n,r,a){var o=this,s=1/0,l=1/0,c=null,u=h(e,t),p=0,d=function(i){if(++p,!r||r(i)){var a=o._objectToBoundingSphere.getCenter(i),u=o._objectToBoundingSphere.getRadius(i);if(!n||!f(a,u,n)){var d=v(e,t,a),h=d-u;h<s&&(s=h,l=d+u,c=i)}}};return this._forEachNodeDepthOrdered(this._root,(function(r){if(null!=a&&p>=a)return!1;if(n&&f(r.center,r.halfSize*y,n))return!1;if(i.vec3.scale(w,u,r.halfSize),i.vec3.add(w,w,r.center),v(e,t,w)>l)return!1;var o=r.node;return o.terminals.forEach((function(e){d(e)})),null!==o.residents&&o.residents.forEach((function(e){d(e)})),!0}),e,t),c},e.prototype._forEachInDepthRange=function(e,t,n,r,a,o,s,l){var c=this,u=-1/0,p=1/0,d={setRange:function(e){1===n?(u=Math.max(u,e.near),p=Math.min(p,e.far)):(u=Math.max(u,-e.far),p=Math.min(p,-e.near))}};d.setRange(r);var m=v(t,n,e),g=h(t,n),_=h(t,-1*n),b=0,x=function(e){if(++b,!s||s(e)){var r=c._objectToBoundingSphere.getCenter(e),i=c._objectToBoundingSphere.getRadius(e),l=v(t,n,r)-m;l-i>p||l+i<u||o&&f(r,i,o)||a(e,d)}};this._forEachNodeDepthOrdered(this._root,(function(e){if(null!=l&&b>=l)return!1;if(o&&f(e.center,e.halfSize*y,o))return!1;if(i.vec3.scale(w,g,e.halfSize),i.vec3.add(w,w,e.center),v(t,n,w)-m>p)return!1;if(i.vec3.scale(w,_,e.halfSize),i.vec3.add(w,w,e.center),v(t,n,w)-m<u)return!1;var r=e.node;return r.terminals.forEach((function(e){x(e)})),null!==r.residents&&r.residents.forEach((function(e){x(e)})),!0}),t,n)},e.prototype._remove=function(e,t,n){P.clear();var r=n.advanceTo(t,(function(e,t){P.push(e.node),P.push(t)}))?n.node.terminals:n.node.residents;if(r.removeUnordered(e),0===r.length)for(var i=P.length-2;i>=0&&this._purge(P.data[i],P.data[i+1]);i-=2);},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new r({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,M))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var n=0;n<t.length;n++){var r=c.acquire().init(e);this._add(t.data[n],r),c.release(r)}},e.prototype._grow=function(e,t){var n=this;if(0!==t){var r=this._boundingSphereFromObjects(e,t,(function(e,t){return n._boundingSphereFromObject(e,t)}),C);if(this._isValidRadius(r.radius)&&!this._fitsInsideTree(r))if(this._nodeIsEmpty(this._root.node))i.vec3.copy(this._root.center,r.center),this._root.halfSize=1.25*r.radius;else{var a=c.acquire();this._rootBoundsForRootAsSubNode(r,a),this._placingRootViolatesMaxDepth(a)?this._rebuildTree(r,a):this._growRootAsSubNode(a),c.release(a)}}},e.prototype._rebuildTree=function(e,t){var n=this;i.vec3.copy(A.center,t.center),A.radius=t.halfSize;var r=this._boundingSphereFromObjects([e,A],2,(function(e){return e}),D),a=c.acquire().init(this._root);this._root.initFrom(null,r.center,1.25*r.radius),this._forEachNode(a,(function(e){return n.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&n.add(e.node.residents.data,e.node.residents.length),!0})),c.release(a)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,(function(e){return t=Math.max(t,e.depth),!0})),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var n=e.radius,r=e.center,i=-1/0,a=this._root.center,o=this._root.halfSize,s=0;s<3;s++){var l=r[s]+n-(a[s]+o),c=Math.max(0,Math.ceil((a[s]-o-(r[s]-n))/(2*o))),u=Math.max(0,Math.ceil(l/(2*o)))+1,p=Math.pow(2,Math.ceil(Math.log(c+u)*Math.LOG2E));i=Math.max(i,p),T[s].min=c,T[s].max=u}for(s=0;s<3;s++){var d=(i-((c=T[s].min)+(u=T[s].max)))/2;c+=Math.ceil(d),u+=Math.floor(d),x[s]=a[s]-o-c*o*2+(u+c)*o}return t.initFrom(null,x,i*o,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;i.vec3.copy(C.center,this._root.center),C.radius=this._root.halfSize,this._root.init(e),e.advanceTo(C,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,n=0,r=0;r<t.length&&null==e;)e=t[n=r++];for(;r<t.length;)if(t[r++])return-1;return n},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,n=this._root.halfSize,r=e.center;return e.radius<=n&&r[0]>=t[0]-n&&r[0]<=t[0]+n&&r[1]>=t[1]-n&&r[1]<=t[1]+n&&r[2]>=t[2]-n&&r[2]<=t[2]+n},e.prototype._boundingSphereFromObject=function(e,t){return i.vec3.copy(t.center,this._objectToBoundingSphere.getCenter(e)),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,n,r){if(1===t){var a=n(e[0],C);i.vec3.copy(r.center,a.center),r.radius=a.radius}else{S[0]=1/0,S[1]=1/0,S[2]=1/0,O[0]=-1/0,O[1]=-1/0,O[2]=-1/0;for(var o=0;o<t;o++)a=n(e[o],C),this._isValidRadius(a.radius)&&(u(S,a.center,a.radius),p(O,a.center,a.radius));i.vec3.lerp(r.center,S,O,.5),r.radius=Math.max(O[0]-S[0],O[1]-S[1],O[2]-S[2])/2}return r},e}(),c=function(){function e(e,t,n){void 0===n&&(n=0),this.center=a.vec3f64.create(),this.initFrom(e,t,n,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,n,r,a){return void 0===t&&(t=null),void 0===r&&(r=this.halfSize),void 0===a&&(a=this.depth),this.node=t||e.createEmptyNode(),n&&i.vec3.copy(this.center,n),this.halfSize=r,this.depth=a,this},e.prototype.advance=function(t){var n=this.node.children[t];n||(n=e.createEmptyNode(),this.node.children[t]=n),this.node=n,this.halfSize/=2,this.depth++;var r=m[t];return this.center[0]+=r[0]*this.halfSize,this.center[1]+=r[1]*this.halfSize,this.center[2]+=r[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,n){for(void 0===n&&(n=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!n)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var r=this._childIndex(e);t&&t(this,r),this.advance(r)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,n=this.center,r=0,i=0;i<3;i++)n[i]<t[i]&&(r|=1<<i);return r},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new r({shrink:!0}),residents:new r({shrink:!0})}},e.acquire=function(){return e._pool.acquire()},e.release=function(t){e._pool.release(t)},e.clearPool=function(){e._pool.prune()},e._pool=new n(e),e}();function u(e,t,n){e[0]=Math.min(e[0],t[0]-n),e[1]=Math.min(e[1],t[1]-n),e[2]=Math.min(e[2],t[2]-n)}function p(e,t,n){e[0]=Math.max(e[0],t[0]+n),e[1]=Math.max(e[1],t[1]+n),e[2]=Math.max(e[2],t[2]+n)}function d(e,t,n){return(n=n||e)[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n}function f(e,t,n){return!o.frustum.intersectsSphere(n.planes,o.sphere.wrap(t,e))}function h(e,t){for(var n=1/0,r=null,i=0;i<8;++i){var a=v(e,t,g[i]);a<n&&(n=a,r=g[i])}return r}function v(e,t,n){return t*(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])}var m=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(1,1,-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(1,-1,1),a.vec3f64.fromValues(-1,1,1),a.vec3f64.fromValues(1,1,1)],g=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(-1,1,1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(1,-1,1),a.vec3f64.fromValues(1,1,-1),a.vec3f64.fromValues(1,1,1)],y=Math.sqrt(3),_=[null];function b(e){return Array.isArray(e)?e:(_[0]=e,_)}var x=a.vec3f64.create(),w=a.vec3f64.create(),S=a.vec3f64.create(),O=a.vec3f64.create(),P=new r,M={center:a.vec3f64.create(),radius:0},C={center:a.vec3f64.create(),radius:0},A={center:a.vec3f64.create(),radius:0},D={center:a.vec3f64.create(),radius:0},T=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],R=new r,j=new r;return l}).apply(null,r))||(e.exports=i)},naZ0:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,n){e.setUniform3f("camPos",n[3]-t[0],n[7]-t[1],n[11]-t[2])}e.bindUniformsCustomOrigin=t,e.bindUniforms=function(e,n){t(e,n.origin,n.viewInvTransp)}}(t.Camera||(t.Camera={})),function(e){e.bindUniforms=function(e,t){e.setUniform1f("pixelRatio",t.pixelRatio||1),e.setUniform4fv("viewport",t.viewport)}}(t.Viewport||(t.Viewport={}))}).apply(null,r))||(e.exports=i)},ne9J:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("E/g4"),n("7zqm"),n("quQL"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){var c,u,p,d,f,h,v,m,g,y,_,b,x,w,S,O,P,M,C,A,D,T,R,j,E;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new l.ShaderBuilder;t.extensions.add("GL_OES_standard_derivatives"),t.include(o.PiUtils),t.include(i.RibbonVertexPosition,e),t.include(a.LineStipple,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearPlane","float").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3");var I=e.falloffEnabled,V=e.innerColorEnabled;return V&&t.varyings.add("vLineDistance","float"),I&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),t.vertex.code.add(s.glsl(c||(c=n.__makeTemplateObject(["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s = sin(a);\n\t\t\tfloat c = cos(a);\n\t\t\tmat2 m = mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"],["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s = sin(a);\n\t\t\tfloat c = cos(a);\n\t\t\tmat2 m = mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"])))),t.vertex.code.add(s.glsl(u||(u=n.__makeTemplateObject(["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc = proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *= screenSize / posNdc.w;\n      return posNdc;\n    }\n"],["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc = proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *= screenSize / posNdc.w;\n      return posNdc;\n    }\n"])))),t.vertex.code.add(s.glsl(p||(p=n.__makeTemplateObject(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z > -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z < -nearPlane) {\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z < -nearPlane) {\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z > -nearPlane) {\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z > -nearPlane) {\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n"],["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z > -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z < -nearPlane) {\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z < -nearPlane) {\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z > -nearPlane) {\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z > -nearPlane) {\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n"])))),t.vertex.code.add(s.glsl(d||(d=n.__makeTemplateObject(["\n  void main(void) {\n    float coverage = 1.0;\n    vpos = position;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n      bool isJoin = abs(uv0.y)-3.0 < 0.0;\n\n      float lineWidth = getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left = (pos.xy - prev.xy);\n      vec2 right = (next.xy - pos.xy);\n\n      float leftLen = length(left);\n      float rightLen = length(right);\n  "],["\n  void main(void) {\n    float coverage = 1.0;\n    vpos = position;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n      bool isJoin = abs(uv0.y)-3.0 < 0.0;\n\n      float lineWidth = getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left = (pos.xy - prev.xy);\n      vec2 right = (next.xy - pos.xy);\n\n      float leftLen = length(left);\n      float rightLen = length(right);\n  "])))),e.stippleEnabled&&t.vertex.code.add(s.glsl(f||(f=n.__makeTemplateObject(["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos->next, otherwise use prev->pos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection = stippleSegmentInfo.zw;\n    "],["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos->next, otherwise use prev->pos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection = stippleSegmentInfo.zw;\n    "])))),t.vertex.code.add(s.glsl(h||(h=n.__makeTemplateObject(['\n    left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir = vec2(0, 0);\n    vec2 joinDisplacementDir = vec2(0, 0);\n    float displacementLen = lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside = ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir = normalize(left + right);\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen > 0.001 && rightLen > 0.001) {\n        float nDotSeg = dot(joinDisplacementDir, left);\n        displacementLen /= length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside && (displacementLen > miterLimit * lineWidth)) {\n    '],['\n    left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir = vec2(0, 0);\n    vec2 joinDisplacementDir = vec2(0, 0);\n    float displacementLen = lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside = ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir = normalize(left + right);\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen > 0.001 && rightLen > 0.001) {\n        float nDotSeg = dot(joinDisplacementDir, left);\n        displacementLen /= length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside && (displacementLen > miterLimit * lineWidth)) {\n    '])))),t.vertex.code.add(s.glsl(e.roundJoins?v||(v=n.__makeTemplateObject(["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen < 0.001) {\n          startDir = right;\n        }\n        else{\n          startDir = left;\n        }\n        startDir = normalize(startDir);\n        startDir = PERPENDICULAR(startDir);\n\n        if (rightLen < 0.001) {\n          endDir = left;\n        }\n        else{\n          endDir = right;\n        }\n        endDir = normalize(endDir);\n        endDir = PERPENDICULAR(endDir);\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "],["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen < 0.001) {\n          startDir = right;\n        }\n        else{\n          startDir = left;\n        }\n        startDir = normalize(startDir);\n        startDir = PERPENDICULAR(startDir);\n\n        if (rightLen < 0.001) {\n          endDir = left;\n        }\n        else{\n          endDir = right;\n        }\n        endDir = normalize(endDir);\n        endDir = PERPENDICULAR(endDir);\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "])):m||(m=n.__makeTemplateObject(["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen < 0.001) {\n          joinDisplacementDir = right;\n        }\n        else if (rightLen < 0.001) {\n          joinDisplacementDir = left;\n        }\n        else {\n          joinDisplacementDir = isStartVertex ? right : left;\n        }\n        joinDisplacementDir = normalize(joinDisplacementDir);\n        joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n  "],["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen < 0.001) {\n          joinDisplacementDir = right;\n        }\n        else if (rightLen < 0.001) {\n          joinDisplacementDir = left;\n        }\n        else {\n          joinDisplacementDir = isStartVertex ? right : left;\n        }\n        joinDisplacementDir = normalize(joinDisplacementDir);\n        joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n  "])))),t.vertex.code.add(s.glsl(g||(g=n.__makeTemplateObject(["\n        displacementLen = lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen < 0.001) {\n      joinDisplacementDir = right;\n    }\n    else if (rightLen < 0.001) {\n      joinDisplacementDir = left;\n    }\n    else {\n      joinDisplacementDir = isStartVertex ? right : left;\n    }\n    joinDisplacementDir = normalize(joinDisplacementDir);\n    joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n    displacementLen = lineWidth;\n\n    capDisplacementDir = isStartVertex ? -right : left;\n  "],["\n        displacementLen = lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen < 0.001) {\n      joinDisplacementDir = right;\n    }\n    else if (rightLen < 0.001) {\n      joinDisplacementDir = left;\n    }\n    else {\n      joinDisplacementDir = isStartVertex ? right : left;\n    }\n    joinDisplacementDir = normalize(joinDisplacementDir);\n    joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n    displacementLen = lineWidth;\n\n    capDisplacementDir = isStartVertex ? -right : left;\n  "])))),t.vertex.code.add(s.glsl(e.roundCaps?y||(y=n.__makeTemplateObject(["\n    float angle = subdivisionFactor*PI*0.5;\n    joinDisplacementDir *= cos(angle);\n    capDisplacementDir *= sin(angle);\n    "],["\n    float angle = subdivisionFactor*PI*0.5;\n    joinDisplacementDir *= cos(angle);\n    capDisplacementDir *= sin(angle);\n    "])):_||(_=n.__makeTemplateObject(["\n    capDisplacementDir *= subdivisionFactor;\n    "],["\n    capDisplacementDir *= subdivisionFactor;\n    "])))),t.vertex.code.add(s.glsl(S||(S=n.__makeTemplateObject(["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy += dpos;\n  "],["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy += dpos;\n  "])),I||V?s.glsl(b||(b=n.__makeTemplateObject(["float lineDist = lineWidth * sign(uv0.y) * pos.w;"],["float lineDist = lineWidth * sign(uv0.y) * pos.w;"]))):"",V?s.glsl(x||(x=n.__makeTemplateObject(["vLineDistance = lineDist;"],["vLineDistance = lineDist;"]))):"",I?s.glsl(w||(w=n.__makeTemplateObject(["vLineDistanceNorm = lineDist / lineWidth;"],["vLineDistanceNorm = lineDist / lineWidth;"]))):"")),e.stippleEnabled&&(t.vertex.code.add(s.glsl(O||(O=n.__makeTemplateObject(["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec = pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength = length(stippleSegmentDirection);\n    "],["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec = pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength = length(stippleSegmentDirection);\n    "])))),e.stippleIntegerRepeatsEnabled&&t.vertex.code.add(s.glsl(P||(P=n.__makeTemplateObject(["\n      float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats = max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax = roundedNumberOfPatternRepeats;\n      "],["\n      float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats = max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax = roundedNumberOfPatternRepeats;\n      "])))),t.vertex.code.add(s.glsl(M||(M=n.__makeTemplateObject(["\n      if (stippleSegmentDirectionLength >= 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv = 1.0;\n        }\n      }\n    "],["\n      if (stippleSegmentDirectionLength >= 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv = 1.0;\n        }\n      }\n    "])),e.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale = roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale = 1.0;"))),t.vertex.code.add(s.glsl(C||(C=n.__makeTemplateObject(["\n      // Convert back into NDC\n      pos.xy = pos.xy / screenSize * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      gl_Position = pos;\n    }\n  }\n  "],["\n      // Convert back into NDC\n      pos.xy = pos.xy / screenSize * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      gl_Position = pos;\n    }\n  }\n  "])))),t.include(r.Slice,e),0===e.output&&(t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.code.add(s.glsl(A||(A=n.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha = getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      vec4 color = intrinsicColor * vColor;\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha = getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      vec4 color = intrinsicColor * vColor;\n    "])))),e.innerColorEnabled&&(t.fragment.uniforms.add("pixelRatio","float"),t.fragment.code.add(s.glsl(D||(D=n.__makeTemplateObject(["\n      float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n      float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\n      float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\n      color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n      "],["\n      float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n      float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\n      float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\n      color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n      "]))))),t.fragment.code.add(s.glsl(T||(T=n.__makeTemplateObject(["\n      vec4 finalColor = blendStipple(color, stippleAlpha);\n    "],["\n      vec4 finalColor = blendStipple(color, stippleAlpha);\n    "])))),e.falloffEnabled&&t.fragment.code.add(s.glsl(R||(R=n.__makeTemplateObject(["\n      finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n      "],["\n      finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n      "])))),t.fragment.code.add(s.glsl(j||(j=n.__makeTemplateObject(["\n      gl_FragColor = highlightSlice(finalColor, vpos);\n    }\n    "],["\n      gl_FragColor = highlightSlice(finalColor, vpos);\n    }\n    "]))))),4===e.output&&t.fragment.code.add(s.glsl(E||(E=n.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "])))),t}}).apply(null,r))||(e.exports=i)},o5p5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("tUyH"),n("FNtW"),n("LZD4"),n("s6rJ"),n("s6rJ"),n("ZeO9"),n("EiS2")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c){var u=function(e){function t(t,n){var r=e.call(this,n)||this;return r.supportsEdges=!0,r.techniqueConfig=new c.ColorMaterialTechniqueConfiguration,r.params=s.copyParameters(t,d),r}return n.__extends(t,e),t.prototype.setParameterValues=function(e){o.updateParameters(this.params,e)&&this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig},t.prototype.getPassParameters=function(){return this.params},t.prototype.intersect=function(e,t,n,r,i,a,o){s.intersectTriangleGeometry(e,t,r,i,a,void 0,o)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new p(e):void 0},t.prototype.createBufferWriter=function(){return new a.DefaultBufferWriter(a.PositionColorLayout)},t.prototype.createRenderer=function(e,t){return new l(e,t,this)},t}(i.Material),p=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return n.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(c.ColorMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&this._updateOccludeeState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t.prototype.getPipelineState=function(e,t){return t?this.technique.opaqueOccludeeState:this.technique.pipeline},t}(r.GLMaterial),d={color:[1,1,1,1],transparent:!1,writeDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1};return u}).apply(null,r))||(e.exports=i)},oZZu:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("7Yqx")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.mat4f32=n}).apply(null,r))||(e.exports=i)},pLfv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.NormalUtils=function(e,t){e.vertex.code.add(r.glsl(0===t.viewingMode?i||(i=n.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "])):a||(a=n.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "])))),e.vertex.code.add(r.glsl(0===t.viewingMode?o||(o=n.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "])):s||(s=n.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = vec3(1.0, 0.0, 0.0);\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = vec3(1.0, 0.0, 0.0);\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "]))))}}).apply(null,r))||(e.exports=i)},pbva:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("FXVB"),n("1m5D")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Instance=function(e,t,i,a,o,s){this.from=e,this.to=t,this.isVisible=i,this.hasHighlights=a,this.hasOccludees=o,this.transformation=s,null!=s&&(this.transformationNormal=r.mat4f64.clone(s),n.mat4.invert(this.transformationNormal,this.transformationNormal),n.mat4.transpose(this.transformationNormal,this.transformationNormal))},t.sortInstancesAccordingToRange=function(e){return e.sort((function(e,t){return e.from===t.from?e.to>t.to?1:e.to<t.to?-1:0:e.from>t.from?1:e.from<t.from?-1:0}))},t.addOrMerge=function(e,t){var n=function(e){return{first:e.from,count:e.to-e.from}};if(0!==e.length){var r,i=e[e.length-1];(r=i).first+r.count>=t.from?i.count=t.from-i.first+t.to-t.from:e.push(n(t))}else e.push(n(t))}}).apply(null,r))||(e.exports=i)},piY7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("juLw"),n("quQL"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,a){var o,s,l,c,u,p,d,f,h,v,m;Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicallyBasedRendering=function(e,t){var g=e.fragment.code;e.include(i.PiUtils),3===t.pbrMode||4===t.pbrMode?(g.add(a.glsl(o||(o=n.__makeTemplateObject(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "],["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "])),t.useCustomDTRExponentForWater?"2.2":"2.0")),g.add(a.glsl(s||(s=n.__makeTemplateObject(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "],["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),g.add(a.glsl(l||(l=n.__makeTemplateObject(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "],["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),g.add(a.glsl(c||(c=n.__makeTemplateObject(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "],["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),g.add(a.glsl(u||(u=n.__makeTemplateObject(["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  = 1.2;\n      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "],["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  = 1.2;\n      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))))):1!==t.pbrMode&&2!==t.pbrMode||(e.include(r.AnalyticalSkyModel),g.add(a.glsl(p||(p=n.__makeTemplateObject(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "],["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),g.add(a.glsl(d||(d=n.__makeTemplateObject(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "],["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),g.add(a.glsl(f||(f=n.__makeTemplateObject(["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "],["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),g.add(a.glsl(h||(h=n.__makeTemplateObject(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "],["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),g.add(a.glsl(v||(v=n.__makeTemplateObject(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"],["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"])))),g.add(a.glsl(m||(m=n.__makeTemplateObject(["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "],["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "])))))}}).apply(null,r))||(e.exports=i)},pqGg:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("3kdR"),n("xDGw"),n("uUnu"),n("aRjO"),n("PaEL"),n("3PFg"),n("naZ0"),n("2o+p"),n("W/V4"),n("FQ4r"),n("lBa0"),n("ff/U"),n("VQEQ"),n("VQEQ"),n("G0ER"),n("qbr3"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x){Object.defineProperty(t,"__esModule",{value:!0});var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get(),r=this.configuration,i=n.build({output:r.output,viewingMode:e.viewingMode,occlusionTestEnabled:r.occlusionTestEnabled,signedDistanceFieldEnabled:r.sdf,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:r.debugDrawBorder,binaryHighlightOcclusionEnabled:r.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:r.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!1});return new _(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),m.Default3D)},t.prototype.bindPass=function(e,t,n){this.program.setUniform1f("cameraGroundRelative",n.cameraAboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(n.fovY/2)/(n.viewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",n.viewInvTransp),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),o.VerticalOffset.bindUniforms(this.program,t,n),d.ScreenSizePerspective.bindUniforms(this.program,t),p.Viewport.bindUniforms(this.program,n),6===this.configuration.output?l.HUDOcclusion.bindUniforms(this.program):(s.HUD.bindUniforms(this.program,n),y.HUDMaterial.bindUniforms(this.program,t,n),u.VisualVariables.bindUniforms(this.program,t),this.configuration.occlusionTestEnabled&&s.HUD.bindVisibilityTexture(e,this.program,n)),4===this.configuration.output&&c.OutputHighlight.bindOutputHighlight(e,this.program,n)},t.prototype.bindDraw=function(e){a.Transform.bindUniforms(this.program,e),p.Camera.bindUniforms(this.program,e),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){return x.makePipelineState(4===this.configuration.output?{blending:b.separateBlendingParams(1,1,771,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},colorWrite:x.defaultColorWriteParams}:6===this.configuration.output?{depthTest:{func:515},depthWrite:x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams}:{blending:b.simpleBlendingParams(1,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:this.configuration.depthEnabled?515:519},depthWrite:this.configuration.depthEnabled?x.defaultDepthWriteParams:void 0,colorWrite:x.defaultColorWriteParams})},Object.defineProperty(t.prototype,"primitiveType",{get:function(){return 6===this.configuration.output?0:4},enumerable:!0,configurable:!0}),t.shader=new f.ReloadableShaderModule(g,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("VQEQ")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(h.ShaderTechnique);t.HUDMaterialTechnique=w;var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.occlusionTestEnabled=!0,t.sdf=!1,t.vvSize=!1,t.vvColor=!1,t.verticalOffset=!1,t.screenSizePerspective=!1,t.screenCenterOffsetUnitsEnabled=0,t.debugDrawBorder=!0,t.binaryHighlightOcclusion=!0,t.slicePlaneEnabled=!1,t.polygonOffsetEnabled=!1,t.depthEnabled=!0,t}return r.__extends(t,e),r.__decorate([v.parameter({count:7})],t.prototype,"output",void 0),r.__decorate([v.parameter()],t.prototype,"occlusionTestEnabled",void 0),r.__decorate([v.parameter()],t.prototype,"sdf",void 0),r.__decorate([v.parameter()],t.prototype,"vvSize",void 0),r.__decorate([v.parameter()],t.prototype,"vvColor",void 0),r.__decorate([v.parameter()],t.prototype,"verticalOffset",void 0),r.__decorate([v.parameter()],t.prototype,"screenSizePerspective",void 0),r.__decorate([v.parameter({count:2})],t.prototype,"screenCenterOffsetUnitsEnabled",void 0),r.__decorate([v.parameter()],t.prototype,"debugDrawBorder",void 0),r.__decorate([v.parameter()],t.prototype,"binaryHighlightOcclusion",void 0),r.__decorate([v.parameter()],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([v.parameter()],t.prototype,"polygonOffsetEnabled",void 0),r.__decorate([v.parameter()],t.prototype,"depthEnabled",void 0),t}(v.ShaderTechniqueConfiguration);t.HUDMaterialTechniqueConfiguration=S}).apply(null,r))||(e.exports=i)},pvGl:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("KtQ6"),n("BcWh"),n("eIBl"),n("xoE+"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("woUR"),n("5T2R"),n("B3XD"),n("X5J5"),n("Fe95"),n("48/q"),n("dtql"),n("ys4y"),n("4ziW"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x){Object.defineProperty(t,"__esModule",{value:!0});var w=function(e){function t(t){var n=e.call(this)||this;return n._handles=new a,n._radius=m.DISC_RADIUS,n.events=new i,n._tool=t.tool,n._view=t.view,null!=t.radius&&(n._radius=t.radius),n.createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return n.__extends(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))},t.prototype.forEachManipulator=function(e){e(this._manipulator,0)},t.prototype.createGraphicDragPipeline=function(e,t){var n=this,r=s.unwrap(e.graphic.geometry).spatialReference;return y.createGraphicMoveDragPipeline(e,t,(function(e){return n.createDragPipeline(e,r)}))},t.prototype.createDragPipeline=function(e,t){var n=this._view;return x.createManipulatorDragEventPipeline(this._manipulator,(function(r,i,a,o){var s=i.next(h.screenToZConstrained(n,r.renderLocation,t)).next(x.addScreenDelta());e(r,s,a,o)}))},Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this.updateManipulator())},enumerable:!0,configurable:!0}),t.prototype.updateManipulator=function(){var e=this._radius/m.DISC_RADIUS,t=v.settings.zManipulator.height*e,n=v.settings.zManipulator.coneHeight*e,i=v.settings.zManipulator.coneWidth*e,a=v.settings.zManipulator.width*e,o=[p.vec3f64.fromValues(0,0,0),p.vec3f64.fromValues(0,0,t)],s=new _(b.createTubeGeometry(o,a/2,16,!1),"move-z"),u=b.createConeGeometry(n,i/2,16,!1),d=new _(u),h=[p.vec3f64.fromValues(0,0,0),p.vec3f64.fromValues(0,0,t+n)],g=function(e){var n=c.mat4f64.create();return l.mat4.translate(n,n,[0,0,t]),l.mat4.rotateX(n,n,Math.PI/2),n}(),y=function(e,t){var n=r.darken(v.settings.zManipulator.color,t);return[n.r/255,n.g/255,n.b/255,v.settings.zManipulator.color.a*e]},x=f.createManipulatorMaterial(y(1,.25),1),w=f.createManipulatorMaterial(y(1,0),1),S=f.createManipulatorMaterial(y(.7,0),v.settings.zManipulator.occludedFlag),O=f.createManipulatorMaterial(y(.85,0),v.settings.zManipulator.occludedFlag);this._manipulator.renderObjects=[{geometry:d,transform:g,material:x,stateMask:1},{geometry:s,material:x,stateMask:1},{geometry:d,transform:g,material:w,stateMask:2},{geometry:s,material:w,stateMask:2},{geometry:d,transform:g,material:S,stateMask:1},{geometry:s,material:S,stateMask:1},{geometry:d,transform:g,material:O,stateMask:2},{geometry:s,material:O,stateMask:2}],this._manipulator.radius=a/2+2,this._manipulator.collisionType={type:"line",paths:[h]}},t.prototype.createManipulator=function(){var e=this,t=new d.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var n=e._view.state.camera,r=S;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,r);var i=u.vec3.dist(n.eye,r),a=n.computeRenderPixelSizeAtDist(i),s=u.vec3.subtract(O,r,n.eye);u.vec3.normalize(s,s);var l=P;e._view.renderCoordsHelper.worldUpAtPosition(S,l);var c=Math.abs(u.vec3.dot(s,l)),p=u.vec3.cross(O,s,l),d=u.vec3.cross(O,p,l),f=o.clamp(c,.01,1),h=1-Math.sqrt(1-f*f)/f/n.fullWidth,g=v.settings.zManipulator.width*(e._radius/m.DISC_RADIUS);u.vec3.scale(d,u.vec3.normalize(d,d),(1/h-1)*i+a*g),t[12]-=O[0],t[13]-=O[1],t[14]-=O[2]},this._manipulator=t,this.updateManipulator()},t}(g.Manipulation);t.MoveZManipulation=w;var S=p.vec3f64.create(),O=p.vec3f64.create(),P=p.vec3f64.create()}).apply(null,r))||(e.exports=i)},qSzK:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("xoE+"),n("hk44"),n("0W55"),n("7Aei"),n("aExC")],void 0===(i=(function(e,t,n,r,i,a,o,s){var l,c,u,p,d,f,h,v,m,g;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultAngleCutoff=r.deg2rad(6),t.build=function(e){var t=new s.ShaderBuilder;return t.extensions.add("GL_OES_standard_derivatives"),t.include(a.ScreenSpacePass),t.include(i.Laserline,e),t.fragment.uniforms.add("angleCutoff","vec2"),t.fragment.uniforms.add("globalAlpha","float"),e.heightManifoldEnabled&&t.fragment.uniforms.add("heightPlane","vec4"),e.pointDistanceEnabled&&t.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&t.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&t.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&t.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&t.fragment.code.add(o.glsl(l||(l=n.__makeTemplateObject(["\n      float planeDistancePixels(vec4 plane, vec3 pos) {\n        float dist = dot(plane.xyz, pos) + plane.w;\n        float width = fwidth(dist);\n        dist /= min(width, maxPixelDistance);\n        return abs(dist);\n      }"],["\n      float planeDistancePixels(vec4 plane, vec3 pos) {\n        float dist = dot(plane.xyz, pos) + plane.w;\n        float width = fwidth(dist);\n        dist /= min(width, maxPixelDistance);\n        return abs(dist);\n      }"])))),e.pointDistanceEnabled&&t.fragment.code.add(o.glsl(c||(c=n.__makeTemplateObject(["\n    float sphereDistancePixels(vec4 sphere, vec3 pos) {\n      float dist = distance(sphere.xyz, pos) - sphere.w;\n      float width = fwidth(dist);\n      dist /= min(width, maxPixelDistance);\n      return abs(dist);\n    }\n    "],["\n    float sphereDistancePixels(vec4 sphere, vec3 pos) {\n      float dist = distance(sphere.xyz, pos) - sphere.w;\n      float width = fwidth(dist);\n      dist /= min(width, maxPixelDistance);\n      return abs(dist);\n    }\n    "])))),e.intersectsLineEnabled&&t.fragment.code.add(o.glsl(u||(u=n.__makeTemplateObject(["\n    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\n      float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\n      return abs(dist) - radius;\n    }\n    "],["\n    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\n      float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\n      return abs(dist) - radius;\n    }\n    "])))),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.fragment.code.add(o.glsl(p||(p=n.__makeTemplateObject(["\n    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\n      vec3 dir = end - start;\n      float t2 = dot(dir, pos - start);\n      float l2 = dot(dir, dir);\n      return t2 >= 0.0 && t2 <= l2;\n    }\n    "],["\n    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\n      vec3 dir = end - start;\n      float t2 = dot(dir, pos - start);\n      float l2 = dot(dir, dir);\n      return t2 >= 0.0 && t2 <= l2;\n    }\n    "])))),t.fragment.code.add(o.glsl(d||(d=n.__makeTemplateObject(["\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    vec4 color = vec4(0, 0, 0, 0);\n  "],["\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    vec4 color = vec4(0, 0, 0, 0);\n  "])))),e.heightManifoldEnabled&&t.fragment.code.add(o.glsl(f||(f=n.__makeTemplateObject(["\n    {\n      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\n      vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));\n      color = max(color, heightManifoldColor * heightManifoldAlpha);\n    }\n    "],["\n    {\n      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\n      vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));\n      color = max(color, heightManifoldColor * heightManifoldAlpha);\n    }\n    "])))),e.pointDistanceEnabled&&t.fragment.code.add(o.glsl(h||(h=n.__makeTemplateObject(["\n    {\n      // distance to sphere\n      float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\n      vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\n      float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\n\n      color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n    }\n    "],["\n    {\n      // distance to sphere\n      float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\n      vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\n      float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\n\n      color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n    }\n    "])))),e.lineVerticalPlaneEnabled&&t.fragment.code.add(o.glsl(v||(v=n.__makeTemplateObject(["\n    {\n      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\n        float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\n\n        vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\n        float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\n\n        color = max(color, lineVerticalColor * lineVerticalAlpha);\n      }\n    }\n    "],["\n    {\n      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\n        float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\n\n        vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\n        float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\n\n        color = max(color, lineVerticalColor * lineVerticalAlpha);\n      }\n    }\n    "])))),e.intersectsLineEnabled&&t.fragment.code.add(o.glsl(m||(m=n.__makeTemplateObject(["\n    {\n      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\n        float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\n        vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\n        float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\n\n        color = max(color, intersectsLineColor * intersectsLineAlpha);\n      }\n    }\n    "],["\n    {\n      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\n        float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\n        vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\n        float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\n\n        color = max(color, intersectsLineColor * intersectsLineAlpha);\n      }\n    }\n    "])))),t.fragment.code.add(o.glsl(g||(g=n.__makeTemplateObject(["\n    gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);\n  }\n  "],["\n    gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);\n  }\n  "])))),t}}).apply(null,r))||(e.exports=i)},qUb7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("Rdxj")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MainLight=function(e,t,r){void 0===e&&(e=n.vec3f64.create()),void 0===t&&(t=n.vec3f64.fromValues(.57735,.57735,.57735)),void 0===r&&(r=!0),this.intensity=e,this.direction=t,this.castShadows=r},t.FillLight=function(e,t){void 0===e&&(e=n.vec3f64.create()),void 0===t&&(t=n.vec3f64.fromValues(.57735,.57735,.57735)),this.intensity=n.vec3f64.create(),this.direction=n.vec3f64.create(),this.intensity=e,this.direction=t},t.AmbientLight=function(e){void 0===e&&(e=n.vec3f64.create()),this.intensity=e},t.SphericalHarmonicsLight=function(){this.sh={r:[0],g:[0],b:[0]}}}).apply(null,r))||(e.exports=i)},qkUi:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("ub+M"),n("owRV"),n("A5GR"),n("uNfR"),n("4QR8")],void 0===(i=(function(e,t,n,r,i,a,o){Object.defineProperty(t,"__esModule",{value:!0}),t.DrawGraphicTool=n.DrawGraphicTool,t.DrawOperation=r.DrawOperation,t.GraphicMoveTool=i.GraphicMoveTool,t.GraphicReshapeTool=a.GraphicReshapeTool,t.GraphicTransformTool=o.GraphicTransformTool}).apply(null,r))||(e.exports=i)},quQL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.PiUtils=function(e){e.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    const float PI = 3.141592653589793;\n  "],["\n    const float PI = 3.141592653589793;\n  "])))),e.fragment.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n    const float PI = 3.141592653589793;\n    const float LIGHT_NORMALIZATION = 1.0 / PI;\n    const float INV_PI = 0.3183098861837907;\n    const float HALF_PI = 1.570796326794897;\n    "],["\n    const float PI = 3.141592653589793;\n    const float LIGHT_NORMALIZATION = 1.0 / PI;\n    const float INV_PI = 0.3183098861837907;\n    const float HALF_PI = 1.570796326794897;\n    "]))))}}).apply(null,r))||(e.exports=i)},qvwY:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){function n(e){return e instanceof Float32Array&&e.length>=16}function r(e){return Array.isArray(e)&&e.length>=16}Object.defineProperty(t,"__esModule",{value:!0}),t.isMat4f32=n,t.isMat4f64=r,t.isMat4=function(e){return n(e)||r(e)}}).apply(null,r))||(e.exports=i)},rCq5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConversion=function(e,t){var l=[r.glsl(i||(i=n.__makeTemplateObject(["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "],["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "]))),r.glsl(a||(a=n.__makeTemplateObject(["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "],["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "]))),r.glsl(o||(o=n.__makeTemplateObject(["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "],["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "]))),r.glsl(s||(s=n.__makeTemplateObject(["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "],["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "])))];switch(t.stages){case 0:l.forEach((function(t){return e.vertex.code.add(t)}));break;case 1:l.forEach((function(t){return e.fragment.code.add(t)}));break;default:l.forEach((function(t){return e.vertex.code.add(t)})),l.forEach((function(t){return e.fragment.code.add(t)}))}}}).apply(null,r))||(e.exports=i)},raiv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("FXVB"),n("1m5D"),n("W/V4"),n("FQ4r"),n("lBa0"),n("UGy0"),n("G0ER"),n("qbr3"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get().build(this.configuration);return new u(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),t.attributeLocations)},t.prototype.bind=function(e,t,n){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*n.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*n.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",n.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/n.fullWidth,2/n.fullHeight),this.program.setUniformMatrix4fv("uProjectionMatrix",n.projectionMatrix),i.mat4.translate(v,n.viewMatrix,t),this.program.setUniformMatrix4fv("uModelViewMatrix",v),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1)},t.prototype.initializePipeline=function(){return d.makePipelineState({blending:p.simpleBlendingParams(1,771),colorWrite:d.defaultColorWriteParams})},t.prototype.bindPipelineState=function(e){e.setPipelineState(this.pipeline)},t.shader=new o.ReloadableShaderModule(c,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("UGy0")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t.attributeLocations={start:0,end:1,up:2,extrude:3},t}(s.ShaderTechnique);t.LaserlinePathTechnique=f;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.contrastControlEnabled=!1,t}return r.__extends(t,e),r.__decorate([l.parameter()],t.prototype,"contrastControlEnabled",void 0),t}(l.ShaderTechniqueConfiguration);t.LaserlinePathTechniqueConfiguration=h;var v=a.mat4f64.create()}).apply(null,r))||(e.exports=i)},s6rJ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("LxLY"),n("0LE5"),n("Rdxj"),n("WRgd"),n("+wMf"),n("CIy2"),n("PwS/")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=o.create(),p=l.VertexAttrConstants;t.intersectTriangleGeometry=function(e,t,n,i,a,s,f){var h=c.isInstanceHidden(t),m=n.tolerance;if(!h)if(e.boundingInfo)l.assert("triangle"===e.data.primitiveType),function e(t,n,i,a,s,l){var c=_(n,i,d);if(o.setMin(u,t.getBBMin()),o.setMax(u,t.getBBMax()),r.isSome(s)&&s.applyToAABB(u),b(u,n,c,a)){var p=t.getPrimitiveIndices(),f=t.getIndices(),h=t.getPosition(),m=p?p.length:f.length/3;if(m>S){var g=t.getChildren();if(void 0!==g){for(var y=0;y<8;++y)void 0!==g[y]&&e(g[y],n,i,a,s,l);return}}v(n,i,0,m,f,h,p,s,l)}}(e.boundingInfo,i,a,m,s,f);else{var g=e.getIndices(p.POSITION),y=e.getAttribute(p.POSITION);v(i,a,0,g.length/3,g,y,void 0,s,f)}};var d=a.vec3f64.create(),f=Math.pow(2,-52),h=a.vec3f64.create();function v(e,t,n,i,a,o,s,l,c){var u,p,d;if(s)return function(e,t,n,i,a,o,s,l,c){for(var u,p,d,v=o.data,m=o.offsetIdx,g=o.strideIdx,_=e[0],b=e[1],x=e[2],w=t[0]-_,S=t[1]-b,O=t[2]-x,P=n;P<i;++P){var M=s[P],C=3*M,A=m+g*a[C++],D=v[A++],T=v[A++],R=v[A];A=m+g*a[C++];var j=v[A++],E=v[A++],I=v[A];A=m+g*a[C];var V=v[A++],z=v[A++],L=v[A];r.isSome(l)&&(D=(u=l.applyToVertex(D,T,R))[0],T=u[1],R=u[2],j=(p=l.applyToVertex(j,E,I))[0],E=p[1],I=p[2],V=(d=l.applyToVertex(V,z,L))[0],z=d[1],L=d[2]);var N=j-D,F=E-T,U=I-R,G=V-D,H=z-T,k=L-R,B=S*k-H*O,q=O*G-k*w,W=w*H-G*S,Z=N*B+F*q+U*W;if(!(Math.abs(Z)<=f)){var X=_-D,Y=b-T,Q=x-R,J=X*B+Y*q+Q*W;if(Z>0){if(J<0||J>Z)continue}else if(J>0||J<Z)continue;var K=Y*U-F*Q,$=Q*N-U*X,ee=X*F-N*Y,te=w*K+S*$+O*ee;if(Z>0){if(te<0||J+te>Z)continue}else if(te>0||J+te<Z)continue;var ne=(G*K+H*$+k*ee)/Z;ne>=0&&c(ne,y(N,F,U,G,H,k,h),M)}}}(e,t,n,i,a,o,s,l,c);for(var v=o.data,m=o.offsetIdx,g=o.strideIdx,_=e[0],b=e[1],x=e[2],w=t[0]-_,S=t[1]-b,O=t[2]-x,P=n,M=3*n;P<i;++P){var C=m+g*a[M++],A=v[C++],D=v[C++],T=v[C];C=m+g*a[M++];var R=v[C++],j=v[C++],E=v[C];C=m+g*a[M++];var I=v[C++],V=v[C++],z=v[C];r.isSome(l)&&(A=(u=l.applyToVertex(A,D,T))[0],D=u[1],T=u[2],R=(p=l.applyToVertex(R,j,E))[0],j=p[1],E=p[2],I=(d=l.applyToVertex(I,V,z))[0],V=d[1],z=d[2]);var L=R-A,N=j-D,F=E-T,U=I-A,G=V-D,H=z-T,k=S*H-G*O,B=O*U-H*w,q=w*G-U*S,W=L*k+N*B+F*q;if(!(Math.abs(W)<=f)){var Z=_-A,X=b-D,Y=x-T,Q=Z*k+X*B+Y*q;if(W>0){if(Q<0||Q>W)continue}else if(Q>0||Q<W)continue;var J=X*F-N*Y,K=Y*L-F*Z,$=Z*N-L*X,ee=w*J+S*K+O*$;if(W>0){if(ee<0||Q+ee>W)continue}else if(ee>0||Q+ee<W)continue;var te=(U*J+G*K+H*$)/W;te>=0&&c(te,y(L,N,F,U,G,H,h),P)}}}t.intersectTriangles=v;var m=a.vec3f64.create(),g=a.vec3f64.create();function y(e,t,n,r,a,o,s){return i.vec3.set(m,e,t,n),i.vec3.set(g,r,a,o),i.vec3.cross(s,m,g),i.vec3.normalize(s,s),s}function _(e,t,n){return i.vec3.set(n,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function b(e,t,n,r){return x(e,t,n,r,1/0)}function x(e,t,n,r,i){var a=(e[0]-r-t[0])*n[0],o=(e[3]+r-t[0])*n[0],s=Math.min(a,o),l=Math.max(a,o),c=(e[1]-r-t[1])*n[1],u=(e[4]+r-t[1])*n[1];if((l=Math.min(l,Math.max(c,u)))<0)return!1;if((s=Math.max(s,Math.min(c,u)))>l)return!1;var p=(e[2]-r-t[2])*n[2],d=(e[5]+r-t[2])*n[2];return!((l=Math.min(l,Math.max(p,d)))<0)&&!((s=Math.max(s,Math.min(p,d)))>l)&&s<i}function w(e){var t=[];return e.forEach((function(e){return t.push(e)})),t}t.computeNormal=y,t.computeInvDir=_,t.intersectAabbInvDir=b,t.intersectAabbInvDirBefore=x,t.verticalOffsetAtDistance=function(e,t,r,i,a){var o=(r.screenLength||0)*e.pixelRatio;a&&(o=s.scale(o,i,t,a));var l=o*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return n.glClamp(l*t,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)},t.bindScreenSizePerspective=function(e,t,n){if(e){var r=e.parameters;t.setUniform4f(n,r.divisor,r.offset,r.minPixelSize,e.paddingPixelsOverride)}},t.copyParameters=function e(t,n){var r=n?e(n):{};for(var i in t){var a=t[i];a&&a.forEach&&(a=w(a)),null==a&&i in r||(r[i]=a)}return r},t.updateParameters=function(e,t){var n=!1;for(var r in t){var i=t[r];void 0!==i&&(n=!0,e[r]=Array.isArray(i)?i.slice():i)}return n},t.intersectDrapedRenderLineGeometry=function(e,t,r,i,a){if(t.options.selectionMode){for(var o=e.getAttribute(p.POSITION).data,s=e.getAttribute(p.SIZE),l=r[0],c=r[1],u=(((s&&s.data[0])+i)/2+4)*e.pixelRatio,d=Number.MAX_VALUE,f=0;f<o.length-5;f+=3){var h=o[f],v=o[f+1],m=l-h,g=c-v,y=o[f+3]-h,_=o[f+4]-v,b=n.clamp((y*m+_*g)/(y*y+_*_),0,1),x=y*b-m,w=_*b-g,S=x*x+w*w;S<d&&(d=S)}d<u*u&&a()}},t.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var S=1e3}).apply(null,r))||(e.exports=i)},sQDZ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("6vp1"),n("Xakh"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,a){function o(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.include(r.ReadLinearDepth),e.include(i.Reprojection),e.fragment.code.add(a.glsl(s||(s=n.__makeTemplateObject(["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) +  abs(rayDiffZOld) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1])\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "],["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) +  abs(rayDiffZOld) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1])\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150;":"75;"))}var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSpaceReflections=o,function(e){e.bindUniforms=function(e,t,n){n.ssrEnabled&&(e.setUniform1i("depthMapView",n.linearDepthTextureID),t.bindTexture(n.linearDepthTexture,n.linearDepthTextureID),e.setUniform2f("nearFar",n.nearFar[0],n.nearFar[1]),e.setUniformMatrix4fv("ssrViewMat",n.ssrViewMat),i.Reprojection.bindUniforms(e,t,n))}}(o=t.ScreenSpaceReflections||(t.ScreenSpaceReflections={}))}).apply(null,r))||(e.exports=i)},tUyH:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("KRuQ")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var n=e.call(this)||this;return n.material=t.material,n.techniqueRep=t.techniqueRep,n.output=t.output,n}return n.__extends(t,e),t.prototype.getTechnique=function(){return this.technique},t.prototype.getPipelineState=function(e,t){return this.getTechnique().pipeline},t.prototype.ensureResources=function(e){return 2},t.prototype.ensureParameters=function(e){},t}(r.AutoDisposable);t.GLMaterial=i}).apply(null,r))||(e.exports=i)},uNfR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("BcWh"),n("eIBl"),n("LxLY"),n("8MXS"),n("Vx27"),n("9O7+"),n("JXo2"),n("X7Ps")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(t){var n=e.call(this,t)||this;return n._handles=new i,n._reshapeOperation=null,n._internalGeometryUpdate=!1,n.type="reshape-3d",n}return n.__extends(t,e),t.prototype.destroy=function(){this._handles.removeAll(),this._reshapeOperation&&(this._reshapeOperation.destroy(),this._reshapeOperation=null),this._set("view",null),this._set("graphic",null)},Object.defineProperty(t.prototype,"selectionManagementDisabled",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype._updateGeometry=function(){var e=this.graphic.geometry;this._reshapeOperation.inputGeometry=0!==l.isSupportedGraphic(this.graphic)||!a.isSome(e)||"polygon"!==e.type&&"polyline"!==e.type?null:e.clone()},t.prototype._updateGraphic=function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0===l.isSupportedGraphic(this.graphic)){var t=this.watch("graphic.geometry",(function(){!1===e._internalGeometryUpdate&&e._updateGeometry()}),!0);this._handles.add(t,"onGraphicGeometryChange")}},t.prototype.manipulatorSelectionChanged=function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()},t.prototype._onReshapeGeometryChanged=function(){a.isNone(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)},t.prototype.initialize=function(){var e=this;this._reshapeOperation=new c.ReshapeOperation({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)})),this._reshapeOperation.on("move",(function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)})),this._reshapeOperation.on("vertex-add",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)})),this._reshapeOperation.on("vertex-remove",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)})),this._reshapeOperation.on("immediate-click",(function(){return e.emit("immediate-click")})),o.init(this,"graphic",(function(){e._updateGraphic()}),!0)])},t.prototype.onInputEvent=function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()},t.prototype.reset=function(){},n.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n.__decorate([s.property({constructOnly:!0})],t.prototype,"graphic",void 0),n.__decorate([s.property({constructOnly:!0,nonNullable:!0,value:!0})],t.prototype,"enableZ",void 0),n.__decorate([s.property({readOnly:!0})],t.prototype,"type",void 0),n.__decorate([s.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],t)}(r.EventedMixin(u.InteractiveToolBase));t.GraphicReshapeTool=p}).apply(null,r))||(e.exports=i)},uUnu:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("2o+p"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){function a(e,t){var a=e;a.include(r.ScreenSizePerspective),a.attributes.add("position","vec3"),a.attributes.add("normal","vec3"),a.attributes.add("auxpos1","vec4"),a.vertex.uniforms.add("proj","mat4"),a.vertex.uniforms.add("view","mat4"),a.vertex.uniforms.add("viewNormal","mat4"),a.vertex.uniforms.add("viewport","vec4"),a.vertex.uniforms.add("camPos","vec3"),a.vertex.uniforms.add("polygonOffset","float"),a.vertex.uniforms.add("cameraGroundRelative","float"),a.vertex.uniforms.add("pixelRatio","float"),a.vertex.uniforms.add("perDistancePixelRatio","float"),a.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&a.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&a.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),a.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),a.vertex.defines.addFloat("SMALL_OFFSET_ANGLE",.984807753012208),a.vertex.code.add(i.glsl(o||(o=n.__makeTemplateObject(["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "],["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "])))),a.vertex.code.add(i.glsl(s||(s=n.__makeTemplateObject(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = sign(pointGroundDistance);\n\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "],["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = sign(pointGroundDistance);\n\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "])))),a.vertex.code.add(i.glsl(l||(l=n.__makeTemplateObject(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "],["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "])))),a.vertex.code.add(i.glsl(p||(p=n.__makeTemplateObject(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "],["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.verticalOffsetEnabled?i.glsl(c||(c=n.__makeTemplateObject(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"],["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",1!==t.screenCenterOffsetUnitsEnabled?i.glsl(u||(u=n.__makeTemplateObject(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "],["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),a.vertex.code.add(i.glsl(d||(d=n.__makeTemplateObject(["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD > 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD = 0.75\n        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n  "],["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD > 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD = 0.75\n        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n  "]))))}var o,s,l,c,u,p,d;Object.defineProperty(t,"__esModule",{value:!0}),t.HUD=a,function(e){!function(e){e[e.OCCLUDED=0]="OCCLUDED",e[e.NOTOCCLUDED=1]="NOTOCCLUDED",e[e.BOTH=2]="BOTH",e[e.COUNT=3]="COUNT"}(e.TransparentRenderStyle||(e.TransparentRenderStyle={})),e.bindUniforms=function(t,n){t.setUniform1f("uRenderTransparentlyOccludedHUD",n.renderTransparentlyOccludedHUD===e.TransparentRenderStyle.OCCLUDED?1:n.renderTransparentlyOccludedHUD===e.TransparentRenderStyle.NOTOCCLUDED?0:.75)},e.bindVisibilityTexture=function(e,t,n){t.setUniform1i("hudVisibilityTexture",1),e.bindTexture(n.hudVisibilityTexture,1),e.setActiveTexture(0)}}(a=t.HUD||(t.HUD={}))}).apply(null,r))||(e.exports=i)},uZGf:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("0LE5"),n("Rdxj"),n("2B1V"),n("tUyH"),n("FNtW"),n("CIy2"),n("LZD4"),n("s6rJ"),n("s6rJ"),n("ZeO9"),n("fQ2U")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f){Object.defineProperty(t,"__esModule",{value:!0});var h=a.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec3f(l.VertexAttrConstants.NORMAL),v=function(e){function t(t,n){var r=e.call(this,n)||this;return r.supportsEdges=!0,r.techniqueConfig=new f.ShadedColorMaterialTechniqueConfiguration,r.params=p.copyParameters(t,g),r}return n.__extends(t,e),t.prototype.setParameterValues=function(e){u.updateParameters(this.params,e)&&this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig},t.prototype.getPassParameters=function(){return this.params},t.prototype.intersect=function(e,t,n,r,i,a,o){p.intersectTriangleGeometry(e,t,r,i,a,void 0,o)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new m(e):void 0},t.prototype.createBufferWriter=function(){return new c.DefaultBufferWriter(h)},t.prototype.createRenderer=function(e,t){return new d(e,t,this)},t}(s.Material);t.ShadedColorMaterial=v;var m=function(e){function t(t){var n=e.call(this,t)||this;return n.updateParameters(),n}return n.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(f.ShadedColorMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){if(4===this.output)return 3===e;var t=3;return this.technique.configuration.transparent&&(t=this.technique.configuration.writeDepth?5:8),e===t},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t}(o.GLMaterial),g={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:r.vec3.normalize(i.vec3f64.create(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0}}).apply(null,r))||(e.exports=i)},"ub+M":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("jZlN"),n("pcDC"),n("BcWh"),n("LxLY"),n("Vx27"),n("RYqx"),n("DtIM"),n("X5J5"),n("owRV"),n("5uSI"),n("R4nD"),n("T95R"),n("wT+E"),n("X7Ps")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m){Object.defineProperty(t,"__esModule",{value:!0});var g=function(e){function t(t){var n=e.call(this,t)||this;return n.drawOperation=null,n._createGraphic=null,n._outlineVisualElement=null,n._verticesVisualElement=null,n._stagedVerticesVisualElement=null,n.hasZ=!0,n.defaultZ=0,n.elevationInfo=null,n.snapToScene=!1,n.mode="hybrid",n.geometryType=null,n.type="draw-3d",n}return n.__extends(t,e),t.prototype.initialize=function(){var e=this,t=o.unwrapOr(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new l({elevationInfo:t}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new p.DrawOperation({view:this.view,manipulators:this.manipulators,geometryType:y(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snappingEnabled:this.snapToScene,snappingDrawSurface:new d.SceneDrawSurface(this.view,t,[this._internalGraphicsLayer]),hasM:!1,elevationInfo:t}),this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)}))},t.prototype.destroy=function(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)},t.prototype.onInputEvent=function(e){this.drawOperation.onInputEvent(e)},t.prototype._getCreateGeometry=function(e,t){if(void 0===t&&(t=!1),null==this.drawOperation)return null;var n=o.isSome(e)?e:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null,r=this.drawOperation.vertices;if(0===r.length)return null;var i=this.drawOperation.spatialReference,a=r,s=a.slice(),l=[];o.isSome(n)&&(s.splice(n,1),l.push(a[n]));var c={regularVertices:null,stagedVertices:null,full:null,outline:null},u="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":c.regularVertices=s,c.stagedVertices=l,c.full=this.drawOperation.coordinateHelper.createPointFromArray(r[0]);break;case"polyline":c.regularVertices=s,c.stagedVertices=l,a.length>1&&(c.full=v.createPolyline([a],i,u));break;case"polygon":c.regularVertices=s,c.stagedVertices=l,a.length>2&&(c.full=v.createPolygon([a],i,u,!0));break;case"circle":if(a.length>0){var p=v.createViewAlignedCoordinateSystem(this.view,r[0]);if(1===a.length&&t){var d=a[0],f=p.makeMapPoint(d[0]+_*this.view.resolution,d[1]);c.full=v.createCircle([d,f],p,!0)}else 2===a.length&&(c.full=this.forceUniformSize?v.createCircle(r,p,this.centered):v.createEllipse(r,p,this.centered))}break;case"rectangle":a.length>0&&(p=v.createViewAlignedCoordinateSystem(this.view,r[0]),1===a.length&&t?(f=p.makeMapPoint((d=a[0])[0]+_*this.view.resolution,d[1]),c.full=v.createSquare([d,f],p,!0)):2===a.length&&(c.full=this.forceUniformSize?v.createSquare(r,p,this.centered):v.createRectangle(r,p,this.centered)));break;default:return null}switch(this.geometryType){case"point":break;case"polyline":a.length>1&&(c.outline=v.createPolyline([a],i,u));break;case"polygon":if(a.length>1){var h=[a[a.length-1]];a.forEach((function(e){h.push(e)})),c.outline=v.createPolyline([h],i,u)}break;case"circle":case"rectangle":o.isSome(c.full)&&"polygon"===c.full.type&&(c.outline=v.createPolyline(c.full.rings,i,u))}return c},t.prototype._destroyAllVisualisations=function(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()},t.prototype._destroyCreateGraphic=function(){o.isSome(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null)},t.prototype._destroyOutlineVisualElement=function(){o.isSome(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)},t.prototype._destroyVerticesVisualElement=function(){o.isSome(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)},t.prototype._destroyStagedVerticesVisualElement=function(){o.isSome(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)},t.prototype._updateCreateGraphic=function(e){void 0===e&&(e=null);var t=this._getCreateGeometry(e);if(o.isNone(t))this._destroyAllVisualisations();else{var n=this._internalGraphicsLayer.elevationInfo,i="on-the-ground"===c.getEffectiveElevationMode(this.hasZ,n);o.isSome(t.outline)?o.isNone(this._outlineVisualElement)?(this._outlineVisualElement=new f.OutlineVisualElement({view:this.view,geometry:t.outline,elevationInfo:o.unwrap(n),isDraped:i,attached:!1}),u.settings.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),u.settings.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=t.outline:this._destroyOutlineVisualElement(),o.isSome(t.regularVertices)?o.isNone(this._verticesVisualElement)?(this._verticesVisualElement=new h.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:t.regularVertices,elevationInfo:o.unwrap(this._internalGraphicsLayer.elevationInfo),attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=t.regularVertices:this._destroyVerticesVisualElement(),o.isSome(t.stagedVertices)?o.isNone(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new h.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:t.stagedVertices,elevationInfo:o.unwrap(this._internalGraphicsLayer.elevationInfo),attached:!1}),this._stagedVerticesVisualElement.color=u.settings.colorToVec4(u.settings.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=t.stagedVertices:this._destroyStagedVerticesVisualElement(),o.isSome(t.full)?o.isNone(this._createGraphic)?(this._createGraphic=new r({geometry:t.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic)):this._createGraphic.geometry=t.full:this._destroyCreateGraphic()}},Object.defineProperty(t.prototype,"createGraphic",{get:function(){return this._createGraphic},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"centered",{set:function(e){this._set("centered",e),this._updateCreateGraphic()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forceUniformSize",{set:function(e){this._set("forceUniformSize",e),this._updateCreateGraphic()},enumerable:!0,configurable:!0}),t.prototype.reset=function(){},Object.defineProperty(t.prototype,"canRedo",{get:function(){return this.drawOperation.canRedo},enumerable:!0,configurable:!0}),t.prototype.redo=function(){this.drawOperation.redo()},Object.defineProperty(t.prototype,"canUndo",{get:function(){return this.drawOperation.canUndo},enumerable:!0,configurable:!0}),t.prototype.undo=function(){this.drawOperation.undo()},t.prototype.completeCreateOperation=function(){this.drawOperation.complete()},t.prototype.activate=function(){},t.prototype.deactivate=function(){this.drawOperation.isCompleted||this.emit("complete",{graphic:null,type:"complete"})},t.prototype.getVertexCoords=function(){return this.drawOperation.vertices},t.prototype.onVertexAdd=function(e){this._updateCreateGraphic(),this.emit("vertex-add",e)},t.prototype.onVertexRemove=function(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)},t.prototype.onVertexUpdate=function(e){this._updateCreateGraphic(),this.emit("vertex-update",e)},t.prototype.onCursorUpdate=function(e){this._updateCreateGraphic(1===e.vertices.length?e.vertices[0].vertexIndex:null),this.emit("cursor-update",e)},t.prototype.onComplete=function(e){this._updateCreateGraphic();var t=null;if(this.drawOperation.isCompleted){var n=this._getCreateGeometry(null,!0);o.isSome(n)&&(t=new r({geometry:n.full,symbol:this.createGraphicSymbol}))}this.emit("complete",{graphic:t,type:"complete"})},n.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),n.__decorate([s.property()],t.prototype,"createGraphicSymbol",void 0),n.__decorate([s.property()],t.prototype,"createGraphic",null),n.__decorate([s.property({value:!0})],t.prototype,"enabled",null),n.__decorate([s.property({value:!0})],t.prototype,"centered",null),n.__decorate([s.property({value:!0})],t.prototype,"forceUniformSize",null),n.__decorate([s.property({constructOnly:!0})],t.prototype,"hasZ",void 0),n.__decorate([s.property({nonNullable:!0})],t.prototype,"defaultZ",void 0),n.__decorate([s.property({constructOnly:!0})],t.prototype,"elevationInfo",void 0),n.__decorate([s.property()],t.prototype,"snapToScene",void 0),n.__decorate([s.property({constructOnly:!0})],t.prototype,"mode",void 0),n.__decorate([s.property({constructOnly:!0})],t.prototype,"geometryType",void 0),n.__decorate([s.property({readOnly:!0})],t.prototype,"type",void 0),n.__decorate([s.subclass("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],t)}(a.EventedMixin(m.InteractiveToolBase));function y(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return i.neverReached(e),null}}t.DrawGraphicTool=g;var _=48}).apply(null,r))||(e.exports=i)},uinn:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("XwIv"),n("xoE+"),n("LxLY"),n("8MXS"),n("0LE5"),n("Rdxj"),n("WRgd"),n("lRq4"),n("DtIM"),n("Kvb2"),n("X5J5"),n("MCHn"),n("PXiz"),n("i10q"),n("/9Lg"),n("fOZq"),n("/NuL"),n("mmEe")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_){function b(e){return i.isSome(e.geometry)&&"point"===e.geometry.type}Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=function(e){var t=e.view,s=new y.GraphicState({graphic:e.graphic}),S=[],O=function(e,t,r){var o=e.graphic,s=new v.PointVisualElement({view:e.view,geometry:b(o)?o.geometry:null,elevationInfo:u.getGraphicEffectiveElevationInfo(o),attached:!1});return function(e,t,r,o){(function(e,t,r,a){var o=e.view,s=e.graphic,l=null,u=function(){i.isSome(l)&&(l.remove(),l=null),r.isDraped&&b(s)&&(l=function(e,t,n){_.pointToVector(t,x,e.elevationProvider.spatialReference);var r=x[0],i=x[1];return e.elevationProvider.on("elevation-change",(function(e){c.containsXY(e.extent,r,i)&&n()}))}(o,s.geometry,(function(){t.geometry=s.geometry}))),t.geometry=b(s)?s.geometry:null};a.push(r.on("changed",u),n.refHandle((function(){return l}))),u()})(e,t,r,o),d.settings.visualElements.pointGraphics.outline.apply(t),o.push(a.init(r,"displaying",(function(){return t.attached=r.displaying})))}(e,s,t,r),r.push(n.destroyHandle(s)),s}(e,s,S);return function(e,t,i,a){var s=e.view,c=e.graphic,v=new h.LineVisualElement({view:s,infinite:d.settings.visualElements.zVerticalLine.infiniteType,attached:!1});d.settings.visualElements.zVerticalLine.apply(v);var y=new f.LaserlineVisualElement({view:s,intersectsLineInfinite:!0,attached:!1});d.settings.visualElements.pointGraphics.shadowStyle.apply(y);var S=r.deg2rad(d.settings.visualElements.heightPlaneAngleCutoff),O=new f.LaserlineVisualElement({view:s,attached:!1,angleCutoff:S});d.settings.visualElements.heightPlane.apply(O);var P=u.getGraphicEffectiveElevationInfo(e.graphic),M=g.ElevationContext.fromElevationInfo(P),C="on-the-ground"===P.mode||!P.offset&&"absolute-height"!==P.mode,A=new p.ManipulatorState,D=1,T=1,R=function(){A.update(e);var n=C&&(t.isDraped||!b(c)||!c.geometry.hasZ),r=!0;if(!n&&b(c)){var i=c.geometry,u=m.evaluateElevationAlignmentAtPoint(c.geometry,s.elevationProvider,M,s.renderCoordsHelper);o.vec3.set(x,i.x,i.y,u),_.vectorToVector(x,i.spatialReference,x,s.renderCoordsHelper.spatialReference),v.worldDownAtLocation=x,y.intersectsWorldUpAtLocation=x}else r=!1;var p=2&A.grabbingState?d.settings.visualElements.laserlineAlphaMultiplier:1;p!==D&&(D=p,d.settings.visualElements.heightPlane.apply(O,p));var f=l.empty(w);!n&&t.displaying&&a.calculateMapBounds(f)&&_.vectorToVector(l.getMin(f,x),s.spatialReference,x,s.renderCoordsHelper.spatialReference)?(O.heightManifoldTarget=x,O.attached=!0):O.attached=!1;var h=4&A.grabbingState?d.settings.visualElements.laserlineAlphaMultiplier:1;h!==T&&(T=h,d.settings.visualElements.pointGraphics.shadowStyle.apply(y,h));var g=r&&t.displaying&&!n;y.attached=g,v.attached=g};i.push(t.watch(["displaying","isDraped"],R),t.on("changed",R)),e.forEachManipulator((function(e){i.push(e.events.on("grab-changed",R))})),i.push(n.destroyHandle(y)),i.push(n.destroyHandle(v)),i.push(n.destroyHandle(O)),R()}(e,s,S,O),S.push(t.trackGraphicState(s)),{visualElement:O,remove:function(){n.handlesGroup(S).remove()}}};var x=s.vec3f64.create(),w=l.create()}).apply(null,r))||(e.exports=i)},"v+nG":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("1m5D"),n("Rdxj"),n("WRgd"),n("ZPQp"),n("ZcgO"),n("/9Lg"),n("/9Lg"),n("BwdQ"),n("mmEe"),n("ZJC8")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var f=i.vec3f64.create();t.createStageObjectForHUD=function(e,t,i,o,s,l,u,h,v,m,g){var y=i?i.length:0,_=e.clippingExtent;if(p.pointToVector(t,f,e.elevationProvider.spatialReference),n.isSome(_)&&!a.containsPoint(_,f))return null;p.pointToVector(t,f,e.renderCoordsHelper.spatialReference);for(var b=e.localOriginFactory.getOrigin(f),x=new d({castShadow:!1,metadata:{layerUid:v,graphicUid:m,usesVerticalDistanceToGround:!0},idHint:h}),w=0;w<y;w++)x.addGeometry(i[w],o[w],s?s[w]:r.mat4f64.IDENTITY,l,b,g);return{object:x,sampledElevation:c.applyElevationAlignmentForHUD(x,t,e.elevationProvider,e.renderCoordsHelper,u)}},t.extendPointGraphicElevationContext=function(e,t,n){var r=e.elevationContext,i=n.spatialReference;p.pointToVector(t,f,i),r.centerPointInElevationSR=s.makeDehydratedPoint(f[0],f[1],t.hasZ?f[2]:0,i)},t.placePointOnGeometry=function(e){switch(e.type){case"point":return e;case"polygon":case"extent":return u.computeCentroid(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var n=o.getPointOnPath(t,o.getPathLength(t)/2);return s.makeDehydratedPoint(n[0],n[1],n[2],e.spatialReference);case"mesh":return e.extent.center}return null},t.geometryToRenderInfo=function(e,t,n,r,i){var a=new Float64Array(3*e.length),o=new Float64Array(a.length);e.forEach((function(e,t){a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));var s=l.applyPerVertexElevationAlignment(a,t,0,o,0,a,0,a.length/3,n,r,i);return{numVertices:e.length,position:a,mapPosition:o,projectionSuccess:null!=s,sampledElevation:s}}}).apply(null,r))||(e.exports=i)},v22c:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("fese"),n("3kdR"),n("cj3m"),n("sQDZ"),n("RdU/"),n("naZ0"),n("W/V4"),n("FQ4r"),n("lBa0"),n("EiD/"),n("ff/U"),n("jl7D"),n("G0ER"),n("qbr3"),n("2Kdy")],void 0===(i=(function(e,t,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g){Object.defineProperty(t,"__esModule",{value:!0});var y=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.waterTextureRepository=t.waterTextureRepository,r}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var n=t.shader.get(),r=this.configuration,i=n.build({output:r.output,viewingMode:e.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:r.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:r.useSSR,highStepCount:!0});return new m(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),h.Default3D)},t.prototype.ensureResource=function(e){return this.waterTextureRepository.ready||this.waterTextureRepository.updating||this.waterTextureRepository.loadTextures(e),this.waterTextureRepository.ready?2:1},t.prototype.bindPass=function(e,t,n){0===this.configuration.output&&s.ScreenSpaceReflections.bindUniforms(this.program,e,n),0!==this.configuration.output&&2!==this.configuration.output||(l.WaterDistortion.bindUniforms(this.program,t),this.waterTextureRepository.bindRepo(e)),0!==this.configuration.output&&5!==this.configuration.output||this.program.setUniform4fv("waterColor",t.color)},t.prototype.bindDraw=function(e){a.Transform.bindUniforms(this.program,e),0===this.configuration.output&&(c.Camera.bindUniforms(this.program,e),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e),o.ReadShadowMap.bindUniforms(this.program,e,f.DefaultTextureUnits.SHADOW_MAP))},t.prototype.initializePipeline=function(){var e=this.configuration;return g.makePipelineState(2===e.output?{depthTest:{func:513},depthWrite:e.writeDepth&&g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams}:{blending:e.transparent&&g.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:e.writeDepth&&g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams})},t.shader=new u.ReloadableShaderModule(v,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[n("jl7D")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(p.ShaderTechnique);t.WaterTechnique=y;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.receiveShadows=!1,t.slicePlaneEnabled=!1,t.transparent=!1,t.writeDepth=!1,t.useSSR=!1,t.isDraped=!1,t}return r.__extends(t,e),r.__decorate([d.parameter({count:7})],t.prototype,"output",void 0),r.__decorate([d.parameter()],t.prototype,"receiveShadows",void 0),r.__decorate([d.parameter()],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([d.parameter()],t.prototype,"transparent",void 0),r.__decorate([d.parameter()],t.prototype,"writeDepth",void 0),r.__decorate([d.parameter()],t.prototype,"useSSR",void 0),r.__decorate([d.parameter()],t.prototype,"isDraped",void 0),t}(d.ShaderTechniqueConfiguration);t.WaterTechniqueConfiguration=_}).apply(null,r))||(e.exports=i)},vA3N:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getElevationAtPoint=function(e,t,n){return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,n)}}).apply(null,r))||(e.exports=i)},vGsU:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("B4Pz"),n("ybGv"),n("piY7"),n("sQDZ"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,a,o,s){var l,c,u;Object.defineProperty(t,"__esModule",{value:!0}),t.Water=function(e,t){e.include(a.PhysicallyBasedRendering,t),e.include(i.Gamma),e.include(r.FoamColor),t.ssrEnabled&&e.include(o.ScreenSpaceReflections,t),e.fragment.code.add(s.glsl(l||(l=n.__makeTemplateObject(["\n    const vec3 fresnelSky =  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial =  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness = 0.015;\n    const float foamIntensityExternal = 1.7;\n    const float ssrIntensity = 0.65;\n    const float ssrHeightFadeStart = 300000.0;\n    const float ssrHeightFadeEnd = 500000.0;\n    const float waterDiffusion = 0.775;\n    const float waterSeeColorMod = 0.8;\n    const float correctionViewingPowerFactor = 0.4;\n\n    const vec3 skyZenitColor = vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor = vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon = the dominant color of the sky horizon\n    *   @parameter: cosTheta = the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n = normal facing away from the surface\n    *   @parameter: v = view direction facing away from the surface.\n    *   @parameter: l = light direction facing away from the surface\n    *   @parameter: lightIntensity = light intensity, currently between 0...PI\n    *   @parameter: localUp = a normal for the general direction of the surface\n    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit = 0.;\n      vec3 seaWaterColor = linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h = normalize(l + v);\n      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV = max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon = linearizeGamma(skyColor);\n      vec3 skyZenit = linearizeGamma(skyZenitColor);\n      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL = max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod = 0.1 + upDotL * 0.9;\n      skyColor *= daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier = clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular = vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV > 0.0 && upDotL > 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular = shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam = vec3(0.0);\n      if(upDotV > 0.0) {\n        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "],["\n    const vec3 fresnelSky =  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial =  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness = 0.015;\n    const float foamIntensityExternal = 1.7;\n    const float ssrIntensity = 0.65;\n    const float ssrHeightFadeStart = 300000.0;\n    const float ssrHeightFadeEnd = 500000.0;\n    const float waterDiffusion = 0.775;\n    const float waterSeeColorMod = 0.8;\n    const float correctionViewingPowerFactor = 0.4;\n\n    const vec3 skyZenitColor = vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor = vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon = the dominant color of the sky horizon\n    *   @parameter: cosTheta = the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n = normal facing away from the surface\n    *   @parameter: v = view direction facing away from the surface.\n    *   @parameter: l = light direction facing away from the surface\n    *   @parameter: lightIntensity = light intensity, currently between 0...PI\n    *   @parameter: localUp = a normal for the general direction of the surface\n    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit = 0.;\n      vec3 seaWaterColor = linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h = normalize(l + v);\n      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV = max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon = linearizeGamma(skyColor);\n      vec3 skyZenit = linearizeGamma(skyZenitColor);\n      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL = max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod = 0.1 + upDotL * 0.9;\n      skyColor *= daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier = clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular = vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV > 0.0 && upDotL > 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular = shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam = vec3(0.0);\n      if(upDotV > 0.0) {\n        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "])))),e.fragment.code.add(s.glsl(t.ssrEnabled?c||(c=n.__makeTemplateObject(["\n      // Convert the world position to view position\n      vec4 viewPosition = vec4(positionView.xyz, 1.0);\n      vec3 viewDir = normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor = vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z > 0.0)\n      {\n        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "],["\n      // Convert the world position to view position\n      vec4 viewPosition = vec4(positionView.xyz, 1.0);\n      vec3 viewDir = normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor = vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z > 0.0)\n      {\n        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "])):u||(u=n.__makeTemplateObject(["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "],["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},vJh7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qysZ")],void 0===(i=(function(e,t,n){function r(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=r*s+a*l,e[1]=i*s+o*l,e[2]=r*c+a*u,e[3]=i*c+o*u,e}function i(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},t.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*a-i*r;return o?(e[0]=a*(o=1/o),e[1]=-r*o,e[2]=-i*o,e[3]=n*o,e):null},t.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=r,t.rotate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l+a*s,e[1]=i*l+o*s,e[2]=r*-s+a*l,e[3]=i*-s+o*l,e},t.scale=function(e,t,n){var r=t[1],i=t[2],a=t[3],o=n[0],s=n[1];return e[0]=t[0]*o,e[1]=r*o,e[2]=i*s,e[3]=a*s,e},t.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},t.subtract=i,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],i=e[1],a=e[2],o=e[3],s=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(r-s)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-l)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-c)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(o-u)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},t.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},t.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},t.mul=r,t.sub=i}).apply(null,r))||(e.exports=i)},"wSO/":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("6DRN"),n("51bw"),n("1m5D"),n("lLWD"),n("DIqE"),n("Rdxj"),n("O7NG")],void 0===(i=(function(e,t,n,r,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t,r){var i=this;this.itemByteSize=e,this.itemCreate=t,this.buffers=[],this.items=[],this.itemsPerBuffer=0,this.itemsPtr=0,this.itemsPerBuffer=Math.ceil(r/this.itemByteSize),this.tickHandle=n.before((function(){return i.reset()}))}return e.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null),this.itemsPtr=0,this.items=null,this.buffers=null},e.prototype.get=function(){0===this.itemsPtr&&n((function(){}));for(var e=Math.floor(this.itemsPtr/this.itemsPerBuffer);this.buffers.length<=e;){for(var t=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),r=0;r<this.itemsPerBuffer;++r)this.items.push(this.itemCreate(t,r*this.itemByteSize));this.buffers.push(t)}return this.items[this.itemsPtr++]},e.prototype.reset=function(){for(var e=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>e;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0},e.createVec2f64=function(t){return void 0===t&&(t=u),new e(16,o.vec2f64.createView,t)},e.createVec3f64=function(t){return void 0===t&&(t=u),new e(24,s.vec3f64.createView,t)},e.createVec4f64=function(t){return void 0===t&&(t=u),new e(32,l.vec4f64.createView,t)},e.createMat3f64=function(t){return void 0===t&&(t=u),new e(72,r.mat3f64.createView,t)},e.createMat4f64=function(t){return void 0===t&&(t=u),new e(128,i.mat4f64.createView,t)},e.createQuatf64=function(t){return void 0===t&&(t=u),new e(32,a.quatf64.createView,t)},Object.defineProperty(e.prototype,"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!0,configurable:!0}),e}();t.VectorStack=c;var u=4096}).apply(null,r))||(e.exports=i)},weRx:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("zp6E")],void 0===(i=(function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0}),t.requestImage=function(e,t){return r(e,n.__assign({responseType:"image"},t)).then((function(e){return e.data}))}}).apply(null,r))||(e.exports=i)},woUR:function(e,t){},xDGw:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("2o+p"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){function a(e,t){var a=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(r.ScreenSizePerspective),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),a.add(i.glsl(p||(p=n.__makeTemplateObject(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "],["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),i.glsl(0===t.viewingMode?s||(s=n.__makeTemplateObject(["vec3 worldNormal = normalize(worldPos + localOrigin);"],["vec3 worldNormal = normalize(worldPos + localOrigin);"])):l||(l=n.__makeTemplateObject(["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"],["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"]))),i.glsl(t.screenSizePerspectiveEnabled?c||(c=n.__makeTemplateObject(["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"],["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"])):u||(u=n.__makeTemplateObject(["\n          float verticalOffsetScreenHeight = verticalOffset.x;"],["\n          float verticalOffsetScreenHeight = verticalOffset.x;"])))))):a.add(i.glsl(d||(d=n.__makeTemplateObject(["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "],["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "]))))}function o(e,t,n,r){return void 0===r&&(r=f),r.screenLength=e.screenLength,r.perDistance=Math.tan(.5*t)/(.5*n),r.minWorldLength=e.minWorldLength,r.maxWorldLength=e.maxWorldLength,r}Object.defineProperty(t,"__esModule",{value:!0}),t.VerticalOffset=a,function(e){e.bindUniforms=function(e,t,n){if(t.verticalOffset){var r=o(t.verticalOffset,n.fovY,n.viewport[3]);e.setUniform4f("verticalOffset",r.screenLength*(n.pixelRatio||1),r.perDistance,r.minWorldLength,r.maxWorldLength)}}}(a=t.VerticalOffset||(t.VerticalOffset={})),t.calculateVerticalOffsetFactors=o;var s,l,c,u,p,d,f={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}}).apply(null,r))||(e.exports=i)},xFEL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("xoE+"),n("LxLY"),n("jBNx"),n("YX1r"),n("51bw"),n("FXVB"),n("1m5D"),n("W9tT"),n("DIqE"),n("0LE5"),n("Rdxj"),n("qvwY"),n("lRq4"),n("2B1V"),n("+nCE"),n("9FJH"),n("FNtW"),n("+wMf"),n("CIy2"),n("ILj8"),n("s6rJ"),n("ZeO9"),n("PwS/"),n("VQEQ"),n("pqGg")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x,w,S,O,P,M,C){Object.defineProperty(t,"__esModule",{value:!0});var A=function(e){function t(t,n){var r=e.call(this,n)||this;return r.techniqueConfig=new C.HUDMaterialTechniqueConfiguration,r.params=S.copyParameters(t,Q),r}return n.__extends(t,e),t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&x.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig},t.prototype.intersect=function(e,t,n,r,i,a,o,s,l){l?this.intersectDrapedHudGeometry(e,a,o,s):this.intersectHudGeometry(e,t,n,r,o,s)},t.prototype.intersectDrapedHudGeometry=function(e,t,n,r){var i=e.getAttribute(x.VertexAttrConstants.POSITION),a=e.getAttribute(x.VertexAttrConstants.SIZE),o=this.params,s=M.calculateAnchorPosForRendering(o),l=1,c=1;if(r){var u=r(q);l=u[0],c=u[5]}l*=e.pixelRatio,c*=e.pixelRatio;for(var p=Z*e.pixelRatio,d=0;d<i.data.length/i.size;d++){var f=d*i.size,h=i.data[f],v=i.data[f+1],m=d*a.size;X[0]=a.data[m]*l,X[1]=a.data[m+1]*c;var g=void 0;o.textureIsSignedDistanceField&&(g=o.outlineSize*e.pixelRatio/2),j(t,h,v,X,p,g,o,s)&&n()}},t.prototype.intersectHudGeometry=function(e,t,n,r,i,a){if(r.options.selectionMode&&r.options.hud&&!P.isInstanceHidden(t)){var s,c,u,p,h,v,m,g,y,_,w,S,O,C=e.data,A=this.params,D=1,T=1;if(o.mat3.fromMat4(U,n),a){var R=a(q);D=R[0],T=R[5],c=(s=U)[0],u=s[1],p=s[2],h=s[3],v=s[4],m=s[5],g=s[6],y=s[7],_=s[8],w=1/Math.sqrt(c*c+u*u+p*p),S=1/Math.sqrt(h*h+v*v+m*m),O=1/Math.sqrt(g*g+y*y+_*_),s[0]=c*w,s[1]=u*w,s[2]=p*w,s[3]=h*S,s[4]=v*S,s[5]=m*S,s[6]=g*O,s[7]=y*O,s[8]=_*O}var I=C.getVertexAttr()[x.VertexAttrConstants.POSITION],N=C.getVertexAttr()[x.VertexAttrConstants.SIZE],G=C.getVertexAttr()[x.VertexAttrConstants.NORMAL],Z=C.getVertexAttr()[x.VertexAttrConstants.AUXPOS1];x.assert(I.size>=3);var Y=r.point,Q=r.camera,J=M.calculateAnchorPosForRendering(A);D*=Q.pixelRatio,T*=Q.pixelRatio;for(var K="screen"===this.params.centerOffsetUnits,$=0;$<I.data.length/I.size;$++){var ee=$*I.size;d.vec3.set(V,I.data[ee],I.data[ee+1],I.data[ee+2]),d.vec3.transformMat4(V,V,n);var te=$*N.size;X[0]=N.data[te]*D,X[1]=N.data[te+1]*T,d.vec3.transformMat4(V,V,Q.viewMatrix);var ne=$*Z.size;if(d.vec3.set(k,Z.data[ne+0],Z.data[ne+1],Z.data[ne+2]),!K&&(V[0]+=k[0],V[1]+=k[1],0!==k[2])){var re=k[2];d.vec3.normalize(k,V),d.vec3.subtract(V,V,d.vec3.scale(k,k,re))}var ie=$*G.size;if(d.vec3.set(z,G.data[ie],G.data[ie+1],G.data[ie+2]),this.normalAndViewAngle(z,U,Q,B),this.applyVerticalOffsetTransformationView(V,B,Q,E),Q.applyProjection(V,L),L[0]>-1){var ae=Math.floor(L[0])+this.params.screenOffset[0],oe=Math.floor(L[1])+this.params.screenOffset[1];K&&(ae+=k[0],0!==k[1]&&(oe+=b.applyScaleFactor(k[1],E.factorAlignment))),b.applyPrecomputedScaleFactor(X,E.factor,X);var se=void 0;if(A.textureIsSignedDistanceField&&(se=A.outlineSize*Q.pixelRatio/2),j(Y,ae,oe,X,W*Q.pixelRatio,se,A,J)){var le=r.ray;d.vec3.transformMat4(F,V,l.mat4.invert(H,Q.viewMatrix)),L[0]=Y[0],L[1]=Y[1],Q.unprojectPoint(L,V);var ce=f.vec3f64.create();d.vec3.copy(ce,le.direction);var ue=1/d.vec3.length(ce);d.vec3.scale(ce,ce,ue),i(d.vec3.distance(le.origin,V)*ue,ce,-1,1,!0,F)}}}}},t.prototype.computeAttachmentOrigin=function(e,t){var n=e.data,r="getVertexAttr"in n?n.getVertexAttr():"vertexAttr"in n?n.vertexAttr:null;if(!r)return null;var i=x.VertexAttrConstants.POSITION,a=r[i],o="getIndices"in n?n.getIndices(i):"indices"in n?n.indices[i]:null;return g.computeAttachmentOriginPoints(a,o,t)},t.prototype.createBufferWriter=function(){return new K(this)},t.prototype.createRenderer=function(e,t){return new O(e,t,this)},t.prototype.normalAndViewAngle=function(e,t,n,r){return h.isMat4(t)&&(t=o.mat3.fromMat4(G,t)),d.vec3.transformMat3(r.normal,e,t),d.vec3.transformMat4(r.normal,r.normal,n.viewInverseTransposeMatrix),r.cosAngle=d.vec3.dot(N,Y),r},t.prototype.updateScaleInfo=function(e,t,n){var r=this.params;r.screenSizePerspective?b.precomputeScaleFactor(n,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),r.screenSizePerspectiveAlignment?b.precomputeScaleFactor(n,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)},t.prototype.applyShaderOffsetsView=function(e,t,n,r,i,a,o){var s=this.normalAndViewAngle(t,n,i,B);return this.applyVerticalGroundOffsetView(e,s,i,o),this.applyVerticalOffsetTransformationView(o,s,i,a),this.applyPolygonOffsetView(o,s,r[3],i,o),this.applyCenterOffsetView(o,r,o),o},t.prototype.applyShaderOffsetsNDC=function(e,t,n,r,a){return this.applyCenterOffsetNDC(e,t,n,r),i.isSome(a)&&d.vec3.copy(a,r),this.applyPolygonOffsetNDC(r,t,n,r),r},t.prototype.applyPolygonOffsetView=function(e,t,n,i,a){var o=i.aboveGround?1:-1,s=r.sign(n);0===s&&(s=o);var l=o*s;if(this.params.shaderPolygonOffset<=0)return d.vec3.copy(a,e);var c=r.clamp(Math.abs(t.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/i.viewport[2];return d.vec3.scale(a,e,l>0?u:1/u),a},t.prototype.applyVerticalGroundOffsetView=function(e,t,n,r){var i=d.vec3.length(e),a=n.aboveGround?1:-1,o=.5*n.computeRenderPixelSizeAtDist(i),s=d.vec3.scale(V,t.normal,a*o);return d.vec3.add(r,e,s),r},t.prototype.applyVerticalOffsetTransformationView=function(e,t,n,r){var i=this.params;if(!i.verticalOffset||!i.verticalOffset.screenLength){if(i.screenSizePerspective||i.screenSizePerspectiveAlignment){var a=d.vec3.length(e);this.updateScaleInfo(r,a,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}var o=d.vec3.length(e),s=S.verticalOffsetAtDistance(n,o,i.verticalOffset,t.cosAngle,i.screenSizePerspectiveAlignment||i.screenSizePerspective);return this.updateScaleInfo(r,o,t.cosAngle),d.vec3.scale(t.normal,t.normal,s),d.vec3.add(e,e,t.normal)},t.prototype.applyCenterOffsetView=function(e,t,n){var r="screen"!==this.params.centerOffsetUnits;return n!==e&&d.vec3.copy(n,e),r&&(n[0]+=t[0],n[1]+=t[1],t[2]&&(d.vec3.normalize(z,n),d.vec3.add(n,n,d.vec3.scale(z,z,t[2])))),n},t.prototype.applyCenterOffsetNDC=function(e,t,n,r){var i="screen"!==this.params.centerOffsetUnits;return r!==e&&d.vec3.copy(r,e),i||(r[0]+=t[0]/n.fullWidth*2,r[1]+=t[1]/n.fullHeight*2),r},t.prototype.applyPolygonOffsetNDC=function(e,t,n,i){var a=this.params.shaderPolygonOffset;if(e!==i&&d.vec3.copy(i,e),a){var o=n.aboveGround?1:-1,s=o*r.sign(t[3]);i[2]-=(s||o)*a}return i},t.prototype.getGLMaterial=function(e){return 0===e.output?new T(e):4===e.output?new R(e):void 0},t.prototype.calculateRelativeScreenBounds=function(e,t,n){return void 0===n&&(n=v.create()),function(e,t,n,r){void 0===r&&(r=I),u.vec2.copy(r,e.anchorPos),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*n,r[1]+=e.screenOffset[1]*n}(this.params,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n},t.shouldRenderVisibilityDuringRenderPass=function(e){return 0===e||4},t}(_.Material);t.default=A;var D=function(e){function t(t){var r=e.call(this,n.__assign(n.__assign({},t),t.material.getParameters()))||this;return r.updateParameters(),r}return n.__extends(t,e),t.prototype.beginSlot=function(e){return e===(this.params.drawInSecondSlot?19:18)},t.prototype.updateParameters=function(){this.params=S.copyParameters(this.material.getParameters()),this.updateTexture(this.params.textureId),this.selectProgram()},t.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(C.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.params,t)},t}(y),T=function(e){function t(t){var r=e.call(this,n.__assign(n.__assign({},t),{output:0}))||this;return r.isOcclusionSlot=!1,r}return n.__extends(t,e),t.prototype.beginSlot=function(e){var t=this.params.drawInSecondSlot?19:18;return this.params.occlusionTest?(this.isOcclusionSlot=12===e,12===e||e===t):(this.isOcclusionSlot=!1,e===t)},t.prototype.getTechnique=function(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique},t.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(C.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique),this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(C.HUDMaterialTechnique,this.material.getTechniqueConfig(6),this.occlusionTechnique)},t.prototype.bind=function(e,t){var n=this.getTechnique();e.bindProgram(n.program),this.isOcclusionSlot||(this.bindTexture(e,n.program),this.bindTextureScale(e,n.program)),n.bindPass(e,this.params,t)},t}(D),R=function(e){function t(t){return e.call(this,n.__assign(n.__assign({},t),{output:4}))||this}return n.__extends(t,e),t}(D);function j(e,t,n,r,i,a,o,s){var l=t-i-(s[0]>0?r[0]*s[0]:0),c=l+r[0]+2*i,u=n-i-(s[1]>0?r[1]*s[1]:0),p=u+r[1]+2*i;if(o.textureIsSignedDistanceField){var d=o.distanceFieldBoundingBox;l+=r[0]*d[0],u+=r[1]*d[1],c-=r[0]*(1-d[2]),p-=r[1]*(1-d[3]),l-=a,c+=a,u-=a,p+=a}return e[0]>l&&e[0]<c&&e[1]>u&&e[1]<p}var E={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},I=p.vec2f64.create(),V=f.vec3f64.create(),z=f.vec3f64.create(),L=a.createRenderScreenPointArray3(),N=f.vec3f64.create(),F=f.vec3f64.create(),U=s.mat3f64.create(),G=s.mat3f64.create(),H=c.mat4f64.create(),k=f.vec3f64.create(),B={normal:N,cosAngle:0},q=c.mat4f64.create(),W=1,Z=2,X=[0,0],Y=f.vec3f64.fromValues(0,0,1),Q={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:p.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,debugDrawBorder:!1},J=m.newLayout().vec3f(x.VertexAttrConstants.POSITION).vec3f(x.VertexAttrConstants.NORMAL).vec2f(x.VertexAttrConstants.UV0).vec4u8(x.VertexAttrConstants.COLOR).vec2f(x.VertexAttrConstants.SIZE).vec4f(x.VertexAttrConstants.AUXPOS1).vec4f(x.VertexAttrConstants.AUXPOS2),K=function(){function e(e){this.material=e,this.vertexBufferLayout=J}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[x.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,n,r){w.writePosition(t.indices[x.VertexAttrConstants.POSITION],t.vertexAttr[x.VertexAttrConstants.POSITION].data,e.transformation,n.position,r,6),w.writeNormal(t.indices[x.VertexAttrConstants.NORMAL],t.vertexAttr[x.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,n.normal,r,6);var i=t.vertexAttr[x.VertexAttrConstants.UV0].data,a=void 0,o=void 0,s=void 0,l=void 0;if(null==i||i.length<4){var c=this.material.getParameters();a=0,o=0,s=c.texCoordScale[0],l=c.texCoordScale[1]}else a=i[0],o=i[1],s=i[2],l=i[3];s=Math.min(1.99999,s+1),l=Math.min(1.99999,l+1);for(var u=t.indices[x.VertexAttrConstants.POSITION].length,p=n.uv0,d=r,f=0;f<u;++f)p.set(d,0,a),p.set(d,1,o),p.set(d+=1,0,s),p.set(d,1,o),p.set(d+=1,0,s),p.set(d,1,l),p.set(d+=1,0,s),p.set(d,1,l),p.set(d+=1,0,a),p.set(d,1,l),p.set(d+=1,0,a),p.set(d,1,o),d+=1;w.writeColor(t.indices[x.VertexAttrConstants.COLOR],t.vertexAttr[x.VertexAttrConstants.COLOR].data,4,n.color,r,6);var h=t.indices[x.VertexAttrConstants.SIZE],v=t.vertexAttr[x.VertexAttrConstants.SIZE].data,m=h.length,g=n.size;for(d=r,f=0;f<m;++f)for(var y=v[2*h[f]],_=v[2*h[f]+1],b=0;b<6;++b)g.set(d,0,y),g.set(d,1,_),d+=1;t.indices[x.VertexAttrConstants.AUXPOS1]&&t.vertexAttr[x.VertexAttrConstants.AUXPOS1]&&w.writeBufferVec4(t.indices[x.VertexAttrConstants.AUXPOS1],t.vertexAttr[x.VertexAttrConstants.AUXPOS1].data,n.auxpos1,r,6),t.indices[x.VertexAttrConstants.AUXPOS2]&&t.vertexAttr[x.VertexAttrConstants.AUXPOS2]&&w.writeBufferVec4(t.indices[x.VertexAttrConstants.AUXPOS2],t.vertexAttr[x.VertexAttrConstants.AUXPOS2].data,n.auxpos2,r,6)},e}()}).apply(null,r))||(e.exports=i)},y68M:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("qMld")],void 0===(i=(function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){this.technique=e,this.refCount=0,this.refZeroFrame=0},o=function(){function e(e){this._context=e,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=1200}return Object.defineProperty(e.prototype,"viewingMode",{get:function(){return this._context.viewingMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"constructionContext",{get:function(){return this._context},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.dispose()}))})),this._perConstructorInstances.clear()},e.prototype.acquire=function(e,t){var n=t.key,r=this._perConstructorInstances.get(e);r||(r=new Map,this._perConstructorInstances.set(e,r));var i=r.get(n);return void 0===i&&(i=new a(new e(this._context,t)),r.set(n,i)),++i.refCount,i.technique},e.prototype.acquireAndReleaseExisting=function(e,t,n){return r.isNone(n)?this.acquire(e,t):t.key===n.key&&n instanceof e?n:(this.release(n),this.acquire(e,t))},e.prototype.release=function(e){var t=this._perConstructorInstances.get(e.constructor).get(e.key);t.refCount-=1,0===t.refCount&&(t.refZeroFrame=this._frameCounter)},e.prototype.frameUpdate=function(){var e=this;this._frameCounter++,this._perConstructorInstances.forEach((function(t,n){t.forEach((function(n,r){0===n.refCount&&n.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(n.technique.dispose(),t.delete(r))})),0===t.size&&e._perConstructorInstances.delete(n)}))},e.prototype.getProgramsUsingUniform=function(e){return this._context.commonUniformStore.getPrograms(e)},e.prototype.hotReload=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t=this;return n.__generator(this,(function(r){switch(r.label){case 0:return e=new Array,this._perConstructorInstances.forEach((function(r,i){e.push(function(e,r){return n.__awaiter(t,void 0,void 0,(function(){var t,i=this;return n.__generator(this,(function(n){switch(n.label){case 0:return(t=r.shader)?[4,t.reload()]:[3,2];case 1:n.sent(),e.forEach((function(e){e.technique.reload(i._context)})),n.label=2;case 2:return[2]}}))}))}(r,i))})),[4,i.all(e)];case 1:return r.sent(),[2]}}))}))},e}();t.ShaderTechniqueRepository=o}).apply(null,r))||(e.exports=i)},yVFQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("qsST"),n("ZcgO"),n("sCbS")],void 0===(i=(function(e,t,n,r,i,a){Object.defineProperty(t,"__esModule",{value:!0});var o=r.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function s(e){return null!=e.cachedResult}function l(e){return"0"===e?0:null}t.clone=function(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}},t.createContextWithoutExpressionSupport=function(e){var t=e&&e.expression;if("string"==typeof t){var n=l(t);if(null!=n)return{cachedResult:n}}return null},t.createContext=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,o,s,c,u;return n.__generator(this,(function(n){switch(n.label){case 0:return"string"!=typeof(i=e&&e.expression)?[2,null]:null!=(o=l(i))?[2,{cachedResult:o}]:[4,a.loadArcade()];case 1:return s=n.sent(),u=(c=s.arcadeUtils).createSyntaxTree(i),c.dependsOnView(u)?(null!=r&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),[2,{cachedResult:0}]):[2,{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:s}}]}}))}))},t.createFeature=function(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)},t.setContextFeature=function(e,t){if(null!=e&&!s(e)){if(!t||!e.arcade)return void o.errorOncePerTick("Arcade support required but not provided");t._geometry&&(t._geometry=i.hydrateGeometry(t._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}},t.execute=function(e){if(null!=e){if(s(e))return e.cachedResult;var t=e.arcade,n=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0},t.extractExpressionInfo=function(e,t){void 0===t&&(t=!1);var n=e&&e.featureExpressionInfo;return t||"0"===(n&&n.expression)||(n=null),n},t.zeroContext={cachedResult:0}}).apply(null,r))||(e.exports=i)},ybGv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Gamma=function(e){e.fragment.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    const float GAMMA = 2.2;\n    const float INV_GAMMA = 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "],["\n    const float GAMMA = 2.2;\n    const float INV_GAMMA = 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},yjgM:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("QDcU"),n("eIBl"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("DtIM"),n("woUR"),n("B3XD"),n("X5J5"),n("Fe95"),n("48/q"),n("dtql"),n("TIRl"),n("JjCO"),n("ys4y"),n("4ziW"),n("o5p5"),n("bz+r")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x,w){Object.defineProperty(t,"__esModule",{value:!0});var S=function(e){function t(t){var n=e.call(this)||this;return n._handles=new i,n._snapToScene=new g.SnapToScene,n._discMaterial=n._createMaterial(),n._discMaterialTransparent=n._createMaterial(.5),n._scale=1,n._radius=h.DISC_RADIUS,n._view=t.view,n._tool=t.tool,null!=t.snapToScene&&(n.snapToScene=t.snapToScene),null!=t.radius&&(n._radius=t.radius),n._createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return n.__extends(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null},t.prototype.forEachManipulator=function(e){e(this._manipulator,1)},Object.defineProperty(t.prototype,"displayScale",{get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapToScene",{get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())},enumerable:!0,configurable:!0}),t.prototype.createGraphicDragPipeline=function(e,t){var n=this,r=e.graphic,i=u.getGraphicEffectiveElevationInfo(r),o=a.unwrap(r.geometry).spatialReference;return m.createGraphicMoveDragPipeline(e,t,(function(e){return n.createDragPipeline(e,i,o)}))},t.prototype.createDragPipeline=function(e,t,n){var r=this,i=this._view;return w.createManipulatorDragEventPipeline(this._manipulator,(function(a,o,s,l){var c=o.next(w.dragAtLocation(i,a.elevationAlignedLocation)).next(d.screenToMapXYAtLocation(i,a.elevationAlignedLocation,t,n)).next(r._snapToScene.createDragEventPipelineStep(i,t),r._snapToScene.next).next(w.addScreenDelta());e(a,c,s,l)}))},t.prototype._updateManipulatorTransform=function(){var e=o.mat4.fromScaling(y.sm4d.get(),l.vec3.set(y.sv3d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e},t.prototype._createManipulator=function(){this._manipulator=new p.Manipulator3D({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:c.vec3f64.fromValues(0,0,1)},worldOriented:!0}),this._updateManipulator()},t.prototype._updateManipulator=function(){var e=new _(b.createCylinderGeometry(h.DISC_HEIGHT,1,h.GEOMETRY_SEGMENTS,c.vec3f64.fromValues(0,0,1),c.vec3f64.fromValues(0,0,0)),"graphic-transform-disc"),t=o.mat4.fromScaling(s.mat4f64.create(),c.vec3f64.fromValues(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=h.DISC_COLLISION_RADIUS*(this._radius/h.DISC_RADIUS)},t.prototype._createMaterial=function(e){void 0===e&&(e=1);var t=r.toUnitRGBA(f.colors.main);t[3]*=e;var n=new x({color:t,transparent:1!==e,cullFace:2},"move-xy-disc");return n.renderOccluded=2,n},Object.defineProperty(t.prototype,"test",{get:function(){return{discManipulator:this._manipulator}},enumerable:!0,configurable:!0}),t}(v.Manipulation);t.MoveXYDiscManipulation=S}).apply(null,r))||(e.exports=i)},yqrJ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("pcDC"),n("ma1f"),n("BcWh"),n("xoE+"),n("xoE+"),n("LxLY"),n("qMld"),n("rusB"),n("jfWY"),n("R6Tp"),n("weRx"),n("EyQ4"),n("/Bau"),n("W0kZ"),n("CIy2"),n("/f24"),n("Zp3t"),n("Kfys"),n("7laH")],void 0===(i=(function(e,t,n,r,i,a,o,s,l,c,u,p,d,f,h,v,m,g,y,_,b,x){return function(){function e(t,n,r){this.data=t,this.glTexture=null,this.powerOfTwoStretchInfo=null,this.loadingPromise=null,this.loadingController=null,this.events=new a,this.data=t,this.id=e.idGen.gen(n),this.params=r||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=e.estimateTexMemRequired(this.data,this.params),this.startPreload()}return e.prototype.startPreload=function(){var e=this.data;l.isNone(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))},e.prototype.startPreloadVideoElement=function(e){p.isBlobProtocol(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)},e.prototype.startPreloadImageElement=function(e){p.isDataProtocol(e.src)||p.isBlobProtocol(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)},e.getDataDimensions=function(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e},e.estimateTexMemRequired=function(t,n){if(l.isNone(t))return 0;if(u.isArrayBuffer(t)||u.isUint8Array(t))return t.byteLength;var r=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?e.getDataDimensions(t):n;return(n.mipmap?4/3:1)*r.width*r.height*(n.components||4)||0},e.prototype.dispose=function(){this.data=void 0},Object.defineProperty(e.prototype,"width",{get:function(){return this.params.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.params.height},enumerable:!0,configurable:!0}),e.prototype.createDescriptor=function(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.mipmap&&!this.params.disableAnisotropy?e.parameters.maxMaxAnisotropy:void 0}},e.prototype.load=function(t,n){if(l.isSome(this.glTexture))return this.glTexture;if(l.isSome(this.loadingPromise))return this.loadingPromise;var i=this.data;return l.isNone(i)?(this.glTexture=new _(t,this.createDescriptor(t),null),t.bindTexture(this.glTexture),this.glTexture):"string"==typeof i?this.loadFromURL(t,n,i):i instanceof Image?this.loadFromImageElement(t,n,i):i instanceof HTMLVideoElement?this.loadFromVideoElement(t,n,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this.loadFromImage(t,i,n):(u.isArrayBuffer(i)||u.isUint8Array(i))&&this.params.encoding===e.DDS_ENCODING?this.loadFromDDSData(t,i):u.isUint8Array(i)?this.loadFromPixelData(t,i):u.isArrayBuffer(i)?this.loadFromPixelData(t,new Uint8Array(i)):(r.neverReachedSilent(i),null)},Object.defineProperty(e.prototype,"requiresFrameUpdates",{get:function(){return this.data instanceof HTMLVideoElement},enumerable:!0,configurable:!0}),e.prototype.frameUpdate=function(e,t,n){if(!(this.data instanceof HTMLVideoElement)||l.isNone(this.glTexture))return n;if(this.data.readyState<2||n===this.data.currentTime)return n;if(l.isSome(this.powerOfTwoStretchInfo)){var r=this.powerOfTwoStretchInfo,i=r.framebuffer,a=r.vao,o=r.sourceTexture;o.setData(this.data),this.drawStretchedTexture(e,t,i,a,o,this.glTexture)}else{var s=this.data,c=s.width,u=s.height,p=this.glTexture.descriptor,d=p.width,f=p.height;c!==d||u!==f?this.glTexture.updateData(0,0,0,Math.min(c,d),Math.min(u,f),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime},e.prototype.loadFromDDSData=function(e,t){return this.glTexture=h.createDDSTexture(e,this.createDescriptor(e),t,this.params.mipmap),e.bindTexture(this.glTexture),this.glTexture},e.prototype.loadFromPixelData=function(e,t){g.assert(this.params.width>0&&this.params.height>0);var n=this.createDescriptor(e);return n.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,n.width=this.params.width,n.height=this.params.height,this.glTexture=new _(e,n,t),e.bindTexture(this.glTexture),this.glTexture},e.prototype.loadAsync=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i,a=this;return n.__generator(this,(function(n){return t=c.createAbortController(),this.loadingController=t,r=e(t.signal),this.loadingPromise=r,r.then(i=function(){a.loadingController===t&&(a.loadingController=null),a.loadingPromise===r&&(a.loadingPromise=null)},i),[2,r]}))}))},e.prototype.loadFromURL=function(e,t,r){var i=this;return this.loadAsync((function(a){return n.__awaiter(i,void 0,void 0,(function(){var i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,f.requestImage(r,{signal:a})];case 1:return i=n.sent(),[2,this.loadFromImage(e,i,t)]}}))}))}))},e.prototype.loadFromImageElement=function(e,t,r){var i=this;return r.complete?this.loadFromImage(e,r,t):this.loadAsync((function(a){return n.__awaiter(i,void 0,void 0,(function(){var i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,d.loadImageAsync(r,r.src,!1,a)];case 1:return i=n.sent(),[2,this.loadFromImage(e,i,t)]}}))}))}))},e.prototype.loadFromVideoElement=function(e,t,n){return n.readyState>=2?this.loadFromImage(e,n,t):this.loadFromVideoElementAsync(e,t,n)},e.prototype.loadFromVideoElementAsync=function(e,t,n){var r=this;return this.loadAsync((function(a){return c.create((function(o,s){var u=function(){n.removeEventListener("loadeddata",p),n.removeEventListener("error",d),l.isSome(f)&&f.remove()},p=function(){n.readyState>=2&&(u(),o(r.loadFromImage(e,n,t)))},d=function(e){u(),s(e||new i("Failed to load video"))};n.addEventListener("loadeddata",p),n.addEventListener("error",d);var f=c.onAbort(a,(function(){return d(c.createAbortError())}))}))}))},e.prototype.loadFromImage=function(t,n,r){var i=e.getDataDimensions(n);this.params.width=i.width,this.params.height=i.height;var a=this.createDescriptor(t);return a.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(t,a)||s.isPowerOfTwo(i.width)&&s.isPowerOfTwo(i.height)?(a.width=i.width,a.height=i.height,this.glTexture=new _(t,a,n),t.bindTexture(this.glTexture),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(t,n,i,a,r),t.bindTexture(this.glTexture),this.glTexture)},e.prototype.requiresPowerOfTwo=function(e,t){var n="number"==typeof t.wrapMode?33071===t.wrapMode:33071===t.wrapMode.s&&33071===t.wrapMode.t;return!x.default(e.gl)&&(t.hasMipmap||!n)},e.prototype.makePowerOfTwoTexture=function(e,t,n,i,a){var s,l=n.width,c=n.height,u=o.nextHighestPowerOfTwo(l),p=o.nextHighestPowerOfTwo(c);switch(i.width=u,i.height=p,this.params.powerOfTwoResizeMode){case 2:i.textureCoordinateScaleFactor=[l/u,c/p],(s=new _(e,i)).updateData(0,0,0,l,c,t);break;case 1:case null:case void 0:s=this.stretchToPowerOfTwo(e,t,i,a);break;default:r.neverReached(this.params.powerOfTwoResizeMode)}return i.hasMipmap&&s.generateMipmap(),s},e.prototype.stretchToPowerOfTwo=function(e,t,n,r){var i=new _(e,n),a=new y(e,{colorTarget:0,depthStencilTarget:0},i),o=new _(e,{target:3553,pixelFormat:n.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!n.flipped,maxAnisotropy:8,preMultiplyAlpha:n.preMultiplyAlpha},t),s=v.createQuadVAO(e);return this.drawStretchedTexture(e,r,a,s,o,i),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:s,sourceTexture:o,framebuffer:a}:(s.dispose(!0),o.dispose(),a.detachColorTexture(),e.bindFramebuffer(null),a.dispose()),i},e.prototype.drawStretchedTexture=function(e,t,n,r,i,a){e.bindFramebuffer(n);var o=e.getViewport();e.setViewport(0,0,a.descriptor.width,a.descriptor.height);var s=t.program;e.bindProgram(s),s.setUniform4f("color",1,1,1,1),s.setUniform1i("tex",0),e.bindTexture(i,0),e.bindVAO(r),e.setPipelineState(t.pipeline),e.drawArrays(5,0,b.vertexCount(r,"geometry")),e.bindFramebuffer(null),e.setViewport(o.x,o.y,o.width,o.height)},e.prototype.unload=function(){if(l.isSome(this.powerOfTwoStretchInfo)){var e=this.powerOfTwoStretchInfo,t=e.framebuffer,n=e.sourceTexture;e.vao.dispose(!0),n.dispose(),t.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if(l.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),l.isSome(this.loadingController)){var r=this.loadingController;this.loadingController=null,this.loadingPromise=null,r.abort()}this.events.emit("unloaded")},e.idGen=new m.IdGen,e.DDS_ENCODING="image/vnd-ms.dds",e}()}).apply(null,r))||(e.exports=i)},ys4y:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("3RHn"),n("+nCE"),n("W0kZ"),n("CIy2"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,a,o){return function(){function e(t,n,r){this._boundingInfo=null,this._id=e.__idGen.gen(n),this._data=t,this._boundingInfo=r}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.getIndices=function(e){return this.data.getIndices(e)},Object.defineProperty(e.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),e.prototype.getAttribute=function(e){return this.data.getAttribute(e)},Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo},enumerable:!0,configurable:!0}),e.prototype.computeAttachmentOrigin=function(e){return"triangle"===this.data.primitiveType?this.computeAttachmentOriginTriangles(e):this.computeAttachmentOriginPoints(e)},e.prototype.computeAttachmentOriginTriangles=function(e){var t=this.getIndices(o.VertexAttrConstants.POSITION),n=this.getAttribute(o.VertexAttrConstants.POSITION);return r.computeAttachmentOriginTriangles(n,t,e)},e.prototype.computeAttachmentOriginPoints=function(e){var t=this.getIndices(o.VertexAttrConstants.POSITION),n=this.getAttribute(o.VertexAttrConstants.POSITION);return r.computeAttachmentOriginPoints(n,t,e)},e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null},e.prototype._calculateBoundingInfo=function(){var e=this.data.getIndices(o.VertexAttrConstants.POSITION),t=this.data.getAttribute(o.VertexAttrConstants.POSITION),i="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(i);for(var s=0;s<i;++s)e[s]=s}var l=e.length;a.assert(l%i==0,"Indexing error: "+l.toFixed(0)+" not divisible by "+i.toFixed(0));var c=r.generateDefaultIndexArray(l/i);return new n(c,i,e,t)},e.__idGen=new i.IdGen,e}()}).apply(null,r))||(e.exports=i)},z4cv:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[1,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3]]},t.fromValues=function(e,t,n,r){return[e,t,n,r]},t.createView=function(e,t){return new Float64Array(e,t,4)}}).apply(null,r))||(e.exports=i)},znI2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("CIy2")],void 0===(i=(function(e,t,n){function r(e){return n.getFirstObjectValue(e.data.indices).length>=1}Object.defineProperty(t,"__esModule",{value:!0}),t.splitRenderGeometryChangeSetByMaterial=function(e){for(var t=new Map,n=null,i=null,a=function(e){if(e===n)return i;var r=t.get(e);return r||t.set(e,r={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1}),n=e,i=r,r},o=0;o<e.numToAdd;o++)r(s=e.toAdd[o])&&a(s.material).toAdd.push(s);for(o=0;o<e.numToRemove;o++){var s;r(s=e.toRemove[o])&&a(s.material).toRemove.push(s)}for(o=0;o<e.numToUpdate;o++){var l=e.toUpdate[o];r(l.renderGeometry)&&a(l.renderGeometry.material).toUpdate.push(l)}return t}}).apply(null,r))||(e.exports=i)}}]);