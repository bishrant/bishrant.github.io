(function(){(this||window).webpackJsonp.registerAbsMids({"arcgis-js-api/layers/support/RasterStorageInfo":"0GEy","arcgis-js-api/layers/support/rasterDatasets/RasterFactory":"20+E","arcgis-js-api/layers/support/rasterDatasets/MRFRaster":"2VC8","arcgis-js-api/layers/support/DimensionalDefinition":"7Rj3","arcgis-js-api/layers/support/RasterFunction":"97bx","arcgis-js-api/layers/support/rasterDatasets/CloudRaster":"ANQh","arcgis-js-api/layers/support/TilemapCache":"Cobz","arcgis-js-api/geometry/support/GeographicTransformationStep":"MbkH","arcgis-js-api/geometry/support/GeographicTransformation":"OkCb","arcgis-js-api/layers/mixins/PortalLayer":"QJ8R","arcgis-js-api/layers/support/RasterJobHandler":"T/jF","arcgis-js-api/layers/mixins/RefreshableLayer":"WaJo","arcgis-js-api/layers/support/imageryRendererUtils":"YM6P","arcgis-js-api/layers/support/rasterDatasets/BaseRaster":"bF83","arcgis-js-api/support/popupUtils":"begh","arcgis-js-api/layers/support/rasterDatasets/xmlUtilities":"d9Lx","arcgis-js-api/layers/support/rasterDatasets/TIFFRaster":"f8aF","arcgis-js-api/layers/support/rasterDatasets/DBFParser":"huIg","arcgis-js-api/layers/TileImageryLayer":"oKUA","arcgis-js-api/geometry/pe":"w7fK","arcgis-js-api/geometry/projection":"wIC5","arcgis-js-api/layers/support/rasterDatasets/ImageServerRaster":"xB1n","arcgis-js-api/layers/support/Tilemap":"xojL"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[50,16,34,93,94,95,96,97,98,99,100,110,111],{"0GEy":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("9opi"),r("qKT0"),r("ycL1"),r("Vx27"),r("oxlp")],void 0===(i=(function(e,t,r,n,i,o,a,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockWidth=void 0,t.blockHeight=void 0,t.compression=null,t.origin=null,t.firstPyramidLevel=null,t.maximumPyramidLevel=null,t.pyramidScalingFactor=2,t.pyramidBlockWidth=null,t.pyramidBlockHeight=null,t.tileInfo=null,t.blockBoundary=null,t}return n(t,e),i([a.property({type:Number,json:{write:!0}})],t.prototype,"blockWidth",void 0),i([a.property({type:Number,json:{write:!0}})],t.prototype,"blockHeight",void 0),i([a.property({type:String,json:{write:!0}})],t.prototype,"compression",void 0),i([a.property({type:s,json:{write:!0}})],t.prototype,"origin",void 0),i([a.property({type:Number,json:{write:!0}})],t.prototype,"firstPyramidLevel",void 0),i([a.property({type:Number,json:{write:!0}})],t.prototype,"maximumPyramidLevel",void 0),i([a.property()],t.prototype,"pyramidScalingFactor",void 0),i([a.property({type:Number,json:{write:!0}})],t.prototype,"pyramidBlockWidth",void 0),i([a.property({type:Number,json:{write:!0}})],t.prototype,"pyramidBlockHeight",void 0),i([a.property({json:{write:!0}})],t.prototype,"tileInfo",void 0),i([a.property()],t.prototype,"blockBoundary",void 0),i([a.subclass("esri.layers.support.RasterStorageInfo")],t)}(a.declared(o.JSONSupport))}).apply(null,n))||(e.exports=i)},"20+E":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q2wQ"),r("HZ3d"),r("PND3"),r("ma1f"),r("ANQh"),r("xB1n"),r("2VC8"),r("f8aF")],void 0===(i=(function(e,t,r,n,i,o,a,s,l,u){var p=new Map;return p.set("CRF",{desc:"Cloud Raster Format",constructor:a}),p.set("MRF",{desc:"Meta Raster Format",constructor:l}),p.set("TIFF",{desc:"GeoTIFF",constructor:u}),p.set("RasterTileServer",{desc:"Raster Tile Server",constructor:s}),function(){function e(){}return Object.defineProperty(e,"supportedFormats",{get:function(){for(var e=p.keys(),t=new i.default,r=e.next();!r.done;)t.add(r.value),r=e.next();return t},enumerable:!0,configurable:!0}),e.open=function(e){return n(this,void 0,void 0,(function(){var t,n,i,a,s,l,u,c,f,d;return r(this,(function(r){switch(r.label){case 0:return t=e.url,n=e.ioConfig,null==(i=e.datasetFormat)&&t.lastIndexOf(".")&&(i=t.slice(t.lastIndexOf(".")+1).toUpperCase()),"OVR"===i||"TIF"===i?i="TIFF":t.toLowerCase().indexOf("/imageserver")>-1&&(i="RasterTileServer"),a={resolution:null,bandIds:null,sampling:null},s={url:t,datasetFormat:i,ioConfig:n||a},this.supportedFormats.has(i)?(l=p.get(i).constructor,[4,(u=new l(s)).open({signal:e.signal})]):[3,2];case 1:return r.sent(),[2,u];case 2:if(i)throw new o("rasterfactory:open","not a supported format "+i);return c=Array.from(p.keys()),f=0,[2,(d=function(){return(i=c[f++])?(l=p.get(i).constructor,(u=new l(s)).open({signal:e.signal}).then((function(){return u})).catch((function(){return d()}))):null})()]}}))}))},e.register=function(e,t,r){p.has(e.toUpperCase())||p.set(e.toUpperCase(),{desc:t,constructor:r})},e}()}).apply(null,n))||(e.exports=i)},"2VC8":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q2wQ"),r("qKT0"),r("HZ3d"),r("9opi"),r("TMur"),r("ma1f"),r("LxLY"),r("qMld"),r("Vx27"),r("dXLH"),r("Kjnw"),r("0GEy"),r("bF83"),r("d9Lx")],void 0===(i=(function(e,t,r,n,i,o,a,s,l,u,p,c,f,d,h,m){var y,_,v=(y=new ArrayBuffer(4),_=new Uint8Array(y),new Uint32Array(y)[0]=1,1===_[0]),g=new Map;g.set("Int8","s8"),g.set("UInt8","u8"),g.set("Int16","s16"),g.set("UInt16","u16"),g.set("Int32","s32"),g.set("UInt32","u32"),g.set("Float32","f32"),g.set("Float64","f32"),g.set("Double64","f32");var b=new Map;return b.set("lerc",".lrc"),b.set("none",".til"),b.set("deflate",".pzp"),b.set("jpeg",".jzp"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._files=null,t._storageIndex=null,t}return o(t,e),t.prototype.open=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,s,u,p,c,f,d,h,m,y,_,v,g,b,w;return r(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),t=e?l.unwrap(e.signal):null,[4,this.request({url:this.url,responseType:"xml"},t)];case 2:return n=r.sent(),i=this._parseHeader(n),o=i.files,this._set("rasterInfo",i.rasterInfo),this._files=o,[4,this.request({url:o.index,responseType:"array-buffer"},t)];case 3:for(a=r.sent(),this._storageIndex=this._parseIndex(a),s=0,u=-1,d=(f=this.rasterInfo.storageInfo).blockWidth,h=f.blockHeight,m=this.rasterInfo.storageInfo.pyramidScalingFactor,_=(y=this.rasterInfo).width,v=y.height,g=y.bandCount,b=[],w="none"===f.compression?1:g;s<this._storageIndex.length;)u++,p=Math.ceil(_/d/Math.pow(m,u)),c=Math.ceil(v/h/Math.pow(m,u)),s+=p*c*w*4,b.push({maxRow:c,maxCol:p,minCol:0,minRow:0});return this.rasterInfo.storageInfo.blockBoundary=b,u>0&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=u),[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,o){return void 0===o&&(o={}),i(this,void 0,void 0,(function(){var i,a,s,l,p,f,d,h,m,y,_,v,g,b,w,P,x,T,I,S,E,R,O,M;return r(this,(function(r){switch(r.label){case 0:if(a=(i=this.rasterInfo.storageInfo).blockWidth,s=i.blockHeight,l=i.compression,!(p=i.blockBoundary[e])||p.maxRow<t||p.maxCol<n||p.minRow>t||p.minCol>n)return[2,null];if(d=(f=this.rasterInfo).bandCount,h=f.pixelType,m=this._getTileLocation(e,t,n),_=m.actualTileWidth,v=m.actualTileHeight,!(y=m.ranges)||0===y.length)return[2,null];if(0===y[0].from&&0===y[0].to)return M=new Uint8Array(a*s),[2,new c({width:a,height:s,pixels:null,mask:M,validPixelCount:0})];for(g=this.ioConfig.bandIds,b="none"===l?1:d,w=[],P=0,P=0;P<b;P++)(!g||g.indexOf[P]>-1)&&w.push(this.request({url:this._files.data,range:{from:y[P].from,to:y[P].to},responseType:"array-buffer"},o.signal));return[4,u.all(w)];case 1:for(x=r.sent(),T=x.map((function(e){return e.byteLength})).reduce((function(e,t){return e+t})),I=new Uint8Array(T),S=0,P=0;P<b;P++)I.set(new Uint8Array(x[P]),S),S+=x[P].byteLength;return[4,this.decodePixelBlock(I.buffer,{width:a,height:s,format:"lerc"===this.rasterInfo.storageInfo.compression?"lerc":"bip",pixelType:h})];case 2:if(E=r.sent(),R=0,O=0,_!==a||v!==s)if(M=E.mask)for(P=0;P<s;P++)if(O=P*a,P<v)for(R=_;R<a;R++)M[O+R]=0;else for(R=0;R<a;R++)M[O+R]=0;else for(M=new Uint8Array(a*s),E.mask=M,P=0;P<v;P++)for(O=P*a,R=0;R<_;R++)M[O+R]=1;return[2,E]}}))}))},t.prototype._parseIndex=function(e){if(e.byteLength%16>0)throw"invalid array buffer must be multiples of 16";var t,r,n,i,o,a;if(v){for(r=new Uint8Array(e),i=new ArrayBuffer(e.byteLength),n=new Uint8Array(i),o=0;o<e.byteLength/4;o++)for(a=0;a<4;a++)n[4*o+a]=r[4*o+3-a];t=new Uint32Array(i)}else t=new Uint32Array(e);return t},t.prototype._getTileLocation=function(e,t,r){var n,i,o,a=this.rasterInfo.storageInfo,s=a.blockWidth,l=a.blockHeight,u=a.pyramidScalingFactor,p=this.rasterInfo,c=p.width,f=p.height,d="none"===a.compression?1:p.bandCount,h=0,m=0;for(o=0;o<e;o++)m=Math.pow(u,o),h+=(n=Math.ceil(c/s/m))*(i=Math.ceil(f/l/m));m=Math.pow(u,e),n=Math.ceil(c/s/m),i=Math.ceil(f/l/m),h+=t*n+r;for(var y=this._storageIndex.subarray(h*=4*d,h+4*d),_=0,v=0,g=[],b=0;b<d;b++)v=(_=y[4*b+0]*Math.pow(2,32)+y[4*b+1])+y[4*b+2]*Math.pow(2,32)+y[4*b+3],g.push({from:_,to:v});return{ranges:g,actualTileWidth:r<n-1?s:Math.ceil(c/m)-s*(n-1),actualTileHeight:t<i-1?l:Math.ceil(f/m)-l*(i-1)}},t.prototype._parseHeader=function(e){var t=m.getElement(e,"MRF_META/Raster");if(!t)throw new s("mrf:open","not a valid MRF format");var r=m.getElement(t,"Size"),n=parseInt(r.getAttribute("x"),10),i=parseInt(r.getAttribute("y"),10),o=parseInt(r.getAttribute("c"),10),l=(m.getElementValue(t,"Compression")||"none").toLowerCase();if(!l||-1===["none","lerc"].indexOf(l))throw new s("mrf:open","currently does not support compression "+l);var u=m.getElementValue(t,"DataType")||"UInt8",p=g.get(u);if(null==p)throw new s("mrf:open","currently does not support pixel type "+u);var c,h,y=m.getElement(t,"PageSize"),_=parseInt(y.getAttribute("x"),10),v=parseInt(y.getAttribute("y"),10),w=m.getElement(t,"DataValues");if(w&&null!=(h=w.getAttribute("NoData"))&&(c=h.trim().split(" ").map((function(e){return parseFloat(e)}))),m.getElement(e,"MRF_META/CachedSource"))throw new s("mrf:open","currently does not support MRF referencing other data files");var P=m.getElement(e,"MRF_META/GeoTags"),x=m.getElement(P,"BoundingBox");if(null==x)throw new s("mrf:open","missing node MRF_META/GeoTags/BoundingBox");var T,I=parseFloat(x.getAttribute("minx")),S=parseFloat(x.getAttribute("miny")),E=parseFloat(x.getAttribute("maxx")),R=parseFloat(x.getAttribute("maxy")),O=m.getElementValue(P,"Projection"),M=m.getElementValue(e,"datafile"),C=m.getElementValue(e,"IndexFile");"LOCAL_CS[]"!==O&&(T=new a.SpatialReference({wkt:O}));var N=new a.Extent(I,S,E,R);N.spatialReference=T;var A=m.getElement(e,"MRF_META/Rsets"),F=parseInt(A&&A.getAttribute("scale")||"2",10),k=new d({origin:new a.Point({x:N.xmin,y:N.ymax,spatialReference:T}),blockWidth:_,blockHeight:v,pyramidBlockWidth:_,pyramidBlockHeight:v,compression:l,pyramidScalingFactor:F}),D=new a.Point({x:(E-I)/n,y:(R-S)/i,spatialReference:T});return{rasterInfo:new f({width:n,height:i,extent:N,spatialReference:T,bandCount:o,pixelType:p,pixelSize:D,noDataValue:c,storageInfo:k}),files:{mrf:this.url,index:C||this.url.replace(".mrf",".idx"),data:M||this.url.replace(".mrf",b.get(l))}}},n([p.property()],t.prototype,"_files",void 0),n([p.property()],t.prototype,"_storageIndex",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),n([p.subclass("esri.layers.support.rasterIO.MRFRaster")],t)}(p.declared(h))}).apply(null,n))||(e.exports=i)},"7Rj3":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("ycL1"),r("rg9i"),r("Vx27"),r("1dvD")],void 0===(i=(function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.variableName=null,r.dimensionName=null,r.values=[],r.isSlice=!1,r}var i;return r(t,e),i=t,t.prototype.clone=function(){return new i({variableName:this.variableName,dimensionName:this.dimensionName,values:o.clone(this.values),isSlice:this.isSlice})},n([a.property({type:String,json:{write:!0}})],t.prototype,"variableName",void 0),n([a.property({type:String,json:{write:!0}})],t.prototype,"dimensionName",void 0),n([a.property({type:s.types.array(s.types.oneOf([s.types.native(Number),s.types.array(s.types.native(Number))])),json:{write:!0}})],t.prototype,"values",void 0),n([a.property({type:Boolean,json:{write:!0}})],t.prototype,"isSlice",void 0),i=n([a.subclass("esri.layers.support.DimensionalDefinition")],t)}(a.declared(i.JSONSupport))}).apply(null,n))||(e.exports=i)},"97bx":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("ycL1"),r("rg9i"),r("ULaq"),r("Vx27")],void 0===(i=(function(e,t,r,n,i,o,a,s){var l,u=a.createSetFromValues(["Raster","Raster2","DEM","FillRaster"]),p=a.createSetFromValues(["Rasters"]),c=function(e){return e&&e.rasterFunction?d.fromJSON(e):e},f=function(e){return e&&e instanceof d?e.toJSON():e};!function(e){e[e.MOSAIC=0]="MOSAIC",e[e.GROUP=1]="GROUP",e[e.ITEM=2]="ITEM"}(l||(l={}));var d=function(e){function t(t){var r=e.call(this,t)||this;return r.functionArguments=null,r.functionName=null,r.outputPixelType="unknown",r.variableName=null,r.description=null,r.functionDefinition=null,r.thumbnail=null,r}var i;return r(t,e),i=t,t.prototype.readFunctionArguments=function(e,t){return function(e){if(null==e)return null;for(var t={},r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];t[i]=u.has(i)?c(e[i]):p.has(i)&&Array.isArray(e[i])?e[i].map(c):e[i]}return t}(t.arguments||t.rasterFunctionArguments)},t.prototype.writeFunctionArguments=function(e,t,r){for(var n={},i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];n[a]=u.has(a)?f(e[a]):p.has(a)&&Array.isArray(e[a])?e[a].map(f):f(e[a])}this.functionDefinition?t.arguments=n:t[r]=n},t.prototype.readFunctionName=function(e,t){var r=t.rasterFunctionInfos;return t.name||(r&&r.length&&"None"!==r[0].name?r[0].name:t.rasterFunction)},t.prototype.writeFunctionName=function(e,t,r){this.functionDefinition?t.name=e:t[r]=e},t.prototype.readFunctionType=function(e){return l[e]},t.prototype.writeFunctionType=function(e,t,r){t[r]=l[e]},t.prototype.clone=function(){return new i({functionName:this.functionName,functionArguments:o.clone(this.functionArguments),outputPixelType:this.outputPixelType,variableName:this.variableName,name:this.functionName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})},n([s.property({json:{type:Object,write:{target:"rasterFunctionArguments"}}})],t.prototype,"functionArguments",void 0),n([s.reader("functionArguments",["rasterFunctionArguments","arguments"])],t.prototype,"readFunctionArguments",null),n([s.writer("functionArguments")],t.prototype,"writeFunctionArguments",null),n([s.property({json:{type:String,write:{target:"rasterFunction"}}})],t.prototype,"functionName",void 0),n([s.reader("functionName",["rasterFunction","rasterFunctionInfos","name"])],t.prototype,"readFunctionName",null),n([s.writer("functionName")],t.prototype,"writeFunctionName",null),n([s.enumeration.serializable()({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),s.property({json:{default:"unknown"}})],t.prototype,"outputPixelType",void 0),n([s.property({type:String,json:{read:!0,write:!0}})],t.prototype,"variableName",void 0),n([s.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"description",void 0),n([s.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"functionType",void 0),n([s.reader("functionType")],t.prototype,"readFunctionType",null),n([s.writer("functionType")],t.prototype,"writeFunctionType",null),n([s.property({type:Object,json:{read:{source:"function"},write:{target:"function"},origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"functionDefinition",void 0),n([s.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"thumbnail",void 0),i=n([s.subclass("esri.layers.support.RasterFunction")],t)}(s.declared(i.JSONSupport));return d}).apply(null,n))||(e.exports=i)},ANQh:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q2wQ"),r("qKT0"),r("HZ3d"),r("9opi"),r("TMur"),r("ma1f"),r("LxLY"),r("qMld"),r("Vx27"),r("Kjnw"),r("0GEy"),r("pMLx"),r("bF83"),r("huIg"),r("w1v0")],void 0===(i=(function(e,t,r,n,i,o,a,s,l,u,p,c,f,d,h,m,y){var _=new Map;return _.set("int16","esriFieldTypeSmallInteger"),_.set("int32","esriFieldTypeInteger"),_.set("int64","esriFieldTypeInteger"),_.set("float32","esriFieldTypeSingle"),_.set("float64","esriFieldTypeDouble"),_.set("text","esriFieldTypeString"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.storageInfo=null,t}return o(t,e),t.prototype.open=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,u;return r(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e?l.unwrap(e.signal):null,[4,this.request({url:this.url+"/conf.json",responseType:"json"},t)];case 2:if(n=r.sent(),!this._validateHeader(n))throw new s("cloudraster:open","Invalid or unsupported conf.json.");return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),i=this._parseHeader(n),o=i.storageInfo,"thematic"!==(a=i.rasterInfo).dataType?[3,4]:[4,this._fetchAuxiliaryInformation()];case 3:u=r.sent(),a.attributeTable=u,r.label=4;case 4:return this._set("storageInfo",o),this._set("rasterInfo",a),this.ioConfig.retryCount=this.ioConfig.retryCount||0,[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,o){return void 0===o&&(o={}),i(this,void 0,void 0,(function(){var i,a,s,l,u,p,c;return r(this,(function(r){switch(r.label){case 0:return(i=this.rasterInfo.storageInfo.maximumPyramidLevel-e)<0?[2,null]:(a=this._buildCacheFilePath(i,t,n,o.multidimensionalDefinition),s=this._getIndexRecordFromBundle(t,n),[4,this.request({url:a,range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer"},o.signal)]);case 1:return(l=r.sent())?(u=new Uint8Array(l),0===(p=this._getTileEndAndContentType(u,s)).recordSize?[2,null]:[4,this.request({url:a,range:{from:p.position,to:p.position+p.recordSize},responseType:"array-buffer"},o.signal)]):[2,null];case 2:return(c=r.sent())?[2,this.decodePixelBlock(c,{width:this.rasterInfo.storageInfo.tileInfo.size[0],height:this.rasterInfo.storageInfo.tileInfo.size[1],planes:null,pixelType:null})]:[2,null]}}))}))},t.prototype._validateHeader=function(e){return e&&"RasterInfo"===e.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some((function(t){return!e[t]}))},t.prototype._parseHeader=function(e){var t,r,n,i=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][e.pixelType],o=e.bandCount,s=e.histograms,l=e.colormap,u=e.blockWidth,p=e.blockHeight,h=e.firstPyramidLevel,m=e.maximumPyramidLevel,y=e.statistics&&e.statistics.map((function(e){return{min:e.min,max:e.max,avg:e.mean,stddev:e.standardDeviation,median:e.median,mode:e.mode}})),_=new a.SpatialReference(e.extent.spatialReference||e.geodataXform.spatialReference),v=new a.Extent({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:_}),g=new a.Point({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:_}),b=e.properties,w=e.format.toLowerCase().replace("cache/",""),P=new a.Point(e.origin.x,e.origin.y,_);if(l&&l.colors)for(t=[],r=0;r<l.colors.length;r++)t.push([l.values?l.values[r]:r,255&(n=l.colors[r]),n<<16>>>24,n<<8>>>24,n>>>24]);var x=e.LODInfos,T=[];for(r=0;r<x.levels.length;r++)T.push({level:x.levels[r],resolution:x.resolutions[r],scale:96/.0254*x.resolutions[r]});var I=new d({dpi:96,lods:T,format:w,origin:P,size:[u,p],spatialReference:_}),S={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64},E=Math.round((v.xmax-v.xmin)/g.x),R=Math.round((v.ymax-v.ymin)/g.y),O=[{maxCol:Math.ceil(E/u)-1,maxRow:Math.ceil(R/p)-1,minCol:0,minRow:0}],M=2;if(m>0)for(r=0;r<m;r++)O.push({maxCol:Math.ceil(E/M/u)-1,maxRow:Math.ceil(R/M/p)-1,minCol:0,minRow:0}),M*=2;return{storageInfo:S,rasterInfo:new c({width:E,height:R,pixelType:i,bandCount:o,extent:v,spatialReference:_,pixelSize:g,keyProperties:b,statistics:y,histograms:s,multidimensionalInfo:e.mdInfo,colormap:t,storageInfo:new f({blockWidth:u,blockHeight:p,pyramidBlockWidth:u,pyramidBlockHeight:p,origin:P,tileInfo:I,firstPyramidLevel:h,maximumPyramidLevel:m,blockBoundary:O})})}},t.prototype._fetchAuxiliaryInformation=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,s,l,p;return r(this,(function(r){switch(r.label){case 0:return t=this.request({url:this.url+"/conf.vat.json",responseType:"json"},e).then((function(e){return e})).catch((function(){return null})),n=this.request({url:this.url+"/conf.vat.dbf",responseType:"array-buffer"},e).then((function(e){return e})).catch((function(){return null})),[4,u.all([t,n])];case 1:return(i=r.sent())[0]&&(s=i[0].values,(a=i[0].fields)&&s&&(a=a.map((function(e){return{type:"OID"===e.name?"esriFieldTypeOID":_.get(e.type),name:e.name,alias:e.alias||e.name}})),l=s.map((function(e){return{attributes:e}})),a&&s&&(o={fields:a,features:l}))),!o&&i[1]&&(p=m.parse(i[1]),o=p.recordSet),[2,y.fromJSON(o)]}}))}))},t.prototype._buildCacheFilePath=function(e,t,r,n){var i=this.storageInfo.packetSize,o=Math.floor(t/i)*i,a=Math.floor(r/i)*i,s="R"+this._toHexString4(o)+"C"+this._toHexString4(a),l="L";l+=e>=10?e.toString():"0"+e.toString();var u=n&&n[0];if(!u)return this.url+"/_alllayers/"+l+"/"+s+".bundle";for(var p=this.rasterInfo.multidimensionalInfo.variables.filter((function(e){return e.name===u.variableName}))[0].dimensions[0].values.indexOf(u.values[0]).toString(16),c=4-p.length,f=0;f<c;f++)p="0"+p;return this.url+"/_alllayers/"+u.variableName+"/"+(p="S"+p)+"/"+l+"/"+s+".bundle"},t.prototype._getIndexRecordFromBundle=function(e,t){var r=this.storageInfo.packetSize,n=r*(e%r)+t%r;if(n<0)throw"Invalid level / row / col";return 20+n*this.storageInfo.recordSize+44},t.prototype._getTileEndAndContentType=function(e,t){var r,n=e.subarray(t,t+8),i=0;for(r=0;r<5;r++)i|=(255&n[r])<<8*r;var o=0xffffffffff&i;for(i=0,r=5;r<8;r++)i|=(255&n[r])<<8*(r-5);return{position:o,recordSize:0xffffffffff&i}},t.prototype._toHexString4=function(e){var t=e.toString(16);if(4!==t.length)for(var r=4-t.length;r-- >0;)t="0"+t;return t},n([p.property({readOnly:!0})],t.prototype,"storageInfo",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),n([p.subclass("esri.layers.support.rasterDatasets.CloudRaster")],t)}(p.declared(h))}).apply(null,n))||(e.exports=i)},Cobz:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("9opi"),r("qKT0"),r("Q2wQ"),r("HZ3d"),r("zp6E"),r("Gtr7"),r("ma1f"),r("eIBl"),r("qsST"),r("W6K4"),r("KBgh"),r("qMld"),r("afW+"),r("jfWY"),r("8MXS"),r("Vx27"),r("xojL")],void 0===(i=(function(e,t,r,n,i,o,a,s,l,u,p,c,f,d,h,m,y,_,v,g){Object.defineProperty(t,"__esModule",{value:!0}),t.TILEMAP_SIZE_EXP=5;var b=c.getLogger("esri.layers.support.TilemapCache"),w=function(e){function l(t){var r=e.call(this,t)||this;return r._handles=new p,r._pendingTilemapRequests={},r._availableLevels={},r.levels=5,r.cacheByteSize=2097152,r.request=s,r._prefetchingEnabled=!0,r}var c;return n(l,e),c=l,l.prototype.initialize=function(){var e=this;this._tilemapCache=new f(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(function(){return e._initializeTilemapDefinition()})),_.init(this,"layer.tileInfo.lods",(function(t){return e._initializeAvailableLevels(t)}),!0)]),this._initializeTilemapDefinition()},l.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},l.prototype.castLevels=function(e){return e<=2?(b.error("Minimum levels for Tilemap is 3, but got ",e),3):e},Object.defineProperty(l.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0}),l.prototype.fetchTilemap=function(e,t,n,i){var o=this;if(!this._availableLevels[e])return h.reject(new u("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"));var a=this._tmpTilemapDefinition,s=this._tilemapFromCache(e,t,n,a);if(s)return h.resolve(s);var l=i&&i.signal;return i=r({},i,{signal:null}),h.create((function(e,t){h.onAbort(l,(function(){return t(h.createAbortError())}));var r=g.tilemapDefinitionId(a),n=o._pendingTilemapRequests[r];if(!n){n=g.Tilemap.fromDefinition(a,i).then((function(e){return o._tilemapCache.put(r,e,e.byteSize),e}));var s=function(){return delete o._pendingTilemapRequests[r]};o._pendingTilemapRequests[r]=n,n.then(s,s)}n.then(e,t)}))},l.prototype.getAvailability=function(e,t,r){if(!this._availableLevels[e])return"unavailable";var n=this._tilemapFromCache(e,t,r,this._tmpTilemapDefinition);return n?n.getAvailability(t,r):"unknown"},l.prototype.getAvailabilityUpsample=function(e,t,r,n){n.level=e,n.row=t,n.col=r;var i=this.layer.tileInfo;for(i.updateTileInfo(n);;){var o=this.getAvailability(n.level,n.row,n.col);if("unavailable"!==o)return o;if(!i.upsampleTile(n))return"unavailable"}},l.prototype.fetchAvailability=function(e,t,r,n){return this._availableLevels[e]?this.fetchTilemap(e,t,r,n).catch((function(e){return e})).then((function(n){if(n instanceof g.Tilemap){var i=n.getAvailability(t,r);return"unavailable"===i?h.reject(new u("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:r})):i}if(h.isAbortError(n))throw n;return"unknown"})):h.reject(new u("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"))},l.prototype.fetchAvailabilityUpsample=function(e,t,r,n,i){var o=this;n.level=e,n.row=t,n.col=r;var a=this.layer.tileInfo;a.updateTileInfo(n);var s=this.fetchAvailability(e,t,r,i).catch((function(e){if(h.isAbortError(e))throw e;if(a.upsampleTile(n))return o.fetchAvailabilityUpsample(n.level,n.row,n.col,n);throw e}));return this._fetchAvailabilityUpsamplePrefetch(n.id,e,t,r,i,s),s},l.prototype._fetchAvailabilityUpsamplePrefetch=function(e,t,n,i,s,l){return a(this,void 0,void 0,(function(){var a,u,p,f,d,y,_,v,g;return o(this,(function(o){switch(o.label){case 0:if(!this._prefetchingEnabled)return[2];if(this._handles.has(a="prefetch-"+e))return[2];u=h.createAbortController(),l.then((function(){return u.abort()}),(function(){return u.abort()})),p=!1,this._handles.add({remove:function(){p||(p=!0,u.abort())}},a),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,m.waitTicks(10,u.signal)];case 2:case 3:return o.sent(),[3,4];case 4:if(p||(p=!0,this._handles.remove(a)),h.isAborted(u))return[2];for(f={id:e,level:t,row:n,col:i},d=r({},s,{signal:u.signal}),y=this.layer.tileInfo,_=function(e){var t=v.fetchAvailability(f.level,f.row,f.col,d);c._prefetches.push(t);var r=function(){c._prefetches.removeUnordered(t)};t.then(r,r)},v=this,g=0;c._prefetches.length<c._maxPrefetch&&y.upsampleTile(f);++g)_();return[2]}}))}))},l.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?y.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}},l.prototype._tilemapFromCache=function(e,t,r,n){var i=this._getTilemapDefinition(e,t,r,n),o=g.tilemapDefinitionId(i);return this._tilemapCache.get(o)},l.prototype._getTilemapDefinition=function(e,r,n,i){i.level=e;var o=e>t.TILEMAP_SIZE_EXP;return i.row=o?r-r%this.size:r,i.col=o?n-n%this.size:n,i},l.prototype._initializeAvailableLevels=function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))},Object.defineProperty(l.prototype,"test",{get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,r,n){return!!e._tilemapFromCache(t,r,n,e._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0}),l._maxPrefetch=4,l._prefetches=new d({initialSize:c._maxPrefetch}),i([v.property({constructOnly:!0,type:Number})],l.prototype,"levels",void 0),i([v.cast("levels")],l.prototype,"castLevels",null),i([v.property({readOnly:!0,dependsOn:["levels"],type:Number})],l.prototype,"size",null),i([v.property({constructOnly:!0,type:Number})],l.prototype,"cacheByteSize",void 0),i([v.property({constructOnly:!0})],l.prototype,"layer",void 0),i([v.property({constructOnly:!0})],l.prototype,"request",void 0),c=i([v.subclass("esri.layers.support.TilemapCache")],l)}(v.declared(l));t.TilemapCache=w}).apply(null,n))||(e.exports=i)},MbkH:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){var r=0;return function(){function e(e){void 0===e&&(e=null),this.uid=r++,e?(this._wkt=void 0!==e.wkt?e.wkt:null,this._wkid=void 0!==e.wkid?e.wkid:-1,this._isInverse=void 0!==e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}return e.fromGE=function(t){var r=new e;return r._wkt=t.wkt,r._wkid=t.wkid,r._isInverse=t.isInverse,r},Object.defineProperty(e.prototype,"wkt",{get:function(){return this._wkt},set:function(e){this._wkt=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wkid",{get:function(){return this._wkid},set:function(e){this._wkid=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInverse",{get:function(){return this._isInverse},set:function(e){this._isInverse=e,this.uid=r++},enumerable:!0,configurable:!0}),e.prototype.getInverse=function(){var t=new e;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t},e}()}).apply(null,n))||(e.exports=i)},OkCb:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("MbkH")],void 0===(i=(function(e,t,r){return function(){function e(e){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(var t=0,n=e.steps;t<n.length;t++){var i=n[t];this.steps.push(i instanceof r?i:new r({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}}return e.cacheKey=function(e,t){return[null!=e.wkid?e.wkid.toString():"-1",null!=e.wkt?e.wkt.toString():"",null!=t.wkid?t.wkid.toString():"-1",null!=t.wkt?t.wkt.toString():""].join(",")},e.fromGE=function(t){for(var n=new e,i="",o=0,a=t.steps;o<a.length;o++){var s=r.fromGE(a[o]);n.steps.push(s),i+=s.uid.toString()+","}return n._cached_projection={},n._gtlistentry=null,n._chain=i,n},e.prototype.getInverse=function(){var t=new e;t.steps=[];for(var r=this.steps.length-1;r>=0;r--)t.steps.push(this.steps[r].getInverse());return t},e.prototype.getGTListEntry=function(){for(var e="",t=0,r=this.steps;t<r.length;t++)e+=r[t].uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=e),this._gtlistentry},e.prototype.assignCachedGe=function(t,r,n){this._cached_projection[e.cacheKey(t,r)]=n},e.prototype.getCachedGeTransformation=function(t,r){for(var n="",i=0,o=this.steps;i<o.length;i++)n+=o[i].uid.toString()+",";n!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=n);var a=this._cached_projection[e.cacheKey(t,r)];return void 0===a?null:a},e}()}).apply(null,n))||(e.exports=i)},PND3:function(e,t,r){"use strict";r.r(t),r.d(t,"Set",(function(){return a}));var n=r("3pR/"),i=r("hf04"),o=r("cCxy");r("ek0z");let a=n.a.Set;var s;Object(o.default)("es6-set")||((s=class{constructor(e){if(this._setData=[],this[Symbol.toStringTag]="Set",e)if(Object(i.isArrayLike)(e))for(let t=0;t<e.length;t++)this.add(e[t]);else for(const t of e)this.add(t)}add(e){return this.has(e)||this._setData.push(e),this}clear(){this._setData.length=0}delete(e){const t=this._setData.indexOf(e);return-1!==t&&(this._setData.splice(t,1),!0)}entries(){return new i.ShimIterator(this._setData.map(e=>[e,e]))}forEach(e,t){const r=this.values();let n=r.next();for(;!n.done;)e.call(t,n.value,n.value,this),n=r.next()}has(e){return this._setData.indexOf(e)>-1}keys(){return new i.ShimIterator(this._setData)}get size(){return this._setData.length}values(){return new i.ShimIterator(this._setData)}[Symbol.iterator](){return new i.ShimIterator(this._setData)}})[Symbol.species]=s,a=s),t.default=a},QJ8R:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Q2wQ"),r("HZ3d"),r("ma1f"),r("qsST"),r("qMld"),r("jfWY"),r("Vx27"),r("Qwus"),r("QmTF")],void 0===(i=(function(e,t,n,i,o,a,s,l,u,p,c,f,d){Object.defineProperty(t,"__esModule",{value:!0});var h=l.getLogger("esri.layers.mixins.PortalLayer");t.PortalLayer=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),Object.defineProperty(t.prototype,"portalItem",{set:function(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))},enumerable:!0,configurable:!0}),t.prototype.readPortalItem=function(e,t,r){if(t.itemId)return new d({id:t.itemId,portal:r&&r.portal})},t.prototype.writePortalItem=function(e,t){e&&e.id&&(t.itemId=e.id)},t.prototype.loadFromPortal=function(e,t){return a(this,void 0,void 0,(function(){var n,i;return o(this,(function(o){switch(o.label){case 0:if(!this.portalItem||!this.portalItem.id)return[2];o.label=1;case 1:return o.trys.push([1,4,,5]),[4,u.create((function(e){return Promise.all([r.e(0),r.e(88)]).then((function(){var t=[r("6hwa")];e.apply(null,t)}).bind(this)).catch(r.oe)}))];case 2:return n=o.sent(),u.throwIfAborted(t),[4,n.load({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData},t)];case 3:return[2,o.sent()];case 4:throw i=o.sent(),h.warn("Failed to load layer ("+this.title+", "+this.id+") portal item ("+this.portalItem.id+")\n  "+i),i;case 5:return[2]}}))}))},t.prototype.read=function(e,t){var r=arguments;t&&(t.layer=this),this.inherited(r)},t.prototype.write=function(e,t){var r=t&&t.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||f.getDefault());return r&&n&&!p.hasSamePortal(n.restUrl,r.restUrl)?(t.messages&&t.messages.push(new s("layer:cross-portal","The layer '"+this.title+" ("+this.id+")' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer",{layer:this})),null):this.inherited(arguments)},i([c.property({type:d})],t.prototype,"portalItem",null),i([c.reader("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),i([c.writer("portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),i([c.subclass("esri.layers.mixins.PortalLayer")],t)}(c.declared(e))}}).apply(null,n))||(e.exports=i)},"T/jF":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q2wQ"),r("HZ3d"),r("2Atf"),r("ma1f"),r("qMld"),r("8V7H"),r("dXLH")],void 0===(i=(function(e,t,r,n,i,o,a,s,l){return function(){function e(){this._workerThread=null,this._destroyed=!1}return e.prototype.initialize=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,s.open("RasterWorker")];case 1:return e=t.sent(),this._destroyed?e.close():this._workerThread=e,[2]}}))}))},e.prototype.destroy=function(){this._destroyed=!0,this._workerThread&&(this._workerThread.close(),this._workerThread=null)},e.prototype.decode=function(e,t){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new o("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("decode",e,t)];case 1:return[2,(n=r.sent())?new l(n):null]}}))}))},e.prototype.symbolize=function(e,t){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new o("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("symbolize",e.toJSON(),t)];case 1:return[2,(n=r.sent())?new l(n):null]}}))}))},e.prototype.updateSymbolizer=function(e,t){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new o("raster-jobhandler:no-connection","no available worker connection");return n=e&&e.renderer&&"raster-stretch"===e.renderer.type&&e.renderer.histograms,[4,a.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:e.toJSON(),histograms:n},t))];case 1:return r.sent(),[2]}}))}))},e.prototype.stretch=function(e,t){return n(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new o("raster-jobhandler:no-connection","no available worker connection");return e&&e.pixelBlock?(n={srcPixelBlock:e.pixelBlock.toJSON(),stretchParams:e.stretchParams},[4,this._workerThread.invoke("stretch",n,t)]):[2,null];case 1:return[2,(i=r.sent())?new l(i):null]}}))}))},e.prototype.mosaicAndTransform=function(e,t){return n(this,void 0,void 0,(function(){var n,a;return r(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new o("raster-jobhandler:no-connection","no available worker connection");return e&&e.srcPixelBlocks&&e.srcPixelBlocks.length>0?(n=i({},e,{srcPixelBlocks:e.srcPixelBlocks.map((function(e){return e?e.toJSON():null}))}),[4,this._workerThread.invoke("mosaicAndTransform",n,t)]):[2,null];case 1:return[2,(a=r.sent())?new l(a):null]}}))}))},e}()}).apply(null,n))||(e.exports=i)},WaJo:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Vx27")],void 0===(i=(function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshableLayer=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshInterval=0,t}return r(t,e),t.prototype.refresh=function(){this.emit("refresh")},n([i.property({type:Number,cast:function(e){return e>=.1?e:e<=0?0:.1},json:{write:!0,origins:{"web-document":{write:!0}}}})],t.prototype,"refreshInterval",void 0),n([i.subclass("esri.layers.mixins.RefreshableLayer")],t)}(i.declared(e))}}).apply(null,n))||(e.exports=i)},YM6P:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("+UAu"),r("KY0m"),r("rg9i"),r("97bx"),r("UVEp"),r("hBcF")],void 0===(i=(function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},u={type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]};t.isSupportedRendererType=function(e){var t=e.type;return"raster-stretch"===t||"unique-value"===t||"class-breaks"===t},t.combineRenderingRules=function(e,t){if(!e||!t)return i.clone(e||t);var r=i.clone(e);return"none"!==t.functionName.toLowerCase()&&((function e(t){var r=t.Raster;return r&&"esri.layers.support.RasterFunction"===r.declaredClass?e(r.functionArguments):t}(r.functionArguments)).Raster=t),r},t.convertRendererToRenderingRule=function(e,t){switch(t=t||{},e.type){case"raster-stretch":return function(e,t){var r=new o;r.functionName="Stretch";var n=p[s.stretchTypeJSONDict.toJSON(e.stretchType)],i={StretchType:n,Statistics:e.statistics,DRA:e.dynamicRangeAdjustment,UseGamma:e.useGamma,Gamma:e.gamma,ComputeGamma:e.computeGamma};if(null!=e.outputMin&&(i.Min=e.outputMin),null!=e.outputMax&&(i.Max=e.outputMax),n===p.standardDeviation?(i.NumberOfStandardDeviations=e.numberOfStandardDeviations,r.outputPixelType="u8"):n===p.percentClip?(i.MinPercent=e.minPercent,i.MaxPercent=e.maxPercent,r.outputPixelType="u8"):n===p.minMax?r.outputPixelType="u8":n===p.sigmoid&&(i.SigmoidStrengthLevel=e.sigmoidStrengthLevel),r.functionArguments=i,r.variableName="Raster",e.colorRamp){var l=e.colorRamp,u=new o,c=a.getColorRampName(l);return u.functionArguments=c?{colorRamp:c}:!t.convertColorRampToColormap||"algorithmic"!==l.type&&"multipart"!==l.type?{colorRamp:e.colorRamp.toJSON()}:{Colormap:a.convertColorRampToColormap(l,256)},u.variableName="Raster",u.functionName="Colormap",u.functionArguments.Raster=r,u}return r}(e,t);case"class-breaks":return function(e,t){var r=[],n=[],i=[],a=[],s=t.pixelType,l=t.rasterAttributeTable,u=l&&l.features,p=f(l);if(u&&Array.isArray(u)&&e.classBreakInfos){e.classBreakInfos.forEach((function(t,r){var n,i=t.symbol.color;i.a&&u.forEach((function(o){((n=o.attributes[e.field])>=t.minValue&&n<t.maxValue||r===e.classBreakInfos.length-1&&n>=t.minValue)&&a.push([o.attributes[p],i.r,i.g,i.b])}))}));var d=s?c(a,s):a,h=new o;return h.functionName="Colormap",h.functionArguments={},h.functionArguments.Colormap=d,h.variableName="Raster",h}e.classBreakInfos.forEach((function(e,t){var o=e.symbol&&e.symbol.color;o.a?(r.push(0===t?e.minValue:e.minValue+1e-6,e.maxValue+1e-6),n.push(t),a.push([t,o.r,o.g,o.b])):i.push(e.minValue,e.maxValue)}));var m=s?c(a,s):a,y=new o;y.functionName="Remap",y.functionArguments={InputRanges:r,OutputValues:n,NoDataRanges:i},y.variableName="Raster";var _=new o;return _.functionName="Colormap",_.functionArguments={Colormap:m,Raster:y},_}(e,t);case"unique-value":return function(e,t){var r=[],n=t.pixelType,i=t.rasterAttributeTable,a=i&&i.features,s=f(i),l=!1;if(e.uniqueValueInfos&&e.uniqueValueInfos.forEach((function(t){var n=t.symbol.color;n.a&&(e.field!==s&&a?a&&a.forEach((function(i){String(i.attributes[e.field])===String(t.value)&&r.push([i.attributes[s],n.r,n.g,n.b])})):isNaN(t.value)?l=!0:r.push([t.value,n.r,n.g,n.b]))})),l)return null;var u=n&&r.length>0?c(r,n):r,p=new o;return p.functionName="Colormap",p.functionArguments={},p.functionArguments.Colormap=u,p.variableName="Raster",p}(e,t);case"raster-colormap":return function(e,t){var r=e.extractColormap();if(r&&0!==r.length){var n=t.pixelType,i=n?c(r,n):r,a=new o;return a.functionName="Colormap",a.functionArguments={},a.functionArguments.Colormap=i,a}}(e,t)}},t.createDefaultRenderer=function(e,t){if(e){var n,i=e.attributeTable,o=e.dataType,a=e.bandCount,s=e.pixelType,l=e.colormap,p=e.statistics,c=e.histograms;if(t&&t.length>0&&(p=p?t.map((function(e){return p[e]})):null,c=c?t.map((function(e){return c[e]})):null),1===a&&l&&l.length>0)n=r.RasterColormapRenderer.createFromColormap(l);else if(1===a&&i){var f=i.fields.filter((function(e){return"red"===e.name.toLowerCase()}))[0],d=i.fields.filter((function(e){return"green"===e.name.toLowerCase()}))[0],h=i.fields.filter((function(e){return"blue"===e.name.toLowerCase()}))[0],m=i.fields.filter((function(e){return"value"===e.name}))[0],y=i.fields.filter((function(e){return"classname"===e.name.toLowerCase()}))[0];y||(y=i.fields.filter((function(e){return"string"===e.type}))[0])||(y=m),f&&d&&h&&y&&(n=r.UniqueValueRenderer.fromJSON({field1:y.name,uniqueValueInfos:i.features.map((function(e){return{value:e.attributes[y.name],label:e.attributes[y.name],symbol:{color:[e.attributes[f.name],e.attributes[d.name],e.attributes[h.name],255],type:"esriSFS",style:"esriSFSSolid"}}}))}))}if(!n){var _=void 0,v=!1,g=void 0,b=void 0,w=void 0;"u8"===s&&"processed"===o?(_="min-max",p=p||[{min:0,max:255},{min:0,max:255},{min:0,max:255}]):"u8"===s||"elevation"===o?(_="min-max",v=!p):"scientific"===o?(_="min-max",v=!p,g=u):c&&c.length>0?(_="percent-clip",w=b=.25):p?_="min-max":(_="percent-clip",v=!0),n=r.RasterStretchRenderer.fromJSON({stretchType:_,dra:v,colorRamp:g,min:0,max:255,statistics:v?null:p,histograms:v?null:c,maxPercent:b,minPercent:w})}return n}},t.getDefaultBandCombination=function(e){var t=e.bandCount;if(1===t)return null;if(2===t)return[0];var r,n,i,o,a,s=e.keyProperties&&e.keyProperties.BandProperties;if(s&&s.length===t){for(var l=0;l<s.length;l++)s[l].BandName&&"red"===s[l].BandName.toLowerCase()&&(n=l),s[l].BandName&&"green"===s[l].BandName.toLowerCase()&&(i=l),s[l].BandName&&"blue"===s[l].BandName.toLowerCase()&&(o=l),s[l].BandName&&"nearinfrared"===s[l].BandName.toLowerCase()&&(a=l);void 0!==n&&void 0!==i&&void 0!==o?r=[n,i,o]:void 0!==n&&void 0!==i&&void 0!==a&&(r=[a,n,i])}return!r&&t>3&&(r=[0,1,2]),r};var p={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9};function c(e,t){var r=l[String(t).toLowerCase()];return r&&e.push([Math.floor(r[0]-1),0,0,0],[Math.ceil(r[1]+1),0,0,0]),e}function f(e){if(e){var t=e.fields,r=t&&n.find(t,(function(e){return e&&e.name&&"value"===e.name.toLowerCase()}));return r&&r.name}}}).apply(null,n))||(e.exports=i)},bF83:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Q2wQ"),r("HZ3d"),r("2Atf"),r("TMur"),r("zp6E"),r("ma1f"),r("ycL1"),r("LxLY"),r("SZNs"),r("qMld"),r("jfWY"),r("Vx27"),r("EtsK"),r("pMLx"),r("XOvD"),r("WSFd"),r("SAwq"),r("mnow")],void 0===(i=(function(e,t,r,n,i,o,a,s,l,u,p,c,f,d,h,m,y,_,v,g,b,w){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rasterJobHandler=null,t.datasetName=null,t.datasetFormat=null,t.rasterInfo=null,t.ioConfig={bandIds:null,sampling:"closest"},t}return r(t,e),t.prototype.init=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return e=w.load(),this.addResolvingPromise(e),[4,this.when()];case 1:return t.sent(),[2]}}))}))},t.prototype.normalizeCtorArgs=function(e){return e&&e.ioConfig&&(e=a({},e,{ioConfig:a({resolution:null,bandIds:null,sampling:"closest",tileInfo:_.create()},e.ioConfig)})),e},Object.defineProperty(t.prototype,"url",{set:function(e){var t=h.urlToObject(e);this._set("url",t.path)},enumerable:!0,configurable:!0}),t.prototype.open=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(e){throw new u("BaseRaster:open-not-implemented","open() is not implemented")}))}))},t.prototype.fetchTile=function(e,t,r,n){return void 0===n&&(n={}),o(this,void 0,void 0,(function(){var o,a,l,u;return i(this,(function(i){return a=(o=n.tileInfo).lodAt(e),l=new s.Point({x:a.resolution,y:a.resolution,spatialReference:o.spatialReference}),u=this._getTileExtent(l,t,r,o),[2,this.fetchPixels(u,o.size[0],o.size[1],n)]}))}))},t.prototype.identify=function(e,t){return void 0===t&&(t={}),o(this,void 0,void 0,(function(){var r,n,o,a,s,l,u,p,c,f,d;return i(this,(function(i){switch(i.label){case 0:return n=(r=this.rasterInfo).extent,o=w.projectPoint(e,r.spatialReference,t.datumTransformation),n.intersects(o)?(a=0,t.srcResolution?(s=w.snapPyramid(t.srcResolution,this.rasterInfo,this.ioConfig.sampling),a=s.pyramidLevel,[3,3]):[3,1]):[2,{location:o,value:null}];case 1:return[4,this.computeBestPyramidLevelForLocation(e,t)];case 2:if(null==(a=i.sent()))return[2,{location:o,value:null}];i.label=3;case 3:return null===(l=this.identifyPixelLocation(o,a,null))?[2,{location:o,value:null}]:(u=l.rowOffset,p=l.colOffset,[4,this.fetchRawTile(a,l.row,l.col,t)]);case 4:return(c=i.sent()).pixels&&c.pixels.length>0?(f=u*this.rasterInfo.storageInfo.blockHeight+p,d=!c.mask||c.mask[f]?c.pixels.map((function(e){return e[f]})):null,[2,{location:o,value:d,pyramidLevel:a}]):[2,{location:o,value:null}]}}))}))},t.prototype.fetchPixels=function(e,t,r,n){return void 0===n&&(n={}),o(this,void 0,void 0,(function(){var o,a,l,u,p,c,f,d,h,m,y,_,v,g,P,x,T,I,S,E,R,O;return i(this,(function(i){switch(i.label){case 0:return o=e.clone().normalize(),l=!(e=o[0]).spatialReference.equals(a=this.rasterInfo.spatialReference),u=n.datumTransformation,p=new s.Point({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/r,spatialReference:e.spatialReference}),(c=n.srcResolution||(l?w.projectResolution(p,a,e,u):p))?(f=w.snapPyramid(c,this.rasterInfo,this.ioConfig.sampling),d=f.pyramidLevel,h=f.pyramidResolution,f.excessiveReading?[2,null]:(m=this.rasterInfo.storageInfo,y=l?w.projectExtent(e,a,u):e,_={x:Math.floor((y.xmin-m.origin.x)/h.x+.1),y:Math.floor((m.origin.y-y.ymax)/h.y+.1)},v=Math.ceil((y.xmax-y.xmin)/h.x-.1),g=Math.ceil((y.ymax-y.ymin)/h.y-.1),v/t>8||g/r>8?[2,null]:[4,this.fetchRawPixels(d,_,{width:v,height:g},n)])):[2,null];case 1:return(P=i.sent())?(x=d>0?m.pyramidBlockWidth:m.blockWidth,T=d>0?m.pyramidBlockHeight:m.blockHeight,l||1!==P.pixelBlocks.length||x!==t||T!==r||c.x!==p.x||c.y!==p.y?(I=w.getProjectionOffsetGrid(e,P.extent,p,u),E=!n.requestRawData,R={rows:I.spacing[0],cols:I.spacing[1]},this.rasterJobHandler?[4,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:P.pixelBlocks,srcMosaicSize:P.mosaicSize,destDimension:E?{width:t,height:r}:null,coefs:E?I.coefficients:null,sampleSpacing:E?R:null},n)]:[3,3]):[2,{extent:e,srcExtent:y,pixelBlock:P.pixelBlocks[0],transformGrid:null}]):[2,null];case 2:return S=i.sent(),[3,4];case 3:O=b.mosaic(P.pixelBlocks,P.mosaicSize),S=E?b.approximateTransform(O,{width:t,height:r},I.coefficients,R):O,i.label=4;case 4:return[2,{srcExtent:y,pixelBlock:S,transformGrid:I,extent:e}]}}))}))},t.prototype.fetchRawPixels=function(e,t,r,n){return o(this,void 0,void 0,(function(){var o,a,l,u,p,f,h,m,y,_,g,b,w,P,x,T,I,S,E,R,O,M,C,N,A,F,k,D;return i(this,(function(i){switch(i.label){case 0:if(a=(o=this.rasterInfo.storageInfo).origin,l=o.blockBoundary,u=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,p=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight,f=Math.floor(t.x/u),h=Math.floor(t.y/p),m=Math.floor((t.x+r.width-1)/u),y=Math.floor((t.y+r.height-1)/p),g=(_=this.rasterInfo).pixelSize,b=_.spatialReference,!(w=l[e]))return[2,null];if(x=w.minCol,T=w.maxCol,I=w.maxRow,y<(P=w.minRow)||m<x||h>I||f>T)return[2,null];for(S=[],E=this.url,R=n.registryId,C=h;C<=y;C++)for(N=f;N<=m;N++)C>=P&&N>=x&&I>=C&&T>=N?(M=v.getBlock(E,R,O=e+"/"+C+"/"+N),c.isSome(M)||(M=this.fetchRawTile(e,C,N,n),v.putBlock(E,R,O,M)),S.push(M)):S.push(null);return 0===S.length?[2,null]:[4,d.all(S)];case 1:return A=i.sent(),F={height:(y-h+1)*u,width:(m-f+1)*p},k=g.x*Math.pow(2,e),D=g.y*Math.pow(2,e),[2,{extent:new s.Extent({xmin:a.x+f*u*k,xmax:a.x+(m+1)*u*k,ymin:a.y-(y+1)*p*D,ymax:a.y-h*p*D,spatialReference:b}),pixelBlocks:A,mosaicSize:F}]}}))}))},t.prototype.fetchRawTile=function(e,t,r,n){return o(this,void 0,void 0,(function(){return i(this,(function(e){throw new u("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}))}))},t.prototype.decodePixelBlock=function(e,t){return this.rasterJobHandler?this.rasterJobHandler.decode({data:e,options:t}):g.decode(e,t)},t.prototype.request=function(e,t){return o(this,void 0,void 0,(function(){var r,n,o,s,u,p;return i(this,(function(i){switch(i.label){case 0:r=this.ioConfig.customFetchParameters,n=e.url,o=e.range,s=e.query,u=e.responseType,null==e.retryCount&&this.ioConfig.retryCount&&(e.retryCount=this.ioConfig.retryCount),p=o?{Range:"bytes="+o.from+"-"+o.to}:null,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,l(n,{query:a({},s,r),headers:p,responseType:u,signal:t})];case 2:return[2,i.sent().data];case 3:return i.sent(),e.retryCount>0?(e.retryCount--,[2,this.request(e,t)]):[2,null];case 4:return[2]}}))}))},t.prototype.getSliceIndex=function(e){var t=this.rasterInfo.multidimensionalInfo;if(!t||0===e.length)return null;for(var r=0,n=e[0].variableName,i=function(i){var o=t.variables[i],a=o.dimensions;if(o.name!==n)return r+=a.map((function(e){return e.values.length})).reduce((function(e,t){return e+t})),"break";for(var s=a.map((function(e){return e.values.length})),l=a.length,u=function(t){var n=e.filter((function(e){return e.dimensionName===a[t].name}))[0];if(null==n)return{value:null};var i=Array.isArray(n.values[0])?n.values[0][0]:n.values[0],o=a[t].values.indexOf(i);if(-1===o)return{value:null};s.shift(),r+=t===l-1?o:o*s.reduce((function(e,t){return e+t}))},p=0;p<l;p++){var c=u(p);if("object"==typeof c)return c}},o=0;o<t.variables.length;o++){var a=i(o);if("object"==typeof a)return a.value;if("break"===a)break}return r},t.prototype.computeBestPyramidLevelForLocation=function(e,t){return void 0===t&&(t={}),o(this,void 0,void 0,(function(){return i(this,(function(e){return[2,0]}))}))},t.prototype.identifyPixelLocation=function(e,t,r){var n=this.rasterInfo,i=n.pixelSize,o=n.extent,a=this.rasterInfo.storageInfo,s=a.blockWidth,l=a.blockHeight,u=a.maximumPyramidLevel,p=a.pyramidScalingFactor,c=a.origin,f=a.blockBoundary,d=w.projectPoint(e,n.spatialReference,r);if(!o.intersects(d))return null;if(t<0||t>u)return null;var h=Math.pow(p,t),m=h*i.x,y=f[t],_=Math.max(y.minRow,Math.min(y.maxRow,(c.y-d.y)/(h*i.y)/l)),v=Math.max(y.minCol,Math.min(y.maxCol,(d.x-c.x)/m/s)),g=Math.min(l-1,Math.floor((_-Math.floor(_))*l)),b=Math.min(s-1,Math.floor((v-Math.floor(v))*s));return{pyramidLevel:t,row:Math.floor(_),col:Math.floor(v),rowOffset:g,colOffset:b,srcLocation:d}},t.prototype._getTileExtent=function(e,t,r,n){var i=n.origin,o=n.size[0],a=n.size[1],l=i.x+r*o*e.x,u=i.y-t*a*e.y;return new s.Extent({xmin:l,xmax:l+o*e.x,ymin:u-a*e.y,ymax:u,spatialReference:n.spatialReference})},n([m.property(y.url)],t.prototype,"url",null),n([m.property({type:String,json:{write:!0}})],t.prototype,"datasetName",void 0),n([m.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),n([m.property()],t.prototype,"rasterInfo",void 0),n([m.property()],t.prototype,"ioConfig",void 0),n([m.subclass("esri.layers.support.rasterDatasets.BaseRaster")],t)}(m.declared(f.EsriPromiseMixin(p.JSONSupport)))}).apply(null,n))||(e.exports=i)},begh:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("ifLZ"),r("k7g7"),r("O4In"),r("Ctes"),r("BwRt")],void 0===(i=(function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=["oid","global-id","guid"];function u(e,t){return"oid"===e.type?-1:"oid"===t.type?1:f(e)?-1:f(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function p(e,t){return e.editable&&-1===l.indexOf(e.type)&&!function(e,t){if(!e||!t)return!1;var r=t.creationDateField,n=t.creatorField,i=t.editDateField,o=t.editorField;return-1!==[r&&r.toLowerCase(),n&&n.toLowerCase(),i&&i.toLowerCase(),o&&o.toLowerCase()].indexOf(e.toLowerCase())}(e.name,t)}function c(e){switch(e.type){case"small-integer":case"integer":case"single":return new s({digitSeparator:!0,places:0});case"double":return new s({digitSeparator:!0,places:2});case"date":return new s({dateFormat:"long-month-day-year"});default:return null}}function f(e){return"name"===(e.name&&e.name.toLowerCase())||"name"===(e.alias&&e.alias.toLowerCase())||void 0}t.createPopupTemplate=function(e,t){var s=e.displayField,l=e.fields,f=e.title,h=e.visibleFieldNames,m=e.editFieldsInfo;if(!l)return null;var y=function(e,t){var r=e;return t.ignoreFieldTypes&&(e=e.filter((function(e){return-1===t.ignoreFieldTypes.indexOf(e.type)}))),0===e.length?null:(e===r&&(e=e.slice()),e.sort(u),{fields:e})}(l,r({},d,t));if(!y)return null;var _=function(e){var t=i.getDisplayFieldName(e),r=e.titleBase;return t?r+": {"+t.trim()+"}":r}({titleBase:f,fields:y.fields,displayField:s}),v=[new o.FieldsContent,new o.AttachmentsContent],g=function(e){var t=e.visibleFieldNames,r=e.editFieldsInfo;return e.fields.map((function(e){return new a({fieldName:e.name,isEditable:p(e,r),label:e.alias,format:c(e),visible:!t||t.has(e.name)})}))}({fields:y.fields,visibleFieldNames:h,editFieldsInfo:m});return new n({title:_,content:v,fieldInfos:g})};var d={ignoreFieldTypes:["geometry","blob","raster","guid","xml"]}}).apply(null,n))||(e.exports=i)},d9Lx:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){function r(e,t){if(!e||!t)return[];var r,i=t;if(t.indexOf("/")>-1?(i=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="",!(r=t?n(e,i).getElementsByTagNameNS("*",t):e.getElementsByTagNameNS("*",i))||0===r.length)return[];for(var o=[],a=0;a<r.length;a++)o.push(r[a]||r.item[a]);return o}function n(e,t){if(!e||!t)return null;var i=t;t.indexOf("/")>-1?(i=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var o=r(e,i);return o.length>0?t?n(o[0],t):o[0]:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getElements=r,t.getElement=n,t.getElementValue=function(e,t){var r,i=n(e,t);return i&&(r=i.textContent||i.nodeValue||i.innerText)?r.trim():null},t.getElementValues=function(e,t){for(var n,i=r(e,t),o=[],a=0;a<i.length;a++)(n=i[a].textContent||i[a].nodeValue||i[a].innerText)&&""!==(n=n.trim())&&o.push(n);return o}}).apply(null,n))||(e.exports=i)},f8aF:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q2wQ"),r("qKT0"),r("HZ3d"),r("9opi"),r("2Atf"),r("TMur"),r("ma1f"),r("LxLY"),r("Vx27"),r("Kjnw"),r("0GEy"),r("bF83"),r("aS1B"),r("Jhq5")],void 0===(i=(function(e,t,r,n,i,o,a,s,l,u,p,c,f,d,h,m){var y=function(e,t){var r=e.get(t);return r&&r.values},_=function(e,t){var r=e.get(t);return r&&r.values[0]};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._files=null,t._headerInfo=null,t._bufferSize=1048576,t}return o(t,e),t.prototype.open=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,p,d,m,y,_,v,g,b,w,P,x,T,I,S,E,R,O,M,C,N,A;return r(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e?u.unwrap(e.signal):null,[4,this.request({url:this.url,range:{from:0,to:this._bufferSize},responseType:"array-buffer"},t)];case 2:if(!(n=r.sent()))throw new l("tiffraster:open","failed to open url "+this.url);return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),i=h.parseSignature(n),[4,this.readIFDs(p=[],n,o=i.littleEndian,i.firstIFD,0,4,t)];case 3:if(r.sent(),d=h.getImageInfo(p),m=d.width,y=d.height,_=d.tileWidth,v=d.tileHeight,g=d.planes,b=d.pixelType,w=d.compression,P=d.firstPyramidLevel,x=d.maximumPyramidLevel,T=d.pyramidBlockWidth,I=d.pyramidBlockHeight,S=d.tileBoundary,E=d.metadata,R=s.Extent.fromJSON(d.extent),O=R.spatialReference,M=new s.Point(R?{x:R.xmin,y:R.ymax,spatialReference:O}:{x:0,y:0}),C=new f({blockWidth:_,blockHeight:v,pyramidBlockWidth:T,pyramidBlockHeight:I,compression:w,origin:M,firstPyramidLevel:P,maximumPyramidLevel:x,blockBoundary:S}),N=new s.Point({x:(R.xmax-R.xmin)/m,y:(R.ymax-R.ymin)/y,spatialReference:O}),A=new c({width:m,height:y,bandCount:g,pixelType:b,compression:w,pixelSize:N,storageInfo:C,spatialReference:O,keyProperties:E?{BandProperties:E.bandProperties,DataType:E.dataType}:null,extent:R,statistics:E?E.statistics:null}),this._set("rasterInfo",A),this._headerInfo=a({littleEndian:o,ifds:p},d),!this._headerInfo.isSupported)throw new l("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);return[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,o){return void 0===o&&(o={}),i(this,void 0,void 0,(function(){var i,a,s,l,u,p,c,f,d,h,m,y,_;return r(this,(function(r){switch(r.label){case 0:return!this._headerInfo&&this._headerInfo.isSupported?[2,null]:(i=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,a=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight,!(s=this.rasterInfo.storageInfo.blockBoundary[e])||s.maxRow<t||s.maxCol<n||s.minRow>t||s.minCol>n?[2,null]:(l=this.getTileLocation(e,t,n))?(u=l.actualTileWidth,p=l.actualTileHeight,c=l.ifd,[4,this.request({url:this.url,range:l.range,responseType:"array-buffer"},o.signal)]):[2,null]);case 1:return f=r.sent(),[4,this.decodePixelBlock(f,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:c,offset:0,size:0},width:i,height:a,planes:null,pixelType:null})];case 2:if(d=r.sent(),u!==i||p!==a)if(_=d.mask)for(h=0;h<a;h++)if(y=h*i,h<p)for(m=u;m<i;m++)_[y+m]=0;else for(m=0;m<i;m++)_[y+m]=0;else for(_=new Uint8Array(i*a),d.mask=_,h=0;h<p;h++)for(y=h*i,m=0;m<u;m++)_[y+m]=1;return[2,d]}}))}))},t.prototype.readIFDs=function(e,t,n,o,a,s,l){return void 0===s&&(s=4),i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return o?o>=t.byteLength||o<0?[4,this.request({url:this.url,range:{from:o+a,to:o+a+this._bufferSize},responseType:"array-buffer"},l)]:[3,2]:[2,null];case 1:t=r.sent(),a=o+a,o=0,r.label=2;case 2:return[4,this.readIFD(t,n,o,a,m.TIFF_TAGS,s,l)];case 3:return i=r.sent(),e.push(i.ifd),i.nextIFD?[4,this.readIFDs(e,t,n,i.nextIFD-a,a,s,l)]:[2,null];case 4:return r.sent(),[2]}}))}))},t.prototype.readIFD=function(e,t,n,o,a,s,l){return void 0===a&&(a=m.TIFF_TAGS),void 0===s&&(s=4),i(this,void 0,void 0,(function(){var i,u,p,c,f,d,y,_;return r(this,(function(r){switch(r.label){case 0:return e?(i=h.parseIFD(e,t,n,o,a,s)).success?(u=[],i.ifd.forEach((function(e){e.values||u.push(e)})),u.length>0?(p=u.map((function(e){return e.offlineOffsetSize})),c=Math.min.apply(null,p.map((function(e){return e[0]}))),Math.min.apply(null,p.map((function(e){return e[0]+e[1]})))-c<=this._bufferSize?[4,this.request({url:this.url,range:{from:c,to:c+this._bufferSize},responseType:"array-buffer"},l)]:[3,2]):[3,2]):[3,5]:[2,null];case 1:e=r.sent(),o=c,u.forEach((function(r){return h.parseFieldValues(e,t,r,o)})),r.label=2;case 2:return i.ifd.has("GEOKEYDIRECTORY")?(f=i.ifd.get("GEOKEYDIRECTORY"),(d=f.values)&&d.length>4?(y=d[0]+"."+d[1]+"."+d[2],[4,this.readIFD(e,t,f.valueOffset+6-o,o,m.GEO_KEYS,2,l)]):[3,4]):[3,4];case 3:_=r.sent(),f.data=_.ifd,f.data&&f.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[y]}),r.label=4;case 4:return[2,i];case 5:return i.requiredBufferSize&&i.requiredBufferSize!==e.byteLength?[4,this.request({url:this.url,range:{from:o,to:o+i.requiredBufferSize+4},responseType:"array-buffer"},l)]:[3,7];case 6:return(e=r.sent()).byteLength<i.requiredBufferSize?[2,null]:[2,this.readIFD(e,t,0,o,m.TIFF_TAGS,4,l)];case 7:return[2]}}))}))},t.prototype.getTileLocation=function(e,t,r){var n=this.rasterInfo.storageInfo,i=n.blockBoundary,o=0===e?0:e-(n.firstPyramidLevel-1),a=this._headerInfo.ifds[o];if(!a)return null;var s=y(a,"TILEOFFSETS");if(void 0===s)return null;var l=y(a,"TILEBYTECOUNTS"),u=i[o],p=u.maxRow,c=u.maxCol;if(t>p||r>c||t<u.minRow||r<u.minCol)return null;var f=_(a,"IMAGEWIDTH"),d=_(a,"IMAGELENGTH"),h=_(a,"TILEWIDTH"),m=_(a,"TILELENGTH"),v=t*(c+1)+r,g=s[v],b=l[v];return null==g||null==b?null:{range:{from:g,to:g+b-1},ifd:a,actualTileWidth:r===c?f%h:h,actualTileHeight:t===p?d%m:m}},n([p.property()],t.prototype,"_files",void 0),n([p.property()],t.prototype,"_headerInfo",void 0),n([p.property()],t.prototype,"_bufferSize",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),n([p.subclass("esri.layers.support.rasterDatasets.TIFFRaster")],t)}(p.declared(d))}).apply(null,n))||(e.exports=i)},huIg:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("n7Tx")],void 0===(i=(function(e,t,r){return function(){function e(){}return Object.defineProperty(e,"supportedVersions",{get:function(){return[5]},enumerable:!0,configurable:!0}),e.parse=function(e){var t=new DataView(e),n=3&t.getUint8(0);if(3!==n)return{header:{version:n},recordSet:null};var i,o=t.getUint32(4,!0),a=t.getUint16(8,!0),s=t.getUint16(10,!0),l={version:n,recordCount:o,headerByteCount:a,recordByteCount:s},u=32,p=[],c=[];if(3===n){for(;13!==t.getUint8(u);)i=String.fromCharCode(t.getUint8(u+11)).trim(),p.push({name:r.bytesToUTF8(new Uint8Array(e,u,11)),type:i,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(i)],length:t.getUint8(u+16)}),u+=32;if(u+=1,p.length>0)for(var f=function(){var n=[];32===t.getUint8(u)?(u+=1,p.forEach((function(t){if("C"===t.type)n.push(r.bytesToUTF8(new Uint8Array(e,u,t.length)).trim());else if("N"===t.type)n.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim(),10));else if("F"===t.type)n.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim()));else if("D"===t.type){var i=String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim();n.push(new Date(parseInt(i.substring(0,4),10),parseInt(i.substring(4,6),10)-1,parseInt(i.substring(6,8),10)))}u+=t.length})),c.push(n)):u+=s};c.length<o&&e.byteLength-u>s;)f()}var d=function(e){var t=e.fields,r=e.records,n=t.some((function(e){return"oid"===e.name.toLowerCase()}))?"OBJECTID":"OID",i=[{name:n,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((function(e){return{name:e.name,type:"esriFieldType"+e.typeName,alias:e.name}}))),o=i.map((function(e){return e.name})),a=[],s=0,l=0;return r.forEach((function(e){var t={};for(t[n]=s++,l=1;l<o.length;l++)t[o[l]]=e[l-1];a.push({attributes:t})})),{displayFieldName:"",fields:i,features:a}}({fields:p,records:c});return{header:l,fields:p,records:c,recordSet:d}},e}()}).apply(null,n))||(e.exports=i)},oKUA:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("9opi"),r("qKT0"),r("Q2wQ"),r("HZ3d"),r("TMur"),r("ifLZ"),r("+UAu"),r("ma1f"),r("LxLY"),r("EUqE"),r("qMld"),r("Vx27"),r("1dvD"),r("0RER"),r("FEX1"),r("QJ8R"),r("WaJo"),r("OXmT"),r("EtsK"),r("7Rj3"),r("KQcO"),r("YM6P"),r("T/jF"),r("pMLx"),r("20+E"),r("6PsE"),r("begh")],void 0===(i=(function(e,t,r,n,i,o,a,s,l,u,p,c,f,d,h,m,y,_,v,g,b,w,P,x,T,I,S,E,R,O){return function(e){function t(t,r){var n=e.call(this,t)||this;return n._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},n._symbolizer=null,n.bandIds=null,n.fullExtent=null,n.interpolation="nearest",n.isReference=null,n.listMode="show",n.raster=null,n.rasterInfo=null,n.spatialReference=null,n.tileInfo=null,n.title=null,n.type="imagery-tile",n.url=null,n.operationalLayerType="ArcGISTiledImageServiceLayer",n.popupEnabled=!0,n.popupTemplate=null,n}return n(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?r({url:e},t):e},t.prototype.load=function(e){var t=this,r=c.isSome(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).then((function(){return t._openRaster(r)}),(function(){return t._openRaster(r)}))),d.resolve(this)},Object.defineProperty(t.prototype,"multidimensionalDefinition",{set:function(e){this.raster&&(this._sliceId=this.raster.getSliceIndex(e)),this._set("multidimensionalDefinition",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return[new x({name:"Raster.PixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{set:function(e){this._set("renderer",e),this.updateRenderer()},enumerable:!0,configurable:!0}),t.prototype.readRenderer=function(e,t,r){var n=u.read(t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,r)||void 0;if(null!=n)return n},t.prototype.createPopupTemplate=function(e){return O.createPopupTemplate(this,e)},t.prototype.updateRenderer=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return this.loaded?JSON.stringify(this._cachedRendererJson)===JSON.stringify(this.renderer)?[2]:(e=this._rasterJobHandler.instance)?(this._symbolizer.renderer=this.renderer,this._symbolizer.bind(),[4,e.updateSymbolizer(this._symbolizer)]):[2]:[2];case 1:return t.sent(),this._cachedRendererJson=this.renderer.toJSON(),[2]}}))}))},t.prototype.applyRenderer=function(e,t){return a(this,void 0,void 0,(function(){var r,n,i;return o(this,(function(o){switch(o.label){case 0:return e&&e.pixels&&e.pixels.length>0?(r=t&&this.renderer&&"raster-stretch"===this.renderer.type,this.updateRenderer(),(i=this._rasterJobHandler.instance)?r?[4,i.stretch({pixelBlock:e,stretchParams:t})]:[3,2]:[3,5]):[2,null];case 1:return n=o.sent(),[3,4];case 2:return[4,i.symbolize(e)];case 3:n=o.sent(),o.label=4;case 4:return[3,6];case 5:n=r?this._symbolizer.simpleStretch(e,t):this._symbolizer.symbolize(e),o.label=6;case 6:return[2,n]}}))}))},t.prototype.fetchTile=function(e,t,n,i){return void 0===i&&(i={}),a(this,void 0,void 0,(function(){return o(this,(function(o){switch(o.label){case 0:return[4,this._initJobHandler()];case 1:return o.sent(),this.multidimensionalDefinition&&(i=r({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:this._sliceId},i)),[2,this.raster.fetchTile(e,t,n,i)]}}))}))},t.prototype.fetchPixels=function(e,t,n,i){return a(this,void 0,void 0,(function(){return o(this,(function(o){switch(o.label){case 0:return[4,this._initJobHandler()];case 1:return o.sent(),this.multidimensionalDefinition&&(i=r({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:this._sliceId},i)),[2,this.raster.fetchPixels(e,t,n,i)]}}))}))},t.prototype.identify=function(e,t){return void 0===t&&(t={}),this.raster.identify(e,t)},t.prototype.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++},t.prototype.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()},t.prototype._initJobHandler=function(){var e=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;var t=new I;return this._rasterJobHandler.connectionPromise=t.initialize().then((function(){e._rasterJobHandler.instance=t,e.raster.rasterJobHandler=t,e.renderer&&e.updateRenderer()})).catch((function(){return null})),this._rasterJobHandler.connectionPromise},t.prototype._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null},t.prototype._openRaster=function(e){return a(this,void 0,void 0,(function(){var t,r,n,i,a,s,l,u,c,f,d;return o(this,(function(o){switch(o.label){case 0:return[4,E.open(this.raster||{url:this.url,signal:e})];case 1:if(t=o.sent(),this.url||(this.url=t.url),this.raster=t,!(r=t.rasterInfo))throw new p("tile-imagery-layer:load","cannot load resources on "+this.url);if(n=r.spatialReference,i=r.pixelSize,!(s=(a=r.storageInfo).tileInfo)){for(l=[],u=a.maximumPyramidLevel||0,c=Math.max(i.x,i.y),f=1/.0254*96*c,d=0;d<=u;d++)l.push({level:u-d,resolution:c,scale:f}),c*=2,f*=2;s=new S({origin:a.origin,size:[a.blockWidth,a.blockHeight],spatialReference:n,lods:l}),a.tileInfo=s}return null==this.title&&(this.title=this.raster.datasetName),r.multidimensionalInfo&&(this._configDefaultSlice(),this._sliceId=this.raster.getSliceIndex(this.multidimensionalDefinition)),this._configDefaultRenderer(),[2,t]}}))}))},t.prototype._configDefaultSlice=function(){var e=this.raster.rasterInfo.multidimensionalInfo.variables[0],t=[];e.dimensions.forEach((function(r){t.push(new P({variableName:e.name,dimensionName:r.name,values:r.values[0],isSlice:!0}))})),this.multidimensionalDefinition=t},t.prototype._configDefaultRenderer=function(){var e=this.raster.rasterInfo,t=e.pixelType;this.bandIds||(this.bandIds=T.getDefaultBandCombination(e)),this.renderer||(this.renderer=T.createDefaultRenderer(e,this.bandIds)),"u8"===t&&this.renderer&&"stretchType"in this.renderer&&"min-max"===this.renderer.stretchType&&this.renderer.dynamicRangeAdjustment&&(this.renderer.dynamicRangeAdjustment=!1,this.renderer.statistics=this.renderer.statistics||[[0,255],[0,255],[0,255]]),this._symbolizer?(this._symbolizer.renderer=this.renderer,this._symbolizer.rasterInfo=e):this._symbolizer=new R({renderer:this.renderer,rasterInfo:e}),this._symbolizer.bind()||(this._symbolizer=null)},i([h.property()],t.prototype,"_cachedRendererJson",void 0),i([h.property()],t.prototype,"_sliceId",void 0),i([h.property()],t.prototype,"_rasterJobHandler",void 0),i([h.property()],t.prototype,"_symbolizer",void 0),i([h.property({type:[m.Integer],json:{write:!0}})],t.prototype,"bandIds",void 0),i([h.property({type:s.Extent}),h.aliasOf("rasterInfo.extent")],t.prototype,"fullExtent",void 0),i([h.property({type:String,json:{write:!0}})],t.prototype,"interpolation",void 0),i([h.property({type:Boolean,json:{read:!1}})],t.prototype,"isReference",void 0),i([h.property({type:["show","hide"]})],t.prototype,"listMode",void 0),i([h.property({type:[P]})],t.prototype,"multidimensionalDefinition",null),i([h.property()],t.prototype,"raster",void 0),i([h.property({readOnly:!0}),h.aliasOf("raster.rasterInfo")],t.prototype,"rasterInfo",void 0),i([h.property({type:s.SpatialReference}),h.aliasOf("rasterInfo.spatialReference")],t.prototype,"spatialReference",void 0),i([h.property({type:S,dependsOn:["rasterInfo"]}),h.aliasOf("rasterInfo.storageInfo.tileInfo")],t.prototype,"tileInfo",void 0),i([h.property()],t.prototype,"title",void 0),i([h.property({readOnly:!0,json:{read:!1}})],t.prototype,"type",void 0),i([h.property(w.url)],t.prototype,"url",void 0),i([h.property({type:["ArcGISTiledImageServiceLayer"]})],t.prototype,"operationalLayerType",void 0),i([h.property(w.popupEnabled)],t.prototype,"popupEnabled",void 0),i([h.property({type:l,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],t.prototype,"popupTemplate",void 0),i([h.property({readOnly:!0,dependsOn:["title"]})],t.prototype,"defaultPopupTemplate",null),i([h.property({readOnly:!0,type:[x]})],t.prototype,"fields",null),i([h.property({types:u.rasterRendererTypes,json:{read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer"}}})],t.prototype,"renderer",null),i([h.reader("renderer")],t.prototype,"readRenderer",null),i([h.subclass("esri.layers.TileImageryLayer")],t)}(h.declared(b.ScaleRangeLayer(g.RefreshableLayer(_.OperationalLayer(v.PortalLayer(f.MultiOriginJSONMixin(y)))))))}).apply(null,n))||(e.exports=i)},w7fK:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("H1tY"),r("qMld")],void 0===(i=(function(e,t,n,i,o){var a,s,l,u,p,c;function f(e){function r(e,t,r){e[t]=r(e[t])}t._pe=e,s.init(),l.init(),u.init(),p.init(),c.init(),t.PeGCSExtent=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n(r,e),r.prototype.destroy=function(){t._pe.destroy(this)},r}(t._pe.PeGCSExtent);for(var i=0,o=[t._pe.PeDatum,t._pe.PeGeogcs,t._pe.PeGeogtran,t._pe.PeObject,t._pe.PeParameter,t._pe.PePrimem,t._pe.PeProjcs,t._pe.PeSpheroid,t._pe.PeUnit];i<o.length;i++)r(o[i].prototype,"getName",(function(e){return function(){return e.call(this,new Array(s.PE_NAME_MAX))}}));for(var a=0,f=[t._pe.PeGeogtran,t._pe.PeProjcs];a<f.length;a++)r(f[a].prototype,"getParameters",(function(e){return function(){for(var r=new Array(s.PE_PARM_MAX),n=e.call(this),i=0;i<r.length;i++){var o=t._pe.getValue(n,"*");r[i]=o?t._pe.wrapPointer(o,t._pe.PeParameter):null,n+=Int32Array.BYTES_PER_ELEMENT}return r}}));r(t._pe.PeHorizon.prototype,"getCoord",(function(e){return function(){var t=this.getSize();if(!t)return null;var r=[];return y(r,t,e.call(this)),r}})),r(t._pe.PeGTlistExtendedEntry.prototype,"getEntries",(function(e){var r=t._pe._pe_getPeGTlistExtendedGTsSize();return function(){var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=this.getSteps();if(o>1)for(var a=t._pe.getPointer(i),s=1;s<o;s++)n.push(t._pe.wrapPointer(a+r*s,t._pe.PeGTlistExtendedGTs))}return n}}));var d=t._pe._pe_getPeHorizonSize(),h=function(e){return function(){var r=this._cache;if(r||(r=new Map,this._cache=r),r.has(e))return r.get(e);var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=i.getNump();if(o>1)for(var a=t._pe.getPointer(i),s=1;s<o;s++)n.push(t._pe.wrapPointer(a+d*s,t._pe.PeHorizon))}return r.set(e,n),n}};r(t._pe.PeProjcs.prototype,"horizonGcsGenerate",h),r(t._pe.PeProjcs.prototype,"horizonPcsGenerate",h),t._pe.PeObject.prototype.toString=function(e){void 0===e&&(e=s.PE_STR_OPTS_NONE),t._pe.ensureCache.prepare();var r=t._pe.getPointer(this),n=t._pe.ensureInt8(new Array(s.PE_BUFFER_MAX));return t._pe.UTF8ToString(t._pe._pe_object_to_string_ext(r,e,n))}}function d(e){if(e){var r=t._pe.getClass(e);if(r){var n=t._pe.getCache(r);if(n){var i=t._pe.getPointer(e);i&&delete n[i]}}}}function h(e,r){for(var n=[],i=new Array(r),o=0;o<e;o++)n.push(t._pe.ensureInt8(i));return n}function m(e){var t;return Array.isArray(e[0])?(t=[],e.forEach((function(e){t.push(e[0],e[1])}))):t=e,t}function y(e,r,n,i){if(void 0===i&&(i=!1),i)for(var o=0;o<2*r;o++)e[o]=t._pe.getValue(n+o*Float64Array.BYTES_PER_ELEMENT,"double");else{var a=0===e.length;for(o=0;o<r;o++)a&&(e[o]=new Array(2)),e[o][0]=t._pe.getValue(n,"double"),e[o][1]=t._pe.getValue(n+Float64Array.BYTES_PER_ELEMENT,"double"),n+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(t,"__esModule",{value:!0}),t._pe=null,t.isLoaded=function(){return!!t._pe},t.isSupported=function(){return!!i("esri-wasm")},t.load=function(){return a||(a=o.create((function(t,n){Promise.all([r.e(0),r.e(44)]).then((function(){var i=[r("dxOQ")];(function(r){r({locateFile:function(t){return e.toUrl("./support/"+t)},onAbort:function(e){n(new Error(e))}}).then((function(e){f(e),t()}))}).apply(null,i)})).catch(r.oe)})))},function(e){function r(e,r,n){t._pe.ensureCache.prepare();var i=m(n),o=n===i,a=t._pe.ensureFloat64(i),s=t._pe._pe_geog_to_proj(t._pe.getPointer(e),r,a);return s&&y(n,r,a,o),s}function n(e,t,r){return i(e,t,r,0)}function i(e,r,n,i){t._pe.ensureCache.prepare();var o=m(n),a=n===o,s=t._pe.ensureFloat64(o),l=t._pe._pe_proj_to_geog_center(t._pe.getPointer(e),r,s,i);return l&&y(n,r,s,a),l}e.geogToProj=r,e.projGeog=function(e,t,i,o){switch(o){case s.PE_TRANSFORM_P_TO_G:return n(e,t,i);case s.PE_TRANSFORM_G_TO_P:return r(e,t,i)}return 0},e.projToGeog=n,e.projToGeogCenter=i}(t.PeCSTransformations||(t.PeCSTransformations={})),function(e){e.init=function(){e.PE_BUFFER_MAX=t._pe.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=t._pe.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=t._pe.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=t._pe.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=t._pe.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=t._pe.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=t._pe.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=t._pe.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=t._pe.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=t._pe.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=t._pe.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=t._pe.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=t._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=t._pe.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=t._pe.PeDefs.prototype.PE_TYPE_UNIT,e.PE_STR_OPTS_NONE=t._pe.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=t._pe.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=t._pe.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=t._pe.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=t._pe.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=t._pe.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=t._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=t._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=t._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=t._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=t._pe.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=t._pe.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=t._pe.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=t._pe.PeDefs.prototype.PE_HORIZON_DELTA}}(s=t.PeDefs||(t.PeDefs={})),function(e){var r={},n={};function i(e,n){var i=null,a=r[e];if(a||(r[e]=a={}),a.hasOwnProperty(String(n)))i=a[n];else{var s=t._pe.PeFactory.prototype.factoryByType(e,n);t._pe.compare(s,t._pe.NULL)||(a[n]=i=s)}return o(i)}function o(e){if(e){var r=e.getType();switch(r){case s.PE_TYPE_GEOGCS:e=t._pe.castObject(e,t._pe.PeGeogcs);break;case s.PE_TYPE_PROJCS:e=t._pe.castObject(e,t._pe.PeProjcs);break;case s.PE_TYPE_GEOGTRAN:e=t._pe.castObject(e,t._pe.PeGeogtran);break;default:r&s.PE_TYPE_UNIT&&(e=t._pe.castObject(e,t._pe.PeUnit))}}return e}e.initialize=function(){t._pe.PeFactory.prototype.initialize(null)},e.coordsys=function(e){return i(s.PE_TYPE_COORDSYS,e)},e.factoryByType=i,e.fromString=function(e,r){var i=null,a=n[e];if(a||(n[e]=a={}),a.hasOwnProperty(r))i=a[r];else{var s=t._pe.PeFactory.prototype.fromString(e,r);t._pe.compare(s,t._pe.NULL)||(a[r]=i=s)}return o(i)},e.geogcs=function(e){return i(s.PE_TYPE_GEOGCS,e)},e.geogtran=function(e){return i(s.PE_TYPE_GEOGTRAN,e)},e.getCode=function(e){return t._pe.PeFactory.prototype.getCode(e)},e.projcs=function(e){return i(s.PE_TYPE_PROJCS,e)},e.unit=function(e){return i(s.PE_TYPE_UNIT,e)}}(t.PeFactory||(t.PeFactory={})),t.PeGCSExtent=null,function(e){var r;e.init=function(){e.PE_GTLIST_OPTS_COMMON=t._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,r=t._pe._pe_getPeGTlistExtendedEntrySize()},e.getGTlist=function(e,n,i,o,a,s){var l=null,u=new t._pe.PeInteger(s);try{var p=t._pe.PeGTlistExtended.prototype.getGTlist(e,n,i,o,a,u);if((s=u.val)&&(l=[p],s>1))for(var c=t._pe.getPointer(p),f=1;f<s;f++)l.push(t._pe.wrapPointer(c+r*f,t._pe.PeGTlistExtendedEntry))}finally{t._pe.destroy(u)}return l}}(l=t.PeGTlistExtended||(t.PeGTlistExtended={})),function(e){e.destroy=function(e){if(e&&e.length){for(var r=0,n=e;r<n.length;r++){var i=n[r];d(i),i.getEntries().forEach((function(e){d(e);var t=e.getGeogtran();d(t),t.getParameters().forEach(d),[t.getGeogcs1(),t.getGeogcs2()].forEach((function(e){d(e);var t=e.getDatum();d(t),d(t.getSpheroid()),d(e.getPrimem()),d(e.getUnit())}))}))}t._pe.PeGTlistExtendedEntry.prototype.Delete(e[0])}}}(t.PeGTlistExtendedEntry||(t.PeGTlistExtendedEntry={})),function(e){e.geogToGeog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=m(n),s=n===a,l=t._pe.ensureFloat64(a),u=0;i&&(u=t._pe.ensureFloat64(i));var p=t._pe._pe_geog_to_geog(t._pe.getPointer(e),r,l,u,o);return p&&y(n,r,l,s),p}}(t.PeGTTransformations||(t.PeGTTransformations={})),function(e){function r(e,r,n,i,o,a){var l,u;switch(t._pe.ensureCache.prepare(),e){case"dd":l=t._pe._pe_geog_to_dd,u=s.PE_DD_MAX;break;case"ddm":l=t._pe._pe_geog_to_ddm,u=s.PE_DDM_MAX;break;case"dms":l=t._pe._pe_geog_to_dms,u=s.PE_DMS_MAX}var p=0;r&&(p=t._pe.getPointer(r));var c=m(i),f=t._pe.ensureFloat64(c),d=h(n,u),y=l(p,n,f,o,t._pe.ensureInt32(d));if(y)for(var _=0;_<n;_++)a[_]=t._pe.UTF8ToString(d[_]);return y}function n(e,r,n,i,o){var a;switch(t._pe.ensureCache.prepare(),e){case"dd":a=t._pe._pe_dd_to_geog;break;case"ddm":a=t._pe._pe_ddm_to_geog;break;case"dms":a=t._pe._pe_dms_to_geog}var s=0;r&&(s=t._pe.getPointer(r));var l=i.map((function(e){return t._pe.ensureString(e)})),u=t._pe.ensureInt32(l),p=t._pe.ensureFloat64(new Array(2*n)),c=a(s,n,u,p);return c&&y(o,n,p),c}e.geog_to_dms=function(e,t,n,i,o){return r("dms",e,t,n,i,o)},e.dms_to_geog=function(e,t,r,i){return n("dms",e,t,r,i)},e.geog_to_ddm=function(e,t,n,i,o){return r("ddm",e,t,n,i,o)},e.ddm_to_geog=function(e,t,r,i){return n("ddm",e,t,r,i)},e.geog_to_dd=function(e,t,n,i,o){return r("dd",e,t,n,i,o)},e.dd_to_geog=function(e,t,r,i){return n("dd",e,t,r,i)}}(t.PeNotationDms||(t.PeNotationDms={})),function(e){e.init=function(){e.PE_MGRS_STYLE_NEW=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=t._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=t._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},e.geog_to_mgrs_extended=function(e,r,n,i,o,a,l){t._pe.ensureCache.prepare();var u=0;e&&(u=t._pe.getPointer(e));var p=m(n),c=t._pe.ensureFloat64(p),f=h(r,s.PE_MGRS_MAX),d=t._pe.ensureInt32(f),y=t._pe._pe_geog_to_mgrs_extended(u,r,c,i,o,a,d);if(y)for(var _=0;_<r;_++)l[_]=t._pe.UTF8ToString(f[_]);return y},e.mgrs_to_geog_extended=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var s=n.map((function(e){return t._pe.ensureString(e)})),l=t._pe.ensureInt32(s),u=t._pe.ensureFloat64(new Array(2*r)),p=t._pe._pe_mgrs_to_geog_extended(a,r,l,i,u);return p&&y(o,r,u),p}}(u=t.PeNotationMgrs||(t.PeNotationMgrs={})),function(e){e.geog_to_usng=function(e,r,n,i,o,a,l){t._pe.ensureCache.prepare();var u=0;e&&(u=t._pe.getPointer(e));var p=m(n),c=t._pe.ensureFloat64(p),f=h(r,s.PE_MGRS_MAX),d=t._pe.ensureInt32(f),y=t._pe._pe_geog_to_usng(u,r,c,i,o,a,d);if(y)for(var _=0;_<r;_++)l[_]=t._pe.UTF8ToString(f[_]);return y},e.usng_to_geog=function(e,r,n,i){t._pe.ensureCache.prepare();var o=0;e&&(o=t._pe.getPointer(e));var a=n.map((function(e){return t._pe.ensureString(e)})),s=t._pe.ensureInt32(a),l=t._pe.ensureFloat64(new Array(2*r)),u=t._pe._pe_usng_to_geog(o,r,s,l);return u&&y(i,r,l),u}}(t.PeNotationUsng||(t.PeNotationUsng={})),function(e){e.init=function(){e.PE_UTM_OPTS_NONE=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS},e.geog_to_utm=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var l=m(n),u=t._pe.ensureFloat64(l),p=h(r,s.PE_UTM_MAX),c=t._pe.ensureInt32(p),f=t._pe._pe_geog_to_utm(a,r,u,i,c);if(f)for(var d=0;d<r;d++)o[d]=t._pe.UTF8ToString(p[d]);return f},e.utm_to_geog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var s=n.map((function(e){return t._pe.ensureString(e)})),l=t._pe.ensureInt32(s),u=t._pe.ensureFloat64(new Array(2*r)),p=t._pe._pe_utm_to_geog(a,r,l,i,u);return p&&y(o,r,u),p}}(p=t.PeNotationUtm||(t.PeNotationUtm={})),function(e){var r=new Map;e.init=function(){e.PE_PCSINFO_OPTION_NONE=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=t._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=t._pe.PePCSInfo.prototype.PE_POLE_POINT},e.generate=function(n,i){var o,a;return void 0===i&&(i=e.PE_PCSINFO_OPTION_DOMAIN),r.has(n)&&(a=r.get(n))[i]&&(o=a[i]),o||(o=t._pe.PePCSInfo.prototype.generate(n,i),a||r.set(n,a=[]),a[i]=o),o}}(c=t.PePCSInfo||(t.PePCSInfo={})),function(e){e.version_string=function(){return t._pe.PeVersion.prototype.version_string()}}(t.PeVersion||(t.PeVersion={})),t._init=f}).apply(null,n))||(e.exports=i)},wIC5:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qMld"),r("w7fK"),r("Z4y+"),r("OkCb")],void 0===(i=(function(e,t,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=null;t.isLoaded=function(){return!!s&&i.isLoaded()},t.isSupported=function(){return i.isSupported()};var l=null;t.load=function(){return l||(l=n.create((function(e,t){var n=i.load();Promise.resolve().then((function(){var o=[r("21p4")];(function(r){s=r,n.then((function(){s._enableProjection(i),e()}),(function(e){t(e)}))}).apply(null,o)})).catch(r.oe)})))},t.project=function(e,t,r){return void 0===r&&(r=null),e instanceof Array?0===e.length?[]:p(e,e[0].spatialReference,t,r):p([e],e.spatialReference,t,r)[0]};var u={};function p(e,t,r,n,i){if(void 0===n&&(n=null),void 0===i&&(i=!1),null===n){var l=a.cacheKey(t,r);void 0!==u[l]?n=u[l]:(null===(n=c(t,r,null))&&(n=new a),u[l]=n)}return s._project(e,t,r instanceof o||!1===i?r:new o(r),n,i)}function c(e,t,r){void 0===r&&(r=null);var n=s._getTransformation(e,t,r);return null!==n?a.fromGE(n):null}t.projectMany=p,t.getTransformation=c,t.getTransformations=function(e,t,r){void 0===r&&(r=null);var n=s._getTransformationBySuitability(e,t,r);if(null!==n){for(var i=[],o=0,l=n;o<l.length;o++)i.push(a.fromGE(l[o]));return i}return[]}}).apply(null,n))||(e.exports=i)},xB1n:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q2wQ"),r("qKT0"),r("HZ3d"),r("9opi"),r("2Atf"),r("TMur"),r("zp6E"),r("ma1f"),r("LxLY"),r("qMld"),r("jfWY"),r("Vx27"),r("Kjnw"),r("0GEy"),r("pMLx"),r("Cobz"),r("bF83"),r("SAwq"),r("w1v0")],void 0===(i=(function(e,t,r,n,i,o,a,s,l,u,p,c,f,d,h,m,y,_,v,g,b){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._levelOffset=0,t._slices=null,t._tilemapCache=null,t.sourceJSON=null,t}return o(t,e),t.prototype.open=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,s,c,d,h,v,g,b,w,P,x,T,I,S,E,R,O,M,C,N,A;return r(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e&&e.signal,this.sourceJSON?(i={data:this.sourceJSON},[3,4]):[3,2];case 2:return[4,l(this.url,{responseType:"json",query:{f:"json"},signal:t})];case 3:i=r.sent(),r.label=4;case 4:if((n=i).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=o=n.data,a=["jpg","jpeg","png","png8","png24","png32","mixed"],this.tileType=o.cacheType,null===this.tileType&&(this.tileType=a.indexOf(o.tileInfo.format.toLowerCase())>-1?"Map":"lerc"===o.tileInfo.format.toLowerCase()?"Elevation":"Raster"),!o||!o.tileInfo)throw new u("imageserverraster:open","cannot initialize tiled image service");return this.datasetName=o.name,[4,this._fetchRasterInfo({signal:t})];case 5:if(s=r.sent(),!p.isSome(s))throw new u("image-server-raster:open","cannot initialize image service");if(c=y.fromJSON(o.tileInfo),d=s.extent,v=.5/s.width*(h=s.pixelSize).x,g=void 0,b=void 0,w=c.lodAt(Math.max.apply(null,c.lods.map((function(e){return e.level})))),0!==o.maxScale&&("Raster"===this.tileType?(g=c.lods.filter((function(e){return e.resolution===h.x}))[0])||(g=c.lods.filter((function(e){return e.resolution>h.x})).sort((function(e,t){return e.resolution>t.resolution?1:-1}))[0]):(g=c.lods.filter((function(e){return Math.abs(e.scale-o.maxScale)<v}))[0])||(g=c.lods.filter((function(e){return e.scale>o.maxScale})).sort((function(e,t){return e.scale>t.scale?1:-1}))[0]),h.x=h.y=g.resolution,s.width=Math.ceil((d.xmax-d.xmin)/h.x-.1),s.height=Math.ceil((d.ymax-d.ymin)/h.y-.1)),g||(g=w),P=c.lodAt(Math.min.apply(null,c.lods.map((function(e){return e.level})))),0!==o.minScale&&"Raster"!==this.tileType&&(b=c.lods.filter((function(e){return Math.abs(e.scale-o.minScale)<v}))[0],this._levelOffset=b.level-P.level),b||(b=P),x=Math.max(h.x,h.y),(Math.abs(h.x-h.y)>v||!c.lods.some((function(e){return Math.abs(e.resolution-x)<v})))&&(h.x=h.y=g.resolution,s.width=Math.ceil((d.xmax-d.xmin)/h.x-.1),s.height=Math.ceil((d.ymax-d.ymin)/h.y-.1)),T=g.level-b.level,S=(I=c.size)[0],E=I[1],R=c.origin,O=h.x,M=h.y,C=[{minCol:Math.floor((d.xmin-R.x+.1*O)/S/O),maxCol:Math.floor((d.xmax-R.x-.1*O)/S/O),minRow:Math.floor((R.y-d.ymax+.1*M)/E/M),maxRow:Math.floor((R.y-d.ymin-.1*M)/E/M)}],T>0)for(N=0;N<T;N++)O*=2,M*=2,C.push({minCol:Math.floor((d.xmin-R.x+.1*O)/S/O),maxCol:Math.floor((d.xmax-R.x-.1*O)/S/O),minRow:Math.floor((R.y-d.ymax+.1*M)/E/O),maxRow:Math.floor((R.y-d.ymin-.1*M)/E/O)});return s.storageInfo=new m({blockWidth:c.size[0],blockHeight:c.size[1],pyramidBlockWidth:c.size[0],pyramidBlockHeight:c.size[1],compression:c.format,origin:c.origin,firstPyramidLevel:1,maximumPyramidLevel:T,tileInfo:c,blockBoundary:C}),this._set("rasterInfo",s),o.capabilities.toLowerCase().indexOf("tilemap")>-1&&(A={tileInfo:s.storageInfo.tileInfo,parsedUrl:f.urlToObject(this.url),url:this.url,tileServers:[],type:"tile"},this._tilemapCache=new _.TilemapCache({layer:A})),[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,o){return void 0===o&&(o={}),i(this,void 0,void 0,(function(){var i,a,s,l,u,p,c,f,d,h,m,y,_,v,b,w,P;return r(this,(function(r){switch(r.label){case 0:return s=(i=this.rasterInfo).extent,l=i.pixelSize,[4,this.request({url:this.url+"/tile/"+((a=i.storageInfo).maximumPyramidLevel-e+this._levelOffset)+"/"+t+"/"+n,query:this._slices?{sliceId:o.sliceId||0}:null,responseType:"array-buffer"},o.signal)];case 1:return(u=r.sent())?[4,this.decodePixelBlock(u,{width:a.tileInfo.size[0],height:a.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType})]:[2,null];case 2:return p=r.sent(),c=a.blockBoundary[e],"jpg"!==a.compression||n>c.minCol&&n<c.maxCol&&t>c.minRow&&t<c.maxRow||(f=a.origin,d=a.blockWidth,h=a.blockHeight,m=Math.pow(2,e),y=Math.round((s.xmin-f.x)/(l.x*m))%d,_=Math.round((s.xmax-f.x)/(l.x*m))%d,v=Math.round((f.y-s.ymax)/(l.x*m))%h,b=Math.round((f.y-s.ymin)/(l.x*m))%h,g.setValidBoundary(p,{x:w=n===c.minCol?y:0,y:P=t===c.minRow?v:0},{width:(n===c.maxCol?_:d)-w,height:(t===c.maxRow?b:h)-P})),[2,p]}}))}))},t.prototype.getSliceIndex=function(e){for(var t=e,r=0;r<this._slices.length;r++){var n=this._slices[r].multidimensionalDefinition;if(n.length===t.length&&!n.some((function(e){var r=t.filter((function(t){return e.variableName===t.variableName&&t.dimensionName===e.dimensionName}))[0];return r?(Array.isArray(e.values[0])?e.values[0][0]:e.values[0])!==(Array.isArray(r.values[0])?r.values[0][0]:r.values[0]):null})))return r}return null},t.prototype.computeBestPyramidLevelForLocation=function(e,t){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){var n,i,o,a;return r(this,(function(r){switch(r.label){case 0:if(!this._tilemapCache)return[2,0];if(null===(n=this.identifyPixelLocation(e,0,t.datumTransformation)))return[2,null];o=this.rasterInfo.storageInfo.maximumPyramidLevel-(i=0)+this._levelOffset,a=n.srcLocation,r.label=1;case 1:if(!(o>=0))return[3,6];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._tilemapCache.fetchAvailability(o,n.row,n.col,t)];case 3:return"available"===r.sent()?[3,6]:[3,5];case 4:return r.sent(),[3,5];case 5:return o--,i++,null===(n=this.identifyPixelLocation(a,i,t.datumTransformation))?[2,null]:[3,1];case 6:return-1===o||null==n?[2,null]:[2,i]}}))}))},t.prototype._fetchRasterInfo=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,u,p,f,d,m,y,_,v=this;return r(this,(function(r){return t=this.sourceJSON,n=Math.ceil((t.extent.xmax-t.extent.xmin)/t.pixelSizeX-.1),i=Math.ceil((t.extent.ymax-t.extent.ymin)/t.pixelSizeY-.1),o=s.SpatialReference.fromJSON(t.spatialReference||t.extent.spatialReference),"Map"===this.tileType?[2,new h({width:n,height:i,bandCount:3,extent:s.Extent.fromJSON(t.extent),spatialReference:o,pixelSize:new s.Point({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:o}),pixelType:"u8",statistics:null})]:(a=e.slice,u=e.signal,p=!!t.hasRasterAttributeTable&&l(this.url+"/rasterAttributeTable",{query:{slice:a,f:"json"},signal:u}).then((function(e){return b.fromJSON(e.data)})).catch((function(){return null})),f=!!t.hasColormap&&l(this.url+"/colormap",{query:{slice:a,f:"json"},signal:u}).then((function(e){return e.data&&e.data.colormap})),d=!!t.hasHistograms&&l(this.url+"/histograms",{query:{slice:a,f:"json"},signal:u}).then((function(e){return e.data&&e.data.histograms})),m=l(this.url+"/keyProperties",{query:{f:"json"},signal:u}).then((function(e){return e.data})).catch((function(){})),y=!!t.hasMultidimensions&&l(this.url+"/multidimensionalInfo",{query:{f:"json"},signal:u}).then((function(e){return e.data&&e.data.multidimensionalInfo})),_=!!t.hasMultidimensions&&l(this.url+"/slices",{query:{f:"json"},signal:u}).then((function(e){return e.data&&e.data.slices})).catch((function(){})),[2,c.all([p,f,d,m,y,_]).then((function(e){var r=null;if(t.minValues&&t.minValues.length===t.bandCount){r=[];for(var a=0;a<t.minValues.length;a++)r.push({min:t.minValues[a],max:t.maxValues[a],avg:t.meanValues[a],stddev:t.stdvValues[a]})}return v._slices=e[5]||null,new h({width:n,height:i,bandCount:t.bandCount,extent:s.Extent.fromJSON(t.extent),spatialReference:o,pixelSize:new s.Point({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:o}),pixelType:t.pixelType.toLowerCase(),statistics:r,attributeTable:e[0]||null,colormap:e[1]||null,histograms:e[2]||null,keyProperties:e[3]||null,multidimensionalInfo:e[4]||null})}))])}))}))},n([d.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),n([d.property()],t.prototype,"sourceJSON",void 0),n([d.property()],t.prototype,"tileType",void 0),n([d.subclass("esri.layers.support.rasterDatasets.ImageServerRaster")],t)}(d.declared(v))}).apply(null,n))||(e.exports=i)},xojL:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("zp6E"),r("KY0m"),r("ma1f"),r("rg9i")],void 0===(i=(function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return e.prototype.getAvailability=function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var r=(e-this.location.top)*this.location.width+(t-this.location.left),n=r>>3,i=this._tileAvailabilityBitSet;return n<0||n>i.length?"unknown":i[n]&1<<r%8?"available":"unavailable"},e.prototype._updateFromData=function(e){for(var t=!0,r=!0,n=Math.ceil(this.location.width*this.location.height/8),i=new Uint8Array(n),o=0,a=0;a<e.length;a++){var s=a%8;e[a]?(r=!1,i[o]|=1<<s):t=!1,7===s&&++o}r?this._allAvailability="unavailable":t?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=i,this.byteSize+=i.length)},e.fromDefinition=function(t,a){var s=t.service.request||n,u=t.row,p=t.col,c=t.width,f=t.height,d={query:{f:"json"}};return a=a?r({},d,a):d,s(l(t),a).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:u,left:p,width:c,height:f},valid:!0,data:i.constant(c*f,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==u||t.location.left!==p||t.location.width!==c||t.location.height!==f))throw new o("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:u,left:p,width:c,height:f}});return e.fromJSON(t)}))},e.fromJSON=function(t){e.validateJSON(t);var r=new e;return r.location=Object.freeze(a.clone(t.location)),r._updateFromData(t.data),Object.freeze(r)},e.validateJSON=function(e){if(!e||!e.location)throw new o("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new o("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new o("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new o("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new o("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();function l(e){var t;if("vector-tile"===e.service.type)t=e.service.url+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height;else{var r=e.service.tileServers;t=(r&&r.length?r[e.row%r.length]:e.service.url)+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height}var n=e.service.query;return n&&(t=t+"?"+n),t}t.Tilemap=s,t.tilemapDefinitionId=function(e){return e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height},t.tilemapDefinitionUrl=l,t.default=s}).apply(null,n))||(e.exports=i)}}]);