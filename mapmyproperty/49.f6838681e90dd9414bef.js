(function(){var e={"arcgis-js-api/views/2d/layers/features/support/ClusterStore":"0SZq","arcgis-js-api/views/2d/engine/webgl/color":"4F/P","arcgis-js-api/views/2d/engine/webgl/SymbolProperties":"7AYJ","arcgis-js-api/views/2d/layers/features/sources/DataTileSource":"8ajZ","arcgis-js-api/geohash/geohashUtils":"8pdz","arcgis-js-api/views/2d/engine/webgl/number":"Dos2","arcgis-js-api/core/libs/gl-matrix-2/mat4":"FXVB","arcgis-js-api/layers/ogc/ogcFeatureUtils":"GI9R","arcgis-js-api/views/2d/layers/features/Source2D":"IFRM","arcgis-js-api/views/2d/engine/webgl/enums":"JNkf","arcgis-js-api/geohash/GeohashTree":"JOu6","arcgis-js-api/core/libs/gl-matrix-2/math/mat4":"Jl7l","arcgis-js-api/views/2d/layers/features/support/FeatureSetReaderPBF":"R2+F","arcgis-js-api/views/2d/layers/features/processors":"R3Fd","arcgis-js-api/views/2d/layers/features/sources/createSource":"T+hO","arcgis-js-api/layers/graphics/sources/connections/StreamConnection":"aROD","arcgis-js-api/views/2d/engine/webgl/Utils":"apbF","arcgis-js-api/views/2d/layers/features/support/FeatureSetReaderPBFHeader":"cxbm","arcgis-js-api/layers/graphics/sources/connections/GeoEventConnection":"gSUo","arcgis-js-api/layers/graphics/data/StreamFeatureManager":"gsnf","arcgis-js-api/views/2d/layers/features/support/UpdateToken":"iqqO","arcgis-js-api/views/2d/layers/features/controllers/support/sources":"k6A/","arcgis-js-api/views/2d/layers/features/sources/DrillDownFeatureSource":"lZYi","arcgis-js-api/layers/graphics/sources/connections/WebSocketConnection":"mucn","arcgis-js-api/views/2d/layers/features/controllers/FeatureController2D":"nfmf","arcgis-js-api/views/2d/layers/features/Pipeline":"par7","arcgis-js-api/views/2d/layers/features/sources/PagedFeatureSource":"pzEE","arcgis-js-api/views/2d/layers/features/sources/BaseFeatureSource":"rM8A","arcgis-js-api/views/2d/engine/webgl/definitions":"tI6k","arcgis-js-api/views/2d/layers/features/sources/GeoEventSource":"tRKJ"},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{"0SZq":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("TMur"),r("BcWh"),r("H1tY"),r("LxLY"),r("CYRa"),r("JOu6"),r("8pdz"),r("KDna"),r("nrlZ"),r("+6sX"),r("/COu"),r("Jvs9"),r("Q2Em"),r("tI6k"),r("7/gB"),r("ZB9i")],void 0===(n=(function(e,t,r,i,n,o,a,s,u,c,l,h,d,f,p,_,g,y,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClusterStore=void 0;var m=function(e){function t(t,r,i,n,o){var a=this,s=new p.default([],[r,i]);return(a=e.call(this,s,n,null,t)||this).geohashBoundsInfo=o,a}return r.__extends(t,e),Object.defineProperty(t.prototype,"count",{get:function(){return this.attributes.cluster_count},enumerable:!1,configurable:!0}),t.create=function(e,r,i,n,o,a,s,u){var c=new t(r,i,n,a,s);return c.displayId=e.createDisplayId(!0),c.referenceId=u,c.tileLevel=o,c},t.prototype.update=function(e,t,r,i,n,o){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=i,this.geohashBoundsInfo=n,this.referenceId=null,this.referenceId=o,this},t.prototype.toJSON=function(){return{objectId:this.objectId,referenceId:1===this.attributes.cluster_count?this.referenceId:null,attributes:r.__assign(r.__assign({},this.attributes),{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},t}(f.default);function b(e){return 57.29577951308232*e}var T=function(e){function t(t,r,o){var a=e.call(this,t,o)||this;return a.events=new n,a._geohashLevel=0,a._aggregateValueRanges={},a._aggregateValueRangesChanged=!1,a._geohashBuf=[],a._clusters=new Map,a._tiles=new Map,a.geometryInfo=t.geometryInfo,a._spatialReference=r,a._projectionSupportCheck=_.checkProjectionSupport(r,i.SpatialReference.WGS84),a._bitsets.geohash=o.getBitset(o.createBitset()),a._bitsets.inserted=o.getBitset(o.createBitset()),a}return r.__extends(t,e),t.prototype.updateSchema=function(t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,c,l;return r.__generator(this,(function(r){switch(r.label){case 0:n=this._schema,r.label=1;case 1:return r.trys.push([1,4,,5]),[4,e.prototype.updateSchema.call(this,t,i)];case 2:return r.sent(),[4,this._projectionSupportCheck];case 3:return r.sent(),[3,5];case 4:return c=r.sent(),o("esri-2d-debug")&&console.debug(c),[3,5];case 5:return l=s.diff(n,i),t.mesh&&(t.targets.aggregate=!0),!i||a.isNone(l)&&!t.source&&!t.storage.filters||((s.hasDiff(l,"params.fields")||!this._tree||t.source)&&(this._tree=new u.GeohashTree(i.params.fields,this._statisticFields),this._rebuildTree(),o("esri-2d-update-debug")&&console.debug("Aggregate mesh needs update due to tree changing")),o("esri-2d-update-debug")&&console.debug("Applying Update - ClusterStore:",l),t.mesh=!0,t.targets[i.name]=!0,this._aggregateValueRanges={}),[2]}}))}))},t.prototype.sweepFeatures=function(e,t){var r=this;this._bitsets.inserted.forEachSet((function(i){if(!e.has(i)){var n=t.lookupByDisplayIdUnsafe(i);r._remove(n)}}))},t.prototype.sweepClusters=function(e,t){var r=this;this._clusters.forEach((function(i,n){i&&i.tileLevel!==t&&(e.releaseDisplayId(i.displayId),r._clusters.delete(n))}))},t.prototype.onTileData=function(e,t,r,i,n,o){if(!this._schema||a.isNone(t.addOrUpdate))return t;for(var s=this._tree,u=this._getTransforms(e,this._spatialReference),c=t.addOrUpdate.getCursor();c.next();)this._update(c,n,s);if(!o)return t;var l=new Array;for(this._getClustersForTile(l,e,this._schema.params.clusterRadius,r,s,u),t.type="replace"===t.type?"replace":"update",t.addOrUpdate=v.FeatureSetReaderJSON.fromOptimizedFeatures(l,"esriGeometryPoint"),t.addOrUpdate._storage=r,c=t.addOrUpdate.getCursor();c.next();){var h=c.getDisplayId();this._bitsets.computed.unset(h),this.setComputedAttributes(r,c,h,e.scale)}return this._aggregateValueRangesChanged&&t.end&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),t},t.prototype.onTileUpdate=function(e){var t=this,r=e.added,i=e.removed;if(r.length&&this._setGeohashLevel(r[0].level),this._schema){var n=this._schema.params.clusterRadius;i.forEach((function(e){t._tiles.delete(e.key.id),t._markTileClustersForDeletion(e,n)}))}},t.prototype.getAggregate=function(e){var t=null;return this._clusters.forEach((function(r){r&&r.displayId===e&&(t=r.toJSON())})),t},t.prototype.getDisplayId=function(e){var t=this._clusters.get(e);return t?t.displayId:null},t.prototype.getDisplayIdForReferenceId=function(e){var t;return this._clusters.forEach((function(r){r&&r.referenceId===e&&(t=r.displayId)})),t},t.prototype.getAggregateValueRanges=function(){return this._aggregateValueRanges},t.prototype._rebuildTree=function(){this._bitsets.computed.clear(),this._bitsets.inserted.clear(),this._tree&&this._tree.clear()},t.prototype._remove=function(e){var t=e.getDisplayId(),r=e.getXHydrate(),i=e.getYHydrate(),n=this._geohashBuf[2*t],o=this._geohashBuf[2*t+1];this._bitsets.inserted.has(t)&&(this._bitsets.inserted.unset(t),this._tree.removeCursor(e,r,i,n,o,this._geohashLevel))},t.prototype._update=function(e,t,r){var i=e.getDisplayId(),n=this._bitsets.inserted,o=t.isVisible(i);if(o!==n.has(i))if(o){var a=e.getXHydrate(),s=e.getYHydrate();this._setGeohash(i,a,s)&&(r.insertCursor(e,i,a,s,this._geohashBuf[2*i],this._geohashBuf[2*i+1],this._geohashLevel),n.set(i))}else this._remove(e)},t.prototype._setGeohash=function(e,t,r){if(this._bitsets.geohash.has(e))return!0;var n=this._geohashBuf;if(this._spatialReference.isWebMercator){var a=b(t/l.earthRadius),s=a-360*Math.floor((a+180)/360),u=b(Math.PI/2-2*Math.atan(Math.exp(-1*r/l.earthRadius)));c.setGeohashBuf(n,e,u,s,12)}else{var h=_.project({x:t,y:r},this._spatialReference,i.SpatialReference.WGS84);if(!h)return o("esri-2d-debug")&&console.debug("Tried to project feature geometry, but got back `null`"),!1;c.setGeohashBuf(n,e,h.y,h.x,12)}return this._bitsets.geohash.set(e),!0},t.prototype._getClustersForTile=function(e,t,i,n,o,s,u){void 0===u&&(u=!0);for(var c=this._schema.params.clusterPixelBuffer,l=2*i,h=this._getGeohashLevel(t.key.level),p=Math.pow(2,t.key.level)*Math.ceil(g.TILE_SIZE/l),_=Math.ceil(c/l)+0,y=Math.ceil(g.TILE_SIZE/l),v=t.key,m=v.row*g.TILE_SIZE,b=Math.floor(v.col*g.TILE_SIZE/l)-_,T=Math.floor(m/l)-_,I=b+y+2*_,E=T+y+2*_,S=t.tileInfoView.getLODInfoAt(t.key.level),w=b;w<=I;w++)for(var F=function(i){var c=w;S.wrap&&(c=w<0?w+p:w%p);var l=S.wrap&&w<0,_=S.wrap&&w%p!==w,g=R._lookupCluster(n,S,t.key.level,c,i,h,o);if(a.isSome(g)){var y=a.andThen(s,(function(e){return l?e.left:_?e.right:e.tile}));if(u&&a.isNone(y))return"continue";if(!g.count)return"continue";if(a.isSome(y)&&u){var v=g.geometry.clone(),m=g.attributes;v.coords[0]=d.quantizeX(y,v.coords[0]),v.coords[1]=d.quantizeY(y,v.coords[1]),1===g.count&&a.isSome(g.referenceId)&&(m=r.__assign(r.__assign({},g.attributes),{referenceId:g.referenceId}));var b=new f.default(v,m);b.displayId=g.displayId,e.push(b)}}},R=this,x=T;x<=E;x++)F(x)},t.prototype._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},t.prototype._setGeohashLevel=function(e){var t=this._getGeohashLevel(e),r=1*(Math.floor(t/1)+1)-1;if(this._geohashLevel!==r)return this._geohashLevel=r,void this._rebuildTree()},t.prototype._getTransforms=function(e,t){var i={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},n=h.getInfo(t);if(!n)return{tile:i,left:null,right:null};var o=n.valid,a=o[0],s=o[1];return{tile:i,left:r.__assign(r.__assign({},i),{translate:[s,e.bounds[3]]}),right:r.__assign(r.__assign({},i),{translate:[a-s+e.bounds[0],e.bounds[3]]})}},t.prototype._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},t.prototype._markForDeletion=function(e,t,r){var i=this._getClusterId(e,t,r);this._clusters.delete(i)},t.prototype._getClusterBounds=function(e,t,r){var i=this._schema.params.clusterRadius,n=2*i,o=r%2?t*n:t*n+i,a=r*n,s=a/g.TILE_SIZE,u=(o+n)/g.TILE_SIZE,c=(a-n)/g.TILE_SIZE;return[e.getXForColumn(o/g.TILE_SIZE),e.getYForRow(s),e.getXForColumn(u),e.getYForRow(c)]},t.prototype._lookupCluster=function(e,t,n,o,s,u,h){var d=this._getClusterId(n,o,s),f=this._clusters.get(d),p=this._getClusterBounds(t,o,s),g=p[0],y=p[1],v=p[2],T=p[3],I={x:g,y:y},E={x:v,y:T},S=0,w=0,F=0,R=0;if(this._spatialReference.isWebMercator){var x;S=(x=b(I.x/l.earthRadius))-360*Math.floor((x+180)/360),w=b(Math.PI/2-2*Math.atan(Math.exp(-1*I.y/l.earthRadius))),F=(x=b(E.x/l.earthRadius))-360*Math.floor((x+180)/360),R=b(Math.PI/2-2*Math.atan(Math.exp(-1*E.y/l.earthRadius)))}else{var M=_.project(I,this._spatialReference,i.SpatialReference.WGS84),O=_.project(E,this._spatialReference,i.SpatialReference.WGS84);if(!M||!O)return null;S=M.x,w=M.y,F=O.x,R=O.y}S>F&&(F=180);var A={geohashX:0,geohashY:0},L={geohashX:0,geohashY:0};c.setGeohashXY(A,w,S,u),c.setGeohashXY(L,R,F,u);var C=A.geohashX,P=A.geohashY,N=L.geohashX,D=L.geohashY,G={xLL:C,yLL:P,xTR:N,yTR:D,level:u},q=h.getRegionStatistics(C,P,N,D,u),k=q.count,B=q.referenceId,j=k?q.xTotal/k:0,U=k?q.yTotal/k:0;if(0===k)return this._clusters.set(d,null),null;var V=r.__assign({cluster_count:k},q.attributes),X=a.isSome(f)?f.update(j,U,n,V,G,B):m.create(e,d,j,U,n,V,G,B);return 0===k&&(X.geometry.coords[0]=(g+v)/2,X.geometry.coords[1]=(y+T)/2),this._clusters.set(d,X),this._updateAggregateValueRangeForCluster(X,X.tileLevel),X},t.prototype._updateAggregateValueRangeForCluster=function(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},i=r.minValue,n=r.maxValue;r.minValue=Math.min(i,e.count),r.maxValue=Math.max(n,e.count),this._aggregateValueRanges[t]=r,i===r.minValue&&n===r.maxValue||(this._aggregateValueRangesChanged=!0)},t.prototype._markTileClustersForDeletion=function(e,t){for(var r=2*t,i=Math.ceil(g.TILE_SIZE/r),n=e.key,o=n.row*g.TILE_SIZE,a=Math.floor(n.col*g.TILE_SIZE/r),s=Math.floor(o/r),u=a;u<a+i;u++)for(var c=s;c<s+i;c++)this._markForDeletion(e.key.level,u,c)},t}(y.Store2D);t.ClusterStore=T}).apply(null,i))||(e.exports=n)},"4F/P":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("Dos2")],void 0===(n=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.premultiplyAlphaRGBAArray=t.premultiplyAlphaRGBA=t.premultiplyAlphaUint32=t.copyAndPremultiply=t.premultiplyAlpha=t.white=void 0,t.white=[255,255,255,1];var i=[0,0,0,0];function n(e,t){return Array.isArray(t)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):(e[0]=t.r,e[1]=t.g,e[2]=t.b,e[3]=t.a),e}function o(e,t,r){void 0===t&&(t=0),void 0===r&&(r=!1);var i=e[t+3];return e[t+0]*=i,e[t+1]*=i,e[t+2]*=i,r||(e[t+3]*=255),e}t.premultiplyAlpha=o,t.copyAndPremultiply=function(e){return o(n([],e))},t.premultiplyAlphaUint32=function(e){return o(n(i,e)),r.i8888to32(i[0],i[1],i[2],i[3])},t.premultiplyAlphaRGBA=function(e){if(!e)return 0;var t=e.a;return r.i8888to32(e.r*t,e.g*t,e.b*t,255*t)},t.premultiplyAlphaRGBAArray=function(e){if(!e)return 0;var t=e[3];return r.i8888to32(e[0]*(t/255),e[1]*(t/255),e[2]*(t/255),t)}}).apply(null,i))||(e.exports=n)},"7AYJ":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("SyoC")],void 0===(n=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextProperties=void 0;var i=function(){function e(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}return e.prototype.acquire=function(e,t,r,i,n,o,a,s,u){this.color=e,this.haloColor=t,this.haloSize=r,this.size=i,this.angle=n,this.offsetX=o,this.offsetY=a,this.hAnchor=s,this.vAnchor=u},e.prototype.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0},e.pool=new r(e),e}();t.TextProperties=i}).apply(null,i))||(e.exports=n)},"8ajZ":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("BcWh"),r("LxLY"),r("CYRa")],void 0===(n=(function(e,t,r,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataTileSource=t.DataTileSubscription=void 0;var a=function(){function e(e){this._abortController=new AbortController,this.requests={pending:new Array,done:new Array},this.tile=e}return Object.defineProperty(e.prototype,"signal",{get:function(){return this._abortController.signal},enumerable:!1,configurable:!0}),e.prototype.add=function(e){this.requests.done.push(e),e.request.end&&(this.resolved=!0)},e.prototype.abort=function(){this._abortController.abort()},e}();t.DataTileSubscription=a;var s=function(){function e(e){this.events=new i,this._subscriptions=new Map,this._serviceQueryInfo={outSpatialReference:e.outSR},this._serviceInfo=e.serviceInfo,this._onRequest=e.onRequest}return e.prototype.queryLastEditDate=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){throw new Error("Service does not support query type")}))}))},e.prototype.query=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){throw new Error("Service does not support query")}))}))},Object.defineProperty(e.prototype,"geometryType",{get:function(){return this._serviceInfo.geometryType},enumerable:!1,configurable:!0}),e.prototype.update=function(e){o.diff(e,this._sourceQueryInfo)&&(this._sourceQueryInfo=e)},e.prototype.updateSubscriptions=function(){},e.prototype.setViewState=function(e){},e.prototype.subscribe=function(e){var t=new a(e);this._subscriptions.set(e.id,t)},e.prototype.unsubscribe=function(e){var t=this.get(e.id);n.isSome(t)&&t.abort(),this._subscriptions.delete(e.id)},e.prototype.pause=function(){},e.prototype.resume=function(){},e.prototype.get=function(e){return this._subscriptions.has(e)?this._subscriptions.get(e):null},e.prototype.enableEvent=function(e,t){},e}();t.DataTileSource=s}).apply(null,i))||(e.exports=n)},"8pdz":function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.forEachIntersectingGeohash=t.getIntersectingGeohashes=t.getRelativeGeohash=t.unpackYBits=t.unpackXBits=t.lonDistPerGeohash=t.latDistPerGeohash=t.encodeGeohash=t.setGeohashBuf=t.setGeohashXY=t.decodeGeohashXY=t.convertGeohash32ToXY=t.decodeGeohash=t.encodeBase32Char=t.decodeBase32Char=void 0;var r=new Float64Array(2),i=new Float64Array(2);function n(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function o(e){return"0123456789bcdefghjkmnpqrstuvwxyz"[e]}function a(e){return(e[0]+e[1])/2}function s(e,t,r){return e[0]=t,e[1]=r,e}function u(e,t){var r=a(e),i=t,n=!t;e[0]=n*e[0]+i*r,e[1]=n*r+i*e[1]}function c(e,t){var r=t>a(e);return u(e,r),r}function l(e,t){for(var o=s(r,-90,90),c=s(i,-180,180),l=0;l<t.length;l++){var h=n(t.charCodeAt(l));l%2==0?(u(c,!!(16&h)),u(c,!!(4&h)),u(c,!!(1&h)),u(o,!!(8&h)),u(o,!!(2&h))):(u(o,!!(16&h)),u(o,!!(4&h)),u(o,!!(1&h)),u(c,!!(8&h)),u(c,!!(2&h)))}return e[0]=a(o),e[1]=a(c),e}function h(e,t,n){for(var a="",u=s(r,-90,90),l=s(i,-180,180),h=0;h<n;h++){var d=0;h%2?(d|=c(u,e)<<4,d|=c(l,t)<<3,d|=c(u,e)<<2,d|=c(l,t)<<1,d|=c(u,e)<<0):(d|=c(l,t)<<4,d|=c(u,e)<<3,d|=c(l,t)<<2,d|=c(u,e)<<1,d|=c(l,t)<<0),a+=o(d)}return a}function d(e){var t=Math.floor(5*e/2);return 180/Math.pow(2,t)}function f(e){var t=Math.ceil(5*e/2);return 360/Math.pow(2,t)}function p(e,t){return t?1&e|(4&e)>>1|(16&e)>>2:(2&e)>>1|(8&e)>>2}function _(e,t){return t?(2&e)>>1|(8&e)>>2:1&e|(4&e)>>1|(16&e)>>2}function g(e,t,r){var i=!((e.length-1)%2),a=e.substring(0,e.length-1),s=n(e.charCodeAt(e.length-1)),u=0,c=0,l=0,h=0;i?(u=8,c=4,l=1&s|(4&s)>>1|(16&s)>>2,h=(2&s)>>1|(8&s)>>2):(u=4,c=8,h=1&s|(4&s)>>1|(16&s)>>2,l=(2&s)>>1|(8&s)>>2);var d=l+t,f=h+r,p=Math.floor(d/u),_=Math.floor(f/c),y=o(function(e,t,r){return r?1&e|(1&t)<<1|(2&e)<<1|(2&t)<<2|(4&e)<<2:1&t|(1&e)<<1|(2&t)<<1|(2&e)<<2|(4&t)<<2}(d-p*u,f-_*c,i));return e.length>1&&(p||_)?g(a,p,_)+y:a+y}t.decodeBase32Char=n,t.encodeBase32Char=o,t.decodeGeohash=l,t.convertGeohash32ToXY=function(e,t){for(var r=0,i=0,o=30,a=30,s=0;s<t.length;s++){var u=n(t.charCodeAt(s)),c=s%2==0;r|=p(u,c)<<(o-=c?3:2),i|=_(u,c)<<(a-=c?2:3)}return{geohashX:r,geohashY:i}},t.decodeGeohashXY=function(e,t){for(var r=-90,i=90,n=-180,o=180,a=0;a<t;a++){for(var s=Math.ceil((a+1)/2),u=Math.floor((a+1)/2),c=1-a%2,l=30-(3*s+2*u),h=30-(2*s+3*u),d=2*c+3*(1-c),f=(7*c+3*(1-c)<<l&e.geohashX)>>l,p=(3*c+7*(1-c)<<h&e.geohashY)>>h,_=3*c+2*(1-c)-1;_>=0;_--){var g=(n+o)/2,y=f&1<<_?1:0;n=(1-y)*n+y*g,o=(1-y)*g+y*o}for(_=d-1;_>=0;_--){var v=(r+i)/2,m=p&1<<_?1:0;r=(1-m)*r+m*v,i=(1-m)*v+m*i}}return[n,r,o,i]},t.setGeohashXY=function(e,t,r,i){i%2&&(i+=1);for(var n=0,o=0,a=-90,s=90,u=-180,c=180,l=0;l<i/2;l++){for(var h=0;h<5;h++){var d=(u+c)/2,f=r>d?1:0;n|=f<<29-(h+5*l),u=(1-f)*u+f*d,c=(1-f)*d+f*c}for(h=0;h<5;h++){var p=(a+s)/2,_=t>p?1:0;o|=_<<29-(h+5*l),a=(1-_)*a+_*p,s=(1-_)*p+_*s}}e.geohashX=n,e.geohashY=o},t.setGeohashBuf=function(e,t,r,i,n){n%2&&(n+=1);for(var o=0,a=0,s=-90,u=90,c=-180,l=180,h=0;h<n/2;h++){for(var d=0;d<5;d++){var f=(c+l)/2,p=i>f?1:0;o|=p<<29-(d+5*h),c=(1-p)*c+p*f,l=(1-p)*f+p*l}for(d=0;d<5;d++){var _=(s+u)/2,g=r>_?1:0;a|=g<<29-(d+5*h),s=(1-g)*s+g*_,u=(1-g)*_+g*u}}e[2*t]=o,e[2*t+1]=a},t.encodeGeohash=h,t.latDistPerGeohash=d,t.lonDistPerGeohash=f,t.unpackXBits=p,t.unpackYBits=_,t.getRelativeGeohash=g,t.getIntersectingGeohashes=function(e,t,r,i,n){for(var o=Math.abs(r-e),a=Math.abs(i-t),s=d(n),u=f(n),c=Math.ceil(a/u),l=Math.ceil(o/s),p=h(e,t,n),_=new Array,y=0;y<c;y++)for(var v=0;v<l;v++)_.push(g(p,y,v));return _},t.forEachIntersectingGeohash=function(e,t,r,i,n,o){for(var a=Math.abs(r-e),s=Math.abs(i-t),u=d(n),c=f(n),p=Math.ceil(s/c),_=Math.ceil(a/u),y=h(e,t,n),v=0;v<p;v++)for(var m=0;m<_;m++){var b=g(y,v,m),T=l([0,0],b),I=T[0],E=T[1],S=E-c/2,w=I+u/2,F=E+c/2,R=u*c,x=Math.max(e,I-u/2),M=Math.max(t,S),O=Math.min(r,w)-x,A=Math.min(i,F)-M;o(b,Math.abs(O*A)/R)}}}).apply(null,i))||(e.exports=n)},Dos2:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.numTo32=t.i8816to32=t.i8888to32=t.i1616to32=t.u32to4Xu8=t.toFloat32=t.toUint32=t.u32=t.u16=t.u8=t.i32=t.i16=t.i8=void 0;var r=new Float32Array(1),i=new Uint32Array(r.buffer);function n(e,t,r){return Math.round(Math.max(Math.min(e,r),t))}t.i8=function(e){return n(e,-128,127)},t.i16=function(e){return n(e,-32768,32767)},t.i32=function(e){return n(e,-2147483648,2147483647)},t.u8=function(e){return n(e,0,255)},t.u16=function(e){return n(e,0,65535)},t.u32=function(e){return n(e,0,4294967295)},t.toUint32=function(e){return r[0]=e,i[0]},t.toFloat32=function(e){return i[0]=e,r[0]},t.u32to4Xu8=function(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]},t.i1616to32=function(e,t){return 65535&e|t<<16},t.i8888to32=function(e,t,r,i){return 255&e|(255&t)<<8|(255&r)<<16|i<<24},t.i8816to32=function(e,t,r){return 255&e|(255&t)<<8|r<<16},t.numTo32=function(e){return 0|e}}).apply(null,i))||(e.exports=n)},FXVB:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("Jl7l")],void 0===(n=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat4=void 0,t.mat4=r}).apply(null,i))||(e.exports=n)},GI9R:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("zp6E"),r("KY0m"),r("ma1f"),r("qsST"),r("nrlZ"),r("+6sX"),r("xJgq"),r("Q2Em"),r("Q2Em"),r("9K5t"),r("DaHD"),r("I90O"),r("Q3lp"),r("w1v0")],void 0===(n=(function(e,t,r,i,n,o,a,s,u,c,l,h,d,f,p,_,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryOptimizedFeatureSet=t.queryFeatureSetJSON=t.queryFeatureSet=t.getServerLandingPage=t.getServerConformance=t.getServerCollections=t.getServerCollection=t.getCollectionDefinition=void 0;var y=a.getLogger("esri.layers.graphics.sources.ogcfeature");function v(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,m(e,t,i)];case 1:return n=r.sent(),[2,u.convertToFeatureSet(n)]}}))}))}function m(e,t,n){var o;return r.__awaiter(this,void 0,void 0,(function(){var a,f,p,_,g,y,v,m,b,T,I,E,S,w,F,R,x,M,O,A,L,C,P,N,D,G,q,k,B,j;return r.__generator(this,(function(U){switch(U.label){case 0:return a=e.capabilities.query.maxRecordCount,f=e.layerDefinition,p=e.url+"/collections/"+e.collectionId+"/items",_=t.num,g=t.outSpatialReference,y=t.start,v=t.timeExtent,m=t.where,b=h.project(t.geometry,s.WGS84),T=function(e){return e?e.xmin+","+e.ymin+","+e.xmax+","+e.ymax:null}(b),I=function(e){if(!e)return null;var t=e.start,r=e.end;return(t?t.toISOString():"..")+"/"+(r?r.toISOString():"..")}(v),E=function(e){return e&&"1=1"!==e?e:null}(m),S=null!=y?y:0,w=null!=_?_:null!=y&&void 0!==y?10:a,[4,i(p,r.__assign(r.__assign({},n),{query:{bbox:T,datetime:I,query:E,limit:w,startindex:S,f:"application/geo+json"}}))];case 1:if(F=U.sent().data,R=null===(o=F.links)||void 0===o?void 0:o.filter((function(e){return"next"===e.rel})),x=0!==(null==R?void 0:R.length),M=f.fields,O=f.globalIdField,A=f.hasM,N=d.createOptimizedFeatures(F,{geometryType:P=f.geometryType,hasZ:L=f.hasZ,objectIdFieldName:C=f.objectIdField}),!s.equals(g,s.WGS84))for(D=0,G=N;D<G.length;D++)(B=G[D]).geometry&&(B.geometry=u.convertFromGeometry(l.project(u.convertToGeometry(B.geometry,P,L,!1),s.WGS84,g)));for(q=0,k=N;q<k.length;q++)(B=k[q]).objectId=B.attributes[C];return(j=new c.default).exceededTransferLimit=x,j.features=N,j.fields=M,j.geometryType=P,j.globalIdFieldName=O,j.hasM=A,j.hasZ=L,j.objectIdFieldName=C,j.spatialReference=g||s.WGS84,[2,j]}}))}))}t.getCollectionDefinition=function(e,t,a,u,c){return void 0===c&&(c=5),r.__awaiter(this,void 0,void 0,(function(){var h,g,v,m,b,T,I,E,S,w,F,R,x,M,O;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,l.checkProjectionSupport(s.WGS84,a.spatialReference)];case 1:return r.sent(),[3,3];case 2:throw r.sent(),new o("ogc-feature-layer:projection-not-supported","Projection not supported");case 3:return[4,i(e+"/collections/"+t+"/items",{signal:u,query:{limit:c,f:"application/geo+json"}})];case 4:return h=r.sent().data,[4,d.validateGeoJSON(h)];case 5:if(r.sent(),g=d.inferLayerProperties(h,{geometryType:a.geometryType}),m=null!=a.hasZ?a.hasZ:g.hasZ,b=g.geometryType,T=a.objectIdField||g.objectIdFieldName||"OBJECTID",I=a.timeInfo,E=n.find(v=a.fields||g.fields||[],(function(e){return e.name===T})))E.type="esriFieldTypeOID",E.editable=!1,E.nullable=!1;else{if(!g.objectIdFieldType)throw new o("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");v.unshift({name:T,alias:T,type:"esriFieldTypeOID",editable:!1,nullable:!1})}if(T!==g.objectIdFieldName&&(F=n.find(v,(function(e){return e.name===g.objectIdFieldName})))&&(F.type="esriFieldTypeInteger"),!b)throw new o("ogc-feature-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");for(v===g.fields&&g.unknownFields.length>0&&y.warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:g.unknownFields}}),S=0,w=v;S<w.length;S++){if(null==(F=w[S]).name&&(F.name=F.alias),null==F.alias&&(F.alias=F.name),"esriFieldTypeOID"!==F.type&&"esriFieldTypeGlobalID"!==F.type&&(F.editable=null==F.editable||!!F.editable,F.nullable=null==F.nullable||!!F.nullable),!F.name)throw new o("ogc-feature-layer:invalid-field-name","field name is missing",{field:F});if(-1===_.kebabDict.jsonValues.indexOf(F.type))throw new o("ogc-feature-layer:invalid-field-type",'invalid type for field "'+F.name+'"',{field:F})}return I&&(R=new p(v),I.startTimeField&&((x=R.get(I.startTimeField))?(I.startTimeField=x.name,x.type="esriFieldTypeDate"):I.startTimeField=null),I.endTimeField&&((M=R.get(I.endTimeField))?(I.endTimeField=M.name,M.type="esriFieldTypeDate"):I.endTimeField=null),I.trackIdField&&((O=R.get(I.trackIdField))?I.trackIdField=O.name:(I.trackIdField=null,y.warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:I}}))),I.startTimeField||I.endTimeField||(y.warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:I}}),I=null)),[2,{drawingInfo:f.createDrawingInfo(b),geometryType:b,fields:v,hasZ:!!m,objectIdField:T,timeInfo:I}]}}))}))},t.getServerCollection=function(e,t,n,o){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+"/collections/"+t,{signal:o,query:{f:n}})];case 1:return[2,r.sent().data]}}))}))},t.getServerCollections=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+"/collections",{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.getServerConformance=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+"/conformance",{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.getServerLandingPage=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e,{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.queryFeatureSet=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,v(e,t,i)];case 1:return n=r.sent(),[2,g.fromJSON(n)]}}))}))},t.queryFeatureSetJSON=v,t.queryOptimizedFeatureSet=m}).apply(null,i))||(e.exports=n)},IFRM:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("9gfz"),r("H1tY"),r("LxLY"),r("qMld"),r("CYRa"),r("IpeC"),r("tI6k"),r("T+hO"),r("iqqO")],void 0===(n=(function(e,t,r,i,n,o,a,s,u,c,l,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Source2D=void 0;var d=0,f=function(){function e(e,t){this.didSend=!1,this.dataTileCount=0,this.update=h.UpdateToken.all(),this._abortController=new AbortController,this.invalid=!1,this.displayTile=e,this._pixelBuffer=t,this.partitions=_(e,t)}return e.prototype.setUpdate=function(e,t){this.update=e,this.dataTileCount=0,t!==this._pixelBuffer&&(this._pixelBuffer=t,this.partitions=_(this.displayTile,t)),e.mesh&&(this.didSend=!1)},Object.defineProperty(e.prototype,"signal",{get:function(){return this._abortController.signal},enumerable:!1,configurable:!0}),e.prototype.abort=function(){this._abortController.abort()},e}(),p=function(){function e(e,t,r){this.resolved=!1,this.tile=t,this.offset=e,this.extent=r}return e.prototype.reset=function(){this.resolved=!1},e}();function _(e,t){var r=[];if(r.push(new p([0,0],e,null)),0===t)return r;var i=Math.min(t,c.TILE_SIZE),o=c.TILE_SIZE;return n("esri-2d-debug")&&i!==t&&console.debug("Clamping pixelBuffer to max size of "+c.TILE_SIZE+"px"),r.push(new p([-o,-o],e.neighbor(-1,-1),[o-i,o-i,o,o])),r.push(new p([0,-o],e.neighbor(0,-1),[0,o-i,o,o])),r.push(new p([o,-o],e.neighbor(1,-1),[0,o-i,i,o])),r.push(new p([-o,0],e.neighbor(-1,0),[o-i,0,o,o])),r.push(new p([o,0],e.neighbor(1,0),[0,0,i,o])),r.push(new p([-o,o],e.neighbor(-1,1),[o-i,0,o,i])),r.push(new p([0,o],e.neighbor(0,1),[0,0,o,i])),r.push(new p([o,o],e.neighbor(1,1),[0,0,i,i])),r}var g=function(){function e(e,t,r){var i=this;this.type="remote",this._pendingEdits=new Set,this._queryInfo=null,this._subscriptions={display:new Map},this._invalid={outFields:!1,queryFilterParameters:!1};var n=this._onDataTileRequest.bind(this);this._source=l.createSource(e,t,r,n,(function(){return i.canAcceptPatch()})),this._serviceInfo=e,this._geometryType=e.geometryType,this._outSR=t}return e.prototype.destroy=function(){var e=this;this._getSubscriptions().map((function(t){return e.unsubscribe(t.displayTile)})),this._source.destroy()},Object.defineProperty(e.prototype,"updating",{get:function(){return this._source.updating||this._getSubscriptions().some((function(e){return!e.didSend}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isStream",{get:function(){return"geoevent"===this._source.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sourceEvents",{get:function(){return"geoevent"===this._source.type?{type:"geoevent",events:this._source.events}:{type:"feature",events:this._source.events}},enumerable:!1,configurable:!0}),e.prototype.enableEvent=function(e,t){this._source.enableEvent(e,t)},e.prototype.setViewState=function(e){this._source.setViewState(e)},e.prototype.update=function(e,t){var o,a,u,c,l=this._serviceInfo.fields.length,h=null!==(a=null===(o=this._schema)||void 0===o?void 0:o.outFields)&&void 0!==a?a:[],d=null!==(c=null===(u=this._schema)||void 0===u?void 0:u.pixelBuffer)&&void 0!==c?c:0,f=t.outFields.filter((function(e){return-1===h.indexOf(e)})),p=r.__spreadArrays(h,f),_=0===t.pixelBuffer?0:Math.max(t.pixelBuffer,d);t.pixelBuffer=_,t.outFields=p.length>=.75*l?["*"]:p,t.outFields.sort();var g=s.diff(this._schema,t);if(this._subscriptions.display.forEach((function(t){t.invalid&&(e.queryFilter=!0)})),g){var y=this._schema&&s.hasDiff(g,"outFields"),v=this._schema&&s.hasDiff(g,"pixelBuffer"),m=this._schema&&s.hasDiffAny(g,["definitionExpression","gdbVersion","historicMoment"]);n("esri-2d-update-debug")&&console.debug("Applying Update - Source:",g);var b={returnCentroid:"esriGeometryPolygon"===this._geometryType,returnGeometry:!0,outFields:t.outFields,outSpatialReference:this._outSR,orderByFields:[this._serviceInfo.objectIdField+" ASC"],where:t.definitionExpression||"1=1",gdbVersion:t.gdbVersion,historicMoment:t.historicMoment?new Date(t.historicMoment):null,timeExtent:i.fromJSON(t.timeExtent)};e.source=!0,v&&(e.why.mesh.push("Pixel buffer changed"),e.mesh=!0),m&&(e.why.mesh.push("Layer filter changed"),e.why.source.push("Layer filter changed"),e.mesh=!0,e.queryFilter=!0,this._invalid.queryFilterParameters=!0),y&&(e.why.source.push("Layer required fields changed"),this._invalid.outFields=!0),this._schema=t,this._source.update(b),this._queryInfo=b}},e.prototype.subscribe=function(e){this._subscriptions.display.has(e.id)?n("esri-2d-debug")&&console.debug("A subscription already exists for the target displayTile"):this._subscribeDisplayTile(e)},e.prototype.unsubscribe=function(e){if(this._subscriptions.display.has(e.id)){var t=this._subscriptions.display.get(e.id);this._subscriptions.display.delete(e.id),this._source.unsubscribe(e),t.abort()}else n("esri-2d-debug")&&console.debug("A subscription does not exist for the target displayTile")},e.prototype.forEachRequest=function(e,t){this._source.forEachRequest(e,t)},e.prototype.query=function(e){return this._source.query(e)},e.prototype.createQuery=function(){return new u(r.__assign({},this._queryInfo))},e.prototype.createTileQuery=function(e){if("stream"===this._serviceInfo.type)throw new Error("Service does not support tile  queries");var t=this.createQuery();return t.quantizationParameters=e.getQuantizationParameters(),t.resultType="tile",t.geometry=e.extent,"esriGeometryPolyline"===this._serviceInfo.geometryType&&(t.maxAllowableOffset=e.resolution),this._serviceInfo.capabilities.query.supportsQuantization||(t.quantizationParameters=null,t.maxAllowableOffset=e.resolution),t},e.prototype.invalidate=function(){this._subscriptions.display.forEach((function(e){return e.invalid=!0}))},e.prototype.forEachPendingEdit=function(e){this._getSubscriptions().some((function(e){return e.invalid}))?this._pendingEdits.forEach(e):this._pendingEdits.clear()},e.prototype.onEdits=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n,o,s,u,c,l=this;return r.__generator(this,(function(f){switch(f.label){case 0:return t=e.addedFeatures.filter((function(e){return!e.error})).map((function(e){return e.objectId})),i=e.updatedFeatures.filter((function(e){return!e.error})).map((function(e){return e.objectId})),n=e.deletedFeatures.filter((function(e){return!e.error})).map((function(e){return e.objectId})),o=r.__spreadArrays(t,i),n.forEach((function(e){l._pendingEdits.has(e)&&l._pendingEdits.delete(e)})),o.forEach((function(e){return l._pendingEdits.add(e)})),s=this._getSubscriptions().map((function(e){return e.displayTile})),u=s.map((function(e){var t=l.createTileQuery(e);return t.objectIds=o,{tile:e,query:t}})),c=u.map((function(e){var t=e.tile,i=e.query;return r.__awaiter(l,void 0,void 0,(function(){var e;return r.__generator(this,(function(r){switch(r.label){case 0:return e={tile:t},[4,this._source.query(i)];case 1:return[2,(e.result=r.sent(),e)]}}))}))})),[4,a.all(c)];case 1:return f.sent().forEach((function(e){var t=e.tile,o=e.result,a=l._subscriptions.display.get(t.key.id);if(a){var s=a.signal,u=h.UpdateToken.all();l.onDisplayTilePatch({type:"update",id:t.key.id,version:d++,update:u,addOrUpdate:o,remove:r.__spreadArrays(i,n),end:!0,noData:!1},{signal:s})}})),this.invalidate(),[2]}}))}))},e.prototype.resubscribe=function(e,t){return void 0===t&&(t=!1),r.__awaiter(this,void 0,void 0,(function(){var i,n,o,a=this;return r.__generator(this,(function(r){switch(r.label){case 0:return i=this._schema.pixelBuffer,this._subscriptions.display.forEach((function(t){return t.setUpdate(e,i)})),n=!1,this._subscriptions.display.forEach((function(e){e.invalid&&(n=!0)})),this._invalid.outFields&&(this._invalid.outFields=!1),t||this._invalid.queryFilterParameters||n?((o=this._getSubscriptions().map((function(e){return e.displayTile}))).forEach((function(e){return a.unsubscribe(e)})),o.forEach((function(e){return a.subscribe(e)})),this._source.resume(),this._invalid.queryFilterParameters=!1,[3,5]):[3,1];case 1:return e.mesh?[4,this._source.resend({dataTileOnly:!1})]:[3,3];case 2:return r.sent(),[3,5];case 3:return[4,this._source.resend({dataTileOnly:!0})];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))},e.prototype.pause=function(){this._source.pause()},e.prototype.resume=function(){this._source.resume()},e.prototype._getSubscriptions=function(){var e=[];return this._subscriptions.display.forEach((function(t){e.push(t)})),e},e.prototype._subscribeDisplayTile=function(e){var t=new f(e,this._schema.pixelBuffer);this._subscriptions.display.set(e.id,t),this._source.subscribe(e);for(var r=0,i=t.partitions;r<i.length;r++){var n=i[r],a=this._source.get(n.tile.id);if(o.isSome(a))for(var s=0,u=a.requests.done;s<u.length;s++)this._onPartitionMessage(e.id,n,u[s].request,"new")}},e.prototype._onDataTileRequest=function(e,t,r){var i=this,n=this._subscriptions.display.get(e.id);if(r&&r.dataTileOnly){for(var o=0,a=n.partitions;o<a.length;o++)if((c=a[o]).tile.id===e.id){this._onPartitionMessage(e.id,c,e,t);break}}else{for(var s=0,u=n.partitions;s<u.length;s++){var c;if((c=u[s]).tile.id===e.id){this._onPartitionMessage(e.id,c,e,t);break}}this._subscriptions.display.forEach((function(r,n){if(n!==e.id)for(var o=0,a=r.partitions;o<a.length;o++){var s=a[o];if(s.tile.id===e.id){i._onPartitionMessage(n,s,e,t);break}}}))}},e.prototype._onPartitionMessage=function(e,t,r,i){var n=o.andThen(r.features,(function(e){return function(e,t){if(o.isNone(t.extent))return e;var r=t.offset,i=t.extent,n=r[0],a=r[1];return e.extent(i[0],i[1],i[2],i[3]).transform(n,a)}(e,t)})),a=this._subscriptions.display.get(e),s=a.signal;a.didSend||(i="replace");var u=!1;r.end&&(t.resolved=!0,u=e===t.tile.id),a.didSend=!0,this.onDisplayTilePatch({type:i,id:e,version:d++,update:a.update,addOrUpdate:n,remove:r.remove||[],noData:r.noData,end:u},{signal:s})},e}();t.Source2D=g}).apply(null,i))||(e.exports=n)},JNkf:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MosaicType=t.WGLVVTarget=t.WGLVVFlag=t.VVType=t.WGLDrawPhase=t.WGLGeometryTransactionStatus=t.WGLGeometryType=void 0,function(e){e[e.FILL=0]="FILL",e[e.LINE=1]="LINE",e[e.MARKER=2]="MARKER",e[e.TEXT=3]="TEXT",e[e.LABEL=4]="LABEL"}(t.WGLGeometryType||(t.WGLGeometryType={})),function(e){e[e.SUCCEEDED=0]="SUCCEEDED",e[e.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"}(t.WGLGeometryTransactionStatus||(t.WGLGeometryTransactionStatus={})),function(e){e[e.NONE=0]="NONE",e[e.MAP=1]="MAP",e[e.LABEL=2]="LABEL",e[e.LABEL_ALPHA=4]="LABEL_ALPHA",e[e.HITTEST=8]="HITTEST",e[e.HIGHLIGHT=16]="HIGHLIGHT",e[e.CLIP=32]="CLIP",e[e.DEBUG=64]="DEBUG",e[e.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(t.WGLDrawPhase||(t.WGLDrawPhase={})),function(e){e[e.SIZE=0]="SIZE",e[e.COLOR=1]="COLOR",e[e.OPACITY=2]="OPACITY",e[e.ROTATION=3]="ROTATION"}(t.VVType||(t.VVType={})),function(e){e[e.NONE=0]="NONE",e[e.OPACITY=1]="OPACITY",e[e.COLOR=2]="COLOR",e[e.ROTATION=4]="ROTATION",e[e.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",e[e.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",e[e.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",e[e.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"}(t.WGLVVFlag||(t.WGLVVFlag={})),function(e){e[e.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",e[e.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",e[e.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",e[e.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(t.WGLVVTarget||(t.WGLVVTarget={})),function(e){e[e.SPRITE=0]="SPRITE",e[e.GLYPH=1]="GLYPH"}(t.MosaicType||(t.MosaicType={}))}).apply(null,i))||(e.exports=n)},JOu6:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zIqJ"),r("LxLY"),r("8pdz")],void 0===(n=(function(e,t,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeohashTree=void 0;var o=function(){function e(e,t,i){void 0===i&&(i=8096),this._nodes=0,this._root=new a(0,0,0),this._fields=e,this._statisticFields=t,this._pool=i?new r.default(8096):null}return e.prototype._acquire=function(e,t,r){this._nodes++;var n=null;return i.isSome(this._pool)&&(n=this._pool.dequeue()),i.isSome(n)?n.realloc(e,t,r):new a(e,t,r)},e.prototype._release=function(e){this._nodes--,i.isSome(this._pool)&&this._pool.enqueue(e)},Object.defineProperty(e.prototype,"count",{get:function(){return this._root.count},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._nodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"poolSize",{get:function(){return i.mapOr(this._pool,0,(function(e){return e.size}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){var e=0;return this._forEachNode((function(t){return e=Math.max(e,t.depth)})),e},enumerable:!1,configurable:!0}),e.prototype.dropLevels=function(e){var t=this;this._forEachNode((function(r){if(r.depth>=e)for(var i=0;i<r.children.length;i++){var n=r.children[i];r.children[i]=null,n&&t._release(n)}}))},e.prototype.clear=function(){this.dropLevels(0)},e.prototype.insert=function(e,t,r){void 0===r&&(r=0);for(var i=this._root,n=0,o=0,a=0;null!==i;){if(i.depth>=r&&(i.count+=1,i.xTotal+=e.geometry.coords[0],i.yTotal+=e.geometry.coords[1],i.xGeohashTotal+=e.geohashX,i.yGeohashTotal+=e.geohashY,i.displayId=e.displayId,this._updateStatistics(e,i,1)),n>=t)return;var s=Math.ceil((n+1)/2),u=Math.floor((n+1)/2),c=1-n%2,l=30-(3*s+2*u),h=30-(2*s+3*u),d=(e.geohashX&7*c+3*(1-c)<<l)>>l,f=(e.geohashY&3*c+7*(1-c)<<h)>>h,p=d+f*(8*c+4*(1-c));o=o<<3*c+2*(1-c)|d,a=a<<2*c+3*(1-c)|f,null==i.children[p]&&(i.children[p]=this._acquire(o,a,n+1)),n+=1,i=i.children[p]}},e.prototype.insertCursor=function(e,t,r,i,n,o,a,s){void 0===s&&(s=0);for(var u=this._root,c=0,l=0,h=0;null!==u;){if(u.depth>=s&&(u.count+=1,u.xTotal+=r,u.yTotal+=i,u.xGeohashTotal+=n,u.yGeohashTotal+=o,u.displayId=t,this._updateStatisticsCursor(e,u,1)),c>=a)return;var d=Math.ceil((c+1)/2),f=Math.floor((c+1)/2),p=1-c%2,_=30-(3*d+2*f),g=30-(2*d+3*f),y=(n&7*p+3*(1-p)<<_)>>_,v=(o&3*p+7*(1-p)<<g)>>g,m=y+v*(8*p+4*(1-p));l=l<<3*p+2*(1-p)|y,h=h<<2*p+3*(1-p)|v,null==u.children[m]&&(u.children[m]=this._acquire(l,h,c+1)),c+=1,u=u.children[m]}},e.prototype.remove=function(e,t){for(var r=this._root,i=0;null!==r;){if(r.count-=1,r.xTotal-=e.geometry.coords[0],r.yTotal-=e.geometry.coords[1],r.xGeohashTotal-=e.geohashX,r.yGeohashTotal-=e.geohashY,this._updateStatistics(e,r,-1),i>=t)return;var n=Math.ceil((i+1)/2),o=Math.floor((i+1)/2),a=1-i%2,s=30-(3*n+2*o),u=30-(2*n+3*o),c=((e.geohashX&7*a+3*(1-a)<<s)>>s)+((e.geohashY&3*a+7*(1-a)<<u)>>u)*(8*a+4*(1-a)),l=r.children[c];1===l.count&&(this._release(l),r.children[c]=null),i+=1,r=l}},e.prototype.removeCursor=function(e,t,r,i,n,o){for(var a=this._root,s=0;null!==a;){if(a.count-=1,a.xTotal-=t,a.yTotal-=r,a.xGeohashTotal-=i,a.yGeohashTotal-=n,this._updateStatisticsCursor(e,a,-1),s>=o)return;var u=Math.ceil((s+1)/2),c=Math.floor((s+1)/2),l=1-s%2,h=30-(3*u+2*c),d=30-(2*u+3*c),f=((i&7*l+3*(1-l)<<h)>>h)+((n&3*l+7*(1-l)<<d)>>d)*(8*l+4*(1-l)),p=a.children[f];1===p.count&&(this._release(p),a.children[f]=null),s+=1,a=p}},e.prototype.find=function(e,t,r){return this._root.find(e,t,r,0,0,0)},e.prototype.findSingleOccupancyNode=function(e,t,r,i,n){for(var o=this._root;null!==o;){var a=o.depth,s=o.xNode,u=o.yNode,c=1-a%2,l=o.xGeohashTotal/o.count,h=o.yGeohashTotal/o.count;if(1===o.count&&e<l&&l<=r&&t<h&&h<=i)return o;if(a>=n)o=o.next;else{for(var d=Math.ceil((a+1)/2),f=Math.floor((a+1)/2),p=30-(3*d+2*f),_=30-(2*d+3*f),g=~((1<<p)-1),y=~((1<<_)-1),v=(t&y)>>_,m=(r&g)>>p,b=(i&y)>>_,T=s<<3*c+2*(1-c),I=u<<2*c+3*(1-c),E=T+8*c+4*(1-c),S=I+4*c+8*(1-c),w=Math.max(T,(e&g)>>p),F=Math.max(I,v),R=Math.min(E,m),x=Math.min(S,b),M=null,O=null,A=F;A<=x;A++)for(var L=w;L<=R;L++){var C=o.children[L-T+(A-I)*(8*c+4*(1-c))];C&&(M||((M=C).next=o.next),O&&(O.next=C),O=C,C.next=o.next)}o=M||o.next}}return null},e.prototype.getRegionStatistics=function(e,t,r,i,n){for(var o=this._root,a=0,s=0,u=0,c={},l=0;null!==o;){var h=o.depth,d=o.xNode,f=o.yNode;if(h>=n){var p=o.xGeohashTotal/o.count,_=o.yGeohashTotal/o.count;e<p&&p<=r&&t<_&&_<=i&&(a+=o.count,s+=o.xTotal,u+=o.yTotal,1===o.count&&(l=o.displayId),this._aggregateStatistics(c,o.statistics)),o=o.next}else{for(var g=Math.ceil((h+1)/2),y=Math.floor((h+1)/2),v=1-h%2,m=30-(3*g+2*y),b=30-(2*g+3*y),T=~((1<<m)-1),I=~((1<<b)-1),E=(t&I)>>b,S=(r&T)>>m,w=(i&I)>>b,F=d<<3*v+2*(1-v),R=f<<2*v+3*(1-v),x=F+8*v+4*(1-v),M=R+4*v+8*(1-v),O=Math.max(F,(e&T)>>m),A=Math.max(R,E),L=Math.min(x,S),C=Math.min(M,w),P=null,N=null,D=A;D<=C;D++)for(var G=O;G<=L;G++){var q=o.children[G-F+(D-R)*(8*v+4*(1-v))];if(q){if(D!==A&&D!==C&&G!==O&&G!==L){_=q.yGeohashTotal/q.count,e<(p=q.xGeohashTotal/q.count)&&p<=r&&t<_&&_<=i&&(a+=q.count,s+=q.xTotal,u+=q.yTotal,1===q.count&&(l=q.displayId),this._aggregateStatistics(c,q.statistics));continue}P||((P=q).next=o.next),N&&(N.next=q),N=q,q.next=o.next}}o=P||o.next}}return{count:a,attributes:this._normalizeStatistics(c,a),xTotal:s,yTotal:u,referenceId:l}},e.prototype._forEachNode=function(e){for(var t=this._root;null!==t;){var r=this._linkChildren(t)||t.next;e(t),t=r}},e.prototype._linkChildren=function(e){for(var t=null,r=null,i=0;i<=e.children.length;i++){var n=e.children[i];n&&(t||((t=n).next=e.next),r&&(r.next=n),r=n,n.next=e.next)}return t},e.prototype._updateStatistics=function(e,t,r){for(var i=0,n=this._fields;i<n.length;i++){var o=n[i],a=o.name,s=e.attributes[o.outStatistic.onStatisticField];switch(o.outStatistic.statisticType){case"norm":t.statistics[a]||(t.statistics[a]={});var u=e.attributes[o.outStatistic.onStatisticNormalizationField],c=t.statistics[a].onStatisticField||0,l=t.statistics[a].onStatisticNormalizationField||0;null==s||isNaN(s)||null==u||0===u||isNaN(u)||(t.statistics[a].onStatisticField=c+r*s,t.statistics[a].onStatisticNormalizationField=l+r*u);break;case"sum":case"avg":t.statistics[a]||(t.statistics[a]={value:0,nanCount:0});var h=t.statistics[a].value,d=t.statistics[a].nanCount;null==s||isNaN(s)?t.statistics[a].nanCount=d+r:t.statistics[a].value=h+r*s;break;case"avg_angle":t.statistics[a]||(t.statistics[a]={x:0,y:0,nanCount:0});var f=t.statistics[a].x,p=t.statistics[a].y,_=(d=t.statistics[a].nanCount,Math.PI/180);null==s||isNaN(s)?t.statistics[a].nanCount=d+r:(t.statistics[a].x=f+r*Math.cos(s*_),t.statistics[a].y=p+r*Math.sin(s*_));break;case"mode":t.statistics[a]||(t.statistics[a]={}),t.statistics[a][s]=(h=t.statistics[a][s]||0)+r}}},e.prototype._updateStatisticsCursor=function(e,t,r){for(var i=0,n=this._statisticFields;i<n.length;i++){var o=n[i],a=o.name,s=o.inField?e.readAttribute(o.inField):e.getComputedNumericAtIndex(o.inFieldIndex);switch(o.statisticType){case"norm":t.statistics[a]||(t.statistics[a]={});var u=e.readAttribute(o.inNormalizationField),c=t.statistics[a].onStatisticField||0,l=t.statistics[a].onStatisticNormalizationField||0;null==s||isNaN(s)||null==u||0===u||isNaN(u)||(t.statistics[a].onStatisticField=c+r*s,t.statistics[a].onStatisticNormalizationField=l+r*u);break;case"sum":case"avg":t.statistics[a]||(t.statistics[a]={value:0,nanCount:0});var h=t.statistics[a].value,d=t.statistics[a].nanCount;null==s||isNaN(s)?t.statistics[a].nanCount=d+r:t.statistics[a].value=h+r*s;break;case"avg_angle":t.statistics[a]||(t.statistics[a]={x:0,y:0,nanCount:0});var f=t.statistics[a].x,p=t.statistics[a].y,_=(d=t.statistics[a].nanCount,Math.PI/180);null==s||isNaN(s)?t.statistics[a].nanCount=d+r:(t.statistics[a].x=f+r*Math.cos(s*_),t.statistics[a].y=p+r*Math.sin(s*_));break;case"mode":t.statistics[a]||(t.statistics[a]={}),t.statistics[a][s]=(h=t.statistics[a][s]||0)+r}}},e.prototype._aggregateStatistics=function(e,t){for(var r=0,i=this._fields;r<i.length;r++){var n=i[r],o=n.name;switch(n.outStatistic.statisticType){case"sum":case"avg":case"avg_angle":case"mode":case"norm":for(var a in e[o]||(e[o]={}),t[o])e[o][a]=(e[o][a]||0)+t[o][a]}}},e.prototype._normalizeStatistics=function(e,t){for(var r={},i=0,n=this._fields;i<n.length;i++){var o=n[i],a=o.name;switch(o.outStatistic.statisticType){case"norm":var s=e[a];if(t&&null==s.onStatisticNormalizationField)break;if(t&&s.onStatisticNormalizationField){r[a]=s.onStatisticField/s.onStatisticNormalizationField;break}r[a]=0;break;case"sum":if(!t)break;var u=e[a],c=u.value;if(!(t-(h=u.nanCount)))break;r[a]=c;break;case"avg":if(!t)break;var l=e[a];if(c=l.value,!(t-(h=l.nanCount)))break;r[a]=c/(t-h);break;case"avg_angle":if(!t)break;var h,d=e[a],f=d.x,p=d.y;if(!(t-(h=d.nanCount)))break;var _=180/Math.PI,g=Math.atan2(p/(t-h),f/(t-h))*_;r[a]=g;break;case"mode":var y=e[a],v=0,m=null;for(var b in y){var T=y[b];T>v&&(v=T,m=b)}r[a]="null"===m?null:m}}return r},e}();t.GeohashTree=o;var a=function(){function e(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.displayId=0,this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var i=0;i<this.children.length;i++)this.children[i]=null;this.xNode=e,this.yNode=t,this.depth=r}return e.prototype.realloc=function(e,t,r){for(var i=0;i<this.children.length;i++)this.children[i]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this},e.prototype.getLngLatBounds=function(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2);return n.decodeGeohashXY({geohashX:this.xNode<<30-(3*t+2*r),geohashY:this.yNode<<30-(2*t+3*r)},this.depth)},e.prototype.find=function(e,t,r,i,n,o){if(i>=r)return this;var a=1-i%2,s=3*a+2*(1-a),u=2*a+3*(1-a),c=30-n-s,l=30-o-u,h=this.children[((e&7*a+3*(1-a)<<c)>>c)+((t&3*a+7*(1-a)<<l)>>l)*(8*a+4*(1-a))];return null==h?null:h.find(e,t,r,i+1,n+s,o+u)},e}()}).apply(null,i))||(e.exports=n)},Jl7l:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("jaBu"),r("qysZ")],void 0===(n=(function(e,t,r,i){"use strict";function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function o(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=t[8],d=t[9],f=t[10],p=t[11],_=t[12],g=t[13],y=t[14],v=t[15],m=r[0],b=r[1],T=r[2],I=r[3];return e[0]=m*i+b*s+T*h+I*_,e[1]=m*n+b*u+T*d+I*g,e[2]=m*o+b*c+T*f+I*y,e[3]=m*a+b*l+T*p+I*v,e[4]=(m=r[4])*i+(b=r[5])*s+(T=r[6])*h+(I=r[7])*_,e[5]=m*n+b*u+T*d+I*g,e[6]=m*o+b*c+T*f+I*y,e[7]=m*a+b*l+T*p+I*v,e[8]=(m=r[8])*i+(b=r[9])*s+(T=r[10])*h+(I=r[11])*_,e[9]=m*n+b*u+T*d+I*g,e[10]=m*o+b*c+T*f+I*y,e[11]=m*a+b*l+T*p+I*v,e[12]=(m=r[12])*i+(b=r[13])*s+(T=r[14])*h+(I=r[15])*_,e[13]=m*n+b*u+T*d+I*g,e[14]=m*o+b*c+T*f+I*y,e[15]=m*a+b*l+T*p+I*v,e}function a(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=i+i,u=n+n,c=o+o,l=i*s,h=i*u,d=i*c,f=n*u,p=n*c,_=o*c,g=a*s,y=a*u,v=a*c;return e[0]=1-(f+_),e[1]=h+v,e[2]=d-y,e[3]=0,e[4]=h-v,e[5]=1-(l+_),e[6]=p+g,e[7]=0,e[8]=d+y,e[9]=p-g,e[10]=1-(l+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=t.equals=t.exactEquals=t.multiplyScalarAndAdd=t.multiplyScalar=t.subtract=t.add=t.frob=t.str=t.targetTo=t.lookAt=t.ortho=t.perspectiveFromFieldOfView=t.perspective=t.frustum=t.fromQuat=t.fromRotationTranslationScaleOrigin=t.fromRotationTranslationScale=t.getRotation=t.getScaling=t.getTranslation=t.fromQuat2=t.fromRotationTranslation=t.fromZRotation=t.fromYRotation=t.fromXRotation=t.fromRotation=t.fromScaling=t.fromTranslation=t.rotateZ=t.rotateY=t.rotateX=t.rotate=t.scale=t.translate=t.multiply=t.determinant=t.adjoint=t.invert=t.transpose=t.identity=t.set=t.copy=void 0,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.set=function(e,t,r,i,n,o,a,s,u,c,l,h,d,f,p,_,g){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=h,e[11]=d,e[12]=f,e[13]=p,e[14]=_,e[15]=g,e},t.identity=n,t.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=n,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],h=t[9],d=t[10],f=t[11],p=t[12],_=t[13],g=t[14],y=t[15],v=r*s-i*a,m=r*u-n*a,b=r*c-o*a,T=i*u-n*s,I=i*c-o*s,E=n*c-o*u,S=l*_-h*p,w=l*g-d*p,F=l*y-f*p,R=h*g-d*_,x=h*y-f*_,M=d*y-f*g,O=v*M-m*x+b*R+T*F-I*w+E*S;return O?(e[0]=(s*M-u*x+c*R)*(O=1/O),e[1]=(n*x-i*M-o*R)*O,e[2]=(_*E-g*I+y*T)*O,e[3]=(d*I-h*E-f*T)*O,e[4]=(u*F-a*M-c*w)*O,e[5]=(r*M-n*F+o*w)*O,e[6]=(g*b-p*E-y*m)*O,e[7]=(l*E-d*b+f*m)*O,e[8]=(a*x-s*F+c*S)*O,e[9]=(i*F-r*x-o*S)*O,e[10]=(p*I-_*b+y*v)*O,e[11]=(h*b-l*I-f*v)*O,e[12]=(s*w-a*R-u*S)*O,e[13]=(r*R-i*w+n*S)*O,e[14]=(_*m-p*T-g*v)*O,e[15]=(l*T-h*m+d*v)*O,e):null},t.adjoint=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],h=t[9],d=t[10],f=t[11],p=t[12],_=t[13],g=t[14],y=t[15];return e[0]=s*(d*y-f*g)-h*(u*y-c*g)+_*(u*f-c*d),e[1]=-(i*(d*y-f*g)-h*(n*y-o*g)+_*(n*f-o*d)),e[2]=i*(u*y-c*g)-s*(n*y-o*g)+_*(n*c-o*u),e[3]=-(i*(u*f-c*d)-s*(n*f-o*d)+h*(n*c-o*u)),e[4]=-(a*(d*y-f*g)-l*(u*y-c*g)+p*(u*f-c*d)),e[5]=r*(d*y-f*g)-l*(n*y-o*g)+p*(n*f-o*d),e[6]=-(r*(u*y-c*g)-a*(n*y-o*g)+p*(n*c-o*u)),e[7]=r*(u*f-c*d)-a*(n*f-o*d)+l*(n*c-o*u),e[8]=a*(h*y-f*_)-l*(s*y-c*_)+p*(s*f-c*h),e[9]=-(r*(h*y-f*_)-l*(i*y-o*_)+p*(i*f-o*h)),e[10]=r*(s*y-c*_)-a*(i*y-o*_)+p*(i*c-o*s),e[11]=-(r*(s*f-c*h)-a*(i*f-o*h)+l*(i*c-o*s)),e[12]=-(a*(h*g-d*_)-l*(s*g-u*_)+p*(s*d-u*h)),e[13]=r*(h*g-d*_)-l*(i*g-n*_)+p*(i*d-n*h),e[14]=-(r*(s*g-u*_)-a*(i*g-n*_)+p*(i*u-n*s)),e[15]=r*(s*d-u*h)-a*(i*d-n*h)+l*(i*u-n*s),e},t.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],d=e[11],f=e[12],p=e[13],_=e[14],g=e[15];return(t*a-r*o)*(h*g-d*_)-(t*s-i*o)*(l*g-d*p)+(t*u-n*o)*(l*_-h*p)+(r*s-i*a)*(c*g-d*f)-(r*u-n*a)*(c*_-h*f)+(i*u-n*s)*(c*p-l*f)},t.multiply=o,t.translate=function(e,t,r){var i=r[0],n=r[1],o=r[2],a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,h=void 0,d=void 0,f=void 0,p=void 0,_=void 0,g=void 0,y=void 0;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*o+t[12],e[13]=t[1]*i+t[5]*n+t[9]*o+t[13],e[14]=t[2]*i+t[6]*n+t[10]*o+t[14],e[15]=t[3]*i+t[7]*n+t[11]*o+t[15]):(s=t[1],u=t[2],c=t[3],l=t[4],h=t[5],d=t[6],f=t[7],p=t[8],_=t[9],g=t[10],y=t[11],e[0]=a=t[0],e[1]=s,e[2]=u,e[3]=c,e[4]=l,e[5]=h,e[6]=d,e[7]=f,e[8]=p,e[9]=_,e[10]=g,e[11]=y,e[12]=a*i+l*n+p*o+t[12],e[13]=s*i+h*n+_*o+t[13],e[14]=u*i+d*n+g*o+t[14],e[15]=c*i+f*n+y*o+t[15]),e},t.scale=function(e,t,r){var i=r[0],n=r[1],o=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,r,n){var o,a,s,u,c,l,h,d,f,p,_,g,y,v,m,b,T,I,E,S,w,F,R,x,M=n[0],O=n[1],A=n[2],L=Math.sqrt(M*M+O*O+A*A);return L<i.EPSILON?null:(M*=L=1/L,O*=L,A*=L,o=Math.sin(r),s=1-(a=Math.cos(r)),c=t[1],l=t[2],h=t[3],f=t[5],p=t[6],_=t[7],y=t[9],v=t[10],m=t[11],E=M*O*s-A*o,S=O*O*s+a,w=A*O*s+M*o,F=M*A*s+O*o,R=O*A*s-M*o,x=A*A*s+a,e[0]=(u=t[0])*(b=M*M*s+a)+(d=t[4])*(T=O*M*s+A*o)+(g=t[8])*(I=A*M*s-O*o),e[1]=c*b+f*T+y*I,e[2]=l*b+p*T+v*I,e[3]=h*b+_*T+m*I,e[4]=u*E+d*S+g*w,e[5]=c*E+f*S+y*w,e[6]=l*E+p*S+v*w,e[7]=h*E+_*S+m*w,e[8]=u*F+d*R+g*x,e[9]=c*F+f*R+y*x,e[10]=l*F+p*R+v*x,e[11]=h*F+_*R+m*x,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},t.rotateX=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*n+c*i,e[5]=a*n+l*i,e[6]=s*n+h*i,e[7]=u*n+d*i,e[8]=c*n-o*i,e[9]=l*n-a*i,e[10]=h*n-s*i,e[11]=d*n-u*i,e},t.rotateY=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[0],a=t[1],s=t[2],u=t[3],c=t[8],l=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n-c*i,e[1]=a*n-l*i,e[2]=s*n-h*i,e[3]=u*n-d*i,e[8]=o*i+c*n,e[9]=a*i+l*n,e[10]=s*i+h*n,e[11]=u*i+d*n,e},t.rotateZ=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[0],a=t[1],s=t[2],u=t[3],c=t[4],l=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n+c*i,e[1]=a*n+l*i,e[2]=s*n+h*i,e[3]=u*n+d*i,e[4]=c*n-o*i,e[5]=l*n-a*i,e[6]=h*n-s*i,e[7]=d*n-u*i,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,r){var n,o,a,s=r[0],u=r[1],c=r[2],l=Math.sqrt(s*s+u*u+c*c);return l<i.EPSILON?null:(s*=l=1/l,u*=l,c*=l,n=Math.sin(t),a=1-(o=Math.cos(t)),e[0]=s*s*a+o,e[1]=u*s*a+c*n,e[2]=c*s*a-u*n,e[3]=0,e[4]=s*u*a-c*n,e[5]=u*u*a+o,e[6]=c*u*a+s*n,e[7]=0,e[8]=s*c*a+u*n,e[9]=u*c*a-s*n,e[10]=c*c*a+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},t.fromXRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=a,t.fromQuat2=function(e,t){var r=s,i=-t[0],n=-t[1],o=-t[2],u=t[3],c=t[4],l=t[5],h=t[6],d=t[7],f=i*i+n*n+o*o+u*u;return f>0?(r[0]=2*(c*u+d*i+l*o-h*n)/f,r[1]=2*(l*u+d*n+h*i-c*o)/f,r[2]=2*(h*u+d*o+c*n-l*i)/f):(r[0]=2*(c*u+d*i+l*o-h*n),r[1]=2*(l*u+d*n+h*i-c*o),r[2]=2*(h*u+d*o+c*n-l*i)),a(e,t,r),e};var s=r.create();function u(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[4],a=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(o*o+a*a+s*s),e[2]=Math.sqrt(u*u+c*c+l*l),e},t.getRotation=function(e,t){var r=t[0]+t[5]+t[10],i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},t.fromRotationTranslationScale=function(e,t,r,i){var n=t[0],o=t[1],a=t[2],s=t[3],u=n+n,c=o+o,l=a+a,h=n*u,d=n*c,f=n*l,p=o*c,_=o*l,g=a*l,y=s*u,v=s*c,m=s*l,b=i[0],T=i[1],I=i[2];return e[0]=(1-(p+g))*b,e[1]=(d+m)*b,e[2]=(f-v)*b,e[3]=0,e[4]=(d-m)*T,e[5]=(1-(h+g))*T,e[6]=(_+y)*T,e[7]=0,e[8]=(f+v)*I,e[9]=(_-y)*I,e[10]=(1-(h+p))*I,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,r,i,n){var o=t[0],a=t[1],s=t[2],u=t[3],c=o+o,l=a+a,h=s+s,d=o*c,f=o*l,p=o*h,_=a*l,g=a*h,y=s*h,v=u*c,m=u*l,b=u*h,T=i[0],I=i[1],E=i[2],S=n[0],w=n[1],F=n[2],R=(1-(_+y))*T,x=(f+b)*T,M=(p-m)*T,O=(f-b)*I,A=(1-(d+y))*I,L=(g+v)*I,C=(p+m)*E,P=(g-v)*E,N=(1-(d+_))*E;return e[0]=R,e[1]=x,e[2]=M,e[3]=0,e[4]=O,e[5]=A,e[6]=L,e[7]=0,e[8]=C,e[9]=P,e[10]=N,e[11]=0,e[12]=r[0]+S-(R*S+O*w+C*F),e[13]=r[1]+w-(x*S+A*w+P*F),e[14]=r[2]+F-(M*S+L*w+N*F),e[15]=1,e},t.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r+r,s=i+i,u=n+n,c=r*a,l=i*a,h=i*s,d=n*a,f=n*s,p=n*u,_=o*a,g=o*s,y=o*u;return e[0]=1-h-p,e[1]=l+y,e[2]=d-g,e[3]=0,e[4]=l-y,e[5]=1-c-p,e[6]=f+_,e[7]=0,e[8]=d+g,e[9]=f-_,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,r,i,n,o,a){var s=1/(r-t),u=1/(n-i),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(n+i)*u,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e},t.perspective=function(e,t,r,i,n){var o=1/Math.tan(t/2),a=void 0;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+i)*(a=1/(i-n)),e[14]=2*n*i*a):(e[10]=-1,e[14]=-2*i),e},t.perspectiveFromFieldOfView=function(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(n+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(n-o)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},t.ortho=function(e,t,r,i,n,o,a){var s=1/(t-r),u=1/(i-n),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(n+i)*u,e[14]=(a+o)*c,e[15]=1,e},t.lookAt=function(e,t,r,o){var a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,h=void 0,d=void 0,f=void 0,p=void 0,_=void 0,g=t[0],y=t[1],v=t[2],m=o[0],b=o[1],T=o[2],I=r[0],E=r[1],S=r[2];return Math.abs(g-I)<i.EPSILON&&Math.abs(y-E)<i.EPSILON&&Math.abs(v-S)<i.EPSILON?n(e):(d=g-I,f=y-E,p=v-S,a=b*(p*=_=1/Math.sqrt(d*d+f*f+p*p))-T*(f*=_),s=T*(d*=_)-m*p,u=m*f-b*d,(_=Math.sqrt(a*a+s*s+u*u))?(a*=_=1/_,s*=_,u*=_):(a=0,s=0,u=0),c=f*u-p*s,l=p*a-d*u,h=d*s-f*a,(_=Math.sqrt(c*c+l*l+h*h))?(c*=_=1/_,l*=_,h*=_):(c=0,l=0,h=0),e[0]=a,e[1]=c,e[2]=d,e[3]=0,e[4]=s,e[5]=l,e[6]=f,e[7]=0,e[8]=u,e[9]=h,e[10]=p,e[11]=0,e[12]=-(a*g+s*y+u*v),e[13]=-(c*g+l*y+h*v),e[14]=-(d*g+f*y+p*v),e[15]=1,e)},t.targetTo=function(e,t,r,i){var n=t[0],o=t[1],a=t[2],s=i[0],u=i[1],c=i[2],l=n-r[0],h=o-r[1],d=a-r[2],f=l*l+h*h+d*d;f>0&&(l*=f=1/Math.sqrt(f),h*=f,d*=f);var p=u*d-c*h,_=c*l-s*d,g=s*h-u*l;return(f=p*p+_*_+g*g)>0&&(p*=f=1/Math.sqrt(f),_*=f,g*=f),e[0]=p,e[1]=_,e[2]=g,e[3]=0,e[4]=h*g-d*_,e[5]=d*p-l*g,e[6]=l*_-h*p,e[7]=0,e[8]=l,e[9]=h,e[10]=d,e[11]=0,e[12]=n,e[13]=o,e[14]=a,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},t.subtract=u,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){var r=e[0],n=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],d=e[9],f=e[10],p=e[11],_=e[12],g=e[13],y=e[14],v=e[15],m=t[0],b=t[1],T=t[2],I=t[3],E=t[4],S=t[5],w=t[6],F=t[7],R=t[8],x=t[9],M=t[10],O=t[11],A=t[12],L=t[13],C=t[14],P=t[15];return Math.abs(r-m)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(n-b)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(o-T)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(a-I)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(s-E)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-S)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(c-w)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(l-F)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(h-R)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(d-x)<=i.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(f-M)<=i.EPSILON*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(p-O)<=i.EPSILON*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(_-A)<=i.EPSILON*Math.max(1,Math.abs(_),Math.abs(A))&&Math.abs(g-L)<=i.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(y-C)<=i.EPSILON*Math.max(1,Math.abs(y),Math.abs(C))&&Math.abs(v-P)<=i.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))},t.mul=o,t.sub=u}).apply(null,i))||(e.exports=n)},"R2+F":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("ma1f"),r("qsST"),r("v7zm"),r("+6sX"),r("/COu"),r("Jvs9"),r("vwon"),r("cxbm")],void 0===(n=(function(e,t,r,i,n,o,a,s,u,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureSetReaderPBF=void 0;var h=n.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF");function d(e){for(;e.next();)switch(e.tag()){case 1:return e.getMessage();default:e.skip()}return null}var f=function(e){function t(t,r,i,n){var o=e.call(this,t)||this;return o._hasNext=!1,o._isPoints=!1,o._isPolygons=!1,o._featureIndex=-1,o._featureOffset=0,o._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,legacyFeature:void 0,optFeature:void 0},o._geometryType=n,o._reader=r,o._header=i,o._hasNext=i.hasFeatures,o._isPoints="esriGeometryPoint"===n,o._isPolygons="esriGeometryPolygon"===n,o}return r.__extends(t,e),t.fromBuffer=function(e,r){var n=function(e){try{for(var t=new o(new Uint8Array(e),new DataView(e));t.next();)switch(t.tag()){case 2:return d(t.getMessage());default:t.skip()}}catch(e){var r=new i("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});h.error(r)}return null}(e),a=l.parseHeader(n,"esriGeometryPoint"===r);return new t(c.FeatureSetReader.createInstance(),n,a,r)},Object.defineProperty(t.prototype,"geometryType",{get:function(){return this._geometryType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._header.featureCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasZ",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasM",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stride",{get:function(){return 2+(this.hasZ?1:0)+(this.hasM?1:0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasFeatures",{get:function(){return this._header.hasFeatures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exceededTransferLimit",{get:function(){return this._header.exceededTransferLimit},enumerable:!1,configurable:!0}),t.prototype.getApproximateSize=function(){if(this._hasFilter){var e=Math.abs(this._xmax-this._xmin)*Math.abs(this._ymax-this._ymin);return Math.max(Math.round(this.size*e/262144),0)}return this.size},t.prototype.getQuantizationTransform=function(){return this._header.transform},t.prototype.getCursor=function(){return this.copy()},t.prototype.getIndex=function(){return this._featureIndex},t.prototype.setIndex=function(e){this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,this._featureIndex=e},t.prototype.getAttributeHash=function(){var e=this,t="";return this._header.fieldIndexMap.forEach((function(r){t+=e._readAttributeAtIndex(r)+"."})),t},t.prototype.getObjectId=function(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)},t.prototype.getDisplayId=function(){return this._header.displayIds[this._featureIndex]},t.prototype.setDisplayId=function(e){this._header.displayIds[this._featureIndex]=e},t.prototype.getGroupId=function(){return this._header.groupIds[this._featureIndex]},t.prototype.setGroupId=function(e){this._header.groupIds[this._featureIndex]=e},t.prototype.readLegacyFeature=function(){var e;if(void 0===this._cache.legacyFeature){var t=this.readCentroid(),r={attributes:this.readAttributes(),geometry:this._isPoints?this.readLegacyPointGeometry():this.readLegacyGeometry(),centroid:null!==(e=t&&{x:t.coords[0],y:t.coords[1]})&&void 0!==e?e:null};return this._cache.legacyFeature=r,r}return this._cache.legacyFeature},t.prototype.readOptimizedFeature=function(){if(void 0===this._cache.optFeature){var e=new s.default(this.readGeometry(),this.readAttributes(),this.readCentroid());return this._cache.optFeature=e,e}return this._cache.optFeature},t.prototype.getXHydrate=function(){var e=this._header.centroid[2*this._featureIndex],t=this.getQuantizationTransform();return e*t.scale[0]+t.translate[0]},t.prototype.getYHydrate=function(){var e=this._header.centroid[2*this._featureIndex+1],t=this.getQuantizationTransform();return t.translate[1]-e*t.scale[1]},t.prototype.readLegacyPointGeometry=function(){return{x:this._header.centroid[2*this._featureIndex]+this._tx,y:this._header.centroid[2*this._featureIndex+1]+this._ty}},t.prototype.readLegacyGeometry=function(){var e=this.readGeometry();return a.convertToGeometry(e,this.geometryType,!1,!1)},t.prototype.readLegacyCentroid=function(){var e=this.readCentroid();if(!e)return null;var t=e.coords;return{x:t[0],y:t[1]}},t.prototype.readGeometryArea=function(){return this._cache.area||this.readGeometry(),this._cache.area},t.prototype.readUnquantizedGeometry=function(){if(void 0===this._cache.unquantGeometry){var e=this.readGeometry();if(!e)return this._cache.unquantGeometry=null,null;for(var t=e.clone(),r=t.lengths,i=t.coords,n=0,o=2;n<r.length;n++,o+=2)for(var a=r[n],s=1;s<a;s+=1,o+=2)i[o]+=i[o-2],i[o+1]+=i[o-1];return this._cache.unquantGeometry=t,t}return this._cache.unquantGeometry},t.prototype.readHydratedGeometry=function(){var e=this.readGeometry();if(!e)return null;var t=e.clone();return this._isPoints&&(t.coords[0]-=this._tx,t.coords[1]-=this._ty),a.unquantizeOptimizedGeometry(t,t,this.hasZ,this.hasM,this.getQuantizationTransform()),t},t.prototype.readGeometry=function(){if(void 0===this._cache.geometry){var e=null;if(this._isPoints)e=new u.default([],[this._header.centroid[2*this._featureIndex]+this._tx,this._header.centroid[2*this._featureIndex+1]+this._ty]);else{var t=this._header.offsets.geometry[this._featureIndex],r=this._reader;if(0===t)return null;r.move(t);try{e=this._parseGeometry(r)}catch(e){return console.error("Failed to parse geometry!",e),null}}return this._cache.geometry=e,e}return this._cache.geometry},t.prototype.readCentroid=function(){if(void 0===this._cache.centroid){var e=null,t=this._header.centroid[2*this._featureIndex]+this._tx,r=this._header.centroid[2*this._featureIndex+1]+this._ty;return 268435455===t?(e=this._computeCentroid())&&(this._header.centroid[2*this._featureIndex]=e.coords[0]-this._tx,this._header.centroid[2*this._featureIndex+1]=e.coords[1]-this._ty):e=new u.default([],[t,r]),this._cache.centroid=e,e}return this._cache.centroid},t.prototype.copy=function(){var e=this._reader.clone(),r=new t(this.instance,e,this._header,this.geometryType);return this.copyInto(r),r},t.prototype.next=function(){if(this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,!this._hasFilter)return++this._featureIndex<this.size;for(;++this._featureIndex<this.size&&!this._passesFilter(););return this._featureIndex<this.size},t.prototype._readAttribute=function(e,t){var r=this._header.hasFieldIndex(e)?e:function(e){return e.toLowerCase().trim()}(e),i=this._header.getFieldIndex(r);if(null!=i){var n=this._readAttributeAtIndex(i);return t&&this._header.isDateField(r)?new Date(n):n}},t.prototype._readAttributes=function(){var e=this,t={};return this._header.fieldIndexMap.forEach((function(r,i){t[i]=e._readAttributeAtIndex(r)})),t},t.prototype.copyInto=function(t){e.prototype.copyInto.call(this,t),t._featureIndex=this._featureIndex,t._featureOffset=this._featureOffset,t._hasNext=this._hasNext},t.prototype._passesFilter=function(){if(!this._hasFilter)return!0;var e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1];if(268435455===e){if(this._isPolygons&&!this.readCentroid())return!1;e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1]}return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax},t.prototype._readAttributeAtIndex=function(e){var t=this._reader;return t.move(this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+e]),function(e){for(var t=e.getLength(),r=e.pos()+t;e.pos()<r&&e.next();)switch(e.tag()){case 1:var i=e.getString();return""===i?null:i;case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}(t)},t.prototype._preprocessPolygon=function(e,t){for(var r=0,i=0,n=0,o=!1,a=!1,s=!1,c=-1,l=[],h=0,d=!1,f=0;f<t.length;f++){for(var p=t[f],_=e[2*r],g=e[2*r+1],y=_,v=_,m=g,b=g,T=0,I=1;I<p;I++){var E=_+e[2*(r+I)],S=g+e[2*(r+I)+1],w=(E-_)*(S+g);y=Math.min(y,E),v=Math.max(v,E),m=Math.min(m,S),b=Math.max(b,S),_=E,g=S,T+=.5*w}var F=T>0;if(F&&d&&(i+=p),F||(c++,d=!1),c>=1e6)break;h+=T,o&&F&&a&&(s=!0),e[2*n]=e[2*i],e[2*n+++1]=e[2*i+++1];var R=1,x=e[2*i],M=e[2*i+++1];for(I=2;I<p;I++){var O=e[2*i],A=e[2*i+++1];x*A-O*M==0?(x+=O,M+=A):(e[2*n]=x,e[2*n+++1]=M,R++,x=O,M=A)}e[2*n]=x,e[2*n+++1]=M,R++,l.push(R),o=!1,a=!0,r+=p}return l.length?(this._cache.area=Math.abs(h),new u.default(l,e,s)):null},t.prototype._parseGeometry=function(e){for(var t=e.getLength(),r=e.pos()+t,i=[],n=[];e.pos()<r&&e.next();)switch(e.tag()){case 2:for(var o=e.getUInt32(),a=e.pos()+o;e.pos()<a;)n.push(e.getUInt32());break;case 3:for(var s=e.getUInt32(),c=e.pos()+s;e.pos()<c;)i.push(e.getSInt32()),i.push(e.getSInt32()),this.hasZ&&e.getSInt32(),this.hasM&&e.getSInt32();break;case 1:default:e.skip()}for(var l=0,h=0,d=n;h<d.length;h++){var f=d[h];i[2*l]+=this._tx,i[2*l+1]+=this._ty,l+=f}return this._isPolygons?this._preprocessPolygon(i,n):new u.default(n,i)},t}(c.FeatureSetReader);t.FeatureSetReaderPBF=f}).apply(null,i))||(e.exports=n)},R3Fd:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("2Kdy")],void 0===(n=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadProcessorModule=void 0,t.loadProcessorModule=function(e){return new Promise("heatmap"===e?function(e,t){Promise.all([r.e(1),r.e(163)]).then((function(){var t=[r("lw41")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}:function(e,t){Promise.all([r.e(6),r.e(7),r.e(10),r.e(11),r.e(1),r.e(67)]).then((function(){var t=[r("dh9Z")];e.apply(null,t)}).bind(this)).catch(t.bind(this))})}}).apply(null,i))||(e.exports=n)},"T+hO":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("8CIp"),r("lZYi"),r("tRKJ"),r("pzEE")],void 0===(n=(function(e,t,r,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSource=void 0,t.createSource=function(e,t,a,s,u){var c=function(e,t,i,n,o){switch(e.type){case"stream":return{type:"geoevent",serviceInfo:e,onRequest:n,outSR:t,canAcceptRequest:o};case"memory":case"on-demand":return{type:"feature",serviceInfo:e,onRequest:n,outSR:t,origin:function(e){return Array.isArray(e)?"local":"path"in e&&r.isHostedAgolService(e.path)?"hosted":"unknown"}(e.source),tileInfoView:i,canAcceptRequest:o}}}(e,t,a,s,u);switch(c.type){case"feature":switch(c.origin){case"hosted":case"local":return new o.PagedFeatureSource(c);case"unknown":return new i.DrillDownFeatureSource(c)}case"geoevent":return new n.GeoEventSource(c)}}}).apply(null,i))||(e.exports=n)},aROD:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("BcWh"),r("7MDj"),r("Vx27")],void 0===(n=(function(e,t,r,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.onFeature=function(e){this.emit("feature",e)},r.__decorate([o.subclass("esri.layers.graphics.sources.connections.StreamConnection")],t)}(i.EventedMixin(n.HandleOwner));t.default=a}).apply(null,i))||(e.exports=n)},apbF:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("ma1f"),r("qsST"),r("xoE+"),r("jBNx"),r("DJpR"),r("4F/P"),r("JNkf"),r("7AYJ")],void 0===(n=(function(e,t,r,i,n,o,a,s,u,c,l){"use strict";var h;Object.defineProperty(t,"__esModule",{value:!0}),t.createProgramDescriptor=t.getPixelArrayCtor=t.getPixelBytes=t.getBytes=t.geometryToMappedGeometry=t.createTextureFromTexelData=t.createGeometryData=t.C_VBO_INFO=t.copyMeshData=t.getTransformParams=t.getVVType=t.getJoinType=t.getCapType=t.isNumber=t.isDefined=t.getTextProperties=t.allocateTypedArrayBufferwithData=t.allocateTypedArrayBuffer=t.strideToPackingFactor=t.getNamedBuffers=t.getStrides=t.C_LABEL_STRIDE_SPEC=t.C_TEXT_STRIDE_SPEC=t.C_LINE_STRIDE_SPEC=t.C_FILL_STRIDE_SPEC_DD=t.C_FILL_STRIDE_SPEC=t.C_ICON_STRIDE_SPEC=t.C_LABEL_VERTEX_DEF=t.C_TEXT_VERTEX_DEF=t.C_LINE_VERTEX_DEF=t.C_FILL_VERTEX_DEF_DD=t.C_FILL_VERTEX_DEF=t.C_ICON_VERTEX_DEF=t.C_VBO_PERINSTANCE_VV=t.C_VBO_PERINSTANCE=t.C_VBO_GEOMETRY=void 0;var d=n.getLogger("esri.views.2d.engine.webgl.Utils");function f(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=n.strideInBytes}return t}t.C_VBO_GEOMETRY="geometry",t.C_VBO_PERINSTANCE="per_instance",t.C_VBO_PERINSTANCE_VV="per_instance_vv",t.C_ICON_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}],t.C_FILL_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}],t.C_FILL_VERTEX_DEF_DD=[{name:t.C_VBO_GEOMETRY,strideInBytes:12,divisor:0}],t.C_LINE_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}],t.C_TEXT_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}],t.C_LABEL_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}],t.C_ICON_STRIDE_SPEC=f(t.C_ICON_VERTEX_DEF),t.C_FILL_STRIDE_SPEC=f(t.C_FILL_VERTEX_DEF),t.C_FILL_STRIDE_SPEC_DD=f(t.C_FILL_VERTEX_DEF_DD),t.C_LINE_STRIDE_SPEC=f(t.C_LINE_VERTEX_DEF),t.C_TEXT_STRIDE_SPEC=f(t.C_TEXT_VERTEX_DEF),t.C_LABEL_STRIDE_SPEC=f(t.C_LABEL_VERTEX_DEF),t.getStrides=function(e,r){switch(e){case c.WGLGeometryType.MARKER:return t.C_ICON_STRIDE_SPEC;case c.WGLGeometryType.FILL:return r?t.C_FILL_STRIDE_SPEC_DD:t.C_FILL_STRIDE_SPEC;case c.WGLGeometryType.LINE:return t.C_LINE_STRIDE_SPEC;case c.WGLGeometryType.TEXT:return t.C_TEXT_STRIDE_SPEC;case c.WGLGeometryType.LABEL:return t.C_LABEL_STRIDE_SPEC}};var p=[t.C_VBO_GEOMETRY],_=[t.C_VBO_GEOMETRY],g=[t.C_VBO_GEOMETRY],y=[t.C_VBO_GEOMETRY],v=[t.C_VBO_GEOMETRY];function m(e){switch(e){case c.WGLGeometryType.MARKER:return p;case c.WGLGeometryType.FILL:return _;case c.WGLGeometryType.LINE:return g;case c.WGLGeometryType.TEXT:return y;case c.WGLGeometryType.LABEL:return v}}function b(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function T(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}t.getNamedBuffers=m,t.strideToPackingFactor=b,t.allocateTypedArrayBuffer=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}},t.allocateTypedArrayBufferwithData=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}},t.getTextProperties=function(e){return l.TextProperties.pool.acquire(e.color?u.copyAndPremultiply(e.color):[255,255,255,255],e.haloColor?u.copyAndPremultiply(e.haloColor):[255,255,255,255],a.pt2px(e.haloSize),a.pt2px(e.font.size),e.angle*Math.PI/180,e.xoffset/e.font.size,e.yoffset/e.font.size,"left"===e.horizontalAlignment?0:"right"===e.horizontalAlignment?1:.5,"top"===e.verticalAlignment?0:"bottom"===e.verticalAlignment?1:.5)},t.isDefined=function(e){return null!=e},t.isNumber=function(e){return"number"==typeof e},t.getCapType=function(e,t){switch(e){case"butt":return 0;case"round":return t?2:1;case"square":return 2;default:return d.error(new i("mapview-invalid-type","Cap type "+e+" is not a valid option. Defaulting to round")),1}},t.getJoinType=function(e){switch(e){case"miter":return 2;case"bevel":return 0;case"round":return 1;default:return d.error(new i("mapview-invalid-type","Join type "+e+" is not a valid option. Defaulting to round")),1}},t.getVVType=function(e){switch(e){case"opacity":return c.VVType.OPACITY;case"color":return c.VVType.COLOR;case"rotation":return c.VVType.ROTATION;case"size":return c.VVType.SIZE;default:return d.error("Cannot interpret unknown vv: "+e),null}},t.getTransformParams=function(e){return{transform:e.transform,hasZ:e.hasZ,hasM:e.hasM}},t.copyMeshData=function(e,t,r,i,n,o,a){for(var s in o)for(var u=o[s].stride,c=b(u),l=o[s].data,h=r[s].data,d=u*n.vertexCount/c,f=u*e/c,p=u*n.vertexFrom/c,_=0;_<d;++_)h[_+f]=l[_+p];var g=n.indexCount;for(_=0;_<g;++_)i[_+t]=a[_+n.indexFrom]-n.vertexFrom+e},t.C_VBO_INFO=((h={})[t.C_VBO_GEOMETRY]=35044,h),t.createGeometryData=function(e,t){for(var r=[],i=0;i<5;++i){for(var n={},o=0,a=m(i);o<a.length;o++){var s=a[o];n[s]={data:t(i,s)}}r.push({data:e(i),buffers:n})}return r},t.createTextureFromTexelData=function(e,t){var r,i;return o.isPowerOfTwo(t.width)&&o.isPowerOfTwo(t.height)?(r=!0,i=9987):(r=!1,i=9729),new s.Texture(e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:r,samplingMode:i,wrapMode:33071,flipped:!0},t)},t.geometryToMappedGeometry=function(e){return{vertexFrom:void 0,vertexTo:void 0,geometry:e}},t.getBytes=T,t.getPixelBytes=function(e){switch(e){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:return void d.error(new i("webgl-utils","Unable to handle type "+e))}},t.getPixelArrayCtor=function(e){switch(e){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void d.error(new i("webgl-utils","Unable to handle type "+e))}};var I=new Map;t.createProgramDescriptor=function(e,t){if(!I.has(e)){var i=function(e){var t={},i=function(i){var n=0;t[i]=e[i].map((function(e){var t=r.__assign(r.__assign({},e),{normalized:e.normalized||!1,divisor:e.divisor||0,offset:n,stride:0});return n+=e.count*T(e.type),t})),t[i].forEach((function(e){return e.stride=n}))};for(var n in e)i(n);return t}(t),n={strides:function(e){var t={};for(var r in e){var i=e[r];t[r]=i.length?i[0].stride:0}return t}(i),bufferLayouts:i,attributes:function(e){var t={};for(var r in e)for(var i=0,n=e[r];i<n.length;i++){var o=n[i];t[o.name]=o.location}return t}(t)};I.set(e,n)}return I.get(e)}}).apply(null,i))||(e.exports=n)},cxbm:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("ma1f"),r("YhCz")],void 0===(n=(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseHeader=t.FeatureSetHeader=void 0;var n=function(){function e(){this.hasFeatures=!1,this.fieldIndexMap=new Map,this.fieldCount=0,this.featureCount=0,this.objectIdFieldIndex=0,this.dateFields=new Set,this.offsets={attributes:new Array,geometry:new Array},this.centroid=new Array}return e.prototype.hasFieldIndex=function(e){return this.fieldIndexMap.has(e)},e.prototype.isDateField=function(e){return this.dateFields.has(e)},e.prototype.getFieldIndex=function(e){return this.fieldIndexMap.get(e)},e}();function o(e){for(var t=e.getLength(),r=e.pos()+t,n={name:"",isDate:!1};e.pos()<r&&e.next();)switch(e.tag()){case 1:n.name=e.getString();break;case 2:"esriFieldTypeDate"===i.parseFieldType(e.getEnum())&&(n.isDate=!0);break;default:e.skip()}return n}t.FeatureSetHeader=n,t.parseHeader=function(e,t){for(var a=e.pos(),s=new n,u=0,c=0,l=null,h=null,d=null,f=!1;e.next();)switch(e.tag()){case 1:l=e.getString();break;case 3:h=e.getString();break;case 12:d=e.processMessage(i.parseTransform);break;case 9:s.exceededTransferLimit=e.getBool(),s.exceededTransferLimit&&(s.offsets.geometry=new Int32Array(8e3),s.centroid=new Int32Array(16e3));break;case 13:var p=o(e),_=p.name.toLowerCase().trim(),g=u++;s.fieldIndexMap.set(p.name,g),s.fieldIndexMap.set(_,g),p.isDate&&(s.dateFields.add(p.name),s.dateFields.add(_));break;case 15:var y=e.getLength(),v=e.pos()+y;if(!s.exceededTransferLimit){var m=s.centroid;s.offsets.geometry.push(0),m.push(268435455),m.push(268435455)}!f&&s.exceededTransferLimit&&(f=!0,s.offsets.attributes=new Uint32Array(8e3*u));for(var b=c*u;e.pos()<v&&e.next();)switch(e.tag()){case 1:f?s.offsets.attributes[b++]=e.pos():s.offsets.attributes.push(e.pos());var T=e.getLength();e.skipLen(T);break;case 2:if(t)for(var I=e.getLength(),E=e.pos()+I;e.pos()<E&&e.next();)switch(e.tag()){case 3:e.getUInt32();var S=e.getSInt32(),w=e.getSInt32();s.centroid[2*c]=S,s.centroid[2*c+1]=w;break;default:e.skip()}else{s.offsets.geometry[c]=e.pos();var F=e.getLength();e.skipLen(F)}break;case 4:for(var R=e.getLength(),x=e.pos()+R;e.pos()<x&&e.next();)switch(e.tag()){case 3:e.getUInt32(),S=e.getSInt32(),w=e.getSInt32(),s.centroid[2*c]=S,s.centroid[2*c+1]=w;break;default:e.skip()}break;default:e.skip()}c++,s.hasFeatures=!0;break;default:e.skip()}var M=l||h;if(!M)throw new r("FeatureSet has no objectId or globalId field name");return s.featureCount=c,s.fieldCount=u,s.objectIdFieldIndex=s.getFieldIndex(M),s.transform=d,s.displayIds=new Uint32Array(s.featureCount),s.groupIds=new Uint16Array(s.featureCount),e.move(a),s}}).apply(null,i))||(e.exports=n)},gSUo:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("TMur"),r("zp6E"),r("ma1f"),r("qsST"),r("LxLY"),r("qMld"),r("Vx27"),r("Zvuv"),r("mucn"),r("B16N"),r("IpeC")],void 0===(n=(function(e,t,r,i,n,o,a,s,u,c,l,h,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=a.getLogger("esri.layers.graphics.sources.connections.GeoEventConnection"),_={maxQueryDepth:5,maxRecordCountFactor:3},g=function(e){function t(t){return e.call(this,r.__assign(r.__assign({},_),t))||this}return r.__extends(t,e),t.prototype._open=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._fetchServiceDefinition(this._config.source)];case 1:return(e=r.sent()).timeInfo.trackIdField||p.warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect."),[4,this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference)];case 2:return t=r.sent(),this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),[4,this._buddyServicesQuery];case 3:return r.sent(),[4,this._tryCreateWebSocket(t)];case 4:return r.sent(),n=(i=this._config).filter,o=i.outFields,this.destroyed||this._setFilter(n,o),[2]}}))}))},t.prototype._onMessage=function(e){var t;try{t=this._enrich(JSON.parse(e.data)),this._featureZScaler&&this._featureZScaler(t.geometry)}catch(e){return void p.error(new o("geoevent-connection","Failed to parse message",e))}this.onFeature(t)},t.prototype._fetchServiceDefinition=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,n(e.path,{query:{f:"json"},responseType:"json"})];case 1:return t=r.sent(),this._serviceDefinition=i=t.data,[2,i]}}))}))},t.prototype._fetchWebSocketUrl=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n;return r.__generator(this,(function(r){return n=(i=e[0]).token,[2,this._inferWebSocketBaseUrl(i.urls)+"/subscribe?outSR="+t.wkid+(n?"&token="+n:"")]}))}))},t.prototype._inferWebSocketBaseUrl=function(e){if(1===e.length)return e[0];for(var t=0,r=e;t<r.length;t++){var i=r[t];if(-1!==i.indexOf("wss"))return i}return p.error(new o("geoevent-connection","Unable to infer WebSocket url",e)),null},t.prototype._setFilter=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,a,c,l,h,d=this;return r.__generator(this,(function(r){return s.isNone(i=this._websocket)||s.isNone(e)&&s.isNone(t)?[2]:(n=JSON.stringify({filter:this._serializeFilter(e,t)}),a=!1,c=u.createResolver(),l=function(){a||(d.destroyed||d._websocket!==i||p.error(new o("geoevent-connection","Server timed out when setting filter")),c.reject())},h=function(e){var t=JSON.parse(e.data);t.filter&&(t.error&&(p.error(new o("geoevent-connection","Failed to set service filter",t.error)),d._set("errorString","Could not set service filter - "+t.error),c.reject(t.error)),i.onmessage=d._onMessage.bind(d),a=!0,c.resolve())},i.onmessage=h,i.send(n),setTimeout(l,1e4),[2,c.promise])}))}))},t.prototype._serializeFilter=function(e,t){var r={};if(s.isNone(e)&&s.isNone(t))return r;if(s.isSome(e)&&e.geometry)try{var n=i.fromJSON(e.geometry);if("extent"!==n.type)throw new o("Expected extent but found type "+n.type);r.geometry=JSON.stringify(n.shiftCentralMeridian())}catch(e){p.error(new o("geoevent-connection","Encountered an error when setting connection geometryDefinition",e))}return s.isSome(e)&&e.where&&"1 = 1"!==e.where&&(r.where=e.where),s.isSome(t)&&(r.outFields=t.join(",")),r},t.prototype._enrich=function(e){if(!this._relatedFeatures)return e;var t=e.attributes[this._serviceDefinition.relatedFeatures.joinField];if(!this._relatedFeatures.has(t))return p.warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;var r=this._relatedFeatures.get(t),i=r.attributes,n=r.geometry;for(var a in i)e.attributes[a]=i[a];return n&&(e.geometry=n),e.geometry||e.centroid||p.error(new o("geoevent-connection","Found malformed feature - no geometry found",e)),e},t.prototype._queryBuddyServices=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,a,s,u,c;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),t=(e=this._serviceDefinition).keepLatestArchive,i=this._queryRelatedFeatures(e.relatedFeatures),n=this._queryArchive(t),[4,i];case 1:return r.sent(),[4,n];case 2:if(!(a=r.sent()))return[2];for(s=0,u=a.features;s<u.length;s++)this.onFeature(this._enrich(u[s]));return[3,4];case 3:return c=r.sent(),p.error(new o("geoevent-connection","Encountered an error when querying buddy services",{error:c})),[3,4];case 4:return[2]}}))}))},t.prototype._queryRelatedFeatures=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return e?[4,this._queryBuddy(e.featuresUrl)]:[2];case 1:return t=r.sent(),this._addRelatedFeatures(t),[2]}}))}))},t.prototype._queryArchive=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return e?[2,this._queryBuddy(e.featuresUrl)]:[2,void 0]}))}))},t.prototype._queryBuddy=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,a,u,c,h,p,_,g;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,(t=new l({url:e})).load()];case 1:return n=r.sent().capabilities,a=n.query.supportsPagination,u=n.query.supportsCentroid,c=this._config.maxRecordCountFactor,h=t.capabilities.query.maxRecordCount,p=(o=n.query.supportsMaxRecordCountFactor)?h*c:h,(_=new f).outFields=s.unwrapOr(this._config.outFields,["*"]),_.where=s.unwrapOr(s.get(this._config.filter,"where"),"1=1"),_.returnGeometry=!0,_.returnExceededLimitFeatures=!0,_.outSpatialReference=i.SpatialReference.fromJSON(this._config.spatialReference),u&&(_.returnCentroid=!0),o&&(_.maxRecordCountFactor=c),a?(_.num=p,t.destroy(),[2,this._queryPages(e,_)]):[4,d.executeQuery(e,_,this._config.sourceSpatialReference)];case 2:return g=r.sent(),t.destroy(),[2,g.data]}}))}))},t.prototype._queryPages=function(e,t,i,n){return void 0===i&&(i=[]),void 0===n&&(n=0),r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:return t.start=n*t.num,[4,d.executeQuery(e,t,this._config.sourceSpatialReference)];case 1:return(o=r.sent().data).exceededTransferLimit&&n<this._config.maxQueryDepth?(o.features.forEach((function(e){return i.push(e)})),[2,this._queryPages(e,t,i,n+1)]):(i.forEach((function(e){return o.features.push(e)})),[2,o])}}))}))},t.prototype._addRelatedFeatures=function(e){for(var t=new Map,r=this._serviceDefinition.relatedFeatures.joinField,i=0,n=e.features;i<n.length;i++){var o=n[i];t.set(o.attributes[r],o)}this._relatedFeatures=t},r.__decorate([c.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],t)}(h.WebSocketConnection);t.default=g}).apply(null,i))||(e.exports=n)},gsnf:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zIqJ"),r("xoE+"),r("LxLY")],void 0===(n=(function(e,t,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ESRI_TIMESTAMP=t.DEFAULT_STREAM_ID_FIELD=void 0,t.DEFAULT_STREAM_ID_FIELD="__esri_stream_id__",t.ESRI_TIMESTAMP="__esri_timestamp__";var o=function(){function e(e,r,i,n,o){void 0===o&&(o=128),this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=i,this._purgeOptions=n,this.store=e,this.objectIdField=r,this.purgeInterval=o,this._useGeneratedIds=this.objectIdField===t.DEFAULT_STREAM_ID_FIELD}return e.prototype.add=function(e){if(this._useGeneratedIds){var t=this._nextId();e.attributes[this.objectIdField]=t,e.objectId=t}if(this._addOrUpdated.set(e.objectId,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),this._timeInfo.trackIdField){var o=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(o)){var a=n.isSome(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,s=i.clamp(a,0,1e3);this._trackIdToObservations.set(o,new r.default(s))}var u=this._trackIdToObservations.get(o).enqueue(e.objectId);n.isSome(u)&&(this._addOrUpdated.has(u)?this._addOrUpdated.delete(u):this._removed.push(u))}},e.prototype.checkForUpdates=function(){var e=this._getToAdd(),r=this._getToRemove(),i=performance.now();i-this._lastPurge>=this.purgeInterval&&(this._purge(i),this._lastPurge=i);var o=[];if(n.isSome(r))for(var a=0,s=r;a<s.length;a++){var u=this.store.removeById(s[a]);n.isSome(u)&&o.push(u)}if(n.isSome(e))for(var c=0,l=e;c<l.length;c++)(u=l[c]).attributes[t.ESRI_TIMESTAMP]=i,this.store.add(u);(e||o)&&this.store.update(e,o)},e.prototype._getToAdd=function(){if(!this._addOrUpdated.size)return null;var e=new Array(this._addOrUpdated.size),t=0;return this._addOrUpdated.forEach((function(r){return e[t++]=r})),this._addOrUpdated.clear(),e},e.prototype._getToRemove=function(){var e=this._removed;return this._removed.length?(this._removed=[],e):null},e.prototype._nextId=function(){var e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e},e.prototype._purge=function(e){var t=this._purgeOptions;n.isSome(t)&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeByAgeReceived(e,t),this._purgeTracks())},e.prototype._purgeSomeByDisplayCount=function(e){var t=this;if(e.displayCount){var r=this.store.size;r>e.displayCount&&this._trackIdToObservations.forEach((function(i){if(r>e.displayCount&&i.size){var o=n.unwrap(i.dequeue());t._removed.push(o),r--}}))}},e.prototype._purgeByAge=function(e){var t,r=this;if(e.age&&(null===(t=this._timeInfo)||void 0===t?void 0:t.startTimeField)){var i=this._maxAge-60*e.age*1e3;this.store.forEach((function(e){e.attributes[r._timeInfo.startTimeField]<i&&r._removed.push(e.objectId)}))}},e.prototype._purgeByAgeReceived=function(e,r){var i=this;if(r.ageReceived){var n=e+60*r.ageReceived*1e3;this.store.forEach((function(e){e.attributes[t.ESRI_TIMESTAMP]<n&&i._removed.push(e.objectId)}))}},e.prototype._purgeTracks=function(){var e=this;this._trackIdToObservations.forEach((function(t,r){0===t.size&&e._trackIdToObservations.delete(r)}))},e}();t.default=o}).apply(null,i))||(e.exports=n)},iqqO:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateToken=void 0;var r=function(){function e(){this.source=!1,this.targets={feature:!1,aggregate:!1},this.storage={filters:!1,data:!1},this.mesh=!1,this.queryFilter=!1,this.why={mesh:[],source:[]}}return e.create=function(t){var r=new e;for(var i in t){var n=t[i];if("object"==typeof n)for(var o in n)r[i][o]=n[o];r[i]=n}return r},e.empty=function(){return e.create({})},e.all=function(){return e.create({source:!0,targets:{feature:!0,aggregate:!0},storage:{filters:!0,data:!0},mesh:!0})},e.prototype.any=function(){return this.source||this.mesh||this.storage.filters||this.storage.data||this.targets.feature||this.targets.aggregate||this.queryFilter},e.prototype.describe=function(){var e=0,t="";if(this.mesh){e+=20,t+="-> (20) Mesh needs update\n";for(var r=0,i=this.why.mesh;r<i.length;r++)t+="    + "+i[r]+"\n"}if(this.source){e+=10,t+="-> (10) The source needs update\n";for(var n=0,o=this.why.source;n<o.length;n++)t+="    + "+o[n]+"\n"}this.targets.feature&&(e+=5,t+="-> (5) Feature target parameters changed\n"),this.storage.filters&&(e+=5,t+="-> (5) Feature filter parameters changed\n"),this.targets.aggregate&&(e+=4,t+="-> (4) Aggregate target parameters changed\n"),this.storage.data&&(e+=1,t+="-> (1) Texture storage parameters changed"),console.debug("Applying "+(e<5?"Fastest":e<10?"Fast":e<15?"Moderate":e<20?"Slow":"Very Slow")+" update of cost "+e+"/45 "),console.debug(t)},e.prototype.toJSON=function(){return{source:this.source,targets:this.targets,storage:this.storage,mesh:this.mesh,queryFilter:this.queryFilter}},e}();t.UpdateToken=r}).apply(null,i))||(e.exports=n)},"k6A/":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("8V7H"),r("+6sX"),r("GI9R"),r("B16N"),r("ZB9i"),r("R2+F")],void 0===(n=(function(e,t,r,i,n,o,a,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSourceAdapter=t.SourceAdapter=void 0;var c=function(){function e(e){this.service=e}return e.prototype.destroy=function(){},e}();t.SourceAdapter=c,t.createSourceAdapter=function(e){var t,r=e.capabilities;return(t=e.source)&&t.capabilities&&t.collectionId&&t.layerDefinition&&t.url?new f(e):function(e){return Array.isArray(e.source)}(e)?new l(e):r.query.supportsFormatPBF?new h(e):new d(e)};var l=function(e){function t(t){var r=e.call(this,t)||this;return r._portsOpen=i.openWithPorts(t.source).then((function(e){return r.client=e})),r}return r.__extends(t,e),t.prototype.destroy=function(){this.client.close(),this.client=null},t.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._portsOpen];case 1:return r.sent(),[4,this.client.invoke("queryFeatures",e.toJSON(),t)];case 2:return i=r.sent(),[2,s.FeatureSetReaderJSON.fromFeatureSet(i,this.service.objectIdField)]}}))}))},t}(c),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,a.executeQueryPBFBuffer(this.service.source,e,t)];case 1:return i=r.sent().data,[2,u.FeatureSetReaderPBF.fromBuffer(i,this.service.geometryType)]}}))}))},t}(c),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o,u,c,l,h,d,f,p;return r.__generator(this,(function(r){switch(r.label){case 0:return o=(i=this.service).source,u=i.capabilities,c=i.spatialReference,l=i.objectIdField,!e.quantizationParameters||u.query.supportsQuantization?[3,2]:((h=e.clone()).quantizationParameters=null,[4,a.executeQuery(o,h,c,t)]);case 1:return d=r.sent().data,f=n.convertFromFeatureSet(d,l),n.quantizeOptimizedFeatureSet(t.transform,f),[2,s.FeatureSetReaderJSON.fromOptimizedFeatureSet(f)];case 2:return[4,a.executeQuery(o,e,this.service.spatialReference,t)];case 3:return p=r.sent().data,[2,s.FeatureSetReaderJSON.fromFeatureSet(p,this.service.objectIdField)]}}))}))},t}(c),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,a,u;return r.__generator(this,(function(r){switch(r.label){case 0:return i=this.service.capabilities,!e.quantizationParameters||i.query.supportsQuantization?[3,2]:(e.clone().quantizationParameters=null,[4,o.queryOptimizedFeatureSet(this.service.source,e,t)]);case 1:return a=r.sent(),n.quantizeOptimizedFeatureSet(t.transform,a),[2,s.FeatureSetReaderJSON.fromOptimizedFeatureSet(a)];case 2:return[4,o.queryOptimizedFeatureSet(this.service.source,e,t)];case 3:return u=r.sent(),[2,s.FeatureSetReaderJSON.fromOptimizedFeatureSet(u)]}}))}))},t}(c)}).apply(null,i))||(e.exports=n)},lZYi:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("H1tY"),r("qMld"),r("rM8A")],void 0===(n=(function(e,t,r,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrillDownFeatureSource=void 0;var a=i("esri-featurelayer-webgl"),s=i("esri-mobile"),u={maxDrillLevel:a&&"object"==typeof a&&null!=a.maxDrillLevel?a.maxDrillLevel:s?1:4,maxRecordCountFactor:a&&"object"==typeof a&&null!=a.maxRecordCountFactor?a.maxRecordCountFactor:s?1:3},c=function(e){function t(t){return e.call(this,t)||this}return r.__extends(t,e),t.prototype._fetchDataTile=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,o,a,s,c,l,h=this;return r.__generator(this,(function(d){return t=this._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,o=this._subscriptions.get(e.key.id),a=o.signal,s=e.getQuantizationParameters(),c=0,(l=function(d,f){return r.__awaiter(h,void 0,void 0,(function(){var h,p,_,g,y,v,m;return r.__generator(this,(function(r){switch(r.label){case 0:h=this._sourceQueryInfo,p=this._createQuery(d,{maxRecordCountFactor:t?u.maxRecordCountFactor:void 0,returnExceededLimitFeatures:!1,quantizationParameters:s}),c++,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._queue.push({tile:e,query:p,signal:a,depth:f})];case 2:if(_=r.sent(),c--,n.throwIfAborted(a),!_)return[2];if(h!==this._sourceQueryInfo)return l(d,f),[2];if(_.exceededTransferLimit&&f<u.maxDrillLevel){for(g=0,y=d.createChildTiles();g<y.length;g++)l(y[g],f+1);return[2]}return o.requests.done.push({query:p,request:v={tile:e,id:e.id,features:_,end:0===c}}),this._onRequest(v,"new"),[3,4];case 3:return m=r.sent(),n.isAbortError(m)||(i("esri-2d-debug")&&console.debug("Encountered an error while querying",m),this._onRequest({tile:e,id:e.id,features:null,end:!0},"new")),[3,4];case 4:return[2]}}))}))})(e,0),[2]}))}))},t}(o.BaseFeatureSource);t.DrillDownFeatureSource=c}).apply(null,i))||(e.exports=n)},mucn:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("ma1f"),r("qsST"),r("LxLY"),r("qMld"),r("Vx27"),r("aROD"),r("HoQt")],void 0===(n=(function(e,t,r,i,n,o,a,s,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketConnection=t.ReadyState=void 0;var l,h=n.getLogger("esri.layers.graphics.sources.connections.WebSocketConnection");!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(l=t.ReadyState||(t.ReadyState={}));var d=function(e){function t(t){var r=e.call(this)||this;r.errorString=null;var i=t.geometryType,n=t.spatialReference,o=t.sourceSpatialReference;return r._config=t,r._featureZScaler=c.getGeometryZScaler(i,o,n),r._open(),r}return r.__extends(t,e),t.prototype._open=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this._tryCreateWebSocket()];case 1:return e.sent(),this.destroyed?[3,3]:[4,this._handshake()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},t.prototype.destroy=function(){o.isSome(this._websocket)&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null},Object.defineProperty(t.prototype,"connectionStatus",{get:function(){if(o.isNone(this._websocket))return"disconnected";switch(this._websocket.readyState){case l.CONNECTING:case l.OPEN:return"connected";case l.CLOSING:case l.CLOSED:return"disconnected"}},enumerable:!1,configurable:!0}),t.prototype._tryCreateWebSocket=function(e,t,n){return void 0===e&&(e=this._config.source.path),void 0===t&&(t=1e3),void 0===n&&(n=0),r.__awaiter(this,void 0,void 0,(function(){var o,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,4]),this.destroyed?[2]:(o=this,[4,this._createWebSocket(e)]);case 1:return o._websocket=r.sent(),this.notifyChange("connectionStatus"),[3,4];case 2:return s=r.sent(),u=t/1e3,this._config.maxReconnectionAttempts&&n>=this._config.maxReconnectionAttempts?(h.error(new i("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),this.destroy(),[2]):(h.error(new i("websocket-connection","Failed to connect. Attempting to reconnect in "+u+"s",s)),[4,a.after(t)]);case 3:return r.sent(),[2,this._tryCreateWebSocket(e,Math.min(1.5*t,1e3*this._config.maxReconnectionInterval),n+1)];case 4:return[2]}}))}))},t.prototype._createWebSocket=function(e){var t=this,r=new WebSocket(e),i=a.create((function(e,t){r.onopen=function(){return e(r)},r.onclose=function(e){return t(e)}}));return i.then((function(){if(t.destroyed)return r.onclose=function(){},void r.close();r.onclose=function(e){return t._onClose(e)},r.onerror=function(e){return t._onError(e)},r.onmessage=function(e){return t._onMessage(e)}})),i},t.prototype._handshake=function(e){return void 0===e&&(e=1e4),r.__awaiter(this,void 0,void 0,(function(){var t,n,s,u,c,l,d,f=this;return r.__generator(this,(function(r){return o.isNone(t=this._websocket)?[2]:(n=a.createResolver(),s=t.onmessage,c=(u=this._config).filter,l=u.outFields,d=u.spatialReference,n.timeout(e),t.onmessage=function(e){var r,o=null;try{o=JSON.parse(e.data)}catch(e){}o&&"object"==typeof o||(h.error(new i("websocket-connection","Protocol violation. Handshake failed - malformed message",e.data)),n.reject(),f.destroy()),(null===(r=o.spatialReference)||void 0===r?void 0:r.wkid)!==(null==d?void 0:d.wkid)&&(h.error(new i("websocket-connection","Protocol violation. Handshake failed - expected wkid of "+d.wkid,e.data)),n.reject(),f.destroy()),"json"!==o.format&&(h.error(new i("websocket-connection","Protocol violation. Handshake failed - format is not set",e.data)),n.reject(),f.destroy()),c&&o.filter!==c&&h.error(new i("websocket-connection","Tried to set filter, but server doesn't support it")),l&&o.outFields!==l&&h.error(new i("websocket-connection","Tried to set outFields, but server doesn't support it")),t.onmessage=s,n.resolve()},t.send(JSON.stringify({filter:c,outFields:l,format:"json",spatialReference:{wkid:d.wkid}})),[2,n.promise])}))}))},t.prototype._onMessage=function(e){try{var t=JSON.parse(e.data);if("featureResult"!==t.type)throw new i("websocket-connection","Protocol violation - Expected to find message of type 'featureResult'",t);for(var r=0,n=t.features;r<n.length;r++){var o=n[r];this._featureZScaler&&this._featureZScaler(o.geometry),this.onFeature(o)}}catch(e){return h.error(new i("websocket-connection","Failed to parse message",e)),void this.destroy()}},t.prototype._onError=function(e){var t="Encountered an error over WebSocket connection";this._set("errorString",t),h.error("websocket-connection",t)},t.prototype._onClose=function(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&h.error("websocket-connection","WebSocket closed unexpectedly with error code "+e.code),this.destroyed||this._open()},r.__decorate([s.property()],t.prototype,"connectionStatus",null),r.__decorate([s.property()],t.prototype,"errorString",void 0),r.__decorate([s.subclass("esri.layers.graphics.sources.connections.WebSocketConnection")],t)}(u.default);t.WebSocketConnection=d}).apply(null,i))||(e.exports=n)},nfmf:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("7MDj"),r("H1tY"),r("LxLY"),r("qMld"),r("qMld"),r("8MXS"),r("Vx27"),r("+6sX"),r("ZooB"),r("I90O"),r("7+6c"),r("IFRM"),r("lvbU"),r("0SZq"),r("OgqW"),r("ZB9i"),r("iqqO"),r("vBGd")],void 0===(n=(function(e,t,r,i,n,o,a,s,u,c,l,h,d,f,p,_,g,y,v,m,b){"use strict";function T(e){if(!a.isAbortError(e)&&!function(e){return"worker:port-closed"===e.name}(e))throw e}Object.defineProperty(t,"__esModule",{value:!0});var I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._storage=new y.ComputedAttributeStorage,t._markedIdsBufId=t._storage.createBitset(),t._lastCleanup=performance.now(),t._cleanupNeeded=!1,t._invalidated=!1,t._tileToResolver=new Map,t.tileStore=null,t.config=null,t.processor=null,t.remoteClient=null,t.service=null,t._editing=!1,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._initAttributeStore(),this._initStores(),this._initQueryEngine(),this._initSource(),this._updateQueue=new b.QueueProcessor({concurrency:4,process:function(t,r){return e._onDisplayTilePatch(t,{signal:r})}}),this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this)),this.watch("updating",(function(t){return!t&&e.onIdle()}))])},t.prototype.startup=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this._initAttributeStore(),[2]}))}))},t.prototype._initSource=function(){var e=this;this._source=new p.Source2D(this.service,this.spatialReference,this.tileStore.tileScheme),this._source.onDisplayTilePatch=function(t,r){return e._invalidated=!0,e._patchTile(t,r)},this._source.canAcceptPatch=function(){return e._updateQueue.length<50};var t=this._source.sourceEvents;if("geoevent"===t.type){var i=t.events;this.handles.add([i.on("connectionStatus",(function(t){return e.remoteClient.invoke("setProperty",{propertyName:"connectionStatus",value:t}).catch(T)})),i.on("errorString",(function(t){return e.remoteClient.invoke("setProperty",{propertyName:"errorString",value:t}).catch(T)})),i.on("feature",(function(t){return e.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:t.attributes,centroid:t.centroid,geometry:t.geometry}}).catch(T)})),i.on("updateRate",(function(t){return e.remoteClient.invoke("emitEvent",{name:"update-rate",event:r.__assign({},t)}).catch(T)}))])}},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new _.default({type:"remote",initialize:function(t,r){return s.ignoreAbortErrors(e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r}).catch(T))},update:function(t,r){return s.ignoreAbortErrors(e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r}).catch(T))},render:function(t){return s.ignoreAbortErrors(e.remoteClient.invoke("tileRenderer.featuresView.requestRender",void 0,{signal:t}).catch(T))}})},t.prototype._initStores=function(){var e=this,t={geometryInfo:{geometryType:this.service.geometryType,hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.featureStore=new f.FeatureStore2D(t,this._storage),this.aggregateStore=new g.ClusterStore(t,this.spatialReference,this._storage),this.handles.add(this.aggregateStore.events.on("valueRangesChanged",(function(t){e.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:t.valueRanges}}).catch(T)})))},t.prototype._initQueryEngine=function(){var e;null===(e=this.queryEngine)||void 0===e||e.destroy(),this.queryEngine=new h.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:this.featureStore,timeInfo:this.service.timeInfo})},t.prototype.destroy=function(){this._updateQueue.destroy(),this._source.destroy(),this.queryEngine.destroy(),this.attributeStore&&this.attributeStore.destroy()},Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new d(this.service.fields)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasAggregates",{get:function(){return!!this.config.schema.targets.aggregate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!1,configurable:!0}),t.prototype.isUpdating=function(){return this._source.updating||!!this._updateQueue.length},t.prototype.enableEvent=function(e){this._source.enableEvent(e.name,e.value)},t.prototype.invalidate=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,o,s,c=this;return r.__generator(this,(function(r){switch(r.label){case 0:return e.any()?(n("esri-2d-update-debug")&&e.describe(),t=this.tileStore.tiles.map((function(e){var t=e.key,r=a.createResolver();return c._tileToResolver.set(t.id,r),r.promise})),i=this._updateQueue.takeAll(),this._updateQueue.resume(),this.hasAggregates&&e.mesh&&e.targets.aggregate&&!e.queryFilter?(this._repushAggregateMeshTiles(e),[3,3]):[3,1]):[2];case 1:return this._source.resubscribe(e),a.all(t).then((function(){c._source.resume()})),e.mesh?[4,u.whenFalseOnce(this,"updating")]:[3,3];case 2:r.sent(),r.label=3;case 3:return this.notifyChange("updating"),[4,a.all(t)];case 4:for(r.sent(),this._updateQueue.pause(),o=0,s=i;o<s.length;o++)this._patchTile(s[o]);return e.source&&(this._cleanupNeeded=!0),[2]}}))}))},t.prototype.resume=function(){return this._updateQueue.resume(),this._source.resume()},t.prototype.update=function(e,t,i){return void 0===i&&(i=!1),r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return this._editing?[4,u.whenFalseOnce(this,"updating")]:[3,2];case 1:r.sent(),r.label=2;case 2:return i&&(this._source.pause(),this._updateQueue.pause()),this._set("config",t),this._schema=t.schema,this._initQueryEngine(),[4,a.all([this._source.update(e,t.schema.source),this.featureStore.updateSchema(e,t.schema.targets.feature),this.attributeStore.update(e,t.schema.processors[0].storage),this.attributeStore.updateFilters(e,this)])];case 3:return r.sent(),[4,this.aggregateStore.updateSchema(e,t.schema.targets.aggregate)];case 4:return r.sent(),[2]}}))}))},t.prototype.refresh=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._source.resubscribe(m.UpdateToken.all(),!0),this._cleanupNeeded=!0,this.notifyChange("updating"),[4,u.whenFalseOnce(this,"updating",!0)];case 1:return e.sent(),[2]}}))}))},t.prototype.onTileUpdate=function(e){this.aggregateStore.onTileUpdate(e);for(var t=0,r=e.added;t<r.length;t++){var i=r[t];this._source.subscribe(i),this._level=i.level}for(var n=0,o=e.removed;n<o.length;n++){var a=o[n];this._source.unsubscribe(a),this._cleanupNeeded=!0,this._tileToResolver.has(a.id)&&(this._tileToResolver.get(a.id).resolve(),this._tileToResolver.delete(a.id))}this.notifyChange("updating")},t.prototype.onIdle=function(){this.hasAggregates&&this._invalidated&&(this._repushAggregateMeshTiles(),this._invalidated=!1),this._markAndSweep()},t.prototype.onEdits=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this._editing?[4,u.whenFalseOnce(this,"updating")]:[3,2];case 1:return t.sent(),[2,this.onEdits(e)];case 2:return this._editing=!0,[4,this._source.onEdits(e)];case 3:return t.sent(),[4,u.whenFalseOnce(this,"updating")];case 4:return t.sent(),this._editing=!1,[2]}}))}))},t.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},t.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},t.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},t.prototype.queryLatestObservations=function(e){return this.queryEngine.executeQueryForLatestObservations(e)},t.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},t.prototype.queryStatistics=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2,r.__assign(r.__assign({},this.featureStore.storeStatistics),{displayedFeatureCount:0,displayedVertexCount:0,displayPreProcessTime:0})]}))}))},t.prototype.getObjectId=function(e){return this.featureStore.lookupObjectId(e,this._storage)},t.prototype.getDisplayId=function(e){if(this._schema.targets.aggregate){var t=this.aggregateStore.getDisplayId(e);if(o.isNone(t)){var r=this.featureStore.lookupDisplayId(e);return this.aggregateStore.getDisplayIdForReferenceId(r)}return t}return this.featureStore.lookupDisplayId(e)},t.prototype.getFeature=function(e){var t=this.featureStore.lookupFeatureByDisplayId(e,this._storage);if(o.isNone(t))return null;var r=t.readHydratedGeometry(),i=l.convertToGeometry(r,t.geometryType,t.hasZ,t.hasM);return{attributes:t.readAttributes(),geometry:i}},t.prototype.getAggregate=function(e){return this.aggregateStore.getAggregate(e)},t.prototype.setHighlight=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i=this;return r.__generator(this,(function(r){return t=e.map((function(e){return i.getDisplayId(e)})),[2,this.attributeStore.setHighlight(e,t)]}))}))},t.prototype._repushAggregateMeshTiles=function(e){for(var t=0,r=this.tileStore.tiles;t<r.length;t++)this._patchTile({type:"replace",id:r[t].key.id,addOrUpdate:v.FeatureSetReaderJSON.fromOptimizedFeatures([],this.service.geometryType),remove:[],end:!0,noData:!1,update:e||m.UpdateToken.create({mesh:!0,targets:{aggregate:!0}})})},t.prototype._maybeForceCleanup=function(){performance.now()-this._lastCleanup>5e3&&this._markAndSweep()},t.prototype._patchTile=function(e,t){var r=this,i=this._updateQueue.push(e,t).then((function(){r.notifyChange("updating")})).catch((function(e){n("esri-2d-debug")&&!a.isAbortError(e)&&console.debug(e),r.notifyChange("updating")}));return this.notifyChange("updating"),i},t.prototype._onDisplayTilePatch=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,u,c,l,h,d;return r.__generator(this,(function(f){switch(f.label){case 0:for(i=this.tileStore.get(e.id),n=e.update,e.remove.length&&(this._cleanupNeeded=!0),s=[],u=0,c=e.remove;u<c.length;u++)s.push(this.featureStore.lookupDisplayId(c[u]));e.remove=s,a.throwIfAborted(t),f.label=1;case 1:return f.trys.push([1,7,,8]),o.isNone(e.addOrUpdate)?(this.processor.onTileData(i,r.__assign(r.__assign({},e),{addOrUpdate:null}),t).catch((function(e){a.throwIfNotAbortError(e)})),this._finishedPatch(e),[2]):(e.addOrUpdate._storage=this._storage,l=e.addOrUpdate.hasFilter(),h=e.addOrUpdate.instance,e.addOrUpdate._arcadeSpatialReference=this.spatialReference,(!this.featureStore.hasInstance(h)||n.targets.feature&&!l)&&this.featureStore.onTileData(i,e,this._storage),!n.storage.data&&!n.storage.filters||l?[3,4]:(this.attributeStore.onTileData(i,e),this._source.isStream?[4,this.attributeStore.sendUpdates()]:[3,3]));case 2:return f.sent(),[3,4];case 3:this.attributeStore.sendUpdates(),f.label=4;case 4:return this.hasAggregates&&n.targets.aggregate&&(this.aggregateStore.onTileData(i,e,this._storage,this.featureStore,this.attributeStore,n.mesh),n.mesh&&(this.attributeStore.onTileData(i,e),this.attributeStore.sendUpdates())),n.mesh?[4,this.processor.onTileData(i,e,t)]:[3,6];case 5:f.sent(),f.label=6;case 6:return this._maybeForceCleanup(),this._finishedPatch(e),[3,8];case 7:return d=f.sent(),a.throwIfNotAbortError(d),[3,8];case 8:return[2]}}))}))},t.prototype._finishedPatch=function(e){(e.noData||e.end)&&this._tileToResolver.has(e.id)&&(this._tileToResolver.get(e.id).resolve(),this._tileToResolver.delete(e.id))},t.prototype._markAndSweep=function(){var e=this;if(this._lastCleanup=performance.now(),this._cleanupNeeded||this._source.isStream){this._cleanupNeeded=!1;var t=this._storage.getBitset(this._markedIdsBufId),r=new Set;t.clear();for(var i=function(i){var n=e.featureStore.lookupDisplayId(i),o=(4294901760&e._storage.getInstanceId(n))>>>16;n&&(r.add(o),t.set(n))},n=0,a=this.tileStore.tiles;n<a.length;n++)this._source.forEachRequest(a[n].key.id,(function(e){if(!o.isNone(e.features))for(var t=e.features.getCursor();t.next();){var r=t.getObjectId();i(r)}}));this._source.forEachPendingEdit((function(e){return i(e)})),this._updateQueue.forEach((function(e){for(var t=0,r=e.remove;t<r.length;t++)i(r[t])})),this.config.schema.targets.aggregate&&(this.aggregateStore.sweepFeatures(t,this.featureStore),this.aggregateStore.sweepClusters(this._storage,this._level)),this.featureStore.sweepFeatures(t,this._storage),this.featureStore.sweepFeatureSets(r)}},r.__decorate([c.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r.__decorate([c.property()],t.prototype,"config",void 0),r.__decorate([c.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r.__decorate([c.property()],t.prototype,"processor",void 0),r.__decorate([c.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r.__decorate([c.property({constructOnly:!0})],t.prototype,"service",void 0),r.__decorate([c.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r.__decorate([c.property()],t.prototype,"updating",null),r.__decorate([c.subclass("esri.views.2d.layers.features.controllers.FeatureController2D")],t)}(i.HandleOwner);t.default=I}).apply(null,i))||(e.exports=n)},par7:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("7MDj"),r("H1tY"),r("qMld"),r("Vx27"),r("pMLx"),r("u+Ml"),r("R3Fd"),r("nfmf"),r("6kSU"),r("iqqO"),r("M3W5")],void 0===(n=(function(e,t,r,i,n,o,a,s,u,c,l,h,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInstances=void 0;var p=new Set;t.getInstances=function(){return p};var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controller=null,t.processor=null,t.remoteClient=null,t.tileStore=null,t.service=null,t.viewState=null,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.handles.add(this.watch("updating",(function(t){e.remoteClient.invoke("setUpdating",t).catch((function(e){n("esri-2d-debug")&&console.debug("Encountered an error when calling setUpdating",e)}))})))},t.prototype.destroy=function(){var e,t,r;null===(e=this.controller)||void 0===e||e.destroy(),null===(t=this.processor)||void 0===t||t.destroy(),null===(r=this.tileStore)||void 0===r||r.destroy(),this.controller=this.processor=this.tileStore=this.remoteClient=null},Object.defineProperty(t.prototype,"updating",{get:function(){return!this.controller||this.controller.updating},enumerable:!1,configurable:!0}),t.prototype.startup=function(e){var t=e.service,i=e.config,n=e.tileInfo;return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(r){switch(r.label){case 0:return this.service=t,this.tileStore||(e=new f(s.fromJSON(n)),this.tileStore=new h.default(e)),[4,this._configure(i)];case 1:return r.sent(),this.tileStore.clear(),[2]}}))}))},t.prototype.updateTiles=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this.tileStore.updateTiles(e),[2]}))}))},t.prototype.update=function(e){var t=e.config,i=e.pause;return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(r){switch(r.label){case 0:return e=d.UpdateToken.empty(),[4,o.all([this.processor.update(e,t),this.controller.update(e,t,i)])];case 1:return r.sent(),[2,e.toJSON()]}}))}))},t.prototype.invalidate=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i;return r.__generator(this,(function(r){switch(r.label){case 0:return t=d.UpdateToken.create(e),i=this.controller.invalidate(t),[4,this.remoteClient.invoke("setUpdating",this.updating)];case 1:return r.sent(),[2,i]}}))}))},t.prototype.setViewState=function(e){var t=u.fromJSON(e);this._set("viewState",t)},t.prototype._configure=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,o.all([this._handleControllerConfig(e),this._handleProcessorConfig(e)])];case 1:return t.sent(),this.controller.processor=this.processor,[4,this.update({config:e})];case 2:return t.sent(),[2]}}))}))},t.prototype._handleControllerConfig=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._createController(this.service,e)];case 1:return[4,(t=r.sent()).startup()];case 2:return r.sent(),[2,t]}}))}))},t.prototype._handleProcessorConfig=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,this._createProcessor(this.service,e)]}))}))},t.prototype._createController=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o;return r.__generator(this,(function(r){return this.controller&&this.controller.destroy(),n=(i=this).tileStore,o=new l.default({service:e,config:t,tileStore:n,remoteClient:i.remoteClient}),this.controller=o,[2,o]}))}))},t.prototype._createProcessor=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o,a;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,c.loadProcessorModule(t.schema.processors[0].type)];case 1:return i=r.sent().default,o=(n=this).remoteClient,a=new i({service:e,config:t,tileStore:n.tileStore,remoteClient:o}),this.processor&&this.processor.destroy(),this.processor=a,[2,a]}}))}))},r.__decorate([a.property()],t.prototype,"controller",void 0),r.__decorate([a.property()],t.prototype,"processor",void 0),r.__decorate([a.property({dependsOn:["controller.updating"]})],t.prototype,"updating",null),r.__decorate([a.property()],t.prototype,"viewState",void 0),r.__decorate([a.subclass("esri.views.2d.layers.features.Pipeline")],t)}(i.HandleOwner);t.default=_}).apply(null,i))||(e.exports=n)},pzEE:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("ma1f"),r("qsST"),r("qMld"),r("rM8A")],void 0===(n=(function(e,t,r,i,n,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PagedFeatureSource=void 0;var s=n.getLogger("esri.views.2d.layers.features.sources.FeatureSource"),u=function(e){function t(t){return e.call(this,t)||this}return r.__extends(t,e),t.prototype._fetchDataTile=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,a,u,c,l,h,d,f,p,_,g,y,v=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=6,n=20,a=this._subscriptions.get(e.key.id),u=!1,c=0,l=0,h=function(t,r){l--,o.throwIfAborted(a);var i=t.reader,n=t.query;if(!i.exceededTransferLimit){if(u=!0,0!==r&&!i.hasFeatures){var s={tile:e,id:e.id,features:i,end:0===l};return a.requests.done.push({request:s,query:n}),void v._onRequest(s,"new")}var c={tile:e,id:e.id,features:i,end:0===l};return a.requests.done.push({request:c,query:n}),void v._onRequest(c,"new")}var h={tile:e,id:e.id,features:i,end:u&&0===l};a.requests.done.push({request:h,query:n}),v._onRequest(h,"new")},d=0,f=0,r.label=1;case 1:if(u||!(f++<n))return[3,3];for(p=void 0,_=function(t){var r=c++;l++,p=g._fetchDataTilePage(e,r,a).then((function(e){return e&&h(e,r)})).catch((function(t){u=!0,o.isAbortError(t)||(s.error(new i("mapview-query-error","Encountered error when fetching tile",{tile:e,error:t})),v._onRequest({tile:e,id:e.id,features:null,end:u},"new"))}))},g=this,y=0;y<d+1;y++)_();return[4,p];case 2:return r.sent(),o.throwIfAborted(a),d=Math.min(d+2,t),[3,1];case 3:return[2]}}))}))},t.prototype._fetchDataTilePage=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,a,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:n=this._sourceQueryInfo,a=this._createQuery(e,{start:8e3*t,num:8e3,maxRecordCountFactor:3,returnExceededLimitFeatures:!0,quantizationParameters:e.getQuantizationParameters()}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._queue.push({tile:e,query:a,signal:i.signal,depth:t})];case 2:return s=r.sent(),o.throwIfAborted(i),s?n!==this._sourceQueryInfo?[2,this._fetchDataTilePage(e,t,i)]:[2,{reader:s,query:a}]:[2,null];case 3:return u=r.sent(),o.throwIfNotAbortError(u),[2,null];case 4:return[2]}}))}))},t}(a.BaseFeatureSource);t.PagedFeatureSource=u}).apply(null,i))||(e.exports=n)},rM8A:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("zp6E"),r("ma1f"),r("H1tY"),r("qsST"),r("LxLY"),r("qMld"),r("IpeC"),r("k6A/"),r("8ajZ"),r("vBGd")],void 0===(n=(function(e,t,r,i,n,o,a,s,u,c,l,h,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseFeatureSource=void 0;var f=a.getLogger("esri.views.2d.layers.features.sources.BaseFeatureSource"),p=function(e){function t(t){var i=e.call(this,t)||this;return i.type="feature",i._adapter=l.createSourceAdapter(t.serviceInfo),i._queue=new d.QueueProcessor({concurrency:8,process:function(e){return r.__awaiter(i,void 0,void 0,(function(){var t,i,n,a;return r.__generator(this,(function(r){return u.throwIfAborted(e),t=e.tile.key.id,i=e.tile,n=e.signal,a=o("esri-tiles-debug")?{tile:t.replace(/\//g,"."),depth:e.depth}:void 0,[2,this._adapter.executeQuery(e.query,{query:a,signal:n,transform:i.transform})]}))}))}}),i._patchQueue=new d.QueueProcessor({concurrency:8,process:function(e){return r.__awaiter(i,void 0,void 0,(function(){var t,i,n,a;return r.__generator(this,(function(r){return u.throwIfAborted(e),t=e.tile.key.id,i=e.tile,n=e.signal,a=o("esri-tiles-debug")?{tile:t.replace(/\//g,"."),depth:e.depth}:void 0,[2,this._adapter.executeQuery(e.query,{query:a,signal:n,transform:i.transform})]}))}))}}),i}return r.__extends(t,e),t.prototype.destroy=function(){this._adapter.destroy(),this._queue.destroy(),this._patchQueue.destroy()},t.prototype.setViewState=function(e){},Object.defineProperty(t.prototype,"updating",{get:function(){return!!this._queue.length},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){e.prototype.subscribe.call(this,t),this._fetchDataTile(t).catch((function(e){u.isAbortError(e)||f.error(new n("mapview-query-error","Encountered error when fetching tile",{tile:t,error:e}))}))},t.prototype.unsubscribe=function(t){e.prototype.unsubscribe.call(this,t)},t.prototype.pause=function(){this._queue.pause()},t.prototype.resume=function(){this._queue.resume()},t.prototype.query=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this._adapter.executeQuery(e,t)]}))}))},t.prototype.queryLastEditDate=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return t=r.__assign(r.__assign({},(e=this._serviceInfo.source).query),{f:"json"}),[4,i(e.path,{query:t,responseType:"json"})];case 1:return[2,n.sent().data.editingInfo.lastEditDate]}}))}))},t.prototype.forEachRequest=function(e,t){for(var r=this._subscriptions.get(e),i=r.signal,n=0,o=r.requests.done;n<o.length;n++)t(o[n].request,{signal:i})},t.prototype._executePatchQuery=function(e,t,i,n){return r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(a){return(o=t.clone()).outFields=r.__spreadArrays([this._serviceInfo.objectIdField],i),o.returnCentroid=!1,o.returnGeometry=!1,[2,this._patchQueue.push({tile:e,query:o,signal:n.signal,depth:o.start/8e3})]}))}))},t.prototype._resendRequest=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,a,c,l,h,d;return r.__generator(this,(function(f){switch(f.label){case 0:if(n=e.request,a=(i=e.query).outFields,l=(c=this._sourceQueryInfo.outFields).filter((function(e){return-1===a.indexOf(e)})),s.isNone(n.features))return[2];if(!l.length)return this._onRequest(r.__assign(r.__assign({},n),{end:n.end||t.end}),"new",t),[2];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this._executePatchQuery(n.tile,i,l,t)];case 2:return h=f.sent(),u.throwIfAborted(t),i.outFields=c,n.features.joinAttributes(h),this._onRequest(r.__assign(r.__assign({},n),{end:n.end||t.end}),"new",t),[3,4];case 3:return d=f.sent(),o("esri-2d-debug")&&!u.isAbortError(d)&&console.debug("Encountered an error when querying:",d),[3,4];case 4:return[2]}}))}))},t.prototype.resend=function(e){var t=e.dataTileOnly;return r.__awaiter(this,void 0,void 0,(function(){var e,i,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:for(e=0,i=!1,n=[],this._subscriptions.forEach((function(e){if(!e.requests.done.length){var t=e.tile;o._onRequest({tile:t,id:t.id,features:null,noData:!0,end:!1},"new",{dataTileOnly:!0})}}));!i;)i=!0,this._subscriptions.forEach((function(r){var a=r.requests;a.done.length>e&&(i=!1,n.push(o._resendRequest(a.done[e],{signal:r.signal,dataTileOnly:t,end:a.done.length===e+1})))})),e++;return[4,u.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype._createQuery=function(e,t){var i=new c(r.__assign(r.__assign(r.__assign({},this._serviceQueryInfo),this._sourceQueryInfo),t));return this._serviceInfo.capabilities.query.supportsQuantization||(t.quantizationParameters=null,i.maxAllowableOffset=e.resolution),t.quantizationParameters&&"esriGeometryPolyline"===this.geometryType&&(i.maxAllowableOffset=e.resolution),i.resultType="tile",i.geometry=e.extent,i},t}(h.DataTileSource);t.BaseFeatureSource=p}).apply(null,i))||(e.exports=n)},tI6k:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SPRITE_PADDING=t.MAX_GPU_UPLOADS_PER_FRAME=t.VTL_HIGH_RES_CUTOFF=t.VTL_TEXTURE_BINDING_UNIT_GLYPHS=t.VTL_TEXTURE_BINDING_UNIT_SPRITES=t.HITTEST_SEARCH_SIZE=t.THIN_LINE_THRESHOLD=t.EFFECT_FLAG_0=t.FILTER_FLAG_0=t.HIGHLIGHT_FLAG=t.MAX_FILTERS=t.ATTRIBUTE_DATA_DD1=t.ATTRIBUTE_DATA_DD0=t.ATTRIBUTE_DATA_VV=t.ATTRIBUTE_DATA_ANIMATION=t.ATTRIBUTE_DATA_FILTER_FLAGS=t.TEXTURE_BINDING_RENDERER_1=t.TEXTURE_BINDING_RENDERER_0=t.TEXTURE_BINDING_HIGHLIGHT_1=t.TEXTURE_BINDING_HIGHLIGHT_0=t.TEXTURE_BINDING_ATTRIBUTE_DATA_3=t.TEXTURE_BINDING_ATTRIBUTE_DATA_2=t.TEXTURE_BINDING_ATTRIBUTE_DATA_1=t.TEXTURE_BINDING_ATTRIBUTE_DATA_0=t.TEXTURE_BINDING_BITMAP=t.TEXTURE_BINDING_GLYPH_ATLAS=t.TEXTURE_BINDING_SPRITE_ATLAS=t.ATTRIBUTE_STORE_TEXTURE_SIZE=t.AVERAGE_GLYPH_MOSAIC_ITEM=t.TEXT_PLACEMENT_PADDING=t.GLYPH_SIZE=t.HEURISTIC_GLYPHS_PER_FEATURE=t.HEURISTIC_GLYPHS_PER_LINE=t.COLLISION_PLACEMENT_PADDING=t.COLLISION_TILE_BOX_SIZE=t.COLLISION_BOX_PADDING=t.COLLISION_EARLY_REJECT_BUCKET_SIZE=t.COLLISION_MAX_ZOOM_DELTA=t.MAGIC_LABEL_LINE_HEIGHT=t.DOT_DENSITY_MAX_FIELDS=t.COLLISION_BUCKET_SIZE=t.DEBUG_LABELS=t.ANGLE_FACTOR_256=t.RASTER_TILE_SIZE=t.TILE_SIZE=t.PICTURE_FILL_COLOR=t.EXTRUDE_SCALE=t.NAN_MAGIC_NUMBER=t.WEBGL_MAX_INNER_STOPS=t.WEBGL_MAX_STOPS=void 0,t.WEBGL_MAX_STOPS=8,t.WEBGL_MAX_INNER_STOPS=t.WEBGL_MAX_STOPS-2,t.NAN_MAGIC_NUMBER=1e-30,t.EXTRUDE_SCALE=64,t.PICTURE_FILL_COLOR=4294967295,t.TILE_SIZE=512,t.RASTER_TILE_SIZE=256,t.ANGLE_FACTOR_256=256/360,t.DEBUG_LABELS=!1,t.COLLISION_BUCKET_SIZE=128,t.DOT_DENSITY_MAX_FIELDS=8,t.MAGIC_LABEL_LINE_HEIGHT=29,t.COLLISION_MAX_ZOOM_DELTA=1,t.COLLISION_EARLY_REJECT_BUCKET_SIZE=16,t.COLLISION_BOX_PADDING=16,t.COLLISION_TILE_BOX_SIZE=t.TILE_SIZE/t.COLLISION_BUCKET_SIZE,t.COLLISION_PLACEMENT_PADDING=8,t.HEURISTIC_GLYPHS_PER_LINE=50,t.HEURISTIC_GLYPHS_PER_FEATURE=10,t.GLYPH_SIZE=24,t.TEXT_PLACEMENT_PADDING=8,t.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}},t.ATTRIBUTE_STORE_TEXTURE_SIZE=1024,t.TEXTURE_BINDING_SPRITE_ATLAS=0,t.TEXTURE_BINDING_GLYPH_ATLAS=0,t.TEXTURE_BINDING_BITMAP=0,t.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1,t.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2,t.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3,t.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4,t.TEXTURE_BINDING_HIGHLIGHT_0=5,t.TEXTURE_BINDING_HIGHLIGHT_1=6,t.TEXTURE_BINDING_RENDERER_0=5,t.TEXTURE_BINDING_RENDERER_1=6,t.ATTRIBUTE_DATA_FILTER_FLAGS=0,t.ATTRIBUTE_DATA_ANIMATION=1,t.ATTRIBUTE_DATA_VV=2,t.ATTRIBUTE_DATA_DD0=3,t.ATTRIBUTE_DATA_DD1=3,t.MAX_FILTERS=2,t.HIGHLIGHT_FLAG=1,t.FILTER_FLAG_0=2,t.EFFECT_FLAG_0=4,t.THIN_LINE_THRESHOLD=2.5,t.HITTEST_SEARCH_SIZE=24,t.VTL_TEXTURE_BINDING_UNIT_SPRITES=5,t.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6,t.VTL_HIGH_RES_CUTOFF=1.15,t.MAX_GPU_UPLOADS_PER_FRAME=2,t.SPRITE_PADDING=2}).apply(null,i))||(e.exports=n)},tRKJ:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("H1tY"),r("LxLY"),r("jEml"),r("+6sX"),r("Jvs9"),r("gsnf"),r("gSUo"),r("mucn"),r("8ajZ"),r("ZB9i")],void 0===(n=(function(e,t,r,i,n,o,a,s,u,c,l,h,d){"use strict";function f(e,t){var r=e.weakClone(),i=a.quantizeX(t,e.geometry.coords[0]),n=a.quantizeY(t,e.geometry.coords[1]);return r.geometry=new s.default([],[i,n]),r}function p(e,t){var r=o(9,function(e){switch(e){case"esriGeometryPoint":return function(e){return{minX:e.geometry.coords[0],minY:e.geometry.coords[1],maxX:e.geometry.coords[0],maxY:e.geometry.coords[1]}};default:return function(e){var t=1/0,r=1/0,i=-1/0,n=-1/0;return e.geometry.forEachVertex((function(e,o){t=Math.min(t,e),r=Math.min(r,o),i=Math.max(i,e),n=Math.max(n,o)})),{minX:t,minY:r,maxX:i,maxY:n}}}}(t));return r.load(e),r}function _(e,t){return e.search({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]})}Object.defineProperty(t,"__esModule",{value:!0}),t.GeoEventSource=void 0;var g=function(){function e(e,t){this.onUpdate=e,this._geometryType=t,this._objectIdToFeature=new Map}return Object.defineProperty(e.prototype,"_features",{get:function(){var e=[];return this._objectIdToFeature.forEach((function(t){return e.push(t)})),e},enumerable:!1,configurable:!0}),e.prototype.add=function(e){this._objectIdToFeature.set(e.objectId,e),this._index=null},e.prototype.get=function(e){return this._objectIdToFeature.has(e)?this._objectIdToFeature.get(e):null},e.prototype.forEach=function(e){this._objectIdToFeature.forEach(e)},e.prototype.search=function(e){return this._index||(this._index=p(this._features,this._geometryType)),_(this._index,e)},e.prototype.removeById=function(e){var t=this._objectIdToFeature.get(e);return t?(this._objectIdToFeature.delete(e),this._index=null,t):null},e.prototype.update=function(e,t){this.onUpdate(e,t)},Object.defineProperty(e.prototype,"size",{get:function(){return this._objectIdToFeature.size},enumerable:!1,configurable:!0}),e}(),y=function(e){function t(t){var r=e.call(this,t)||this;r.type="geoevent",r._dataReceiveEventEnabled=!1,r._updateInfo={websocket:0,client:0};var i=t.outSR,n=t.serviceInfo,o=n.geometryType,h=n.objectIdField,d=n.timeInfo,p=n.purgeOptions,_=n.source,y=n.spatialReference,v=n.serviceFilter,m=n.maxReconnectionAttempts,b=n.maxReconnectionInterval,T=new g(r._onUpdate.bind(r),o),I=new u.default(T,h,d,p),E=function(e,t,r,i,n,o,a){var s=0===e.path.indexOf("wss://")||0===e.path.indexOf("ws://"),u={source:e,sourceSpatialReference:t,spatialReference:r,geometryType:i,filter:n,maxReconnectionAttempts:o,maxReconnectionInterval:a};return s?new l.WebSocketConnection(u):new c.default(u)}(_,y,i,o,v,m,b);r._store=T,r._manager=I,r._connection=E,r._quantize=function(e){switch(e){case"esriGeometryPoint":return f;case"esriGeometryPolygon":case"esriGeometryPolyline":default:return function(t,r){var i=t.weakClone(),n=new s.default,o=a.quantizeOptimizedGeometry(n,t.geometry,!1,!1,e,r,!1,!1);return i.geometry=o,i}}}(o),r._handles=[r._connection.on("feature",(function(e){return r._onFeature(e)})),r._connection.watch("connectionStatus",(function(e){return r.events.emit("connectionStatus",e)})),r._connection.watch("errorString",(function(e){return r.events.emit("errorString",e)}))];var S=performance.now();return r._updateIntervalId=setInterval((function(){var e=performance.now(),i=e-S;if(i>2500){S=e;var n=Math.round(r._updateInfo.client/(i/1e3)),o=Math.round(r._updateInfo.websocket/(i/1e3));r._updateInfo.client=0,r._updateInfo.websocket=0,r.events.emit("updateRate",{client:n,websocket:o})}t.canAcceptRequest()&&r._manager.checkForUpdates()}),16),r}return r.__extends(t,e),t.prototype.destroy=function(){clearInterval(this._updateIntervalId),this._handles.forEach((function(e){return e.remove()})),this._connection.destroy()},t.prototype._fetchDataTile=function(){},t.prototype.enableEvent=function(e,t){"data-received"===e&&(this._dataReceiveEventEnabled=t)},Object.defineProperty(t.prototype,"updating",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){e.prototype.subscribe.call(this,t);var r=this._getTileFeatures(t);this._onRequest({tile:t,id:t.key.id,features:r,end:!0},"new")},t.prototype.unsubscribe=function(t){e.prototype.unsubscribe.call(this,t)},t.prototype.forEachRequest=function(e,t){var r=this._subscriptions.get(e),i=r.tile,n=r.signal;t({tile:i,id:e,features:this._getTileFeatures(i),end:!0},{signal:n})},t.prototype.resend=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t=this;return r.__generator(this,(function(r){return this._subscriptions.forEach((function(r){var i=r.tile,n={tile:i,id:i.id,features:t._getTileFeatures(i),end:!0};t._onRequest(n,"update",e)})),[2]}))}))},t.prototype._getTileFeatures=function(e){var t=this,r=this._store.search(e).map((function(r){return t._quantize(r,e.transform)}));return d.FeatureSetReaderJSON.fromOptimizedFeatures(r,this.geometryType,e.transform)},t.prototype._onFeature=function(e){this._updateInfo.websocket++;try{this._dataReceiveEventEnabled&&this.events.emit("feature",e);var t=a.convertFromFeature(e,this.geometryType,!1,!1,this._serviceInfo.objectIdField);this._manager.add(t)}catch(e){i("esri-2d-debug")&&console.debug(e)}},t.prototype._onUpdate=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o,a=this;return r.__generator(this,(function(r){return i=n.andThen(e,(function(e){return p(e,a.geometryType)})),o=n.andThen(t,(function(e){return p(e,a.geometryType)})),n.isSome(e)&&(this._updateInfo.client+=e.length),this._subscriptions.forEach((function(e,t){var r=e.tile,s=n.andThen(i,(function(e){return _(e,r)})),u=n.andThen(s,(function(e){return e.map((function(e){return a._quantize(e,r.transform)}))})),c=n.andThen(u,(function(e){return d.FeatureSetReaderJSON.fromOptimizedFeatures(e,a.geometryType,r.transform)})),l=n.andThen(o,(function(e){return _(e,r)})),h=n.andThen(l,(function(e){return e.map((function(e){return e.objectId}))}));a._onRequest({tile:r,id:t,features:c,remove:n.unwrapOr(h,[]),end:!0},"update")})),[2]}))}))},t}(h.DataTileSource);t.GeoEventSource=y}).apply(null,i))||(e.exports=n)}}]);