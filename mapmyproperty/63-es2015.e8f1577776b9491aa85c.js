(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{NloG:function(e,t,i){"use strict";var s=i("pO5D"),a=(i("wSAH"),i("6S2I")),n=(i("zqDF"),i("WbKI")),l=i("04ZG"),r=(i("4EHJ"),i("ju1D"),i("9AIY"),i("/CmD")),o=i("zm0L"),h=i("pdg3"),c=i("+rMe"),p=i("kJYu");let d=class extends(Object(p.b)(Object(h.a)(Object(c.b)(o.a.EventedMixin(r.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw a.a.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}})}get fullOpacity(){const e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(s.a)([Object(n.b)()],d.prototype,"fullOpacity",null),Object(s.a)([Object(n.b)()],d.prototype,"layer",void 0),Object(s.a)([Object(n.b)()],d.prototype,"parent",void 0),Object(s.a)([Object(n.b)({readOnly:!0})],d.prototype,"suspended",null),Object(s.a)([Object(n.b)({readOnly:!0})],d.prototype,"suspendInfo",null),Object(s.a)([Object(n.b)({readOnly:!0})],d.prototype,"legendEnabled",null),Object(s.a)([Object(n.b)({type:Boolean,readOnly:!0})],d.prototype,"updating",null),Object(s.a)([Object(n.b)()],d.prototype,"visible",null),d=Object(s.a)([Object(l.a)("esri.views.layers.LayerView")],d),t.a=d},Vm2Q:function(e,t,i){"use strict";i.d(t,"a",function(){return _});var s,a=i("pO5D"),n=(i("wSAH"),i("6S2I"),i("zqDF"),i("WbKI")),l=i("04ZG"),r=(i("4EHJ"),i("ju1D"),i("9AIY"),i("LE9a")),o=i("fX31"),h=i("N5XI"),c=i("ZuQG"),p=i("L1EH"),d=i("AMBt"),b=i("N2DF"),u=i("OvF4"),y=i("Ehki"),g=i("qatw");i("4GrV");const w={base:b.a,key:"type",typeMap:{extent:u.a,polygon:y.a}};let v=s=class extends c.a{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new s({geometry:this.geometry.clone()})}};Object(a.a)([Object(n.b)({types:w,json:{read:g.a,write:!0}})],v.prototype,"geometry",void 0),Object(a.a)([Object(n.b)({readOnly:!0})],v.prototype,"version",null),v=s=Object(a.a)([Object(l.a)("esri.views.layers.support.Geometry")],v);var m=v;let O=class extends c.a{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(a.a)([Object(n.b)({type:[[[Number]]],json:{write:!0}})],O.prototype,"path",void 0),Object(a.a)([Object(n.b)({readOnly:!0})],O.prototype,"version",null),O=Object(a.a)([Object(l.a)("esri.views.layers.support.Path")],O);const j=r.a.ofType({key:"type",base:c.a,typeMap:{rect:p.a,path:O,geometry:m}}),_=e=>{let t=class extends e{constructor(){super(...arguments),this.clips=new j,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new d.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(h.init)(this,"suspended",e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},!0),Object(h.init)(this,["layer.opacity","container"],()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)},!0),Object(h.init)(this,["layer.blendMode"],e=>{this.container&&(this.container.blendMode=e)},!0),Object(h.init)(this,["layer.effect"],e=>{this.container&&(this.container.effect=e)},!0),this.clips.on("change",()=>{this.container.clips=this.clips,this.notifyChange("clips")})]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then(e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){let t=!0;const i=this.layer,s=i.minScale,a=i.maxScale;if(null!=s&&null!=a){let i=!s,n=!a;!i&&e<=s&&(i=!0),!n&&e>=a&&(n=!0),t=i&&n}return t}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(a.a)([Object(n.b)({type:j,set(e){const t=Object(o.b)(e,this._get("clips"),j);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(a.a)([Object(n.b)()],t.prototype,"moving",void 0),Object(a.a)([Object(n.b)()],t.prototype,"attached",void 0),Object(a.a)([Object(n.b)()],t.prototype,"container",void 0),Object(a.a)([Object(n.b)()],t.prototype,"suspended",void 0),Object(a.a)([Object(n.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(a.a)([Object(n.b)()],t.prototype,"updateRequested",void 0),Object(a.a)([Object(n.b)()],t.prototype,"updating",null),Object(a.a)([Object(n.b)()],t.prototype,"view",void 0),t=Object(a.a)([Object(l.a)("esri.views.2d.layers.LayerView2D")],t),t}},oM7z:function(e,t,i){"use strict";i.r(t);var s=i("pO5D"),a=(i("wSAH"),i("srIe")),n=(i("6S2I"),i("zqDF"),i("WbKI")),l=i("04ZG"),r=i("4EHJ"),o=(i("ju1D"),i("9AIY"),i("WZb1")),h=i("l4ZG"),c=i("OvF4"),p=i("LE9a"),d=i("975N"),b=i("Lqtk"),u=i("r0DZ"),y=i("gYg2"),g=i("u3Ia"),w=i("9iar"),v=i("BGvB"),m=i("NloG"),O=i("Vh9r"),j=i("q03O"),_=i("xzrc"),V=i("LTnl"),f=i("Vm2Q");class I{constructor(){this.allSublayers=new Map,this.allPoints=[],this.allPolylines=[],this.allPolygons=[],this.allMapImages=[]}}let S=class extends(Object(f.a)(m.a)){constructor(){super(...arguments),this._handles=new u.a,this._bitmapIndex=new Map,this._mapImageContainer=new V.a,this._kmlVisualData=new I,this.allVisiblePoints=new w.a,this.allVisiblePolylines=new w.a,this.allVisiblePolygons=new w.a,this.allVisibleMapImages=new p.a}hitTest(e,t){if(this.suspended||!this._pointsView&&!this._polylinesView&&!this._polygonsView)return Promise.resolve(null);const i=[this._pointsView.hitTest(e,t),this._polylinesView.hitTest(e,t),this._polygonsView.hitTest(e,t)];return Promise.all(i).then(e=>e.filter(e=>(e&&(e.layer=this.layer,e.sourceLayer=this.layer),!!e))[0]||null)}update(e){this._polygonsView&&this._polygonsView.processUpdate(e),this._polylinesView&&this._polylinesView.processUpdate(e),this._pointsView&&this._pointsView.processUpdate(e)}attach(){this._handles.add([this.allVisibleMapImages.on("change",e=>{e.added.forEach(e=>this._addMapImage(e)),e.removed.forEach(e=>this._removeMapImage(e))})]),this.container.addChild(this._mapImageContainer),this._polygonsView=new O.a({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:()=>this.requestUpdate(),container:new j.a(this.view.featuresTilingScheme)}),this.container.addChild(this._polygonsView.container),this._polylinesView=new O.a({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:()=>this.requestUpdate(),container:new j.a(this.view.featuresTilingScheme)}),this.container.addChild(this._polylinesView.container),this._pointsView=new O.a({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:()=>this.requestUpdate(),container:new j.a(this.view.featuresTilingScheme)}),this.container.addChild(this._pointsView.container),this.watch("layer.visibleSublayers",e=>{for(const[t,i]of this._kmlVisualData.allSublayers)i.visibility=0;for(const t of e){const e=this._kmlVisualData.allSublayers.get(t.id);e&&(e.visibility=1)}this._refreshCollections()}),this._fetchingPromise=this._fetchService().then(()=>{this._fetchingPromise=null,this.notifyChange("updating")})}detach(){this._handles.removeAll(),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null)}moveStart(){}viewChange(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}moveEnd(){}isUpdating(){return null!=this._fetchingPromise||this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}_addMapImage(e){(this.view.spatialReference.isWGS84||this.view.spatialReference.isWebMercator)&&Object(b.default)(e.href,{responseType:"image"}).then(({data:t})=>{let i=c.a.fromJSON(e.extent);Object(h.a)(i,this.view.spatialReference)&&(i=Object(h.d)(i,this.view.spatialReference));const s=new _.a(t,"standard");s.x=i.xmin,s.y=i.ymax,s.resolution=i.width/t.naturalWidth,s.rotation=e.rotation,this._mapImageContainer.addChild(s),this._bitmapIndex.set(e,s)})}async _getViewDependentUrl(e,t){const{viewFormat:i,viewBoundScale:s,httpQuery:n}=e;if(Object(a.k)(i)){if(Object(a.j)(t))throw new Error("Loading this network link requires a view state.");let l;if(await Object(y.i)(),Object(a.k)(s)&&1!==s){const e=new c.a(t.extent);e.expand(s),l=e}else l=t.extent;l=Object(y.j)(l,o.a.WGS84);const h=Object(y.j)(l,o.a.WebMercator),p=l.xmin,b=l.xmax,u=l.ymin,w=l.ymax,v=t.size[0]*t.pixelRatio,m=t.size[1]*t.pixelRatio,O=Math.max(h.width,h.height),j={"[bboxWest]":p.toString(),"[bboxEast]":b.toString(),"[bboxSouth]":u.toString(),"[bboxNorth]":w.toString(),"[lookatLon]":l.center.x.toString(),"[lookatLat]":l.center.y.toString(),"[lookatRange]":O.toString(),"[lookatTilt]":"0","[lookatHeading]":t.rotation.toString(),"[lookatTerrainLon]":l.center.x.toString(),"[lookatTerrainLat]":l.center.y.toString(),"[lookatTerrainAlt]":"0","[cameraLon]":l.center.x.toString(),"[cameraLat]":l.center.y.toString(),"[cameraAlt]":O.toString(),"[horizFov]":"60","[vertFov]":"60","[horizPixels]":v.toString(),"[vertPixels]":m.toString(),"[terrainEnabled]":"0","[clientVersion]":d.d,"[kmlVersion]":"2.2","[clientName]":"ArcGIS API for JavaScript","[language]":"en-US"},_=e=>{for(const t in e)for(const i in j)e[t]=e[t].replace(i,j[i])},V=Object(r.E)(i);_(V);let f={};Object(a.k)(n)&&(f=Object(r.E)(n),_(f));const I=Object(g.c)(e.href);return I.query={...I.query,...V,...f},`${I.path}?${Object(r.D)(V)}`}return e.href}async _fetchService(){const e=new I;await this._loadVisualData(this.layer.url,e),this._kmlVisualData=e,this._refreshCollections()}_refreshCollections(){this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),this.allVisiblePoints.addMany(this._kmlVisualData.allPoints.filter(e=>this._isSublayerVisible(e.sublayerId)).map(({item:e})=>e)),this.allVisiblePolylines.addMany(this._kmlVisualData.allPolylines.filter(e=>this._isSublayerVisible(e.sublayerId)).map(({item:e})=>e)),this.allVisiblePolygons.addMany(this._kmlVisualData.allPolygons.filter(e=>this._isSublayerVisible(e.sublayerId)).map(({item:e})=>e)),this.allVisibleMapImages.addMany(this._kmlVisualData.allMapImages.filter(e=>this._isSublayerVisible(e.sublayerId)).map(({item:e})=>e))}_isSublayerVisible(e){const t=this._kmlVisualData.allSublayers.get(e);return!!t.visibility&&(-1===t.parentFolderId||this._isSublayerVisible(t.parentFolderId))}_loadVisualData(e,t){return this._fetchParsedKML(e).then(async e=>{for(const i of e.sublayers){t.allSublayers.set(i.id,i);const e=i.points?await Object(v.c)(i.points):[],s=i.polylines?await Object(v.c)(i.polylines):[],a=i.polygons?await Object(v.c)(i.polygons):[],n=i.mapImages||[];if(t.allPoints.push(...e.map(e=>({item:e,sublayerId:i.id}))),t.allPolylines.push(...s.map(e=>({item:e,sublayerId:i.id}))),t.allPolygons.push(...a.map(e=>({item:e,sublayerId:i.id}))),t.allMapImages.push(...n.map(e=>({item:e,sublayerId:i.id}))),i.networkLink){const e=await this._getViewDependentUrl(i.networkLink,this.view.state);await this._loadVisualData(e,t)}}})}_fetchParsedKML(e){return Object(v.b)(e,this.view.spatialReference,this.layer.refreshInterval).then(e=>Object(v.d)(e.data))}_removeMapImage(e){const t=this._bitmapIndex.get(e);t&&(this._mapImageContainer.removeChild(t),this._bitmapIndex.delete(e))}};Object(s.a)([Object(n.b)()],S.prototype,"_pointsView",void 0),Object(s.a)([Object(n.b)()],S.prototype,"_polylinesView",void 0),Object(s.a)([Object(n.b)()],S.prototype,"_polygonsView",void 0),Object(s.a)([Object(n.b)()],S.prototype,"_fetchingPromise",void 0),Object(s.a)([Object(n.b)()],S.prototype,"updating",void 0),S=Object(s.a)([Object(l.a)("esri.views.2d.layers.KMLLayerView2D")],S),t.default=S}}]);