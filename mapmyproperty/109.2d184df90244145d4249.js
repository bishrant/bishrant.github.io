(function(){(this||window).webpackJsonp.registerAbsMids({"arcgis-js-api/layers/graphics/sources/support/MemorySourceWorker":"fhRm"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{fhRm:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("Q2wQ"),i("HZ3d"),i("2Atf"),i("ma1f"),i("qMld"),i("Lzvl"),i("nrlZ"),i("+6sX"),i("rfv1"),i("Q2Em"),i("ZooB"),i("DaHD"),i("jJpZ"),i("I90O"),i("Q3lp"),i("k7g7")],void 0===(n=(function(e,t,i,r,n,s,a,u,l,o,d,p,c,f,y,h,m,g){Object.defineProperty(t,"__esModule",{value:!0});var b=l.WGS84,F={xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:l.WGS84},I={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};function v(e){return u.isPoint(e)?null!=e.z:!!e.hasZ}function _(e){return u.isPoint(e)?null!=e.m:!!e.hasM}var E=function(){function e(){this._queryEngine=null,this._nextObjectId=null}return e.prototype.destroy=function(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=this._requiredFields=this._fieldsIndex=this._createDefaultAttributes=null},e.prototype.load=function(e){return r(this,void 0,void 0,(function(){var t,r,a,u,l,o,y,v,_,E,j,T,R,x,q,w,D,O,S,M,k,Q,Z,A,P;return i(this,(function(i){switch(i.label){case 0:if(t=[],a=this._inferLayerProperties(r=e.features,e.fields),u=e.fields||[],l=null!=e.hasM?e.hasM:a.hasM,o=null!=e.hasZ?e.hasZ:a.hasZ,v=(y=!e.spatialReference&&!a.spatialReference)?b:e.spatialReference||a.spatialReference,_=y?F:null,E=e.geometryType||a.geometryType,j=e.objectIdField||a.objectIdField,T=e.timeInfo,y&&t.push({name:"feature-layer:spatial-reference-not-found",message:"Spatial reference not provided or found in features. Defaults to WGS84"}),!E)throw new s("feature-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");if(!j)throw new s("feature-layer:missing-property","objectIdField not set and couldn't be found in the provided fields");for(a.objectIdField&&j!==a.objectIdField&&(t.push({name:"feature-layer:duplicated-oid-field",message:'Provided objectIdField "'+j+'" doesn\'t match the field name "'+a.objectIdField+'", found in the provided fields'}),j=a.objectIdField),j&&!a.objectIdField&&(R=null,u.some((function(e){return e.name===j&&(R=e,!0)}))?(R.type="esriFieldTypeOID",R.editable=!1,R.nullable=!1):u.unshift({alias:j,name:j,type:"esriFieldTypeOID",editable:!1,nullable:!1})),x=0,q=u;x<q.length;x++){if(null==(S=q[x]).name&&(S.name=S.alias),null==S.alias&&(S.alias=S.name),!S.name)throw new s("feature-layer:invalid-field-name","field name is missing",{field:S});if(S.name===j&&(S.type="esriFieldTypeOID"),-1===m.kebabDict.jsonValues.indexOf(S.type))throw new s("feature-layer:invalid-field-type",'invalid type for field "'+S.name+'"',{field:S})}for(w={},this._requiredFields=[],D=0,O=u;D<O.length;D++)"esriFieldTypeOID"!==(S=O[D]).type&&"esriFieldTypeGlobalID"!==S.type&&(S.editable=null==S.editable||!!S.editable,S.nullable=null==S.nullable||!!S.nullable,M=g.getFieldDefaultValue(S),S.nullable||void 0!==M?w[S.name]=M:this._requiredFields.push(S));return this._fieldsIndex=new h(u),this._createDefaultAttributes=f.createDefaultAttributesFunction(w,j),T&&(T.startTimeField&&((k=this._fieldsIndex.get(T.startTimeField))?(T.startTimeField=k.name,k.type="esriFieldTypeDate"):T.startTimeField=null),T.endTimeField&&((Q=this._fieldsIndex.get(T.endTimeField))?(T.endTimeField=Q.name,Q.type="esriFieldTypeDate"):T.endTimeField=null),T.trackIdField&&((Z=this._fieldsIndex.get(T.trackIdField))?T.trackIdField=Z.name:(T.trackIdField=null,t.push({name:"feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:T}}))),T.startTimeField||T.endTimeField||(t.push({name:"feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing or invalid",details:{timeInfo:T}}),T=null)),A={warnings:t,featureErrors:[],layerDefinition:n({},I,{drawingInfo:f.createDrawingInfo(E),templates:f.createDefaultTemplate(w),extent:_,geometryType:E,objectIdField:j,fields:u,hasZ:!!o,hasM:!!l,timeInfo:T}),assignedObjectIds:{}},this._queryEngine=new c.default({fields:u,geometryType:E,hasM:l,hasZ:o,objectIdField:j,spatialReference:v,featureStore:new d.default({geometryType:E,hasM:l,hasZ:o}),timeInfo:T}),r&&r.length?(P=r.reduce((function(e,t){var i=t.attributes&&t.attributes[j];return null==i||isNaN(i)||!isFinite(i)?e:Math.max(e,i)}),0),this._nextObjectId=1+P,[4,p.checkProjectionSupport(r,v)]):(this._nextObjectId=1,[2,A]);case 1:return i.sent(),[2,this._loadInitialFeatures(A,r)]}}))}))},e.prototype.applyEdits=function(e){return r(this,void 0,void 0,(function(){var t,r;return i(this,(function(i){switch(i.label){case 0:return r=(t=this._queryEngine).spatialReference,[4,a.all([y.loadGeometryEngineForSimplify(t.geometryType),p.checkProjectionSupport(e.adds,r),p.checkProjectionSupport(e.updates,r)])];case 1:return i.sent(),[2,this._applyEdits(e)]}}))}))},e.prototype.queryFeatures=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){return i(this,(function(i){return[2,this._queryEngine.executeQuery(e,t.signal)]}))}))},e.prototype.queryFeatureCount=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){return i(this,(function(i){return[2,this._queryEngine.executeQueryForCount(e,t.signal)]}))}))},e.prototype.queryObjectIds=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){return i(this,(function(i){return[2,this._queryEngine.executeQueryForIds(e,t.signal)]}))}))},e.prototype.queryExtent=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){return i(this,(function(i){return[2,this._queryEngine.executeQueryForExtent(e,t.signal)]}))}))},e.prototype._inferLayerProperties=function(e,t){for(var i=void 0,r=void 0,n=null,s=null,a=null,l=0,o=e;l<o.length;l++){var d=o[l].geometry;if(d&&(n||(n=u.getJsonType(d)),s||(s=d.spatialReference),null==i&&(i=v(d)),null==r&&(r=_(d)),n&&s&&null!=i&&null!=r))break}if(t&&t.length){var p=null;t.some((function(e){var t="esriFieldTypeOID"===e.type,i=!e.type&&e.name&&"objectid"===e.name.toLowerCase();return p=e,t||i}))&&(a=p.name)}return{geometryType:n,spatialReference:s,objectIdField:a,hasM:r,hasZ:i}},e.prototype._loadInitialFeatures=function(e,t){for(var i=this._queryEngine,r=i.geometryType,n=i.hasM,s=i.hasZ,a=i.objectIdField,l=i.spatialReference,d=i.featureStore,c=[],f=0,h=t;f<h.length;f++){var m=h[f];if(null!=m.uid&&(e.assignedObjectIds[m.uid]=-1),m.geometry&&r!==u.getJsonType(m.geometry))e.featureErrors.push(y.createFeatureEditErrorResult("Incorrect geometry type."));else{var g=this._createDefaultAttributes(),b=y.mixAttributes(this._fieldsIndex,this._requiredFields,g,m.attributes,!0,e.warnings);b?e.featureErrors.push(b):(this._assignObjectId(g,m.attributes,!0),m.attributes=g,null!=m.uid&&(e.assignedObjectIds[m.uid]=m.attributes[a]),m.geometry&&(m.geometry=p.project(m.geometry,m.geometry.spatialReference,l)),c.push(m))}}if(d.addMany(o.convertFromFeatures([],c,r,s,n,a)),e.layerDefinition.extent=this._queryEngine.fullExtent,e.layerDefinition.timeInfo){var F=this._queryEngine.timeExtent;e.layerDefinition.timeInfo.timeExtent=[F.start,F.end]}return e},e.prototype._applyEdits=function(e){var t=e.adds,i=e.updates,r=e.deletes,n={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(t&&t.length&&this._applyAddEdits(n,t),i&&i.length&&this._applyUpdateEdits(n,i),r&&r.length){for(var s=0,a=r;s<a.length;s++)n.deleteResults.push(y.createFeatureEditSuccessResult(a[s]));this._queryEngine.featureStore.removeManyById(r)}return{fullExtent:this._queryEngine.fullExtent,featureEditResults:n}},e.prototype._applyAddEdits=function(e,t){for(var i=e.addResults,r=this._queryEngine,n=r.geometryType,s=r.hasM,a=r.hasZ,l=r.objectIdField,d=r.spatialReference,c=r.featureStore,f=[],h=0,m=t;h<m.length;h++){var g=m[h];if(g.geometry&&n!==u.getJsonType(g.geometry))i.push(y.createFeatureEditErrorResult("Incorrect geometry type."));else{var b=this._createDefaultAttributes(),F=y.mixAttributes(this._fieldsIndex,this._requiredFields,b,g.attributes);F?i.push(F):(this._assignObjectId(b,g.attributes),g.attributes=b,null!=g.uid&&(e.uidToObjectId[g.uid]=g.attributes[l]),g.geometry&&(g.geometry=p.project(y.simplify(g.geometry,d),g.geometry.spatialReference,d)),f.push(g),i.push(y.createFeatureEditSuccessResult(g.attributes[l])))}}c.addMany(o.convertFromFeatures([],f,n,a,s,l))},e.prototype._applyUpdateEdits=function(e,t){for(var i=e.updateResults,r=this._queryEngine,n=r.geometryType,s=r.hasM,a=r.hasZ,l=r.objectIdField,d=r.spatialReference,c=r.featureStore,f=0,h=t;f<h.length;f++){var m=h[f],g=m.attributes,b=m.geometry,F=g&&g[l];if(null!=F)if(c.has(F)){var I=o.convertToFeature(c.getFeature(F),n,a,s);if(b){if(n!==u.getJsonType(b)){i.push(y.createFeatureEditErrorResult("Incorrect geometry type."));continue}I.geometry=p.project(y.simplify(b,d),b.spatialReference,d)}if(g){var v=y.mixAttributes(this._fieldsIndex,this._requiredFields,I.attributes,g);if(v){i.push(v);continue}}c.add(o.convertFromFeature(I,n,a,s,l)),i.push(y.createFeatureEditSuccessResult(F))}else i.push(y.createFeatureEditErrorResult("Feature with object id "+F+" missing"));else i.push(y.createFeatureEditErrorResult("Identifier field "+l+" missing"))}},e.prototype._assignObjectId=function(e,t,i){void 0===i&&(i=!1);var r=this._queryEngine.objectIdField;e[r]=i&&t&&isFinite(t[r])?t[r]:this._nextObjectId++},e}();t.default=E}).apply(null,r))||(e.exports=n)}}]);