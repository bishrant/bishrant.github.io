!function(){function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){r(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=c(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw a}}}}function c(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t,r,n,i,a,s){try{var u=e[a](s),c=u.value}catch(o){return void r(o)}u.done?t(c):Promise.resolve(c).then(n,i)}function f(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){l(a,n,i,s,u,"next",e)}function u(e){l(a,n,i,s,u,"throw",e)}s(void 0)}))}}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"Hu/a":function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return I})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return w})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return x}));var n=r("srIe"),i=r("+opI"),a=r("f4Nx"),s=r("+NQI"),u=r("qatw"),c=r("gEht"),o=r("qNUd"),l=r("gVKr"),h=r("ZlUD"),p=(r("2X7Z"),r("HsO1")),d=new i.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),y=Object.freeze({}),m=new l.a,v=new l.a,g=new l.a,b={esriGeometryPoint:h.m,esriGeometryPolyline:h.o,esriGeometryPolygon:h.n,esriGeometryMultipoint:h.l};function x(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.hasZ,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.hasM,a=e.hasZ&&n,s=e.hasM&&i;if(r){var u=Object(h.u)(g,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,i);return Object(h.m)(u,a,s)}return Object(h.m)(t,a,s)}function _(e,t,r,n,i,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:r,c=t&&s,o=r&&u,l=n?"coords"in n?n:n.geometry:null;if(!l)return null;if(i){var f=Object(h.q)(v,l,t,r,e,i,s,u);return a&&(f=Object(h.u)(g,f,c,o,e,a)),b[e](f,c,o)}if(a){var p=Object(h.u)(g,l,t,r,e,a,s,u);return b[e](p,c,o)}return Object(h.x)(m,l,t,r,s,u),b[e](m,c,o)}function w(e,t,r){return R.apply(this,arguments)}function R(){return(R=f(regeneratorRuntime.mark((function e(t,r,n){var i,a,s,u,c,o,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.outFields,a=t.orderByFields,s=t.groupByFieldsForStatistics,u=t.outStatistics,i)for(c=0;c<i.length;c++)i[c]=i[c].trim();if(a)for(o=0;o<a.length;o++)a[o]=a[o].trim();if(s)for(l=0;l<s.length;l++)s[l]=s[l].trim();if(u)for(f=0;f<u.length;f++)u[f].onStatisticField&&(u[f].onStatisticField=u[f].onStatisticField.trim());return e.abrupt("return",(t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),O(t,r,n)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t,r){return S.apply(this,arguments)}function S(){return(S=f(regeneratorRuntime.mark((function e(t,i,l){var h,m,v,g,b,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(h=t.where,t.where=h=h&&h.trim(),(!h||/^1 *= *1$/.test(h)||i&&i===h)&&(t.where=null),t.geometry){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,function(){var e=f(regeneratorRuntime.mark((function e(t){var n,i,s,u,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.geometry,i=t.distance,s=t.units,null!=i&&!("vertexAttributes"in n)){e.next=3;break}return e.abrupt("return",n);case 3:if(u=n.spatialReference,o=s?d.fromJSON(s):Object(c.h)(u),!u||!Object(a.f)(u)&&!Object(a.m)(u)){e.next=9;break}e.t0=n,e.next=12;break;case 9:return e.next=11,Object(p.a)(u,a.a).then((function(){return Object(p.b)(n,a.a)}));case 11:e.t0=e.sent;case 12:return l=e.t0,e.next=15,f(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e(0),r.e(119)]).then(r.bind(null,"AKzY"));case 2:return e.abrupt("return",e.sent.geodesicBuffer);case 3:case"end":return e.stop()}}),e)})))();case 15:return e.t1=e.sent,e.abrupt("return",(0,e.t1)(l.spatialReference,l,i,o));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(t);case 7:return m=e.sent,t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel&&(v=t.geometry.spatialReference,(m=Object(s.a)(m)).spatialReference=v),t.geometry=m,e.next=12,Object(p.a)(m.spatialReference,l);case 12:return e.next=14,Object(o.a)(Object(u.a)(m));case 14:if(g=e.sent[0],!Object(n.j)(g)){e.next=17;break}throw y;case 17:return b=g.toJSON(),e.next=20,Object(p.b)(b,b.spatialReference,l);case 20:if(x=e.sent){e.next=23;break}throw y;case 23:return e.abrupt("return",(x.spatialReference=l,t.geometry=x,t));case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return e&&j in e?JSON.parse(JSON.stringify(e,k)):e}var j="_geVersion",k=function(e,t){return e!==j?t:void 0}},Klsb:function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return w})),r.d(t,"c",(function(){return _}));var n=r("zlDU"),i=r("f4Nx"),a=r("IXLn"),s=r("PNY3"),c=r("qatw"),o=r("gVKr"),l=r("ZlUD");function h(e,t){return e?t?4:3:t?3:2}function p(e,t,r,n,i){if(!e)return!1;var a,s=h(t,r),c=e.coords,o=!1,l=0,f=u(e.lengths);try{for(f.s();!(a=f.n()).done;){var p=a.value;o=d(o,c,s,l,p,n,i),l+=p*s}}catch(y){f.e(y)}finally{f.f()}return o}function d(e,t,r,n,i,a,s){for(var u=e,c=n,o=n,l=n+i*r;o<l;o+=r){(c=o+r)===l&&(c=n);var f=t[o],h=t[o+1],p=t[c],d=t[c+1];(h<s&&d>=s||d<s&&h>=s)&&f+(s-h)/(d-h)*(p-f)<a&&(u=!u)}return u}var y=r("HsO1"),m=r("Hu/a"),v={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},g={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},b={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},x={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function _(e,t,n,i,u){if(Object(c.g)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var f=Object(l.g)(new o.a,t,!1,!1);return Promise.resolve((function(e){return function(e,t,r,n){return p(e,!1,!1,n.coords[0],n.coords[1])}(f,0,0,e)}))}if(Object(c.g)(t)&&"esriGeometryMultipoint"===n){var d=Object(l.g)(new o.a,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((function(e){return function(e,t,r,n,i,a){var s=h(i,a),u=n.coords,c=n.lengths;if(!c)return!1;for(var o=0,l=0;o<c.length;o++,l+=s)if(!p(e,!1,!1,u[l],u[l+1]))return!1;return!0}(d,0,0,e,i,u)}))}if(Object(c.d)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((function(e){return Object(a.e)(t,Object(m.c)(n,i,u,e))}));if(Object(c.d)(t)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===e)return Promise.resolve((function(e){return Object(a.d)(t,Object(m.c)(n,i,u,e))}));if(Object(c.d)(t)&&"esriSpatialRelIntersects"===e){var y=Object(s.b)(n);return Promise.resolve((function(e){return y(t,Object(m.c)(n,i,u,e))}))}return Promise.all([r.e(0),r.e(119)]).then(r.bind(null,"AKzY")).then((function(r){var a=r[v[e]].bind(null,t.spatialReference,t);return function(e){return a(Object(m.c)(n,i,u,e))}}))}function w(e,t,r){return R.apply(this,arguments)}function R(){return(R=f(regeneratorRuntime.mark((function e(t,r,a){var s,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.spatialRel,!(u=t.geometry)){e.next=11;break}if(!0===g[s]){e.next=4;break}throw new n.a("feature-store:unsupported-query","Unsupported query spatial relationship",{query:t});case 4:if(!Object(i.i)(u.spatialReference)||!Object(i.i)(a)){e.next=11;break}if(o=u,!0===b[Object(c.c)(o)]){e.next=7;break}throw new n.a("feature-store:unsupported-query","Unsupported query geometry type",{query:t});case 7:if(function(e){return!0===x[e]}(r)){e.next=9;break}throw new n.a("feature-store:unsupported-query","Unsupported layer geometry type",{query:t});case 9:if(!t.outSR){e.next=11;break}return e.abrupt("return",Object(y.a)(t.geometry&&t.geometry.spatialReference,t.outSR));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){if(Object(c.d)(e))return!0;if(Object(c.g)(e)){var t,r=u(e.rings);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}}catch(i){r.e(i)}finally{r.f()}return!0}return!1}},ZBG3:function(e,r,a){"use strict";var c=a("f/qv"),o=a("srIe"),l=a("zlDU"),h=a("f4Nx"),p=a("KLE9"),d=a("qatw"),y=a("gEht"),m=a("kYAx"),v=a("MG+P"),g=a("qNUd"),b=a("rvq7"),x=a("gLc9"),_=a("qUyK"),w=a("QmHG"),R=a("HsO1"),O=a("1/KW"),S=a("ZqIb"),I=new(function(){function e(t,r){i(this,e),this._cache=new O.a(t),this._invalidCache=new O.a(r)}return s(e,[{key:"get",value:function(e,t){var r="".concat(t.uid,":").concat(e),n=this._cache.get(r);if(n)return n;if(void 0!==this._invalidCache.get(r))return null;try{var i=S.WhereClause.create(e,t);return this._cache.put(r,i),i}catch(a){return this._invalidCache.put(r,null),null}}}]),e}())(50,500),j="feature-store:unsupported-query",k=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function F(e,t){return e?I.get(e,t):null}function A(e,t,r){var i,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=[],c=u(t);try{for(c.s();!(i=c.n()).done;){var o=i.value;if("*"!==o&&!e.has(o))if(a){var f=Q(o);try{var h=F(f,e);if(!h)throw new l.a(j,"invalid SQL expression",{where:f});if(!h.isStandardized)throw new l.a(j,"expression is not standard",{clause:h});A(e,h.fieldNames,"expression contains missing fields")}catch(d){var p=d&&d.details;if(p&&(p.clause||p.where))throw d;p&&p.missingFields?s.push.apply(s,n(p.missingFields)):s.push(o)}}else s.push(o)}}catch(y){c.e(y)}finally{c.f()}if(s.length)throw new l.a(j,r,{missingFields:s})}function Q(e){return e.split(" as ")[0]}function T(e,t){var r=t.get(e);return!!r&&!k.has(r.type)}var P=a("Hu/a"),C=a("Klsb"),M=a("q7ja"),N=a("ZlUD"),E=a("AIxD"),G=function(){function e(t,r,n){i(this,e),this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues,this.fieldsIndex=n,this.featureAdapter=r;var a=t.outFields;if(a&&-1===a.indexOf("*")){this.outFields=a;var s,c=0,o=u(a);try{for(o.s();!(s=o.n()).done;){var l=s.value,f=Q(l),h=this.fieldsIndex.get(f),p=h?null:F(f,n),d=h?h.name:l.split(" as ")[1]||"FIELD_EXP_"+c++;this._fieldDataCache.set(l,{alias:d,clause:p})}}catch(y){o.e(y)}finally{o.f()}}}return s(e,[{key:"countDistinctValues",value:function(e){var t=this;return this.returnDistinctValues?(e.forEach((function(e){return t.getAttributes(e)})),this._returnDistinctMap.size):e.length}},{key:"getAttributes",value:function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}},{key:"getFieldValue",value:function(e,t,r){var n=r?r.name:t,i=null;return this._fieldDataCache.has(n)?i=this._fieldDataCache.get(n).clause:r||(i=F(t,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:i})),r?this.featureAdapter.getAttribute(e,n):i.calculateValue(e,this.featureAdapter)}},{key:"validateItem",value:function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:F(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)}},{key:"validateItems",value:function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:F(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)}},{key:"_processAttributesForOutFields",value:function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);var r,n={},i=u(t);try{for(i.s();!(r=i.n()).done;){var a=r.value,s=this._fieldDataCache.get(a),c=s.alias,o=s.clause;n[c]=o?o.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,c)}}catch(l){i.e(l)}finally{i.f()}return n}},{key:"_processAttributesForDistinctValues",value:function(e){if(Object(o.j)(e)||!this.returnDistinctValues)return e;var t=this.outFields,r=[];if(t){var n,i=u(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,s=this._fieldDataCache.get(a).alias;r.push(e[s])}}catch(h){i.e(h)}finally{i.f()}}else for(var c in e)r.push(e[c]);var l="".concat((t||["*"]).join(","),"=").concat(r.join(",")),f=this._returnDistinctMap.get(l)||0;return this._returnDistinctMap.set(l,++f),f>1?null:e}}]),e}();function q(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function D(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function V(e,t,r){return r?t-e:e-t}function z(e,t,r,n){if(r&&"esriFieldTypeDate"===r.type){var i=new Date(e).getTime(),a=new Date(t).getTime();if(!isNaN(i)&&!isNaN(a))return V(i,a,n)}if("number"==typeof e&&"number"==typeof t)return V(e,t,n);if("string"==typeof e&&"string"==typeof t){var s=e.toUpperCase(),u=t.toUpperCase();return!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?D(s,u,n):D(q(s),q(u),n)}return n?1:-1}function Z(e,t,r,n,i,a){var s=i-r,u=a-n,c=Math.min(1,Math.max(0,((e-r)*s+(t-n)*u)/(s*s+u*u)));return{x:r+s*c,y:n+u*c}}var B=function(){function e(t,r,n){i(this,e),this.items=t,this.queryGeometry=r,this.definitionExpression=n.definitionExpression,this.geometryType=n.geometryType,this.hasM=n.hasM,this.hasZ=n.hasZ,this.objectIdField=n.objectIdField,this.spatialReference=n.spatialReference,this.fieldsIndex=n.fieldsIndex,this.timeInfo=n.timeInfo,this.featureAdapter=n.featureAdapter,this.aggregateAdapter=n.aggregateAdapter}var r;return s(e,[{key:"size",get:function(){return this.items.length}},{key:"createQueryResponseForCount",value:function(e){var t=new G(e,this.featureAdapter,this.fieldsIndex);if(!e.outStatistics)return t.countDistinctValues(this.items);var r=e.groupByFieldsForStatistics,n=e.having;if(!(null==r?void 0:r.length))return 1;var i,a=new Map,s=new Map,c=new Set,o=u(e.outStatistics);try{for(o.s();!(i=o.n()).done;){var l=i.value,f="exceedslimit"!==l.statisticType?l.onStatisticField:void 0;if(!s.has(f)){var h,p=[],d=u(r);try{for(d.s();!(h=d.n()).done;){var y=h.value,m=this._getAttributeValues(t,y,a);p.push(m)}}catch(R){d.e(R)}finally{d.f()}s.set(f,this._calculateUniqueValues(p))}var v=s.get(f);for(var g in v){var b=v[g],x=b.data,_=b.items,w=x.join(",");n&&!t.validateItems(_,n)||c.add(w)}}}catch(R){o.e(R)}finally{o.f()}return c.size}},{key:"createQueryResponse",value:function(e){var r;return r=e.outStatistics?e.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(r.queryGeometry=Object(h.i)(e.outSR)&&!Object(h.c)(this.queryGeometry.spatialReference,e.outSR)?Object(P.b)(t({spatialReference:e.outSR},Object(R.b)(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):Object(P.b)(t({spatialReference:e.outSR},this.queryGeometry))),r}},{key:"createSnappingResponse",value:function(e,t){var r,n=this.featureAdapter,i=function(e,t){return e?t?4:3:t?3:2}(this.hasZ,this.hasM),a=e.point,s=a.x,c=a.y,o="number"==typeof e.distance?e.distance:e.distance.x,l="number"==typeof e.distance?e.distance:e.distance.y,f={candidates:[]},h="esriGeometryPolygon"===this.geometryType,p=this.getPointCreator(e.point,this.spatialReference,t),d=u(this.items);try{for(d.s();!(r=d.n()).done;){var y=r.value,m=n.getGeometry(y);if(m){var v=m.coords,g=m.lengths;if(1&e.types)for(var b=0,x=0;x<g.length;x++)for(var _=g[x],w=0;w<_;w++,b+=i){var R=v[b],O=v[b+1];if(w!==_-1){var S=v[b+i],I=v[b+i+1],j=Z(s,c,R,O,S,I),k=j.x,F=j.y,A=(s-k)/o,Q=(c-F)/l,T=A*A+Q*Q;T<=1&&f.candidates.push({type:"edge",objectId:n.getObjectId(y),distance:Math.sqrt(T),target:p(k,F),start:p(R,O),end:p(S,I)})}}if(2&e.types)for(var P=h?v.length-i:v.length,C=0;C<P;C+=i){var M=v[C],N=v[C+1],E=(s-M)/o,G=(c-N)/l,q=E*E+G*G;q<=1&&f.candidates.push({type:"vertex",objectId:n.getObjectId(y),distance:Math.sqrt(q),target:p(M,N)})}}}}catch(D){d.e(D)}finally{d.f()}return f.candidates.sort((function(e,t){return e.distance-t.distance})),f}},{key:"getPointCreator",value:function(e,t,r){var n=Object(o.k)(r)&&!Object(h.c)(t,r)?function(e){return Object(R.b)(e,t,r)}:function(e){return e};return null!=e.z&&null!=e.m?function(t,r){return n({x:t,y:r,z:e.z,m:e.m})}:null!=e.z?function(t,r){return n({x:t,y:r,z:e.z})}:null!=e.m?function(t,r){return n({x:t,y:r,m:e.m})}:function(e,t){return n({x:e,y:t})}}},{key:"executeAttributesQuery",value:function(t){var r=F(t.where,this.fieldsIndex);if(!r)return Promise.resolve(this);if(r.isStandardized){var n,i=0,a=[],s=u(this.items);try{for(s.s();!(n=s.n()).done;){var c=n.value;r.testFeature(c,this.featureAdapter)&&(a[i++]=c)}}catch(l){s.e(l)}finally{s.f()}var o=new e(a,this.queryGeometry,this);return o.definitionExpression=t.where,Promise.resolve(o)}return Promise.reject(new TypeError("Where clause is not standardized"))}},{key:"executeAggregateIdsQuery",value:function(t){if(!t.aggregateIds||!t.aggregateIds.length||Object(o.j)(this.aggregateAdapter))return Promise.resolve(this);var r,n=new Set,i=u(t.aggregateIds);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.aggregateAdapter.getFeatureObjectIds(a).forEach((function(e){return n.add(e)}))}}catch(c){i.e(c)}finally{i.f()}var s=this.featureAdapter.getObjectId;return Promise.resolve(new e(this.items.filter((function(e){return n.has(s(e))})),this.queryGeometry,this))}},{key:"executeObjectIdsQuery",value:function(t){if(!t.objectIds||!t.objectIds.length)return Promise.resolve(this);var r=new Set(t.objectIds),n=this.featureAdapter.getObjectId;return Promise.resolve(new e(this.items.filter((function(e){return r.has(n(e))})),this.queryGeometry,this))}},{key:"executeTimeQuery",value:function(t){var r=Object(M.b)(this.timeInfo,t.timeExtent,this.featureAdapter);if(!Object(o.k)(r))return Promise.resolve(this);var n=this.items.filter(r);return Promise.resolve(new e(n,this.queryGeometry,this))}},{key:"filterLatest",value:function(){var t,r=this.timeInfo,n=r.trackIdField,i=r.startTimeField,a=r.endTimeField||i,s=new Map,c=this.featureAdapter.getAttribute,o=u(this.items);try{for(o.s();!(t=o.n()).done;){var l=t.value,f=c(l,n),h=c(l,a),p=s.get(f);(!p||h>c(p,a))&&s.set(f,l)}}catch(y){o.e(y)}finally{o.f()}var d=Array.from(s.values());return Promise.resolve(new e(d,this.queryGeometry,this))}},{key:"project",value:(r=f(regeneratorRuntime.mark((function t(r){var n,i,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&!Object(h.c)(this.spatialReference,r)){t.next=2;break}return t.abrupt("return",this);case 2:return n=this.featureAdapter,t.next=5,Object(R.c)(this.items.map((function(e){return Object(P.c)(a.geometryType,a.hasZ,a.hasM,n.getGeometry(e))})),this.spatialReference,r);case 5:return i=t.sent.map((function(e,t){return n.cloneWithGeometry(a.items[t],Object(N.d)(e,a.hasZ,a.hasM))})),t.abrupt("return",new e(i,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:r,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter}));case 7:case"end":return t.stop()}}),t,this)}))),function(e){return r.apply(this,arguments)})},{key:"_sortFeatures",value:function(e,t,r){var n=this;if(e.length>1&&t&&t.length){var i,a=u(t.reverse());try{var s=function(){var t=i.value.split(" "),a=t[0],s=n.fieldsIndex.get(a),u=t[1]&&"desc"===t[1].toLowerCase();e.sort((function(e,t){return z(r(e,a,s),r(t,a,s),s,u)}))};for(a.s();!(i=a.n()).done;)s()}catch(c){a.e(c)}finally{a.f()}}}},{key:"_createFeatureQueryResponse",value:function(e){var t=this,r=this.items,i=this.geometryType,a=this.hasM,s=this.hasZ,u=this.objectIdField,c=this.spatialReference,o=e.outFields,l=e.outSR,f=e.quantizationParameters,h=e.resultRecordCount,p=e.resultOffset,d=e.returnZ,y=e.returnM,m=null!=h&&r.length>(p||0)+h,v=o&&(o.indexOf("*")>-1?n(this.fieldsIndex.fields):o.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:m,features:this._createFeatures(e,r),fields:v,geometryType:i,hasM:a&&y,hasZ:s&&d,objectIdFieldName:u,spatialReference:Object(P.b)(l||c),transform:f&&Object(E.c)(f)||null}}},{key:"_createFeatures",value:function(e,t){var r=new G(e,this.featureAdapter,this.fieldsIndex),i=this.hasM,a=this.hasZ,s=e.orderByFields,c=e.quantizationParameters,o=e.returnGeometry,l=e.returnCentroid,f=e.maxAllowableOffset,h=e.resultOffset,p=e.resultRecordCount,d=e.returnZ,y=void 0!==d&&d,m=e.returnM,v=a&&y,g=i&&(void 0!==m&&m),b=[],x=0,_=n(t);if(this._sortFeatures(_,s,(function(e,t,n){return r.getFieldValue(e,t,n)})),o||l){var w=Object(E.c)(c);if(o&&!l){var R,O=u(_);try{for(O.s();!(R=O.n()).done;){var S=R.value;b[x++]={attributes:r.getAttributes(S),geometry:Object(P.c)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(S),f,w,v,g)}}}catch(D){O.e(D)}finally{O.f()}}else if(!o&&l){var I,j=u(_);try{for(j.s();!(I=j.n()).done;){var k=I.value;b[x++]={attributes:r.getAttributes(k),centroid:Object(P.f)(this,this.featureAdapter.getCentroid(k,this),w)}}}catch(D){j.e(D)}finally{j.f()}}else{var F,A=u(_);try{for(A.s();!(F=A.n()).done;){var Q=F.value;b[x++]={attributes:r.getAttributes(Q),centroid:Object(P.f)(this,this.featureAdapter.getCentroid(Q,this),w),geometry:Object(P.c)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(Q),f,w,v,g)}}}catch(D){A.e(D)}finally{A.f()}}}else{var T,C=u(_);try{for(C.s();!(T=C.n()).done;){var M=T.value,N=r.getAttributes(M);N&&(b[x++]={attributes:N})}}catch(D){C.e(D)}finally{C.f()}}var q=h||0;return null!=p&&(b=b.slice(q,Math.min(b.length,q+p))),b}},{key:"_createExceedsLimitQueryResponse",value:function(e){var t,r=!1,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,s=u(e.outStatistics);try{for(s.s();!(t=s.n()).done;){var c=t.value;if("exceedslimit"===c.statisticType){n=null!=c.maxPointCount?c.maxPointCount:Number.POSITIVE_INFINITY,i=null!=c.maxRecordCount?c.maxRecordCount:Number.POSITIVE_INFINITY,a=null!=c.maxVertexCount?c.maxVertexCount:Number.POSITIVE_INFINITY;break}}}catch(f){s.e(f)}finally{s.f()}if("esriGeometryPoint"===this.geometryType)r=this.items.length>n;else if(this.items.length>i)r=!0;else{var o=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter;r=this.items.reduce((function(e,t){var r=l.getGeometry(t);return e+(r&&r.coords.length||0)}),0)/o>a}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(r)}}]}}},{key:"_createStatisticsQueryResponse",value:function(e){var t,r=this,n={attributes:{}},i=[],a=new Map,s=new Map,c=new Map,o=new Map,l=new G(e,this.featureAdapter,this.fieldsIndex),f=e.outStatistics,h=e.groupByFieldsForStatistics,p=e.having,d=e.orderByFields,y=h&&h.length,m=!!y,v=m&&h[0],g=m&&!this.fieldsIndex.get(v),b=u(f);try{for(b.s();!(t=b.n()).done;){var x=t.value,_=x.outStatisticFieldName,w=x.statisticType,R=x,O="exceedslimit"!==w?x.onStatisticField:void 0,S="percentile_disc"===w||"percentile_cont"===w,I=m&&1===y&&(O===v||g)&&"count"===w;if(m){if(!c.has(O)){var j,k=[],F=u(h);try{for(F.s();!(j=F.n()).done;){var A=j.value,Q=this._getAttributeValues(l,A,a);k.push(Q)}}catch(E){F.e(E)}finally{F.f()}c.set(O,this._calculateUniqueValues(k,l.returnDistinctValues))}var T=c.get(O),P=function(e){var t=T[e],n=t.count,i=t.data,s=t.items,u=t.itemPositions,c=i.join(",");if(!p||l.validateItems(s,p)){var f=o.get(c)||{attributes:{}},d=null;if(I)d=n;else{var y=r._getAttributeValues(l,O,a),m=u.map((function(e){return y[e]}));d=S&&"statisticParameters"in R?r._getPercentileValue(R,m):r._getStatisticValue(R,m)}f.attributes[_]=d,h.forEach((function(e,t){return f.attributes[r.fieldsIndex.get(e)?e:"EXPR_"+(t+1)]=i[t]})),o.set(c,f)}};for(var C in T)P(C)}else{var M=this._getAttributeValues(l,O,a);n.attributes[_]=S&&"statisticParameters"in R?this._getPercentileValue(R,M):this._getStatisticValue(R,M,s)}i.push({name:_,alias:_,type:"esriFieldTypeDouble"})}}catch(E){b.e(E)}finally{b.f()}var N=m?Array.from(o.values()):[n];return this._sortFeatures(N,d,(function(e,t){return e.attributes[t]})),{fields:i,features:N}}},{key:"_getStatisticValue",value:function(e,t,r){var n=e.onStatisticField,i=e.statisticType,a=r&&r.has(n)?r.get(n):this._calculateStatistics(t);return r&&r.set(n,a),a["var"===i?"variance":i]}},{key:"_getPercentileValue",value:function(e,t){var r=e.onStatisticField,i=e.statisticParameters,a=e.statisticType,s=i.value,u="desc"===i.orderBy,c=this.fieldsIndex.get(r),o=n(t).filter((function(e){return null!=e})).sort((function(e,t){return z(e,t,c,u)}));return this._calculatePercentile(o,s,"percentile_disc"===a)}},{key:"_getAttributeValues",value:function(e,t,r){if(r.has(t))return r.get(t);var n=this.fieldsIndex.get(t),i=this.items.map((function(r){return e.getFieldValue(r,t,n)}));return r.set(t,i),i}},{key:"_calculateStatistics",value:function(e){var t,r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=null,a=null,s=null,c=null,o=[],l=0,f=u(e);try{for(f.s();!(t=f.n()).done;){var h=t.value;"string"==typeof h?l++:null==h||isNaN(h)||(i+=h,r=Math.min(r,h),n=Math.max(n,h),o.push(h),l++)}}catch(v){f.e(v)}finally{f.f()}if(l){a=i/l;var p,d=0,y=u(o);try{for(y.s();!(p=y.n()).done;){var m=p.value;d+=Math.pow(m-a,2)}}catch(v){y.e(v)}finally{y.f()}c=l>1?d/(l-1):0,s=Math.sqrt(c)}else r=null,n=null;return{avg:a,count:l,max:n,min:r,stddev:s,sum:i,variance:c}}},{key:"_calculateUniqueValues",value:function(e,t){for(var r={},n=this.items,i=n.length,a=0;a<i;a++){var s,c=n[a],o=[],l=u(e);try{for(l.s();!(s=l.n()).done;){var f=s.value;o.push(f[a])}}catch(p){l.e(p)}finally{l.f()}var h=o.join(",");t?null==r[h]&&(r[h]={count:1,data:o,items:[c],itemPositions:[a]}):null==r[h]?r[h]={count:1,data:o,items:[c],itemPositions:[a]}:(r[h].count++,r[h].items.push(c),r[h].itemPositions.push(a))}return r}},{key:"_calculatePercentile",value:function(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];var n=(e.length-1)*t,i=Math.floor(n),a=i+1,s=n%1,u=e[i],c=e[a];return a>=e.length||r||"string"==typeof u||"string"==typeof c?u:u*(1-s)+c*s}}]),e}(),U="feature-store:unsupported-query",L=new Set,H=new b.b(2e6),Y=0,K=Object(w.d)(),J=Object(w.d)();r.a=function(){function e(t){var r=this;i(this,e),this.capabilities={query:_.a},this.geometryType=t.geometryType,this.hasM=t.hasM,this.hasZ=t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(function(){return r.clearCache()})),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new b.a(Y+++"$$",H)),this.fieldsIndex=new x.a(t.fields),t.scheduler&&t.task&&(this._frameQueue=new v.a,this._frameTask=t.scheduler.registerTask(t.task,(function(e){return r._update(e)}),(function(){return r._frameQueue.length>0})))}var r,n,a,O,S,k,F,Q,N,E,G,q,D;return s(e,[{key:"destroy",value:function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()}},{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:Object(P.b)(this.spatialReference)}:null}},{key:"timeExtent",get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=Object(M.a)(this.timeInfo,this.featureStore)),this._timeExtent):null}},{key:"clearCache",value:function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null}},{key:"executeQuery",value:(D=f(regeneratorRuntime.mark((function e(){var t,r,n,i,a=this,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1?s[1]:void 0,i=Object(c.a)(t),e.prev=3,e.next=6,this._schedule((function(){return Object(P.d)(i,a.definitionExpression,a.spatialReference)}),r);case 6:return i=e.sent,e.next=9,this._reschedule((function(){return a._checkQuerySupport(i)}),r);case 9:return i=e.sent,e.next=12,this._reschedule((function(){return a._executeGeometryQuery(i,r)}),r);case 12:return n=e.sent,e.next=15,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 15:return n=e.sent,e.next=18,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 18:return n=e.sent,e.next=21,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 21:return n=e.sent,e.next=24,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 24:n=e.sent,e.next=32;break;case 27:if(e.prev=27,e.t0=e.catch(3),e.t0===P.a){e.next=31;break}throw e.t0;case 31:n=new B([],null,this);case 32:return e.abrupt("return",n.createQueryResponse(i));case 33:case"end":return e.stop()}}),e,this,[[3,27]])}))),function(){return D.apply(this,arguments)})},{key:"executeQueryForCount",value:(q=f(regeneratorRuntime.mark((function e(){var t,r,n,i,a=this,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1?s[1]:void 0,(i=Object(c.a)(t)).returnGeometry=!1,i.returnCentroid=!1,i.outSR=null,e.prev=4,e.next=7,this._schedule((function(){return Object(P.d)(i,a.definitionExpression,a.spatialReference)}),r);case 7:return i=e.sent,e.next=10,this._reschedule((function(){return a._checkQuerySupport(i)}),r);case 10:return i=e.sent,e.next=13,this._reschedule((function(){return a._executeGeometryQuery(i,r)}),r);case 13:return n=e.sent,e.next=16,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 16:return n=e.sent,e.next=19,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 19:return n=e.sent,e.next=22,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 22:return n=e.sent,e.next=25,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 25:n=e.sent,e.next=33;break;case 28:if(e.prev=28,e.t0=e.catch(4),e.t0===P.a){e.next=32;break}throw e.t0;case 32:return e.abrupt("return",0);case 33:return e.abrupt("return",n.createQueryResponseForCount(i));case 34:case"end":return e.stop()}}),e,this,[[4,28]])}))),function(){return q.apply(this,arguments)})},{key:"executeQueryForExtent",value:(G=f(regeneratorRuntime.mark((function e(){var t,r,n,i,a,s,u,o,l,f,h,p=this,d=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]?d[0]:{},r=d.length>1?d[1]:void 0,i=Object(c.a)(t),a=i.outSR,e.prev=4,e.next=7,this._schedule((function(){return Object(P.d)(i,p.definitionExpression,p.spatialReference)}),r);case 7:return i=e.sent,e.next=10,this._reschedule((function(){return p._checkQuerySupport(i)}),r);case 10:return(i=e.sent).returnGeometry=!0,i.returnCentroid=!1,i.outSR=null,e.next=16,this._reschedule((function(){return p._executeGeometryQuery(i,r)}),r);case 16:return n=e.sent,e.next=19,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 19:return n=e.sent,e.next=22,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 22:return n=e.sent,e.next=25,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 25:return n=e.sent,e.next=28,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 28:if(n=e.sent,s=n.size){e.next=32;break}return e.abrupt("return",{count:s,extent:null});case 32:return Object(w.q)(J,w.a),this.featureStore.forEachBounds(n.items,(function(e){return Object(w.g)(J,e)}),K),u={xmin:J[0],ymin:J[1],xmax:J[3],ymax:J[4],spatialReference:Object(P.b)(this.spatialReference)},this.hasZ&&isFinite(J[2])&&isFinite(J[5])&&(u.zmin=J[2],u.zmax=J[5]),(o=Object(R.b)(u,n.spatialReference,a)).spatialReference=Object(P.b)(a||this.spatialReference),o.xmax-o.xmin==0&&(l=Object(y.f)(o.spatialReference),o.xmin-=l,o.xmax+=l),o.ymax-o.ymin==0&&(f=Object(y.f)(o.spatialReference),o.ymin-=f,o.ymax+=f),this.hasZ&&null!=o.zmin&&null!=o.zmax&&o.zmax-o.zmin==0&&(h=Object(y.f)(o.spatialReference),o.zmin-=h,o.zmax+=h),e.abrupt("return",{count:s,extent:o});case 42:if(e.prev=42,e.t0=e.catch(4),e.t0!==P.a){e.next=46;break}return e.abrupt("return",{count:0,extent:null});case 46:throw e.t0;case 47:case"end":return e.stop()}}),e,this,[[4,42]])}))),function(){return G.apply(this,arguments)})},{key:"executeQueryForIds",value:(E=f(regeneratorRuntime.mark((function e(){var t,r,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1?n[1]:void 0,e.abrupt("return",this.executeQueryForIdSet(t,r).then((function(e){return Array.from(e)})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"executeQueryForIdSet",value:(N=f(regeneratorRuntime.mark((function e(){var t,r,n,i,a,s,o=this,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:{},r=l.length>1?l[1]:void 0,(i=Object(c.a)(t)).returnGeometry=!1,i.returnCentroid=!1,i.outSR=null,e.prev=4,e.next=7,this._schedule((function(){return Object(P.d)(i,o.definitionExpression,o.spatialReference)}),r);case 7:return i=e.sent,e.next=10,this._reschedule((function(){return o._checkQuerySupport(i)}),r);case 10:return i=e.sent,e.next=13,this._reschedule((function(){return o._executeGeometryQuery(i,r)}),r);case 13:return n=e.sent,e.next=16,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 16:return n=e.sent,e.next=19,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 19:return n=e.sent,e.next=22,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 22:return n=e.sent,e.next=25,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 25:return n=e.sent,a=n.items,s=new Set,e.next=29,this._reschedule((function(){var e,t=u(a);try{for(t.s();!(e=t.n()).done;){var r=e.value;s.add(n.featureAdapter.getObjectId(r))}}catch(i){t.e(i)}finally{t.f()}}),r);case 29:return e.abrupt("return",s);case 32:if(e.prev=32,e.t0=e.catch(4),e.t0!==P.a){e.next=36;break}return e.abrupt("return",new Set);case 36:throw e.t0;case 37:case"end":return e.stop()}}),e,this,[[4,32]])}))),function(){return N.apply(this,arguments)})},{key:"executeQueryForSnapping",value:(Q=f(regeneratorRuntime.mark((function e(r,n){var i,a,s,u,c,l,f,p,y,m,v,b,x,_,w=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.point,a=r.distance,0!==r.types){e.next=3;break}return e.abrupt("return",{candidates:[]});case 3:return e.next=5,this._reschedule((function(){return w._checkQuerySupport(r.query)}),n);case 5:if(s=e.sent,u=!Object(h.c)(i.spatialReference,this.spatialReference),e.t0=u,!e.t0){e.next=11;break}return e.next=11,Object(R.a)(i.spatialReference,this.spatialReference);case 11:if(c="number"==typeof a?a:a.x,l="number"==typeof a?a:a.y,f={xmin:i.x-c,xmax:i.x+c,ymin:i.y-l,ymax:i.y+l,spatialReference:i.spatialReference},p=u?Object(R.b)(f,this.spatialReference):f){e.next=14;break}return e.abrupt("return",{candidates:[]});case 14:return e.next=16,Object(g.a)(Object(d.a)(i),null,{signal:n});case 16:return y=e.sent[0],e.next=19,Object(g.a)(Object(d.a)(p),null,{signal:n});case 19:if(m=e.sent[0],!Object(o.j)(y)&&!Object(o.j)(m)){e.next=22;break}return e.abrupt("return",{candidates:[]});case 22:return v=new B(this._searchFeatures(this._getQueryBBoxes(m.toJSON())),null,this),e.next=25,this._reschedule((function(){return v.executeObjectIdsQuery(s)}),n);case 25:return v=e.sent,e.next=28,this._reschedule((function(){return v.executeTimeQuery(s)}),n);case 28:return v=e.sent,e.next=31,this._reschedule((function(){return v.executeAttributesQuery(s)}),n);case 31:return v=e.sent,b=y.toJSON(),x=u?Object(R.b)(b,this.spatialReference):b,_=u?Math.max(p.xmax-p.xmin,p.ymax-p.ymin)/2:a,e.abrupt("return",v.createSnappingResponse(t(t({},r),{},{point:x,distance:_}),i.spatialReference));case 34:case"end":return e.stop()}}),e,this)}))),function(e,t){return Q.apply(this,arguments)})},{key:"executeQueryForLatestObservations",value:(F=f(regeneratorRuntime.mark((function e(){var t,r,n,i,a=this,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1?s[1]:void 0,this.timeInfo&&this.timeInfo.trackIdField){e.next=4;break}throw new l.a(U,"Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:this.timeInfo});case 4:return i=Object(c.a)(t),e.prev=5,e.next=8,this._schedule((function(){return Object(P.d)(i,a.definitionExpression,a.spatialReference)}),r);case 8:return i=e.sent,e.next=11,this._reschedule((function(){return a._checkQuerySupport(i)}),r);case 11:return i=e.sent,e.next=14,this._reschedule((function(){return a._executeGeometryQuery(i,r)}),r);case 14:return n=e.sent,e.next=17,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 17:return n=e.sent,e.next=20,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 20:return n=e.sent,e.next=23,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 23:return n=e.sent,e.next=26,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 26:return n=e.sent,e.next=29,this._reschedule((function(){return n.filterLatest()}),r);case 29:n=e.sent,e.next=37;break;case 32:if(e.prev=32,e.t0=e.catch(5),e.t0===P.a){e.next=36;break}throw e.t0;case 36:n=new B([],null,this);case 37:return e.abrupt("return",n.createQueryResponse(i));case 38:case"end":return e.stop()}}),e,this,[[5,32]])}))),function(){return F.apply(this,arguments)})},{key:"_schedule",value:(k=f(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._frameQueue?this._frameQueue.push(t,r):t());case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"_reschedule",value:(S=f(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._frameQueue?this._frameQueue.unshift(t,r):t());case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"_update",value:function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null}},{key:"_getAll",value:function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new B(e,null,this)}return this._allItems}},{key:"_executeGeometryQuery",value:(O=f(regeneratorRuntime.mark((function e(t,r){var n,i,a,s,c,l,p,d,y,m,v,g,b,x,_,w,R,O,S,I,j,k,F=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.geometry,i=t.outSR,a=t.spatialRel,s=t.returnGeometry,c=t.returnCentroid,l=s||c,p=Object(h.i)(i)&&!Object(h.c)(this.spatialReference,i),!(d=this._geometryQueryCache?p&&l?JSON.stringify({geometry:n,spatialRelationship:a,outSpatialReference:i}):JSON.stringify({geometry:n,spatialRelationship:a}):null)){e.next=5;break}if(y=this._geometryQueryCache.get(d),Object(o.l)(y)){e.next=5;break}return e.abrupt("return",y);case 5:if(m=function(){var e=f(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p||!l){e.next=5;break}return e.next=3,t.project(i);case 3:return r=e.sent,e.abrupt("return",(d&&F._geometryQueryCache.put(d,r,r.size||1),r));case 5:return e.abrupt("return",(d&&F._geometryQueryCache.put(d,t,t.size||1),t));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n){e.next=8;break}return e.abrupt("return",m(this._getAll()));case 8:if(v=this.featureAdapter,"esriSpatialRelDisjoint"!==a){e.next=23;break}if((g=this._searchFeatures(this._getQueryBBoxes(n))).length){e.next=13;break}return e.abrupt("return",m(this._getAll()));case 13:_=new Set,w=u(g);try{for(w.s();!(R=w.n()).done;)O=R.value,_.add(v.getObjectId(O))}catch(A){w.e(A)}finally{w.f()}return e.next=18,this._reschedule((function(){var e=0;b=new Array(_.size),F.featureStore.forEach((function(t){return b[e++]=t})),x=_}),r);case 18:return e.t0=m,e.next=21,this._reschedule(f(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(C.c)(a,n,F.geometryType,F.hasZ,F.hasM);case 2:return t=e.sent,e.t0=B,e.next=6,F._runSpatialFilter(b,(function(e){return!x.has(v.getObjectId(e))||t(v.getGeometry(e))}),r);case 6:return e.t1=e.sent,e.t2=n,e.t3=F,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3));case 10:case"end":return e.stop()}}),e)}))),r);case 21:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 23:if((S=this._searchFeatures(this._getQueryBBoxes(n))).length){e.next=27;break}return I=new B([],n,this),e.abrupt("return",(d&&this._geometryQueryCache.put(d,I,I.size||1),I));case 27:if(!this._canExecuteSoloPass(n,t)){e.next=29;break}return e.abrupt("return",m(new B(S,n,this)));case 29:return e.next=31,Object(C.c)(a,n,this.geometryType,this.hasZ,this.hasM);case 31:return j=e.sent,e.next=34,this._runSpatialFilter(S,(function(e){return j(v.getGeometry(e))}),r);case 34:return k=e.sent,e.abrupt("return",m(new B(k,n,this)));case 36:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"_runSpatialFilter",value:(a=f(regeneratorRuntime.mark((function e(t,r,n){var i,a,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t);case 2:if(this._budget){e.next=4;break}return e.abrupt("return",t.filter((function(e){return r(e)})));case 4:return i=0,a=new Array,s=function(){var e=f(regeneratorRuntime.mark((function e(){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i<t.length)){e.next=10;break}if(c=t[i],r(c)&&a.push(c),e.t0=u._budget.done,!e.t0){e.next=7;break}return e.next=7,u._reschedule((function(){return s()}),n);case 7:++i;case 8:e.next=0;break;case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this._reschedule((function(){return s()}),n).then((function(){return a})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return a.apply(this,arguments)})},{key:"_canExecuteSoloPass",value:function(e,t){var r=this.geometryType,n=t.spatialRel;return Object(C.a)(e)&&("esriSpatialRelEnvelopeIntersects"===n||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===n||"esriSpatialRelContains"===n||"esriSpatialRelWithin"===n))}},{key:"_getQueryBBoxes",value:function(e){if(Object(C.a)(e)){if(Object(d.d)(e))return[Object(m.l)(e.xmin,e.ymin,e.xmax,e.ymax)];if(Object(d.g)(e))return e.rings.map((function(e){return Object(m.l)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[Object(p.a)(Object(m.g)(),e)]}},{key:"_searchFeatures",value:function(e){var t,r=u(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.featureStore.forEachInBounds(n,(function(e){L.add(e)}))}}catch(s){r.e(s)}finally{r.f()}var i=new Array(L.size),a=0;return L.forEach((function(e){return i[a++]=e})),L.clear(),i}},{key:"_checkQuerySupport",value:(n=f(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text)){e.next=2;break}throw new l.a(U,"Unsupported query options",{query:t});case 2:return e.abrupt("return",Promise.all([this._checkAttributesQuerySupport(t),this._checkStatisticsQuerySupport(t),Object(C.b)(t,this.geometryType,this.spatialReference),Object(R.a)(this.spatialReference,t.outSR)]).then((function(){return t})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_checkAttributesQuerySupport",value:function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,i=e.outStatistics,a=i?i.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})):[];if(r&&r.length>0){var s=" asc",u=" desc",c=r.map((function(e){var t=e.toLowerCase();return t.indexOf(s)>-1?t.split(s)[0]:t.indexOf(u)>-1?t.split(u)[0]:e})).filter((function(e){return-1===a.indexOf(e)}));A(this.fieldsIndex,c,"orderByFields contains missing fields")}if(t&&t.length>0)A(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new l.a(U,"outFields should be specified for returnDistinctValues",{query:e});!function(e,t){if(!t)return!0;var r=I.get(t,e);if(!r)throw new l.a(j,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new l.a(j,"where clause is not standard",{where:t});A(e,r.fieldNames,"where clause contains missing fields")}(this.fieldsIndex,e.where)}},{key:"_checkStatisticsQuerySupport",value:(r=f(regeneratorRuntime.mark((function e(t){var r,n,i,a,s,c,o,f,h,p,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.outStatistics,n=t.groupByFieldsForStatistics,i=t.having,a=n&&n.length,s=r&&r.length,!i){e.next=5;break}if(a&&s){e.next=4;break}throw new l.a(U,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:t});case 4:!function(e,t,r){if(!t)return!0;var n=I.get(t,e);if(!n)throw new l.a(j,"invalid SQL expression",{having:t});if(!n.isAggregate)throw new l.a(j,"having does not contain a valid aggregate function",{having:t});if(A(e,n.fieldNames,"having contains missing fields"),!n.getExpressions().every((function(t){var n=t.aggregateType,i=t.field,a=e.has(i)&&e.get(i).name;return r.some((function(t){var r=t.onStatisticField,i=t.statisticType;return(e.has(r)&&e.get(r).name)===a&&i.toLowerCase().trim()===n}))})))throw new l.a(j,"expressions in having should also exist in outStatistics",{having:t})}(this.fieldsIndex,i,r);case 5:if(!s){e.next=34;break}if(function(e){return e.every((function(e){return"exceedslimit"!==e.statisticType}))}(r)){e.next=8;break}return e.abrupt("return");case 8:c=r.map((function(e){return e.onStatisticField})),A(this.fieldsIndex,c,"onStatisticFields contains missing fields"),a&&A(this.fieldsIndex,n,"groupByFieldsForStatistics contains missing fields"),o=u(r),e.prev=11,o.s();case 13:if((f=o.n()).done){e.next=26;break}if(h=f.value,p=h.onStatisticField,("percentile_disc"===(d=h.statisticType)||"percentile_cont"===d)&&"statisticParameters"in h){e.next=21;break}if("count"===d||!p||!T(p,this.fieldsIndex)){e.next=19;break}throw new l.a(U,"outStatistics contains non-numeric fields",{definition:h,query:t});case 19:e.next=24;break;case 21:if(h.statisticParameters){e.next=24;break}throw new l.a(U,"statisticParamters should be set for percentile type",{definition:h,query:t});case 24:e.next=13;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(11),o.e(e.t0);case 31:return e.prev=31,o.f(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[11,28,31,34]])}))),function(e){return r.apply(this,arguments)})}]),e}()},q7ja:function(e,t,r){"use strict";function n(e,t){if(!e)return null;var r=t.featureAdapter,n=e.startTimeField,i=e.endTimeField,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((function(e){var t=r.getAttribute(e,n),u=r.getAttribute(e,i);null==t||isNaN(t)||(a=Math.min(a,t)),null==u||isNaN(u)||(s=Math.max(s,u))}));else{var u=n||i;t.forEach((function(e){var t=r.getAttribute(e,u);null==t||isNaN(t)||(a=Math.min(a,t),s=Math.max(s,t))}))}return{start:a,end:s}}function i(e,t,r){if(!t||!e)return null;var n=e.startTimeField,i=e.endTimeField;if(!n&&!i)return null;var a=t.start,s=t.end;return null===a&&null===s?null:void 0===a&&void 0===s?function(){return!1}:n&&i?function(e,t,r,n,i){return null!=n&&null!=i?function(a){var s=e.getAttribute(a,t),u=e.getAttribute(a,r);return(null==s||s<=i)&&(null==u||u>=n)}:null!=n?function(t){var i=e.getAttribute(t,r);return null==i||i>=n}:null!=i?function(r){var n=e.getAttribute(r,t);return null==n||n<=i}:void 0}(r,n,i,a,s):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(i){var a=e.getAttribute(i,t);return a>=r&&a<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||i,a,s)}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}))},qUyK:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}}])}();