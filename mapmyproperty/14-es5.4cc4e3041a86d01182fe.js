!function(){var e,t,a,i,n,r,o,s,l,c,u;function h(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t,a){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach(function(t){f(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function f(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function g(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=b(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw r}}}}function b(e,t){if(e){if("string"==typeof e)return m(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var a,i=w(e);if(t){var n=w(this).constructor;a=Reflect.construct(i,arguments,n)}else a=i.apply(this,arguments);return _(this,a)}}function _(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?M(e):t}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function x(e,t,a){return t&&k(e.prototype,t),a&&k(e,a),e}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(window.webpackJsonp=window.webpackJsonp||[]).push([[14,74],{"6UvW":function(e,t,a){"use strict";a.d(t,"a",function(){return s}),a.d(t,"b",function(){return l});var i=a("srIe"),n=a("OvF4"),r=(a("4GrV"),a("gEht")),o=a("U282");function s(e,t,a){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.a;if("2d"===a.type)o=t*a.resolution;else if("3d"===a.type){var l=a.overlayPixelSizeInMapUnits(e),c=a.basemapSpatialReference;o=Object(i.k)(c)&&!c.equals(a.spatialReference)?Object(r.f)(c)/Object(r.f)(a.spatialReference):t*l}var u=e.x-o,h=e.y-o,p=e.x+o,d=e.y+o,v=a.spatialReference;return s.xmin=Math.min(u,p),s.ymin=Math.min(h,d),s.xmax=Math.max(u,p),s.ymax=Math.max(h,d),s.spatialReference=v,s}function l(e,t,a){var n=a.toMap(e);return!Object(i.j)(n)&&s(n,Object(o.a)(),a,c).intersects(t)}var c=new n.a},"89mX":function(i,n,r){"use strict";r.d(n,"a",function(){return f}),r.d(n,"b",function(){return v});var o=r("OIYi"),s=r("Tbkp"),l=r("aQrP"),c=r("Q3fD"),u=r("0nJL"),h=r("0Ect"),p=r("69UF"),d=r("xtdb");function v(i){var n=new l.a;return n.include(s.a,{linearDepth:!1}),n.vertex.uniforms.add("proj","mat4").add("view","mat4"),n.attributes.add("position","vec3"),n.attributes.add("uv0","vec2"),n.varyings.add("vpos","vec3"),i.multipassTerrainEnabled&&n.varyings.add("depth","float"),n.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),n.vertex.code.add(o.a(e||(e=P(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])),i.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"")),n.include(u.a,i),i.multipassTerrainEnabled&&(n.fragment.include(h.a),n.include(d.b,i)),n.fragment.uniforms.add("tex","sampler2D"),n.fragment.uniforms.add("opacity","float"),n.varyings.add("vTexCoord","vec2"),7===i.output?n.fragment.code.add(o.a(t||(t=P(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ",") {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    "])),i.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",o.a.float(p.b))):(n.fragment.include(c.a),n.fragment.code.add(o.a(a||(a=P(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ","\n    }\n    "])),i.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",o.a.float(p.b),i.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),n}var f=Object.freeze({__proto__:null,build:v})},Q44q:function(e,t,a){"use strict";a.r(t),a.d(t,"DrawOperation",function(){return i.a}),a.d(t,"DrawGraphicTool",function(){return Ge}),a.d(t,"GraphicMoveTool",function(){return Dt}),a.d(t,"GraphicReshapeTool",function(){return qt}),a.d(t,"GraphicTransformTool",function(){return ta}),a.d(t,"ExtentTransformTool",function(){return zi});var i=a("ZGlk"),n=a("pO5D"),r=a("wSAH"),o=a("srIe"),s=a("6S2I"),l=a("zqDF"),c=a("WbKI"),u=a("04ZG"),d=(a("4EHJ"),a("ju1D"),a("9AIY"),a("zm0L")),f=a("jWBI"),b=a("N5XI"),m=a("kJYu"),O=a("zgsL"),_=a("9AiD"),k=a("Alwt"),P=a("R3Kl"),E=a("pUVe"),A=a("nvBr"),D=a("0ynT"),G=a("D8Ta"),R=a("NUQ5"),C={main:new A.a([255,127,0]),selected:new A.a([255,255,255]),staged:new A.a([12,207,255]),outline:new A.a([0,0,0,.5]),selectedOutline:new A.a([255,255,255])};function T(e,t){var a=e.clone();return a.a*=t,a}function I(e,t){var a=e.clone(),i=Object(D.b)(a);i.s*=t;var n=Object(D.e)(i);return a.r=n.r,a.g=n.g,a.b=n.b,a}function V(e,t){if(t)for(var a in t)e[a]=t[a]}var z=function e(t){S(this,e),this.color=C.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,V(this,t)},H=function(){function e(t){S(this,e),this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=C.main,this.outlineColor=C.outline,this.renderOccluded=16,this.hoverOutlineColor=C.selectedOutline,V(this,t)}return x(e,[{key:"apply",value:function(e,t){var a=this[e];t.setParameterValues({color:Y(a),transparent:"color"!==e||a.a<1,renderOccluded:this.renderOccluded})}}]),e}(),B=function e(t){S(this,e),this.vertex=new H({color:C.main,outlineColor:C.outline}),this.edge=new H({color:I(T(C.main,2/3),.5),outlineColor:T(C.outline,.5),size:8,collisionPadding:8}),this.selected=new H({color:C.selected,outlineColor:C.outline}),V(this,t)},F=function(){function e(t){S(this,e),this.color=C.selected,this.width=1.5,this.stipplePattern=Object(R.b)([5,5]),this.stippleOffColor=C.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=C.selected,this.renderOccluded=4,V(this,t)}return x(e,[{key:"apply",value:function(e){e.color=Y(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=Y(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=Y(this.innerColor),e.renderOccluded=this.renderOccluded}}]),e}(),U=function(){function e(t){S(this,e),this.color=C.selected,this.size=4,this.outlineSize=1,this.outlineColor=C.outline,this.shape="square",V(this,t)}return x(e,[{key:"apply",value:function(e){e.color=Y(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=Y(this.outlineColor),e.primitive=this.shape}}]),e}(),q=function(){function e(t){S(this,e),this.innerColor=C.selected,this.innerWidth=1,this.glowColor=C.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=C.main,V(this,t)}return x(e,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a={glowColor:A.a.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:A.a.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=a:e.laserlineStyle=a}}]),e}(),L=function e(t){S(this,e),this.outline=new F({color:C.outline,renderOccluded:8,stippleOffColor:C.selected,stipplePattern:Object(R.b)([5,5]),width:1.5,innerWidth:0}),this.staged=new F({color:C.selected,renderOccluded:8,innerColor:C.staged,stippleOffColor:C.outline,stipplePattern:Object(R.b)([5,5]),width:1.5}),this.shadowStyle=new q({globalAlpha:.3,glowColor:C.main,glowFalloff:8,glowWidth:8,innerColor:C.selected,innerWidth:1}),V(this,t)},Z=function e(t){S(this,e),this.outline=new U({color:C.selected,outlineColor:C.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new q({globalAlpha:.3,glowColor:C.main,glowFalloff:1.5,glowWidth:6,innerColor:C.selected,innerWidth:1,radius:2}),V(this,t)},N=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this)).extensionType=2,V(M(i),e),i}return a}(F),W=function e(t){S(this,e),this.lineGraphics=new L,this.pointGraphics=new Z,this.heightPlane=new q({globalAlpha:.3,glowColor:C.main,glowFalloff:8,glowWidth:8,innerColor:C.selected,innerWidth:1}),this.heightBox=new q({globalAlpha:.3,glowColor:C.main,glowFalloff:8,glowWidth:8,innerColor:C.selected,innerWidth:0,heightFillColor:C.main}),this.zVerticalLine=new N({color:T(C.main,.5),falloff:2,innerColor:T(C.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,V(this,t)};function Y(e){return Object(G.g)(A.a.toUnitRGBA(e))}var X=new(function(){function e(t){S(this,e),this.visualElements=new W,this.reshapeManipulators=new B,this.zManipulator=new z,V(this,t)}return x(e,[{key:"colorToVec4",value:function(e){return Y(e)}}]),e}()),K=a("Cy1f"),Q=a("5DEt"),J=a("gYg2"),$=a("dXfX"),ee=a("QmHG"),te=a("XvKw"),ae=a("GlSV"),ie=a("EDiM"),ne=a("Drlb"),re=a("hrr/"),oe=a("aAs6"),se=a("15Hh"),le=a("r+FG"),ce=a("vqnv"),ue=a("tiP8"),he=function(){function e(t,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0;S(this,e),this.data=t,this.material=a,this.layerUid=i,this.graphicUid=n,this.boundingSphere=Object(G.c)(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this.shaderTransformationDirty=!0,this.boundingInfo=r,this.material=a,this.origin=null,this.transformation=null,this.calculateShaderTransformation=s,o&&this.updateTransformation(o,l),this.castShadow=c}return x(e,[{key:"updateTransformation",value:function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.computeBoundingSphere(e,t,this.boundingSphere)}},{key:"shaderTransformationChanged",value:function(){this.shaderTransformationDirty=!0}},{key:"computeBoundingSphere",value:function(e,t,a){Object(o.j)(this.boundingInfo)||(t=t||Object(oe.f)(e),Object(Q.l)(a,this.boundingInfo.getCenter(),e),a[3]=this.boundingInfo.getBSRadius()*t)}},{key:"hasShaderTransformation",get:function(){return Object(o.k)(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"getShaderTransformation",value:function(){return Object(o.j)(this.calculateShaderTransformation)?Object(o.r)(this.transformation,le.a):(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=Object(le.b)()),Object(se.c)(this.shaderTransformation,this.calculateShaderTransformation(Object(o.r)(this.transformation,le.a))),this.shaderTransformationDirty=!1),this.shaderTransformation)}},{key:"computeAttachmentOrigin",value:function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(o.k)(this.transformation)&&Object(Q.l)(e,e,this.transformation),!0);var t=this.indices.get("position"),a=this.vertexAttributes.get("position");return!!Object(ie.c)(a,t,e)&&(Object(o.k)(this.transformation)&&Object(Q.l)(e,e,this.transformation),!0)}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}},{key:"addHighlight",value:function(){var e=new ce.a(0),t=this.instanceParameters;return t.highlights=Object(ue.b)(t.highlights,e),e}},{key:"removeHighlight",value:function(e){var t=this.instanceParameters;t.highlights=Object(ue.f)(t.highlights,e)}}]),e}(),pe=a("1AhW"),de=a("ZHv2"),ve=a("3WMd"),fe=a("/CmD"),ge=a("pdg3"),be=function(){function e(t){S(this,e),this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}return x(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"resources",get:function(){return Object(o.k)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){this.resourceFactory.recreateGeometry?Object(o.j)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?Object(o.j)(this._resources)&&this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){var e;this._destroyResources();var t=this.resourceFactory.createResources();this._resources={layerView:new me({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();var a=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;a&&a.registerDrapeSource(this._resources.layerView)}},{key:"_destroyResources",value:function(){var e;if(!Object(o.j)(this._resources)){this.ensureRenderGeometriesRemoved();var t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}}},{key:"_syncGeometriesToRenderer",value:function(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}},{key:"ensureRenderGeometriesRemoved",value:function(){var e;!Object(o.j)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}},{key:"ensureRenderGeometriesAdded",value:function(){Object(o.j)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}]),e}(),me=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e)).drapeSourceType=1,i}return a}(Object(ge.a)(fe.a));Object(n.a)([Object(c.b)({constructOnly:!0})],me.prototype,"view",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],me.prototype,"drapeSourceType",void 0),me=Object(n.a)([Object(u.a)("DrapedVisualElementLayerView")],me);var ye=function(){function e(t){var a=this;S(this,e),this.view=null,this._attachmentOrigin=Object(ae.d)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new d.a,this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(te.c)(1,0,1,1),this._innerWidth=0,this._innerColor=Object(te.c)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new ve.a({view:t.view,createResources:function(e){return a.createResources(e)},recreateGeometry:function(e,t){return e.geometries.length=0,a.recreateGeometry(t,e.material,e.geometries),e.geometries}}),this._attachmentOrigin.spatialReference=t.view.spatialReference,this.drapedResources=new be({view:t.view,createResources:function(){return a.createDrapedResources()},recreateGeometry:function(e){e.geometries=a.createRenderGeometriesDraped(e.material),a.attachmentOriginChanged()}});var i=!0;for(var n in this._laserline=new de.a({view:t.view}),t)n in this?"attached"===n?i=t[n]:this[n]=t[n]:console.error("Cannot set unknown property",n);this.attached=i}return x(e,[{key:"destroy",value:function(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}},{key:"isDraped",get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}},{key:"laserlineAttached",get:function(){return this.attached&&this.visible&&Object(o.k)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}},{key:"visible",get:function(){return this.resources.visible},set:function(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}},{key:"attached",get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this.updateAttached(e)}},{key:"updateAttached",value:function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object($.g)(e,this._color)||(Object($.c)(this._color,e),this.updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){Object($.g)(e,this._innerColor)||(Object($.c)(this._innerColor,e),this.updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=Object(o.k)(e)!==Object(o.k)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&Object($.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(te.a)(e):null,this.updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(o.k)(e)&&(this._laserline.style=e)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"attachmentOrigin",get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=Object(o.k)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(Q.v)(_e,0,0,0);var t,a=0,i=g(e);try{for(i.s();!(t=i.n()).done;){var n=t.value,r=n.vertexAttributes.get("position"),s=n.indices.get("position"),l=Object(o.q)(this.resources.resources).material.isClosed(r.data,s);Object(ie.a)(r,s,l,je)&&(Object(Q.e)(_e,_e,je),a++)}}catch(c){i.e(c)}finally{i.f()}return 0===a?null:(Object(Q.d)(_e,_e,1/a),this.view.renderCoordsHelper.fromRenderCoords(_e,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}},{key:"updateMaterial",value:function(){Object(o.k)(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),Object(o.k)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}},{key:"isClosed",get:function(){return Object(o.k)(this.geometry)&&"polygon"===this.geometry.type}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}},{key:"normalizedRenderOccluded",get:function(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}},{key:"recreateGeometry",value:function(e,t,a){var i,n=g(this.createRenderGeometries());try{for(n.s();!(i=n.n()).done;){var r=i.value;e.addGeometry(r,t),a.push(r)}}catch(o){n.e(o)}finally{n.f()}this.attachmentOriginChanged()}},{key:"attachmentOriginChanged",value:function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}},{key:"createResources",value:function(e){var t=new re.a(this.materialParameters),a=[];return this.recreateGeometry(e,t,a),{material:t,geometries:a,forEach:function(e){e(t),a.forEach(e)}}}},{key:"createDrapedResources",value:function(){var e=new re.a(this.materialParameters);return{material:e,geometries:this.createRenderGeometriesDraped(e)}}},{key:"createRenderGeometriesDraped",value:function(e){var t=this.geometry;if(Object(o.j)(t))return[];var a,i=[],n=g(Object(pe.c)(t,this.view.basemapTerrain.spatialReference).lines);try{for(n.s();!(a=n.n()).done;){var r=a.value.position,s={attributeData:{position:r},removeDuplicateStartEnd:this.isClosed?1:0},l=new he(Object(pe.a)(s),e),c=Object(ee.e)(Oe);Object(ee.h)(c,r),Object($.l)(l.boundingSphere,.5*(c[0]+c[3]),.5*(c[1]+c[4]),0,.5*Math.sqrt((c[3]-c[0])*(c[3]-c[0])+(c[4]-c[1])*(c[4]-c[1]))),i.push(l)}}catch(u){n.e(u)}finally{n.f()}return i}},{key:"calculateMapBounds",value:function(e){if(Object(o.j)(this.resources.resources))return!1;var t,a=this.view.renderCoordsHelper,i=g(this.resources.resources.geometries);try{for(i.s();!(t=i.n()).done;){var n=t.value.vertexAttributes.get("position"),r=new Float64Array(n.data.length);Object(J.k)(n.data,a.spatialReference,0,r,this.view.spatialReference,0,n.data.length/3),Object(ee.h)(e,r)}}catch(s){i.e(s)}finally{i.f()}return!0}},{key:"createRenderGeometries",value:function(){var e=this.geometry;if(Object(o.j)(e))return[];var t,a=[],i=[],n=g(Object(pe.b)(e,this.view.elevationProvider,this.view.renderCoordsHelper,ne.a.fromElevationInfo(this.elevationInfo)).lines);try{for(n.s();!(t=n.n()).done;){var r=t.value,s=r.position,l={attributeData:{position:s,mapPosition:r.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0};a.push(Object(pe.a)(l)),i.push(s)}}catch(c){n.e(c)}finally{n.f()}return this._laserline.pathVerticalPlane=i,a}}]),e}(),Oe=Object(ee.d)(),je=Object(K.e)(),_e=Object(K.e)(),Me=a("yvcr"),we=(a("Mu3I"),a("WiJz"),a("uljd"),a("Lg+x"));Object(K.e)();var ke=a("X668"),xe=a("k2DL"),Se=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e)).view=null,i._renderOccluded=4,i._vertices=null,i._spatialReference=null,i._color=X.colorToVec4(X.reshapeManipulators.vertex.color),i._size=X.reshapeManipulators.vertex.size,i._outlineColor=X.colorToVec4(X.reshapeManipulators.vertex.outlineColor),i._outlineSize=X.reshapeManipulators.vertex.outlineSize,i._elevationInfo=null,i.applyProps(e),i}return x(a,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}},{key:"vertices",get:function(){return this._vertices},set:function(e){this._vertices=e,this.recreateGeometry()}},{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.recreateGeometry()}},{key:"color",get:function(){return this._color},set:function(e){Object($.g)(e,this._color)||(Object($.c)(this._color,e),this.updateMaterial())}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this.updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){Object($.g)(e,this._outlineColor)||(Object($.c)(this._outlineColor,e),this.updateOutlineMaterial())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"vertexMaterialParameters",get:function(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}},{key:"vertexOutlineMaterialParameters",get:function(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}},{key:"updateMaterial",value:function(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}},{key:"updateOutlineMaterial",value:function(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}},{key:"createRenderGeometries",value:function(){var e=this.vertices;if(Object(o.j)(e)||0===e.length)return[];for(var t=function(e,t,a,i,n){var r=new Float64Array(3*e.length),o=new Float64Array(r.length);e.forEach(function(e,t){r[3*t+0]=e[0],r[3*t+1]=e[1],r[3*t+2]=e.length>2?e[2]:0});var s=Object(we.b)(r,t,0,o,0,r,0,r.length/3,a,i,n);return{numVertices:e.length,position:r,mapPosition:o,projectionSuccess:null!=s,sampledElevation:s}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ne.a.fromElevationInfo(this.elevationInfo)),a=[],i=t.numVertices,n=t.position,r=0;r<i;++r){var s=Object(Q.v)(Pe,n[3*r+0],n[3*r+1],n[3*r+2]),l=Ee(.5,s),c=Ee(.5,s);a.push({vertexGeometry:l,vertexOutlineGeometry:c})}return a}},{key:"createGeometries",value:function(e){var t,a=g(this.createRenderGeometries());try{for(a.s();!(t=a.n()).done;){var i=t.value,n=i.vertexGeometry,r=i.vertexOutlineGeometry;e.addGeometry(n,this.vertexMaterial),e.addGeometry(r,this.vertexOutlineMaterial)}}catch(o){a.e(o)}finally{a.f()}}},{key:"createExternalResources",value:function(){this.vertexMaterial=new xe.a(v(v({},this.vertexMaterialParameters),{},{writeDepth:!0,cullFace:2,screenSizeEnabled:!0})),this.vertexOutlineMaterial=new xe.a(v(v({},this.vertexOutlineMaterialParameters),{},{transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1}))}},{key:"destroyExternalResources",value:function(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}},{key:"forEachExternalMaterial",value:function(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}]),a}(ke.a),Pe=Object(K.e)();function Ee(e,t){return Me.a.createSphereGeometry(e,16,16,{offset:t})}var Ae=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e)).tracking=!1,i.displaying=!1,i.isDraped=!1,i}return a}(d.a.EventedAccessor);Object(n.a)([Object(c.b)({constructOnly:!0})],Ae.prototype,"graphic",void 0),Object(n.a)([Object(c.b)()],Ae.prototype,"tracking",void 0),Object(n.a)([Object(c.b)()],Ae.prototype,"displaying",void 0),Object(n.a)([Object(c.b)()],Ae.prototype,"isDraped",void 0),Ae=Object(n.a)([Object(u.a)("esri.views.3d.layers.graphics.GraphicState")],Ae);var De=a("39Rk"),Ge=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e)).drawOperation=null,i._createGraphic=null,i._createGraphicState=null,i._outlineVisualElement=null,i._verticesVisualElement=null,i._stagedVerticesVisualElement=null,i.hasZ=!0,i.defaultZ=0,i.elevationInfo=null,i.snapToScene=!1,i.snappingManager=null,i.mode=null,i.geometryType=null,i.type="draw-3d",i}return x(a,[{key:"initialize",value:function(){var e=this,t=Object(o.r)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new O.a({elevationInfo:t,listMode:"hide",internal:!0}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new i.a({view:this.view,manipulators:this.manipulators,geometryType:Re(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,snappingDrawSurface:new k.b(this.view,t,[this._internalGraphicsLayer]),elevationDrawSurface:new k.a(t,this.defaultZ,this.view,this._internalGraphicsLayer),hasM:!1,elevationInfo:t,snappingManager:this.snappingManager}),this.drawOperation.on("vertex-add",function(t){return e.onVertexAdd(t)}),this.drawOperation.on("vertex-remove",function(t){return e.onVertexRemove(t)}),this.drawOperation.on("vertex-update",function(t){return e.onVertexUpdate(t)}),this.drawOperation.on("cursor-update",function(t){return e.onCursorUpdate(t)}),this.drawOperation.on("complete",function(t){return e.onComplete(t)})}},{key:"destroy",value:function(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)}},{key:"onInputEvent",value:function(e){this.drawOperation.onInputEvent(e)}},{key:"_getCreateGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==this.drawOperation)return null;var a=Object(o.k)(e)?e:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null,i=this.drawOperation.vertices;if(0===i.length)return null;var n=this.drawOperation.spatialReference,r=i,s=r.slice(),l=[];Object(o.k)(a)&&(s.splice(a,1),l.push(r[a]));var c={regularVertices:null,stagedVertices:null,full:null,outline:null},u="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":c.regularVertices=s,c.stagedVertices=l,c.full=this.drawOperation.coordinateHelper.createPointFromArray(i[0]);break;case"polyline":c.regularVertices=s,c.stagedVertices=l,r.length>0&&(c.full=Object(De.createPolyline)([r],n,u));break;case"polygon":c.regularVertices=s,c.stagedVertices=l,r.length>0&&(c.full=Object(De.createPolygon)([r],n,u,!0));break;case"circle":if(r.length>0){var h=Object(E.a)(this.view,i[0]);if(1===r.length&&t){var p=r[0],d=h.makeMapPoint(p[0]+Ce*this.view.resolution,p[1]);c.full=Object(De.createCircle)([p,d],h,!0)}else 2===r.length&&(c.full=this.forceUniformSize?Object(De.createCircle)(i,h,this.centered):Object(De.createEllipse)(i,h,this.centered))}break;case"rectangle":if(r.length>0){var v=Object(E.a)(this.view,i[0]);if(1===r.length&&t){var f=r[0],g=v.makeMapPoint(f[0]+Ce*this.view.resolution,f[1]);c.full=Object(De.createSquare)([f,g],v,!0)}else 2===r.length&&(c.full=this.forceUniformSize?Object(De.createSquare)(i,v,this.centered):Object(De.createRectangle)(i,v,this.centered))}break;default:return null}switch(this.geometryType){case"point":break;case"polyline":r.length>1&&(c.outline=Object(De.createPolyline)([r],n,u));break;case"polygon":r.length>1&&(c.outline=Object(De.createPolygon)([r],n,u));break;case"circle":case"rectangle":Object(o.k)(c.full)&&"polygon"===c.full.type&&(c.outline=Object(De.createPolygon)(c.full.rings,n,u))}return c}},{key:"_destroyAllVisualisations",value:function(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()}},{key:"_destroyCreateGraphic",value:function(){Object(o.k)(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null),this._createGraphicState=null,this.handles.remove(Te)}},{key:"_destroyOutlineVisualElement",value:function(){Object(o.k)(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)}},{key:"_destroyVerticesVisualElement",value:function(){Object(o.k)(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)}},{key:"_destroyStagedVerticesVisualElement",value:function(){Object(o.k)(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)}},{key:"_updateCreateGraphic",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this._getCreateGeometry(t);if(Object(o.j)(a))this._destroyAllVisualisations();else{var i=this._internalGraphicsLayer.elevationInfo;Object(o.k)(a.outline)?Object(o.j)(this._outlineVisualElement)?(this._outlineVisualElement=new ye({view:this.view,geometry:a.outline,elevationInfo:Object(o.q)(i),isDraped:Object(o.k)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(_.c)(this.hasZ,i),attached:!1}),X.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),X.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=a.outline:this._destroyOutlineVisualElement(),Object(o.k)(a.regularVertices)?Object(o.j)(this._verticesVisualElement)?(this._verticesVisualElement=new Se({view:this.view,spatialReference:this.view.spatialReference,vertices:a.regularVertices,elevationInfo:Object(o.q)(this._internalGraphicsLayer.elevationInfo),renderOccluded:X.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=a.regularVertices:this._destroyVerticesVisualElement(),Object(o.k)(a.stagedVertices)?Object(o.j)(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new Se({view:this.view,spatialReference:this.view.spatialReference,vertices:a.stagedVertices,elevationInfo:Object(o.q)(this._internalGraphicsLayer.elevationInfo),renderOccluded:X.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._stagedVerticesVisualElement.color=X.colorToVec4(X.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=a.stagedVertices:this._destroyStagedVerticesVisualElement(),Object(o.k)(a.full)?Object(o.j)(this._createGraphic)?(this._createGraphic=new f.a({geometry:a.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this._createGraphicState=new Ae({graphic:this._createGraphic}),this.handles.add([this.view.trackGraphicState(this._createGraphicState),Object(b.init)(this._createGraphicState,"isDraped",function(t){Object(o.k)(e._outlineVisualElement)&&(e._outlineVisualElement.isDraped=t)})],Te),this.notifyChange("createGraphic")):this._createGraphic.geometry=a.full:this._destroyCreateGraphic()}}},{key:"createGraphic",get:function(){return this._createGraphic}},{key:"enabled",set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)}},{key:"centered",set:function(e){this._set("centered",e),this._updateCreateGraphic()}},{key:"forceUniformSize",set:function(e){this._set("forceUniformSize",e),this._updateCreateGraphic()}},{key:"reset",value:function(){}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"redo",value:function(){this.drawOperation.redo()}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},{key:"undo",value:function(){this.drawOperation.undo()}},{key:"completeCreateOperation",value:function(){this.drawOperation.complete()}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){this.drawOperation.isCompleted||this.drawOperation.cancel()}},{key:"getVertexCoords",value:function(){return this.drawOperation.vertices}},{key:"onVertexAdd",value:function(e){this._updateCreateGraphic(),this.emit("vertex-add",e)}},{key:"onVertexRemove",value:function(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)}},{key:"onVertexUpdate",value:function(e){this._updateCreateGraphic(),this.emit("vertex-update",e)}},{key:"onCursorUpdate",value:function(e){this._updateCreateGraphic(1===e.vertices.length?e.vertices[0].vertexIndex:null),this.emit("cursor-update",e)}},{key:"onComplete",value:function(e){this._updateCreateGraphic();var t=null;if(this.drawOperation.isCompleted){var a=this._getCreateGeometry(null,!0);Object(o.k)(a)&&(t=new f.a({geometry:a.full,symbol:this.createGraphicSymbol}))}this.emit("complete",v({graphic:t},e))}}]),a}(Object(m.b)(d.a.EventedMixin(P.a)));function Re(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return null}}Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Ge.prototype,"view",void 0),Object(n.a)([Object(c.b)()],Ge.prototype,"createGraphicSymbol",void 0),Object(n.a)([Object(c.b)()],Ge.prototype,"createGraphic",null),Object(n.a)([Object(c.b)({value:!0})],Ge.prototype,"enabled",null),Object(n.a)([Object(c.b)({value:!0})],Ge.prototype,"centered",null),Object(n.a)([Object(c.b)({value:!0})],Ge.prototype,"forceUniformSize",null),Object(n.a)([Object(c.b)({constructOnly:!0})],Ge.prototype,"hasZ",void 0),Object(n.a)([Object(c.b)({nonNullable:!0})],Ge.prototype,"defaultZ",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],Ge.prototype,"elevationInfo",void 0),Object(n.a)([Object(c.b)()],Ge.prototype,"snapToScene",void 0),Object(n.a)([Object(c.b)()],Ge.prototype,"snappingManager",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],Ge.prototype,"mode",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],Ge.prototype,"geometryType",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Ge.prototype,"type",void 0),Ge=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],Ge);var Ce=48,Te="create-graphic",Ie=a("xkkJ"),Ve=a("LE9a"),ze=a("r0DZ"),He=a("aunz"),Be=a("J9+3"),Fe=a("Hxwb"),Ue=a("wg3g"),qe=a("NRDM"),Le=a("/rov"),Ze=a("dK/y"),Ne=a("JD/0");function We(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(_.d)(e);return"on-the-ground"!==t.mode&&!(Object(o.j)(e.geometry)||!e.geometry.hasZ)}var Ye=a("OKTS"),Xe=a("jxyb"),Ke=a("TnN0"),Qe=function(){function e(){S(this,e),this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return x(e,[{key:"update",value:function(e){var t=this;this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(function(e,a){if(0===a&&(t.zManipulator=e),e instanceof Ke.a&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),Object(o.j)(t.firstGrabbedXY)&&e.grabbing&&1===a&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=1,a){case 0:t.grabbingState|=2;break;case 1:t.grabbingState|=4}})}}]),e}();function Je(e,t,a){var i=e.graphic,n=e.view,r=[],s=Object(_.d)(i),l="on-the-ground"===s.mode||!s.offset&&"absolute-height"!==s.mode,c=new Qe,u=new Xe.a({view:n,extensionType:X.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});X.visualElements.pointGraphics.shadowStyle.apply(u);var h=Object(Ye.d)(X.visualElements.heightPlaneAngleCutoff),p=new de.a({view:n,attached:!1,angleCutoff:h});X.visualElements.heightPlane.apply(p);var d=1,v=1,f=function(){if(c.update(e),!a.displaying||l&&(a.isDraped||!$e(i)||!i.geometry.hasZ))return t.laserlineEnabled=!1,u.attached=!1,void(p.attached=!1);t.laserlineEnabled=!0;var n=4&c.grabbingState?X.visualElements.laserlineAlphaMultiplier:1;n!==d&&(d=n,X.visualElements.lineGraphics.shadowStyle.apply(t,n),X.visualElements.pointGraphics.shadowStyle.apply(u,n));var r=2&c.grabbingState?X.visualElements.laserlineAlphaMultiplier:1;r!==v&&(v=r,X.visualElements.heightPlane.apply(p,r)),function(e,t){var a=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(o.k)(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(o.k)(a)?(e.setStartEndFromWorldDownAtLocation(a.renderLocation),e.attached=!0):e.attached=!1}(u,c),function(e,t,a,i){if(i.numSelected>0){Object(Q.v)(et,0,0,0);var n=0;e.forEachManipulator(function(e,t){1===t&&e.selected&&e instanceof Ke.a&&(Object(Q.e)(et,et,e.renderLocation),n++)}),n>0?(a.heightManifoldTarget=Object(Q.d)(et,et,1/n),a.attached=!0):a.attached=!1}else{var r=t.attachmentOrigin;Object(o.k)(r)&&e.view.renderCoordsHelper.toRenderCoords(r,et)?(a.heightManifoldTarget=et,a.attached=!0):a.attached=!1}}(e,t,p,c)};X.visualElements.zVerticalLine.apply(u),r.push(a.on("changed",f),a.watch("displaying",f),t.events.on("attachment-origin-changed",f),Object(Ie.a)(u),Object(Ie.a)(p));var g=[],b=function(){Object(Ie.b)(g).remove(),g.length=0,e.forEachManipulator(function(e){return g.push(e.events.on("grab-changed",f))}),e.forEachManipulator(function(e){return g.push(e.events.on("select-changed",f))}),f()};return b(),r.push(e.onManipulatorsChanged(b),Object(Ie.d)(function(){return Object(Ie.b)(g)})),Object(Ie.b)(r)}function $e(e){return Object(o.k)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}var et=Object(K.e)(),tt=a("kYAx"),at=a("ACyv");function it(e){return Object(o.k)(e.geometry)&&"point"===e.geometry.type}var nt=Object(K.e)(),rt=Object(ee.d)();function ot(e){switch(Object(o.q)(e.graphic.geometry).type){case"point":return function(e){var t=e.view,a=e.graphic,i=new Ae({graphic:a}),n=[],r=function(e,t,a){var i=e.view,n=e.graphic,r=new at.a({view:i,geometry:it(n)?n.geometry:null,elevationInfo:Object(_.d)(n),attached:!1});return function(e,t,a,i){(function(e,t,a,i){var n=e.view,r=e.graphic,s=null,l=function(){Object(o.k)(s)&&(s.remove(),s=null),a.isDraped&&it(r)&&(s=function(e,t,a){var i=e.elevationProvider.spatialReference;Object(J.o)(t,nt,i);var n=nt[0],r=nt[1];return e.elevationProvider.on("elevation-change",function(e){Object(tt.f)(e.extent,n,r)&&a()})}(n,r.geometry,function(){t.geometry=r.geometry})),t.geometry=it(r)?r.geometry:null};i.push(a.on("changed",l),Object(Ie.d)(function(){return s})),l()})(e,t,a,i),X.visualElements.pointGraphics.outline.apply(t),i.push(Object(b.init)(a,"displaying",function(){return t.attached=a.displaying}))}(e,r,t,a),a.push(Object(Ie.a)(r)),r}(e,i,n);return function(e,t,a,i){var n=e.view,r=e.graphic,o=new Xe.a({view:n,extensionType:X.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});X.visualElements.zVerticalLine.apply(o);var s=new de.a({view:n,intersectsLineInfinite:!0,attached:!1});X.visualElements.pointGraphics.shadowStyle.apply(s);var l=Object(Ye.d)(X.visualElements.heightPlaneAngleCutoff),c=new de.a({view:n,attached:!1,angleCutoff:l});X.visualElements.heightPlane.apply(c);var u=Object(_.d)(e.graphic),h=ne.a.fromElevationInfo(u),p="on-the-ground"===u.mode||!u.offset&&"absolute-height"!==u.mode,d=new Qe,v=1,f=1,g=function(){d.update(e);var a=p&&(t.isDraped||!it(r)||!r.geometry.hasZ),l=!0;if(!a&&it(r)){var u=r.geometry,g=Object(we.c)(r.geometry,n.elevationProvider,h,n.renderCoordsHelper);Object(Q.v)(nt,u.x,u.y,g),Object(J.r)(nt,u.spatialReference,nt,n.renderCoordsHelper.spatialReference),o.setStartEndFromWorldDownAtLocation(nt),s.intersectsWorldUpAtLocation=nt}else l=!1;var b=2&d.grabbingState?X.visualElements.laserlineAlphaMultiplier:1;b!==v&&(v=b,X.visualElements.heightPlane.apply(c,b));var m=Object(ee.e)(rt);!a&&t.displaying&&i.calculateMapBounds(m)&&Object(J.r)(Object(ee.m)(m,nt),n.spatialReference,nt,n.renderCoordsHelper.spatialReference)?(c.heightManifoldTarget=nt,c.attached=!0):c.attached=!1;var y=4&d.grabbingState?X.visualElements.laserlineAlphaMultiplier:1;y!==f&&(f=y,X.visualElements.pointGraphics.shadowStyle.apply(s,y));var O=l&&t.displaying&&!a;s.attached=O,o.attached=O};a.push(t.watch(["displaying","isDraped"],g),t.on("changed",g)),e.forEachManipulator(function(e){a.push(e.events.on("grab-changed",g))}),a.push(Object(Ie.a)(s)),a.push(Object(Ie.a)(o)),a.push(Object(Ie.a)(c)),g()}(e,i,n,r),n.push(t.trackGraphicState(i)),{visualElement:r,remove:function(){Object(Ie.b)(n).remove()}}}(e);case"polygon":case"polyline":return function(e){var t=e.view,a=e.graphic,i=new Ae({graphic:a}),n=function(e,t){var a=e.view,i=e.graphic,n=new ye({view:a,geometry:$e(i)?i.geometry:null,elevationInfo:Object(_.d)(i),attached:!1});X.visualElements.lineGraphics.shadowStyle.apply(n);var r=function(){n.attached=t.displaying};X.visualElements.lineGraphics.outline.apply(n);var o=[t.watch("displaying",r),t.watch("isDraped",function(e){return n.isDraped=e}),t.on("changed",function(){return n.geometry=$e(i)?i.geometry:null}),Object(Ie.a)(n)];return r(),{visualElement:n,remove:function(){return Object(Ie.b)(o).remove()}}}(e,i),r=[n,Je(e,n.visualElement,i),t.maskOccludee(a),t.trackGraphicState(i)];return{visualElement:n.visualElement,remove:function(){return Object(Ie.b)(r).remove()}}}(e);default:return null}}var st=[1,.5,0],lt=Math.ceil(70/3*2),ct=5*Math.PI/12,ut=1*Math.PI/3;function ht(e,t,a){var i=e.graphic,n=function(e,a){return t({action:e,graphic:i,dxScreen:a.screenDeltaX,dyScreen:a.screenDeltaY})};return a(function(e,t,a){var r=t.next(function(e){return"start"===e.action&&n("start",e),e}).next(Object(Ue.g)(i)).next(function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&n("update",e);break;case"end":n("end",e)}return e});return a.next(Object(Ue.i)(i)).next(function(){n("end",{screenDeltaX:0,screenDeltaY:0})}),r})}function pt(e){if(Object(o.j)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;var a=t[0],i=t[1];return Math.atan2(i[1]-a[1],i[0]-a[0])}var dt=function(){function e(){S(this,e),this._available=!0}return x(e,[{key:"location",set:function(e){this.forEachManipulator3D(function(t){return t.location=e})}},{key:"elevationAlignedLocation",set:function(e){this.forEachManipulator3D(function(t){return t.elevationAlignedLocation=e})}},{key:"elevationInfo",set:function(e){this.forEachManipulator3D(function(t){return t.elevationInfo=e})}},{key:"available",get:function(){return this._available},set:function(e){this._available=e,this.forEachManipulator3D(function(t){return t.available=e})}},{key:"grabbing",get:function(){return this.someManipulator(function(e){return e.grabbing})}},{key:"dragging",get:function(){return this.someManipulator(function(e){return e.dragging})}},{key:"hasManipulator",value:function(e){return this.someManipulator(function(t){return t===e})}},{key:"someManipulator",value:function(e){var t=!1;return this.forEachManipulator(function(a){!t&&e(a)&&(t=!0)}),t}},{key:"forEachManipulator3D",value:function(e){this.forEachManipulator(function(t,a){t instanceof Ke.a&&e(t,a)})}}]),e}(),vt=a("8JEK"),ft=a("024p"),gt=a("tKWm"),bt=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this))._handles=new ze.a,i._arrowManipulatorInfos=new Array,i._opaqueMaterial=i.createMaterial(),i._transparentMaterial=i.createMaterial(.5),i._angle=0,i._scale=1,i._radius=70,i._updateAfterDrag=!1,i.events=new d.a,i._tool=e.tool,i._view=e.view,null!=e.radius&&(i._radius=e.radius),i._createManipulators(),i.forEachManipulator(function(e){return i._tool.manipulators.add(e)}),i}return x(a,[{key:"orthogonalAvailable",set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}},{key:"destroy",value:function(){var e=this;this.forEachManipulator(function(t){e._tool.manipulators.remove(t),t.destroy()}),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}},{key:"forEachManipulator",value:function(e){this._arrowManipulatorInfos.map(function(t){var a=t.manipulator;return e(a,1)})}},{key:"createGraphicDragPipeline",value:function(e,t,a){var i=this,n=t.graphic,r=Object(_.d)(n),s=Object(o.q)(n.geometry).spatialReference;return ht(t,a,function(t){return i.createDragPipeline(function(a,i,n,r,o){return t(a,e(a,i,n,r,o),n)},r,s,n)})}},{key:"createDragPipeline",value:function(e,t,a,i){var n=this;return Object(Ie.b)(this._arrowManipulatorInfos.map(function(r,o){var s=r.manipulator;return Object(Ue.e)(s,function(r,s,l,c,u){var h=s.next(function(e){return v(v({},e),{},{manipulatorType:1})}).next(Object(Ue.f)(n._view,r.elevationAlignedLocation)).next(Object(gt.c)(n._view,r.elevationAlignedLocation,t,a,i)).next(Object(Ue.d)(r.location,n.angle+(o+1)*Math.PI*.5)).next(Object(Ue.c)());e(r,h,l,c,u)})}))}},{key:"angle",get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}},{key:"_updateManipulators",value:function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}},{key:"_updateArrowManipulator",value:function(e,t){var a=e.manipulator,i=e.transform,n=this._radius/70,r=54*n,o=Math.sqrt(r*r*3/4),s=Me.a.createExtrudedTriangle(o,r/2,r/2,.02);Me.a.transformInPlace(s,Object(se.t)(vt.a.get(),Object(Q.v)(vt.d.get(),0,-o/3,0))),a.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:2},{geometry:s,material:this._transparentMaterial,stateMask:1}],a.radius=o/3*2*1.2;var l=Object(se.i)(vt.a.get());Object(se.u)(l,t*Math.PI/2);var c=Object(se.i)(vt.a.get());Object(se.t)(c,Object(Q.v)(vt.d.get(),0,100*n,0)),Object(se.l)(i,l,c)}},{key:"_createManipulators",value:function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}},{key:"_updateManipulatorTransform",value:function(){var e=this.angle,t=Object(se.i)(vt.a.get());Object(se.q)(t,t,e,Object(K.g)(0,0,1));var a=Object(se.o)(vt.a.get(),Object(Q.v)(vt.d.get(),this.displayScale,this.displayScale,this.displayScale)),i=Object(se.i)(vt.a.get());Object(se.l)(i,a,t);var n,r=g(this._arrowManipulatorInfos);try{for(r.s();!(n=r.n()).done;){var o=n.value,s=Object(se.l)(vt.a.get(),i,o.transform);o.manipulator.modelTransform=s}}catch(l){r.e(l)}finally{r.f()}}},{key:"_createArrowManipulator",value:function(e){var t=this,a=new Ke.a({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(K.g)(0,0,1)}}),i={manipulator:a,transform:Object(le.b)()};return this._updateArrowManipulator(i,e),this._handles.add(a.events.on("drag",function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)})),i}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=A.a.toUnitRGBA(C.main);return t[3]*=e,new ft.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map(function(e){return e.manipulator})}}}]),a}(dt),mt=function(){function e(){S(this,e),this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new Ue.a,this._enabled=!1}return x(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&Object(o.k)(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,a=this.snap(this.lastDragEvent.screenEnd);Object(o.k)(a)&&this.next.execute({action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?a:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd})}this._enabled=e}},{key:"snap",value:function(e){var t=Object(o.k)(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(o.k)(t)&&Object(o.k)(this.view)&&(t.z=Object(_.f)(t,this.view,this.elevationInfo)),t}},{key:"createDragEventPipelineStep",value:function(e,t){var a=this;return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,function(e){if(a.lastDragEvent="end"!==e.action?v({},e):null,a._enabled){var t=a.snap(e.screenEnd);return Object(o.k)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}]),e}(),yt=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this))._handles=new ze.a,i._snapToScene=new mt,i._discMaterial=i._createMaterial(),i._discMaterialTransparent=i._createMaterial(.5),i._scale=1,i._radius=70,i._view=e.view,i._tool=e.tool,null!=e.snapToScene&&(i.snapToScene=e.snapToScene),null!=e.radius&&(i._radius=e.radius),i._createManipulator(),i.forEachManipulator(function(e){return i._tool.manipulators.add(e)}),i}return x(a,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator(function(t){e._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"snapToScene",get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}},{key:"createGraphicDragPipeline",value:function(e,t,a){var i=this,n=t.graphic,r=Object(_.d)(n),s=Object(o.q)(n.geometry).spatialReference;return ht(t,a,function(t){return i.createDragPipeline(function(a,i,n,r,o){return t(a,e(a,i,n,r,o),n)},r,s,n)})}},{key:"createDragPipeline",value:function(e,t,a,i){var n=this,r=this._view;return Object(Ue.e)(this._manipulator,function(o,s,l,c,u){var h=s.next(Object(Ue.f)(r,o.elevationAlignedLocation)).next(Object(gt.c)(r,o.elevationAlignedLocation,t,a,i)).next(n._snapToScene.createDragEventPipelineStep(r,t),n._snapToScene.next).next(function(e){return v(v({},e),{},{manipulatorType:1})}).next(Object(Ue.c)());e(o,h,l,c,u)})}},{key:"_updateManipulatorTransform",value:function(){var e=Object(se.o)(vt.a.get(),Object(Q.v)(vt.d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}},{key:"_createManipulator",value:function(){this._manipulator=new Ke.a({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(K.g)(0,0,1)},worldOriented:!0}),this._updateManipulator()}},{key:"_updateManipulator",value:function(){var e=Me.a.createCylinderGeometry(.02,1,128,Object(K.g)(0,0,1),Object(K.g)(0,0,0)),t=Object(se.o)(Object(le.b)(),Object(K.g)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/70*80}},{key:"_createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=A.a.toUnitRGBA(C.main);return t[3]*=e,new ft.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{discManipulator:this._manipulator}}}]),a}(dt),Ot=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this))._handles=new ze.a,i._radius=70,i.events=new d.a,i._tool=e.tool,i._view=e.view,null!=e.radius&&(i._radius=e.radius),i.createManipulator(),i.forEachManipulator(function(e){return i._tool.manipulators.add(e)}),i}return x(a,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator(function(t){e._tool.manipulators.remove(t),t.destroy()})}},{key:"forEachManipulator",value:function(e){e(this._manipulator,0)}},{key:"createGraphicDragPipeline",value:function(e,t,a){var i=this,n=Object(o.q)(t.graphic.geometry).spatialReference;return ht(t,a,function(t){return i.createDragPipeline(function(a,i,n,r,o){return t(a,e(a,i,n,r,o),n)},n)})}},{key:"createDragPipeline",value:function(e,t){var a=this._view;return Object(Ue.e)(this._manipulator,function(i,n,r,o,s){var l=n.next(function(e){return v(v({},e),{},{manipulatorType:0})}).next(Object(gt.g)(a,i.renderLocation,t)).next(Object(Ue.c)());e(i,l,r,o,s)})}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}},{key:"updateManipulator",value:function(){var e=this._radius/70,t=X.zManipulator.height*e,a=X.zManipulator.coneHeight*e,i=X.zManipulator.coneWidth*e,n=X.zManipulator.width*e,r=[Object(K.g)(0,0,0),Object(K.g)(0,0,t)],o=Me.a.createTubeGeometry(r,n/2,16,!1),s=Me.a.createConeGeometry(a,i/2,16,!1),l=[Object(K.g)(0,0,0),Object(K.g)(0,0,t+a)],c=function(e){var a=Object(le.b)();return Object(se.s)(a,a,[0,0,t]),Object(se.e)(a,a,Math.PI/2),a}(),u=function(e,t){var a=Object(D.a)(X.zManipulator.color,t);return[a.r/255,a.g/255,a.b/255,X.zManipulator.color.a*e]},h=Object(Ze.c)(u(1,.25),1),p=Object(Ze.c)(u(1,0),1),d=Object(Ze.c)(u(.7,0),X.zManipulator.renderOccluded),v=Object(Ze.c)(u(.85,0),X.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:s,transform:c,material:h,stateMask:1},{geometry:o,material:h,stateMask:1},{geometry:s,transform:c,material:p,stateMask:2},{geometry:o,material:p,stateMask:2},{geometry:s,transform:c,material:d,stateMask:1},{geometry:o,material:d,stateMask:1},{geometry:s,transform:c,material:v,stateMask:2},{geometry:o,material:v,stateMask:2}],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}},{key:"createManipulator",value:function(){var e=this,t=new Ke.a({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var a=e._view.state.camera,i=jt;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,i);var n=Object(Q.z)(a.eye,i),r=a.computeRenderPixelSizeAtDist(n),o=Object(Q.i)(_t,i,a.eye);Object(Q.q)(o,o);var s=Mt;e._view.renderCoordsHelper.worldUpAtPosition(jt,s);var l=Math.abs(Object(Q.g)(o,s)),c=Object(Q.f)(_t,o,s),u=Object(Q.f)(_t,c,s),h=Object(Ye.c)(l,.01,1),p=1-Math.sqrt(1-h*h)/h/a.fullWidth,d=X.zManipulator.width*(e._radius/70);Object(Q.d)(u,Object(Q.q)(u,u),(1/p-1)*n+r*d),t[12]-=_t[0],t[13]-=_t[1],t[14]-=_t[2]},this._manipulator=t,this.updateManipulator()}}]),a}(dt),jt=Object(K.e)(),_t=Object(K.e)(),Mt=Object(K.e)(),wt=function(e){y(a,e);var t=j(a);function a(e){var i;S(this,a),(i=t.call(this))._handles=new ze.a,i._angleDeferred=null,i._interactive=!0;var n=e.tool,r=e.view,o=e.snapToScene,s=e.radius;return i._view=r,i.xyManipulation=new yt({tool:n,view:r,snapToScene:o,radius:s}),i.xyAxisManipulation=new bt({tool:n,view:r,radius:s}),i.zManipulation=new Ot({tool:n,view:r,radius:s}),i.xyManipulation.available=e.xyAvailable,i.xyAxisManipulation.available=e.xyAxisAvailable,i.zManipulation.available=e.zAvailable,i.autoHideXYAxis(),i.forEachManipulator(function(e){i._handles.add(e.events.on("grab-changed",function(){return i.updateManipulatorInteractivity()}))}),i}return x(a,[{key:"destroy",value:function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}},{key:"createGraphicDragPipeline",value:function(e,t,a){return Object(Ie.b)([this.xyManipulation.createGraphicDragPipeline(function(t,a,i,n,r){return e(0,t,a,i,n,r)},t,a),this.xyAxisManipulation.createGraphicDragPipeline(function(t,a,i,n,r){return e(1,t,a,i,n,r)},t,a),this.zManipulation.createGraphicDragPipeline(function(t,a,i,n,r){return e(2,t,a,i,n,r)},t,a)])}},{key:"createDragPipeline",value:function(e,t,a,i){return Object(Ie.b)([this.xyManipulation.createDragPipeline(function(t,a,i,n,r){return e(0,t,a,i,n,r)},t,a,i),this.xyAxisManipulation.createDragPipeline(function(t,a,i,n,r){return e(1,t,a,i,n,r)},t,a,i),this.zManipulation.createDragPipeline(function(t,a,i,n,r){return e(2,t,a,i,n,r)},a)])}},{key:"snapToScene",set:function(e){this.xyManipulation.snapToScene=e}},{key:"angle",set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}},{key:"angleDeferred",set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}},{key:"interactive",set:function(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}},{key:"radius",set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}},{key:"displayScale",set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}},{key:"forEachManipulator",value:function(e){this.xyManipulation.forEachManipulator(function(t){return e(t,1)}),this.xyAxisManipulation.forEachManipulator(function(t){return e(t,1)}),this.zManipulation.forEachManipulator(function(t){return e(t,0)})}},{key:"xyAxisVisible",get:function(){var e=this.xyManipulation.someManipulator(function(e){return e.focused})||this.xyAxisManipulation.someManipulator(function(e){return e.focused});return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}},{key:"autoHideXYAxis",value:function(){var e=this,t=this.xyAxisManipulation,a=this.xyManipulation;if(!Object(r.a)("esri-mobile")){var i=[];a.forEachManipulator(function(e){return i.push(e)}),t.forEachManipulator(function(e){return i.push(e)});for(var n=function(){var a=[];e.xyAxisVisible?Object(o.k)(e._angleDeferred)&&(e.angle=e._angleDeferred()):t.forEachManipulator(function(e){return a.push(e.disableDisplay())}),e._handles.remove(kt),e._handles.add(a,kt)},s=0,l=i;s<l.length;s++){var c=l[s];this._handles.add(c.events.on("focus-changed",n))}this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",n)),n()}}},{key:"updateManipulatorInteractivity",value:function(){var e=this,t=this.grabbing;this.forEachManipulator(function(a){a.interactive=!t&&e._interactive||a.grabbing})}}],[{key:"radiusForSymbol",value:function(e){var t=Object(o.k)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some(function(e){return"icon"===e.type})?lt:70}}]),a}(dt),kt="disable-xy-axis-display",xt=a("PN7H"),St=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this))._handles=new ze.a,i._view=e.view,i._tool=e.tool,i._graphicState=e.graphicState,i._createManipulator(),i.forEachManipulator(function(e){return i._tool.manipulators.add(e)}),i}return x(a,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator(function(t){e._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"createGraphicDragPipeline",value:function(e){var t=this;return ht(this._graphicState,e,function(e){return t.createDragPipeline(e)})}},{key:"createDragPipeline",value:function(e){var t=this._view,a=this._graphicState.graphic,i=Object(o.k)(a.geometry)?a.geometry.spatialReference:null;return Object(Ue.e)(this._manipulator,function(n,r,o,s,l){var c=r.next(Object(gt.d)(l,t,a,i)).next(Object(Ue.b)()).next(Object(Ue.c)());e(n,c,o,s,l)})}},{key:"_createManipulator",value:function(){this._manipulator=new xt.a({graphic:this._graphicState.graphic,view:this._view,selectable:!0,cursor:"move"})}}]),a}(dt),Pt=function e(t){S(this,e),this.allGraphics=t,this.type="graphic-move-start"},Et=function e(t,a,i){S(this,e),this.dx=t,this.dy=a,this.allGraphics=i,this.type="graphic-move"},At=function e(t){S(this,e),this.allGraphics=t,this.type="graphic-move-stop"},Dt=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e)).graphics=new Ve.a,i.enableZ=!0,i.type="move-3d",i._toolHandles=new ze.a,i._handles=new ze.a,i.snappingPipeline=new qe.a,i}return x(a,[{key:"initialize",value:function(){var e=this;this._toolHandles.add([this.graphics.on("change",function(){return e._refreshManipulators()})]),this._refreshManipulators()}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}},{key:"reset",value:function(){}},{key:"_refreshManipulators",value:function(){var e=this;this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var t=this.graphics.toArray().filter(function(e){return 0===Object(Ne.a)(e)}).map(function(e){return new Gt(e)});t.length&&(this.createManipulators(t),this.createVisualElements(t),this._handles.add(t.map(function(t){return e.view.trackGraphicState(t.state)})),this.updateMoveManipulation(t))}},{key:"createManipulators",value:function(e){var t,a=this,i=g(e);try{var n=function(){var i=t.value,n=i.state;i.manipulationXY=new St({tool:a,view:a.view,graphicState:n}),i.manipulationXY.forEachManipulator(function(e){return a._handles.add(e.events.on("immediate-click",function(e){a.emit("immediate-click",v(v({},e),{},{graphic:n.graphic})),e.stopPropagation()}))}),a._handles.add(i.manipulationXY.createDragPipeline(function(t,i,n,r){return a.buildDragEventPipeline(e,0,t,i,n,r)}))};for(i.s();!(t=i.n()).done;)n()}catch(r){i.e(r)}finally{i.f()}this.createMoveManipulation(e)}},{key:"createMoveManipulation",value:function(e){var t=this,a=new wt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?wt.radiusForSymbol(e[0].graphic.symbol):70});this._moveManipulation=a,a.elevationInfo={mode:"absolute-height",offset:0},a.forEachManipulator(function(e){t._handles.add(e.events.on("immediate-click",function(i){a.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",v(v({},i),{},{graphic:t.graphics.getItemAt(0)})),i.stopPropagation()}))});var i,n=function(){return t.updateMoveManipulation(e)},r=g(e);try{for(r.s();!(i=r.n()).done;){var s=i.value;this._handles.add([s.state.on("changed",n),s.state.watch("displaying",n)])}}catch(c){r.e(c)}finally{r.f()}var l=e[e.length-1];this._handles.add(l.state.on("changed",function(){return t.updateMoveManipulationAngle(l)})),this._handles.add(a.createDragPipeline(function(a,i,n,r,o){return t.buildDragEventPipeline(e,a,i,n,r,o)},Object(_.d)(l.graphic),Object(o.q)(l.graphic.geometry).spatialReference,l.graphic)),this.updateMoveManipulationAngle(l)}},{key:"createVisualElements",value:function(e){var t,a=this,i=g(e);try{var n=function(){var i=t.value,n=ot({view:a.view,graphic:i.graphic,forEachManipulator:function(e){i.manipulationXY.forEachManipulator(e),a._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return Object(Ie.c)()}});i.geometryRepresentation=n.visualElement,i.geometryRepresentation instanceof ye&&a._handles.add([i.geometryRepresentation.events.on("attachment-origin-changed",function(){i.state.isDraped||a.updateMoveManipulation(e)}),i.state.watch("isDraped",function(){return a.updateMoveManipulation(e)})]),a._handles.add(n)};for(i.s();!(t=i.n()).done;)n()}catch(r){i.e(r)}finally{i.f()}}},{key:"updateMoveManipulationAngle",value:function(e){this._moveManipulation.angleDeferred=function(){return pt(e.graphic.geometry)}}},{key:"updateMoveManipulation",value:function(e){var t,a=Object(ae.d)(0,0,0,this.view.spatialReference),i=0,n=!1,r=this._moveManipulation,s=g(e);try{for(s.s();!(t=s.n()).done;){var l=t.value;if(l.state.displaying){var c=l.state.graphic;this.enableZ&&We(c)&&(n=!0);var u=l.geometryRepresentation instanceof ye&&!l.state.isDraped?l.geometryRepresentation.attachmentOrigin:Object(Ze.f)(this.view,c);Object(o.k)(u)&&(a.x+=u.x,a.y+=u.y,a.z+=u.z,i++)}}}catch(h){s.e(h)}finally{s.f()}i>0?(a.x/=i,a.y/=i,a.z/=i,r.location=a,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=n):r.available=!1}},{key:"buildDragEventPipeline",value:function(e,t,a,i,n,r){var o=this,s=[],l=[],c=null,u=null,h=function(){var e,t=g(s);try{for(t.s();!(e=t.n()).done;){e.value.dragging=!1}}catch(a){t.e(a)}finally{t.f()}s.length=0,l.length=0,c=null,u=null,o._moveManipulation.interactive=!0};if(1===e.length&&0===t){var p=e[0].graphic;i=this.buildSnappingPipelineSteps(p,Object(_.d)(p),i,n,r)}var d=i.next(function(t){if("start"===t.action){s.length=0,l.length=0;var i,n=g(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;r.dragging||!r.manipulationXY.hasManipulator(a)&&r.manipulationXY.grabbing||(s.push(r),l.push(r.graphic),r.dragging=!0)}}catch(h){n.e(h)}finally{n.f()}if(0!==l.length&&(o._moveManipulation.interactive=!1,c=Object(Ue.h)(l),u=Object(Ue.j)(l),o.emit("graphic-move-start",new Pt(l)),o.destroyed))return null}return 0!==l.length?t:null}).next(function(e){return c(e)}).next(function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=o.view.toScreen(e.mapStart),a=o.view.toScreen(e.mapEnd);if(o.emit("graphic-move",new Et(a.x-t.x,a.y-t.y,l)),o.destroyed)return null}break;case"end":if(o.emit("graphic-move-stop",new At(l)),o.destroyed)return null;h()}});return n.next(function(e){return u(e)}).next(function(){if(o.emit("graphic-move-stop",new At(l)),o.destroyed)return null;h()}),d}},{key:"buildSnappingPipelineSteps",value:function(e,t,a,i,n){var r=this,s=e.geometry;if(Object(o.j)(s)||"point"!==s.type)return a;var l=new Fe.a({elevationInfo:t,pointer:n,geometry:new Be.a(He.c.fromGeometry(s,this.view.viewingMode),"point"),visualizer:new Le.a,excludeFeature:e}),c=this.snappingManager;return a.next(function(t){var a=s.clone();return a.z=Object(_.a)(r.view,a,Object(_.d)(e),{mode:"absolute-height",offset:0}),v(v({},t),{},{snapOrigin:l.coordinateHelper.fromPoint(a)})}).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:l,snappingManager:c,cancel:i}),this.snappingPipeline.next)}}]),a}(d.a.EventedMixin(P.a));Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Dt.prototype,"view",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Dt.prototype,"graphics",void 0),Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Dt.prototype,"enableZ",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],Dt.prototype,"snappingManager",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Dt.prototype,"type",void 0),Dt=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Dt);var Gt=function(){function e(t){S(this,e),this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Ae({graphic:t})}return x(e,[{key:"graphic",get:function(){return this.state.graphic}}]),e}(),Rt=a("JAyX"),Ct=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e))._vertexManipulatorMaterial=Object(Ze.c)(X.colorToVec4(X.reshapeManipulators.vertex.color),X.reshapeManipulators.vertex.renderOccluded),i._vertexManipulatorOutlineMaterial=Object(Ze.d)(X.colorToVec4(X.reshapeManipulators.vertex.outlineColor),X.reshapeManipulators.vertex.renderOccluded),i._vertexManipulatorHoverOutlineMaterial=Object(Ze.d)(X.colorToVec4(X.reshapeManipulators.vertex.hoverOutlineColor),X.reshapeManipulators.vertex.renderOccluded),i._edgeManipulatorMaterial=Object(Ze.c)(X.colorToVec4(X.reshapeManipulators.edge.color),X.reshapeManipulators.edge.renderOccluded),i._edgeManipulatorOutlineMaterial=Object(Ze.d)(X.colorToVec4(X.reshapeManipulators.edge.outlineColor),X.reshapeManipulators.edge.renderOccluded),i._selectedManipulatorMaterial=Object(Ze.c)(X.colorToVec4(X.reshapeManipulators.selected.color),X.reshapeManipulators.selected.renderOccluded),i._selectedManipulatorOutlineMaterial=Object(Ze.d)(X.colorToVec4(X.reshapeManipulators.selected.outlineColor),X.reshapeManipulators.selected.renderOccluded),i._selectedManipulatorHoverOutlineMaterial=Object(Ze.d)(X.colorToVec4(X.reshapeManipulators.selected.hoverOutlineColor),X.reshapeManipulators.selected.renderOccluded),i._selectedIndex=0,i._vertexManipulatorGeometry=null,i._vertexManipulatorOutlineGeometry=null,i._edgeManipulatorGeometry=null,i._edgeManipulatorOutlineGeometry=null,i._handles=new ze.a,i._manipulatorHandles=new ze.a,i._manipulatorInfos=[],i._reshapeHelper=null,i._graphicMoveManipulation=null,i._moveManipulation=null,i._numGrabbing=0,i._numDragging=0,i._reshapeEventState=0,i._outlineVisualElement=null,i.tool=null,i.outputGeometry=null,i._snappingPipeline=new qe.a,i._snappingPipelineHandle=new qe.a,i._vertexLaserLineVisualElement=null,i}return x(a,[{key:"initialize",value:function(){var e=this,t=new Ae({graphic:this.graphic});this._graphicState=t,this._handles.add([t.watch("displaying",function(t){var a,i=g(e._manipulatorInfos);try{for(i.s();!(a=i.n()).done;){a.value.manipulator.available=t}}catch(n){i.e(n)}finally{i.f()}}),this.view.trackGraphicState(t)])}},{key:"destroy",value:function(){this._clear(),this._handles.destroy()}},{key:"inputGeometry",get:function(){return Object(o.k)(this._reshapeHelper)?this._reshapeHelper.geometry:null},set:function(e){this._recreateManipulators(e)}},{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"graphic",get:function(){return this.tool.graphic}},{key:"enableZ",get:function(){return this.tool.enableZ}},{key:"enableMoveGraphic",get:function(){return this.tool.enableMoveGraphic}},{key:"removeSelectedVertices",value:function(){var e=this._manipulatorInfos.filter(function(e){return e.manipulator.selected&&"vertex"===e.handle.type});this._removeVertices(e)}},{key:"manipulatorSelectionChanged",value:function(){this.emit("manipulators-changed")}},{key:"_clear",value:function(){this._moveManipulation=Object(o.e)(this._moveManipulation),this._graphicMoveManipulation=Object(o.e)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._reshapeHelper=Object(o.e)(this._reshapeHelper),this._numGrabbing=0,this._numDragging=0}},{key:"_recreateManipulators",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputGeometry;if(this._clear(),!Object(o.j)(e)){Object(o.e)(this._reshapeHelper),this._reshapeHelper=new Ut(He.c.fromGeometry(e,this.view.viewingMode),e.type);var t,a=Object(_.d)(this.graphic),i=g(this._reshapeHelper.editGeometry.components);try{for(i.s();!(t=i.n()).done;){var n,r=t.value,s=g(r.vertices);try{for(s.s();!(n=s.n()).done;){var l=n.value;this._createPerVertexManipulator(l,a)}}catch(p){s.e(p)}finally{s.f()}var c,u=g(r.edges);try{for(u.s();!(c=u.n()).done;){var h=c.value;this._createPerVertexManipulator(h,a)}}catch(p){u.e(p)}finally{u.f()}}}catch(p){i.e(p)}finally{i.f()}this._createGraphicMoveManipulators(a)}}},{key:"_perGraphicManipulatorDragAction",value:function(e,t){if("end"!==t.action){var a,i=[],n=this._manipulatorInfos.some(function(e){return"vertex"===e.handle.type&&e.manipulator.selected}),r=1===e&&n,s=Object(o.q)(this._reshapeHelper),l=g(this._manipulatorInfos);try{for(l.s();!(a=l.n()).done;){var c=a.value;"vertex"===c.handle.type&&(c.manipulator.grabbing||r&&!c.manipulator.selected||(Object(o.q)(s).moveVertices([c.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),i.push(c.handle.pos),this._updateManipulatorPosition(c)))}}catch(d){l.e(d)}finally{l.f()}if(0!==i.length){var u,h=0,p=g(this._manipulatorInfos);try{for(p.s();!(u=p.n()).done;){"vertex"===u.value.handle.type&&h++}}catch(d){p.e(d)}finally{p.f()}if(this.outputGeometry=s.geometry,i.length===h){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}}}},{key:"isMultiVertexSelection",value:function(){var e,t=0,a=g(this._manipulatorInfos);try{for(a.s();!(e=a.n()).done;){var i=e.value;It(i)&&i.manipulator.selected&&t++}}catch(n){a.e(n)}finally{a.f()}return t>1}},{key:"_perVertexManipulatorDragAction",value:function(e){if(this._updateEventState(2),!this.destroyed){var t=e.mapDeltaX,a=e.mapDeltaY,i=e.mapDeltaZ;if(t||a||i){var n,r=[],s=g(this._manipulatorInfos);try{for(s.s();!(n=s.n()).done;){var l=n.value;It(l)&&(l.manipulator.selected&&!l.manipulator.grabbing||l===e.info)&&r.push(l)}}catch(b){s.e(b)}finally{s.f()}for(var c=Object(o.q)(this._reshapeHelper),u=0,h=r;u<h.length;u++){var p=h[u];c.moveVertices([p.handle],t,a,i)}this.outputGeometry=c.geometry;for(var d=0,v=r;d<v.length;d++){var f=v[d];this._updateManipulatorPosition(f)}this.emit("reshape",{type:"reshape",mover:this.graphic})}}}},{key:"_updateEventState",value:function(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}},{key:"_createGraphicMoveManipulators",value:function(e){var t=this;this._graphicMoveManipulation=new St({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic?this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(function(e,a,i){a.next(function(e){return t._trackNumDragging(e)}).next(function(e){t._perGraphicManipulatorDragAction(0,e)}),i.next(t._cancelDragOperation())})):this._graphicMoveManipulation.forEachManipulator(function(e){e.grabbable=!1,e.cursor=null}),this._graphicMoveManipulation.forEachManipulator(function(e){return t._manipulatorHandles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",function(e){t._manipulatorInfos.some(function(e){return e.manipulator.selected})?t._clearSelection():t.emit("immediate-click",v(v({},e),{},{graphic:t.graphic})),e.stopPropagation()})])}),this._moveManipulation=new wt({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&We(this.graphic),snapToScene:!1,radius:wt.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator(function(e){t._handles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",function(a){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some(function(e){return e.manipulator.selected})||t.emit("immediate-click",v(v({},a),{},{graphic:t.graphic})),a.stopPropagation()})])}),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var a=Object(o.q)(this.graphic.geometry).spatialReference;this._handles.add([this._moveManipulation.createDragPipeline(function(a,i,n,r,s){var l=n.next(function(e){return t._trackNumDragging(e)}).next(function(e){var a=t._manipulatorInfos.filter(function(e){return It(e)&&e.manipulator.selected});return 1===e.manipulatorType&&1===a.length?v(v({},e),{},{info:a[0],snapOrigin:a[0].handle.pos}):v(v({},e),{},{info:null})}).next(t._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:function(e){return!!e.info},cancel:r,snappingManager:t.tool.snappingManager,snappingContext:new Fe.a({geometry:Object(o.q)(t._reshapeHelper),elevationInfo:e,pointer:s,excludeFeature:t.graphic,visualizer:new Le.a})}),t._snappingPipelineHandle.next).next(Object(Ue.b)()).next(function(e){return t._perGraphicManipulatorDragAction(1,e),e});return r.next(t._cancelDragOperation()),l},e,a,this.graphic),Object(b.init)(this._graphicState,"displaying",function(){t._updateMoveManipulationPosition()}),this._graphicState.on("changed",function(){return t._updateMoveManipulationPosition()}),Object(b.init)(this._graphicState,"isDraped",function(){var e="align-move-manipulation";t._graphicState.isDraped?t._handles.add(t.view.elevationProvider.on("elevation-change",function(){return t._updateMoveManipulationPosition()}),e):t._handles.remove(e)})]),this._updateMoveManipulationPosition();var i=ot({view:this.view,graphic:this.graphic,forEachManipulator:function(e){if(!t.destroyed){Object(o.k)(t._graphicMoveManipulation)&&t._graphicMoveManipulation.forEachManipulator(e);var a,i=g(t._manipulatorInfos);try{for(i.s();!(a=i.n()).done;){e(a.value.manipulator,1)}}catch(n){i.e(n)}finally{i.f()}t._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:function(e){return t.on("manipulators-changed",e)}});this._outlineVisualElement=i.visualElement instanceof ye?i.visualElement:null,Object(o.k)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",function(){t._graphicState.isDraped||t._updateMoveManipulationPosition()}),this._graphicState.watch("isDraped",function(){return t._updateMoveManipulationPosition()})]),this._manipulatorHandles.add(i)}},{key:"_createPerVertexManipulator",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(_.d)(this.graphic);if(Object(o.j)(this._vertexManipulatorGeometry)||Object(o.j)(this._vertexManipulatorOutlineGeometry)){var i=X.reshapeManipulators.vertex,n=i.size/2,r=n+i.collisionPadding;this._vertexManipulatorGeometry=Me.a.createSphereGeometry(n/r,16,16),this._vertexManipulatorOutlineGeometry=Me.a.createSphereGeometry((n+i.outlineSize)/r,16,16)}if(Object(o.j)(this._edgeManipulatorGeometry)||Object(o.j)(this._edgeManipulatorOutlineGeometry)){var s=X.reshapeManipulators.edge,l=s.size/2,c=l+s.collisionPadding;this._edgeManipulatorGeometry=Me.a.createSphereGeometry(l/c,16,16),this._edgeManipulatorOutlineGeometry=Me.a.createSphereGeometry((l+s.outlineSize)/c,16,16)}var u=new Ke.a({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|zt.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|zt.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|zt.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|zt.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|zt.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|zt.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|zt.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:a,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(u,e,a);var h="edge"===e.type?{manipulator:u,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:u,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(h),this.manipulators.add(u),this._updateManipulatorPosition(h),"edge"===h.type){var p=this._getManipulatorInfoFromHandle(h.handle.left).manipulator.events.on("location-update",function(){return t._updateManipulatorPosition(h)}),d=this._getManipulatorInfoFromHandle(h.handle.right).manipulator.events.on("location-update",function(){return t._updateManipulatorPosition(h)});h.locationUpdateHandle=Object(Ie.b)([p,d]),this._manipulatorHandles.add(h.locationUpdateHandle,u)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(u,!0),u);var f=Object(Ue.e)(u,function(e,i,n,r){i.next(function(e){return t._trackNumDragging(e)}).next(function(e){if(Vt(h)){var a=t._splitEdgeManipulator(h);return v(v({},e),{},{info:a,snapOrigin:a.handle.pos})}return v(v({},e),{},{info:h,snapOrigin:h.handle.pos})}).next(Object(Ue.f)(t.view,e.elevationAlignedLocation)).next(Object(gt.e)(t.view,t.graphic,e.elevationAlignedLocation,e.location.spatialReference,t.graphic)).next(t._snappingPipeline.createSnapDragEventPipelineStep({predicate:function(){return!t.isMultiVertexSelection()},cancel:n,snappingManager:t.tool.snappingManager,snappingContext:new Fe.a({geometry:Object(o.q)(t._reshapeHelper),elevationInfo:a,pointer:r,excludeFeature:t.graphic,visualizer:new Le.a})}),t._snappingPipeline.next).next(Object(Ue.b)()).next(function(e){t._perVertexManipulatorDragAction(e)}),n.next(t._cancelDragOperation())});return this._manipulatorHandles.add(f,u),this._manipulatorHandles.add([u.events.on("immediate-click",function(e){return t._manipulatorClickCallback(e,h)}),u.events.on("select-changed",function(){h.selectedIndex=++t._selectedIndex,t._updateMoveManipulationPosition()})]),this.emit("manipulators-changed"),u}},{key:"_trackNumDragging",value:function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}},{key:"_cancelDragOperation",value:function(){var e=this,t=Object(o.k)(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return function(){switch(e._numDragging--,e.inputGeometry=t,e.outputGeometry=t,Object(o.k)(e.tool.snappingManager)&&e.tool.snappingManager.doneSnapping(),e._reshapeEventState){case 0:break;case 1:e.emit("move",{type:"move",dx:0,dy:0,mover:e.graphic});break;case 2:e.emit("reshape",{type:"reshape",mover:e.graphic})}e.destroyed||e._updateEventState(0)}}},{key:"_setTypeSpecificManipulatorSettings",value:function(e,t,a){switch(t.type){case"vertex":e.state=zt.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=X.reshapeManipulators.vertex.size/2+X.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=a;break;case"edge":e.state=zt.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=X.reshapeManipulators.edge.size/2+X.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"===a.mode?a:{mode:"absolute-height",offset:0}}}},{key:"_watchAndUpdateGrabState",value:function(e,t){var a=this;return e.events.on("grab-changed",function(i){if("start"===i.action)t&&a._updateSelection(e),a._numGrabbing++;else if(a._numGrabbing--,a._updateEventState(0),a.destroyed)return;a._moveManipulation.interactive=!a._numGrabbing})}},{key:"_clearSelection",value:function(){var e,t=g(this._manipulatorInfos);try{for(t.s();!(e=t.n()).done;){var a=e.value;a.manipulator.grabbing||(a.manipulator.selected=!1)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_updateSelection",value:function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}},{key:"_removeManipulator",value:function(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}},{key:"_getManipulatorInfoFromHandle",value:function(e){if(e){var t,a=g(this._manipulatorInfos);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(e===i.handle)return i}}catch(n){a.e(n)}finally{a.f()}}return null}},{key:"_updateManipulatorPosition",value:function(e){if(e){var t=Object(o.q)(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.editGeometry.coordinateHelper.toPoint(e.handle.pos,Bt),e.manipulator.grabbing&&Object(o.k)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){var a=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,i=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if(Object(o.k)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){var n=a.location,r=i.location,s=n.x+.5*(r.x-n.x),l=n.y+.5*(r.y-n.y),c=n.hasZ&&r.hasZ?0:void 0;e.manipulator.location=Object(ae.d)(s,l,c,t.geometry.spatialReference)}else Object(Q.h)(Ft,a.renderLocation,i.renderLocation,.5),e.manipulator.renderLocation=Ft}}}},{key:"_splitEdgeManipulator",value:function(e){var t=Object(o.q)(this._reshapeHelper),a=Object(o.q)(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var i=e;i.handle=a,i.type="vertex";var n=Object(_.d)(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,n),a.left&&this._createPerVertexManipulator(a.left),a.right&&this._createPerVertexManipulator(a.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(i),this._updateSelection(e.manipulator);var r=this._updateEventState(2),s=t.editGeometry.coordinateHelper.toArray(i.handle.pos),l=t.editGeometry.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:s,componentIndex:l,vertexIndex:Object(o.q)(a.index)}],added:s}),r&&this._updateEventState(0),i}},{key:"_updateMoveManipulationPosition",value:function(){var e=this,t=vt.d.get();Object(Q.v)(t,0,0,0);var a,i=0,n=!1,r=null,s=null,l=g(this._manipulatorInfos);try{for(l.s();!(a=l.n()).done;){var c=a.value;It(c)&&(c.manipulator.selected?(i++,Object(Q.e)(t,t,c.manipulator.renderLocation),Object(o.j)(r)||c.selectedIndex>r.selectedIndex?(s=r,r=c):(Object(o.j)(s)||c.selectedIndex>s.selectedIndex)&&(s=c)):n=!0)}}catch(b){l.e(b)}finally{l.f()}if(0!==i){var u=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=u,this._moveManipulation.xyAxisManipulation.available=u,this._moveManipulation.zManipulation.available=u&&this.enableZ&&We(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=u&&1!==i}else{var h=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=h,this._moveManipulation.xyAxisManipulation.available=h,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=h,this._moveManipulation.zManipulation.available=h&&this.enableZ&&We(this.graphic)}if(0!==i){var p=0;if(Object(o.k)(r)){var d=r.handle.pos,v=Object(o.k)(s)?s.handle.pos:r.handle.left&&r.handle.left.left?r.handle.left.left.pos:null,f=!Object(o.k)(s)&&r.handle.right&&r.handle.right.right?r.handle.right.right.pos:null;v&&f?this._moveManipulation.xyAxisManipulation.available=!1:v?p=Tt(v,d):f&&(p=Tt(d,f))}this._moveManipulation.angle=p,this._moveManipulation.radius=lt}else this._moveManipulation.angleDeferred=function(){return pt(Object(o.q)(e.graphic.geometry))},this._moveManipulation.radius=wt.radiusForSymbol(this.graphic.symbol);0!==i&&n?(Object(Q.d)(t,t,1/i),Bt.spatialReference=Object(o.q)(this._reshapeHelper).geometry.spatialReference,Bt.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(t,Bt),this._moveManipulation.elevationAlignedLocation=Bt):Object(o.k)(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(o.k)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Object(Ze.g)(this.view,this._moveManipulation,this.graphic)}},{key:"_removeVertices",value:function(e){var t,a=[],i=Object(o.q)(this._reshapeHelper),n=g(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("vertex"===r.handle.type&&i.canRemoveVertex()){a.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.right));var s=Object(o.q)(i.removeVertices([r.handle]).removedVertices[0].createdEdge);s&&this._createPerVertexManipulator(s)}}}catch(u){n.e(u)}finally{n.f()}if(a.length>0){var l=a.map(function(e){var t=i.editGeometry.components.indexOf(e.component);return{coordinates:i.editGeometry.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:Object(o.q)(e.index)}});this.outputGeometry=i.geometry;var c=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:l.map(function(e){return e.coordinates}),vertices:l}),this.destroyed)return;if(c&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}},{key:"_manipulatorClickCallback",value:function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),Vt(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}}]),a}(d.a.EventedAccessor);function Tt(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function It(e){return"vertex"===e.handle.type}function Vt(e){return"edge"===e.handle.type}Object(n.a)([Object(c.b)({constructOnly:!0})],Ct.prototype,"tool",void 0),Object(n.a)([Object(c.b)()],Ct.prototype,"inputGeometry",null),Object(n.a)([Object(c.b)()],Ct.prototype,"outputGeometry",void 0),Ct=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Ct);var zt,Ht,Bt=Object(ae.d)(0,0,null,null),Ft=Object(K.e)();(Ht=zt||(zt={})).Vertex=16,Ht.Edge=32;var Ut=function(e){y(a,e);var t=j(a);function a(e,i){var n;return S(this,a),(n=t.call(this,e,i)).type=i,n._geometry=null,n}return x(a,[{key:"geometry",get:function(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.editGeometry.toPolyline();break;case"polygon":this._geometry=this.editGeometry.toPolygon()}this._dirty=!1}return this._geometry}}]),a}(Be.a),qt=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e))._handles=new ze.a,i._reshapeOperation=null,i._internalGeometryUpdate=!1,i.enableZ=!0,i.enableMoveGraphic=!0,i.type="reshape-3d",i.snappingManager=null,i}return x(a,[{key:"destroy",value:function(){this._handles.removeAll(),this._reshapeOperation=Object(o.e)(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}},{key:"selectionManagementDisabled",get:function(){return!0}},{key:"_updateGeometry",value:function(){var e=this.graphic.geometry;this._reshapeOperation.inputGeometry=0!==Object(Rt.a)(this.graphic)||!Object(o.k)(e)||"polygon"!==e.type&&"polyline"!==e.type?null:e.clone()}},{key:"_updateGraphic",value:function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0===Object(Rt.a)(this.graphic)){var t=this.watch("graphic.geometry",function(){!1===e._internalGeometryUpdate&&e._updateGeometry()},!0);this._handles.add(t,"onGraphicGeometryChange")}}},{key:"manipulatorSelectionChanged",value:function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}},{key:"_onReshapeGeometryChanged",value:function(){Object(o.j)(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)}},{key:"initialize",value:function(){var e=this;this._reshapeOperation=new Ct({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)}),this._reshapeOperation.on("move",function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)}),this._reshapeOperation.on("vertex-add",function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)}),this._reshapeOperation.on("vertex-remove",function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)}),this._reshapeOperation.on("immediate-click",function(t){return e.emit("immediate-click",t)}),Object(b.init)(this,"graphic",function(){e._updateGraphic()},!0)])}},{key:"beforeUndo",value:function(){Object(o.k)(this.snappingManager)&&this.snappingManager.doneSnapping()}},{key:"onInputEvent",value:function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}},{key:"reset",value:function(){}},{key:"test",get:function(){return{snappingManager:this.snappingManager}}}]),a}(d.a.EventedMixin(P.a));Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],qt.prototype,"view",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],qt.prototype,"graphic",void 0),Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],qt.prototype,"enableZ",void 0),Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],qt.prototype,"enableMoveGraphic",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],qt.prototype,"type",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],qt.prototype,"snappingManager",void 0),qt=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],qt);var Lt,Zt,Nt=a("QhKk"),Wt=a("WBXD"),Yt=a("qRWG"),Xt=a("0Kx6");(Zt=Lt||(Lt={})).ScaleIn=32,Zt.ScaleOut=64,Zt.RotateLeft=128,Zt.RotateRight=256,Zt.Unlocked=1024,Zt.DelayedFocused=2048,Zt.TouchInput=32768;var Kt=function(){function e(t){var a=this;S(this,e),this.mode=null,this._handles=new ze.a,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new d.a,this.getFocused=function(){return a.ringManipulator.focused},this.getScale=function(){return Object(o.k)(a._scaleRotateDragData)&&"scale"===a._scaleRotateDragData.mode?a._scaleRotateDragData.scale:1},this.tool=t.tool,this.mode=t.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}return x(e,[{key:"destroy",value:function(){Object(o.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}},{key:"startAnimation",value:function(e){var t=this;this.cancelActiveAnimation(),e.start();var a=Object(Wt.a)({update:function(a){var i=a.deltaTime;e.update(i)&&t.cancelActiveAnimation()}});this._activeAnimation=v(v({},e),{},{frameTask:a})}},{key:"cancelActiveAnimation",value:function(){Object(o.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)}},{key:"forEachManipulator",value:function(e){e(this.ringManipulator,4)}},{key:"createManipulator",value:function(){var e=this;this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);var t=this.ringManipulator,a=this.tool.graphicState.graphic,i=Object(Ue.e)(t,function(t,i,n){e._scaleRotateDragData=null;var r=function(e,t){var a=e.allLayerViews.find(function(e){return e.layer===t.layer});if(Object(o.j)(t.symbol))return null;var i=t.symbol;return{symbolLayers:i.symbolLayers.map(function(e){var t=null;return"object"===e.type&&(t=e.heading),{heading:t,size:a.getSymbolLayerSize(i,e)}}).toArray()}}(e.tool.view,a);if(Object(o.j)(r))return e.updateDragState(),null;var s={mode:"none",origin:Object(K.d)(t.renderLocation),angle:0,startAngle:e.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:r};e._scaleRotateDragData=s,e.updateDragState();var l=vt.d.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,l),i.next(Object(gt.f)(e.tool.view,Xt.e.fromPositionAndNormal(t.renderLocation,l))).next(function(t){var i=Xt.e.normal(t.plane),n=Object(Ze.a)(t.renderStart,t.renderEnd,s.origin,i),r=oe.c.shortestSignedDiff(s.angle,n);s.angleDir=Object(Ye.c)(s.angleDir+r,-.3,.3),s.angle=n;var l=function(e,t){var a=Object(Q.i)(vt.d.get(),t.renderStart,e.origin),i=Object(Q.i)(vt.d.get(),t.renderEnd,e.origin),n=Object(Q.o)(a),r=Object(Q.o)(i);return 0===n?0:r/n}(s,t),c=l-s.scale;if(s.scaleDir=Object(Ye.c)(s.scaleDir+c,-.2,.2),s.scale=l,e.onScaleChanged(),"none"===s.mode){var u=e.mode||function(e,t,a,i){var n=e.renderStart,r=e.renderEnd,o=Qt(n,i,vt.d.get()),s=Qt(r,i,vt.d.get());if(Object(Q.k)(o,s)<100)return null;var l=Object(Q.i)(vt.d.get(),n,a),c=Object(Q.f)(vt.d.get(),l,t),u=n,h=Object(Q.e)(vt.d.get(),u,c),p=Qt(a,i,vt.d.get()),d=o,v=Qt(h,i,vt.d.get()),f=Object(Q.i)(vt.d.get(),v,d),g=Object(Q.i)(vt.d.get(),o,p),b=Xt.f.wrap(d,f),m=Xt.f.wrap(p,g);return Xt.f.distance2(b,s)<Xt.f.distance2(m,s)?"rotate":"scale"}(t,t.plane,s.origin,e.tool.view.state.camera);if(Object(o.k)(u)){switch(u){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:a,angle:Object(Ye.n)(s.angle)});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:a,xScale:s.scale,yScale:s.scale})}s.mode=u}}if(e.updateDragState(),Object(o.k)(a.symbol)){var h=a.symbol.clone(),p=0,d=1;switch(s.mode){default:case"none":break;case"scale":d=s.scale;break;case"rotate":p=s.angle}e.applySymbolData(h,s.startSymbolData,p,d),a.symbol=h,e.updateManipulatorTransform()}switch(t.action){case"start":case"update":switch(s.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:a,angle:Object(Ye.n)(s.angle)});break;case"scale":e.tool.emit("graphic-scale",{graphic:a,xScale:s.scale,yScale:s.scale})}break;case"end":switch(s.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:a,angle:Object(Ye.n)(s.angle)});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:a,xScale:s.scale,yScale:s.scale});break;default:case"none":}}"end"===t.action&&(e.startAnimation(Jt(e,function(){return e.onScaleChanged()})),e._scaleRotateDragData=null,e.updateDragState())}),n.next(Object(Ue.l)(a)).next(function(){if(Object(o.k)(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:a,angle:Object(Ye.n)(e._scaleRotateDragData.startAngle)});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:a,xScale:1,yScale:1})}e.startAnimation(Jt(e,function(){return e.onScaleChanged()})),e._scaleRotateDragData=null}})});this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",function(t){"focus"===t.action?e.startAnimation(function(e,t){var a=0,i=null,n=function(){return!1};return{start:function(){i=e.getFocused,e.getFocused=n,a=0,t()},update:function(e){return a+=e,!i()||a>200?1:0},destroy:function(){e.getFocused=i,t()}}}(e,function(){return e.updateDelayedFocusedState()})):e.updateDelayedFocusedState()}),this.ringManipulator.events.on("immediate-click",function(e){e.stopPropagation()}),Object(b.init)(this.tool.graphicState,"displaying",function(t){return e.ringManipulator.available=t}),this.tool.graphicState.on("changed",function(){return Object(Ze.g)(e.tool.view,e.ringManipulator,a)})]),Object(Ze.g)(this.tool.view,this.ringManipulator,a)}},{key:"onScaleChanged",value:function(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}},{key:"updateDelayedFocusedState",value:function(){this.ringManipulator.updateStateEnabled(Lt.DelayedFocused,this.getFocused())}},{key:"updateDragState",value:function(){if(this.ringManipulator.updateStateEnabled(Lt.Unlocked,!(Object(o.k)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(o.k)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Lt.ScaleIn|Lt.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Lt.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Lt.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Lt.RotateLeft|Lt.RotateRight,!1),this.ringManipulator.updateStateEnabled(Lt.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Lt.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Lt.ScaleIn|Lt.ScaleOut|Lt.RotateLeft|Lt.RotateRight,!1)}},{key:"updateManipulatorTransform",value:function(){var e=Object(se.i)(vt.a.get()),t=this.tool.symbolRotationAngle;Object(se.q)(e,e,t,Object(K.g)(0,0,1));var a=this.getScale(),i=Object(se.o)(vt.a.get(),Object(Q.v)(vt.d.get(),a,a,a)),n=Object(se.i)(vt.a.get());Object(se.l)(n,i,e),this.ringManipulator.modelTransform=n}},{key:"createRingManipulator",value:function(){for(var e=function(e,t,a){for(var i=[],n=Math.ceil(128*(t-e)/(2*Math.PI)),r=0;r<n+1;r++){var o=e+r*(t-e)/n;i.push(Object(K.g)(a*Math.cos(o),a*Math.sin(o),0))}return i},t=function(t){return e(0,2*Math.PI,t)},a=function(e,t){return Me.a.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]]}(t),e,[],[],!1)},i=t(160),n=a(i,24),r={left:[],right:[]},o=[],s=0;s<2;s++){var l=s*Math.PI-Math.PI/4,c=Math.PI/2-ct,u=l+c,h=l+Math.PI/2-c,p=e(u,h,190),d=a(p,9);o.push(p),o.push(e(u,h,201)),r.left.push(d),r.right.push(d);for(var v=0;v<2;v++){var f=0===v,g=Object(le.b)();if(f){Object(se.r)(g,g,[1,-1,1]),Object(se.q)(g,g,-u,[0,0,1]);var b=Math.round(.2*(p.length-1));g[12]=p[b][0],g[13]=p[b][1],g[14]=p[b][2]}else{Object(se.q)(g,g,h,[0,0,1]);var m=Math.round(.8*(p.length-1));g[12]=p[m][0],g[13]=p[m][1],g[14]=p[m][2]}var y=Me.a.createExtrudedTriangle(60,0,23,.5);Me.a.transformInPlace(y,g),(f?r.left:r.right).push(y)}}for(var O=[],j=0;j<2;j++){var M=j*Math.PI-Math.PI/4,w=Math.PI/2-ut,k=M+Math.PI/2-w,x=e(M+w,k,213);O.push(a(x,9))}var S=t(190),P=t(213),E=a(S,9),A=a(P,9),D=t(130),G=t(107),R=a(D,9),C=a(G,9),T=this.createMaterial(),I=this.createMaterial(.66),V=this.createMaterial(.5),z=this.createMaterial(.33),H=[{geometry:n,material:T,stateMask:Lt.DelayedFocused},{geometry:n,material:V,stateMask:0}];this.mode&&"scale"!==this.mode||(H=H.concat([{geometry:O,material:T,stateMask:Lt.DelayedFocused|Lt.Unlocked},{geometry:E,material:I,stateMask:Lt.DelayedFocused|Lt.ScaleIn},{geometry:A,material:z,stateMask:Lt.DelayedFocused|Lt.ScaleIn},{geometry:R,material:I,stateMask:Lt.DelayedFocused|Lt.ScaleOut},{geometry:C,material:z,stateMask:Lt.DelayedFocused|Lt.ScaleOut}])),this.mode&&"rotate"!==this.mode||(H=H.concat([{geometry:r.right,material:T,stateMask:Lt.DelayedFocused|Lt.Unlocked},{geometry:r.left,material:T,stateMask:Lt.DelayedFocused|Lt.RotateLeft},{geometry:r.right,material:T,stateMask:Lt.DelayedFocused|Lt.RotateRight}]));var B=[i].concat(o);return new Ke.a({view:this.tool.view,renderObjects:H,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(_.d)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:B,direction:Object(K.g)(0,0,1)}})}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[].concat(st,[e]);return new ft.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"applySymbolData",value:function(e,t,a,i){var n=this;e.symbolLayers.forEach(function(e,r){var s=t.symbolLayers[r],l=s.heading,c=s.size;"object"===e.type&&(e.heading=(Object(o.k)(l)?l:0)-Object(Nt.c)(a),Object(o.k)(c)&&"width"in c&&(c.width=n.enforceNonZeroSize(c.width),c.height=n.enforceNonZeroSize(c.height),c.depth=n.enforceNonZeroSize(c.depth),e.width=c.width*i,e.depth=c.depth*i,e.height=c.height*i))})}},{key:"enforceNonZeroSize",value:function(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)}},{key:"test",get:function(){return{ringManipulator:this.ringManipulator}}}]),e}();function Qt(e,t,a){var i=t.projectToRenderScreen(e,Object(Yt.a)($t)),n=t.renderToScreen(i,ea);return Object(Q.v)(a,n[0],n[1],0)}function Jt(e,t){var a=null,i=1,n=function(){return i};return{start:function(){i=e.getScale(),a=e.getScale,e.getScale=n,t()},update:function(e){return i+=((i+1)/2-i)*Math.min(3*e,1),t(),Math.abs(i-1)<.01?1:0},destroy:function(){e.getScale=a,t()}}}var $t=Object(K.e)(),ea=Object(Yt.g)(),ta=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e)).enableZ=!0,i.enableRotation=!0,i.enableScaling=!0,i.type="transform-3d",i.handles=new ze.a,i.scaleRotate=null,i.snappingPipeline=new qe.a,i}return x(a,[{key:"initialize",value:function(){var e=this;this.graphicState=new Ae({graphic:this.graphic}),this.moveManipulation=new wt({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&We(this.graphic),radius:wt.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator(function(t){return e.handles.add(t.events.on("immediate-click",function(e){return e.stopPropagation()}))}),this.moveManipulation.elevationInfo=Object(_.d)(this.graphic);var t=this.graphic.geometry;this.moveManipulation.createGraphicDragPipeline(function(a,i,n,r,s){return Object(o.k)(t)&&"point"===t.type&&0===a&&(n=n.next(e.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new Fe.a({elevationInfo:Object(_.d)(e.graphic),pointer:s,geometry:new Be.a(He.c.fromGeometry(t,e.view.viewingMode),"point"),visualizer:new Le.a,excludeFeature:e.graphic}),snappingManager:e.snappingManager,cancel:r}),e.snappingPipeline.next)),n},this.graphicState,function(t){var a=t.action,i={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(a){case"start":e.emit("graphic-translate-start",i);break;case"update":e.emit("graphic-translate",i);break;case"end":e.emit("graphic-translate-stop",i)}}),this.moveManipulation.angle=this.symbolRotationAngle,(this.enableScaling||this.enableRotation)&&(this.scaleRotate=new Kt({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate"}),this.handles.add(this.scaleRotate.events.on("scale-changed",function(){return e.onScaleChanged()}))),this.handles.add([ot({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return Object(Ie.c)()}}),this.graphic.watch("symbol",function(){return e.updateMoveAngle()}),this.graphicState.on("changed",function(){return e.onGeometryChanged()}),this.hideManipulatorsForGraphicState(),this.view.watch("scale",function(){return e.updateMoveAngle()})]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()}},{key:"forEachManipulator",value:function(e){this.moveManipulation.forEachManipulator(e),Object(o.k)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}},{key:"hideManipulatorsForGraphicState",value:function(){var e=this;return this.graphicState.watch("displaying",function(t){e.forEachManipulator(function(e){return e.available=t}),e.moveManipulation.zManipulation.available=t&&e.enableZ&&We(e.graphic)})}},{key:"destroy",value:function(){this.handles.destroy(),this.moveManipulation.destroy(),this.scaleRotate=Object(o.e)(this.scaleRotate),this._set("view",null),this._set("graphic",null)}},{key:"snapToScene",set:function(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}},{key:"symbolRotationAngle",get:function(){var e=this.graphic.symbol;if(e){var t=e.symbolLayers.find(function(e){return"object"===e.type}),a=t&&t.heading||0;return Object(Nt.d)(-a)}return 0}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){Object(o.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onHide",value:function(){Object(o.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onScaleChanged",value:function(){if(!Object(o.j)(this.scaleRotate)){var e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}}},{key:"updateMoveAngle",value:function(){this.moveManipulation.angle="local"===this.view.viewingMode||this.view.scale<1e6?this.symbolRotationAngle:0}},{key:"onGeometryChanged",value:function(){Object(Ze.g)(this.view,this.moveManipulation,this.graphic)}},{key:"test",get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:Object(o.k)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}}]),a}(d.a.EventedMixin(P.a));Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],ta.prototype,"view",void 0),Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],ta.prototype,"graphic",void 0),Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],ta.prototype,"enableZ",void 0),Object(n.a)([Object(c.b)()],ta.prototype,"enableRotation",void 0),Object(n.a)([Object(c.b)()],ta.prototype,"enableScaling",void 0),Object(n.a)([Object(c.b)({value:!1})],ta.prototype,"snapToScene",null),Object(n.a)([Object(c.b)({constructOnly:!0})],ta.prototype,"snappingManager",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],ta.prototype,"type",void 0),ta=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],ta);var aa=a("gEht"),ia=a("AvGH"),na=a("M0lq"),ra=a("Hizz"),oa=(a("bJda"),a("SuVq")),sa=(a("4GrV"),a("BPBZ")),la=a("IEcw"),ca=a("Ango"),ua=a("VeZB"),ha=a("EVMh"),pa=a("1/dN"),da=a("fFEv"),va=a("NbNv"),fa=a("WVfK"),ga=a("hnWO"),ba=a("w6Td"),ma=a("ypgp"),ya=a("2jVe"),Oa=a("+h6m"),ja=a("jjdI"),_a=a("GJyJ"),Ma=a("jpeq"),wa=a("0nJL"),ka=a("agdK"),xa=a("h7dw"),Sa=a("cTsy"),Pa=function(e){y(a,e);var t=j(a);function a(e,i){var n;return S(this,a),(n=t.call(this,e,i)).stipplePattern=null,n.stippleTextureBind=null,n.stippleTextureRepository=e.stippleTextureRepository,n}return x(a,[{key:"initializeProgram",value:function(e){var t=a.shader.get(),i=this.configuration,n=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled});return new ja.a(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),Oa.a)}},{key:"dispose",value:function(){p(w(a.prototype),"dispose",this).call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}},{key:"bindPass",value:function(e,t,a){if(Ma.a.bindProjectionMatrix(this.program,a.camera.projectionMatrix),this.stipplePattern!==t.stipplePattern){var i=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,i),this.stipplePattern=i}if(this.configuration.stippleEnabled){var n=Object(o.k)(this.stippleTextureBind)?this.stippleTextureBind(e,0)*a.camera.pixelRatio:1;this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/n),this.program.setUniform2f("ndcToPixel",a.camera.fullViewport[2]/2,a.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",t.color),this.program.setUniform1f("alphaCoverage",Math.min(1,t.width*a.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){var r=Object(o.q)(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",r[0],r[1],r[2],r.length>3?r[3]:1)}4===this.configuration.output&&ka.a.bindOutputHighlight(e,this.program,a)}},{key:"bindDraw",value:function(e){Ma.a.bindView(this.program,e),wa.a.bindUniformsWithOrigin(this.program,this.configuration,e)}},{key:"initializePipeline",value:function(){var e=this.configuration,t=Object(_a.e)(770,1,771,771),a=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(_a.d)({blending:a,depthTest:xa.b,depthWrite:i,colorWrite:_a.b,stencilWrite:e.sceneHasOcludees?xa.h:null,stencilTest:e.sceneHasOcludees?t?xa.d:xa.c:null})};return 0===e.output?(this._occludeePipelineState=a(!0,e.transparent||e.stippleEnabled?t:null,_a.c),a(!1,e.transparent||e.stippleEnabled?t:null,_a.c)):a(!1)}},{key:"primitiveType",get:function(){return 1}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),a}(ma.a);Pa.shader=new ba.a(Sa.a,function(){return a.e(179).then(a.bind(null,"seFa"))});var Ea=function(e){y(a,e);var t=j(a);function a(){var e;return S(this,a),(e=t.apply(this,arguments)).output=0,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stippleIntegerRepeatsEnabled=!1,e.sceneHasOcludees=!1,e}return a}(ya.a);Object(n.a)([Object(ya.b)({count:8})],Ea.prototype,"output",void 0),Object(n.a)([Object(ya.b)()],Ea.prototype,"slicePlaneEnabled",void 0),Object(n.a)([Object(ya.b)()],Ea.prototype,"vertexColors",void 0),Object(n.a)([Object(ya.b)()],Ea.prototype,"transparent",void 0),Object(n.a)([Object(ya.b)()],Ea.prototype,"stippleEnabled",void 0),Object(n.a)([Object(ya.b)()],Ea.prototype,"stippleOffColorEnabled",void 0),Object(n.a)([Object(ya.b)()],Ea.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(n.a)([Object(ya.b)()],Ea.prototype,"sceneHasOcludees",void 0);var Aa=s.a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial"),Da=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e,Ca)).techniqueConfig=new Ea,i}return x(a,[{key:"getTechniqueConfig",value:function(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1;var t=Object(o.k)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&Object(o.k)(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,a,i,n,r,o,s,l){l?Object(da.d)(e,i,r,1,o):this.intersectLineGeometry(e,t,a,i,o)}},{key:"intersectLineGeometry",value:function(e,t,a,i,n){if(i.options.selectionMode&&!Object(ue.d)(t))if(Object(ha.g)(a)){var r=e.vertexAttributes.get("position").data,o=i.camera,s=Za;Object(na.c)(s,i.point),Object(Q.v)(Na[0],s[0]-2,s[1]+2,0),Object(Q.v)(Na[1],s[0]+2,s[1]+2,0),Object(Q.v)(Na[2],s[0]+2,s[1]-2,0),Object(Q.v)(Na[3],s[0]-2,s[1]-2,0);for(var l=0;l<4;l++)if(!o.unprojectFromRenderScreen(Na[l],Wa[l]))return;Xt.e.fromPoints(o.eye,Wa[0],Wa[1],Ya),Xt.e.fromPoints(o.eye,Wa[1],Wa[2],Xa),Xt.e.fromPoints(o.eye,Wa[2],Wa[3],Ka),Xt.e.fromPoints(o.eye,Wa[3],Wa[0],Qa);for(var c=Number.MAX_VALUE,u=0;u<r.length-5;u+=3)if(Ta[0]=r[u]+a[12],Ta[1]=r[u+1]+a[13],Ta[2]=r[u+2]+a[14],Ia[0]=r[u+3]+a[12],Ia[1]=r[u+4]+a[13],Ia[2]=r[u+5]+a[14],!(Xt.e.signedDistance(Ya,Ta)<0&&Xt.e.signedDistance(Ya,Ia)<0||Xt.e.signedDistance(Xa,Ta)<0&&Xt.e.signedDistance(Xa,Ia)<0||Xt.e.signedDistance(Ka,Ta)<0&&Xt.e.signedDistance(Ka,Ia)<0||Xt.e.signedDistance(Qa,Ta)<0&&Xt.e.signedDistance(Qa,Ia)<0)){if(o.projectToRenderScreen(Ta,Ha),o.projectToRenderScreen(Ia,Ba),Ha[2]<0&&Ba[2]>0){Object(Q.i)(Va,Ta,Ia);var h=o.frustum,p=-Xt.e.signedDistance(h[4],Ta)/Object(Q.g)(Va,Xt.e.normal(h[4]));Object(Q.d)(Va,Va,p),Object(Q.e)(Ta,Ta,Va),o.projectToRenderScreen(Ta,Ha)}else if(Ha[2]>0&&Ba[2]<0){Object(Q.i)(Va,Ia,Ta);var d=o.frustum,v=-Xt.e.signedDistance(d[4],Ia)/Object(Q.g)(Va,Xt.e.normal(d[4]));Object(Q.d)(Va,Va,v),Object(Q.e)(Ia,Ia,Va),o.projectToRenderScreen(Ia,Ba)}else if(Ha[2]<0&&Ba[2]<0)continue;Ha[2]=0,Ba[2]=0;var f=Xt.d.distance2(Xt.d.fromPoints(Ha,Ba,qa),s);f<c&&(c=f,Object(Q.j)(Fa,Ta),Object(Q.j)(Ua,Ia))}var g=i.rayBeginPoint,b=i.rayEndPoint;if(c<4){var m=Number.MAX_VALUE;if(Xt.d.closestLineSegmentPoint(Xt.d.fromPoints(Fa,Ua,qa),Xt.d.fromPoints(g,b,La),za)){Object(Q.i)(za,za,g);var y=Object(Q.o)(za);Object(Q.d)(za,za,1/y),m=y/Object(Q.n)(g,b)}n(m,za)}}else Aa.error("intersection assumes a translation-only matrix")}},{key:"computeAttachmentOrigin",value:function(e,t){var a=e.vertexAttributes;if(!a)return!1;var i=a.get("position");return Object(ie.a)(i,null,!1,t)}},{key:"createBufferWriter",value:function(){var e=this.params.vertexColors?ga.b:ga.c;return Object(o.j)(this.params.stipplePattern)?new ga.a(e):new Ra(e.clone().vec3f("auxpos1"))}},{key:"getGLMaterial",value:function(e){return 0===e.output||4===e.output?new Ga(e):void 0}}]),a}(va.a),Ga=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e)).updateParameters(),i}return x(a,[{key:"updateParameters",value:function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(Pa,this.material.getTechniqueConfig(this.output),this.technique)}},{key:"beginSlot",value:function(e){return 3===e}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}},{key:"ensureParameters",value:function(e){0===this.output&&this._updateOccludeeState(e)}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}},{key:"getPipelineState",value:function(e,t){return this.technique.getPipelineState(t)}}]),a}(pa.a),Ra=function(){function e(t){S(this,e),this.vertexBufferLayout=t}return x(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,a,i){Object(fa.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,a,i),this.writeAuxpos1(e,t,a,i)}},{key:"writeAuxpos1",value:function(e,t,a,i){var n=a.getField("auxpos1",ua.u),r=t.indices.get("position"),o=t.vertexAttributes.get("position").data,s=e.transformation,l=n.typedBufferStride,c=n.typedBuffer;i*=l;for(var u=0;u<r.length;u+=2)for(var h=3*r[u],p=o[h],d=o[h+1],v=o[h+2],f=s[0]*p+s[4]*d+s[8]*v+s[12],g=s[1]*p+s[5]*d+s[9]*v+s[13],b=s[2]*p+s[6]*d+s[10]*v+s[14],m=0;m<2;++m)c[i]=f,c[i+1]=g,c[i+2]=b,i+=l}}]),e}(),Ca=v({color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1},va.b),Ta=Object(K.e)(),Ia=Object(K.e)(),Va=Object(K.e)(),za=Object(K.e)(),Ha=Object(Yt.e)(),Ba=Object(Yt.e)(),Fa=Object(K.e)(),Ua=Object(K.e)(),qa=Xt.d.create(),La=Xt.d.create(),Za=Object(K.e)(),Na=[Object(Yt.e)(),Object(Yt.e)(),Object(Yt.e)(),Object(Yt.e)()],Wa=[Object(K.e)(),Object(K.e)(),Object(K.e)(),Object(K.e)()],Ya=Xt.e.create(),Xa=Xt.e.create(),Ka=Xt.e.create(),Qa=Xt.e.create();a("lObl"),Object(r.a)("mac"),Math.cos(Object(Ye.d)(45)),Math.cos(Object(Ye.d)(5));var Ja=[1,.5,0],$a=[].concat(Ja,[1]),ei=[1,1,1,1],ti=[1,.8,.6,1],ai=[1,.93,.86,1],ii=[].concat(Ja,[1]),ni=[].concat(Ja,[1]),ri=a("cKKt"),oi=a("sE2g"),si=function(e){y(a,e);var t=j(a);function a(){return S(this,a),t.apply(this,arguments)}return x(a,[{key:"initializeProgram",value:function(e){var t=a.shader.get().build();return new ja.a(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),Oa.a)}},{key:"bindPass",value:function(e,t,a){Ma.a.bindProjectionMatrix(this.program,a.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",t.backgroundColor),this.program.setUniform4fv("gridColor",t.gridColor),this.program.setUniform1f("gridWidth",t.gridWidth)}},{key:"bindDraw",value:function(e){Ma.a.bindView(this.program,e)}},{key:"initializePipeline",value:function(){return Object(_a.d)({blending:Object(_a.e)(1,1,771,771),depthTest:{func:513},colorWrite:_a.b})}}]),a}(ma.a);si.shader=new ba.a(oi.a,function(){return a.e(182).then(a.bind(null,"B0gI"))}),Object(n.a)([Object(ri.c)()],function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e)).technique=new si(i.techniqueRep.constructionContext,null),i.updateParameters(),i}return x(a,[{key:"updateParameters",value:function(){}},{key:"beginSlot",value:function(e){return 8===e}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.params,t)}}]),a}(pa.a).prototype,"technique",void 0);var li=a("aK8v"),ci=a("dDjh"),ui=a("xtdb"),hi=a("89mX"),pi=function(e){y(a,e);var t=j(a);function a(){return S(this,a),t.apply(this,arguments)}return x(a,[{key:"initializeProgram",value:function(e){var t=a.shader.get(),i=this.configuration,n=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new ja.a(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),Oa.a)}},{key:"bindPass",value:function(e,t,a){Ma.a.bindProjectionMatrix(this.program,a.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity),a.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",a.camera.nearFar),this.program.setUniform2fv("inverseViewport",a.inverseViewport),Object(ui.a)(this.program,e,a))}},{key:"bindDraw",value:function(e){Ma.a.bindView(this.program,e),wa.a.bindUniformsWithOrigin(this.program,this.configuration,e)}},{key:"setPipelineState",value:function(e,t){var a=this.configuration,i=3===e,n=2===e;return Object(_a.d)({blending:0!==a.output&&7!==a.output||!a.transparent?null:i?di:Object(ci.a)(e),culling:function(e){return 0!==e&&{face:1===e?1028:1029,mode:2305}}(a.cullFace),depthTest:{func:Object(ci.b)(e)},depthWrite:i?a.writeDepth&&_a.c:Object(ci.c)(e),colorWrite:_a.b,stencilWrite:a.sceneHasOcludees?xa.h:null,stencilTest:a.sceneHasOcludees?t?xa.d:xa.c:null,polygonOffset:i||n?null:Object(ci.g)(a.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),a}(ma.a);pi.shader=new ba.a(hi.a,function(){return a.e(175).then(a.bind(null,"wFaR"))});var di=Object(_a.f)(1,771),vi=function(e){y(a,e);var t=j(a);function a(){var e;return S(this,a),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!0,e}return a}(ya.a);Object(n.a)([Object(ya.b)({count:8})],vi.prototype,"output",void 0),Object(n.a)([Object(ya.b)({count:3})],vi.prototype,"cullFace",void 0),Object(n.a)([Object(ya.b)()],vi.prototype,"slicePlaneEnabled",void 0),Object(n.a)([Object(ya.b)()],vi.prototype,"transparent",void 0),Object(n.a)([Object(ya.b)()],vi.prototype,"enableOffset",void 0),Object(n.a)([Object(ya.b)()],vi.prototype,"writeDepth",void 0),Object(n.a)([Object(ya.b)()],vi.prototype,"sceneHasOcludees",void 0),Object(n.a)([Object(ya.b)({count:4})],vi.prototype,"transparencyPassType",void 0),Object(n.a)([Object(ya.b)()],vi.prototype,"multipassTerrainEnabled",void 0),Object(n.a)([Object(ya.b)()],vi.prototype,"cullAboveGround",void 0);var fi,gi=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e,mi)).supportsEdges=!0,i.techniqueConfig=new vi,i}return x(a,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<ci.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,a,i,n,r,o){Object(da.e)(e,t,i,n,r,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output?new bi(e):void 0}},{key:"createBufferWriter",value:function(){return new ga.a(ga.d)}}]),a}(va.a),bi=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,v(v({},e),e.material.params))).updateParameters(),i}return x(a,[{key:"updateParameters",value:function(e){this.updateTexture(this.material.params.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(pi,this.material.getTechniqueConfig(this.output,e),this.technique)}},{key:"beginSlot",value:function(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}},{key:"ensureParameters",value:function(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}},{key:"getPipelineState",value:function(e,t){return this.technique.getPipelineState(t)}}]),a}(li.a),mi=v({transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0},va.b),yi=a("f/qv"),Oi=a("Gj5k"),ji=a("xvdR"),_i=a("ag7Y"),Mi=fi=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e)).type="plane",i.position=null,i.heading=0,i.tilt=0,i.width=10,i.height=10,i}return x(a,[{key:"clone",value:function(){return new fi({position:Object(yi.a)(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}},{key:"equals",value:function(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(o.k)(this.position)&&Object(o.k)(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}}]),a}(_i.a);function wi(e){var t=Object(Q.o)(e.basis1),a=Object(Q.o)(e.basis2);return.3*Math.min(t,a)}function ki(e){return wi(e)}function xi(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Si(e,t,a){var i=[];if(Object(o.k)(t))i.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else for(var n=0;n<12;n++){var r=n/12*2*Math.PI;i.push([Math.cos(r)*e,Math.sin(r)*e])}return Me.a.createPathExtrusionGeometry(i,a,[],[],!1)}Object(n.a)([Object(c.b)({readOnly:!0,json:{read:!1,write:!0}})],Mi.prototype,"type",void 0),Object(n.a)([Object(c.b)({type:oa.a}),Object(ji.a)()],Mi.prototype,"position",void 0),Object(n.a)([Object(c.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(ji.a)(),Object(Oi.a)(function(e){return oe.b.normalize(Object(l.i)(e),0,!0)})],Mi.prototype,"heading",void 0),Object(n.a)([Object(c.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(ji.a)(),Object(Oi.a)(function(e){return oe.b.normalize(Object(l.i)(e),0,!0)})],Mi.prototype,"tilt",void 0),Object(n.a)([Object(c.b)({type:Number,nonNullable:!0}),Object(ji.a)()],Mi.prototype,"width",void 0),Object(n.a)([Object(c.b)({type:Number,nonNullable:!0}),Object(ji.a)()],Mi.prototype,"height",void 0),Mi=fi=Object(n.a)([Object(u.a)("esri.widgets.Slice.SlicePlane")],Mi),s.a.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");var Pi=(Xt.f.create(),Math.PI/2),Ei=function(){function e(){S(this,e),this.lastDragEvent=null,this.next=new Ue.a,this._enabled=!1}return x(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&Object(o.k)(this.lastDragEvent)){var t=v(v({},this.lastDragEvent),{},{action:"update"});e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;return this.lastDragEvent=null,function(t){return e.lastDragEvent="end"!==t.action?v({},t):null,e._enabled&&e.adjustScaleFactors(t),t}}},{key:"adjustScaleFactors",value:function(e){var t=xi(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}},{key:"test",get:function(){var e=this;return{adjustScaleFactors:function(t){return e.adjustScaleFactors(t)}}}}]),e}(),Ai=a("NPIS"),Di=a("FXzB"),Gi=a("4eAd"),Ri=a("+9DA");function Ci(e,t){return Ii(e,t,!1)}function Ti(e,t){return Ii(e,t,!0)}function Ii(e,t,a){if(e instanceof Ai.b){if(e.operation instanceof Di.a)return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=a?-1:1,n=Object(K.g)(i*e.dx,i*e.dy,i*e.dz);Object(Q.e)(t.origin,t.origin,n)}(e.operation,t,a),!0;if(e.operation instanceof Gi.a)return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=a?-e.angle:e.angle;Object(Q.c)(t.basis1,t.basis1,K.b,i),Object(Q.c)(t.basis2,t.basis2,K.b,i)}(e.operation,t,a),!0;if(e.operation instanceof Ri.a)return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=a?1/e.factor1:e.factor1,n=a?1/e.factor2:e.factor2;Object(Q.d)(t.basis1,t.basis1,i),Object(Q.d)(t.basis2,t.basis2,n),Vi(t.origin,e.origin,e.axis1,i),Vi(t.origin,e.origin,e.axis2,n)}(e.operation,t,a),!0}return!1}function Vi(e,t,a,i){var n=vt.c.get(),r=Object(na.d)(n,e,t),o=Object(na.a)(n,a,Object(na.g)(a,r));Object(na.o)(e,e,o,i-1)}var zi=function(e){y(a,e);var t=j(a);function a(e){var i;return S(this,a),(i=t.call(this,e)).enableZ=!0,i.enableRotation=!0,i.enableScaling=!0,i._preserveAspectRatio=new Ei,i.grabbing=!1,i.inputState=null,i.type="transform-3d",i.handles=new ze.a,i.moveZManipulator=null,i.resizeManipulators=null,i.rotateManipulator=null,i.attachmentOrigin=null,i.outlineVisualElement=null,i.mapBounds=Xt.a.create(),i.mapBoundsStart=Xt.a.create(),i.displayBounds=Xt.a.create(),i.displayBoundsStart=Xt.a.create(),i.displayBoundsMarginStart=0,i.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],i}return x(a,[{key:"initialize",value:function(){var e=this;this.graphicState=new Ae({graphic:this.graphic});var t=this.graphic.geometry;this.reshapeHelper=new Ut(He.c.fromGeometry(t,this.view.viewingMode),t.type),this.graphicMoveManipulation=new St({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=0===t?40:0,i=[Object(K.g)(a,0,-24),Object(K.g)(a,0,24)],n=function(e,t){var a=Object(Q.i)(Object(K.e)(),e[e.length-1],e[e.length-2]);Object(Q.q)(a,a),Object(Q.d)(a,a,12),Object(Q.e)(a,a,e[e.length-1]);var i=Object(Q.i)(Object(K.e)(),e[0],e[1]);return Object(Q.q)(i,i),Object(Q.d)(i,i,12),Object(Q.e)(i,i,e[0]),[i].concat(h(e),[a])}(i),r=function(e,t){return function(e,t,a){var i=function(i){var n=(i?t:e).slice(0),r=Object(Q.i)(vt.d.get(),n[0],n[1]);Object(Q.q)(r,r);var s=Object(Q.i)(vt.d.get(),n[n.length-1],n[n.length-2]);if(Object(Q.q)(s,s),a.padding>0){var l=Object(Q.d)(Object(K.e)(),s,-a.padding);if(n[n.length-1]=Object(Q.e)(l,l,n[n.length-1]),a.bothEnds){var c=Object(Q.d)(Object(K.e)(),r,-a.padding);n[0]=Object(Q.e)(c,c,n[0])}}var u=i?a.tipFocusMultiplier:1,h=a.tipLength*(a.focusTipLength?u:1),p=a.tipRadius*u,d=Object(se.i)(vt.a.get());if(a.padding>0){var v=h/4,f=Object(Q.v)(vt.d.get(),0,v,0),g=1+a.padding/v;Object(se.s)(d,d,f),Object(se.r)(d,d,Object(Q.v)(vt.d.get(),g,g,g)),Object(se.s)(d,d,Object(Q.d)(f,f,-1/g))}var b=Object(se.i)(Object(le.b)()),m=Object(K.g)(0,1,0),y=Object(se.p)(Object(le.b)(),Object(sa.d)(vt.b.get(),m,s));y[12]=n[n.length-1][0],y[13]=n[n.length-1][1],y[14]=n[n.length-1][2],Object(se.l)(y,y,d);var O,j,_=[{part:"tube",geometry:Si(a.tubeRadius*(i?a.tubeFocusMultiplier:1)+a.padding,a.flat,n),transform:b}];if(Object(o.k)(a.flat)?O=Me.a.createExtrudedTriangle(h,p,p,a.flat.thickness):(O=Me.a.createConeGeometry(h,p,24,!1,!1,!0),j=Me.a.createConeGeometry(h,p,24,!1,!0,!1)),_.push({part:"tip",geometry:O,transform:y}),j&&_.push({part:"cap",geometry:j,transform:y}),a.bothEnds){var M=Object(se.p)(Object(le.b)(),Object(sa.d)(vt.b.get(),m,r));M[12]=n[0][0],M[13]=n[0][1],M[14]=n[0][2],Object(se.l)(M,M,d),_.push({part:"tip",geometry:O,transform:M}),j&&_.push({part:"cap",geometry:j,transform:M})}return _};return{normal:i(!1),focused:i(!0)}}(i,i,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t})},s=r(0,!1),l=r(2.25,!0),c=new ft.a({color:ei,cullFace:2,renderOccluded:16}),u=new ft.a({color:ti,cullFace:2,renderOccluded:16}),p=new ft.a({color:ai,cullFace:2,renderOccluded:16}),d=new ft.a({color:ni,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),v=Me.a.createPolylineGeometry([[a,0,0],[a-40,0,0]]),f=Me.a.createPolylineGeometry([[a,0,0],[a-40,0,0]]),g=new Da({color:ii,renderOccluded:4});return new Ke.a({view:e,renderObjects:[].concat(h(s.normal.map(function(e){var t=e.part,a=e.geometry,i=e.transform;return{geometry:a,material:"tip"===t?c:"cap"===t?u:p,transform:i,stateMask:17}})),h(l.normal.map(function(e){var t=e.geometry,a=e.transform;return{geometry:t,material:d,transform:a,stateMask:17}})),[{geometry:v,material:g,stateMask:49}],h(s.focused.map(function(e){var t=e.part,a=e.geometry,i=e.transform;return{geometry:a,material:"tip"===t?c:"cap"===t?u:p,transform:i,stateMask:18}})),h(l.focused.map(function(e){var t=e.geometry,a=e.transform;return{geometry:t,material:d,transform:a,stateMask:18}})),[{geometry:f,material:g,stateMask:50}]),autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:11,state:16})}(this.view,0),this.moveZManipulator.state|=32,this.handles.add(this.watch("enableZ",function(){return e.updateManipulatorAvailability(e.moveZManipulator,0)})),this.handles.add(this._createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map(function(t){var a=function(e,t){var a=xi(t),i=a?[Object(K.g)(1,0,0),Object(K.g)(0,0,0),Object(K.g)(0,1,0)]:[Object(K.g)(1,0,0),Object(K.g)(-1,0,0)],n=Me.a.createPolylineGeometry(i),r=[].concat(Ja,[1]),o=a?4:1,s=2*o,l=function(e){return e>1?function(e){return new re.a({color:r,width:e,renderOccluded:4})}(e):new Da({color:r,renderOccluded:4})},c=[{geometry:n,material:l(o),stateMask:17},{geometry:n,material:l(s),stateMask:18},{geometry:n,material:l(1),stateMask:32}],u=new Ke.a({view:e,renderObjects:c,collisionType:{type:"line",paths:[i]},autoScaleRenderObjects:!1,worldSized:!0,radius:a?6:4,idHint:a?1:2});return u.state=16,u}(e.view,t);return e.handles.add(e.watch("enableScaling",function(){return e.updateManipulatorAvailability(a,2)})),a.events.on("grab-changed",function(t){return e._onResizeGrab(t)}),e.handles.add(e._createResizeDragPipeline(a,t)),a}),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new ra.a("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAK4UExURUdwTP9+AP9tAP9+AP99AP9VAP99AP99AP9+AP9+AP99AP99AP98AP8AAP99AP/9/P+ABf9/Af/Jlf////9/AP9/AP99AP9xAP9/AP94AP9+AP9+AP/16//38f9/AP97AP99AP99AP99AP9zAP9+AP9/AP/o0v/w4v+IE//PoP/59f+DCf99AP98AP+EC/+eQP/kyf/27//at/+VLf/59f+WL//8+/+LHP9+AP9/AP99AP/38P/nz//48/+dPv/7+P/NnP+HEf/8+v/9/f/8+//ewf+SKv/WsP+MHv98AP/27//17P/hxf++f//27v9+AP99AP+1bP98AP9+AP/o0/9+AP+BB/97AP/QpP98AP+uYP9/AP+AA/+QJP+rWP/q1v/Fjf+fQf/hx//Onv/fwP/9/P99AP/ev/+kTP+KGP+vYv/s2v9/AP+oU/+1b/98AP98AP96AP97AP9+AP9/AP9/AP96AP9/AP99AP/Ztf+rW/+mUP98AP+1b//48v/38f98AP+cO//38P99AP/nz//Pov99AP/HkP+fQ/+tX/99AP/69//v4P+6eP/DiP/z6P+TK/+JFv+EDf/s2//lzP+8ev96AP+8ff+YNP9/AP/Tqv+iSf96AP+tXv9/AP/Lm/98AP/lzP/Uq/+tXf/9/P/06f/Hk/+9fv/u3f/Klv/Spf+oVv+za/+jSv/Lmf/q1f/Gjv+1bf/69//Sp/+bOv/PoP+3c//z5/9/AP/Ikv/r1/+hRv/FjP/Mmv+ZN//06v/59P/69f/q1v/x5P9/AP+PI/+3cf/9+//8+v+gRP/16//o0//Ztf+nUv/17P/Hkf/ixv/s2v/59P/48//Di/+lT//ky//hxf/Wrv+oVf/u3f/w4//Wrf+5dv/gxP/7+f/z6P/dvP+6d//u3v+aOP/r2f/r2f///9a+uZsAAADndFJOUwB9B29qA1OAd38/RykBeP6BgLX+KhJ2CQgRdWHt8zpGOUVmC2sK2uaFu/aCQS+DktPwyIz3jfyHZz5o8tf1kvq4hPz+/c6LxIhi8e/RqvBjfKJaedtbgki8K54GgYqb3bGT0rnN/XDNloae30CZpFJUG0BlGhgZUjPHnJgto/PyUJHxUdi8dLKTnU/55aev64yGg+DWqDipjizAlTCdArgx1cCc/Ou0quG1vZqilrfcsaP4vpC6peoos96UsLeP7PX33OcyiaT8+5Tu2saY7rPR4Pb0sJfV0MKZ4ufBptD66sun4pDf3qyDniQAAAO+SURBVFjDpVf1WxRBGF7gYO64A+5OJKU7lFRaSlLARlBpsEVFwu7u7u7u7u7ubt1/w7vZPXZmd/bYffx+geed731vZme+oigR83NsGBNvpbSwUFrF29g6+lGybKxaoQKYqRTqRqlsS09/QDR/T0sJdOdwJRA15Ujntvgd3YBZU661M0dv3wO0aXntxfkaeyDB+mwQodv1BxJNTTyGtQ2QbDbWBH4/02qMBIXeQoVZrYt/h0vZA/8U3PmHtvs0SIKCF84v5Vbe0XQl/GfTgejAoKDFgY/nDSUpTMbun7u/zl1o+lUc6BrdneasQ06EQMDeFRFA3s97I2FIpAONm0OBQMKd49/m0OCXRvfd92iB1W3U8hQ2t8aPEwfq2T3TBFu1Hhdwc2EFwjlMt4d1vsH8meYR245TyO+KK9iy8Y/E70+TrwdN/wp5km6AVpSXBJnQpCo8NJn84IlAI1p/7UU5Au+6yaJP4zAFbyig4IBR3HZjyzDXwlgG3oHnKJj/EOA58sl+4OeNiGLgSgxtNgioAfaIuJt/gyucZhQ8gvkPGjlBVU30249R3ViFEbxrP8TIz0GxREP+V/FfmG75hy/6z18rvtfzFkKgQEoxmu0DKEfpaaQTEx53UUxDjZQuAPZCgQL8LY2RIZCbAT8jCrVQvjIEQF+4hWwEGUcNliOwEwpMQRArSilHoBAKXEYQJ8pCjsAJKKBHkJ7yBIZDgRpMQNYR1kCBC9gRZH3EK1DgLPYRZV1jNRQ4gl2jjIoIdFON/NSVCDSaasB9hr3+s0VUoBfcQCAKJWDBpK2v/kbTyaICFVDgKB5MaDj/rjM6ZA4wu4GMGDyc0YQCIqHLtXQif1gRXK1FsXg8pYFRTBFYrSXww5hIynyAgj4GgUYUqGWyWVaxMJswu6MnYGgTL62DuJmM28U7PH72frbmBQvSOlZYwGE2paYcR7sMrT6Uge8vIBQWSywclppq4cOQqyw042CRKdWvI5U2tLgaLI2rpvnJQ3KyZidxpeIZsbhSznh7uy+VJtuiJTh/rqm8U9vxhUnniPxbl3gftiPXouTxrjztpIAeqteKtzhok8VY2Rm8R1m2Lddsk0WoT7oBp44xd3f9UclEnfBlavBGUU0uZp3nx4SRI8uH3+pOB7JM0OoizbYUIzTb1NaF0vmjrYkTh5dEuspHbOQ5L6lI9CkVH5pc3dvmu7v+39g3vq3B0cXWzDmcbF0kzK4DvRVkusJ7oNTxudkrkT98J/o0yRvgAzQJNr7M+O/bkqAJEPP7B6FvZpCHDcaFAAAAAElFTkSuQmCC",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=function(e,t){var a=new gi({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),i=40,n=27*1.1,r=function(e){var t=new Uint32Array([0,1,2,2,3,0]);return new ca.a([["position",{size:3,data:[i-e,-e,0,i+e,-e,0,i+e,e,0,i-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},o=Me.a.createPolylineGeometry([[0,0,0],[13,0,0]]),s=Me.a.createPolylineGeometry([[0,0,0],[i-n,0,0]]),l=new Da({color:$a,renderOccluded:4}),c=[{geometry:r(27),material:a,stateMask:17},{geometry:o,material:l,stateMask:17},{geometry:r(n),material:a,stateMask:18},{geometry:s,material:l,stateMask:18}];return new Ke.a({view:e,renderObjects:c,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[i,0,0]},collisionPriority:1,radius:13.5,state:16})}(this.view,this.rotateManipulatorTexture),this.handles.add(this.watch("enableRotation",function(){return e.updateManipulatorAvailability(e.rotateManipulator,3)})),this.rotateManipulator.events.on("grab-changed",function(t){e._onRotateGrab(t)}),this.handles.add(this._createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds(this.mapBounds);var a=ot({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return Object(Ie.c)()}});this.outlineVisualElement=a.visualElement instanceof ye?a.visualElement:null,Object(o.k)(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",function(){return e.updateDisplayBounds(e.mapBounds)})),this.handles.add(a),this.handles.add([this.graphicState.on("changed",function(){return e.onGeometryChanged()}),this.graphicState.watch("displaying",function(){return e.updateAllManipulatorAvailability()}),Object(b.init)(this.graphicState,"isDraped",function(){return e.graphicDrapedChanged()}),this.view.trackGraphicState(this.graphicState)]);var i=this.view.pointsOfInterest;i&&this.handles.add(i.focus.watch("location",function(){return e.updateDisplayBounds(e.mapBounds)}));var n=function(t){e.handles.add(t.events.on("grab-changed",function(){e.grabbing=t.grabbing,e.updateAllManipulatorAvailability()}))};this.forEachManipulator(n),this.graphicMoveManipulation.forEachManipulator(n);var r=function(t,a){e.handles.add(t.events.on("immediate-click",function(t){1===a&&e.emit("immediate-click",v(v({},t),{},{graphic:e.graphic})),t.stopPropagation()}))};this.forEachManipulator(r),this.graphicMoveManipulation.forEachManipulator(r),this.onGeometryChanged(),this.updateAllManipulatorAvailability()}},{key:"graphicDrapedChanged",value:function(){var e=this;this.handles.remove(Hi),this.updateDisplayBounds(this.mapBounds),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",function(t){Object(o.k)(e.attachmentOrigin)&&Object(tt.f)(t.extent,e.attachmentOrigin.x,e.attachmentOrigin.y)&&e.updateDisplayBounds(e.mapBounds)}),Hi)}},{key:"updateAllManipulatorAvailability",value:function(){var e=this;this.forEachManipulator(function(t,a){return e.updateManipulatorAvailability(t,a)})}},{key:"updateManipulatorAvailability",value:function(e,t){var a=this.graphicState.displaying,i=this.grabbing&&!e.grabbing;e.interactive=!i;var n=this.enableZ&&We(this.graphic);switch(t){case 3:e.available=a&&this.enableRotation;break;case 2:e.available=a&&(this.enableScaling||this.enableRotation||n),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?16:32;break;case 0:e.available=a&&n;break;default:e.available=a}}},{key:"forEachManipulator",value:function(e){this.resizeManipulators.forEach(function(t){return e(t,2)}),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}},{key:"destroy",value:function(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.reshapeHelper.destroy(),this._set("view",null),this._set("graphic",null)}},{key:"preserveAspectRatio",get:function(){return this._preserveAspectRatio.enabled},set:function(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){this.mapBounds=null,this.displayBounds=null}},{key:"onGeometryChanged",value:function(){this.updateDisplayBounds(this.mapBounds)}},{key:"calculateMapBounds",value:function(){var e=this.graphic.geometry,t=this.reshapeHelper.editGeometry,a=t.components[0].edges[0],i=Object(na.d)(vt.c.get(),a.left.pos,a.right.pos);Object(na.e)(i,i);var n=Object(o.r)(Object(Ze.f)(this.view,this.graphic),e.extent.center),r=Fi*this.view.pixelSizeAt(n),s=this.view.spatialReference;s!==e.spatialReference&&(r*=Object(aa.f)(s)/Object(aa.f)(e.spatialReference)),function(e,t,a,i){i||(i=Xt.a.create());var n=Object(na.r)(vt.c.get(),e[1],-e[0]),r=Object(na.r)(vt.c.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=Object(na.r)(vt.c.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),s=vt.c.get();t.components.forEach(function(t){return t.vertices.forEach(function(t){var a=t.pos;Object(na.r)(s,Object(na.g)(e,a),Object(na.g)(n,a)),Object(na.t)(r,r,s),Object(na.u)(o,o,s)})});var l=1e-6,c=Object(na.r)(vt.c.get(),o[0]-r[0]<l?a/2:0,o[1]-r[1]<l?a/2:0);Object(na.d)(r,r,c),Object(na.h)(o,o,c),Object(na.a)(i.basis1,e,(o[0]-r[0])/2),Object(na.a)(i.basis2,n,(o[1]-r[1])/2),Object(na.r)(i.origin,r[0]*e[0]+r[1]*n[0],r[0]*e[1]+r[1]*n[1]),Object(na.h)(i.origin,i.origin,i.basis1),Object(na.h)(i.origin,i.origin,i.basis2)}(i,t,r,this.mapBounds)}},{key:"updateDisplayBounds",value:function(e){var t=this.graphic.geometry,a=Object(o.k)(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(o.k)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Object(Ze.f)(this.view,this.graphic);this.attachmentOrigin=Object(o.r)(a,t.extent.center);var i=Object(o.k)(a)?a.z:Object(we.c)(e.origin,this.view.elevationProvider,ne.a.fromElevationInfo(Object(_.d)(this.graphic)),this.view.renderCoordsHelper),n=Xt.a.copy(e);Object(Q.v)(n.origin,e.origin[0],e.origin[1],i),function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;n||(n=Xt.a.create()),t.toRenderCoords(e.origin,a,n.origin);var r=vt.d.get();Object(Q.e)(r,e.origin,e.basis1),Object(Q.e)(r,r,e.basis2),t.toRenderCoords(r,a,r);var o=vt.d.get();Object(Q.e)(o,e.origin,e.basis1),Object(Q.i)(o,o,e.basis2),t.toRenderCoords(o,a,o);var s=vt.d.get();Object(Q.i)(s,e.origin,e.basis1),Object(Q.i)(s,s,e.basis2),t.toRenderCoords(s,a,s);var l=vt.d.get();Object(Q.i)(l,e.origin,e.basis1),Object(Q.e)(l,l,e.basis2),t.toRenderCoords(l,a,l);var c=Object(Q.h)(vt.d.get(),r,o,.5);Object(Q.i)(c,c,n.origin);var u=Object(Q.h)(vt.d.get(),s,l,.5);Object(Q.i)(u,n.origin,u),Object(Q.h)(n.basis1,c,u,.5);var h=Object(Q.h)(vt.d.get(),l,r,.5);Object(Q.i)(h,h,n.origin);var p=Object(Q.h)(vt.d.get(),o,s,.5);Object(Q.i)(p,n.origin,p),Object(Q.h)(n.basis2,h,p,.5);var d=Object(Q.f)(vt.d.get(),n.basis1,n.basis2),v=Object(Q.f)(d,d,n.basis1);Object(Q.q)(v,v),Object(Q.d)(n.basis2,v,Object(Q.g)(n.basis2,v)),Object(Q.d)(n.basis1,n.basis1,1+i/Object(Q.o)(n.basis1)),Object(Q.d)(n.basis2,n.basis2,1+i/Object(Q.o)(n.basis2)),Xt.a.updateUnboundedPlane(n)}(n,this.view.renderCoordsHelper,t.spatialReference,this.displayBoundsMargin(),this.displayBounds),this.updateManipulators()}},{key:"displayBoundsMargin",value:function(){var e=this.view.pointsOfInterest;return Bi*this.view.pixelSizeAt(e?e.focus.location:this.reshapeHelper.geometry.extent.center)}},{key:"_createMoveXYGraphicDragPipeline",value:function(){var e=this;return this.graphicMoveManipulation.createDragPipeline(function(t,a,i){return e.applyGraphicMoveSteps(a,i)})}},{key:"_createMoveZDragPipeline",value:function(){var e=this,t=this.view,a=this.reshapeHelper.geometry.spatialReference;return Object(Ue.e)(this.moveZManipulator,function(i,n,r){var o=Object(K.d)(i.renderLocation),s=n.next(Object(gt.g)(t,o,a)).next(Object(Ue.c)());e.applyGraphicMoveSteps(s,r)})}},{key:"applyGraphicMoveSteps",value:function(e,t){var a=this,i=e.next(function(e){return"start"===e.action&&(a.inputState={type:"move"},Xt.a.copy(a.mapBounds,a.mapBoundsStart),a.emit("graphic-translate-start",{graphic:a.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e}).next(Object(Ue.b)()).next(this._moveDragUpdateGeometry()).next(function(e){var t={graphic:a.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&a.emit("graphic-translate",t);break;case"end":a.inputState=null,a.emit("graphic-translate-stop",t)}return e});return t.next(function(){Object(o.k)(a.inputState)&&a.emit("graphic-translate-stop",{graphic:a.graphic,dxScreen:0,dyScreen:0}),a.cancel()}),i}},{key:"_moveDragUpdateGeometry",value:function(){var e=this;return function(t){if(Object(o.j)(e.inputState)||"move"!==e.inputState.type)return t;var a,i=[],n=g(e.reshapeHelper.editGeometry.components);try{for(n.s();!(a=n.n()).done;){var r=a.value;i.push.apply(i,h(r.vertices))}}catch(s){n.e(s)}finally{n.f()}return Ci(e.reshapeHelper.moveVertices(i,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,"start"===t.action?0:1),e.mapBounds),e.graphic.geometry=e.reshapeHelper.geometry,t}}},{key:"_onResizeGrab",value:function(e){if("start"===e.action){var t=this._calculatePickRay(e.screenPoint);Xt.e.intersectRay(this.displayBounds.plane,t,vt.d.get())&&(Xt.a.copy(this.displayBounds,this.displayBoundsStart),Xt.a.copy(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin(),this.inputState={type:"resize"})}}},{key:"_createResizeDragPipeline",value:function(e,t){var a=this;return Object(Ue.e)(e,function(e,i,n){Object(o.j)(a.inputState)||(i.next(function(e){return"start"===e.action&&a.emit("graphic-scale-start",{graphic:a.graphic,xScale:1,yScale:1}),e}).next(Object(gt.f)(a.view,a.displayBoundsStart.plane)).next(function(e){return v(v({},e),{},{handle:t})}).next(a._resizeDragRenderPlaneToFactors()).next(a._preserveAspectRatio.createDragEventPipelineStep(),a._preserveAspectRatio.next).next(a._resizeDragUpdateGeometry()).next(function(e){var t={graphic:a.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":a.emit("graphic-scale",t);break;case"end":a.inputState=null,a.emit("graphic-scale-stop",t)}return e}),n.next(function(){Object(o.k)(a.inputState)&&a.emit("graphic-scale-stop",{graphic:a.graphic,xScale:1,yScale:1}),a.cancel()}))})}},{key:"_resizeDragRenderPlaneToFactors",value:function(){var e=this;return function(t){var a=e.displayBoundsStart,i=t.handle.direction,n=e.displayBoundsMargin(),r=e.displayBoundsMarginStart,o=Object(Q.j)(vt.d.get(),a.origin);Object(Q.b)(o,o,a.basis1,-i[0]),Object(Q.b)(o,o,a.basis2,-i[1]);var s=Object(Q.i)(vt.d.get(),t.renderEnd,o),l=Object(Q.i)(vt.d.get(),t.renderStart,o),c=xi(t.handle),u=ki(a),h=ki(e.displayBounds)/u,p=function(e,t){if(0===e)return 1;var a=Object(Q.o)(t),i=.5*e*Object(Q.g)(t,s)/a,o=i<0?-1:1;c&&(i+=(a-.5*e*Object(Q.g)(t,l)/a)*o*h);var u=a<1.5*r?1:Ui;return a=Math.max(a-r,Ui),o>0&&(i-=n),o*Math.max(o*(i/a),u)};return v(v({},t),{},{factor1:p(i[0],a.basis1),factor2:p(i[1],a.basis2)})}}},{key:"_resizeDragUpdateGeometry",value:function(){var e=this;return function(t){var a=Object(Q.j)(Object(K.e)(),e.mapBoundsStart.origin);Object(Q.b)(a,a,e.mapBoundsStart.basis1,-t.handle.direction[0]),Object(Q.b)(a,a,e.mapBoundsStart.basis2,-t.handle.direction[1]);var i=Object(na.r)(Object(ia.a)(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);Object(na.e)(i,i);var n,r=[],o=g(e.reshapeHelper.editGeometry.components);try{for(o.s();!(n=o.n()).done;){var s=n.value;r.push.apply(r,h(s.vertices))}}catch(u){o.e(u)}finally{o.f()}var l="start"===t.action?0:1,c=e.reshapeHelper.scaleVertices(r,e.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(a),i,t.factor1,t.factor2,l,1);return Xt.a.copy(e.mapBoundsStart,e.mapBounds),Ci(c,e.mapBounds),e.graphic.geometry=e.reshapeHelper.geometry,t}}},{key:"_onRotateGrab",value:function(e){if("start"===e.action){var t=function(e,t,a,i){var n=t.worldUpAtPosition(e.origin,vt.d.get()),r=vt.d.get();return Object(Q.j)(r,n),Xt.e.fromPositionAndNormal(e.origin,r,i)}(this.displayBounds,this.view.renderCoordsHelper,0,Xt.e.create()),a=this._calculatePickRay(e.screenPoint);Xt.e.intersectRay(t,a,vt.d.get())&&(Xt.a.copy(this.displayBounds,this.displayBoundsStart),Xt.a.copy(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}}},{key:"_createRotateDragPipeline",value:function(e){var t=this;return Object(Ue.e)(e,function(e,a,i){var n=t.inputState;Object(o.j)(n)||(a.next(function(e){return"start"===e.action&&t.emit("graphic-rotate-start",{graphic:t.graphic,angle:0}),e}).next(Object(gt.f)(t.view,n.rotatePlane)).next(t._rotateDragRenderPlaneToRotate(n)).next(t._rotateDragUpdateGeometry()).next(function(e){var a={graphic:t.graphic,angle:Object(Ye.n)(e.rotateAngle)};switch(e.action){case"start":case"update":t.emit("graphic-rotate",a);break;case"end":t.inputState=null,t.emit("graphic-rotate-stop",a)}return e}),i.next(function(){Object(o.k)(t.inputState)&&t.emit("graphic-rotate-stop",{graphic:t.graphic,angle:0}),t.cancel()}))})}},{key:"_rotateDragRenderPlaneToRotate",value:function(e){var t=this;return function(a){var i=Xt.e.normal(e.rotatePlane),n=Object(Ze.a)(a.renderStart,a.renderEnd,t.displayBounds.origin,i);return v(v({},a),{},{rotateAxis:i,rotateAngle:n})}}},{key:"_rotateDragUpdateGeometry",value:function(){var e=this;return function(t){var a,i=Object(Q.j)(Object(K.e)(),e.mapBoundsStart.origin),n=[],r=g(e.reshapeHelper.editGeometry.components);try{for(r.s();!(a=r.n()).done;){var o=a.value;n.push.apply(n,h(o.vertices))}}catch(c){r.e(c)}finally{r.f()}var s="start"===t.action?0:1,l=e.reshapeHelper.rotateVertices(n,e.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(i),t.rotateAngle,s,1);return Xt.a.copy(e.mapBoundsStart,e.mapBounds),Ci(l,e.mapBounds),e.graphic.geometry=e.reshapeHelper.geometry,t}}},{key:"_calculatePickRay",value:function(e){var t=Xt.f.create(),a=Object(Yt.j)(e);return Xt.f.fromScreen(this.view.state.camera,a,t),Object(Q.q)(t.direction,t.direction),t}},{key:"updateManipulators",value:function(){var e=this;if(this.visible){var t=function(e,t){return Object(Ze.b)(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,vt.a.get());(function(e,t,a,i){var n=i.worldUpAtPosition(a.origin,vt.d.get()),r=function(e,t){return{basis:e.basis1,direction:1,position:Object(Q.e)(vt.d.get(),e.origin,e.basis1),edge:0}}(a),o=Object(se.i)(vt.a.get());Object(se.g)(o,o,r.edge*Math.PI/2),Object(se.e)(o,o,-function(e,t){return Object(la.b)(t,e.basis2,e.basis1)+Pi}(a,n)),Object(se.l)(o,t,o),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=r.position})(this.rotateManipulator,t,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,t),this.resizeManipulators.forEach(function(a,i){!function(e,t,a,i){var n=Object(Q.o)(i.basis1),r=Object(Q.o)(i.basis2),o=wi(i),s=ki(i),l=Object(Q.v)(vt.d.get(),0,0,0);Object(Q.e)(l,Object(Q.d)(vt.d.get(),i.basis1,t.direction[0]),Object(Q.d)(vt.d.get(),i.basis2,t.direction[1])),Object(Q.e)(l,i.origin,l);var c=0,u=1;if(xi(t))1===t.direction[0]&&-1===t.direction[1]?c=Pi:1===t.direction[0]&&1===t.direction[1]?c=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(c=3*Math.PI/2),u=s;else{var h=0!==t.direction[0]?1:2;c=1===h?Pi:0,u=(1===h?r:n)-o}var p=Object(se.i)(vt.a.get());Object(se.g)(p,p,c),Object(se.r)(p,p,Object(Q.v)(vt.d.get(),u,u,u)),Object(se.l)(p,a,p),p[12]=0,p[13]=0,p[14]=0,e.modelTransform=p,e.renderLocation=l}(a,e.resizeHandles[i],t,e.displayBounds)})}}},{key:"updateZMoveHandle",value:function(e,t){var a=this.displayBounds,i={basis:a.basis1,direction:-1,position:Object(Q.i)(vt.d.get(),a.origin,a.basis1),edge:2},n=vt.a.get();Object(se.g)(n,t,i.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=i.position}},{key:"cancel",value:function(){var e=this.reshapeHelper.editGeometry.lastOperation;Object(o.j)(e)||(this.reshapeHelper.undo(),this.graphic.geometry=this.reshapeHelper.geometry,Ti(e,this.mapBounds),this.updateDisplayBounds(this.mapBounds),this.inputState=null)}},{key:"canUndo",value:function(){return this.reshapeHelper.canUndo}},{key:"undo",value:function(){if(Object(o.k)(this.inputState))this.view.activeTool=null;else if(this.canUndo()){var e=this.reshapeHelper.undo();this.graphic.geometry=this.reshapeHelper.geometry,Ti(Object(o.q)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}},{key:"canRedo",value:function(){return this.reshapeHelper.canRedo}},{key:"redo",value:function(){if(this.canRedo()){var e=this.reshapeHelper.redo();this.graphic.geometry=this.reshapeHelper.geometry,Ci(Object(o.q)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}}]),a}(d.a.EventedMixin(P.a));Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],zi.prototype,"view",void 0),Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],zi.prototype,"graphic",void 0),Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],zi.prototype,"enableZ",void 0),Object(n.a)([Object(c.b)()],zi.prototype,"enableRotation",void 0),Object(n.a)([Object(c.b)()],zi.prototype,"enableScaling",void 0),Object(n.a)([Object(c.b)()],zi.prototype,"preserveAspectRatio",null),Object(n.a)([Object(c.b)()],zi.prototype,"grabbing",void 0),Object(n.a)([Object(c.b)()],zi.prototype,"inputState",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],zi.prototype,"type",void 0),zi=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],zi);var Hi="draped-elevation-changes",Bi=10,Fi=80,Ui=1e-6},U282:function(e,t,a){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,a=0,i=0;i<e.length;i++){var n=e[i].size;"number"==typeof n&&(t+=n,a++)}return t/a}(e.stops):t}function r(e,t){if(!t)return e;var a=t.filter(function(e){return"size"===e.type}).map(function(t){var a=t.maxSize,i=t.minSize;return(n(a,e)+n(i,e))/2}),i=0,r=a.length;if(0===r)return e;for(var o=0;o<r;o++)i+=a[o];var s=Math.floor(i/r);return Math.max(s,e)}function o(e){var t=e&&e.renderer,a="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return a;var n="visualVariables"in t?r(a,t.visualVariables):a;if("simple"===t.type)return i(n,t.symbol);if("unique-value"===t.type){var o=n;return t.uniqueValueInfos.forEach(function(e){o=i(o,e.symbol)}),o}if("class-breaks"===t.type){var s=n;return t.classBreakInfos.forEach(function(e){s=i(s,e.symbol)}),s}return n}a.d(t,"a",function(){return o})},cTsy:function(e,t,a){"use strict";a.d(t,"a",function(){return m}),a.d(t,"b",function(){return b});var c=a("OIYi"),u=a("Tbkp"),h=a("aQrP"),p=a("0nJL"),d=a("agdK"),v=a("69UF"),f=a("Z1Ae"),g=a("bVvB");function b(e){var t=new h.a;return t.include(u.a,{linearDepth:!1}),t.include(g.a,e),t.include(f.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(c.a(i||(i=P(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n  "])))),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(c.a(n||(n=P(["\n    vec4 vpos2 = transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *= gl_Position.w;\n    "])),e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""))),t.vertex.code.add(c.a(r||(r=P(["\n  }\n  "])))),4===e.output&&t.include(d.a),t.include(p.a,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(c.a(o||(o=P(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color = ",";\n\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\n\n    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),e.attributeColor?"vColor":"constantColor",c.a.float(v.c),0===e.output?c.a(s||(s=P(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",4===e.output?c.a(l||(l=P(["outputHighlight();"]))):"")),t}var m=Object.freeze({__proto__:null,build:b})},sE2g:function(e,t,a){"use strict";a.d(t,"a",function(){return o}),a.d(t,"b",function(){return r});var i=a("OIYi"),n=a("aQrP");function r(){var e=new n.a;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(i.a(c||(c=P(["\n    void main(void) {\n      vUV = uv0;\n      gl_Position = proj * view * vec4(position, 1.0);\n    }\n  "])))),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(i.a(u||(u=P(["\n    void main() {\n      const float LINE_WIDTH = 1.0;\n\n      vec2 uvScaled = vUV * gridWidth;\n      vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\n      vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\n\n      // mask aliasing along edges\n      grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\n      grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\n\n      float gridFade = max(grid.x, grid.y);\n\n      float gridAlpha = gridColor.a * gridFade;\n\n      // premultiply alpha in output\n      gl_FragColor =\n        vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\n        vec4(gridColor.rgb, 1.0) * gridAlpha;\n    }\n  "])))),e}var o=Object.freeze({__proto__:null,build:r})}}])}();