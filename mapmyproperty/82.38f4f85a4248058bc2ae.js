(function(){(this||window).webpackJsonp.registerAbsMids({"arcgis-js-api/views/3d/layers/i3s/PointCloudRendererUtil":"qSbo","arcgis-js-api/views/3d/layers/PointCloudWorker":"wCvz"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{O0KB:function(e,t){},mkxQ:function(e,t){},qSbo:function(e,t,r){var o,n;o=[r.dj.c(e.i),t,r("LxLY"),r("O0KB"),r("qasq"),r("mkxQ"),r("W2ph"),r("1RVI")],void 0===(n=(function(e,t,r,o,n,a,i,l){function u(e){for(var t=0,r=0,o=e||[];r<o.length;r++)t|=1<<o[r];return t}function f(e,t){for(var r=0,o=e;r<o.length;r++){var n=o[r];if(n.name===t&&null!=n.attributeValues&&"UInt8"===n.attributeValues.valueType&&3===n.attributeValues.valuesPerElement)return{name:t,storageInfo:n,useElevation:!1}}return null}function s(e,t){for(var r=0,o=e;r<o.length;r++){var n=o[r];if(n.name===t){var a="embedded-elevation"===n.encoding;return{name:t,storageInfo:a?null:n,useElevation:a}}}return"elevation"===t.toLowerCase()?{name:t,storageInfo:null,useElevation:!0}:null}function c(e,t){for(var r=new Float64Array(t),o=0;o<t;o++)r[o]=e[3*o+2];return r}function d(e){return null==e||"none"===e?null:"low-four-bit"===e?function(e){return 15&e}:"high-four-bit"===e?function(e){return(240&e)>>4}:"absolute-value"===e?function(e){return Math.abs(e)}:"modulo-ten"===e?function(e){return e%10}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getRendererInfo=function(e){var t=e.renderer,r=t&&t.type,o=t&&e.renderer.toJSON()||null,n=null,a=!1;"point-cloud-unique-value"===r||"point-cloud-stretch"===r||"point-cloud-class-breaks"===r?n=s(e.attributeStorageInfo,t.field):a="point-cloud-rgb"===r?null!=(n=f(e.attributeStorageInfo,t.field)):null!=(n=f(e.attributeStorageInfo,"RGB"));var i=null;return t&&t.colorModulation&&(i=s(e.attributeStorageInfo,t.colorModulation.field)),{rendererJSON:o,isRGBRenderer:a,primaryAttribute:n,modulationAttribute:i}},t.getFilterInfo=function(e){var t=e.filters;return t?t.map((function(t){return{filterJSON:t.toJSON(),attributeInfo:s(e.attributeStorageInfo,t.field)}})):[]},t.evaluateRenderer=function(e,t,r,i){var l=e.rendererJSON,u=null,f=null;if(t&&e.isRGBRenderer)u=t;else if(t&&"pointCloudUniqueValueRenderer"===l.type){var s=(f=a.fromJSON(l)).colorUniqueValueInfos;u=new Uint8Array(3*i);for(var c=d(f.fieldTransformType),v=0;v<i;v++)for(var b=(m=c?c(t[v]):t[v])+"",p=0;p<s.length;p++)if(s[p].values.indexOf(b)>=0){u[3*v]=s[p].color.r,u[3*v+1]=s[p].color.g,u[3*v+2]=s[p].color.b;break}}else if(t&&"pointCloudStretchRenderer"===l.type){var h=(f=n.fromJSON(l)).stops;for(u=new Uint8Array(3*i),c=d(f.fieldTransformType),v=0;v<i;v++){var m=c?c(t[v]):t[v],g=h.length-1;if(m<h[0].value)u[3*v]=h[0].color.r,u[3*v+1]=h[0].color.g,u[3*v+2]=h[0].color.b;else if(m>=h[g].value)u[3*v]=h[g].color.r,u[3*v+1]=h[g].color.g,u[3*v+2]=h[g].color.b;else for(p=1;p<h.length;p++)if(m<h[p].value){var y=(m-h[p-1].value)/(h[p].value-h[p-1].value);u[3*v]=h[p].color.r*y+h[p-1].color.r*(1-y),u[3*v+1]=h[p].color.g*y+h[p-1].color.g*(1-y),u[3*v+2]=h[p].color.b*y+h[p-1].color.b*(1-y);break}}}else if(t&&"pointCloudClassBreaksRenderer"===l.type){var S=(f=o.fromJSON(l)).colorClassBreakInfos;for(u=new Uint8Array(3*i),c=d(f.fieldTransformType),v=0;v<i;v++)for(m=c?c(t[v]):t[v],p=0;p<S.length;p++)if(m>=S[p].minValue&&m<=S[p].maxValue){u[3*v]=S[p].color.r,u[3*v+1]=S[p].color.g,u[3*v+2]=S[p].color.b;break}}else for(u=new Uint8Array(3*i),v=0;v<u.length;v++)u[v]=255;if(r&&f&&f.colorModulation){var I=f.colorModulation.minValue,A=f.colorModulation.maxValue;for(v=0;v<i;v++){var w=(m=r[v])>=A?1:m<=I?.3:.3+.7*(m-I)/(A-I);u[3*v]=w*u[3*v],u[3*v+1]=w*u[3*v+1],u[3*v+2]=w*u[3*v+2]}}return u},t.filterInPlace=function(e,t,r,o,n){for(var a=e.length/3,i=0,l=0;l<a;l++){for(var f=!0,s=0;s<o.length&&f;s++){var c=o[s].filterJSON,d=n[s].values[l];switch(c.type){case"pointCloudValueFilter":var v="exclude"===c.mode;-1!==c.values.indexOf(d)===v&&(f=!1);break;case"pointCloudBitfieldFilter":var b=u(c.requiredSetBits),p=u(c.requiredClearBits);(d&b)===b&&0==(d&p)||(f=!1);break;case"pointCloudReturnFilter":for(var h=15&d,m=d>>>4&15,g=m>1,y=1===h,S=h===m,I=!1,A=0,w=c.includedReturns;A<w.length;A++){var x=w[A];if("last"===x&&S||"firstOfMany"===x&&y&&g||"lastOfMany"===x&&S&&g||"single"===x&&!g){I=!0;break}}I||(f=!1)}}f&&(r[i]=l,e[3*i]=e[3*l],e[3*i+1]=e[3*l+1],e[3*i+2]=e[3*l+2],t[3*i]=t[3*l],t[3*i+1]=t[3*l+1],t[3*i+2]=t[3*l+2],i++)}return i},t.getSplatSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"splat"===t.type?t:null},t.getFixedSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"fixed-size"===t.type?t:null},t.rendererUsesFixedSizes=function(e){var t=e&&e.pointSizeAlgorithm;return!(!t||!t.type)&&"fixed-size"===t.type},t.getAttributeInfo=s,t.elevationFromPositions=c,t.getAttributeValues=function(e,t,o){return r.isSome(e)&&e.attributeInfo.useElevation?c(t,o):r.isSome(e)?i.readBinaryAttribute(e.attributeInfo.storageInfo,e.buffer,o):null},t.readGeometry=function(e,t){if(null==e.encoding||""===e.encoding){for(var r=i.createGeometryIndexFromSchema(t,e),o=i.createTypedView(t,r.vertexAttributes.position),n=r.header.fields,a=[n.offsetX,n.offsetY,n.offsetZ],u=[n.scaleX,n.scaleY,n.scaleZ],f=o.length/3,s=new Float64Array(3*f),c=0;c<f;c++)s[3*c]=o[3*c]*u[0]+a[0],s[3*c+1]=o[3*c+1]*u[1]+a[1],s[3*c+2]=o[3*c+2]*u[2]+a[2];return s}if("lepcc-xyz"===e.encoding)return l.decodeXYZ(t).result}}).apply(null,o))||(e.exports=n)},qasq:function(e,t){},wCvz:function(e,t,r){var o,n;o=[r.dj.c(e.i),t,r("xhoE"),r("LxLY"),r("qMld"),r("rusB"),r("8V7H"),r("EuvN"),r("fdzS"),r("0LE5"),r("vlC2"),r("Z4y+"),r("qSbo"),r("mmEe")],void 0===(n=(function(e,t,r,o,n,a,i,l,u,f,s,c,d,v){Object.defineProperty(t,"__esModule",{value:!0});var b=function(){function e(){}return e.prototype._process=function(e){var t=this._transform(e),r=[t.points.buffer,t.rgb.buffer];o.isSome(t.pointIdFilterMap)&&r.push(t.pointIdFilterMap.buffer);for(var i=0,l=t.attributes;i<l.length;i++){var u=l[i];"buffer"in u.values&&a.isArrayBuffer(u.values.buffer)&&u.values.buffer!==t.rgb.buffer&&r.push(u.values.buffer)}return n.resolve({result:t,transferList:r})},e.prototype._transform=function(e){var t=d.readGeometry(e.schema,e.geometryBuffer),r=t.length/3,n=null,a=[],i=d.getAttributeValues(e.primaryAttributeData,t,r);o.isSome(e.primaryAttributeData)&&i&&a.push({attributeInfo:e.primaryAttributeData.attributeInfo,values:i});var l=d.getAttributeValues(e.modulationAttributeData,t,r);o.isSome(e.modulationAttributeData)&&l&&a.push({attributeInfo:e.modulationAttributeData.attributeInfo,values:l});var u=d.evaluateRenderer(e.rendererInfo,i,l,r);if(e.filterInfo&&e.filterInfo.length>0&&o.isSome(e.filterAttributesData)){var f=e.filterAttributesData.map((function(e){var o=d.getAttributeValues(e,t,r),n={attributeInfo:e.attributeInfo,values:o};return a.push(n),n}));n=new Uint32Array(r),r=d.filterInPlace(t,u,n,e.filterInfo,f)}for(var s=0,v=e.userAttributesData;s<v.length;s++){var b=v[s],p=d.getAttributeValues(b,t,r);a.push({attributeInfo:b.attributeInfo,values:p})}3*r<u.length&&(u=new Uint8Array(u.buffer.slice(0,3*r))),this._applyElevationOffsetInPlace(t,r,e.elevationOffset);var h=this._transformCoordinates(t,r,e.obb,c.fromJSON(e.inSR),c.fromJSON(e.outSR));return{obb:e.obb,points:h,rgb:u,attributes:a,pointIdFilterMap:n}},e.prototype._transformCoordinates=function(e,t,r,o,n){if(!v.bufferToBuffer(e,o,0,e,n,0,t))throw Error("Can't reproject");var a=s.vec3f32.fromValues(r.center[0],r.center[1],r.center[2]),i=s.vec3f32.create(),u=s.vec3f32.create();l.quat.conjugate(p,r.quaternion);for(var c=new Float32Array(3*t),d=0;d<t;d++)i[0]=e[3*d]-a[0],i[1]=e[3*d+1]-a[1],i[2]=e[3*d+2]-a[2],f.vec3.transformQuat(u,i,p),r.halfSize[0]=Math.max(r.halfSize[0],Math.abs(u[0])),r.halfSize[1]=Math.max(r.halfSize[1],Math.abs(u[1])),r.halfSize[2]=Math.max(r.halfSize[2],Math.abs(u[2])),c[3*d]=i[0],c[3*d+1]=i[1],c[3*d+2]=i[2];return c},e.prototype._applyElevationOffsetInPlace=function(e,t,r){if(0!==r)for(var o=0;o<t;o++)e[3*o+2]+=r},e}(),p=u.quatf32.create(),h=function(e){function t(){var t=e.call(this)||this;return t._thread=void 0,i.open("PointCloudWorker").then((function(e){void 0===t._thread?t._thread=e:e.close()})),t}return r(t,e),t.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},t.prototype.transform=function(e,t,r){return this._thread?this._thread.invoke("_process",e,{transferList:t,signal:r}):n.resolve(this._transform(e))},t}(b);t.PointCloudWorker=h,t.default=function(){return new b}}).apply(null,o))||(e.exports=n)}}]);