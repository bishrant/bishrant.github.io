(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/OptimizedFeature":"/COu","arcgis-js-api/layers/graphics/OptimizedFeature":"/COu","arcgis-js-api/layers/support/WebSocketConnector":"2X1f","esri/layers/graphics/OptimizedGeometry":"Jvs9","arcgis-js-api/layers/graphics/OptimizedGeometry":"Jvs9","arcgis-js-api/layers/graphics/sources/StreamLayerSource":"mtZs","esri/layers/graphics/OptimizedFeatureSet":"xJgq","arcgis-js-api/layers/graphics/OptimizedFeatureSet":"xJgq"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[86,96],{"/COu":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xhoE")],void 0===(i=(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r){void 0===e&&(e=null),void 0===t&&(t={}),this.localId=0,this.geohashIndexed=!1,this.geohashX=0,this.geohashY=0,this.geometry=e,t&&(this.attributes=t),n&&(this.centroid=n),null!=r&&(this.objectId=r)}}).apply(null,r))||(e.exports=i)},"2X1f":function(e,t,n){var r,i;r=[n("BcWh"),n("SZNs"),n("jfWY"),n("qMld"),n("8MXS"),n("ma1f")],void 0===(i=(function(e,t,n,r,i,s){return(0,t.EsriPromiseMixin)(e.EventedAccessor).createSubclass({declaredClass:"esri.layers.support.WebSocketConnector",initialize:function(){var e=null;this.socketUrls.length||(e=new Error("No urls passed to WebSocketConnector. No live connection possible")),"WebSocket"in window||(e=new Error("The browser does not support Web Sockets. No live connection possible")),e&&this.addResolvingPromise(r.reject(e)),this.queryParams&&this.queryParams.token&&this._set("tokenNeeded",!0)},_socket:null,_connectPromise:null,_disconnectPromise:null,properties:{currentSocketUrl:{value:null,readOnly:!0},layerSource:null,queryParams:null,socketUrls:{value:[]},tokenNeeded:{value:!1},connectionError:{value:null,type:s,readOnly:!0},connectionStatus:{value:"disconnected",readOnly:!0}},connect:function(){var e=this.connectionStatus;return"connected"===e||"connecting"===e?this._connectPromise:"disconnected"===this.connectionStatus?(this._set("connectionStatus","connecting"),this._connect()):"disconnecting"===this.connectionStatus?(this._connectPromise=null,this._disconnectPromise||(this._disconnectPromise=i.once(this,"connectionStatus").then((function(e){if("disconnected"===e.value)return this._connect()}).bind(this))),this._disconnectPromise):void 0},disconnect:function(){var e=this.connectionStatus;"connected"===e?(this._set("connectionStatus","disconnecting"),this._socket?this._socket.close():this._set("connectionStatus","disconnected")):"connecting"===e&&this._connectPromise.then((function(){this.disconnect()}).bind(this))},send:function(e){this._socket&&("object"==typeof e&&(e=JSON.stringify(e)),this._socket.send(e))},_connect:function(){this._connectPromise&&(this._connectPromise=null);var e=r.createDeferred();return this._connectPromise=e,this._getWebSocketToken().then((function(e){e&&(this.queryParams.token=e);var t=this._makeCurrentUrl(),n=new WebSocket(t);n.onopen=this._handleSocketOpen.bind(this),n.onclose=this._handleSocketClose.bind(this),n.onmessage=this._handleSocketMessage.bind(this),this._socket=n}).bind(this)).catch((function(e){var t=new s("web-socket-connector:connect","Could not get websocket token for secured service",e);this._set("connectionError",t),this._connectPromise.reject(t)}).bind(this)),e.promise},_getWebSocketToken:function(){var e=this.queryParams,t=e&&e.token,n=this.tokenNeeded;return t?r.resolve(t):n?this.layerSource.getWebSocketToken():r.resolve()},_makeCurrentUrl:function(){var e,t,r=this.queryParams,i=this.socketUrls;return 1!==i.length&&this.currentSocketUrl?(e=i.indexOf(this.currentSocketUrl),t=i[e>=i.length-1?0:e+1]):t=i[0],this._set("currentSocketUrl",t),r&&(t+="?"+n.objectToQuery(r)),t},_handleSocketOpen:function(){this._set("connectionStatus","connected"),this._set("connectionError",null),this._disconnectPromise=null,this._connectPromise&&this._connectPromise.resolve()},_handleSocketClose:function(e){var t,n=null;this.queryParams&&(this.queryParams.token=null),e.wasClean&&!e.code||(1001===e.code?t="Service is going away.":4400===e.code?t=e.reason||"Invalid url parameters. Check filter properties.":4404===e.code?t="Service not found":4401===e.code||4403===e.code?t="Not authorized":e.wasClean||(t=e.reason||"Unknown reason"),t&&(n=new s("web-socket-connector:connection closed","Connection failed: "+t),this._set("connectionError",n),this._connectPromise&&this._connectPromise.reject(n))),this._connectPromise=null,this._set("connectionStatus","disconnected"),this._socket=null},_handleSocketMessage:function(e){this.emit("data-received",e.data)}})}).apply(null,r))||(e.exports=i)},Jvs9:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.lengths=e,this.coords=t}}).apply(null,r))||(e.exports=i)},mtZs:function(e,t,n){var r,i;r=[n("vi9r"),n("Gtr7"),n("SZNs"),n("rg9i"),n("jfWY"),n("qMld"),n("N7S/"),n("2X1f"),n("uajq"),n("zp6E")],void 0===(i=(function(e,t,n,r,i,s,o,c,a,l){return e([t,n.EsriPromise],{declaredClass:"esri.layers.graphics.sources.StreamLayerSource",constructor:function(e){var t=e&&e.layer;t&&(this.url=t.url)},initialize:function(){this.addResolvingPromise(this._fetchLayers())},properties:{connectionInfo:{get:function(){if(this.layer.hasMemorySource||this.layer.socketUrl)return{serviceSocketUrls:[this.layer.socketUrl]};if(this.sourceJSON){var e,t,n,r,s={},o=this.sourceJSON,c=[],a=[],l=[];if(o.streamUrls&&o.streamUrls.forEach((function(e){"ws"===e.transport&&(c=e.urls,s.token=e.token)}),this),c.forEach((function(e){0===e.lastIndexOf("wss",0)?l.push(e):a.push(e)})),(e="https"===i.appUrl.scheme||0===this.url.lastIndexOf("https:",0)?l:0===a.length?l:a)&&e.length>1)for(t=0;t<e.length-1;t++)r=e[n=t+Math.floor(Math.random()*(e.length-t))],e[n]=e[t],e[t]=r;return s.serviceSocketUrls=e,s}}},latestUrl:{get:function(){var e=this.sourceJSON;return e.keepLatestArchive&&e.keepLatestArchive.featuresUrl||null}},latestQueryTask:{get:function(){var e=this.latestUrl;return e?new a(e):null}},layer:{},relatedFeaturesInfo:{get:function(){var e=(this.sourceJSON||{}).relatedFeatures;return e&&e.featuresUrl?e:null}},relatedFeaturesQueryTask:{get:function(){var e=this.relatedFeaturesInfo,t=e?e.featuresUrl:null;return t?new a(t):null}},parsedUrl:{get:function(){return this.url?i.urlToObject(this.url):null}},url:null},createWebSocketConnector:function(e){var t=s.createDeferred();return this.when((function(){var n,i,s,o,a=this.connectionInfo,l=this.layer.spatialReference,u={};try{n=this.makeFilter()}catch(e){return void t.reject(e)}if(a){if(a.socketUrl?s=[a.socketUrl]:a.serviceSocketUrls&&(s=a.serviceSocketUrls.map((function(e){return e+"/"+this.layer.socketDirection}).bind(this))),u.socketUrls=s,n&&(n.where||n.geometry||n.outFields)){var h=n.geometry;h&&"string"!=typeof h&&(h=h.toJSON?JSON.stringify(h.toJSON()):JSON.stringify(h)),i=r.mixin(i||{},{where:n.where,geometry:h,outFields:n.outFields})}a.token&&(i=r.mixin(i||{},{token:a.token})),e&&l&&e.wkid!==l.wkid&&(i=r.mixin(i||{},{outSR:e.wkid})),u.queryParams=i,u.layerSource=this,o=new c(u),t.resolve(o)}else t.reject(new Error("No web socket urls found"))}).bind(this)),t.promise},getWebSocketToken:function(){return this._fetchStreamLayer().then((function(e){var t=e.data,n=null;return t.streamUrls&&t.streamUrls.some((function(e){if("ws"===e.transport)return n=e.token,!0}),this),n}).bind(this))},makeFilter:function(e){var t,n=this.layer,i=null;if(e){var s;if(t={},e.hasOwnProperty("where")&&(t.where=e.where),e.hasOwnProperty("geometry")){if((s=e.geometry)&&!s.hasOwnProperty("xmin"))throw new Error("Cannot make filter. Only Extent is supported for the geometry filter");s&&!s.declaredClass&&(s=new o(s)),t.geometry=s}}else{var c=n.filter||{};t={where:c.where,geometry:c.geometry};var a=this.relatedFeaturesInfo&&this.relatedFeaturesInfo.outFields||n.outFields;if(a&&-1===a.indexOf("*")){var l=n.fields.map((function(e){return e.name}));i=a.filter((function(e){return-1!==l.indexOf(e)})).join(","),t=r.mixin(t||{},{outFields:i})}}return t},queryFeatures:function(e,t){return s.reject()},_fetchLayers:function(){return this._fetchStreamLayer().then((function(e){return e.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=e.data,this._fetchArchiveLayer()}).bind(this)).then((function(e){return this.archivedLayerDefinition=e&&e.data,this._fetchRelatedLayer()}).bind(this)).then((function(e){this.relatedLayerDefinition=e&&e.data}).bind(this))},_fetchStreamLayer:function(){return this._requestServiceDefinition({url:this.layer.parsedUrl.path,content:r.mixin({f:"json"},this.layer.parsedUrl.query)})},_fetchArchiveLayer:function(){var e=this.latestUrl;return e?this._requestServiceDefinition({url:e}):s.resolve()},_fetchRelatedLayer:function(){var e=this.relatedFeaturesInfo;return e?this._requestServiceDefinition({url:e.featuresUrl}):s.resolve()},_requestServiceDefinition:function(e){return e&&e.url?l(e.url,{query:r.mixin(e.content||{},{f:"json"}),responseType:"json"}):s.reject(new Error("url is a required options property"))}})}).apply(null,r))||(e.exports=i)},xJgq:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1}}).apply(null,r))||(e.exports=i)}}]);