(function(){var e={"arcgis-js-api/views/3d/webgl-engine/lib/geometryDataUtils":"+nCE","esri/views/3d/webgl-engine/lib/geometryDataUtils":"+nCE","arcgis-js-api/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":"+wMf","esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":"+wMf","arcgis-js-api/views/3d/webgl-engine/lib/glUtil3D":"/Bau","esri/views/3d/webgl-engine/lib/glUtil3D":"/Bau","esri/views/3d/support/geometryUtils/sphere":"/dtL","arcgis-js-api/views/3d/support/geometryUtils/vector":"18xY","esri/views/3d/support/geometryUtils/vector":"18xY","esri/views/3d/webgl-engine/lib/doublePrecisionUtils":"1f+t","esri/core/libs/gl-matrix-2/mat4f64":"1m5D","arcgis-js-api/core/libs/gl-matrix-2/mat4f64":"1m5D","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":"2NOe","esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":"2NOe","esri/views/3d/support/geometryUtils/boundedPlane":"2eYJ","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":"2o+p","esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":"2o+p","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":"3PFg","esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":"3PFg","esri/views/3d/webgl-engine/lib/BoundingInfo":"3RHn","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":"3kdR","esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":"3kdR","esri/views/3d/support/geometryUtils/ray":"4p4v","esri/core/libs/gl-matrix-2/mat3f64":"51bw","arcgis-js-api/core/libs/gl-matrix-2/mat3f64":"51bw","arcgis-js-api/views/3d/webgl-engine/lib/Object3DStateSet":"62Ht","esri/views/3d/webgl-engine/lib/Object3DStateSet":"62Ht","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":"6t3m","esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":"6t3m","arcgis-js-api/views/3d/webgl-engine/core/shaderModules/interfaces":"7Aei","esri/views/3d/webgl-engine/core/shaderModules/interfaces":"7Aei","arcgis-js-api/views/3d/webgl-engine/lib/intersectorUtils":"9DjX","esri/views/3d/webgl-engine/lib/intersectorUtils":"9DjX","arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialTexture":"9FJH","esri/views/3d/webgl-engine/lib/GLMaterialTexture":"9FJH","arcgis-js-api/views/3d/webgl-engine/lib/GeometryData":"AgDx","esri/views/3d/webgl-engine/lib/GeometryData":"AgDx","arcgis-js-api/views/3d/webgl-engine/lib/Util":"CIy2","esri/views/3d/webgl-engine/lib/Util":"CIy2","arcgis-js-api/core/libs/gl-matrix-2/factories/mat4f64":"CIzB","esri/views/3d/webgl-engine/lib/GeometryRecord":"Cvn+","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":"DKwL","esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":"DKwL","arcgis-js-api/views/3d/webgl-engine/lib/DefaultTextureUnits":"EiD/","esri/views/3d/webgl-engine/lib/DefaultTextureUnits":"EiD/","esri/views/3d/webgl-engine/lib/DDSUtil":"EyQ4","arcgis-js-api/views/3d/webgl-engine/lib/Material":"FNtW","esri/views/3d/webgl-engine/lib/Material":"FNtW","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":"FQ4r","esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":"FQ4r","esri/views/3d/support/geometryUtils/plane":"GG08","esri/views/3d/support/geometryUtils/axisAngle":"GyfB","arcgis-js-api/views/3d/webgl-engine/materials/internal/bufferWriterUtils":"ILj8","esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":"ILj8","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":"IwVr","esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":"IwVr","arcgis-js-api/views/3d/support/stack":"JjCO","esri/views/3d/support/stack":"JjCO","arcgis-js-api/views/3d/webgl-engine/lib/AutoDisposable":"KRuQ","esri/views/3d/webgl-engine/lib/AutoDisposable":"KRuQ","esri/views/3d/support/geometryUtils/lineSegment":"N5NQ","esri/core/ObjectStack":"PHan","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":"PaEL","esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":"PaEL","arcgis-js-api/views/3d/webgl-engine/materials/renderers/utils":"PwS/","esri/views/3d/webgl-engine/materials/renderers/utils":"PwS/","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":"W/V4","esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":"W/V4","arcgis-js-api/views/3d/webgl-engine/lib/IdGen":"W0kZ","esri/views/3d/webgl-engine/lib/IdGen":"W0kZ","arcgis-js-api/views/3d/webgl-engine/lib/Object3D":"ZJC8","esri/views/3d/webgl-engine/lib/Object3D":"ZJC8","esri/views/3d/support/geometryUtils/triangle":"ZjcA","arcgis-js-api/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":"aExC","esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":"aExC","arcgis-js-api/views/3d/support/geometryUtils":"aWgr","esri/views/3d/support/geometryUtils":"aWgr","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":"cj3m","esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":"cj3m","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":"cmSR","esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":"cmSR","esri/views/3d/support/geometryUtils/frustum":"cpxo","arcgis-js-api/views/3d/support/geometryUtils/clipRay":"fXZm","esri/views/3d/support/geometryUtils/clipRay":"fXZm","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":"fese","esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":"fese","arcgis-js-api/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":"ff/U","esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":"ff/U","arcgis-js-api/core/libs/gl-matrix-2/factories/vec3f32":"iHt0","esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":"juLw","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":"lBa0","esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":"lBa0","arcgis-js-api/views/3d/webgl-engine/lib/StencilUtils":"lfQW","esri/views/3d/webgl-engine/lib/StencilUtils":"lfQW","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":"piY7","esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":"piY7","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":"quQL","esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":"quQL","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":"rCq5","esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":"rCq5","arcgis-js-api/views/3d/webgl-engine/materials/internal/MaterialUtil":"s6rJ","esri/views/3d/webgl-engine/materials/internal/MaterialUtil":"s6rJ","arcgis-js-api/views/3d/webgl-engine/lib/GLMaterial":"tUyH","esri/views/3d/webgl-engine/lib/GLMaterial":"tUyH","esri/core/libs/gl-matrix-2/vec3f32":"vlC2","arcgis-js-api/core/libs/gl-matrix-2/vec3f32":"vlC2","esri/core/VectorStack":"wSO/","esri/views/3d/support/imageUtils":"weRx","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":"xDGw","esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":"xDGw","arcgis-js-api/views/3d/webgl-engine/lib/Texture":"yqrJ","esri/views/3d/webgl-engine/lib/Texture":"yqrJ","arcgis-js-api/views/3d/webgl-engine/lib/Geometry":"ys4y","esri/views/3d/webgl-engine/lib/Geometry":"ys4y","esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":"zZCp"},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"+nCE":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("0LE5"),r("Rdxj"),r("ZjcA")],void 0===(i=(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNewId=t.computeAttachmentOriginLines=t.computeAttachmentOriginPoints=t.computeAttachmentOriginTriangles=t.generateDefaultIndexArray=void 0;var a=1,o=null,s=new Uint32Array([0]);t.generateDefaultIndexArray=function(e){if(1===e)return s;if(e>a||null==o){for(;e>a;)a*=2;o=new Uint32Array(a);for(var t=0;t<a;t++)o[t]=t}return new Uint32Array(o.buffer,0,e)},t.computeAttachmentOriginTriangles=function(e,t,n){if(!e)return!1;var a=e.strideIdx,o=e.offsetIdx,s=e.data;r.vec3.set(n,0,0,0),r.vec3.set(f,0,0,0);for(var c=0,v=0,p=0;p<t.length-2;p+=3){var h=t[p+0]*a+o,m=t[p+1]*a+o,g=t[p+2]*a+o;r.vec3.set(l,s[h+0],s[h+1],s[h+2]),r.vec3.set(u,s[m+0],s[m+1],s[m+2]),r.vec3.set(d,s[g+0],s[g+1],s[g+2]);var b=i.areaPoints3d(l,u,d);b?(r.vec3.add(l,l,u),r.vec3.add(l,l,d),r.vec3.scale(l,l,1/3*b),r.vec3.add(n,n,l),c+=b):(r.vec3.add(f,f,l),r.vec3.add(f,f,u),r.vec3.add(f,f,d),v+=3)}return!(0===v&&0===c||(0!==c?(r.vec3.scale(n,n,1/c),0):0===v||(r.vec3.scale(n,f,1/v),0)))},t.computeAttachmentOriginPoints=function(e,t,n){if(!e||!t)return!1;var i=e.strideIdx,a=e.offsetIdx,o=e.data;r.vec3.set(n,0,0,0);for(var s=-1,c=0,l=0;l<t.length;l++){var u=t[l]*i+a;s!==u&&(n[0]+=o[u+0],n[1]+=o[u+1],n[2]+=o[u+2],c++),s=u}return c>1&&r.vec3.scale(n,n,1/c),c>0},t.computeAttachmentOriginLines=function(e,t,n,i){if(!e)return!1;var a=e.strideIdx,o=e.offsetIdx,s=e.data;r.vec3.set(i,0,0,0),r.vec3.set(f,0,0,0);for(var c=0,d=0,v=t?t.length-1:s.length/a-1,p=v+(n?2:0),h=0;h<p;h+=2){var m=h<v?h:v,g=h<v?h+1:0,b=(t?t[m]:m)*a+o,y=(t?t[g]:g)*a+o;l[0]=s[b+0],l[1]=s[b+1],l[2]=s[b+2],u[0]=s[y+0],u[1]=s[y+1],u[2]=s[y+2],r.vec3.scale(l,r.vec3.add(l,l,u),.5);var x=r.vec3.dist(l,u);x>0?(r.vec3.add(i,i,r.vec3.scale(l,l,x)),c+=x):(r.vec3.add(f,f,l),d++)}return 0!==c?(r.vec3.scale(i,i,1/c),!0):0!==d&&(r.vec3.scale(i,f,1/d),!0)};var c=0;t.getNewId=function(){return c++};var l=n.vec3f64.create(),u=n.vec3f64.create(),d=n.vec3f64.create(),f=n.vec3f64.create()}).apply(null,n))||(e.exports=i)},"+wMf":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+"),r("KDna")],void 0===(i=(function(e,t,r,n){"use strict";function i(e,t,r){var n=r.parameters,i=r.paddingPixelsOverride;return u.scale=Math.min(n.divisor/(t-n.offset),1),u.factor=function(e){return Math.abs(e*e*e)}(e),u.minPixelSize=n.minPixelSize,u.paddingPixels=i,u}function a(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function o(e,t){return Math.max(r.lerp(e*t.scale,e,t.factor),a(e,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.scale=t.applyPrecomputedScaleFactor=t.precomputeScaleFactor=t.applyScaleFactorVec2=t.applyScaleFactor=t.getLabelSettings=t.getSettings=void 0,t.getSettings=function(e){return new s(e,c)},t.getLabelSettings=function(e){var t=c.curvatureDependent;return new s(e,{curvatureDependent:{min:{curvature:t.min.curvature,tiltAngle:t.min.tiltAngle,scaleFallOffFactor:l.curvatureDependent.min.scaleFallOffFactor},max:{curvature:t.max.curvature,tiltAngle:t.max.tiltAngle,scaleFallOffFactor:l.curvatureDependent.max.scaleFallOffFactor}},scaleStart:c.scaleStart,scaleFallOffRange:c.scaleFallOffRange,minPixelSize:l.minPixelSize})},t.applyScaleFactor=o,t.applyScaleFactorVec2=function(e,t,n){void 0===n&&(n=[0,0]);var i=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return n[0]=r.lerp(e[0]*i,e[0],t.factor),n[1]=r.lerp(e[1]*i,e[1],t.factor),n},t.precomputeScaleFactor=function(e,t,r,n){n.scale=function(e,t,r){var n=i(e,t,r);return n.minPixelSize=0,n.paddingPixels=0,o(1,n)}(e,t,r),n.factor=0,n.minPixelSize=r.parameters.minPixelSize,n.paddingPixels=r.paddingPixelsOverride},t.applyPrecomputedScaleFactor=function(e,t,r){void 0===r&&(r=[0,0]);var n=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return r[0]=e[0]*n,r[1]=e[1]*n,r},t.scale=function(e,t,r,n){return o(e,i(t,r,n))};var s=function(){function e(e,t,r,n){void 0===r&&(r={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}),this.viewingMode=e,this.description=t,this.parameters=r,this._paddingPixelsOverride=n,2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}return Object.defineProperty(e.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!1,configurable:!0}),e.prototype.update=function(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this.calculateParameters(e,this.parameters),0))},e.prototype.overridePadding=function(t){return t!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.parameters,t):this},e.prototype.calculateParameters=function(e,t){var r=this.description,n=r.scaleStart,i=r.scaleFallOffRange,a=r.minPixelSize,o=e.fovY,s=e.distance,c=this.calculateCurvatureDependentParameters(e),l=this.coverageCompensation(e,c),u=c.tiltAngle,d=c.scaleFallOffFactor,f=Math.sin(u)*s,v=.5*Math.PI-u-o*(.5-n*l),p=f/Math.cos(v),h=(p-d*(f/Math.cos(v+o*i*l)))/(1-d);return t.camera.fovY=e.fovY,t.camera.distance=e.distance,t.offset=h,t.divisor=p-h,t.minPixelSize=a,t},e.prototype.calculateCurvatureDependentParametersLocal=function(e,t){return void 0===t&&(t=d),t.tiltAngle=this.description.curvatureDependent.min.tiltAngle,t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,t},e.prototype.calculateCurvatureDependentParametersGlobal=function(e,t){void 0===t&&(t=d);var i=this.description.curvatureDependent,a=1+e.distance/n.earthRadius,o=Math.sqrt(a*a-1),s=[i.min.curvature,i.max.curvature],c=s[0],l=r.clamp((o-c)/(s[1]-c),0,1),u=[i.min,i.max],f=u[0],v=u[1];return t.tiltAngle=r.lerp(f.tiltAngle,v.tiltAngle,l),t.scaleFallOffFactor=r.lerp(f.scaleFallOffFactor,v.scaleFallOffFactor,l),t},e.prototype.surfaceCoverageCompensationLocal=function(e,t){return(e.fovY-t.tiltAngle)/e.fovY},e.prototype.surfaceCoverageCompensationGlobal=function(e,t){var r=n.earthRadius*n.earthRadius,i=t.tiltAngle+.5*Math.PI,a=e.fovY,o=e.distance,s=o*o+r-2*Math.cos(i)*o*n.earthRadius,c=Math.sqrt(s),l=Math.sqrt(s-r);return(Math.acos(l/c)-Math.asin(n.earthRadius/(c/Math.sin(i)))+.5*a)/a},e}(),c={curvatureDependent:{min:{curvature:r.deg2rad(10),tiltAngle:r.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:r.deg2rad(70),tiltAngle:r.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},l={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14},u={scale:0,factor:0,minPixelSize:0,paddingPixels:0},d={tiltAngle:0,scaleFallOffFactor:0}}).apply(null,n))||(e.exports=i)},"/Bau":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zZCp"),r("QFi0"),r("Zp3t"),r("z2+Q")],void 0===(i=(function(e,t,r,n,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createEmptyDepthTexture=t.createColorTexture=t.createEmptyTexture=t.createQuadVAO=void 0,t.createQuadVAO=function(e,t,a){void 0===t&&(t=n.Pos2),void 0===a&&(a=r.Default3D);var s=null;switch(t){case n.Pos2Tex:s=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;case n.Pos2:default:s=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new o(e,a,{geometry:t},{geometry:i.createVertex(e,35044,s)})},t.createEmptyTexture=function(e,t){return void 0===t&&(t=4),new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,r){void 0===r&&(r=4);for(var n=new Uint8Array(r*r*4),i=0;i<n.length;i+=4)n[i+0]=255*t[0],n[i+1]=255*t[1],n[i+2]=255*t[2],n[i+3]=255*t[3];return new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:r,height:r},n)},t.createEmptyDepthTexture=function(e){return new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}}).apply(null,n))||(e.exports=i)},"/dtL":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("qsST"),r("xoE+"),r("PHan"),r("FXVB"),r("0LE5"),r("Rdxj"),r("AzkI"),r("JjCO"),r("4p4v"),r("18xY")],void 0===(i=(function(e,t,r,n,i,a,o,s,c,l,u,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setAltitudeAt=t.altitudeAt=t.axisAt=t.angleToSilhouette=t.distanceToSilhouette=t.projectPoint=t.closestPoint=t.closestPointOnSilhouette=t.intersectRayClosestSilhouette=t.intersectsRay=t.intersectScreen=t.intersectRay=t.setExtent=t.elevate=t.fromValues=t.copy=t.wrap=t.create=void 0;var v=n.getLogger("esri.views.3d.support.geometryUtils.sphere");function p(e){return e?{radius:e.radius,center:c.vec3f64.clone(e.center)}:{radius:1,center:c.vec3f64.create()}}function h(e,t){return void 0===t&&(t=p()),m(e.radius,e.center,t)}function m(e,t,r){return void 0===r&&(r=p()),s.vec3.copy(r.center,t),r.radius=e,r}function g(e,t,r){var n=s.vec3.subtract(u.sv3d.get(),t.origin,e.center),i=s.vec3.dot(t.direction,t.direction),a=2*s.vec3.dot(t.direction,n),o=a*a-4*i*(s.vec3.dot(n,n)-e.radius*e.radius);if(o<0)return!1;var c=Math.sqrt(o),l=(-a-c)/(2*i),d=(-a+c)/(2*i);return(l<0||d<l&&d>0)&&(l=d),!(l<0||(r&&s.vec3.add(r,t.origin,s.vec3.scale(u.sv3d.get(),t.direction,l)),0))}function b(e,t,r){var n=u.sv3d.get(),i=u.sm4d.get();s.vec3.cross(n,t.origin,t.direction),s.vec3.cross(r,n,t.origin),s.vec3.scale(r,r,1/s.vec3.length(r)*e.radius);var a=x(e,t.origin),c=f.angle(t.origin,r);return o.mat4.identity(i),o.mat4.rotate(i,i,c+a,n),s.vec3.transformMat4(r,r,i),r}function y(e,t,r){var n=s.vec3.subtract(u.sv3d.get(),t,e.center),i=s.vec3.scale(u.sv3d.get(),n,e.radius/s.vec3.length(n));return s.vec3.add(r,i,e.center)}function x(e,t){var r=s.vec3.subtract(u.sv3d.get(),t,e.center),n=s.vec3.length(r),a=e.radius+Math.abs(e.radius-n);return i.acosClamped(e.radius/a)}t.create=p,t.wrap=function(e,t){var r=O.get();return r.radius=e,r.center=t||M,r},t.copy=h,t.fromValues=m,t.elevate=function(e,t,r){return e!==r&&s.vec3.copy(r.center,e.center),r.radius=e.radius+t,r},t.setExtent=function(e,t,r){return v.error("sphere.setExtent is not yet supported"),e===r?r:h(e,r)},t.intersectRay=g,t.intersectScreen=function(e,t,r,n){return g(e,d.fromScreenAtEye(t,r,P),n)},t.intersectsRay=function(e,t){return g(e,t,null)},t.intersectRayClosestSilhouette=function(e,t,r){if(g(e,t,r))return r;var n=b(e,t,u.sv3d.get());return s.vec3.add(r,t.origin,s.vec3.scale(u.sv3d.get(),t.direction,s.vec3.distance(t.origin,n)/s.vec3.length(t.direction))),r},t.closestPointOnSilhouette=b,t.closestPoint=function(e,t,r){return g(e,t,r)?r:(d.closestPoint(t,e.center,r),y(e,r,r))},t.projectPoint=y,t.distanceToSilhouette=function(e,t){var r=s.vec3.subtract(u.sv3d.get(),t,e.center),n=s.vec3.squaredLength(r);return Math.sqrt(Math.abs(n-e.radius*e.radius))},t.angleToSilhouette=x;var _=c.vec3f64.create();function S(e,t,n,i){var a=s.vec3.subtract(_,t,e.center);switch(n){case 0:var o=(c=l.cartesianToSpherical(a,_))[2];return s.vec3.set(i,-Math.sin(o),Math.cos(o),0);case 1:var c,u=(c=l.cartesianToSpherical(a,_))[1],d=(o=c[2],Math.sin(u));return s.vec3.set(i,-d*Math.cos(o),-d*Math.sin(o),Math.cos(u));case 2:return s.vec3.normalize(i,a);default:return void r.neverReached(n)}}function w(e,t){var r=s.vec3.subtract(T,t,e.center);return s.vec3.length(r)-e.radius}t.axisAt=S,t.altitudeAt=w,t.setAltitudeAt=function(e,t,r,n){var i=w(e,t),a=S(e,t,2,T),o=s.vec3.scale(T,a,r-i);return s.vec3.add(n,t,o),n};var O=new a.ObjectStack((function(){return{center:null,radius:0}})),P=d.create(),M=c.vec3f64.create(),T=c.vec3f64.create();Object.freeze(M)}).apply(null,n))||(e.exports=i)},"18xY":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+"),r("0LE5"),r("Rdxj")],void 0===(i=(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.angleAroundAxis=t.angle=t.projectPointSignedLength=t.projectPoint=void 0,t.projectPoint=function(e,t,r){var i=n.vec3.dot(e,t)/n.vec3.dot(e,e);return n.vec3.scale(r,e,i)},t.projectPointSignedLength=function(e,t){return n.vec3.dot(e,t)/n.vec3.length(e)},t.angle=function(e,t){var i=n.vec3.dot(e,t)/(n.vec3.length(e)*n.vec3.length(t));return-r.acosClamped(i)},t.angleAroundAxis=function(e,t,i){n.vec3.normalize(a,e),n.vec3.normalize(o,t);var s=n.vec3.dot(a,o),c=r.acosClamped(s),l=n.vec3.cross(a,a,o);return n.vec3.dot(l,i)<0?2*Math.PI-c:c};var a=i.vec3f64.create(),o=i.vec3f64.create()}).apply(null,n))||(e.exports=i)},"1f+t":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function r(e,t,r){for(var n=0;n<r;++n)t[2*n]=e[n],t[2*n+1]=e[n]-t[2*n]}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDoubleArraySplit=t.decodeDoubleArray=t.encodeDoubleArray=t.encodeDouble=void 0,t.encodeDouble=function(e,t){i[0]=e,i[1]=e-i[0],t[0]=i[0],t[1]=i[1]},t.encodeDoubleArray=r,t.decodeDoubleArray=function(e,t,r){for(var n=0;n<r;++n)t[n]=e[2*n]+e[2*n+1]},t.encodeDoubleArraySplit=function(e,t,a,o){for(var s=0;s<o;++s)n[0]=e[s],r(n,i,1),t[s]=i[0],a[s]=i[1]};var n=new Float64Array(1),i=new Float32Array(2)}).apply(null,n))||(e.exports=i)},"1m5D":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("CIzB")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat4f64=void 0,t.mat4f64=r}).apply(null,n))||(e.exports=i)},"2NOe":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("oZZu")],void 0===(i=(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0,function(e){function t(e,t,n){r.mat4.translate(i,n,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",i)}e.bindCamPosition=function(e,t,r){e.setUniform3f("camPos",r[3]-t[0],r[7]-t[1],r[11]-t[2])},e.bindProjectionMatrix=function(e,t){e.setUniformMatrix4fv("proj",t)},e.bindNearFar=function(e,t){e.setUniform2fv("nearFar",t)},e.bindViewCustomOrigin=t,e.bindView=function(e,r){t(e,r.origin,r.camera.viewMatrix)},e.bindViewport=function(e,t){e.setUniform4fv("viewport",t.camera.fullViewport)}}(t.View||(t.View={}));var i=n.mat4f32.create()}).apply(null,n))||(e.exports=i)},"2eYJ":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("qsST"),r("xoE+"),r("PHan"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("AzkI"),r("JjCO"),r("N5NQ"),r("GG08"),r("4p4v"),r("18xY")],void 0===(i=(function(e,t,r,n,i,a,o,s,c,l,u,d,f,v,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UP=t.normal=t.rotate=t.transform=t.equals=t.setAltitudeAt=t.altitudeAt=t.axisAt=t.extrusionContainsPoint=t.distanceToSilhouette=t.distance=t.distance2=t.projectPointLocal=t.projectPoint=t.closestPoint=t.closestPointOnSilhouette=t.intersectRayClosestSilhouette=t.intersectRay=t.fromAABoundingRect=t.setExtent=t.elevate=t.updateUnboundedPlane=t.fromValues=t.copy=t.wrap=t.create=t.BoundedPlaneClass=void 0;var m=n.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function g(e){return void 0===e&&(e=t.UP),{plane:v.create(e.plane),origin:l.vec3f64.clone(e.origin),basis1:l.vec3f64.clone(e.basis1),basis2:l.vec3f64.clone(e.basis2)}}function b(e,t){return void 0===t&&(t=g()),y(e.origin,e.basis1,e.basis2,t)}function y(e,t,r,n){return void 0===n&&(n=g()),c.vec3.copy(n.origin,e),c.vec3.copy(n.basis1,t),c.vec3.copy(n.basis2,r),x(n),function(e,t){Math.abs(c.vec3.dot(e.basis1,e.basis2)/(c.vec3.length(e.basis1)*c.vec3.length(e.basis2)))>1e-6&&m.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(c.vec3.dot(e.basis1,I(e)))>1e-6&&m.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-c.vec3.dot(I(e),e.origin)-e.plane[3])>1e-6&&m.warn(t,"Plane offset is not consistent with plane origin")}(n,"fromValues()"),n}function x(e){v.fromVectorsAndPoint(e.basis2,e.basis1,e.origin,e.plane)}function _(e,t,r){e!==r&&b(e,r);var n=c.vec3.scale(d.sv3d.get(),I(e),t);return c.vec3.add(r.origin,r.origin,n),r.plane[3]-=t,r}function S(e,t){void 0===t&&(t=g());var r=(e[2]-e[0])/2,n=(e[3]-e[1])/2;return c.vec3.set(t.origin,e[0]+r,e[1]+n,0),c.vec3.set(t.basis1,r,0,0),c.vec3.set(t.basis2,0,n,0),v.fromValues(0,0,1,0,t.plane),t}function w(e,t,r){return!!v.intersectRay(e.plane,t,r)&&C(e,r)}function O(e,t,r){var n=L.get();D(e,t,n,L.get());for(var a=Number.POSITIVE_INFINITY,o=0,s=B;o<s.length;o++){var l=z(e,s[o],R.get()),f=d.sv3d.get();if(v.intersectLineSegment(n,l,f)){var p=u.directionFromTo(d.sv3d.get(),t.origin,f),h=Math.abs(i.acosClamped(c.vec3.dot(t.direction,p)));h<a&&(a=h,c.vec3.copy(r,f))}}return a===Number.POSITIVE_INFINITY?P(e,t,r):r}function P(e,t,r){if(w(e,t,r))return r;var n=L.get(),i=L.get();D(e,t,n,i);for(var a=Number.POSITIVE_INFINITY,o=0,s=B;o<s.length;o++){var l=z(e,s[o],R.get()),u=d.sv3d.get();if(v.intersectLineSegmentClamp(n,l,u)){var f=p.distance2(t,u);if(!v.isPointInside(i,u))continue;f<a&&(a=f,c.vec3.copy(r,u))}}return A(e,t.origin)<a&&M(e,t.origin,r),r}function M(e,t,r){var n=v.projectPoint(e.plane,t,d.sv3d.get()),i=f.projectPointClamp(V(e,e.basis1),n,-1,1,d.sv3d.get()),a=f.projectPointClamp(V(e,e.basis2),n,-1,1,d.sv3d.get());return c.vec3.subtract(r,c.vec3.add(d.sv3d.get(),i,a),e.origin),r}function T(e,t,r){var n=e.origin,i=e.basis1,a=e.basis2,o=c.vec3.subtract(d.sv3d.get(),t,n),s=h.projectPointSignedLength(i,o),l=h.projectPointSignedLength(a,o),u=h.projectPointSignedLength(I(e),o);return c.vec3.set(r,s,l,u)}function A(e,t){var r=T(e,t,d.sv3d.get()),n=e.basis2,i=c.vec3.length(e.basis1),a=c.vec3.length(n),o=Math.max(Math.abs(r[0])-i,0),s=Math.max(Math.abs(r[1])-a,0),l=r[2];return o*o+s*s+l*l}function j(e,t){var r=-e.plane[3];return h.projectPointSignedLength(I(e),t)-r}function I(e){return v.normal(e.plane)}function C(e,t){var r=c.vec3.subtract(d.sv3d.get(),t,e.origin),n=c.vec3.squaredLength(e.basis1),i=c.vec3.squaredLength(e.basis2),a=c.vec3.dot(e.basis1,r),o=c.vec3.dot(e.basis2,r);return-a-n<0&&a-n<0&&-o-i<0&&o-i<0}function V(e,t){var r=R.get();return c.vec3.copy(r.origin,e.origin),c.vec3.copy(r.vector,t),r}function z(e,t,r){var n=e.basis1,i=e.basis2,a=e.origin,o=c.vec3.scale(d.sv3d.get(),n,t.origin[0]),s=c.vec3.scale(d.sv3d.get(),i,t.origin[1]);c.vec3.add(r.origin,o,s),c.vec3.add(r.origin,r.origin,a);var l=c.vec3.scale(d.sv3d.get(),n,t.direction[0]),u=c.vec3.scale(d.sv3d.get(),i,t.direction[1]);return c.vec3.scale(r.vector,c.vec3.add(l,l,u),2),r}function D(e,t,r,n){var i=I(e);v.fromVectorsAndPoint(i,t.direction,t.origin,r),v.fromVectorsAndPoint(v.normal(r),i,t.origin,n)}t.BoundedPlaneClass=function(){this.plane=v.create(),this.origin=l.vec3f64.create(),this.basis1=l.vec3f64.create(),this.basis2=l.vec3f64.create()},t.create=g,t.wrap=function(e,t,r){var n=N.get();return n.origin=e,n.basis1=t,n.basis2=r,n.plane=v.wrap(0,0,0,0),x(n),n},t.copy=b,t.fromValues=y,t.updateUnboundedPlane=x,t.elevate=_,t.setExtent=function(e,t,r){return S(t,r),_(r,j(e,e.origin),r),r},t.fromAABoundingRect=S,t.intersectRay=w,t.intersectRayClosestSilhouette=function(e,t,r){if(w(e,t,r))return r;var n=O(e,t,d.sv3d.get());return c.vec3.add(r,t.origin,c.vec3.scale(d.sv3d.get(),t.direction,c.vec3.distance(t.origin,n)/c.vec3.length(t.direction))),r},t.closestPointOnSilhouette=O,t.closestPoint=P,t.projectPoint=M,t.projectPointLocal=T,t.distance2=A,t.distance=function(e,t){return Math.sqrt(A(e,t))},t.distanceToSilhouette=function(e,t){for(var r=Number.NEGATIVE_INFINITY,n=0,i=B;n<i.length;n++){var a=z(e,i[n],R.get()),o=f.distance2(a,t);o>r&&(r=o)}return Math.sqrt(r)},t.extrusionContainsPoint=function(e,t){return v.isPointInside(e.plane,t)&&C(e,t)},t.axisAt=function(e,t,n,i){return function(e,t,n){switch(t){case 0:c.vec3.copy(n,e.basis1),c.vec3.normalize(n,n);break;case 1:c.vec3.copy(n,e.basis2),c.vec3.normalize(n,n);break;case 2:c.vec3.copy(n,I(e));break;default:r.neverReached(t)}return n}(e,n,i)},t.altitudeAt=j,t.setAltitudeAt=function(e,t,r,n){var i=j(e,t),a=c.vec3.scale(F,I(e),r-i);return c.vec3.add(n,t,a),n},t.equals=function(e,t){return c.vec3.exactEquals(e.basis1,t.basis1)&&c.vec3.exactEquals(e.basis2,t.basis2)&&c.vec3.exactEquals(e.origin,t.origin)},t.transform=function(e,t,r){return e!==r&&b(e,r),o.mat4.invert(U,t),o.mat4.transpose(U,U),c.vec3.transformMat4(r.basis1,e.basis1,U),c.vec3.transformMat4(r.basis2,e.basis2,U),c.vec3.transformMat4(v.normal(r.plane),v.normal(e.plane),U),c.vec3.transformMat4(r.origin,e.origin,t),v.setOffsetFromPoint(r.plane,r.origin,r.plane),r},t.rotate=function(e,t,r,n){return e!==n&&b(e,n),o.mat4.rotate(E,o.mat4.identity(E),t,r),c.vec3.transformMat4(n.basis1,e.basis1,E),c.vec3.transformMat4(n.basis2,e.basis2,E),x(n),n},t.normal=I,t.UP={plane:v.create(),origin:l.vec3f64.fromValues(0,0,0),basis1:l.vec3f64.fromValues(1,0,0),basis2:l.vec3f64.fromValues(0,1,0)};var L=new a.ObjectStack(v.create),R=new a.ObjectStack(f.create),F=l.vec3f64.create(),N=new a.ObjectStack((function(){return{origin:null,basis1:null,basis2:null,plane:null}})),B=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],U=s.mat4f64.create(),E=s.mat4f64.create()}).apply(null,n))||(e.exports=i)},"2o+p":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei"),r("s6rJ")],void 0===(i=(function(e,t,r,n,i){"use strict";function a(e){e.vertex.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize = 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "],["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize = 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "])))),e.vertex.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "],["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "])))),e.vertex.code.add(n.glsl(c||(c=r.__makeTemplateObject(["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "],["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "])))),e.vertex.code.add(n.glsl(l||(l=r.__makeTemplateObject(["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "],["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "])))),e.vertex.code.add(n.glsl(u||(u=r.__makeTemplateObject(["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "],["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "])))),e.vertex.code.add(n.glsl(d||(d=r.__makeTemplateObject(["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "],["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "])))),e.vertex.code.add(n.glsl(f||(f=r.__makeTemplateObject(["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "]))))}var o,s,c,l,u,d,f;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSizePerspective=void 0,t.ScreenSizePerspective=a,function(e){e.bindUniforms=function(e,t){t.screenSizePerspective&&(i.bindScreenSizePerspective(t.screenSizePerspective,e,"screenSizePerspective"),i.bindScreenSizePerspective(t.screenSizePerspectiveAlignment||t.screenSizePerspective,e,"screenSizePerspectiveAlignment"))}}(a=t.ScreenSizePerspective||(t.ScreenSizePerspective={}))}).apply(null,n))||(e.exports=i)},"3PFg":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";function i(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add("instanceFeatureAttribute","vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "],["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "])))),e.vertex.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "],["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "])),t.vvInstancingEnabled?n.glsl(o||(o=r.__makeTemplateObject(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"],["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):e.vertex.code.add(n.glsl(c||(c=r.__makeTemplateObject(["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "],["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "])))),t.vvColor?(e.vertex.defines.addInt("VV_COLOR_N",8),e.vertex.code.add(n.glsl(u||(u=r.__makeTemplateObject(["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < VV_COLOR_N; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ","\n    "],["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < VV_COLOR_N; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ","\n    "])),t.vvInstancingEnabled?n.glsl(l||(l=r.__makeTemplateObject(["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"],["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"]))):""))):e.vertex.code.add(n.glsl(d||(d=r.__makeTemplateObject(["\n      vec4 vvColor() { return vec4(1.0); }\n    "],["\n      vec4 vvColor() { return vec4(1.0); }\n    "]))))}var a,o,s,c,l,u,d;Object.defineProperty(t,"__esModule",{value:!0}),t.VisualVariables=void 0,t.VisualVariables=i,function(e){function t(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}e.bindUniforms=t,e.bindUniformsWithOpacity=function(e,r){t(e,r),r.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",r.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",r.vvOpacityOpacities))},e.bindUniformsForSymbols=function(e,r){t(e,r),r.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",r.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",r.vvSymbolRotationMatrix))}}(i=t.VisualVariables||(t.VisualVariables={}))}).apply(null,n))||(e.exports=i)},"3RHn":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KBgh"),r("0LE5"),r("Rdxj"),r("CIy2")],void 0===(i=(function(e,t,r,n,i,a){"use strict";var o=function(){function e(t,r,o,s){this.primitiveIndices=t,this._numIndexPerPrimitive=r,this.indices=o,this._position=s,this.center=i.vec3f64.create(),a.assert(t.length>=1),a.assert(o.length%this._numIndexPerPrimitive==0),a.assert(o.length>=t.length*this._numIndexPerPrimitive),a.assert(3===this._position.size||4===this._position.size);var c=this._position,l=c.data,u=c.offsetIdx,d=c.strideIdx,f=0,v=t.length,p=u+d*o[this._numIndexPerPrimitive*t[f]];for(e.tmpIndices.clear(),e.tmpIndices.push(p),this.bbMin=i.vec3f64.fromValues(l[p],l[p+1],l[p+2]),this.bbMax=i.vec3f64.clone(this.bbMin);f<v;++f)for(var h=this._numIndexPerPrimitive*t[f],m=0;m<this._numIndexPerPrimitive;++m){e.tmpIndices.push(p=u+d*o[h+m]);var g=l[p];this.bbMin[0]=Math.min(g,this.bbMin[0]),this.bbMax[0]=Math.max(g,this.bbMax[0]),g=l[p+1],this.bbMin[1]=Math.min(g,this.bbMin[1]),this.bbMax[1]=Math.max(g,this.bbMax[1]),g=l[p+2],this.bbMin[2]=Math.min(g,this.bbMin[2]),this.bbMax[2]=Math.max(g,this.bbMax[2])}n.vec3.lerp(this.center,this.bbMin,this.bbMax,.5),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var b=this.bsRadius*this.bsRadius;for(f=0;f<e.tmpIndices.length;++f){var y=l[p=e.tmpIndices.data[f]]-this.center[0],x=l[p+1]-this.center[1],_=l[p+2]-this.center[2],S=y*y+x*x+_*_;if(!(S<=b)){var w=Math.sqrt(S),O=.5*(w-this.bsRadius);this.bsRadius=this.bsRadius+O,b=this.bsRadius*this.bsRadius;var P=O/w;this.center[0]+=y*P,this.center[1]+=x*P,this.center[2]+=_*P}}e.tmpIndices.clear()}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this._children)return this._children;if(n.vec3.squaredDistance(this.bbMin,this.bbMax)>1){for(var t=n.vec3.lerp(i.vec3f64.create(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,a=new Uint8Array(r),o=new Array(8),s=0;s<8;++s)o[s]=0;var c=this._position,l=c.data,u=c.offsetIdx,d=c.strideIdx;for(s=0;s<r;++s){for(var f=0,v=this._numIndexPerPrimitive*this.primitiveIndices[s],p=u+d*this.indices[v],h=l[p],m=l[p+1],g=l[p+2],b=1;b<this._numIndexPerPrimitive;++b){var y=l[p=u+d*this.indices[v+b]],x=l[p+1],_=l[p+2];y<h&&(h=y),x<m&&(m=x),_<g&&(g=_)}h<t[0]&&(f|=1),m<t[1]&&(f|=2),g<t[2]&&(f|=4),a[s]=f,++o[f]}var S=0;for(s=0;s<8;++s)o[s]>0&&++S;if(S<2)return;var w=new Array(8);for(s=0;s<8;++s)w[s]=o[s]>0?new Uint32Array(o[s]):void 0;for(s=0;s<8;++s)o[s]=0;for(s=0;s<r;++s)w[f=a[s]][o[f]++]=this.primitiveIndices[s];for(this._children=new Array(8),s=0;s<8;++s)void 0!==w[s]&&(this._children[s]=new e(w[s],this._numIndexPerPrimitive,this.indices,this._position))}return this._children},e}();return function(e){e.tmpIndices=new r({deallocator:null})}(o||(o={})),o}).apply(null,n))||(e.exports=i)},"3kdR":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=void 0,t.Transform=function(e,t){e.vertex.code.add(n.glsl(t.linearDepth?i||(i=r.__makeTemplateObject(["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye = view * vec4(pos, 1.0);\n      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "],["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye = view * vec4(pos, 1.0);\n      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "])):a||(a=r.__makeTemplateObject(["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "],["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "]))))}}).apply(null,n))||(e.exports=i)},"4p4v":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("PHan"),r("jBNx"),r("W9tT"),r("0LE5"),r("Rdxj"),r("JjCO")],void 0===(i=(function(e,t,r,n,i,a,o,s){"use strict";function c(e){return e?{origin:o.vec3f64.clone(e.origin),direction:o.vec3f64.clone(e.direction)}:{origin:o.vec3f64.create(),direction:o.vec3f64.create()}}function l(e,t,r){return void 0===r&&(r=c()),a.vec3.copy(r.origin,e),a.vec3.copy(r.direction,t),r}function u(e,t,r){void 0===r&&(r=c());var o=n.castRenderScreenPointArray3(i.vec2.copy(s.sv3d.get(),t));o[2]=0,e.unprojectPoint(o,r.origin);var l=n.castRenderScreenPointArray3(i.vec2.copy(s.sv3d.get(),t));l[2]=1;var u=e.unprojectPoint(l,s.sv3d.get());return a.vec3.subtract(r.direction,u,r.origin),r}function d(e,t,r){void 0===r&&(r=c()),a.vec3.copy(r.origin,e.eye);var n=a.vec3.set(s.sv3d.get(),t[0],t[1],1),i=e.unprojectPoint(n,s.sv3d.get());return a.vec3.subtract(r.direction,i,r.origin),r}function f(e,t){var r=a.vec3.cross(s.sv3d.get(),a.vec3.normalize(s.sv3d.get(),e.direction),a.vec3.subtract(s.sv3d.get(),t,e.origin));return a.vec3.dot(r,r)}function v(){return{origin:null,direction:null}}Object.defineProperty(t,"__esModule",{value:!0}),t.createWrapper=t.closestPoint=t.distance=t.distance2=t.fromRenderAtEye=t.fromScreenAtEye=t.fromRender=t.fromScreen=t.fromValues=t.fromPoints=t.copy=t.wrap=t.create=void 0,t.create=c,t.wrap=function(e,t){var r=p.get();return r.origin=e,r.direction=t,r},t.copy=function(e,t){return void 0===t&&(t=c()),l(e.origin,e.direction,t)},t.fromPoints=function(e,t,r){return void 0===r&&(r=c()),a.vec3.copy(r.origin,e),a.vec3.subtract(r.direction,t,e),r},t.fromValues=l,t.fromScreen=function(e,t,r){return void 0===r&&(r=c()),u(e,e.screenToRender(t,n.castRenderScreenPointArray3(s.sv3d.get())),r)},t.fromRender=u,t.fromScreenAtEye=function(e,t,r){return void 0===r&&(r=c()),d(e,e.screenToRender(t,n.castRenderScreenPointArray3(s.sv3d.get())),r)},t.fromRenderAtEye=d,t.distance2=f,t.distance=function(e,t){return Math.sqrt(f(e,t))},t.closestPoint=function(e,t,r){var n=a.vec3.dot(e.direction,a.vec3.subtract(r,t,e.origin));return a.vec3.add(r,e.origin,a.vec3.scale(r,e.direction,n)),r},t.createWrapper=v;var p=new r.ObjectStack(v)}).apply(null,n))||(e.exports=i)},"51bw":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xf8T")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3f64=void 0,t.mat3f64=r}).apply(null,n))||(e.exports=i)},"62Ht":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("W0kZ")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Object3DStateSet=t.generateObject3DStateId=void 0;var n=new r.IdGen;t.generateObject3DStateId=function(e){return{id:n.gen(0===e?"highlight":"occludee"),channel:e}};var i=function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:0,objectStateId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,r){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:r})},e.prototype.addExternal=function(e,t){this.items.push({type:2,objectStateId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.objectStateId===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];0===r.type&&r.object===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];1===r.type&&r.renderGeometry===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach((function(t){e._removeObjectStateItem(t)})),this.items=[]},e.prototype._removeObjectStateItem=function(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}},e}();t.Object3DStateSet=i}).apply(null,n))||(e.exports=i)},"6t3m":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i,a,o;Object.defineProperty(t,"__esModule",{value:!0}),t.VertexColor=void 0,t.VertexColor=function(e,t){t.attributeColor?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n      void forwardVertexColor() { vColor = color; }\n    "],["\n      void forwardVertexColor() { vColor = color; }\n    "])))),e.vertex.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }\n    "],["\n      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }\n    "]))))):e.vertex.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "],["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "]))))}}).apply(null,n))||(e.exports=i)},"7Aei":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function r(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n="",i=0;i<t.length;i++)n+=e[i]+t[i];return n+e[e.length-1]}Object.defineProperty(t,"__esModule",{value:!0}),t.glsl=void 0,t.glsl=r,function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(r=t.glsl||(t.glsl={}))}).apply(null,n))||(e.exports=i)},"9DjX":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("YX1r"),r("51bw"),r("FXVB"),r("1m5D"),r("EuvN"),r("lLWD"),r("0LE5"),r("vlC2"),r("Rdxj"),r("2fXB"),r("O7NG"),r("aWgr"),r("2eYJ"),r("/dtL"),r("ZJC8")],void 0===(i=(function(e,t,r,n,i,a,o,s,c,l,u,d,f,v,p,h,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TERRAIN_ID=t.getVerticalOffsetTerrain=t.getVerticalOffsetI3S=t.getVerticalOffsetObject3D=t.Object3DVerticalOffsetGlobalViewingMode=t.I3SVerticalOffsetGlobalViewingMode=t.TerrainVerticalOffsetGlobalViewingMode=t.IntersectorResult=t.IntersectorResults=t.IntersectorTransform=t.IntersectorOptions=t.sliceFilterPredicate=void 0,t.sliceFilterPredicate=function(e){return function(t,r,n){return l.vec3.lerp(I,t,r,n),!h.extrusionContainsPoint(e,I)}},t.IntersectorOptions=function(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2};var b=function(){function e(){this._transform=o.mat4f64.create(),this._transformInverse=new y({value:this._transform},a.mat4.invert,o.mat4f64.create),this._transformInverseTranspose=new y(this._transformInverse,a.mat4.transpose,o.mat4f64.create),this._transformTranspose=new y({value:this._transform},a.mat4.transpose,o.mat4f64.create),this._transformInverseRotation=new y({value:this._transform},n.mat3.normalFromMat4Legacy,i.mat3f64.create)}return e.prototype.invalidateLazyTransforms=function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()},Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!1,configurable:!0}),e.prototype.setTransformMatrix=function(e){a.mat4.copy(this._transform,e)},e.prototype.multiplyTransform=function(e){a.mat4.multiply(this._transform,this._transform,e)},e.prototype.set=function(e){a.mat4.copy(this._transform,e),this.invalidateLazyTransforms()},e.prototype.setAndInvalidateLazyTransforms=function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()},e}();t.IntersectorTransform=b;var y=function(){function e(e,t,r){this.original=e,this.update=t,this.dirty=!0,this.transform=r()}return e.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform},enumerable:!1,configurable:!0}),e}(),x=function(){function e(){this.min=new _,this.max=new _,this.hud=new _,this.ground=new _}return e.prototype.init=function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]},e}();t.IntersectorResults=x;var _=function(){function e(e){this.normal=d.vec3f64.create(),this.transformation=o.mat4f64.create(),this._ray=p.ray.create(),this.init(e)}return Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return l.vec3.scale(C,this.ray.direction,this.dist),l.vec3.length(C)},enumerable:!1,configurable:!0}),e.prototype.getIntersectionPoint=function(e){return!!this.hasIntersectionPoint&&(l.vec3.scale(C,this.ray.direction,this.dist),l.vec3.add(e,this.ray.origin,C),!0)},e.prototype.getTransformedNormal=function(e){return l.vec3.copy(V,this.normal),V[3]=0,f.vec4.transformMat4(V,V,this.transformation),l.vec3.copy(e,V),l.vec3.normalize(e,e),e},e.prototype.init=function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?p.ray.copy(e,this._ray):this._ray=p.ray.create()},e.prototype.set=function(e,t,r,n,i,o,s,c,u,f){e instanceof g&&(e={type:"stage",obj:e}),this.dist=r,l.vec3.copy(this.normal,n),a.mat4.copy(this.transformation,i),this.target=e,this.name=t,this.drapedLayerOrder=o,this.center=s?d.vec3f64.clone(s):null,this.geometryId=c,this.triangleNr=u,this.drapedLayerGraphicOrder=f},e.prototype.copyFrom=function(e){p.ray.copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?d.vec3f64.clone(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,l.vec3.copy(this.normal,e.normal),a.mat4.copy(this.transformation,e.transformation)},e.prototype.toOwner=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return S(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e,t){var r=e.metadata.layerUid;return null!=r?t.map.findLayerByUid(r):null}(this.target,e);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return S(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null},e.prototype.toGraphic=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return w(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return this.target.metadata.createGraphic();case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return w(this.target.metadata,e)}}return null},e}();function S(e,t){return r.isNone(e)||null==e.layerUid?null:r.isSome(t.graphicsView)&&e.layerUid===t.graphicsView.mockLayerId?t.graphics:t.map.findLayerByUid(e.layerUid)}function w(e,t){if(r.isNone(e))return null;var n=S(e,t);if(r.isNone(n))return null;if(n===t.graphics)return r.isSome(t.graphicsView)?r.unwrap(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;var i=t.allLayerViews.find((function(e){return e.layer===n}));return i?function(e,t){return!e||e.suspended?null:"getGraphicFromIntersectorMetadata"in e&&t?e.getGraphicFromIntersectorMetadata(t):"getGraphicFromGraphicUid"in e&&null!=t.graphicUid?e.getGraphicFromGraphicUid(t.graphicUid):null}(i,e):null}t.IntersectorResult=_;var O=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.tmpVertex=d.vec3f64.create()}return e.prototype.applyToVertex=function(e,t,r){var n=e+this.localOrigin[0],i=t+this.localOrigin[1],a=r+this.localOrigin[2],o=this.offset/Math.sqrt(n*n+i*i+a*a);return this.tmpVertex[0]=e+n*o,this.tmpVertex[1]=t+i*o,this.tmpVertex[2]=r+a*o,this.tmpVertex},e.prototype.applyToAabb=function(e){var t=e[0]+this.localOrigin[0],r=e[1]+this.localOrigin[1],n=e[2]+this.localOrigin[2],i=e[3]+this.localOrigin[0],a=e[4]+this.localOrigin[1],o=e[5]+this.localOrigin[2],s=this.offset/Math.sqrt(t*t+r*r+n*n);e[0]+=t*s,e[1]+=r*s,e[2]+=n*s;var c=this.offset/Math.sqrt(i*i+a*a+o*o);return e[3]+=i*c,e[4]+=a*c,e[5]+=o*c,e},e}();t.TerrainVerticalOffsetGlobalViewingMode=O;var P=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=d.vec3f64.create(),this.mbs=v.vec4f64.create(),this.obb={center:d.vec3f64.create(),halfSize:u.vec3f32.create(),quaternion:null}}return Object.defineProperty(e.prototype,"localOrigin",{set:function(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},enumerable:!1,configurable:!0}),e.prototype.applyToVertex=function(e,t,r){var n=e,i=t,a=r+this.componentLocalOriginLength,o=this.offset/Math.sqrt(n*n+i*i+a*a);return this.tmpVertex[0]=e+n*o,this.tmpVertex[1]=t+i*o,this.tmpVertex[2]=r+a*o,this.tmpVertex},e.prototype.applyToAabb=function(e){var t=e[0],r=e[1],n=e[2]+this.componentLocalOriginLength,i=e[3],a=e[4],o=e[5]+this.componentLocalOriginLength,s=this.offset/Math.sqrt(t*t+r*r+n*n);e[0]+=t*s,e[1]+=r*s,e[2]+=n*s;var c=this.offset/Math.sqrt(i*i+a*a+o*o);return e[3]+=i*c,e[4]+=a*c,e[5]+=o*c,e},e.prototype.applyToMbs=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/t;return this.mbs[0]=e[0]+e[0]*r,this.mbs[1]=e[1]+e[1]*r,this.mbs[2]=e[2]+e[2]*r,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs},e.prototype.applyToObb=function(e){var t=e.center,r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*r,this.obb.center[1]=t[1]+t[1]*r,this.obb.center[2]=t[2]+t[2]*r,l.vec3.transformQuat(this.obb.halfSize,e.halfSize,e.quaternion),l.vec3.add(this.obb.halfSize,this.obb.halfSize,e.center);var n=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*n,this.obb.halfSize[1]+=this.obb.halfSize[1]*n,this.obb.halfSize[2]+=this.obb.halfSize[2]*n,l.vec3.subtract(this.obb.halfSize,this.obb.halfSize,e.center),s.quat.conjugate(z,e.quaternion),l.vec3.transformQuat(this.obb.halfSize,this.obb.halfSize,z),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb},e}();t.I3SVerticalOffsetGlobalViewingMode=P;var M=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.sphere=m.create(),this.tmpVertex=d.vec3f64.create()}return e.prototype.applyToVertex=function(e,t,r){var n=this.objectTransform.transform,i=n[0]*e+n[4]*t+n[8]*r+n[12],a=n[1]*e+n[5]*t+n[9]*r+n[13],o=n[2]*e+n[6]*t+n[10]*r+n[14],s=this.offset/Math.sqrt(i*i+a*a+o*o),c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*(i+=i*s)+c[4]*(a+=a*s)+c[8]*(o+=o*s)+c[12],this.tmpVertex[1]=c[1]*i+c[5]*a+c[9]*o+c[13],this.tmpVertex[2]=c[2]*i+c[6]*a+c[10]*o+c[14],this.tmpVertex},e.prototype.applyToMinMax=function(e,t){var r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;var n=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*n,t[1]+=t[1]*n,t[2]+=t[2]*n},e.prototype.applyToAabb=function(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e},e.prototype.applyToBoundingSphere=function(e,t){var r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),n=this.offset/r;return this.sphere.center[0]=t[0]+t[0]*n,this.sphere.center[1]=t[1]+t[1]*n,this.sphere.center[2]=t[2]+t[2]*n,this.sphere.radius=e+e*this.offset/r,this.sphere},e}();t.Object3DVerticalOffsetGlobalViewingMode=M;var T=new M;t.getVerticalOffsetObject3D=function(e){return r.isSome(e)?(T.offset=e,T):null};var A=new P;t.getVerticalOffsetI3S=function(e){return r.isSome(e)?(A.offset=e,A):null};var j=new O;t.getVerticalOffsetTerrain=function(e){return r.isSome(e)?(j.offset=e,j):null},t.TERRAIN_ID="terrain";var I=d.vec3f64.create(),C=d.vec3f64.create(),V=v.vec4f64.create(),z=c.quatf64.create()}).apply(null,n))||(e.exports=i)},"9FJH":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("LxLY"),r("EiD/"),r("tUyH")],void 0===(i=(function(e,t,r,n,i,a){"use strict";return function(e){function t(t){var r=e.call(this,t)||this;return r._textureIDs=new Set,r._textureRepository=t.textureRep,r._textureId=t.textureId,r._initTransparent=!!t.initTextureTransparent,r._texture=r._acquireIfNotUndefined(r._textureId),r._textureNormal=r._acquireIfNotUndefined(t.normalTextureId),r._textureEmissive=r._acquireIfNotUndefined(t.emissiveTextureId),r._textureOcclusion=r._acquireIfNotUndefined(t.occlusionTextureId),r._textureMetallicRoughness=r._acquireIfNotUndefined(t.metallicRoughnessTextureId),r}return r.__extends(t,e),t.prototype.dispose=function(){var e=this;this._textureIDs.forEach((function(t){return e._textureRepository.release(t)})),this._textureIDs.clear()},t.prototype.updateTexture=function(e){e!==this._textureId&&(this._releaseIfNotUndefined(this._textureId),this._textureId=e,this._texture=this._acquireIfNotUndefined(this._textureId))},t.prototype.bindTexture=function(e,t){n.isSome(this._texture)&&(t.setUniform1i("tex",i.DefaultTextureUnits.DIFFUSE),e.bindTexture(this._texture.glTexture,i.DefaultTextureUnits.DIFFUSE)),n.isSome(this._textureNormal)&&(t.setUniform1i("normalTexture",i.DefaultTextureUnits.NORMAL),e.bindTexture(this._textureNormal.glTexture,i.DefaultTextureUnits.NORMAL)),n.isSome(this._textureEmissive)&&(t.setUniform1i("texEmission",i.DefaultTextureUnits.EMISSION),e.bindTexture(this._textureEmissive.glTexture,i.DefaultTextureUnits.EMISSION)),n.isSome(this._textureOcclusion)&&(t.setUniform1i("texOcclusion",i.DefaultTextureUnits.OCCLUSION),e.bindTexture(this._textureOcclusion.glTexture,i.DefaultTextureUnits.OCCLUSION)),n.isSome(this._textureMetallicRoughness)&&(t.setUniform1i("texMetallicRoughness",i.DefaultTextureUnits.METALLIC_ROUGHNESS),e.bindTexture(this._textureMetallicRoughness.glTexture,i.DefaultTextureUnits.METALLIC_ROUGHNESS))},t.prototype.bindTextureScale=function(e,t){var r=n.isSome(this._texture)&&this._texture.glTexture;r&&r.descriptor.textureCoordinateScaleFactor?t.setUniform2fv("textureCoordinateScaleFactor",r.descriptor.textureCoordinateScaleFactor):t.setUniform2f("textureCoordinateScaleFactor",1,1)},t.prototype._acquireIfNotUndefined=function(e){if(!n.isNone(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)},t.prototype._releaseIfNotUndefined=function(e){void 0!==e&&(this._textureIDs.delete(e),this._textureRepository.release(e))},t}(a.GLMaterial)}).apply(null,n))||(e.exports=i)},AgDx:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("+nCE"),r("CIy2")],void 0===(i=(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryData=void 0;var i=function(){function e(t,r,n){void 0===r&&(r=e.DefaultIndices),void 0===n&&(n="triangle"),this.initialize(t,r,n)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){var e=n.getFirstObjectValue(this._indices);return null==e?0:e.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!1,configurable:!0}),e.prototype.getVertexAttr=function(){return this.vertexAttributes},e.prototype.initialize=function(t,i,a){void 0===i&&(i=e.DefaultIndices),void 0===a&&(a="triangle");var o={};for(var s in t){var c=t[s],l=c.size;o[s]={data:c.data,size:l,offsetIdx:0,strideIdx:l}}if(i===e.DefaultIndices){var u=function(e){var t=n.getFirstObjectValue(e);return null==t?0:t.data.length/t.size}(o),d=r.generateDefaultIndexArray(u);for(var f in i={},o)i[f]=d}this._id=r.getNewId(),this._vertexAttributes=o,this._indices=i,this._primitiveType=a},e.prototype.toRenderData=function(){return{id:this._id.toString(),indices:this._indices,vertexAttr:this._vertexAttributes}},e.prototype.getIndices=function(e){return this._indices[e]},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){var e=0;if(this._indices[n.VertexAttrConstants.POSITION]){var t=3;e+=this._indices[n.VertexAttrConstants.POSITION].length*t*4}return this._indices[n.VertexAttrConstants.NORMAL]&&(e+=this._indices[n.VertexAttrConstants.NORMAL].length*(t=3)*4),this._indices[n.VertexAttrConstants.UV0]&&(e+=this._indices[n.VertexAttrConstants.UV0].length*(t=2)*4),this._indices[n.VertexAttrConstants.COLOR]&&(e+=this._indices[n.VertexAttrConstants.COLOR].length*(t=1)*4),e},e.DefaultIndices={},e}();t.GeometryData=i}).apply(null,n))||(e.exports=i)},CIy2:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+"),r("FXVB"),r("W9tT"),r("DIqE"),r("Rdxj"),r("2fXB"),r("O7NG")],void 0===(i=(function(e,t,r,n,i,a,o,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inverseProjectionInfo=t.unpackFloatRGBA=t.packFloatRGBA=t.fovd2fovy=t.fovd2fovx=t.fovy2fovd=t.fovx2fovd=t.fovy2fovx=t.fovx2fovy=t.isTranslationMatrix=t.createTranslationMatrix=t.getMatrixTranslation=t.setMatrixTranslation3=t.setMatrixTranslation=t.logWithBase=t.objectEmpty=t.getFirstObjectValue=t.getFirstObjectKey=t.project=t.rayRay2D=t.rayBoxTest=t.rayTriangle3D=t.dec2hex=t.rgb2hex=t.hex2rgb=t.fallbackIfUndefined=t.encodeNormal=t.encodeInt16=t.verify=t.assert=t.VertexAttrConstants=t.AssertException=void 0;var l=c.vec4f64.create(),u=function(){function e(e){this.message=e}return e.prototype.toString=function(){return"AssertException: "+this.message},e}();function d(e,t){if(!e){t=t||"assert";var r=new Error(t);throw r.stack&&console.log(r.stack),new u(t)}}function f(e){for(var t in e)return t}function v(e,t){e[12]=t[0],e[13]=t[1],e[14]=t[2]}function p(e,t){void 0===t&&(t=0);for(var r=0,n=0;n<4;n++)r+=e[t+n]*m[n];return r}t.AssertException=u,t.VertexAttrConstants={POSITION:"position",NORMAL:"normal",UV0:"uv0",UVMAPSPACE:"uvMapSpace",MEANVERTEXPOSITION:"meanVertexPosition",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",BOUND1:"bound1",BOUND2:"bound2",BOUND3:"bound3",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",TANGENT:"tangent"},t.assert=d,t.verify=function(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))},t.encodeInt16=function(e){return r.clamp(Math.round(32767*e),-32767,32767)},t.encodeNormal=function(e,t){var r=Math.abs(e[0]),n=Math.abs(e[1]),i=1/(r+n+Math.abs(e[2])),a=r*i,o=n*i,s=Math.min(e[2]*i,0);t[0]=(e[0]<0?-1:1)*(a-s),t[1]=(e[1]<0?-1:1)*(o-s)},t.fallbackIfUndefined=function(e,t){return void 0===e?t:e},t.hex2rgb=function(e){return[((e=Math.floor(e))>>16&255)/255,(e>>8&255)/255,(255&e)/255]},t.rgb2hex=function(e){return"0x"+((r.clamp(Math.round(255*e[0]),0,255)<<16)+(r.clamp(Math.round(255*e[1]),0,255)<<8)+r.clamp(Math.round(255*e[2]),0,255)).toString(16)},t.dec2hex=function(e){var t=e.toString(16);return"00000000".substr(0,8-t.length)+t},t.rayTriangle3D=function(e,t,r,n,i,a,s,c,l){void 0===l&&(l=o.vec3f64.create());var u=n[s]-r[a],d=n[s+1]-r[a+1],f=n[s+2]-r[a+2],v=i[c]-r[a],p=i[c+1]-r[a+1],h=i[c+2]-r[a+2],m=t[1]*h-p*t[2],g=t[2]*v-h*t[0],b=t[0]*p-v*t[1],y=u*m+d*g+f*b;if(y>-1e-5&&y<1e-5)return!1;var x=1/y,_=e[0]-r[a],S=e[1]-r[a+1],w=e[2]-r[a+2];if(l[1]=x*(_*m+S*g+w*b),l[1]<0||l[1]>1)return!1;var O=S*f-d*w,P=w*u-f*_,M=_*d-u*S;return l[2]=x*(t[0]*O+t[1]*P+t[2]*M),!(l[2]<0||l[1]+l[2]>1||(l[0]=x*(v*O+p*P+h*M),0))},t.rayBoxTest=function(e,t,r,n){var i,a=(r[0]-e[0])/t[0],o=(n[0]-e[0])/t[0];a>o&&(i=a,a=o,o=i);var s=(r[1]-e[1])/t[1],c=(n[1]-e[1])/t[1];if(s>c&&(i=s,s=c,c=i),a>c||s>o)return!1;s>a&&(a=s),c<o&&(o=c);var l=(r[2]-e[2])/t[2],u=(n[2]-e[2])/t[2];return l>u&&(i=l,l=u,u=i),!(a>u||l>o||(u<o&&(o=u),o<0))},t.rayRay2D=function(e,t,r,n,i,o){void 0===o&&(o=a.vec2f64.create());var s=(n[i]-r[i])*(t[0]-e[0])-(n[0]-r[0])*(t[i]-e[i]);if(0===s)return!1;var c=((n[0]-r[0])*(e[i]-r[i])-(n[i]-r[i])*(e[0]-r[0]))/s;return o[0]=e[0]+c*(t[0]-e[0]),o[1]=e[i]+c*(t[i]-e[i]),!0},t.project=function(e,t,r,n,i){i||(i=e),l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=1,s.vec4.transformMat4(l,l,t),i.length>2&&(i[2]=-l[2]),s.vec4.transformMat4(l,l,r),d(0!==l[3]),i[0]=l[0]/l[3],i[1]=l[1]/l[3],i[2]=l[2]/l[3],i[0]=(.5*i[0]+.5)*n[2]+n[0],i[1]=(.5*i[1]+.5)*n[3]+n[1]},t.getFirstObjectKey=f,t.getFirstObjectValue=function(e){return e[f(e)]},t.objectEmpty=function(e){for(var t in e)return!1;return!0},t.logWithBase=function(e,t){return Math.log(e)/Math.log(t)},t.setMatrixTranslation=v,t.setMatrixTranslation3=function(e,t,r,n){e[12]=t,e[13]=r,e[14]=n},t.getMatrixTranslation=function(e,t){return void 0===t&&(t=o.vec3f64.create()),t[0]=e[12],t[1]=e[13],t[2]=e[14],t},t.createTranslationMatrix=function(e,t){return v(e=n.mat4.identity(e),t),e},t.isTranslationMatrix=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]},t.fovx2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/t)},t.fovy2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/r)},t.fovx2fovd=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)},t.fovy2fovd=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)},t.fovd2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))},t.fovd2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))},t.packFloatRGBA=function(e,t,n){void 0===n&&(n=0);for(var i,a=r.clamp(e,0,g),o=0;o<4;o++)t[n+o]=Math.floor(256*((i=a*h[o])-Math.floor(i)))},t.unpackFloatRGBA=p;var h=[1,256,65536,16777216],m=[1/256,1/65536,1/16777216,1/4294967296],g=p(new Uint8ClampedArray([255,255,255,255]));t.inverseProjectionInfo=function(e,t,r,n,a){var o=e;0===e[11]?(n[0]=2/(t*o[0]),n[1]=2/(r*o[5]),n[2]=(1+o[12])/o[0],n[3]=(1+o[13])/o[5],i.vec2.set(a,0,1)):(n[0]=-2/(t*o[0]),n[1]=-2/(r*o[5]),n[2]=(1-o[8])/o[0],n[3]=(1-o[9])/o[5],i.vec2.set(a,1,0))}}).apply(null,n))||(e.exports=i)},CIzB:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IDENTITY=t.createView=t.fromValues=t.clone=t.create=void 0,t.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},t.fromValues=function(e,t,r,n,i,a,o,s,c,l,u,d,f,v,p,h){return[e,t,r,n,i,a,o,s,c,l,u,d,f,v,p,h]},t.createView=function(e,t){return new Float64Array(e,t,16)},t.IDENTITY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}).apply(null,n))||(e.exports=i)},"Cvn+":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("SyoC"),r("0LE5"),r("W0kZ")],void 0===(i=(function(e,t,r,n,i){"use strict";return function(){function e(){}return e.prototype.acquire=function(t,r,n,i,a,o){this.id=e._idGen.gen(t&&t.id),this.geometry=t,this.material=r,this.transformation=n,this.instanceParameters=i,this.origin=a,this.shaderTransformation=o},e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation},e.prototype.computeAttachmentOrigin=function(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(n.vec3.transformMat4(e,e,this.getStaticTransformation()),!0)},e._idGen=new i.IdGen,e.pool=new r(e),e}()}).apply(null,n))||(e.exports=i)},DKwL:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.RgbaFloatEncoding=void 0,t.RgbaFloatEncoding=function(e){e.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT =\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat = 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS = vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0->1 back to 0->255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "],["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT =\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat = 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS = vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0->1 back to 0->255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "]))))}}).apply(null,n))||(e.exports=i)},"EiD/":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultTextureUnits=void 0,t.DefaultTextureUnits={DIFFUSE:0,NORMAL:1,EMISSION:2,OCCLUSION:3,METALLIC_ROUGHNESS:4,SSAO:6,SHADOW_MAP:7}}).apply(null,n))||(e.exports=i)},EyQ4:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qsST"),r("xoE+"),r("Zp3t")],void 0===(i=(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDDSTextureData=t.createDDSTexture=void 0;var a=r.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function o(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var s=o("DXT1"),c=o("DXT3"),l=o("DXT5");function u(e,t){var r=new Int32Array(e,0,31);if(542327876!==r[0])return a.error("Invalid magic number in DDS header"),null;if(!(4&r[20]))return a.error("Unsupported format, must contain a FourCC code"),null;var i,o,u,d=r[21];switch(d){case s:i=8,o=33776;break;case c:i=16,o=33778;break;case l:i=16,o=33779;break;default:return a.error("Unsupported FourCC code:",(u=d,String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255))),null}var f=1,v=r[4],p=r[3];0==(3&v)&&0==(3&p)||(a.warn("Rounding up compressed texture size to nearest multiple of 4."),v=v+3&-4,p=p+3&-4);var h,m,g=v,b=p;131072&r[2]&&!1!==t&&(f=Math.max(1,r[7])),1===f||n.isPowerOfTwo(v)&&n.isPowerOfTwo(p)||(a.warn("Ignoring mipmaps of non power of two sized compressed texture."),f=1);for(var y=r[1]+4,x=[],_=0;_<f;++_)m=(v+3>>2)*(p+3>>2)*i,h=new Uint8Array(e,y,m),x.push(h),y+=m,v=Math.max(1,v>>1),p=Math.max(1,p>>1);return{textureData:{type:"compressed",levels:x},internalFormat:o,width:g,height:b}}t.createDDSTexture=function(e,t,r,n){var a=u(r,n),o=a.textureData,s=a.internalFormat,c=a.width,l=a.height;t.samplingMode=o.levels.length>1?9987:9729,t.hasMipmap=o.levels.length>1,t.internalFormat=s,t.width=c,t.height=l;var d=new i(e,t,o);return e.bindTexture(d),d},t.createDDSTextureData=u}).apply(null,n))||(e.exports=i)},FNtW:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("ff/U"),r("W0kZ")],void 0===(i=(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.materialPredicate=t.Material=void 0;var a=function(){function e(t){this.supportsEdges=!1,this._visible=!0,this._renderOccluded=1,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=n.Default3D,this.id=e._idGen.gen(t)}return e.prototype.dispose=function(){},e.prototype.update=function(e){return!1},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.parametersChanged())},enumerable:!1,configurable:!0}),e.prototype.isVisibleInPass=function(e){return!0},Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.parametersChanged())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"insertOrder",{get:function(){return this._insertOrder},set:function(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributeLocations",{get:function(){return this._vertexAttributeLocations},enumerable:!1,configurable:!0}),e.prototype.isVisible=function(){return this._visible},e.prototype.parametersChanged=function(){r.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)},e._idGen=new i.IdGen,e}();t.Material=a,t.materialPredicate=function(e,t){return e.isVisible()&&e.isVisibleInPass(t.pass)&&0!=(e.renderOccluded&t.renderOccludedMask)}}).apply(null,n))||(e.exports=i)},FQ4r:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderTechnique=void 0;var r=function(){function e(e,t){t&&(this._config=t.snapshot()),this._program=this.initializeProgram(e),e.commonUniformStore&&(this._commonUniformStore=e.commonUniformStore,this._commonUniformStore.subscribeProgram(this._program)),this._pipeline=this.initializePipeline(e)}return e.prototype.dispose=function(){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose(),this._program=null)},e.prototype.reload=function(e){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose()),this._program=this.initializeProgram(e),this._commonUniformStore&&this._commonUniformStore.subscribeProgram(this._program)},Object.defineProperty(e.prototype,"program",{get:function(){return this._program},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pipeline",{get:function(){return this._pipeline},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._config.key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"configuration",{get:function(){return this._config},enumerable:!1,configurable:!0}),e.prototype.bindPass=function(e,t,r){},e.prototype.bindMaterial=function(e,t,r){},e.prototype.bindDraw=function(e,t,r){},e.prototype.bindPipelineState=function(e){e.setPipelineState(this.pipeline)},e.prototype.ensureAttributeLocations=function(e){this.program.assertCompatibleVertexAttributeLocations(e)},Object.defineProperty(e.prototype,"primitiveType",{get:function(){return 4},enumerable:!1,configurable:!0}),e}();t.ShaderTechnique=r}).apply(null,n))||(e.exports=i)},GG08:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+"),r("0LE5"),r("Rdxj"),r("JjCO")],void 0===(i=(function(e,t,r,n,i,a){"use strict";function o(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function s(e,t){return void 0===t&&(t=o()),c(e[0],e[1],e[2],e[3],t)}function c(e,t,r,n,i){return void 0===i&&(i=o()),i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function l(e,t,r){void 0===r&&(r=o()),n.vec3.copy(r,t);var i=n.vec3.dot(t,t);return Math.abs(i-1)>1e-5&&i>1e-12&&n.vec3.scale(r,r,1/Math.sqrt(i)),b(r,e,r),r}function u(e,t,r,i){return void 0===i&&(i=o()),y(n.vec3.subtract(a.sv3d.get(),e,t),n.vec3.subtract(a.sv3d.get(),r,t),e,i)}function d(e,t,r,i,a){if(e.count<3)return!1;e.getVec(r,v);for(var o=i,s=!1;o<e.count-1&&!s;)e.getVec(o,p),o++,s=!n.vec3.exactEquals(v,p);if(!s)return!1;for(o=Math.max(o,a),s=!1;o<e.count&&!s;)e.getVec(o,h),o++,n.vec3.subtract(m,v,p),n.vec3.normalize(m,m),n.vec3.subtract(g,p,h),n.vec3.normalize(g,g),s=!n.vec3.exactEquals(v,h)&&!n.vec3.exactEquals(p,h)&&Math.abs(n.vec3.dot(m,g))<f;return s?(u(v,p,h,t),!0):(0!==r||1!==i||2!==a)&&d(e,t,0,1,2)}Object.defineProperty(t,"__esModule",{value:!0}),t.UP=t.normal=t.signedDistance=t.distance=t.projectVector=t.projectPoint=t.clipInfinite=t.clip=t.isAABBFullyInside=t.isPointOutside=t.isPointInside=t.isSphereFullyOutside=t.isSphereFullyInside=t.intersectLineSegmentClamp=t.intersectLineSegment=t.intersectRay=t.fromVectorsAndPoint=t.negate=t.setOffsetFromPoint=t.fromManyPointsSampleAt=t.fromManyPoints=t.fromPoints=t.fromPositionAndNormal=t.fromNormalAndOffset=t.fromValues=t.copy=t.wrap=t.create=void 0,t.create=o,t.wrap=function(e,t,r,n){return c(e,t,r,n,a.sv4d.get())},t.copy=s,t.fromValues=c,t.fromNormalAndOffset=function(e,t,r){return void 0===r&&(r=o()),n.vec3.copy(r,e),r[3]=t,r},t.fromPositionAndNormal=l,t.fromPoints=u,t.fromManyPoints=function(e,t){return d(e,t,0,1,2)},t.fromManyPointsSampleAt=d;var f=.99619469809,v=i.vec3f64.create(),p=i.vec3f64.create(),h=i.vec3f64.create(),m=i.vec3f64.create(),g=i.vec3f64.create();function b(e,t,r){return e!==r&&s(e,r),r[3]=-n.vec3.dot(r,t),r}function y(e,t,r,i){return void 0===i&&(i=o()),l(r,n.vec3.cross(a.sv3d.get(),t,e),i)}function x(e,t,r){var i=n.vec3.scale(a.sv3d.get(),e,n.vec3.dot(e,t));return n.vec3.subtract(r,t,i),r}function _(e,t){return n.vec3.dot(e,t)+e[3]}function S(e,t,i,a,o,s){var c=n.vec3.dot(e,i);if(0===c)return!1;var l=-(n.vec3.dot(e,t)+e[3])/c;return o&&(l=a?Math.max(0,l):r.clamp(l,0,1)),!(l<0||!a&&l>1||(n.vec3.add(s,t,n.vec3.scale(s,i,l)),0))}t.setOffsetFromPoint=b,t.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},t.fromVectorsAndPoint=y,t.intersectRay=function(e,t,r){return S(e,t.origin,t.direction,!0,!1,r)},t.intersectLineSegment=function(e,t,r){return S(e,t.origin,t.vector,!1,!1,r)},t.intersectLineSegmentClamp=function(e,t,r){return S(e,t.origin,t.vector,!1,!0,r)},t.isSphereFullyInside=function(e,t){var r=t.radius;return _(e,t.center)-r>=0},t.isSphereFullyOutside=function(e,t){var r=t.radius;return _(e,t.center)+r<0},t.isPointInside=function(e,t){return _(e,t)>=0},t.isPointOutside=function(e,t){return _(e,t)<0},t.isAABBFullyInside=function(e,t){return e[0]*(e[0]>0?t[0]:t[3])+e[1]*(e[1]>0?t[1]:t[4])+e[2]*(e[2]>0?t[2]:t[5])+e[3]>=0},t.clip=function(e,t){var r=n.vec3.dot(e,t.ray.direction),i=-_(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;var a=i/r;return r>0?a<t.c1&&(t.c1=a):a>t.c0&&(t.c0=a),t.c0<=t.c1},t.clipInfinite=function(e,t){var r=n.vec3.dot(e,t.ray.direction),i=-_(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;var a=i/r;return r>0?a<t.c1&&(t.c1=a):a>t.c0&&(t.c0=a),t.c0<=t.c1},t.projectPoint=function(e,t,r){var i=n.vec3.scale(a.sv3d.get(),e,-e[3]),o=x(e,n.vec3.subtract(a.sv3d.get(),t,i),a.sv3d.get());return n.vec3.add(r,o,i),r},t.projectVector=x,t.distance=function(e,t){return Math.abs(_(e,t))},t.signedDistance=_,t.normal=function(e){return e},t.UP=[0,0,1,0]}).apply(null,n))||(e.exports=i)},GyfB:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("0LE5"),r("JjCO"),r("18xY")],void 0===(i=(function(e,t,r,n,i){"use strict";function a(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function o(e,t,r,n,i){return void 0===i&&(i=a()),i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}Object.defineProperty(t,"__esModule",{value:!0}),t.UP=t.axis=t.fromPoints=t.fromAxisAndAngle=t.fromValues=t.copy=t.wrapAxisAngle=t.wrap=t.create=void 0,t.create=a,t.wrap=function(e,t,r,i){return o(e,t,r,i,n.sv4d.get())},t.wrapAxisAngle=function(e,t){return o(e[0],e[1],e[2],t,n.sv4d.get())},t.copy=function(e,t){return void 0===t&&(t=a()),o(e[0],e[1],e[2],e[3],t)},t.fromValues=o,t.fromAxisAndAngle=function(e,t,n){return void 0===n&&(n=a()),r.vec3.copy(n,e),n[3]=t,n},t.fromPoints=function(e,t,n){return void 0===n&&(n=a()),r.vec3.cross(n,e,t),r.vec3.normalize(n,n),n[3]=i.angle(e,t),n},t.axis=function(e){return e},t.UP=[0,0,1,0]}).apply(null,n))||(e.exports=i)},ILj8:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("VfPl"),r("CIy2")],void 0===(i=(function(e,t,r,n){"use strict";function i(e,t,r,n,i){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(n*=o,null==i||1===i)for(var c=0;c<s;++c){var l=2*e[c];a[n]=t[l],a[n+1]=t[l+1],n+=o}else for(c=0;c<s;++c){l=2*e[c];for(var u=0;u<i;++u)a[n]=t[l],a[n+1]=t[l+1],n+=o}}function a(e,t,r,n,i){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(n*=o,null==i||1===i)for(var c=0;c<s;++c){var l=3*e[c];a[n]=t[l],a[n+1]=t[l+1],a[n+2]=t[l+2],n+=o}else for(c=0;c<s;++c){l=3*e[c];for(var u=0;u<i;++u)a[n]=t[l],a[n+1]=t[l+1],a[n+2]=t[l+2],n+=o}}function o(e,t,r,n,i){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(n*=o,null==i||1===i)for(var c=0;c<s;++c){var l=4*e[c];a[n]=t[l],a[n+1]=t[l+1],a[n+2]=t[l+2],a[n+3]=t[l+3],n+=o}else for(c=0;c<s;++c){l=4*e[c];for(var u=0;u<i;++u)a[n]=t[l],a[n+1]=t[l+1],a[n+2]=t[l+2],a[n+3]=t[l+3],n+=o}}function s(e,t,r,n,i,o){if(r){var s=r,c=n.typedBuffer,l=n.typedBufferStride,u=e.length;if(i*=l,null==o||1===o)for(var d=0;d<u;++d){var f=t[h=3*e[d]],v=t[h+1],p=t[h+2];c[i]=s[0]*f+s[4]*v+s[8]*p+s[12],c[i+1]=s[1]*f+s[5]*v+s[9]*p+s[13],c[i+2]=s[2]*f+s[6]*v+s[10]*p+s[14],i+=l}else for(d=0;d<u;++d){f=t[h=3*e[d]];for(var h,m=s[0]*f+s[4]*(v=t[h+1])+s[8]*(p=t[h+2])+s[12],g=s[1]*f+s[5]*v+s[9]*p+s[13],b=s[2]*f+s[6]*v+s[10]*p+s[14],y=0;y<o;++y)c[i]=m,c[i+1]=g,c[i+2]=b,i+=l}}else a(e,t,n,i,o)}function c(e,t,r,n,i,o){if(r){var s=n.typedBuffer,c=n.typedBufferStride,l=e.length,u=r[0],d=r[1],f=r[2],v=r[4],p=r[5],h=r[6],m=r[8],g=r[9],b=r[10],y=Math.abs(1-u*u+v*v+m*m)>1e-5||Math.abs(1-d*d+p*p+g*g)>1e-5||Math.abs(1-f*f+h*h+b*b)>1e-5;if(i*=c,null==o||1===o)for(var x=0;x<l;++x){var _=u*(P=t[O=3*e[x]])+v*(M=t[O+1])+m*(T=t[O+2]),S=d*P+p*M+g*T,w=f*P+h*M+b*T;y&&(A=_*_+S*S+w*w)<.999999&&A>1e-6&&(_/=j=Math.sqrt(A),S/=j,w/=j),s[i+0]=_,s[i+1]=S,s[i+2]=w,i+=c}else for(x=0;x<l;++x){var O,P,M,T,A,j,I=u*(P=t[O=3*e[x]])+v*(M=t[O+1])+m*(T=t[O+2]),C=d*P+p*M+g*T,V=f*P+h*M+b*T;y&&(A=I*I+C*C+V*V)<.999999&&A>1e-6&&(I/=j=Math.sqrt(A),C/=j,V/=j);for(var z=0;z<o;++z)s[i+0]=I,s[i+1]=C,s[i+2]=V,i+=c}}else a(e,t,n,i,o)}function l(e,t,r,n,i,a){var o=n.typedBuffer,s=n.typedBufferStride,c=e.length;if(i*=s,null==a||1===a){if(4===r)for(var l=0;l<c;++l){var u=4*e[l];o[i]=t[u],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=t[u+3],i+=s}else if(3===r)for(l=0;l<c;++l)o[i]=t[u=3*e[l]],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=255,i+=s}else if(4===r)for(l=0;l<c;++l){u=4*e[l];for(var d=0;d<a;++d)o[i]=t[u],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=t[u+3],i+=s}else if(3===r)for(l=0;l<c;++l)for(u=3*e[l],d=0;d<a;++d)o[i]=t[u],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=255,i+=s}Object.defineProperty(t,"__esModule",{value:!0}),t.writeDefaultAttributes=t.writeMultipliedColor=t.writeColor=t.writeNormal=t.writePosition=t.writeBufferMat4f=t.writeBufferMat3f=t.writeBufferVec4=t.writeBufferVec3=t.writeBufferVec2=void 0,t.writeBufferVec2=i,t.writeBufferVec3=a,t.writeBufferVec4=o,t.writeBufferMat3f=function(e,t,r,n){var i=r.typedBuffer,a=r.typedBufferStride,o=e.length;n*=a;for(var s=0;s<o;++s){for(var c=9*e[s],l=0;l<9;++l)i[n+l]=t[c+l];n+=a}},t.writeBufferMat4f=function(e,t,r,n){var i=r.typedBuffer,a=r.typedBufferStride,o=e.length;n*=a;for(var s=0;s<o;++s){for(var c=16*e[s],l=0;l<16;++l)i[n+l]=t[c+l];n+=a}},t.writePosition=s,t.writeNormal=c,t.writeColor=l,t.writeMultipliedColor=function(e,t,r,n,i,a,o){var s=i.typedBuffer,c=i.typedBufferStride,l=e.length;if(a*=c,null==o||1===o){if(4===r)for(var u=0;u<l;++u){var d=4*e[u];s[a]=t[d]*n[0],s[a+1]=t[d+1]*n[1],s[a+2]=t[d+2]*n[2],s[a+3]=t[d+3]*n[3],a+=c}else if(3===r){var f=255*n[3];for(u=0;u<l;++u)s[a]=t[d=3*e[u]]*n[0],s[a+1]=t[d+1]*n[1],s[a+2]=t[d+2]*n[2],s[a+3]=f,a+=c}}else if(4===r)for(u=0;u<l;++u){d=4*e[u];for(var v=0;v<o;++v)s[a]=t[d]*n[0],s[a+1]=t[d+1]*n[1],s[a+2]=t[d+2]*n[2],s[a+3]=t[d+3]*n[3],a+=c}else if(3===r)for(f=255*n[3],u=0;u<l;++u)for(d=3*e[u],v=0;v<o;++v)s[a]=t[d]*n[0],s[a+1]=t[d+1]*n[1],s[a+2]=t[d+2]*n[2],s[a+3]=f,a+=c},t.writeDefaultAttributes=function(e,t,a,u,d,f){for(var v=0,p=t.fieldNames;v<p.length;v++){var h=p[v],m=e.vertexAttr[h],g=e.indices[h];if(m&&g)switch(h){case n.VertexAttrConstants.POSITION:n.assert(3===m.size);var b=d.getField(h,r.BufferViewVec3f);b&&s(g,m.data,a,b,f);break;case n.VertexAttrConstants.NORMAL:n.assert(3===m.size);var y=d.getField(h,r.BufferViewVec3f);y&&c(g,m.data,u,y,f);break;case n.VertexAttrConstants.UV0:n.assert(2===m.size);var x=d.getField(h,r.BufferViewVec2f);x&&i(g,m.data,x,f);break;case n.VertexAttrConstants.UVMAPSPACE:n.assert(4===m.size);var _=d.getField(h,r.BufferViewVec4f);_&&o(g,m.data,_,f);break;case n.VertexAttrConstants.MEANVERTEXPOSITION:n.assert(3===m.size);var S=d.getField(h,r.BufferViewVec3f);S&&s(g,m.data,a,S,f);break;case n.VertexAttrConstants.BOUND1:case n.VertexAttrConstants.BOUND2:case n.VertexAttrConstants.BOUND3:n.assert(3===m.size);var w=d.getField(h,r.BufferViewVec3f);w&&s(g,m.data,a,w,f);break;case n.VertexAttrConstants.COLOR:n.assert(3===m.size||4===m.size);var O=d.getField(h,r.BufferViewVec4u8);O&&l(g,m.data,m.size,O,f);break;case n.VertexAttrConstants.SYMBOLCOLOR:n.assert(3===m.size||4===m.size);var P=d.getField(h,r.BufferViewVec4u8);P&&l(g,m.data,m.size,P,f);break;case n.VertexAttrConstants.TANGENT:n.assert(4===m.size);var M=d.getField(h,r.BufferViewVec4f);M&&o(g,m.data,M,f)}}}}).apply(null,n))||(e.exports=i)},IwVr:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.DiscardOrAdjustAlpha=t.symbolAlphaCutoff=t.defaultMaskAlphaCutoff=void 0,t.defaultMaskAlphaCutoff=.1,t.symbolAlphaCutoff=.001,t.DiscardOrAdjustAlpha=function(e,t){var c=e.fragment;switch(t.alphaDiscardMode){case 0:c.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "]))));break;case 1:c.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a = 1.0;\n        }\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a = 1.0;\n        }\n      "]))));break;case 2:c.uniforms.add("textureAlphaCutoff","float"),c.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }\n      "]))));break;case 3:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }\n      "]))))}}}).apply(null,n))||(e.exports=i)},JjCO:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("wSO/")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sq4d=t.sm4d=t.sm3d=t.sv4d=t.sv3d=t.sv2d=void 0,t.sv2d=r.VectorStack.createVec2f64(),t.sv3d=r.VectorStack.createVec3f64(),t.sv4d=r.VectorStack.createVec4f64(),t.sm3d=r.VectorStack.createMat3f64(),t.sm4d=r.VectorStack.createMat4f64(),t.sq4d=r.VectorStack.createQuatf64()}).apply(null,n))||(e.exports=i)},KRuQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autoDispose=t.AutoDisposable=t.AutoDisposableMixin=void 0,t.AutoDisposableMixin=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isDisposed=!1,t}return r.__extends(t,e),t.prototype.dispose=function(){for(var e,t=0,r=null!==(e=this._managedDisposables)&&void 0!==e?e:[];t<r.length;t++){var n=r[t],i=this[n];this[n]=null,i&&"function"==typeof i.dispose&&i.dispose()}this._isDisposed=!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),t}(e)};var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(t.AutoDisposableMixin((function(){})));t.AutoDisposable=n,t.autoDispose=function(){return function(e,t){var r,n;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!==(n=null===(r=e._managedDisposables)||void 0===r?void 0:r.slice())&&void 0!==n?n:[]),e._managedDisposables.unshift(t)}}}).apply(null,n))||(e.exports=i)},N5NQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+"),r("PHan"),r("0LE5"),r("Rdxj"),r("JjCO")],void 0===(i=(function(e,t,r,n,i,a,o){"use strict";function s(e){return e?{origin:a.vec3f64.clone(e.origin),vector:a.vec3f64.clone(e.vector)}:{origin:a.vec3f64.create(),vector:a.vec3f64.create()}}function c(e,t){var r=p.get();return r.origin=e,r.vector=t,r}function l(e,t,r){return void 0===r&&(r=s()),i.vec3.copy(r.origin,e),i.vec3.copy(r.vector,t),r}function u(e,t){var n=i.vec3.subtract(o.sv3d.get(),t,e.origin),a=i.vec3.dot(e.vector,n),s=i.vec3.dot(e.vector,e.vector),c=r.clamp(a/s,0,1),l=i.vec3.subtract(o.sv3d.get(),i.vec3.scale(o.sv3d.get(),e.vector,c),n);return i.vec3.dot(l,l)}function d(e,t,n,a,s){var c=e.vector,l=e.origin,u=i.vec3.subtract(o.sv3d.get(),t,l),d=i.vec3.length(c),f=i.vec3.dot(c,u)/d;return i.vec3.scale(s,c,r.clamp(f,n,a)),i.vec3.add(s,s,e.origin)}function f(e,t,n,a){var s=e.origin,c=i.vec3.add(o.sv3d.get(),s,e.vector),l=t.origin,u=i.vec3.add(o.sv3d.get(),l,t.vector),d=o.sv3d.get(),f=o.sv3d.get();if(d[0]=s[0]-l[0],d[1]=s[1]-l[1],d[2]=s[2]-l[2],f[0]=u[0]-l[0],f[1]=u[1]-l[1],f[2]=u[2]-l[2],Math.abs(f[0])<1e-6&&Math.abs(f[1])<1e-6&&Math.abs(f[2])<1e-6)return!1;var v=o.sv3d.get();if(v[0]=c[0]-s[0],v[1]=c[1]-s[1],v[2]=c[2]-s[2],Math.abs(v[0])<1e-6&&Math.abs(v[1])<1e-6&&Math.abs(v[2])<1e-6)return!1;var p=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],h=f[0]*v[0]+f[1]*v[1]+f[2]*v[2],m=d[0]*v[0]+d[1]*v[1]+d[2]*v[2],g=f[0]*f[0]+f[1]*f[1]+f[2]*f[2],b=(v[0]*v[0]+v[1]*v[1]+v[2]*v[2])*g-h*h;if(Math.abs(b)<1e-6)return!1;var y=(p*h-m*g)/b,x=(p+h*y)/g;n&&(y=r.clamp(y,0,1),x=r.clamp(x,0,1));var _=o.sv3d.get(),S=o.sv3d.get();return _[0]=s[0]+y*v[0],_[1]=s[1]+y*v[1],_[2]=s[2]+y*v[2],S[0]=l[0]+x*f[0],S[1]=l[1]+x*f[1],S[2]=l[2]+x*f[2],a.tA=y,a.tB=x,a.pA=_,a.pB=S,a.distance2=i.vec3.squaredDistance(_,S),!0}Object.defineProperty(t,"__esModule",{value:!0}),t.closestLineSegmentDistance2=t.closestLineSegmentPoint=t.closestRayDistance2=t.projectPointClamp=t.pointAt=t.projectPoint=t.distance=t.distance2=t.fromPoints=t.fromValues=t.copy=t.wrap=t.create=void 0,t.create=s,t.wrap=c,t.copy=function(e,t){return void 0===t&&(t=s()),l(e.origin,e.vector,t)},t.fromValues=l,t.fromPoints=function(e,t,r){return void 0===r&&(r=s()),i.vec3.copy(r.origin,e),i.vec3.subtract(r.vector,t,e),r},t.distance2=u,t.distance=function(e,t){return Math.sqrt(u(e,t))},t.projectPoint=function(e,t,r){return d(e,t,0,1,r)},t.pointAt=function(e,t,r){return i.vec3.add(r,e.origin,i.vec3.scale(r,e.vector,t))},t.projectPointClamp=d,t.closestRayDistance2=function(e,t){if(f(e,c(t.origin,t.direction),!1,v)){var r=v.tA,n=v.pB;if(r>=0&&r<=1)return v.distance2;if(r<0)return i.vec3.squaredDistance(e.origin,n);if(r>1)return i.vec3.squaredDistance(i.vec3.add(o.sv3d.get(),e.origin,e.vector),n)}return null},t.closestLineSegmentPoint=function(e,t,r){return!!f(e,t,!0,v)&&(i.vec3.copy(r,v.pA),!0)},t.closestLineSegmentDistance2=function(e,t){return f(e,t,!0,v)?v.distance2:null};var v={tA:0,tB:0,pA:a.vec3f64.create(),pB:a.vec3f64.create(),distance2:0},p=new n.ObjectStack((function(){return{origin:null,vector:null}}))}).apply(null,n))||(e.exports=i)},PHan:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("6DRN")],void 0===(i=(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectStack=void 0;var i=function(){function e(e){var t=this;this.allocator=e,this.items=[],this.itemsPtr=0,this.tickHandle=n.before((function(){return t.reset()})),this.grow()}return e.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=r.nullifyNonnullableForDispose(this.tickHandle)),this.items=r.nullifyNonnullableForDispose(this.items)},e.prototype.get=function(){return 0===this.itemsPtr&&n((function(){})),this.itemsPtr===this.items.length&&this.grow(),this.items[this.itemsPtr++]},e.prototype.reset=function(){var e=Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*a);this.items.length=Math.min(e,this.items.length),this.itemsPtr=0},e.prototype.grow=function(){for(var e=0;e<Math.max(8,Math.min(this.items.length,a));e++)this.items.push(this.allocator())},e}();t.ObjectStack=i;var a=1024;t.default=i}).apply(null,n))||(e.exports=i)},PaEL:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";function i(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n    void outputHighlight() {\n      vec4 fragCoord = gl_FragCoord;\n\n      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z > sceneDepth + 5e-7) {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "],["\n    void outputHighlight() {\n      vec4 fragCoord = gl_FragCoord;\n\n      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z > sceneDepth + 5e-7) {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "]))))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.OutputHighlight=void 0,t.OutputHighlight=i,function(e){e.bindOutputHighlight=function(e,t,r){e.bindTexture(r.highlightDepthTexture,5),t.setUniform1i("depthTex",5),t.setUniform4f("highlightViewportPixelSz",0,0,r.inverseViewport[0],r.inverseViewport[1])}}(i=t.OutputHighlight||(t.OutputHighlight={}))}).apply(null,n))||(e.exports=i)},"PwS/":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("LxLY"),r("FXVB"),r("1m5D"),r("1f+t"),r("CIy2")],void 0===(i=(function(e,t,r,n,i,a,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDoubleVec3=t.calculateTransformRelToOrigin=t.releaseMaterials=t.acquireMaterials=t.isInstanceHidden=t.removeObject3DStateID=t.addObject3DStateID=void 0,t.addObject3DStateID=function(e,t){return r.isNone(e)&&(e=[]),e.push(t),e},t.removeObject3DStateID=function(e,t){if(r.isNone(e))return e;var n=e.filter((function(e){return e!==t}));return 0===n.length?null:n},t.isInstanceHidden=function(e){return!!n.isSome(e)&&!e.visible},t.acquireMaterials=function(e,t){var r=new Map;return r.set(0,t.acquire(e,0)),r.set(3,t.acquire(e,3)),r.set(2,t.acquire(e,2)),r.set(1,t.acquire(e,1)),r.set(4,t.acquire(e,4)),r},t.releaseMaterials=function(e,t){t.release(e,0),t.release(e,3),t.release(e,2),t.release(e,1),t.release(e,4)},t.calculateTransformRelToOrigin=function(e,t,r){var a=e.origin.vec3;s.setMatrixTranslation3(u,-a[0],-a[1],-a[2]),n.isSome(e.transformation)?i.mat4.multiply(t,u,e.transformation):i.mat4.copy(t,u),r&&(i.mat4.invert(r,t),i.mat4.transpose(r,r))},t.encodeDoubleVec3=function(e,t,r,n,i){c[0]=e.get(t,0),c[1]=e.get(t,1),c[2]=e.get(t,2),o.encodeDoubleArray(c,l,3),r.set(i,0,l[0]),n.set(i,0,l[1]),r.set(i,1,l[2]),n.set(i,1,l[3]),r.set(i,2,l[4]),n.set(i,2,l[5])};var c=new Float64Array(3),l=new Float32Array(6),u=a.mat4f64.create()}).apply(null,n))||(e.exports=i)},"W/V4":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReloadableShaderModule=void 0;var n=function(){function e(e,t){this._module=e,this._loadModule=t}return e.prototype.get=function(){return this._module},e.prototype.reload=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return e=this,[4,this._loadModule()];case 1:return e._module=t.sent(),[2,this._module]}}))}))},e}();t.ReloadableShaderModule=n}).apply(null,n))||(e.exports=i)},W0kZ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdGen=void 0;var r=function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}();t.IdGen=r}).apply(null,n))||(e.exports=i)},ZJC8:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("LxLY"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("AzkI"),r("Cvn+"),r("W0kZ"),r("62Ht"),r("CIy2"),r("PwS/")],void 0===(i=(function(e,t,r,n,i,a,o,s,c,l,u,d,f,v){"use strict";var p=function(){function e(t){void 0===t&&(t={}),this._objectTransformation=a.mat4f64.create(),this._bvObjectSpace=new m,this._bvWorldSpace=new m,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.id=e._idGen.gen(t.idHint),this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new h),this.objectTransformation=a.mat4f64.create(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations,t.origins)}return Object.defineProperty(e.prototype,"geometryRecords",{get:function(){return this._geometryRecords},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"geometries",{get:function(){return this._geometries},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(e){i.mat4.copy(this._objectTransformation,e),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){for(var e=0,t=this._geometryRecords;e<t.length;e++)l.pool.release(t[e]);this._geometryRecords=null,this._geometries=null},e.prototype._initializeGeometryRecords=function(e,t,r,n){if(!Array.isArray(e))return this._geometryRecords=[],void(this._geometries=[]);f.assert(t.length===e.length,"Object3D: materials don't match geometries"),f.assert(r.length===e.length,"Object3D: transformations don't match geometries"),this._geometryRecords=new Array(e.length),this._geometries=e.slice();for(var i=0;i<e.length;i++)this._geometryRecords[i]=l.pool.acquire(e[i],t[i],a.mat4f64.clone(r[i]),{highlights:null,occludees:null,visible:!0},n&&n[i]);this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){f.assert(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!1,configurable:!0}),e.prototype.getNumGeometryRecords=function(){return this._geometryRecords.length},e.prototype.getGeometryRecord=function(e){return f.assert(e>=0&&e<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this._geometryRecords[e]},e.prototype.addGeometry=function(e,t,r,n,i,o){r=r||a.mat4f64.IDENTITY,this._geometries.push(e);var s=l.pool.acquire(e,t,r,n||{highlights:null,occludees:null,visible:!0},i,o);return this._geometryRecords.push(s),this._hasVolatileTransformation=this._geometryRecords.some((function(e){return!!e.shaderTransformation})),this._notifyDirty("objGeometryAdded",s),this._invalidateBoundingVolume(),s},e.prototype.removeGeometry=function(e){var t=this._geometryRecords.splice(e,1)[0];return l.pool.release(t),this._hasVolatileTransformation=this._geometryRecords.some((function(e){return!!e.shaderTransformation})),this._geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this._geometryRecords[e]),this._invalidateBoundingVolume()},Object.defineProperty(e.prototype,"isVisible",{get:function(){return this._visible},enumerable:!1,configurable:!0}),e.prototype.setVisible=function(e){this._visible=e;for(var t=0,r=this._geometryRecords;t<r.length;t++)r[t].instanceParameters.visible=this._visible;this._notifyDirty("visibilityChanged")},e.prototype.occlude=function(){for(var e=d.generateObject3DStateId(1),t=0,r=this._geometryRecords;t<r.length;t++){var n=r[t];n.instanceParameters.occludees=v.addObject3DStateID(n.instanceParameters.occludees,e)}return this._notifyDirty("occlusionChanged"),e},e.prototype.removeOcclude=function(e){for(var t=0,r=this._geometryRecords;t<r.length;t++){var n=r[t];n.instanceParameters.occludees=v.removeObject3DStateID(n.instanceParameters.occludees,e)}this._notifyDirty("occlusionChanged")},e.prototype.highlight=function(){for(var e=d.generateObject3DStateId(0),t=0,r=this._geometryRecords;t<r.length;t++){var n=r[t];n.instanceParameters.highlights=v.addObject3DStateID(n.instanceParameters.highlights,e)}return this._notifyDirty("highlightChanged"),e},e.prototype.removeHighlight=function(e){for(var t=0,r=this._geometryRecords;t<r.length;t++){var n=r[t];n.instanceParameters.highlights=v.removeObject3DStateID(n.instanceParameters.highlights,e)}this._notifyDirty("highlightChanged")},e.prototype.getCombinedStaticTransformation=function(e,t){return i.mat4.multiply(n.unwrapOr(t,a.mat4f64.create()),this.objectTransformation,e.getStaticTransformation())},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||a.mat4f64.create(),i.mat4.multiply(t,this.objectTransformation,e.getShaderTransformation()),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this._geometryRecords.length;++e){var t=this._geometries[e],r=this._geometryRecords[e],n=t.boundingInfo;this._calculateTransformedBoundingVolume(n,this._bvObjectSpace,r.getShaderTransformation()),this._calculateTransformedBoundingVolume(n,this._bvWorldSpace,this.getCombinedShaderTransformation(r))}o.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5),o.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);var i=s.vec3f64.create(),a=s.vec3f64.create(),l=c.maxScale(this.objectTransformation);for(e=0;e<this._geometryRecords.length;++e){t=this._geometries[e];var u=this._geometryRecords[e].getShaderTransformation(),d=c.maxScale(u);o.vec3.transformMat4(i,(n=t.boundingInfo).getCenter(),u);var f=o.vec3.distance(i,this._bvObjectSpace.center),v=n.getBSRadius()*d;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,f+v),o.vec3.transformMat4(a,i,this.objectTransformation);var p=o.vec3.distance(a,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,p+v*l)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,r){var n=e.getBBMin(),i=e.getBBMax(),a=s.vec3f64.clone(n),c=s.vec3f64.clone(i);o.vec3.transformMat4(a,a,r),o.vec3.transformMat4(c,c,r);for(var l=0;l<3;++l)t.bbMin[l]=Math.min(t.bbMin[l],a[l],c[l]),t.bbMax[l]=Math.max(t.bbMax[l],a[l],c[l]);for(l=0;l<3;++l){o.vec3.copy(a,n),o.vec3.copy(c,i),a[l]=i[l],c[l]=n[l],o.vec3.transformMat4(a,a,r),o.vec3.transformMat4(c,c,r);for(var u=0;u<3;++u)t.bbMin[u]=Math.min(t.bbMin[u],a[u],c[u]),t.bbMax[u]=Math.max(t.bbMax[u],a[u],c[u])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,r,n){this._parentLayer&&this._parentLayer.notifyDirty(e,t,r=r||1,n||this)},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{hasGeometry:function(t){return e._geometries.indexOf(t)>-1},getGeometryIndex:function(t){return e._geometries.indexOf(t)}}},enumerable:!1,configurable:!0}),e._idGen=new u.IdGen,e}(),h=function(){function e(){this.bbMin=s.vec3f64.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.bbMax=s.vec3f64.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return e.prototype.isEmpty=function(){return this.bbMax[0]<this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<this.bbMin[2]},e}(),m=function(e){function t(){var t=e.call(this)||this;return t.center=s.vec3f64.create(),t.bsRadius=0,t}return r.__extends(t,e),t.prototype.init=function(){o.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o.vec3.set(this.center,0,0,0),this.bsRadius=0},t.prototype.getCenter=function(){return this.center},t.prototype.getBSRadius=function(){return this.bsRadius},t}(h);return p}).apply(null,n))||(e.exports=i)},ZjcA:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("PHan"),r("W9tT"),r("0LE5"),r("Rdxj"),r("JjCO"),r("N5NQ")],void 0===(i=(function(e,t,r,n,i,a,o,s){"use strict";function c(e){return e?{p0:a.vec3f64.clone(e.p0),p1:a.vec3f64.clone(e.p1),p2:a.vec3f64.clone(e.p2)}:{p0:a.vec3f64.create(),p1:a.vec3f64.create(),p2:a.vec3f64.create()}}function l(e,t,r,n){return void 0===n&&(n=c()),i.vec3.copy(n.p0,e),i.vec3.copy(n.p1,t),i.vec3.copy(n.p2,r),n}function u(e,t,r){var i=n.vec2.distance(e,t),a=n.vec2.distance(t,r),o=n.vec2.distance(r,e),s=(i+a+o)/2,c=s*(s-i)*(s-a)*(s-o);return c<=0?0:Math.sqrt(c)}Object.defineProperty(t,"__esModule",{value:!0}),t.areaPoints3d=t.area2d=t.areaPoints2d=t.intersectRay=t.distance2=t.fromValues=t.copy=t.wrap=t.create=void 0,t.create=c,t.wrap=function(e,t,r){var n=f.get();return n.p0=e,n.p1=t,n.p2=r,n},t.copy=function(e,t){return void 0===t&&(t=c()),l(e.p0,e.p1,e.p2,t)},t.fromValues=l,t.distance2=function(e,t){var r=e.p0,n=e.p1,a=e.p2,c=i.vec3.subtract(o.sv3d.get(),n,r),l=i.vec3.subtract(o.sv3d.get(),a,n),u=i.vec3.subtract(o.sv3d.get(),r,a),f=i.vec3.subtract(o.sv3d.get(),t,r),v=i.vec3.subtract(o.sv3d.get(),t,n),p=i.vec3.subtract(o.sv3d.get(),t,a),h=i.vec3.cross(c,c,u),m=i.vec3.dot(i.vec3.cross(o.sv3d.get(),c,h),f),g=i.vec3.dot(i.vec3.cross(o.sv3d.get(),l,h),v),b=i.vec3.dot(i.vec3.cross(o.sv3d.get(),u,h),p);if(m>0&&g>0&&b>0){var y=i.vec3.dot(h,f);return y*y/i.vec3.dot(h,h)}var x=s.distance2(s.fromValues(r,c,d.get()),t),_=s.distance2(s.fromValues(n,l,d.get()),t),S=s.distance2(s.fromValues(a,u,d.get()),t);return Math.min(x,_,S)},t.intersectRay=function(e,t,r){var n=t.direction,a=t.origin,o=e.p0,s=e.p1,c=e.p2,l=s[0]-o[0],u=s[1]-o[1],d=s[2]-o[2],f=c[0]-o[0],v=c[1]-o[1],p=c[2]-o[2],h=n[1]*p-v*n[2],m=n[2]*f-p*n[0],g=n[0]*v-f*n[1],b=l*h+u*m+d*g;if(b>-1e-5&&b<1e-5)return!1;var y=1/b,x=a[0]-o[0],_=a[1]-o[1],S=a[2]-o[2],w=y*(x*h+_*m+S*g);if(w<0||w>1)return!1;var O=_*d-u*S,P=S*l-d*x,M=x*u-l*_,T=y*(n[0]*O+n[1]*P+n[2]*M);return!(T<0||w+T>1||(r&&(i.vec3.scale(r,n,y*(f*O+v*P+p*M)),i.vec3.add(r,a,r)),0))},t.areaPoints2d=u,t.area2d=function(e){return u(e.p0,e.p1,e.p2)},t.areaPoints3d=function(e,t,r){return i.vec3.subtract(v,t,e),i.vec3.subtract(p,r,e),i.vec3.length(i.vec3.cross(v,v,p))/2};var d=new r.ObjectStack(s.create),f=new r.ObjectStack((function(){return{p0:null,p1:null,p2:null}})),v=a.vec3f64.create(),p=a.vec3f64.create()}).apply(null,n))||(e.exports=i)},aExC:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("qsST"),r("R2Zq"),r("ULaq")],void 0===(i=(function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.Code=t.ShaderBuilder=t.Includes=void 0;var o=n.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder"),s=function(){function e(){this.includedModules=new Map}return e.prototype.include=function(e,t){this.includedModules.has(e)?this.includedModules.get(e)!==t&&o.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(e,t),e(this.builder,t))},e}();t.Includes=s;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vertex=new d,t.fragment=new d,t.attributes=new f,t.varyings=new v,t.extensions=new p,t.defines=new h,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"builder",{get:function(){return this},enumerable:!1,configurable:!0}),t.prototype.generateSource=function(e){var t=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(),i="vertex"===e?this.vertex:this.fragment,a=i.uniforms.generateSource(),o=i.code.generateSource(),s="vertex"===e?g:m,c=this.defines.generateSource().concat(i.defines.generateSource());return"\n"+t.join("\n")+"\n\n"+c.join("\n")+"\n\n"+s+"\n\n"+a.join("\n")+"\n\n"+r.join("\n")+"\n\n"+n.join("\n")+"\n\n"+o.join("\n")},t}(s);t.ShaderBuilder=c;var l=function(){function e(){this._entries=new Array,this._set=new Set}return e.prototype.add=function(e,t,r){var n=e+"_"+t+"_"+r;return this._set.has(n)||(this._entries.push([e,t,r]),this._set.add(n)),this},e.prototype.generateSource=function(){return this._entries.map((function(e){return"uniform "+e[1]+" "+e[0]+((t=e[2])?"["+t+"]":"")+";";var t}))},e}(),u=function(){function e(){this._entries=new Array}return e.prototype.add=function(e){this._entries.push(e)},e.prototype.generateSource=function(){return this._entries},e}();t.Code=u;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uniforms=new l,t.code=new u,t.defines=new h,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"builder",{get:function(){return this},enumerable:!1,configurable:!0}),t}(s);t.Stage=d;var f=function(){function e(){this._entries=new Array}return e.prototype.add=function(e,t){this._entries.push([e,t])},e.prototype.generateSource=function(e){return"fragment"===e?[]:this._entries.map((function(e){return"attribute "+e[1]+" "+e[0]+";"}))},e}(),v=function(){function e(){this._entries=new Array}return e.prototype.add=function(e,t){this._entries.push([e,t])},e.prototype.generateSource=function(){return this._entries.map((function(e){return"varying "+e[1]+" "+e[0]+";"}))},e}(),p=function(){function e(){this._entries=new Set}return e.prototype.add=function(e){this._entries.add(e)},e.prototype.generateSource=function(t){var r="vertex"===t?e.ALLOWLIST_VERTEX:e.ALLOWLIST_FRAGMENT;return a.valuesOfSet(this._entries).filter((function(e){return r.indexOf(e)>=0})).map((function(e){return"#extension "+e+" : enable"}))},e.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],e.ALLOWLIST_VERTEX=[],e}(),h=function(){function e(){this._entries=new Map}return e.prototype.addInt=function(e,t){var r=t%1==0?t.toFixed(0):t.toString();this._entries.set(e,r)},e.prototype.addFloat=function(e,t){var r=t%1==0?t.toFixed(1):t.toString();this._entries.set(e,r)},e.prototype.generateSource=function(){return i.pairsOfMap(this._entries).map((function(e){return"#define "+e[0]+" "+e[1]}))},e}(),m="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",g="precision highp float;\nprecision highp sampler2D;"}).apply(null,n))||(e.exports=i)},aWgr:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("GyfB"),r("2eYJ"),r("fXZm"),r("cpxo"),r("N5NQ"),r("GG08"),r("4p4v"),r("/dtL"),r("ZjcA"),r("18xY")],void 0===(i=(function(e,t,r,n,i,a,o,s,c,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.axisAngle=t.vector=t.frustum=t.sphere=t.clipRay=t.ray=t.lineSegment=t.triangle=t.boundedPlane=t.plane=void 0,t.plane=s,t.boundedPlane=n,t.triangle=u,t.lineSegment=o,t.ray=c,t.clipRay=i,t.sphere=l,t.frustum=a,t.vector=d,t.axisAngle=r}).apply(null,n))||(e.exports=i)},cj3m:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("DKwL"),r("7Aei")],void 0===(i=(function(e,t,r,n,i){"use strict";function a(e){e.fragment.include(n.RgbaFloatEncoding),e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("shadowMapNum","int"),e.fragment.uniforms.add("shadowMapDistance","vec4"),e.fragment.uniforms.add("shadowMapMatrix","mat4",4),e.fragment.uniforms.add("depthHalfPixelSz","float"),e.fragment.code.add(i.glsl(o||(o=r.__makeTemplateObject(["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize = depthHalfPixelSz;\n      vec4 distance = shadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      if (i >= shadowMapNum) { return 0.0; }\n\n      mat4 mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n\n      // vertex completely outside? -> no shadow\n      vec3 lvpos = 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "],["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize = depthHalfPixelSz;\n      vec4 distance = shadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      if (i >= shadowMapNum) { return 0.0; }\n\n      mat4 mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n\n      // vertex completely outside? -> no shadow\n      vec3 lvpos = 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "]))))}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ReadShadowMap=void 0,t.ReadShadowMap=a,function(e){e.bindUniforms=function(e,t,r){t.shadowMappingEnabled&&(t.shadowMap.bind(e,r),t.shadowMap.bindView(e,t.origin))},e.bindViewCustomOrigin=function(e,t,r){t.shadowMappingEnabled&&t.shadowMap.bindView(e,r)},e.bindView=function(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}}(a=t.ReadShadowMap||(t.ReadShadowMap={}))}).apply(null,n))||(e.exports=i)},cmSR:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i,a,o;Object.defineProperty(t,"__esModule",{value:!0}),t.ForwardLinearDepth=void 0,t.ForwardLinearDepth=function(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "],["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "]))))):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("uCameraNearFar","vec2"),e.vertex.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "],["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "]))))):e.vertex.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      void forwardLinearDepth() {}\n    "],["\n      void forwardLinearDepth() {}\n    "]))))}}).apply(null,n))||(e.exports=i)},cpxo:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("PHan"),r("FXVB"),r("0LE5"),r("Rdxj"),r("2fXB"),r("O7NG"),r("JjCO"),r("fXZm"),r("GG08")],void 0===(i=(function(e,t,r,n,i,a,o,s,c,l,u){"use strict";function d(e){if(e){var t=e.planes,r=e.points;return{planes:[u.create(t[0]),u.create(t[1]),u.create(t[2]),u.create(t[3]),u.create(t[4]),u.create(t[5])],points:[a.vec3f64.clone(r[0]),a.vec3f64.clone(r[1]),a.vec3f64.clone(r[2]),a.vec3f64.clone(r[3]),a.vec3f64.clone(r[4]),a.vec3f64.clone(r[5]),a.vec3f64.clone(r[6]),a.vec3f64.clone(r[7])]}}return{planes:[u.create(),u.create(),u.create(),u.create(),u.create(),u.create()],points:[a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create()]}}function f(e,t,r){void 0===r&&(r=d());for(var n=0;n<6;n++)u.copy(e[n],r.planes[n]);for(n=0;n<8;n++)i.vec3.copy(r.points[n],t[n]);return r}function v(e){var t=e.planes,r=e.points;u.fromPoints(r[4],r[0],r[3],t[0]),u.fromPoints(r[1],r[5],r[6],t[1]),u.fromPoints(r[4],r[5],r[1],t[2]),u.fromPoints(r[3],r[2],r[6],t[3]),u.fromPoints(r[0],r[1],r[2],t[4]),u.fromPoints(r[5],r[4],r[7],t[5])}function p(e,t){for(var r=0;r<6;r++)if(!u.clip(e[r],t))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.planePointIndices=t.intersectsAABB=t.intersectsPoint=t.intersectsLineSegment=t.intersectClipRay=t.intersectsRay=t.intersectsSphere=t.recomputePlanes=t.fromMatrix=t.fromValues=t.copy=t.create=void 0,t.create=d,t.copy=function(e,t){return void 0===t&&(t=d()),f(e.planes,e.points,t)},t.fromValues=f,t.fromMatrix=function(e,t,r){void 0===r&&(r=d());var a=r.points,s=n.mat4.multiply(c.sm4d.get(),t,e);n.mat4.invert(s,s);for(var l=0;l<8;++l){var u=o.vec4.transformMat4(c.sv4d.get(),h[l],s);i.vec3.set(a[l],u[0]/u[3],u[1]/u[3],u[2]/u[3])}return v(r),r},t.recomputePlanes=v,t.intersectsSphere=function(e,t){for(var r=0;r<6;r++)if(u.isSphereFullyInside(e[r],t))return!1;return!0},t.intersectsRay=function(e,t){return p(e,l.fromRay(t,m.get()))},t.intersectClipRay=function(e,t){for(var r=0;r<6;r++)if(!u.clipInfinite(e[r],t))return!1;return!0},t.intersectsLineSegment=function(e,t,r){return p(e,l.fromLineSegmentAndDirection(t,r,m.get()))},t.intersectsPoint=function(e,t){for(var r=0;r<6;r++)if(u.signedDistance(e[r],t)>0)return!1;return!0},t.intersectsAABB=function(e,t){for(var r=0;r<6;r++)if(u.isAABBFullyInside(e[r],t))return!1;return!0},t.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};var h=[s.vec4f64.fromValues(-1,-1,-1,1),s.vec4f64.fromValues(1,-1,-1,1),s.vec4f64.fromValues(1,1,-1,1),s.vec4f64.fromValues(-1,1,-1,1),s.vec4f64.fromValues(-1,-1,1,1),s.vec4f64.fromValues(1,-1,1,1),s.vec4f64.fromValues(1,1,1,1),s.vec4f64.fromValues(-1,1,1,1)],m=new r.ObjectStack(l.create)}).apply(null,n))||(e.exports=i)},fXZm:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("PHan"),r("0LE5"),r("JjCO"),r("4p4v")],void 0===(i=(function(e,t,r,n,i,a){"use strict";function o(e){return e?{ray:a.create(e.ray),c0:e.c0,c1:e.c1}:{ray:a.create(),c0:0,c1:Number.MAX_VALUE}}function s(e,t,r,n){return void 0===n&&(n=o()),a.copy(e,n.ray),n.c0=t,n.c1=r,n}function c(e,t,r){void 0===r&&(r=o());var i=n.vec3.length(e.vector);return a.fromValues(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function l(e,t,r){return n.vec3.add(r,e.ray.origin,n.vec3.scale(r,e.ray.direction,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.getAt=t.getEnd=t.getStart=t.fromLineSegmentAndDirection=t.fromLineSegment=t.fromRay=t.fromValues=t.copy=t.wrap=t.create=void 0,t.create=o,t.wrap=function(e,t,r){var n=u.get();return n.ray=e,n.c0=t,n.c1=r,n},t.copy=function(e,t){return void 0===t&&(t=o()),s(e.ray,e.c0,e.c1,t)},t.fromValues=s,t.fromRay=function(e,t){return void 0===t&&(t=o()),a.copy(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t},t.fromLineSegment=function(e,t){return void 0===t&&(t=o()),c(e,n.vec3.normalize(i.sv3d.get(),e.vector),t)},t.fromLineSegmentAndDirection=c,t.getStart=function(e,t){return l(e,e.c0,t)},t.getEnd=function(e,t){return l(e,e.c1,t)},t.getAt=l;var u=new r.ObjectStack((function(){return{c0:0,c1:0,ray:null}}))}).apply(null,n))||(e.exports=i)},fese:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("LxLY"),r("0LE5"),r("Rdxj"),r("7Aei")],void 0===(i=(function(e,t,r,n,i,a,o){"use strict";function s(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");var n=o.glsl(c||(c=r.__makeTemplateObject(["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel = pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot = dot(slicePlaneBasis1, rel);\n        float basis2Dot = dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front < 0.0\n          && factors.side0 < 0.0\n          && factors.side1 < 0.0\n          && factors.side2 < 0.0\n          && factors.side3 < 0.0;\n      }\n\n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "],["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel = pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot = dot(slicePlaneBasis1, rel);\n        float basis2Dot = dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front < 0.0\n          && factors.side0 < 0.0\n          && factors.side1 < 0.0\n          && factors.side2 < 0.0\n          && factors.side3 < 0.0;\n      }\n\n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "]))),i=o.glsl(l||(l=r.__makeTemplateObject(["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors = calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH = 1.0;\n        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor = (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "],["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors = calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH = 1.0;\n        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor = (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "]))),a=t.sliceHighlightDisabled?o.glsl(u||(u=r.__makeTemplateObject(["#define highlightSlice(_color_, _pos_) (_color_)"],["#define highlightSlice(_color_, _pos_) (_color_)"]))):o.glsl(d||(d=r.__makeTemplateObject(["\n        ","\n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "],["\n        ","\n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "])),i);t.sliceEnabledForVertexPrograms&&e.vertex.code.add(n),e.fragment.code.add(n),e.fragment.code.add(a)}else{var s=o.glsl(f||(f=r.__makeTemplateObject(["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "],["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "])));t.sliceEnabledForVertexPrograms&&e.vertex.code.add(s),e.fragment.code.add(s)}}Object.defineProperty(t,"__esModule",{value:!0}),t.Slice=void 0,t.Slice=s,function(e){e.bindUniformsWithOrigin=function(t,r,n){e.bindUniforms(t,r,n.slicePlane,n.origin)},e.bindUniforms=function(e,t,r,o){t.slicePlaneEnabled&&(n.isSome(r)?(o?(i.vec3.subtract(v,r.origin,o),e.setUniform3fv("slicePlaneOrigin",v)):e.setUniform3fv("slicePlaneOrigin",r.origin),e.setUniform3fv("slicePlaneBasis1",r.basis1),e.setUniform3fv("slicePlaneBasis2",r.basis2)):(e.setUniform3fv("slicePlaneBasis1",a.vec3f64.ZEROS),e.setUniform3fv("slicePlaneBasis2",a.vec3f64.ZEROS),e.setUniform3fv("slicePlaneOrigin",a.vec3f64.ZEROS)))}}(s=t.Slice||(t.Slice={}));var c,l,u,d,f,v=a.vec3f64.create()}).apply(null,n))||(e.exports=i)},"ff/U":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D=void 0,t.Default3D={position:0,normal:1,uv0:2,color:3,size:4,tangent:4,uvMapSpace:4,auxpos1:5,symbolColor:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,instanceColor:7,bound1:5,bound2:6,bound3:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}).apply(null,n))||(e.exports=i)},iHt0:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function r(){return new Float32Array(3)}function n(e,t,r){var n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=r,n}function i(){return r()}function a(){return n(1,1,1)}function o(){return n(1,0,0)}function s(){return n(0,1,0)}function c(){return n(0,0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.UNIT_Z=t.UNIT_Y=t.UNIT_X=t.ONES=t.ZEROS=t.unitZ=t.unitY=t.unitX=t.ones=t.zeros=t.createView=t.fromValues=t.clone=t.create=void 0,t.create=r,t.clone=function(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.fromValues=n,t.createView=function(e,t){return new Float32Array(e,t,3)},t.zeros=i,t.ones=a,t.unitX=o,t.unitY=s,t.unitZ=c,t.ZEROS=i(),t.ONES=a(),t.UNIT_X=o(),t.UNIT_Y=s(),t.UNIT_Z=c()}).apply(null,n))||(e.exports=i)},juLw:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i,a,o;Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyticalSkyModel=void 0,t.AnalyticalSkyModel=function(e){var t=e.fragment.code;t.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "])))),t.add(n.glsl(a||(a=r.__makeTemplateObject(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "],["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "])))),t.add(n.glsl(o||(o=r.__makeTemplateObject(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))}}).apply(null,n))||(e.exports=i)},lBa0:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parameter=t.ShaderTechniqueConfiguration=void 0;var n=function(){function e(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits.map((function(){return 0}))}return Object.defineProperty(e.prototype,"key",{get:function(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key},enumerable:!1,configurable:!0}),e.prototype.snapshot=function(){for(var e={key:this.key},t=0,r=this._parameterNames;t<r.length;t++){var n=r[t];e[n]=this[n]}return e},e}();t.ShaderTechniqueConfiguration=n,t.parameter=function(e){return void 0===e&&(e={}),function(t,n){var i,a;t._parameterNames=null!==(i=t._parameterNames)&&void 0!==i?i:[],t._parameterNames.push(n);for(var o=t._parameterNames.length-1,s=Math.ceil(r.log2(e.count||2)),c=null!==(a=t._parameterBits)&&void 0!==a?a:[0],l=0;c[l]+s>16;)++l>=c.length&&c.push(0);t._parameterBits=c;var u=c[l],d=(1<<s)-1<<u;c[l]+=s,Object.defineProperty(t,n,{get:function(){return this[o]},set:function(e){if(this[o]!==e&&(this[o]=e,this._keyDirty=!0,this._parameterBits[l]=this._parameterBits[l]&~d|+e<<u&d,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration values must be booleans or numbers!"}})}}}).apply(null,n))||(e.exports=i)},lfQW:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stencilToolTransparentOccluderParams=t.stencilToolMaskOccluderParams=t.stencilToolMaskBaseParams=t.stencilBaseAllZerosParams=t.replaceBitWhenDepthTestPasses=t.renderWhenBitIsNotSet=t.stencilWriteMaskOff=t.stencilWriteMaskOn=t.depthCompareAlways=t.depthCompareLess=void 0,t.depthCompareLess={func:513},t.depthCompareAlways={func:519},t.stencilWriteMaskOn={mask:255},t.stencilWriteMaskOff={mask:0},t.renderWhenBitIsNotSet=function(e){return{function:{func:517,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7680}}},t.replaceBitWhenDepthTestPasses=function(e){return{function:{func:519,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7681}}},t.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},t.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},t.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},t.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}}).apply(null,n))||(e.exports=i)},piY7:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("juLw"),r("quQL"),r("7Aei")],void 0===(i=(function(e,t,r,n,i,a){"use strict";var o,s,c,l,u,d,f,v,p,h,m;Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicallyBasedRendering=void 0,t.PhysicallyBasedRendering=function(e,t){var g=e.fragment.code;e.include(i.PiUtils),3===t.pbrMode||4===t.pbrMode?(g.add(a.glsl(o||(o=r.__makeTemplateObject(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "],["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "])),t.useCustomDTRExponentForWater?"2.2":"2.0")),g.add(a.glsl(s||(s=r.__makeTemplateObject(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "],["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),g.add(a.glsl(c||(c=r.__makeTemplateObject(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "],["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),g.add(a.glsl(l||(l=r.__makeTemplateObject(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "],["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),g.add(a.glsl(u||(u=r.__makeTemplateObject(["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  = 1.2;\n      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "],["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  = 1.2;\n      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))))):1!==t.pbrMode&&2!==t.pbrMode||(e.include(n.AnalyticalSkyModel),g.add(a.glsl(d||(d=r.__makeTemplateObject(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "],["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),g.add(a.glsl(f||(f=r.__makeTemplateObject(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "],["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),g.add(a.glsl(v||(v=r.__makeTemplateObject(["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "],["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),g.add(a.glsl(p||(p=r.__makeTemplateObject(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "],["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),g.add(a.glsl(h||(h=r.__makeTemplateObject(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"],["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"])))),g.add(a.glsl(m||(m=r.__makeTemplateObject(["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "],["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "])))))}}).apply(null,n))||(e.exports=i)},quQL:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.PiUtils=void 0,t.PiUtils=function(e){e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    const float PI = 3.141592653589793;\n  "],["\n    const float PI = 3.141592653589793;\n  "])))),e.fragment.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n    const float PI = 3.141592653589793;\n    const float LIGHT_NORMALIZATION = 1.0 / PI;\n    const float INV_PI = 0.3183098861837907;\n    const float HALF_PI = 1.570796326794897;\n    "],["\n    const float PI = 3.141592653589793;\n    const float LIGHT_NORMALIZATION = 1.0 / PI;\n    const float INV_PI = 0.3183098861837907;\n    const float HALF_PI = 1.570796326794897;\n    "]))))}}).apply(null,n))||(e.exports=i)},rCq5:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConversion=void 0,t.ColorConversion=function(e){e.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    vec4 premultiplyAlpha(vec4 v) {\n      return vec4(v.rgb * v.a, v.a);\n    }\n\n    // Note: the min in the last line has been added to fix an instability in chrome.\n    // See https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/23911\n    // With proper floating point handling, the value could never be >1.\n    vec3 rgb2hsv(vec3 c) {\n      vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n      vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n      vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n      float d = q.x - min(q.w, q.y);\n      float e = 1.0e-10;\n      return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n    }\n\n    vec3 hsv2rgb(vec3 c) {\n      vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n      vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n      return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }\n\n    float rgb2v(vec3 c) {\n      return max(c.x, max(c.y, c.z));\n    }\n  "],["\n    vec4 premultiplyAlpha(vec4 v) {\n      return vec4(v.rgb * v.a, v.a);\n    }\n\n    // Note: the min in the last line has been added to fix an instability in chrome.\n    // See https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/23911\n    // With proper floating point handling, the value could never be >1.\n    vec3 rgb2hsv(vec3 c) {\n      vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n      vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n      vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n      float d = q.x - min(q.w, q.y);\n      float e = 1.0e-10;\n      return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n    }\n\n    vec3 hsv2rgb(vec3 c) {\n      vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n      vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n      return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }\n\n    float rgb2v(vec3 c) {\n      return max(c.x, max(c.y, c.z));\n    }\n  "]))))}}).apply(null,n))||(e.exports=i)},s6rJ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+"),r("LxLY"),r("0LE5"),r("Rdxj"),r("WRgd"),r("+wMf"),r("CIy2"),r("PwS/")],void 0===(i=(function(e,t,r,n,i,a,o,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.colorMixModes=t.intersectDrapedRenderLineGeometry=t.updateParameters=t.copyParameters=t.bindScreenSizePerspective=t.verticalOffsetAtDistance=t.intersectAabbInvDirBefore=t.intersectAabbInvDir=t.computeInvDir=t.computeNormal=t.intersectTriangles=t.intersectTriangleGeometry=void 0;var u=o.create(),d=c.VertexAttrConstants;t.intersectTriangleGeometry=function(e,t,r,i,a,s,v){var p=l.isInstanceHidden(t),m=r.tolerance;if(!p)if(e.boundingInfo)c.assert("triangle"===e.data.primitiveType),function e(t,r,i,a,s,c){var l=y(r,i,f);if(o.setMin(u,t.getBBMin()),o.setMax(u,t.getBBMax()),n.isSome(s)&&s.applyToAabb(u),x(u,r,l,a)){var d=t.getPrimitiveIndices(),v=t.getIndices(),p=t.getPosition(),m=d?d.length:v.length/3;if(m>w){var g=t.getChildren();if(void 0!==g){for(var b=0;b<8;++b)void 0!==g[b]&&e(g[b],r,i,a,s,c);return}}h(r,i,0,m,v,p,d,s,c)}}(e.boundingInfo,i,a,m,s,v);else{var g=e.getIndices(d.POSITION),b=e.getAttribute(d.POSITION);h(i,a,0,g.length/3,g,b,void 0,s,v)}};var f=a.vec3f64.create(),v=Math.pow(2,-52),p=a.vec3f64.create();function h(e,t,r,i,a,o,s,c,l){var u,d,f;if(s)return function(e,t,r,i,a,o,s,c,l){for(var u,d,f,h=o.data,m=o.offsetIdx,g=o.strideIdx,y=e[0],x=e[1],_=e[2],S=t[0]-y,w=t[1]-x,O=t[2]-_,P=r;P<i;++P){var M=s[P],T=3*M,A=m+g*a[T++],j=h[A++],I=h[A++],C=h[A];A=m+g*a[T++];var V=h[A++],z=h[A++],D=h[A];A=m+g*a[T];var L=h[A++],R=h[A++],F=h[A];n.isSome(c)&&(j=(u=c.applyToVertex(j,I,C))[0],I=u[1],C=u[2],V=(d=c.applyToVertex(V,z,D))[0],z=d[1],D=d[2],L=(f=c.applyToVertex(L,R,F))[0],R=f[1],F=f[2]);var N=V-j,B=z-I,U=D-C,E=L-j,H=R-I,k=F-C,G=w*k-H*O,q=O*E-k*S,W=S*H-E*w,X=N*G+B*q+U*W;if(!(Math.abs(X)<=v)){var Z=y-j,Y=x-I,J=_-C,K=Z*G+Y*q+J*W;if(X>0){if(K<0||K>X)continue}else if(K>0||K<X)continue;var Q=Y*U-B*J,$=J*N-U*Z,ee=Z*B-N*Y,te=S*Q+w*$+O*ee;if(X>0){if(te<0||K+te>X)continue}else if(te>0||K+te<X)continue;var re=(E*Q+H*$+k*ee)/X;re>=0&&l(re,b(N,B,U,E,H,k,p),M)}}}(e,t,r,i,a,o,s,c,l);for(var h=o.data,m=o.offsetIdx,g=o.strideIdx,y=e[0],x=e[1],_=e[2],S=t[0]-y,w=t[1]-x,O=t[2]-_,P=r,M=3*r;P<i;++P){var T=m+g*a[M++],A=h[T++],j=h[T++],I=h[T];T=m+g*a[M++];var C=h[T++],V=h[T++],z=h[T];T=m+g*a[M++];var D=h[T++],L=h[T++],R=h[T];n.isSome(c)&&(A=(u=c.applyToVertex(A,j,I))[0],j=u[1],I=u[2],C=(d=c.applyToVertex(C,V,z))[0],V=d[1],z=d[2],D=(f=c.applyToVertex(D,L,R))[0],L=f[1],R=f[2]);var F=C-A,N=V-j,B=z-I,U=D-A,E=L-j,H=R-I,k=w*H-E*O,G=O*U-H*S,q=S*E-U*w,W=F*k+N*G+B*q;if(!(Math.abs(W)<=v)){var X=y-A,Z=x-j,Y=_-I,J=X*k+Z*G+Y*q;if(W>0){if(J<0||J>W)continue}else if(J>0||J<W)continue;var K=Z*B-N*Y,Q=Y*F-B*X,$=X*N-F*Z,ee=S*K+w*Q+O*$;if(W>0){if(ee<0||J+ee>W)continue}else if(ee>0||J+ee<W)continue;var te=(U*K+E*Q+H*$)/W;te>=0&&l(te,b(F,N,B,U,E,H,p),P)}}}t.intersectTriangles=h;var m=a.vec3f64.create(),g=a.vec3f64.create();function b(e,t,r,n,a,o,s){return i.vec3.set(m,e,t,r),i.vec3.set(g,n,a,o),i.vec3.cross(s,m,g),i.vec3.normalize(s,s),s}function y(e,t,r){return i.vec3.set(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function x(e,t,r,n){return _(e,t,r,n,1/0)}function _(e,t,r,n,i){var a=(e[0]-n-t[0])*r[0],o=(e[3]+n-t[0])*r[0],s=Math.min(a,o),c=Math.max(a,o),l=(e[1]-n-t[1])*r[1],u=(e[4]+n-t[1])*r[1];if((c=Math.min(c,Math.max(l,u)))<0)return!1;if((s=Math.max(s,Math.min(l,u)))>c)return!1;var d=(e[2]-n-t[2])*r[2],f=(e[5]+n-t[2])*r[2];return!((c=Math.min(c,Math.max(d,f)))<0)&&!((s=Math.max(s,Math.min(d,f)))>c)&&s<i}function S(e){var t=[];return e.forEach((function(e){return t.push(e)})),t}t.computeNormal=b,t.computeInvDir=y,t.intersectAabbInvDir=x,t.intersectAabbInvDirBefore=_,t.verticalOffsetAtDistance=function(e,t,n,i,a){var o=(n.screenLength||0)*e.pixelRatio;a&&(o=s.scale(o,i,t,a));var c=o*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return r.glClamp(c*t,n.minWorldLength||0,null!=n.maxWorldLength?n.maxWorldLength:1/0)},t.bindScreenSizePerspective=function(e,t,r){if(e){var n=e.parameters;t.setUniform4f(r,n.divisor,n.offset,n.minPixelSize,e.paddingPixelsOverride)}},t.copyParameters=function e(t,r){var n=r?e(r):{};for(var i in t){var a=t[i];a&&a.forEach&&(a=S(a)),null==a&&i in n||(n[i]=a)}return n},t.updateParameters=function(e,t){var r=!1;for(var n in t){var i=t[n];void 0!==i&&(r=!0,e[n]=Array.isArray(i)?i.slice():i)}return r},t.intersectDrapedRenderLineGeometry=function(e,t,n,i,a){if(t.options.selectionMode){for(var o=e.getAttribute(d.POSITION).data,s=e.getAttribute(d.SIZE),c=n[0],l=n[1],u=(((s&&s.data[0])+i)/2+4)*e.screenToWorldRatio,f=Number.MAX_VALUE,v=0;v<o.length-5;v+=3){var p=o[v],h=o[v+1],m=c-p,g=l-h,b=o[v+3]-p,y=o[v+4]-h,x=r.clamp((b*m+y*g)/(b*b+y*y),0,1),_=b*x-m,S=y*x-g,w=_*_+S*S;w<f&&(f=w)}f<u*u&&a()}},t.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var w=1e3}).apply(null,n))||(e.exports=i)},tUyH:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("KRuQ")],void 0===(i=(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLMaterial=void 0;var i=function(e){function t(t){var r=e.call(this)||this;return r.material=t.material,r.techniqueRep=t.techniqueRep,r.output=t.output,r}return r.__extends(t,e),t.prototype.getTechnique=function(){return this.technique},t.prototype.getPipelineState=function(e,t){return this.getTechnique().pipeline},t.prototype.ensureResources=function(e){return 2},t.prototype.ensureParameters=function(e){},t}(n.AutoDisposable);t.GLMaterial=i}).apply(null,n))||(e.exports=i)},vlC2:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("iHt0")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec3f32=void 0,t.vec3f32=r}).apply(null,n))||(e.exports=i)},"wSO/":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("6DRN"),r("51bw"),r("1m5D"),r("lLWD"),r("DIqE"),r("Rdxj"),r("O7NG")],void 0===(i=(function(e,t,r,n,i,a,o,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorStack=void 0;var u=function(){function e(e,t,r){var i=this;this.itemByteSize=e,this.itemCreate=t,this.buffers=[],this.items=[],this.itemsPerBuffer=0,this.itemsPtr=0,this.itemsPerBuffer=Math.ceil(r/this.itemByteSize),this.tickHandle=n.before((function(){return i.reset()}))}return e.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=r.nullifyNonnullableForDispose(this.tickHandle)),this.itemsPtr=0,this.items=r.nullifyNonnullableForDispose(this.items),this.buffers=r.nullifyNonnullableForDispose(this.buffers)},e.prototype.get=function(){0===this.itemsPtr&&n((function(){}));for(var e=Math.floor(this.itemsPtr/this.itemsPerBuffer);this.buffers.length<=e;){for(var t=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),r=0;r<this.itemsPerBuffer;++r)this.items.push(this.itemCreate(t,r*this.itemByteSize));this.buffers.push(t)}return this.items[this.itemsPtr++]},e.prototype.reset=function(){for(var e=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>e;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0},e.createVec2f64=function(t){return void 0===t&&(t=d),new e(16,s.vec2f64.createView,t)},e.createVec3f64=function(t){return void 0===t&&(t=d),new e(24,c.vec3f64.createView,t)},e.createVec4f64=function(t){return void 0===t&&(t=d),new e(32,l.vec4f64.createView,t)},e.createMat3f64=function(t){return void 0===t&&(t=d),new e(72,i.mat3f64.createView,t)},e.createMat4f64=function(t){return void 0===t&&(t=d),new e(128,a.mat4f64.createView,t)},e.createQuatf64=function(t){return void 0===t&&(t=d),new e(32,o.quatf64.createView,t)},Object.defineProperty(e.prototype,"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!1,configurable:!0}),e}();t.VectorStack=u;var d=4096}).apply(null,n))||(e.exports=i)},weRx:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("zp6E")],void 0===(i=(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestImage=void 0,t.requestImage=function(e,t){return n(e,r.__assign({responseType:"image"},t)).then((function(e){return e.data}))}}).apply(null,n))||(e.exports=i)},xDGw:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("2o+p"),r("7Aei")],void 0===(i=(function(e,t,r,n,i){"use strict";function a(e,t){var a=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(n.ScreenSizePerspective),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),a.add(i.glsl(d||(d=r.__makeTemplateObject(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "],["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),i.glsl(1===t.viewingMode?s||(s=r.__makeTemplateObject(["vec3 worldNormal = normalize(worldPos + localOrigin);"],["vec3 worldNormal = normalize(worldPos + localOrigin);"])):c||(c=r.__makeTemplateObject(["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"],["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"]))),i.glsl(t.screenSizePerspectiveEnabled?l||(l=r.__makeTemplateObject(["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"],["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"])):u||(u=r.__makeTemplateObject(["\n          float verticalOffsetScreenHeight = verticalOffset.x;"],["\n          float verticalOffsetScreenHeight = verticalOffset.x;"])))))):a.add(i.glsl(f||(f=r.__makeTemplateObject(["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "],["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "]))))}function o(e,t,r,n){return void 0===n&&(n=v),n.screenLength=e.screenLength,n.perDistance=Math.tan(.5*t)/(.5*r),n.minWorldLength=e.minWorldLength,n.maxWorldLength=e.maxWorldLength,n}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateVerticalOffsetFactors=t.VerticalOffset=void 0,t.VerticalOffset=a,function(e){e.bindUniforms=function(e,t,r){if(t.verticalOffset){var n=o(t.verticalOffset,r.camera.fovY,r.camera.fullViewport[3]);e.setUniform4f("verticalOffset",n.screenLength*(r.camera.pixelRatio||1),n.perDistance,n.minWorldLength,n.maxWorldLength)}}}(a=t.VerticalOffset||(t.VerticalOffset={})),t.calculateVerticalOffsetFactors=o;var s,c,l,u,d,f,v={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}}).apply(null,n))||(e.exports=i)},yqrJ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("pcDC"),r("ma1f"),r("BcWh"),r("xoE+"),r("xoE+"),r("LxLY"),r("qMld"),r("rusB"),r("jfWY"),r("R6Tp"),r("weRx"),r("EyQ4"),r("/Bau"),r("W0kZ"),r("CIy2"),r("/f24"),r("Zp3t"),r("Kfys"),r("7laH")],void 0===(i=(function(e,t,r,n,i,a,o,s,c,l,u,d,f,v,p,h,m,g,b,y,x,_){"use strict";return function(){function e(t,r,n){this.data=t,this.glTexture=null,this.powerOfTwoStretchInfo=null,this.loadingPromise=null,this.loadingController=null,this.events=new a,this.data=t,this.id=e.idGen.gen(r),this.params=n||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=e.estimateTexMemRequired(this.data,this.params),this.startPreload()}return e.prototype.startPreload=function(){var e=this.data;c.isNone(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))},e.prototype.startPreloadVideoElement=function(e){d.isBlobProtocol(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)},e.prototype.startPreloadImageElement=function(e){d.isDataProtocol(e.src)||d.isBlobProtocol(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)},e.getDataDimensions=function(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e},e.estimateTexMemRequired=function(t,r){if(c.isNone(t))return 0;if(u.isArrayBuffer(t)||u.isUint8Array(t))return t.byteLength;var n=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?e.getDataDimensions(t):r;return(r.mipmap?4/3:1)*n.width*n.height*(r.components||4)||0},e.prototype.dispose=function(){this.data=void 0},Object.defineProperty(e.prototype,"width",{get:function(){return this.params.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.params.height},enumerable:!1,configurable:!0}),e.prototype.createDescriptor=function(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.mipmap&&!this.params.disableAnisotropy?e.parameters.maxMaxAnisotropy:void 0}},e.prototype.load=function(t,r){if(c.isSome(this.glTexture))return this.glTexture;if(c.isSome(this.loadingPromise))return this.loadingPromise;var i=this.data;return c.isNone(i)?(this.glTexture=new y(t,this.createDescriptor(t),null),t.bindTexture(this.glTexture),this.glTexture):"string"==typeof i?this.loadFromURL(t,r,i):i instanceof Image?this.loadFromImageElement(t,r,i):i instanceof HTMLVideoElement?this.loadFromVideoElement(t,r,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this.loadFromImage(t,i,r):(u.isArrayBuffer(i)||u.isUint8Array(i))&&this.params.encoding===e.DDS_ENCODING?this.loadFromDDSData(t,i):u.isUint8Array(i)?this.loadFromPixelData(t,i):u.isArrayBuffer(i)?this.loadFromPixelData(t,new Uint8Array(i)):(n.neverReachedSilent(i),null)},Object.defineProperty(e.prototype,"requiresFrameUpdates",{get:function(){return this.data instanceof HTMLVideoElement},enumerable:!1,configurable:!0}),e.prototype.frameUpdate=function(e,t,r){if(!(this.data instanceof HTMLVideoElement)||c.isNone(this.glTexture))return r;if(this.data.readyState<2||r===this.data.currentTime)return r;if(c.isSome(this.powerOfTwoStretchInfo)){var n=this.powerOfTwoStretchInfo,i=n.framebuffer,a=n.vao,o=n.sourceTexture;o.setData(this.data),this.drawStretchedTexture(e,t,i,a,o,this.glTexture)}else{var s=this.data,l=s.width,u=s.height,d=this.glTexture.descriptor,f=d.width,v=d.height;l!==f||u!==v?this.glTexture.updateData(0,0,0,Math.min(l,f),Math.min(u,v),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime},e.prototype.loadFromDDSData=function(e,t){return this.glTexture=p.createDDSTexture(e,this.createDescriptor(e),t,this.params.mipmap),e.bindTexture(this.glTexture),this.glTexture},e.prototype.loadFromPixelData=function(e,t){g.assert(this.params.width>0&&this.params.height>0);var r=this.createDescriptor(e);return r.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,r.width=this.params.width,r.height=this.params.height,this.glTexture=new y(e,r,t),e.bindTexture(this.glTexture),this.glTexture},e.prototype.loadAsync=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,a=this;return r.__generator(this,(function(r){return t=l.createAbortController(),this.loadingController=t,n=e(t.signal),this.loadingPromise=n,n.then(i=function(){a.loadingController===t&&(a.loadingController=null),a.loadingPromise===n&&(a.loadingPromise=null)},i),[2,n]}))}))},e.prototype.loadFromURL=function(e,t,n){var i=this;return this.loadAsync((function(a){return r.__awaiter(i,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,v.requestImage(n,{signal:a})];case 1:return i=r.sent(),[2,this.loadFromImage(e,i,t)]}}))}))}))},e.prototype.loadFromImageElement=function(e,t,n){var i=this;return n.complete?this.loadFromImage(e,n,t):this.loadAsync((function(a){return r.__awaiter(i,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,f.loadImageAsync(n,n.src,!1,a)];case 1:return i=r.sent(),[2,this.loadFromImage(e,i,t)]}}))}))}))},e.prototype.loadFromVideoElement=function(e,t,r){return r.readyState>=2?this.loadFromImage(e,r,t):this.loadFromVideoElementAsync(e,t,r)},e.prototype.loadFromVideoElementAsync=function(e,t,r){var n=this;return this.loadAsync((function(a){return l.create((function(o,s){var u=function(){r.removeEventListener("loadeddata",d),r.removeEventListener("error",f),c.isSome(v)&&v.remove()},d=function(){r.readyState>=2&&(u(),o(n.loadFromImage(e,r,t)))},f=function(e){u(),s(e||new i("Failed to load video"))};r.addEventListener("loadeddata",d),r.addEventListener("error",f);var v=l.onAbort(a,(function(){return f(l.createAbortError())}))}))}))},e.prototype.loadFromImage=function(t,r,n){var i=e.getDataDimensions(r);this.params.width=i.width,this.params.height=i.height;var a=this.createDescriptor(t);return a.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(t,a)||s.isPowerOfTwo(i.width)&&s.isPowerOfTwo(i.height)?(a.width=i.width,a.height=i.height,this.glTexture=new y(t,a,r),t.bindTexture(this.glTexture),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(t,r,i,a,n),t.bindTexture(this.glTexture),this.glTexture)},e.prototype.requiresPowerOfTwo=function(e,t){var r="number"==typeof t.wrapMode?33071===t.wrapMode:33071===t.wrapMode.s&&33071===t.wrapMode.t;return!_.default(e.gl)&&(t.hasMipmap||!r)},e.prototype.makePowerOfTwoTexture=function(e,t,r,i,a){var s,c=r.width,l=r.height,u=o.nextHighestPowerOfTwo(c),d=o.nextHighestPowerOfTwo(l);switch(i.width=u,i.height=d,this.params.powerOfTwoResizeMode){case 2:i.textureCoordinateScaleFactor=[c/u,l/d],(s=new y(e,i)).updateData(0,0,0,c,l,t);break;case 1:case null:case void 0:s=this.stretchToPowerOfTwo(e,t,i,a);break;default:n.neverReached(this.params.powerOfTwoResizeMode)}return i.hasMipmap&&s.generateMipmap(),s},e.prototype.stretchToPowerOfTwo=function(e,t,r,n){var i=new y(e,r),a=new b(e,{colorTarget:0,depthStencilTarget:0},i),o=new y(e,{target:3553,pixelFormat:r.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},t),s=h.createQuadVAO(e);return this.drawStretchedTexture(e,n,a,s,o,i),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:s,sourceTexture:o,framebuffer:a}:(s.dispose(!0),o.dispose(),a.detachColorTexture(),e.bindFramebuffer(null),a.dispose()),i},e.prototype.drawStretchedTexture=function(e,t,r,n,i,a){e.bindFramebuffer(r);var o=e.getViewport();e.setViewport(0,0,a.descriptor.width,a.descriptor.height);var s=t.program;e.bindProgram(s),s.setUniform4f("color",1,1,1,1),s.setUniform1i("tex",0),e.bindTexture(i,0),e.bindVAO(n),e.setPipelineState(t.pipeline),e.drawArrays(5,0,x.vertexCount(n,"geometry")),e.bindFramebuffer(null),e.setViewport(o.x,o.y,o.width,o.height)},e.prototype.unload=function(){if(c.isSome(this.powerOfTwoStretchInfo)){var e=this.powerOfTwoStretchInfo,t=e.framebuffer,r=e.sourceTexture;e.vao.dispose(!0),r.dispose(),t.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if(c.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),c.isSome(this.loadingController)){var n=this.loadingController;this.loadingController=null,this.loadingPromise=null,n.abort()}this.events.emit("unloaded")},e.idGen=new m.IdGen,e.DDS_ENCODING="image/vnd-ms.dds",e}()}).apply(null,n))||(e.exports=i)},ys4y:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("3RHn"),r("+nCE"),r("W0kZ"),r("CIy2"),r("CIy2")],void 0===(i=(function(e,t,r,n,i,a,o){"use strict";return function(){function e(t,r,n){this._boundingInfo=null,this._id=e.__idGen.gen(r),this._data=t,this._boundingInfo=n}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),e.prototype.getIndices=function(e){return this.data.getIndices(e)},Object.defineProperty(e.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!1,configurable:!0}),e.prototype.getAttribute=function(e){return this.data.getAttribute(e)},Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo},enumerable:!1,configurable:!0}),e.prototype.computeAttachmentOrigin=function(e){return"triangle"===this.data.primitiveType?this.computeAttachmentOriginTriangles(e):this.computeAttachmentOriginPoints(e)},e.prototype.computeAttachmentOriginTriangles=function(e){var t=this.getIndices(o.VertexAttrConstants.POSITION),r=this.getAttribute(o.VertexAttrConstants.POSITION);return n.computeAttachmentOriginTriangles(r,t,e)},e.prototype.computeAttachmentOriginPoints=function(e){var t=this.getIndices(o.VertexAttrConstants.POSITION),r=this.getAttribute(o.VertexAttrConstants.POSITION);return n.computeAttachmentOriginPoints(r,t,e)},e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null},e.prototype._calculateBoundingInfo=function(){var e=this.data.getIndices(o.VertexAttrConstants.POSITION),t=this.data.getAttribute(o.VertexAttrConstants.POSITION),i="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(i);for(var s=0;s<i;++s)e[s]=s}var c=e.length;a.assert(c%i==0,"Indexing error: "+c.toFixed(0)+" not divisible by "+i.toFixed(0));var l=n.generateDefaultIndexArray(c/i);return new r(l,i,e,t)},e.__idGen=new i.IdGen,e}()}).apply(null,n))||(e.exports=i)},zZCp:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pos2Tex=t.Pos2=t.Pos3Col=t.Pos3NormalTex=t.Pos3Tex=t.Pos3=void 0,t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}).apply(null,n))||(e.exports=i)}}]);