(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/layers/features/support/ClusterStore":"0SZq","esri/layers/graphics/data/QueryEngineCapabilities":"4/qq","arcgis-js-api/layers/graphics/data/QueryEngineCapabilities":"4/qq","esri/geohash/geohashUtils":"8pdz","arcgis-js-api/tasks/operations/query":"B16N","esri/tasks/operations/query":"B16N","esri/views/2d/layers/features/controllers/BaseController":"Btct","esri/tasks/support/Query":"IpeC","arcgis-js-api/tasks/support/Query":"IpeC","esri/geohash/GeohashTree":"JOu6","arcgis-js-api/tasks/support/StatisticDefinition":"aZmZ","esri/tasks/operations/urlUtils":"cGHk","esri/views/2d/layers/features/support/pixelBuffering":"oWCy"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"0SZq":function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r("xhoE"),r("2Atf"),r("Q2wQ"),r("HZ3d"),r("TMur"),r("H1tY"),r("LxLY"),r("jBNx"),r("JOu6"),r("8pdz"),r("nrlZ"),r("vtMp"),r("/COu"),r("Jvs9"),r("rfv1"),r("Q2Em"),r("ZooB"),r("zDti"),r("tI6k")],void 0===(o=(function(e,t,r,i,o,n,a,s,u,l,c,p,d,h,f,y,g,v,m,b,_){Object.defineProperty(t,"__esModule",{value:!0});var S=function(e){return u.andThen(e,(function(e){return"cluster"!==e.type?null:i({},e,{clusterRadius:l.pt2px(e.clusterRadius/2)})}))},x=function(e){function t(t,r,i,o,n){var a=this,s=new y.default([],[r,i]);return(a=e.call(this,s,o,null,t)||this).invalid=!1,a.canDelete=!1,a.geohashBoundsInfo=n,a}return r(t,e),Object.defineProperty(t.prototype,"count",{get:function(){return this.attributes.cluster_count},enumerable:!0,configurable:!0}),t.create=function(e,r,i,o,n,a,s){var u=new t(r,i,o,a,s);return u.localId=e.createLocalId(u.objectId,!0),u.tileLevel=n,u},t.prototype.update=function(e,t,r,i,o){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=i,this.geohashBoundsInfo=o,this.referenceId=null,this.invalid=!1,this},t.prototype.toJSON=function(){return{objectId:this.objectId,referenceId:this.referenceId,attributes:i({},this.attributes,{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},t}(f.default),w=function(e){function t(t,r,i,o){var n=e.call(this,t)||this;return n._deferredDeletionQueue=[],n._invalidated=!1,n._aggregateFieldsHash=null,n._geohashLevel=0,n._aggregateValueRanges={},n._aggregateValueRangesChanged=!1,n._clusters=new Map,n._tiles=new Map,n._spatialReference=r,n._attributeStore=i,n._featureReduction=S(o),n._projectionSupportCheck=v.checkProjectionSupport(r,a.SpatialReference.WGS84),n}return r(t,e),t.prototype.update=function(e,t){return n(this,void 0,void 0,(function(){var r,i,n,a,s,l=this;return o(this,(function(o){switch(o.label){case 0:return r=this._featureReduction,i=u.andThen(t.featureReduction,S),n=t.aggregateFields.reduce((function(e,t){return e+JSON.stringify(t)}),""),a=n!==this._aggregateFieldsHash,s=null===r&&t.featureReduction||a,[4,this._projectionSupportCheck];case 1:return o.sent(),this._featureReduction=i,this._aggregateFieldsHash=n,this._aggregateValueRanges={},this._invalidated=!0,u.isNone(i)?(this._tree=null,[2]):(u.isSome(r)&&r.clusterRadius!==i.clusterRadius&&this._clusters.forEach((function(e){return e.canDelete=!0})),s&&(this._tree=new c.GeohashTree(t.aggregateFields),this._unindexFeatures()),(s||e)&&this._reindexFeatures(),this._handleClusterUpdates(),this._tiles.forEach((function(e){return l._getClustersForTile(e,0,i.clusterRadius,null,!1)})),[2])}}))}))},t.prototype._unindexFeatures=function(){this._featuresById.forEach((function(e){e.geohashIndexed=!1}))},t.prototype._reindexFeatures=function(){var e=this;this._featuresById.forEach((function(t){t.geohashX||t.geohashY||e._setGeohash(t),e._attributeStore.isVisible(t)?e._insertIntoIndex(t):e._removeFromIndex(t)}))},t.prototype.onTileUpdate=function(e){var t=this,r=e.added,i=e.removed;if(r.length){var o=Math.max.apply(Math,r.map((function(e){return e.level})));this._setGeohashLevel(o),r.forEach((function(e){return t._tiles.set(e.key.id,e)}))}if(!u.isNone(this._featureReduction)){var n=this._featureReduction.clusterRadius;i.forEach((function(e){t._tiles.delete(e.key.id),t._markTileClustersForDeletion(e,n)}))}},t.prototype.sweepClusters=function(){var e=this;this._clusters.forEach((function(t,r){t.canDelete&&(e._attributeStore.freeLocalId(t.objectId),e._clusters.delete(r))}));for(var t=0,r=this._deferredDeletionQueue;t<r.length;t++)this._attributeStore.addLocalId(r[t]);this._deferredDeletionQueue=[]},t.prototype.executeTileQuery=function(t,r,i){return n(this,void 0,void 0,(function(){var n,a,s;return o(this,(function(o){switch(o.label){case 0:return u.isNone(this._featureReduction)?[2,e.prototype.executeTileQuery.call(this,t,r,i)]:[4,this._projectionSupportCheck];case 1:return o.sent(),this._handleClusterUpdates(),n=this._featureReduction.clusterRadius,a=this._getTransforms(t,r),s=this._getClustersForTile(t,i.pixelBuffer,n,a),this._aggregateValueRangesChanged&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),[2,s]}}))}))},t.prototype.getAggregate=function(e){var t=null;return this._clusters.forEach((function(r){r.localId===e&&(t=r.toJSON())})),t},t.prototype.getAggregateValueRanges=function(){return this._aggregateValueRanges},t.prototype._getClustersForTile=function(e,t,r,o,n){var l=this;void 0===n&&(n=!0),t=Math.max(t,50);for(var c=2*r,p=new Set,d=this._getGeohashLevel(e.key.level),f=Math.pow(2,e.key.level)*Math.ceil(_.TILE_SIZE/c),y=Math.ceil(t/c)+2,g=Math.ceil(_.TILE_SIZE/c)+2*y,S=e.key,x=S.row*_.TILE_SIZE,w=Math.floor(S.col*_.TILE_SIZE/c)-y,R=Math.floor(x/c)-y,I=w+g,M=R+g,F=new Array,j=e.tileInfoView.getLODInfoAt(e.key.level),T=w;T<=I;T++)for(var C=this,O=R;O<=M;O++)!function(t){var r,c,y=T;j.wrap&&(y=T<0?T+f:T%f);var g=j.wrap&&T<0,_=j.wrap&&T%f!==T,S=C._lookupCluster(j,e.key.level,y,t,d);if(u.isSome(S)){var x=u.andThen(o,(function(e){return g?e.left:_?e.right:e.tile}));if(n&&u.isNone(x))return"continue";if(!S.count)return"continue";if(n&&1===S.count){var w=S.geohashBoundsInfo,R=w.xLL,I=w.yLL,M=w.xTR,O=w.yTR,P=w.level,E=u.expect(C._tree).findSingleOccupancyNode(R,I,M,O,P),G=u.unwrap(E).getLngLatBounds(),N={x:G[0],y:G[1]},L={x:G[2],y:G[3]},k=0,V=0,B=0,z=0;if(C._spatialReference.isWebMercator)k=(r=h.lngLatToXY(N.x,N.y))[0],V=r[1],B=(c=h.lngLatToXY(L.x,L.y))[0],z=c[1];else{var A=v.project(N,a.SpatialReference.WGS84,C._spatialReference),q=v.project(L,a.SpatialReference.WGS84,C._spatialReference);if(!A||!q)return s("esri-2d-debug")&&console.debug("Failed to reproject known tree node"),"continue";k=A.x,V=A.y,B=q.x,z=q.y}var D=null;if(C.forEachInBounds([k,V,B,z],(function(e){l._attributeStore.isVisible(e)&&(D&&s("esri-2d-debug")&&console.debug("Expected to find only one feature, but found multiple"),D=e)})),!D)return s("esri-2d-debug")&&console.debug("Expected to find a feature, but found none"),"continue";var Q=b.getGeometry(C.geometryInfo,D.geometry,0,u.expect(x)),Y=i({},D.attributes,S.attributes);S.referenceId=D.localId,p.add(S.objectId),F.push(new m.Feature(Y,S.localId,Q))}else n&&(p.add(S.objectId),Q=b.getGeometry(C.geometryInfo,S.geometry,0,u.expect(x)),F.push(new m.Feature(S.attributes,S.localId,Q)))}}(O);return{features:F,objectIds:p}},t.prototype._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},t.prototype._setGeohashLevel=function(e){var t=this,r=this._geohashLevel,i=this._getGeohashLevel(e),o=2*(Math.floor(i/2)+1)-1,n=this._tree;this._geohashLevel=o,u.isNone(n)||(o>r?this._featuresById.forEach((function(e){e.geohashIndexed&&(n.insert(e,t._geohashLevel,r+1),e.geohashIndexed=!0)})):o<r&&n.dropLevels(this._geohashLevel))},t.prototype._insertIntoIndex=function(e){e.geohashIndexed||(this._invalidated=!0,e.geohashIndexed=!0,u.expect(this._tree).insert(e,this._geohashLevel))},t.prototype._removeFromIndex=function(e){e.geohashIndexed&&(this._invalidated=!0,u.expect(this._tree).remove(e,this._geohashLevel),e.geohashIndexed=!1)},t.prototype._handleClusterUpdates=function(){var e=this;this._invalidated&&this._clusters.size&&this._clusters.forEach((function(t){u.isSome(t)&&(t.invalid=t.invalid||e._invalidated)})),this._invalidated=!1},t.prototype._getTransforms=function(e,t){var r={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},o=d.getInfo(t);if(!o)return{tile:r,left:null,right:null};var n=o.valid,a=n[0],s=n[1];return{tile:r,left:i({},r,{translate:[s,e.bounds[3]]}),right:i({},r,{translate:[a-s+e.bounds[0],e.bounds[3]]})}},t.prototype._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},t.prototype._markForDeletion=function(e,t,r){var i=this._getClusterId(e,t,r);if(this._clusters.has(i)){var o=this._clusters.get(i);u.isSome(o)?o.canDelete=!0:this._clusters.delete(i)}},t.prototype._getClusterBounds=function(e,t,r){if(u.isNone(this._featureReduction))return null;var i=this._featureReduction.clusterRadius,o=2*i,n=r%2?t*o:t*o+i,a=r*o,s=a/_.TILE_SIZE,l=(n+o)/_.TILE_SIZE,c=(a-o)/_.TILE_SIZE;return[e.getXForColumn(n/_.TILE_SIZE),e.getYForRow(s),e.getXForColumn(l),e.getYForRow(c)]},t.prototype._lookupCluster=function(e,t,r,o,n){var s,l;if(u.isNone(this._featureReduction)||u.isNone(this._tree))return null;var c=this._getClusterId(t,r,o),d=this._clusters.get(c);if(d&&u.isSome(d)&&!d.invalid&&!d.canDelete)return d;var f=this._getClusterBounds(e,r,o),y=f[0],g=f[1],m=f[2],b=f[3],_={x:y,y:g},S={x:m,y:b},w=0,R=0,I=0,M=0;if(this._spatialReference.isWebMercator)w=(s=h.xyToLngLat(_.x,_.y))[0],R=s[1],I=(l=h.xyToLngLat(S.x,S.y))[0],M=l[1];else{var F=v.project(_,this._spatialReference,a.SpatialReference.WGS84),j=v.project(S,this._spatialReference,a.SpatialReference.WGS84);if(!F||!j)return null;w=F.x,R=F.y,I=j.x,M=j.y}var T={geohashX:0,geohashY:0},C={geohashX:0,geohashY:0};p.setGeohashXY(T,R,w,n),p.setGeohashXY(C,M,I,n);var O=T.geohashX,P=T.geohashY,E=C.geohashX,G=C.geohashY,N={xLL:O,yLL:P,xTR:E,yTR:G,level:n},L=this._tree.getRegionStatistics(O,P,E,G,n),k=L.count,V=k?L.xTotal/k:0,B=k?L.yTotal/k:0;if(u.isSome(d)&&d.canDelete){var z=this._attributeStore.removeLocalId(d.objectId);this._deferredDeletionQueue.push(z)}var A=u.isSome(d)&&!d.canDelete&&d.invalid,q=i({cluster_count:k},L.attributes),D=this._attributeStore,Q=A?d.update(V,B,t,q,N):x.create(D,c,V,B,t,q,N);return 0===k&&(Q.geometry.coords[0]=(y+m)/2,Q.geometry.coords[1]=(g+b)/2),this._attributeStore.setAttributeData(Q.localId,Q,this.geometryInfo,null),this._clusters.set(c,Q),this._updateAggregateValueRangeForCluster(Q,Q.tileLevel),Q},t.prototype._updateAggregateValueRangeForCluster=function(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},i=r.minValue,o=r.maxValue;r.minValue=Math.min(i,e.count),r.maxValue=Math.max(o,e.count),this._aggregateValueRanges[t]=r,i===r.minValue&&o===r.maxValue||(this._aggregateValueRangesChanged=!0)},t.prototype._markTileClustersForDeletion=function(e,t){for(var r=2*t,i=Math.ceil(_.TILE_SIZE/r),o=e.key,n=o.row*_.TILE_SIZE,a=Math.floor(o.col*_.TILE_SIZE/r),s=Math.floor(n/r),u=a;u<a+i;u++)for(var l=s;l<s+i;l++)this._markForDeletion(e.key.level,u,l)},t.prototype._setGeohash=function(e){var t=e.geometry;if(t&&t.coords.length){var r=v.project({x:t.coords[0],y:t.coords[1]},this._spatialReference,a.SpatialReference.WGS84);if(!r)return void(s("esri-2d-debug")&&console.debug("Tried to project feature geometry, but got back `null`"));p.setGeohashXY(e,r.y,r.x,12)}},t.prototype._add=function(t){var r=this._featuresById.get(t.objectId);e.prototype._add.call(this,t),u.isSome(this._featureReduction)&&u.isSome(this._tree)&&(r?(t.geohashIndexed=r.geohashIndexed,t.geohashX=r.geohashX,t.geohashY=r.geohashY):this._setGeohash(t),!t.geohashIndexed&&this._attributeStore.isVisible(t)&&this._insertIntoIndex(t))},t.prototype._remove=function(t){return u.isSome(this._featureReduction)&&u.isSome(this._tree)&&this._removeFromIndex(t),e.prototype._remove.call(this,t)},t}(g.default);t.ClusterStore=w}).apply(null,i))||(e.exports=o)},"4/qq":function(e,t,r){var i,o;i=[r.dj.c(e.i),t],void 0===(o=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}).apply(null,i))||(e.exports=o)},"8pdz":function(e,t,r){var i,o;i=[r.dj.c(e.i),t],void 0===(o=(function(e,t){function r(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function i(e){return M[e]}function o(e){return(e[0]+e[1])/2}function n(e,t,r){return e[0]=t,e[1]=r,e}function a(e,t){var r=o(e),i=t,n=!t;e[0]=n*e[0]+i*r,e[1]=n*r+i*e[1]}function s(e,t){var r=t>o(e);return a(e,r),r}function u(e,t){for(var i=n(_,x,w),s=n(S,R,I),u=0;u<t.length;u++){var l=r(t.charCodeAt(u));u%2==0?(a(s,!!(y&l)),a(s,!!(v&l)),a(s,!!(b&l)),a(i,!!(g&l)),a(i,!!(m&l))):(a(i,!!(y&l)),a(i,!!(v&l)),a(i,!!(b&l)),a(s,!!(g&l)),a(s,!!(m&l)))}return e[0]=o(i),e[1]=o(s),e}function l(e,t,r){for(var o="",a=n(_,-90,90),u=n(S,-180,180),l=0;l<r;l++){var c=0;l%2?(c|=s(a,e)<<4,c|=s(u,t)<<3,c|=s(a,e)<<2,c|=s(u,t)<<1,c|=s(a,e)<<0):(c|=s(u,t)<<4,c|=s(a,e)<<3,c|=s(u,t)<<2,c|=s(a,e)<<1,c|=s(u,t)<<0),o+=i(c)}return o}function c(e){var t=Math.floor(5*e/2);return(w-x)/Math.pow(2,t)}function p(e){var t=Math.ceil(5*e/2);return(I-R)/Math.pow(2,t)}function d(e,t){return t?b&e|(v&e)>>1|(y&e)>>2:(m&e)>>1|(g&e)>>2}function h(e,t){return t?(m&e)>>1|(g&e)>>2:b&e|(v&e)>>1|(y&e)>>2}function f(e,t,o){var n=!((e.length-1)%2),a=e.substring(0,e.length-1),s=r(e.charCodeAt(e.length-1)),u=0,l=0,c=0,p=0;n?(u=8,l=4,c=b&s|(v&s)>>1|(y&s)>>2,p=(m&s)>>1|(g&s)>>2):(u=4,l=8,p=b&s|(v&s)>>1|(y&s)>>2,c=(m&s)>>1|(g&s)>>2);var d=c+t,h=p+o,_=Math.floor(d/u),S=Math.floor(h/l),x=i(function(e,t,r){return r?e&b|(t&b)<<1|(e&m)<<1|(t&m)<<2|(e&v)<<2:t&b|(e&b)<<1|(t&m)<<1|(e&m)<<2|(t&v)<<2}(d-_*u,h-S*l,n));return e.length>1&&(_||S)?f(a,_,S)+x:a+x}Object.defineProperty(t,"__esModule",{value:!0});var y=16,g=8,v=4,m=2,b=1,_=new Float64Array(2),S=new Float64Array(2),x=-90,w=90,R=-180,I=180,M="0123456789bcdefghjkmnpqrstuvwxyz";t.decodeBase32Char=r,t.encodeBase32Char=i,t.decodeGeohash=u,t.convertGeohash32ToXY=function(e,t){for(var i=0,o=0,n=30,a=30,s=0;s<t.length;s++){var u=r(t.charCodeAt(s)),l=s%2==0;i|=d(u,l)<<(n-=l?3:2),o|=h(u,l)<<(a-=l?2:3)}return{geohashX:i,geohashY:o}},t.decodeGeohashXY=function(e,t){for(var r=-90,i=90,o=-180,n=180,a=0;a<t;a++){for(var s=Math.ceil((a+1)/2),u=Math.floor((a+1)/2),l=1-a%2,c=30-(3*s+2*u),p=30-(2*s+3*u),d=2*l+3*(1-l),h=(7*l+3*(1-l)<<c&e.geohashX)>>c,f=(3*l+7*(1-l)<<p&e.geohashY)>>p,y=3*l+2*(1-l)-1;y>=0;y--){var g=(o+n)/2,v=h&1<<y?1:0;o=(1-v)*o+v*g,n=(1-v)*g+v*n}for(y=d-1;y>=0;y--){var m=(r+i)/2,b=f&1<<y?1:0;r=(1-b)*r+b*m,i=(1-b)*m+b*i}}return[o,r,n,i]},t.setGeohashXY=function(e,t,r,i){i%2&&(i+=1);for(var o=0,n=0,a=-90,s=90,u=-180,l=180,c=0;c<i/2;c++){for(var p=0;p<5;p++){var d=(u+l)/2,h=r>d?1:0;o|=h<<29-(p+5*c),u=(1-h)*u+h*d,l=(1-h)*d+h*l}for(p=0;p<5;p++){var f=(a+s)/2,y=t>f?1:0;n|=y<<29-(p+5*c),a=(1-y)*a+y*f,s=(1-y)*f+y*s}}e.geohashX=o,e.geohashY=n},t.encodeGeohash=l,t.latDistPerGeohash=c,t.lonDistPerGeohash=p,t.unpackXBits=d,t.unpackYBits=h,t.getRelativeGeohash=f,t.getIntersectingGeohashes=function(e,t,r,i,o){for(var n=Math.abs(r-e),a=Math.abs(i-t),s=c(o),u=p(o),d=Math.ceil(a/u),h=Math.ceil(n/s),y=l(e,t,o),g=new Array,v=0;v<d;v++)for(var m=0;m<h;m++)g.push(f(y,v,m));return g},t.forEachIntersectingGeohash=function(e,t,r,i,o,n){for(var a=Math.abs(r-e),s=Math.abs(i-t),d=c(o),h=p(o),y=Math.ceil(s/h),g=Math.ceil(a/d),v=l(e,t,o),m=0;m<y;m++)for(var b=0;b<g;b++){var _=f(v,m,b),S=u([0,0],_),x=S[0],w=S[1],R=w-h/2,I=x+d/2,M=w+h/2,F=d*h,j=Math.max(e,x-d/2),T=Math.max(t,R),C=Math.min(r,I),O=Math.min(i,M);n(_,Math.abs((C-j)*(O-T))/F)}}}).apply(null,i))||(e.exports=o)},B16N:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r("2Atf"),r("zp6E"),r("LxLY"),r("jfWY"),r("Lzvl"),r("fw2w"),r("G+Sd"),r("J0rm"),r("cGHk"),r("2Kdy")],void 0===(o=(function(e,t,r,i,o,n,a,s,u,l,c){function p(e,t){var r=e.geometry,i=e.toJSON(),o=i;if(r&&(o.geometry=JSON.stringify(r),o.geometryType=a.getJsonType(r),o.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(o.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(o.objectIds=i.objectIds.join(",")),i.orderByFields&&(o.orderByFields=i.orderByFields.join(",")),!i.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete o.outFields:o.outFields=-1!==i.outFields.indexOf("*")?"*":i.outFields.join(","),i.outSR?o.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(o.outSR=o.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(o.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(o.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(o.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.source&&(o.layer=JSON.stringify({source:i.source}),delete i.source),i.timeExtent){var n=i.timeExtent,s=n.start,u=n.end;null==s&&null==u||(o.time=s===u?s:(null==s?"null":s)+","+(null==u?"null":u)),delete i.timeExtent}return o}function d(e,t,a,u,l){void 0===u&&(u={});var d="string"==typeof e?n.urlToObject(e):e,h=t.geometry?[t.geometry]:[];return u.responseType="pbf"===a?"array-buffer":"json",s.normalizeCentralMeridian(h,null,u).then((function(e){var n=e&&e[0];o.isSome(n)&&((t=t.clone()).geometry=n);var s=c.mapParameters(r({},d.query,{f:a},l,p(t,l)));return i(d.path+"/query",r({},u,{query:s}))}))}Object.defineProperty(t,"__esModule",{value:!0});var h,f="Layer does not support extent calculation.";t.queryToQueryStringParameters=p,t.executeQuery=function(e,t,r){return d(e,t,"json",r)},t.executeQueryPBF=function(e,t,r,i){var o=r.useWorker?(null==h&&(h=new l.PBFWorker),h):null;return d(e,t,"pbf",i).then((function(e){var t=function(t){var r=e;return r.data=t,r};return r.useWorker?o.parseFeatureQuery(e.data,r).then((function(e){return t(e)})):t(u.parsePBFFeatureQuery(e.data,r))}))},t.executeQueryForIds=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return d(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(f);if(t.hasOwnProperty("count"))throw new Error(f);return e}))}}).apply(null,i))||(e.exports=o)},Btct:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r("qKT0"),r("Q2wQ"),r("HZ3d"),r("9opi"),r("2Atf"),r("ma1f"),r("7MDj"),r("H1tY"),r("qsST"),r("LxLY"),r("qMld"),r("Vx27"),r("Ytki"),r("ZooB"),r("I90O"),r("hz/Y"),r("lAK8"),r("IpeC"),r("YaB4"),r("lvbU"),r("0SZq"),r("oWCy")],void 0===(o=(function(e,t,r,i,o,n,a,s,u,l,c,p,d,h,f,y,g,v,m,b,_,S,x,w){Object.defineProperty(t,"__esModule",{value:!0});var R=c.getLogger("esri.views.2d.layers.features.controllers.BaseController"),I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._availableFields=[],t._pixelBuffer=0,t.config=null,t.filters=new Array(_.definitions.MAX_FILTERS),t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t}return n(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._initAttributeStore()},t.prototype.startup=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,d.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}}))}))},t.prototype.destroy=function(){this.attributeStore&&this.attributeStore.destroy()},Object.defineProperty(t.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureReduction",{get:function(){return this.config.featureReduction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new g(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){function i(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t||"cim"===t}if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;switch(r.type){case"simple":return i(r.symbol);case"unique-value":return i(r.defaultSymbol)||r.uniqueValueInfos.some((function(e){return i(e.symbol)}));case"class-breaks":return i(r.defaultSymbol)||r.classBreakInfos.some((function(e){return i(e.symbol)}));case"dot-density":return!1;default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnOutline",{get:function(){return function(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return"backgroundFillSymbol"in e&&null!=e.backgroundFillSymbol&&"outline"in e.backgroundFillSymbol&&null!=e.backgroundFillSymbol.outline||t.some((function(e){return"outline"in e&&null!=e.outline}))}(t)}}(this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?v.fromJSON(this.config.renderer):(R.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=this.config.availableFields.filter((function(t){return-1===e._availableFields.indexOf(t)}));return this._availableFields=this._availableFields.concat(t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getAggregate=function(e){return null},t.prototype.getAggregateValueRanges=function(){return{}},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map((function(e){return t.attributeStore.getLocalId(e)})).filter((function(e){return null!=e}))},t.prototype.setViewState=function(e){this._set("viewState",e)},t.prototype.updatePixelBuffer=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,w.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}}))}))},t.prototype.setHighlight=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this.attributeStore.setHighlight(e)]}))}))},t.prototype.validateConfig=function(e){for(var t=0,r=e.filters;t<r.length;t++){var i=r[t];if(p.isSome(i)&&i.where)try{f.validateWhere(this.fieldsIndex,i.where)}catch(e){throw new s("mapview-bad-filter",e.message,{filter:i,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&l("esri-2d-debug")&&console.debug("Feature must have localId"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new S.default({type:"remote",initialize:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r})},render:function(){return e.remoteClient.invoke("tileRenderer.featuresView.requestRender")}})},t.prototype._createQueryEngine=function(e){return new y.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore()),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(){return new x.ClusterStore({geometryType:this.service.geometryType,hasM:!1,hasZ:!1},this.spatialReference,this.attributeStore,this.featureReduction)},t.prototype._createDefaultQuery=function(e){var t=new b,r=e.outFields,i=this.config,o=i.historicMoment,n=i.definitionExpression;return r=r.length/this.service.fields.length>=.75?["*"]:r,t.gdbVersion=i.gdbVersion,t.historicMoment=null!=o?new Date(o):null,t.num=e.num,t.outFields=r,t.outSpatialReference=this.spatialReference,t.returnGeometry=e.returnGeometry,t.returnCentroid=e.returnCentroid,t.start=e.resultOffset,t.where=n||"1=1",t},t.prototype._createQuery=function(e,t,r,i,o,n){var a=this.service.geometryType,s=this._createDefaultQuery(i);return s.maxRecordCountFactor=o,s.returnExceededLimitFeatures=n,s.resultType="tile",s.geometry=e,this.service.capabilities.query.supportsQuantization?(s.quantizationParameters=new m.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:t}),"esriGeometryPolyline"===a&&(s.maxAllowableOffset=r)):"esriGeometryPolyline"!==a&&"esriGeometryPolygon"!==a||(s.maxAllowableOffset=r),s},t.prototype.hasGeometryFilter=function(){return this.filters.some((function(e){return p.isSome(e)&&!!e.geometry}))},r([h.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],t.prototype,"arcadeInfo",null),r([h.property()],t.prototype,"config",void 0),r([h.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"featureReduction",null),r([h.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r([h.property()],t.prototype,"filters",void 0),r([h.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"geometryInfo",null),r([h.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"returnCentroid",null),r([h.property({readOnly:!0,dependsOn:["service","config"]})],t.prototype,"returnOutline",null),r([h.property({readOnly:!0,dependsOn:["config","availableFields"]})],t.prototype,"queryInfo",null),r([h.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r([h.property()],t.prototype,"processor",void 0),r([h.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"availableFields",null),r([h.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r([h.property({constructOnly:!0})],t.prototype,"service",void 0),r([h.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r([h.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r([h.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r([h.property({readOnly:!0})],t.prototype,"viewState",void 0),r([h.property({readOnly:!0,dependsOn:["viewState"]})],t.prototype,"viewParams",null),r([h.subclass("esri.views.2d.layers.features.controllers.BaseController")],t)}(h.declared(u.HandleOwner));t.default=I}).apply(null,i))||(e.exports=o)},IpeC:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("TMur"),r("TMur"),r("+AWJ"),r("9gfz"),r("ImIS"),r("ycL1"),r("rg9i"),r("Vx27"),r("1dvD"),r("Lzvl"),r("HqJa"),r("lAK8"),r("aZmZ")],void 0===(o=(function(e,t,r,i,o,n,a,s,u,l,c,p,d,h,f,y,g){var v=new u.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),m=new u.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(e){function t(t){var r=e.call(this,t)||this;return r.cacheHint=!1,r.datumTransformation=null,r.distance=void 0,r.gdbVersion=null,r.geometry=null,r.geometryPrecision=void 0,r.groupByFieldsForStatistics=null,r.having=null,r.historicMoment=null,r.maxAllowableOffset=void 0,r.maxRecordCountFactor=1,r.multipatchOption=null,r.num=void 0,r.objectIds=null,r.orderByFields=null,r.outFields=null,r.outSpatialReference=null,r.outStatistics=null,r.parameterValues=null,r.pixelSize=null,r.quantizationParameters=null,r.rangeValues=null,r.relationParameter=null,r.resultType=null,r.returnCentroid=!1,r.returnDistinctValues=!1,r.returnExceededLimitFeatures=!0,r.returnGeometry=!1,r.returnQueryGeometry=!1,r.returnM=void 0,r.returnZ=void 0,r.source=null,r.spatialRelationship="intersects",r.start=void 0,r.sqlFormat=null,r.text=null,r.timeExtent=null,r.units=null,r.where=null,r}var u;return r(t,e),u=t,t.from=function(e){return d.ensureClass(u,e)},t.prototype.castDatumTransformation=function(e){return"number"==typeof e||"object"==typeof e?e:null},t.prototype.writeHistoricMoment=function(e,t){t.historicMoment=e&&e.getTime()},t.prototype.writeParameterValues=function(e,t){if(e){var r={};for(var i in e){var o=e[i];r[i]=Array.isArray(o)?o.map((function(e){return e instanceof Date?e.getTime():e})):o instanceof Date?o.getTime():o}t.parameterValues=r}},t.prototype.writeStart=function(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"},t.prototype.writeWhere=function(e,t){t.where=e||"1=1"},t.prototype.clone=function(){return new u(c.clone({cacheHint:this.cacheHint,datumTransformation:this.datumTransformation,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,source:this.source,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,units:this.units,where:this.where}))},t.MAX_MAX_RECORD_COUNT_FACTOR=5,i([p.property({type:Boolean,json:{write:!0,default:!1}})],t.prototype,"cacheHint",void 0),i([p.property({json:{write:!0}})],t.prototype,"datumTransformation",void 0),i([p.cast("datumTransformation")],t.prototype,"castDatumTransformation",null),i([p.property({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],t.prototype,"distance",void 0),i([p.property({type:String,json:{write:!0}})],t.prototype,"gdbVersion",void 0),i([p.property({types:n.geometryTypes,json:{read:h.fromJSON,write:!0}})],t.prototype,"geometry",void 0),i([p.property({type:Number,json:{write:!0}})],t.prototype,"geometryPrecision",void 0),i([p.property({type:[String],json:{write:!0}})],t.prototype,"groupByFieldsForStatistics",void 0),i([p.property({type:String,json:{write:!0}})],t.prototype,"having",void 0),i([p.property({type:Date})],t.prototype,"historicMoment",void 0),i([p.writer("historicMoment")],t.prototype,"writeHistoricMoment",null),i([p.property({type:Number,json:{write:!0}})],t.prototype,"maxAllowableOffset",void 0),i([p.property({type:Number,cast:function(e){return e<1?1:e>u.MAX_MAX_RECORD_COUNT_FACTOR?u.MAX_MAX_RECORD_COUNT_FACTOR:e},json:{write:{overridePolicy:function(e){return{enabled:e>1}}}}})],t.prototype,"maxRecordCountFactor",void 0),i([p.property({type:String,json:{write:!0}})],t.prototype,"multipatchOption",void 0),i([p.property({type:Number,json:{read:{source:"resultRecordCount"}}})],t.prototype,"num",void 0),i([p.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),i([p.property({type:[String],json:{write:!0}})],t.prototype,"orderByFields",void 0),i([p.property({type:[String],json:{write:!0}})],t.prototype,"outFields",void 0),i([p.property({type:o.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],t.prototype,"outSpatialReference",void 0),i([p.property({type:[g],json:{write:!0}})],t.prototype,"outStatistics",void 0),i([p.property({json:{write:!0}})],t.prototype,"parameterValues",void 0),i([p.writer("parameterValues")],t.prototype,"writeParameterValues",null),i([p.property({types:a.symbolTypes,json:{read:f.read,write:!0}})],t.prototype,"pixelSize",void 0),i([p.property({type:y.default,json:{write:!0}})],t.prototype,"quantizationParameters",void 0),i([p.property({type:[Object],json:{write:!0}})],t.prototype,"rangeValues",void 0),i([p.property({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy:function(){return{enabled:"relation"===this.spatialRelationship}}}}})],t.prototype,"relationParameter",void 0),i([p.property({type:String,json:{write:!0}})],t.prototype,"resultType",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnCentroid",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnDistinctValues",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:!e}}}}})],t.prototype,"returnExceededLimitFeatures",void 0),i([p.property({type:Boolean,json:{write:!0}})],t.prototype,"returnGeometry",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnQueryGeometry",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnM",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnZ",void 0),i([p.property({json:{write:!0}})],t.prototype,"source",void 0),i([p.property({type:String,json:{read:{source:"spatialRel",reader:v.read},write:{target:"spatialRel",writer:v.write}}})],t.prototype,"spatialRelationship",void 0),i([p.property({type:Number,json:{read:{source:"resultOffset"}}})],t.prototype,"start",void 0),i([p.writer("start"),p.writer("num")],t.prototype,"writeStart",null),i([p.property({type:String,json:{write:!0}})],t.prototype,"sqlFormat",void 0),i([p.property({type:String,json:{write:!0}})],t.prototype,"text",void 0),i([p.property({type:s,json:{write:!0}})],t.prototype,"timeExtent",void 0),i([p.property({type:String,json:{read:m.read,write:{writer:m.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],t.prototype,"units",void 0),i([p.property({type:String,json:{write:{overridePolicy:function(e){return{enabled:null!=e||this.start>0}}}}})],t.prototype,"where",void 0),i([p.writer("where")],t.prototype,"writeWhere",null),u=i([p.subclass("esri.tasks.support.Query")],t)}(p.declared(l.JSONSupport))}).apply(null,i))||(e.exports=o)},JOu6:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r("zIqJ"),r("LxLY"),r("8pdz")],void 0===(o=(function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._pool=new r.default(8024),this._nodes=0,this._root=new a(0,0,0),this._fields=e}return e.prototype._acquire=function(e,t,r){var o=this._pool.dequeue();return this._nodes++,i.isSome(o)?o.realloc(e,t,r):new a(e,t,r)},e.prototype._release=function(e){this._nodes--,this._pool.enqueue(e)},Object.defineProperty(e.prototype,"count",{get:function(){return this._root.count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"poolSize",{get:function(){return this._pool.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){var e=0;return this._forEachNode((function(t){return e=Math.max(e,t.depth)})),e},enumerable:!0,configurable:!0}),e.prototype.dropLevels=function(e){var t=this;this._forEachNode((function(r){if(r.depth>=e)for(var i=0;i<r.children.length;i++){var o=r.children[i];r.children[i]=null,o&&t._release(o)}}))},e.prototype.insert=function(e,t,r){void 0===r&&(r=0);for(var i=this._root,o=0,n=0,a=0;null!==i;){if(i.depth>=r&&(i.count+=1,i.xTotal+=e.geometry.coords[0],i.yTotal+=e.geometry.coords[1],i.xGeohashTotal+=e.geohashX,i.yGeohashTotal+=e.geohashY,this._updateStatistics(e,i,1)),o>=t)return;var s=Math.ceil((o+1)/2),u=Math.floor((o+1)/2),l=1-o%2,c=30-(3*s+2*u),p=30-(2*s+3*u),d=(e.geohashX&7*l+3*(1-l)<<c)>>c,h=(e.geohashY&3*l+7*(1-l)<<p)>>p,f=d+h*(8*l+4*(1-l));n=n<<3*l+2*(1-l)|d,a=a<<2*l+3*(1-l)|h,null==i.children[f]&&(i.children[f]=this._acquire(n,a,o+1)),o+=1,i=i.children[f]}},e.prototype.remove=function(e,t){for(var r=this._root,i=0;null!==r;){if(r.count-=1,r.xTotal-=e.geometry.coords[0],r.yTotal-=e.geometry.coords[1],r.xGeohashTotal-=e.geohashX,r.yGeohashTotal-=e.geohashY,this._updateStatistics(e,r,-1),i>=t)return;var o=Math.ceil((i+1)/2),n=Math.floor((i+1)/2),a=1-i%2,s=30-(3*o+2*n),u=30-(2*o+3*n),l=((e.geohashX&7*a+3*(1-a)<<s)>>s)+((e.geohashY&3*a+7*(1-a)<<u)>>u)*(8*a+4*(1-a)),c=r.children[l];1===c.count&&(this._release(c),r.children[l]=null),i+=1,r=c}},e.prototype.find=function(e,t,r){return this._root.find(e,t,r,0,0,0)},e.prototype.findSingleOccupancyNode=function(e,t,r,i,o){for(var n=this._root;null!==n;){var a=n.depth,s=n.xNode,u=n.yNode,l=1-a%2,c=n.xGeohashTotal/n.count,p=n.yGeohashTotal/n.count;if(1===n.count&&e<c&&c<=r&&t<p&&p<=i)return n;if(a>=o)n=n.next;else{for(var d=Math.ceil((a+1)/2),h=Math.floor((a+1)/2),f=30-(3*d+2*h),y=30-(2*d+3*h),g=~((1<<f)-1),v=~((1<<y)-1),m=(t&v)>>y,b=(r&g)>>f,_=(i&v)>>y,S=s<<3*l+2*(1-l),x=u<<2*l+3*(1-l),w=S+8*l+4*(1-l),R=x+4*l+8*(1-l),I=Math.max(S,(e&g)>>f),M=Math.max(x,m),F=Math.min(w,b),j=Math.min(R,_),T=null,C=null,O=M;O<=j;O++)for(var P=I;P<=F;P++){var E=n.children[P-S+(O-x)*(8*l+4*(1-l))];E&&(T||((T=E).next=n.next),C&&(C.next=E),C=E,E.next=n.next)}n=T||n.next}}return null},e.prototype.getRegionStatistics=function(e,t,r,i,o){for(var n=this._root,a=0,s=0,u=0,l={};null!==n;){var c=n.depth,p=n.xNode,d=n.yNode;if(c>=o){var h=n.yGeohashTotal/n.count;e<(k=n.xGeohashTotal/n.count)&&k<=r&&t<h&&h<=i&&(a+=n.count,s+=n.xTotal,u+=n.yTotal,this._aggregateStatistics(l,n.statistics)),n=n.next}else{for(var f=Math.ceil((c+1)/2),y=Math.floor((c+1)/2),g=1-c%2,v=30-(3*f+2*y),m=30-(2*f+3*y),b=~((1<<v)-1),_=~((1<<m)-1),S=(t&_)>>m,x=(r&b)>>v,w=(i&_)>>m,R=p<<3*g+2*(1-g),I=d<<2*g+3*(1-g),M=R+8*g+4*(1-g),F=I+4*g+8*(1-g),j=Math.max(R,(e&b)>>v),T=Math.max(I,S),C=Math.min(M,x),O=Math.min(F,w),P=null,E=null,G=T;G<=O;G++)for(var N=j;N<=C;N++){var L=n.children[N-R+(G-I)*(8*g+4*(1-g))];if(L){if(G!==T&&G!==O&&N!==j&&N!==C){var k;h=L.yGeohashTotal/L.count,e<(k=L.xGeohashTotal/L.count)&&k<=r&&t<h&&h<=i&&(a+=L.count,s+=L.xTotal,u+=L.yTotal,this._aggregateStatistics(l,L.statistics));continue}P||((P=L).next=n.next),E&&(E.next=L),E=L,L.next=n.next}}n=P||n.next}}return{count:a,attributes:this._normalizeStatistics(l,a),xTotal:s,yTotal:u}},e.prototype._forEachNode=function(e){for(var t=this._root;null!==t;){var r=this._linkChildren(t)||t.next;e(t),t=r}},e.prototype._linkChildren=function(e){for(var t=null,r=null,i=0;i<=e.children.length;i++){var o=e.children[i];o&&(t||((t=o).next=e.next),r&&(r.next=o),r=o,o.next=e.next)}return t},e.prototype._updateStatistics=function(e,t,r){for(var i=0,o=this._fields;i<o.length;i++){var n=o[i],a=n.name,s=e.attributes[n.outStatistic.onStatisticField];switch(n.outStatistic.statisticType){case"norm":t.statistics[a]||(t.statistics[a]={});var u=e.attributes[n.outStatistic.onStatisticNormalizationField],l=t.statistics[a].onStatisticField||0,c=t.statistics[a].onStatisticNormalizationField||0;null==s||isNaN(s)||null==u||0===u||isNaN(u)||(t.statistics[a].onStatisticField=l+r*s,t.statistics[a].onStatisticNormalizationField=c+r*u);break;case"avg":t.statistics[a]||(t.statistics[a]={value:0,nanCount:0});var p=t.statistics[a].value,d=t.statistics[a].nanCount;null==s||isNaN(s)?t.statistics[a].nanCount=d+r:t.statistics[a].value=p+r*s;break;case"avg_angle":t.statistics[a]||(t.statistics[a]={x:0,y:0,nanCount:0});var h=t.statistics[a].x,f=t.statistics[a].y,y=(d=t.statistics[a].nanCount,Math.PI/180);null==s||isNaN(s)?t.statistics[a].nanCount=d+r:(t.statistics[a].x=h+r*Math.cos(s*y),t.statistics[a].y=f+r*Math.sin(s*y));break;case"mode":t.statistics[a]||(t.statistics[a]={}),t.statistics[a][s]=(p=t.statistics[a][s]||0)+r}}},e.prototype._aggregateStatistics=function(e,t){for(var r=0,i=this._fields;r<i.length;r++){var o=i[r],n=o.name;switch(o.outStatistic.statisticType){case"avg":case"avg_angle":case"mode":case"norm":for(var a in e[n]||(e[n]={}),t[n])e[n][a]=(e[n][a]||0)+t[n][a]}}},e.prototype._normalizeStatistics=function(e,t){for(var r={},i=0,o=this._fields;i<o.length;i++){var n=o[i],a=n.name;switch(n.outStatistic.statisticType){case"norm":var s=e[a];if(t&&null==s.onStatisticNormalizationField)break;if(t&&s.onStatisticNormalizationField){r[a]=s.onStatisticField/s.onStatisticNormalizationField;break}r[a]=0;break;case"avg":if(!t)break;var u=e[a],l=u.value;if(!(t-(c=u.nanCount)))break;r[a]=l/(t-c);break;case"avg_angle":if(!t)break;var c,p=e[a],d=p.x,h=p.y;if(!(t-(c=p.nanCount)))break;var f=180/Math.PI,y=Math.atan2(h/(t-c),d/(t-c))*f;r[a]=y;break;case"mode":var g=e[a],v=0,m=null;for(var b in g){var _=g[b];_>v&&(v=_,m=b)}r[a]="null"===m?null:m}}return r},e}();t.GeohashTree=n;var a=function(){function e(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var i=0;i<this.children.length;i++)this.children[i]=null;this.xNode=e,this.yNode=t,this.depth=r}return e.prototype.realloc=function(e,t,r){for(var i=0;i<this.children.length;i++)this.children[i]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this},e.prototype.getLngLatBounds=function(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2);return o.decodeGeohashXY({geohashX:this.xNode<<30-(3*t+2*r),geohashY:this.yNode<<30-(2*t+3*r)},this.depth)},e.prototype.find=function(e,t,r,i,o,n){if(i>=r)return this;var a=1-i%2,s=3*a+2*(1-a),u=2*a+3*(1-a),l=30-o-s,c=30-n-u,p=this.children[((e&7*a+3*(1-a)<<l)>>l)+((t&3*a+7*(1-a)<<c)>>c)*(8*a+4*(1-a))];return null==p?null:p.find(e,t,r,i+1,o+s,n+u)},e}()}).apply(null,i))||(e.exports=o)},aZmZ:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("ycL1"),r("Vx27")],void 0===(o=(function(e,t,r,i,o,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.maxPointCount=void 0,r.maxRecordCount=void 0,r.maxVertexCount=void 0,r.onStatisticField=null,r.outStatisticFieldName=null,r.statisticType=null,r}var o;return r(t,e),o=t,t.prototype.clone=function(){return new o({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType})},i([n.property({type:Number,json:{write:!0}})],t.prototype,"maxPointCount",void 0),i([n.property({type:Number,json:{write:!0}})],t.prototype,"maxRecordCount",void 0),i([n.property({type:Number,json:{write:!0}})],t.prototype,"maxVertexCount",void 0),i([n.property({type:String,json:{write:!0}})],t.prototype,"onStatisticField",void 0),i([n.property({type:String,json:{write:!0}})],t.prototype,"outStatisticFieldName",void 0),i([n.property({type:String,json:{write:!0}})],t.prototype,"statisticType",void 0),o=i([n.subclass("esri.tasks.support.StatisticDefinition")],t)}(n.declared(o.JSONSupport))}).apply(null,i))||(e.exports=o)},cGHk:function(e,t,r){var i,o;i=[r.dj.c(e.i),t],void 0===(o=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var i in t)if("declaredClass"!==i){var o=t[i];if(null!=o&&"function"!=typeof o)if(Array.isArray(o)){r[i]=[];for(var n=0;n<o.length;n++)r[i][n]=e(o[n])}else"object"==typeof o?o.toJSON&&(r[i]=JSON.stringify(o)):r[i]=o}return r}}).apply(null,i))||(e.exports=o)},oWCy:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r("Q2wQ"),r("HZ3d"),r("qMld"),r("jBNx"),r("YaB4"),r("wjMf")],void 0===(o=(function(e,t,r,i,o,n,a,s){function u(e,t){return null==e?t:e}function l(e,t){return null==e.outline?t:u(e.outline.width,t)}function c(e,t){return i(this,void 0,void 0,(function(){var i,o,n,p,h,f,b,_,S,x,w;return r(this,(function(r){switch(r.label){case 0:return"simple-marker"===e.type?(i=Math.max(u(e.size,12),t),[2,d(e)+i*y]):"picture-marker"===e.type?(o=Math.max(u(e.height,12),t),n=u(e.width,12)*(o/u(e.height,12)),p=n/2,h=o/2,[2,d(e)+Math.sqrt(p*p+h*h)]):"text"===e.type?(s.getTextSymbolEstimatedSize(g,e,a.definitions.AVERAGE_GLYPH_MOSAIC_ITEM),f=g[2]*(u(e.horizontalAlignment,"top")in v?1:.5),b=g[3]*(u(e.horizontalAlignment,"center")in m?1:.5),_=function(e,t){return null==e.font?9:u(e.font.size,9)}(e),S=Math.max(_,t)/_,[2,d(e)+Math.sqrt(f*f+b*b)*S]):"simple-line"===e.type?[2,Math.max(u(e.width,.75),t)/2]:"simple-fill"===e.type||"picture-fill"===e.type?[2,Math.max(l(e,0),t)/2]:"cim"===e.type?(x=a.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(x.width*x.width+x.height*x.height)]:[2,0]:"web-style"!==e.type?[3,2]:(w=c,[4,e.fetchCIMSymbol()]);case 1:return[2,w.apply(void 0,[r.sent(),t])];case 2:return[2,0]}}))}))}function p(e,t){return i(this,void 0,void 0,(function(){var i,o;return r(this,(function(r){switch(r.label){case 0:return function(e){return e.type in f}(e)?(o=(i=Math).min,[4,c(e,t)]):[2,0];case 1:return[2,o.apply(i,[r.sent(),75])]}}))}))}function d(e){var t=u(e.xoffset,0),r=u(e.yoffset,0);return Math.sqrt(t*t+r*r)}function h(e,t){return Math.max(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var f={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1},y=.707;t.computePxBuffer=function(e,t){return i(this,void 0,void 0,(function(){var i,a,s,u,l,c;return r(this,(function(r){switch(r.label){case 0:if("heatmap"===e.type)return[2,Math.round(3*e.blurRadius)];if("dot-density"===e.type)return[2,0];if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?[2,100]:[2,50];for(i=e.getSymbols(),a=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map((function(e){return e.size})).reduce(h,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((function(e){return e.size})).reduce(h,0):"real-world-size"===r.transformationType?30:void 0}(e),s=[],u=0,l=i;u<l.length;u++)s.push(p(l[u],a));return[4,o.all(s)];case 1:return c=r.sent(),[2,n.pt2px(c.reduce(h,0))]}}))}))};var g=[0,0,0,0],v={left:1,right:1},m={top:1,bottom:1,baseline:1}}).apply(null,i))||(e.exports=o)}}]);