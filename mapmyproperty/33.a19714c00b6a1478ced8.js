(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/support/TilemapCache":"Cobz","esri/layers/mixins/ArcGISCachedService":"WhPF","esri/layers/support/serviceTileInfoProperty":"ddAr","esri/layers/support/Tilemap":"xojL"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[33,84],{Cobz:function(e,t,i){var r,a;r=[i.dj.c(e.i),t,i("2Atf"),i("9opi"),i("qKT0"),i("Q2wQ"),i("HZ3d"),i("zp6E"),i("Gtr7"),i("ma1f"),i("eIBl"),i("qsST"),i("W6K4"),i("KBgh"),i("qMld"),i("afW+"),i("jfWY"),i("8MXS"),i("Vx27"),i("xojL")],void 0===(a=(function(e,t,i,r,a,l,n,o,s,p,c,u,h,f,v,d,y,m,b,w){Object.defineProperty(t,"__esModule",{value:!0}),t.TILEMAP_SIZE_EXP=5;var _=u.getLogger("esri.layers.support.TilemapCache"),g=function(e){function s(t){var i=e.call(this,t)||this;return i._handles=new c,i._pendingTilemapRequests={},i._availableLevels={},i.levels=5,i.cacheByteSize=2097152,i.request=o,i._prefetchingEnabled=!0,i}var u;return r(s,e),u=s,s.prototype.initialize=function(){var e=this;this._tilemapCache=new h(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(function(){return e._initializeTilemapDefinition()})),m.init(this,"layer.tileInfo.lods",(function(t){return e._initializeAvailableLevels(t)}),!0)]),this._initializeTilemapDefinition()},s.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},s.prototype.castLevels=function(e){return e<=2?(_.error("Minimum levels for Tilemap is 3, but got ",e),3):e},Object.defineProperty(s.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0}),s.prototype.fetchTilemap=function(e,t,r,a){var l=this;if(!this._availableLevels[e])return v.reject(new p("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"));var n=this._tmpTilemapDefinition,o=this._tilemapFromCache(e,t,r,n);if(o)return v.resolve(o);var s=a&&a.signal;return a=i({},a,{signal:null}),v.create((function(e,t){v.onAbort(s,(function(){return t(v.createAbortError())}));var i=w.tilemapDefinitionId(n),r=l._pendingTilemapRequests[i];if(!r){r=w.Tilemap.fromDefinition(n,a).then((function(e){return l._tilemapCache.put(i,e,e.byteSize),e}));var o=function(){return delete l._pendingTilemapRequests[i]};l._pendingTilemapRequests[i]=r,r.then(o,o)}r.then(e,t)}))},s.prototype.getAvailability=function(e,t,i){if(!this._availableLevels[e])return"unavailable";var r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"},s.prototype.getAvailabilityUpsample=function(e,t,i,r){r.level=e,r.row=t,r.col=i;var a=this.layer.tileInfo;for(a.updateTileInfo(r);;){var l=this.getAvailability(r.level,r.row,r.col);if("unavailable"!==l)return l;if(!a.upsampleTile(r))return"unavailable"}},s.prototype.fetchAvailability=function(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch((function(e){return e})).then((function(r){if(r instanceof w.Tilemap){var a=r.getAvailability(t,i);return"unavailable"===a?v.reject(new p("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):a}if(v.isAbortError(r))throw r;return"unknown"})):v.reject(new p("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"))},s.prototype.fetchAvailabilityUpsample=function(e,t,i,r,a){var l=this;r.level=e,r.row=t,r.col=i;var n=this.layer.tileInfo;n.updateTileInfo(r);var o=this.fetchAvailability(e,t,i,a).catch((function(e){if(v.isAbortError(e))throw e;if(n.upsampleTile(r))return l.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e}));return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,a,o),o},s.prototype._fetchAvailabilityUpsamplePrefetch=function(e,t,r,a,o,s){return n(this,void 0,void 0,(function(){var n,p,c,h,f,y,m,b,w;return l(this,(function(l){switch(l.label){case 0:if(!this._prefetchingEnabled)return[2];if(this._handles.has(n="prefetch-"+e))return[2];p=v.createAbortController(),s.then((function(){return p.abort()}),(function(){return p.abort()})),c=!1,this._handles.add({remove:function(){c||(c=!0,p.abort())}},n),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,d.waitTicks(10,p.signal)];case 2:case 3:return l.sent(),[3,4];case 4:if(c||(c=!0,this._handles.remove(n)),v.isAborted(p))return[2];for(h={id:e,level:t,row:r,col:a},f=i({},o,{signal:p.signal}),y=this.layer.tileInfo,m=function(e){var t=b.fetchAvailability(h.level,h.row,h.col,f);u._prefetches.push(t);var i=function(){u._prefetches.removeUnordered(t)};t.then(i,i)},b=this,w=0;u._prefetches.length<u._maxPrefetch&&y.upsampleTile(h);++w)m();return[2]}}))}))},s.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?y.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}},s.prototype._tilemapFromCache=function(e,t,i,r){var a=this._getTilemapDefinition(e,t,i,r),l=w.tilemapDefinitionId(a);return this._tilemapCache.get(l)},s.prototype._getTilemapDefinition=function(e,i,r,a){a.level=e;var l=e>t.TILEMAP_SIZE_EXP;return a.row=l?i-i%this.size:i,a.col=l?r-r%this.size:r,a},s.prototype._initializeAvailableLevels=function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))},Object.defineProperty(s.prototype,"test",{get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,i,r){return!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0}),s._maxPrefetch=4,s._prefetches=new f({initialSize:u._maxPrefetch}),a([b.property({constructOnly:!0,type:Number})],s.prototype,"levels",void 0),a([b.cast("levels")],s.prototype,"castLevels",null),a([b.property({readOnly:!0,dependsOn:["levels"],type:Number})],s.prototype,"size",null),a([b.property({constructOnly:!0,type:Number})],s.prototype,"cacheByteSize",void 0),a([b.property({constructOnly:!0})],s.prototype,"layer",void 0),a([b.property({constructOnly:!0})],s.prototype,"request",void 0),u=a([b.subclass("esri.layers.support.TilemapCache")],s)}(b.declared(s));t.TilemapCache=g}).apply(null,r))||(e.exports=a)},WhPF:function(e,t,i){var r,a;r=[i.dj.c(e.i),t,i("2Atf"),i("9opi"),i("qKT0"),i("TMur"),i("Vx27"),i("ddAr"),i("Cobz")],void 0===(a=(function(e,t,i,r,a,l,n,o,s){Object.defineProperty(t,"__esModule",{value:!0}),t.ArcGISCachedService=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.copyright=null,t.minScale=0,t.maxScale=0,t.spatialReference=null,t.tileInfo=null,t.tilemapCache=null,t}return r(t,e),t.prototype.readMinScale=function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0},t.prototype.readMaxScale=function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0},Object.defineProperty(t.prototype,"supportsBlankTile",{get:function(){return this.version>=10.2},enumerable:!0,configurable:!0}),t.prototype.readTilemapCache=function(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new s.TilemapCache({layer:this}):null},a([n.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),a([n.property()],t.prototype,"minScale",void 0),a([n.reader("service","minScale")],t.prototype,"readMinScale",null),a([n.property()],t.prototype,"maxScale",void 0),a([n.reader("service","maxScale")],t.prototype,"readMaxScale",null),a([n.property({type:l.SpatialReference})],t.prototype,"spatialReference",void 0),a([n.property({readOnly:!0,dependsOn:["version"]})],t.prototype,"supportsBlankTile",null),a([n.property(o.serviceTileInfoProperty)],t.prototype,"tileInfo",void 0),a([n.property()],t.prototype,"tilemapCache",void 0),a([n.reader("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),a([n.property()],t.prototype,"version",void 0),a([n.subclass("esri.layers.mixins.ArcGISCachedService")],t)}(n.declared(e))}}).apply(null,r))||(e.exports=a)},ddAr:function(e,t,i){var r,a;r=[i.dj.c(e.i),t,i("2Atf"),i("pMLx")],void 0===(a=(function(e,t,i,r){function a(e,t,a,l){if(!e)return null;var n=t.minScale,o=t.maxScale,s=t.minLOD,p=t.maxLOD;if(null!=s&&null!=p)return r.fromJSON(l&&l.ignoreMinMaxLOD?e:i({},e,{lods:e.lods.filter((function(e){var t=e.level;return null!=t&&t>=s&&t<=p}))}));if(0!==n&&0!==o){var c=function(e){return Math.round(1e4*e)/1e4},u=n?c(n):1/0,h=o?c(o):-1/0;return r.fromJSON(i({},e,{lods:e.lods.filter((function(e){var t=c(e.scale);return t<=u&&t>=h}))}))}return r.fromJSON(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.serviceTileInfoProperty={type:r,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:a}}}}},t.readServiceTileInfo=a}).apply(null,r))||(e.exports=a)},xojL:function(e,t,i){var r,a;r=[i.dj.c(e.i),t,i("2Atf"),i("zp6E"),i("KY0m"),i("ma1f"),i("rg9i")],void 0===(a=(function(e,t,i,r,a,l,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return e.prototype.getAvailability=function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i>>3,a=this._tileAvailabilityBitSet;return r<0||r>a.length?"unknown":a[r]&1<<i%8?"available":"unavailable"},e.prototype._updateFromData=function(e){for(var t=!0,i=!0,r=Math.ceil(this.location.width*this.location.height/8),a=new Uint8Array(r),l=0,n=0;n<e.length;n++){var o=n%8;e[n]?(i=!1,a[l]|=1<<o):t=!1,7===o&&++l}i?this._allAvailability="unavailable":t?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=a,this.byteSize+=a.length)},e.fromDefinition=function(t,n){var o=t.service.request||r,p=t.row,c=t.col,u=t.width,h=t.height,f={query:{f:"json"}};return n=n?i({},f,n):f,o(s(t),n).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:p,left:c,width:u,height:h},valid:!0,data:a.constant(u*h,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==p||t.location.left!==c||t.location.width!==u||t.location.height!==h))throw new l("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:p,left:c,width:u,height:h}});return e.fromJSON(t)}))},e.fromJSON=function(t){e.validateJSON(t);var i=new e;return i.location=Object.freeze(n.clone(t.location)),i._updateFromData(t.data),Object.freeze(i)},e.validateJSON=function(e){if(!e||!e.location)throw new l("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new l("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new l("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new l("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new l("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();function s(e){var t;if("vector-tile"===e.service.type)t=e.service.url+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height;else{var i=e.service.tileServers;t=(i&&i.length?i[e.row%i.length]:e.service.url)+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height}var r=e.service.query;return r&&(t=t+"?"+r),t}t.Tilemap=o,t.tilemapDefinitionId=function(e){return e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height},t.tilemapDefinitionUrl=s,t.default=o}).apply(null,r))||(e.exports=a)}}]);