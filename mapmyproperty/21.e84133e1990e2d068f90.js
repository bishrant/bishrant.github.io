(function(){(this||window).webpackJsonp.registerAbsMids({"arcgis-js-api/layers/mixins/ArcGISService":"2fnV","esri/layers/mixins/ArcGISService":"2fnV","arcgis-js-api/core/requireUtils":"ADZV","esri/core/requireUtils":"ADZV","arcgis-js-api/layers/support/TilemapCache":"Cobz","esri/layers/ElevationLayer":"GAgw","arcgis-js-api/layers/ElevationLayer":"GAgw","esri/layers/mixins/PortalLayer":"QJ8R","arcgis-js-api/layers/mixins/PortalLayer":"QJ8R","arcgis-js-api/layers/support/LercWorker":"S+mV","esri/layers/support/LercWorker":"S+mV","arcgis-js-api/core/LRUCache":"W6K4","esri/core/LRUCache":"W6K4","arcgis-js-api/layers/mixins/ArcGISCachedService":"WhPF","arcgis-js-api/layers/support/serviceTileInfoProperty":"ddAr","arcgis-js-api/core/MemCache":"r7jh","esri/core/MemCache":"r7jh","arcgis-js-api/layers/support/Tilemap":"xojL"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[21,44,101,115],{"2fnV":function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("9opi"),i("qKT0"),i("qsST"),i("Vx27"),i("8CIp")],void 0===(n=(function(e,t,i,r,n,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=n.getLogger("esri.layers.mixins.ArcGISService");t.ArcGISService=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"title",{get:function(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){var e=a.parse(this.url);if(e&&e.title)return e.title}return this._get("title")||""},set:function(e){this._set("title",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{set:function(e){this._set("url",a.sanitizeUrl(e,s))},enumerable:!0,configurable:!0}),r([o.property({dependsOn:["url"]})],t.prototype,"title",null),r([o.property({type:String})],t.prototype,"url",null),r([o.subclass("esri.layers.mixins.ArcGISService")],t)}(o.declared(e))}}).apply(null,r))||(e.exports=n)},ADZV:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("7bfM"),i("qsST"),i("qMld")],void 0===(n=(function(e,t,i,r,n){Object.defineProperty(t,"__esModule",{value:!0});var o=r.getLogger("esri.core.requireUtils");t.when=function e(t,r){return i.deprecatedFunction(o,"when",{moduleName:"requireUtils",replacement:"Use `promiseUtils.create()` instead.",version:"4.10",warnOnce:!0}),Array.isArray(r)?n.create((function(e){t(r,(function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];e(t)}))})):e(t,[r]).then((function(e){return e[0]}))},t.getAbsMid=function(e,t,i){return t.toAbsMid?t.toAbsMid(e):i.id.replace(/\/[^\/]*$/gi,"/")+e}}).apply(null,r))||(e.exports=n)},Cobz:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("2Atf"),i("9opi"),i("qKT0"),i("Q2wQ"),i("HZ3d"),i("zp6E"),i("Gtr7"),i("ma1f"),i("eIBl"),i("qsST"),i("W6K4"),i("KBgh"),i("qMld"),i("afW+"),i("jfWY"),i("8MXS"),i("Vx27"),i("xojL")],void 0===(n=(function(e,t,i,r,n,o,a,s,l,p,c,u,h,f,d,y,v,m,_,g){Object.defineProperty(t,"__esModule",{value:!0}),t.TILEMAP_SIZE_EXP=5;var b=u.getLogger("esri.layers.support.TilemapCache"),w=function(e){function l(t){var i=e.call(this,t)||this;return i._handles=new c,i._pendingTilemapRequests={},i._availableLevels={},i.levels=5,i.cacheByteSize=2097152,i.request=s,i._prefetchingEnabled=!0,i}var u;return r(l,e),u=l,l.prototype.initialize=function(){var e=this;this._tilemapCache=new h(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(function(){return e._initializeTilemapDefinition()})),m.init(this,"layer.tileInfo.lods",(function(t){return e._initializeAvailableLevels(t)}),!0)]),this._initializeTilemapDefinition()},l.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},l.prototype.castLevels=function(e){return e<=2?(b.error("Minimum levels for Tilemap is 3, but got ",e),3):e},Object.defineProperty(l.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0}),l.prototype.fetchTilemap=function(e,t,r,n){var o=this;if(!this._availableLevels[e])return d.reject(new p("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"));var a=this._tmpTilemapDefinition,s=this._tilemapFromCache(e,t,r,a);if(s)return d.resolve(s);var l=n&&n.signal;return n=i({},n,{signal:null}),d.create((function(e,t){d.onAbort(l,(function(){return t(d.createAbortError())}));var i=g.tilemapDefinitionId(a),r=o._pendingTilemapRequests[i];if(!r){r=g.Tilemap.fromDefinition(a,n).then((function(e){return o._tilemapCache.put(i,e,e.byteSize),e}));var s=function(){return delete o._pendingTilemapRequests[i]};o._pendingTilemapRequests[i]=r,r.then(s,s)}r.then(e,t)}))},l.prototype.getAvailability=function(e,t,i){if(!this._availableLevels[e])return"unavailable";var r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"},l.prototype.getAvailabilityUpsample=function(e,t,i,r){r.level=e,r.row=t,r.col=i;var n=this.layer.tileInfo;for(n.updateTileInfo(r);;){var o=this.getAvailability(r.level,r.row,r.col);if("unavailable"!==o)return o;if(!n.upsampleTile(r))return"unavailable"}},l.prototype.fetchAvailability=function(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch((function(e){return e})).then((function(r){if(r instanceof g.Tilemap){var n=r.getAvailability(t,i);return"unavailable"===n?d.reject(new p("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):n}if(d.isAbortError(r))throw r;return"unknown"})):d.reject(new p("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"))},l.prototype.fetchAvailabilityUpsample=function(e,t,i,r,n){var o=this;r.level=e,r.row=t,r.col=i;var a=this.layer.tileInfo;a.updateTileInfo(r);var s=this.fetchAvailability(e,t,i,n).catch((function(e){if(d.isAbortError(e))throw e;if(a.upsampleTile(r))return o.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e}));return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,n,s),s},l.prototype._fetchAvailabilityUpsamplePrefetch=function(e,t,r,n,s,l){return a(this,void 0,void 0,(function(){var a,p,c,h,f,v,m,_,g;return o(this,(function(o){switch(o.label){case 0:if(!this._prefetchingEnabled)return[2];if(this._handles.has(a="prefetch-"+e))return[2];p=d.createAbortController(),l.then((function(){return p.abort()}),(function(){return p.abort()})),c=!1,this._handles.add({remove:function(){c||(c=!0,p.abort())}},a),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,y.waitTicks(10,p.signal)];case 2:case 3:return o.sent(),[3,4];case 4:if(c||(c=!0,this._handles.remove(a)),d.isAborted(p))return[2];for(h={id:e,level:t,row:r,col:n},f=i({},s,{signal:p.signal}),v=this.layer.tileInfo,m=function(e){var t=_.fetchAvailability(h.level,h.row,h.col,f);u._prefetches.push(t);var i=function(){u._prefetches.removeUnordered(t)};t.then(i,i)},_=this,g=0;u._prefetches.length<u._maxPrefetch&&v.upsampleTile(h);++g)m();return[2]}}))}))},l.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?v.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}},l.prototype._tilemapFromCache=function(e,t,i,r){var n=this._getTilemapDefinition(e,t,i,r),o=g.tilemapDefinitionId(n);return this._tilemapCache.get(o)},l.prototype._getTilemapDefinition=function(e,i,r,n){n.level=e;var o=e>t.TILEMAP_SIZE_EXP;return n.row=o?i-i%this.size:i,n.col=o?r-r%this.size:r,n},l.prototype._initializeAvailableLevels=function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))},Object.defineProperty(l.prototype,"test",{get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,i,r){return!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0}),l._maxPrefetch=4,l._prefetches=new f({initialSize:u._maxPrefetch}),n([_.property({constructOnly:!0,type:Number})],l.prototype,"levels",void 0),n([_.cast("levels")],l.prototype,"castLevels",null),n([_.property({readOnly:!0,dependsOn:["levels"],type:Number})],l.prototype,"size",null),n([_.property({constructOnly:!0,type:Number})],l.prototype,"cacheByteSize",void 0),n([_.property({constructOnly:!0})],l.prototype,"layer",void 0),n([_.property({constructOnly:!0})],l.prototype,"request",void 0),u=n([_.subclass("esri.layers.support.TilemapCache")],l)}(_.declared(l));t.TilemapCache=w}).apply(null,r))||(e.exports=n)},GAgw:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("2Atf"),i("9opi"),i("qKT0"),i("Q2wQ"),i("HZ3d"),i("zp6E"),i("7bfM"),i("ma1f"),i("qsST"),i("LxLY"),i("EUqE"),i("qMld"),i("jfWY"),i("Vx27"),i("MFVu"),i("0RER"),i("WhPF"),i("2fnV"),i("FEX1"),i("QJ8R"),i("EtsK"),i("S+mV")],void 0===(n=(function(e,t,r,n,o,a,s,l,p,c,u,h,f,d,y,v,m,_,g,b,w,S,I,T){var z=u.getLogger("esri.layers.ElevationLayer");return function(e){function t(t){var i=e.call(this,t)||this;return i.copyright=null,i.heightModelInfo=null,i.path=null,i.opacity=1,i.operationalLayerType="ArcGISTiledElevationServiceLayer",i.sourceJSON=null,i.type="elevation",i.url=null,i.version=null,i._lercWorker=T.acquireInstance(),i}return n(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?r({url:e},t):e},t.prototype.destroy=function(){T.releaseInstance(this._lercWorker),this._lercWorker=null},Object.defineProperty(t.prototype,"minScale",{get:function(){},set:function(e){this.constructed&&z.warn(this.declaredClass+".minScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxScale",{get:function(){},set:function(e){this.constructed&&z.warn(this.declaredClass+".maxScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0}),t.prototype.readVersion=function(e,t){var i=t.currentVersion;return i||(i=9.3),i},t.prototype.load=function(e){var t=this,i=h.isSome(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(e){for(var t=0;t<e.typeKeywords.length;t++)if("elevation 3d layer"===e.typeKeywords[t].toLowerCase())return!0;throw new c("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).then((function(){return t._fetchImageService(i)}),(function(){return t._fetchImageService(i)}))),this.when()},t.prototype.fetchTile=function(e,t,i,r){var n=this;void 0===r&&(r={}),null!=r&&"number"==typeof r&&(p.deprecated(z,"Passing 'noDataValue' directly as a parameter",{replacement:"use { noDataValue } options object instead",version:"4.12"}),r={noDataValue:r});var o={responseType:"array-buffer",signal:r.signal},a={noDataValue:r.noDataValue,returnFileInfo:!0};return this.load().then((function(){return n._fetchTileAvailability(e,t,i,r)})).then((function(){return l(n.getTileUrl(e,t,i),o)})).then((function(e){return n._lercWorker.decode(e.data,a,r.signal)})).then((function(e){return{values:e.pixelData,width:e.width,height:e.height,maxZError:e.fileInfo.maxZError,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue}}))},t.prototype.getTileUrl=function(e,t,i){var n=y.objectToQuery(r({},this.parsedUrl.query,{blankTile:!(!this.tilemapCache&&this.supportsBlankTile)&&null}));return this.parsedUrl.path+"/tile/"+e+"/"+t+"/"+i+(n?"?"+n:"")},t.prototype.queryElevation=function(e,t){var i=this;return this._importElevationQuery().then((function(r){return(new r.ElevationQuery).query(i,e,t)}))},t.prototype.createElevationSampler=function(e,t){var i=this;return this._importElevationQuery().then((function(r){return(new r.ElevationQuery).createSampler(i,e,t)}))},t.prototype._fetchTileAvailability=function(e,t,i,r){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,i,r):d.resolve("unknown")},t.prototype._fetchImageService=function(e){return s(this,void 0,void 0,(function(){var t,i;return a(this,(function(n){switch(n.label){case 0:return this.sourceJSON?[2,this.sourceJSON]:(t={query:r({f:"json"},this.parsedUrl.query),responseType:"json",signal:e},[4,l(this.parsedUrl.path,t)]);case 1:return(i=n.sent()).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=i.data,this.read(i.data,{origin:"service",url:this.parsedUrl}),[2]}}))}))},t.prototype._importElevationQuery=function(){return d.create((function(e){i.e(41).then((function(){var t=[i("T16p")];e.apply(null,t)}).bind(this)).catch(i.oe)}))},o([v.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),o([v.property({readOnly:!0,type:m})],t.prototype,"heightModelInfo",void 0),o([v.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],t.prototype,"path",void 0),o([v.property({type:["show","hide"]})],t.prototype,"listMode",void 0),o([v.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],t.prototype,"minScale",null),o([v.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],t.prototype,"maxScale",null),o([v.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"opacity",void 0),o([v.property({type:["ArcGISTiledElevationServiceLayer"]})],t.prototype,"operationalLayerType",void 0),o([v.property()],t.prototype,"sourceJSON",void 0),o([v.property({json:{read:!1},value:"elevation",readOnly:!0})],t.prototype,"type",void 0),o([v.property(I.url)],t.prototype,"url",void 0),o([v.property()],t.prototype,"version",void 0),o([v.reader("version",["currentVersion"])],t.prototype,"readVersion",null),o([v.subclass("esri.layers.ElevationLayer")],t)}(v.declared(g.ArcGISCachedService(b.ArcGISService(w.OperationalLayer(S.PortalLayer(f.MultiOriginJSONMixin(_)))))))}).apply(null,r))||(e.exports=n)},QJ8R:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("9opi"),i("qKT0"),i("Q2wQ"),i("HZ3d"),i("ma1f"),i("qsST"),i("qMld"),i("jfWY"),i("Vx27"),i("Qwus"),i("QmTF")],void 0===(n=(function(e,t,r,n,o,a,s,l,p,c,u,h,f){Object.defineProperty(t,"__esModule",{value:!0});var d=l.getLogger("esri.layers.mixins.PortalLayer");t.PortalLayer=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"portalItem",{set:function(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))},enumerable:!0,configurable:!0}),t.prototype.readPortalItem=function(e,t,i){if(t.itemId)return new f({id:t.itemId,portal:i&&i.portal})},t.prototype.writePortalItem=function(e,t){e&&e.id&&(t.itemId=e.id)},t.prototype.loadFromPortal=function(e,t){return a(this,void 0,void 0,(function(){var r,n;return o(this,(function(o){switch(o.label){case 0:if(!this.portalItem||!this.portalItem.id)return[2];o.label=1;case 1:return o.trys.push([1,4,,5]),[4,p.create((function(e){return Promise.all([i.e(0),i.e(98)]).then((function(){var t=[i("6hwa")];e.apply(null,t)}).bind(this)).catch(i.oe)}))];case 2:return r=o.sent(),p.throwIfAborted(t),[4,r.load({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData},t)];case 3:return[2,o.sent()];case 4:throw n=o.sent(),d.warn("Failed to load layer ("+this.title+", "+this.id+") portal item ("+this.portalItem.id+")\n  "+n),n;case 5:return[2]}}))}))},t.prototype.read=function(e,t){var i=arguments;t&&(t.layer=this),this.inherited(i)},t.prototype.write=function(e,t){var i=t&&t.portal,r=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||h.getDefault());return i&&r&&!c.hasSamePortal(r.restUrl,i.restUrl)?(t.messages&&t.messages.push(new s("layer:cross-portal","The layer '"+this.title+" ("+this.id+")' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer",{layer:this})),null):this.inherited(arguments)},n([u.property({type:f})],t.prototype,"portalItem",null),n([u.reader("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),n([u.writer("portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),n([u.subclass("esri.layers.mixins.PortalLayer")],t)}(u.declared(e))}}).apply(null,r))||(e.exports=n)},"S+mV":function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("2Atf"),i("xhoE"),i("qMld"),i("ADZV"),i("8V7H"),i.dj.m(e)],void 0===(n=(function(e,t,r,n,o,a,s,l){function p(){return o.create((function(e){return i.e(118).then((function(){var t=[i("Rc7o")];e.apply(null,t)}).bind(this)).catch(i.oe)}))}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(){}return e.prototype._decode=function(e){return p().then((function(t){var i=(0,t.decode)(e.buffer,e.options);return{result:i,transferList:[i.pixelData.buffer]}}))},e}(),u=function(t){function i(i){var r=t.call(this)||this;return r.scheduler=i,r._threadInitialized=o.create((function(t){s.open(a.getAbsMid("./LercWorker",e,l),{strategy:"dedicated",scheduler:i}).then((function(e){void 0===r._thread?(r._thread=e,t()):(e.close(),t())}),(function(){return t()}))})),r}return n(i,t),i.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},Object.defineProperty(i.prototype,"test",{get:function(){return{threadInitialized:this._threadInitialized}},enumerable:!0,configurable:!0}),i.prototype.decode=function(e,t,i){return e&&0!==e.byteLength?this._thread?this._thread.invoke("_decode",{buffer:e,options:t},{transferList:[e],signal:i}):p().then((function(r){var n=r.decode;return o.throwIfAborted(i),n(e,t)})):o.resolve(null)},i}(c);t.LercWorkerMaster=u;var h=new Map;t.acquireInstance=function(e){var t=h.get(e);return t||(t={instance:new u(e),ref:0},h.set(e,t)),++t.ref,t.instance},t.releaseInstance=function(e){if(null!=e){var t=e.scheduler,i=h.get(t);i&&--i.ref<=0&&(i.instance.destroy(),h.delete(t))}},t.default=function(){return new c}}).apply(null,r))||(e.exports=n)},W6K4:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("r7jh")],void 0===(n=(function(e,t,i){return function(){function e(e,t){this._storage=new i.MemCacheStorage,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}return e.prototype.put=function(e,t,i){this._storage.put(e,t,i,1)},e.prototype.pop=function(e){return this._storage.pop(e)},e.prototype.get=function(e){return this._storage.get(e)},e.prototype.clear=function(){this._storage.clearAll()},e.prototype.destroy=function(){this._storage.clearAll()},Object.defineProperty(e.prototype,"maxSize",{get:function(){return this._storage.maxSize},set:function(e){this._storage.maxSize=e},enumerable:!0,configurable:!0}),e}()}).apply(null,r))||(e.exports=n)},WhPF:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("2Atf"),i("9opi"),i("qKT0"),i("TMur"),i("Vx27"),i("ddAr"),i("Cobz")],void 0===(n=(function(e,t,i,r,n,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.ArcGISCachedService=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.copyright=null,t.minScale=0,t.maxScale=0,t.spatialReference=null,t.tileInfo=null,t.tilemapCache=null,t}return r(t,e),t.prototype.readMinScale=function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0},t.prototype.readMaxScale=function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0},Object.defineProperty(t.prototype,"supportsBlankTile",{get:function(){return this.version>=10.2},enumerable:!0,configurable:!0}),t.prototype.readTilemapCache=function(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new l.TilemapCache({layer:this}):null},n([a.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),n([a.property()],t.prototype,"minScale",void 0),n([a.reader("service","minScale")],t.prototype,"readMinScale",null),n([a.property()],t.prototype,"maxScale",void 0),n([a.reader("service","maxScale")],t.prototype,"readMaxScale",null),n([a.property({type:o.SpatialReference})],t.prototype,"spatialReference",void 0),n([a.property({readOnly:!0,dependsOn:["version"]})],t.prototype,"supportsBlankTile",null),n([a.property(s.serviceTileInfoProperty)],t.prototype,"tileInfo",void 0),n([a.property()],t.prototype,"tilemapCache",void 0),n([a.reader("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),n([a.property()],t.prototype,"version",void 0),n([a.subclass("esri.layers.mixins.ArcGISCachedService")],t)}(a.declared(e))}}).apply(null,r))||(e.exports=n)},ddAr:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("2Atf"),i("pMLx")],void 0===(n=(function(e,t,i,r){function n(e,t,n,o){if(!e)return null;var a=t.minScale,s=t.maxScale,l=t.minLOD,p=t.maxLOD;if(null!=l&&null!=p)return r.fromJSON(o&&o.ignoreMinMaxLOD?e:i({},e,{lods:e.lods.filter((function(e){var t=e.level;return null!=t&&t>=l&&t<=p}))}));if(0!==a&&0!==s){var c=function(e){return Math.round(1e4*e)/1e4},u=a?c(a):1/0,h=s?c(s):-1/0;return r.fromJSON(i({},e,{lods:e.lods.filter((function(e){var t=c(e.scale);return t<=u&&t>=h}))}))}return r.fromJSON(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.serviceTileInfoProperty={type:r,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:n}}}}},t.readServiceTileInfo=n}).apply(null,r))||(e.exports=n)},r7jh:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("9sIV"),i("KBgh"),i("nRUF")],void 0===(n=(function(e,t,i,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MIN_PRIORITY=-3;var o=function(){function e(e,t,i){this._namespace=e,this._storage=t,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}return Object.defineProperty(e.prototype,"namespace",{get:function(){return this._namespace.slice(0,-1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitRate",{get:function(){return this._hit/(this._hit+this._miss)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._storage.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxSize",{get:function(){return this._storage.maxSize},enumerable:!0,configurable:!0}),e.prototype.resetHitRate=function(){this._hit=this._miss=0},e.prototype.destroy=function(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this)},e.prototype.put=function(e,t,i,r){void 0===r&&(r=0),this._storage.put(this._namespace+e,t,i,r)},e.prototype.get=function(e){var t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t},e.prototype.pop=function(e){var t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t},e.prototype.updateSize=function(e,t,i){this._storage.updateSize(this._namespace+e,t,i)},e.prototype.clear=function(){this._storage.clear(this._namespace)},e.prototype.clearAll=function(){this._storage.clearAll()},e.prototype.getStats=function(){return this._storage.getStats()},e.prototype.resetStats=function(){this._storage.resetStats()},e}();t.MemCache=o;var a=function(){function e(e){void 0===e&&(e=10485760),this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=[],this._users=new r}return e.prototype.register=function(e){this._users.push(e)},e.prototype.deregister=function(e){this._users.removeUnordered(e)},e.prototype.registerRemoveFunc=function(e,t){this._removeFuncs.push([e,t])},e.prototype.deregisterRemoveFunc=function(e){this._removeFuncs=this._removeFuncs.filter((function(t){return t[0]!==e}))},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxSize",{get:function(){return this._maxSize},set:function(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()},enumerable:!0,configurable:!0}),e.prototype.put=function(e,i,r,n){var o=this._db.get(e);if(o&&(this._size-=o.size,this._db.delete(e),o.entry!==i&&this._notifyRemoved(e,o.entry)),r>this._maxSize)this._notifyRemoved(e,i);else if(void 0!==i)if(!r||r<0)console.warn("Refusing to cache entry with invalid size "+r);else{var a=1+Math.max(n,t.MIN_PRIORITY)-t.MIN_PRIORITY;this._db.set(e,{entry:i,size:r,lifetime:a,lives:a}),this._size+=r,this._checkSizeLimit()}else console.warn("Refusing to cache undefined entry ")},e.prototype.updateSize=function(e,t,i){var r=this._db.get(e);if(r&&r.entry===t){if(this._size-=r.size,i>this._maxSize)return void this._notifyRemoved(e,t);r.size=i,this._size+=i,this._checkSizeLimit()}},e.prototype.pop=function(e){var t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss},e.prototype.get=function(e){var t=this._db.get(e);return void 0===t?void++this._miss:(this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry)},e.prototype.getStats=function(){var e=this,i={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},o=new Array;this._db.forEach((function(t,i){var a=t.lifetime;o[a]=(o[a]||0)+t.size,e._users.forEach((function(e){var o=e.namespace;n.startsWith(i,o)&&(r[o]=(r[o]||0)+t.size)}))}));var a={};this._users.forEach((function(e){var t=e.namespace;!isNaN(e.hitRate)&&e.hitRate>0?(r[t]=r[t]||0,a[t]=Math.round(100*e.hitRate)+"%"):a[t]="0%"}));var s=Object.keys(r);s.forEach((function(t){return r[t]=r[t]/e._size*100})),s.sort((function(e,t){return r[t]-r[e]})),s.forEach((function(e){return i[e]=Math.round(r[e])+"% / "+a[e]}));for(var l=o.length-1;l>=0;--l){var p=o[l];p&&(i["Priority "+(l+t.MIN_PRIORITY-1)]=Math.round(p/this.size*100)+"%")}return i},e.prototype.resetStats=function(){this._hit=this._miss=0,this._users.forEach((function(e){return e.resetHitRate()}))},e.prototype.clear=function(e){var t=this;this._db.forEach((function(i,r){n.startsWith(r,e)&&(t._size-=i.size,t._db.delete(r),t._notifyRemoved(r,i.entry))}))},e.prototype.clearAll=function(){var e=this;this._db.forEach((function(t,i){e._notifyRemoved(i,t.entry)})),this._size=0,this._db.clear()},e.prototype._getHitRate=function(){return this._hit/(this._hit+this._miss)},e.prototype._notifyRemoved=function(e,t){this._removeFuncs.forEach((function(i){n.startsWith(e,i[0])&&i[1](t)}))},e.prototype._checkSizeLimit=function(){var e=this;this._size<=this._maxSize||i.someMap(this._db,(function(t,i){return e._db.delete(i),t.lives<=1?(e._size-=t.size,e._notifyRemoved(i,t.entry)):(--t.lives,e._db.set(i,t)),e._size<=.9*e.maxSize}))},e}();t.MemCacheStorage=a}).apply(null,r))||(e.exports=n)},xojL:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("2Atf"),i("zp6E"),i("KY0m"),i("ma1f"),i("rg9i")],void 0===(n=(function(e,t,i,r,n,o,a){function s(e){var t;if("vector-tile"===e.service.type)t=e.service.url+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height;else{var i=e.service.tileServers;t=(i&&i.length?i[e.row%i.length]:e.service.url)+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height}var r=e.service.query;return r&&(t=t+"?"+r),t}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return e.prototype.getAvailability=function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i>>3,n=this._tileAvailabilityBitSet;return r<0||r>n.length?"unknown":n[r]&1<<i%8?"available":"unavailable"},e.prototype._updateFromData=function(e){for(var t=!0,i=!0,r=Math.ceil(this.location.width*this.location.height/8),n=new Uint8Array(r),o=0,a=0;a<e.length;a++){var s=a%8;e[a]?(i=!1,n[o]|=1<<s):t=!1,7===s&&++o}i?this._allAvailability="unavailable":t?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=n,this.byteSize+=n.length)},e.fromDefinition=function(t,a){var l=t.service.request||r,p=t.row,c=t.col,u=t.width,h=t.height,f={query:{f:"json"}};return a=a?i({},f,a):f,l(s(t),a).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:p,left:c,width:u,height:h},valid:!0,data:n.constant(u*h,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==p||t.location.left!==c||t.location.width!==u||t.location.height!==h))throw new o("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:p,left:c,width:u,height:h}});return e.fromJSON(t)}))},e.fromJSON=function(t){e.validateJSON(t);var i=new e;return i.location=Object.freeze(a.clone(t.location)),i._updateFromData(t.data),Object.freeze(i)},e.validateJSON=function(e){if(!e||!e.location)throw new o("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new o("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new o("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new o("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new o("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();t.Tilemap=l,t.tilemapDefinitionId=function(e){return e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height},t.tilemapDefinitionUrl=s,t.default=l}).apply(null,r))||(e.exports=n)}}]);