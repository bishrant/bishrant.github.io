!function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[161],{eylR:function(t,r,i){"use strict";i.r(r),i.d(r,"DropShadow",function(){return h}),i("wSAH");var a=i("qRWG"),s=(i("n4uK"),i("GVa1"),i("of9L")),o=i("0meK"),n=i("gjrC"),l=[1,0],u=[0,1],h=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._programDesc={blur:{vsPath:"post-processing/drop-shadow",fsPath:"post-processing/blur/gaussianBlur",attributes:{a_position:0}},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:{a_position:0}},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:{a_position:0}}}}var r,i,h;return r=t,(i=[{key:"dispose",value:function(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null),this._horizontalBlurFBO&&(this._horizontalBlurFBO.dispose(),this._horizontalBlurFBO=null),this._verticalBlurFBO&&(this._verticalBlurFBO.dispose(),this._verticalBlurFBO=null)}},{key:"draw",value:function(e,t,r){var i=e.context,s=e.state,o=e.painter,h=e.pixelRatio,d=o.materialManager,p=this._programDesc,c=t.width,f=t.height,_=[Math.round(c/2),Math.round(f/2)],B=r.blurRadius,m=r.offsetX,b=r.offsetY,g=r.color,v=[h*Object(a.h)(m/2),h*Object(a.h)(b/2)];this._createOrResizeResources(e,c,f,_);var w=this._horizontalBlurFBO,F=this._verticalBlurFBO;i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1);var T=this._layerFBOTexture;t.copyToTexture(0,0,c,f,0,0,T),this._quad||(this._quad=new n.a(i,[-1,-1,1,-1,-1,1,1,1])),i.setViewport(0,0,_[0],_[1]);var O=this._quad;O.bind(),i.setBlendingEnabled(!1);var x=d.getProgram(e,p.blur,[{name:"radius",value:Math.ceil(B)}]);i.bindProgram(x),i.bindFramebuffer(w),i.bindTexture(t.colorTexture,4),x.setUniformMatrix3fv("u_displayViewMat3",s.displayMat3),x.setUniform2fv("u_offset",v),x.setUniform1i("u_colorTexture",4),x.setUniform2fv("u_texSize",_),x.setUniform2fv("u_direction",l),x.setUniform1f("u_sigma",B),O.draw(),i.bindFramebuffer(F),i.bindTexture(w.colorTexture,5),x.setUniformMatrix3fv("u_displayViewMat3",s.displayMat3),x.setUniform2fv("u_offset",[0,0]),x.setUniform1i("u_colorTexture",5),x.setUniform2fv("u_direction",u),O.draw(),i.bindFramebuffer(t),i.setViewport(0,0,c,f);var y=d.getProgram(e,p.composite);i.bindProgram(y),i.bindTexture(F.colorTexture,2),y.setUniform1i("u_blurTexture",2),i.bindTexture(T,3),y.setUniform1i("u_layerFBOTexture",3),y.setUniform4fv("u_shadowColor",[g[3]*(g[0]/255),g[3]*(g[1]/255),g[3]*(g[2]/255),g[3]]),O.draw(),i.setBlendingEnabled(!0),i.setStencilTestEnabled(!0),i.setBlendFunction(1,771),O.unbind()}},{key:"_createOrResizeResources",value:function(e,t,r,i){var a=e.context;this._horizontalBlurFBO&&this._size[0]===t&&this._size[1]===r||(this._size[0]=t,this._size[1]=r,this._horizontalBlurFBO?this._horizontalBlurFBO.resize(i[0],i[1]):this._horizontalBlurFBO=new o.a(a,{colorTarget:0,depthStencilTarget:0,width:i[0],height:i[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:i[0],height:i[1]}),this._verticalBlurFBO?this._verticalBlurFBO.resize(i[0],i[1]):this._verticalBlurFBO=new o.a(a,{colorTarget:0,depthStencilTarget:0,width:i[0],height:i[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:i[0],height:i[1]}),this._layerFBOTexture?this._layerFBOTexture.resize(t,r):this._layerFBOTexture=new s.a(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:t,height:r}))}}])&&e(r.prototype,i),h&&e(r,h),t}()}}])}();