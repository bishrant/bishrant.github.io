(function(){var e={"esri/views/3d/interactive/measurementTools/directLineMeasurement3D/DirectLineMeasurement3DModel":"85VY","esri/widgets/DirectLineMeasurement3D/DirectLineMeasurement3DViewModel":"Qnoj","esri/widgets/DirectLineMeasurement3D":"SFUH","esri/views/3d/webgl-engine/shaders/MeasurementArrow.glsl":"SjTO","esri/views/3d/support/PropertiesPool":"kW7X","esri/views/3d/interactive/measurementTools/directLineMeasurement3D/DirectLineMeasurement3DView":"t0I+","esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial":"ugP+","esri/views/3d/interactive/measurementTools/directLineMeasurement3D/DirectLineMeasurement3DTool":"vl3m","esri/views/3d/webgl-engine/shaders/MeasurementArrowTechnique":"y+gz"},t=this||window,i=t.webpackJsonp=t.webpackJsonp||[];i.registerAbsMids?i.registerAbsMids(e):(i.absMidsWaiting=i.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{"85VY":function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("zOht"),i("cTAJ"),i("Gtr7"),i("eIBl"),i("xoE+"),i("GZXg"),i("fYGb"),i("8uEs"),i("8MXS"),i("Vx27"),i("0LE5"),i("Rdxj"),i("oxlp"),i("KDna"),i("vsLP"),i("6IZ0"),i("UidR"),i("mmEe"),i("kW7X")],void 0===(n=(function(e,t,i,r,n,o,s,a,l,c,d,u,p,h,_,v,m,g,f,y,b){"use strict";var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._tempStartPosition=h.vec3f64.create(),t._tempEndPosition=h.vec3f64.create(),t._tempCornerPosition=h.vec3f64.create(),t._unitNormalizer=new g,t._handles=new o,t._propertiesPool=new b.default({startPoint:_,endPoint:_},t),t.cursorPoint=null,t.state="initial",t.mode="auto",t.unit="metric",t.active=!1,t.directDistance=null,t.horizontalDistance=null,t.verticalDistance=null,t.geodesicDistance=null,t.geodesicAngle=null,t.triangleCollapseRatioThreshold=.03,t.geodesicMeasurementDistanceThreshold=1e5,t}return i.__extends(t,e),t.prototype.initialize=function(){var e=this;r.loadMessageBundle("esri/core/t9n/Units").then((function(t){e.messages=t})),this._handles.add(r.onLocaleChange((function(){return i.__awaiter(e,void 0,void 0,(function(){var e;return i.__generator(this,(function(t){switch(t.label){case 0:return e=this,[4,r.loadMessageBundle("esri/core/t9n/Units")];case 1:return e.messages=t.sent(),[2]}}))}))}))),this._handles.add(d.init(this.sceneView,"spatialReference",(function(t){e._unitNormalizer.spatialReference=t})),"scene-view"),this.reset()},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this._propertiesPool.destroy(),this._propertiesPool=null},Object.defineProperty(t.prototype,"startPoint",{set:function(e){if(e){var t=this._propertiesPool.get("startPoint");t.copy(e),this._set("startPoint",t),this._updateMeasurement()}else this._set("startPoint",null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startPointSurfaceLocation",{set:function(e){this._set("startPointSurfaceLocation",e),this._updateMeasurement()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endPoint",{set:function(e){if(e){var t=this._propertiesPool.get("endPoint");t.copy(e),this._set("endPoint",t),this._updateMeasurement()}else this._set("endPoint",null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endPointSurfaceLocation",{set:function(e){this._set("endPointSurfaceLocation",e),this._updateMeasurement()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"measurementSurfaceLocation",{get:function(){var e=this.startPointSurfaceLocation,t=this.endPointSurfaceLocation;return null==e||null==t||"above-the-surface"===e&&"below-the-surface"===t||"below-the-surface"===e&&"above-the-surface"===t||"on-the-surface"===e&&"on-the-surface"===t?"camera-dependent":"above-the-surface"===e||"above-the-surface"===t?"above-the-surface":"below-the-surface"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"validMeasurement",{get:function(){return!!this.startPoint&&!!this.endPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMeasuring",{get:function(){return!!this.startPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"geodesicDistanceExceeded",{get:function(){return this.horizontalDistance&&this.horizontalDistance.value>this.geodesicMeasurementDistanceThreshold},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"measurementMode",{get:function(){var e=this.mode;return"auto"===e&&(e="euclidean","degrees"!==this.unit&&"degrees-minutes-seconds"!==this.unit||(e="geodesic"),this.geodesicDistanceExceeded&&(e="geodesic")),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"triangleView",{get:function(){var e=this._collapseTriangle(),t=this.messages,i=null,r=null,n=null,o=this.directDistance,a="geodesic"===this.measurementMode?this.geodesicDistance:this.horizontalDistance,d=this.verticalDistance,u=null;switch(this.unit){case"metric":i=t&&o&&l.formatMetricLength(t,o),r=t&&a&&l.formatMetricLength(t,a),n=t&&d&&l.formatMetricVerticalLength(t,d),u=o&&o.toUnit("meters");break;case"imperial":i=t&&o&&l.formatImperialLength(t,o),r=t&&a&&l.formatImperialLength(t,a),n=t&&d&&l.formatImperialVerticalLength(t,d),u=o&&o.toUnit(c.preferredImperialLengthUnit(o.value,o.unit));break;case"degrees":r=t&&this.geodesicAngle&&l.formatDecimal(t,this.geodesicAngle,"degrees"),u=this.geodesicAngle&&this.geodesicAngle.toUnit("degrees");break;case"degrees-minutes-seconds":r=this.geodesicAngle&&l.formatDMS(this.geodesicAngle),u=this.geodesicAngle&&this.geodesicAngle.toUnit("degrees");break;default:i=t&&o&&l.formatDecimal(t,o,this.unit),r=t&&a&&l.formatDecimal(t,a,this.unit),n=t&&d&&l.formatDecimal(t,d,this.unit),u=o&&o.toUnit(this.unit)}var p=1;return u&&(p=s.nextHighestPowerOfTen(u.value/30),p*="degrees"===u.unit?v.metersPerDegree:c.convertUnit(1,u.unit,"meters"),p/=this._unitNormalizer.normalizeDistance(1)),{visible:this.validMeasurement&&!this.startPoint.equals(this.endPoint),mode:this.measurementMode,collapsed:e,directLabel:i,horizontalLabel:r,verticalLabel:n,stripeLength:p}},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.clearMeasurement()},t.prototype.clearMeasurement=function(){this.state="initial",this.startPoint=null,this.endPoint=null,this.cursorPoint=null,this._clearOverride("measurementSurfaceLocation"),this._updateMeasurement()},t.prototype.finishMeasurement=function(){if(!this._isOverridden("measurementSurfaceLocation")){var e=this.measurementSurfaceLocation;this._override("measurementSurfaceLocation","camera-dependent"===e?this.sceneView.state.camera.aboveGround?"above-the-surface":"below-the-surface":e)}this.state="measured"},t.prototype._collapseTriangle=function(){return!(this.validMeasurement&&!this.startPoint.equals(this.endPoint))||"geodesic"===this.measurementMode||Math.min(this.verticalDistance.value/this.horizontalDistance.value,this.horizontalDistance.value/this.verticalDistance.value)<this.triangleCollapseRatioThreshold},t.prototype._exactGeodesicDistanceAndAngle=function(e,t){f.pointToWGS84ComparableLonLat(e,P),f.pointToWGS84ComparableLonLat(t,L);var i=s.deg2rad(P[0]),r=s.deg2rad(P[1]),n=s.deg2rad(L[0]),o=s.deg2rad(L[1]),l=Math.abs(n-i),c=s.acosClamped(Math.sin(r)*Math.sin(o)+Math.cos(r)*Math.cos(o)*Math.cos(l)),d=s.rad2deg(c),u={distance:0};return m.inverseGeodeticSolver(u,[P[0],P[1]],[L[0],L[1]]),{distance:new a(u.distance,"meters"),angle:new a(d,"degrees")}},t.prototype._approximateGeodesicDistanceAndAngle=function(e){return{distance:new a(e,"meters"),angle:new a(e/v.metersPerDegree,"degrees")}},t.prototype._euclideanDistances=function(e,t){e.z>t.z&&(e=[e,e=t][0]);var i=e.clone();i.z=t.z;var r=this._tempStartPosition,n=this._tempEndPosition,o=this._tempCornerPosition,s=this.sceneView.spatialReference,l=y.canProject(s,y.WGS84ECEFSpatialReference)?y.WGS84ECEFSpatialReference:s;f.pointToVector(e,r,l),f.pointToVector(t,n,l),f.pointToVector(i,o,l);var c=p.vec3.distance(r,n),d=p.vec3.distance(o,n),u=Math.abs(t.z-e.z);return c=this._unitNormalizer.normalizeDistance(c),d=this._unitNormalizer.normalizeDistance(d),u=this._unitNormalizer.normalizeElevation(u),{direct:new a(c,"meters"),horizontal:new a(d,"meters"),vertical:new a(u,"meters")}},t.prototype._updateMeasurement=function(){if(!this.startPoint||!this.endPoint)return this._set("directDistance",null),this._set("horizontalDistance",null),this._set("verticalDistance",null),this._set("geodesicDistance",null),void this._set("geodesicAngle",null);var e=this._euclideanDistances(this.startPoint,this.endPoint),t=y.canProjectToWGS84ComparableLonLat(this.sceneView.spatialReference)?this._exactGeodesicDistanceAndAngle(this.startPoint,this.endPoint):this._approximateGeodesicDistanceAndAngle(e.horizontal.value);this._set("directDistance",e.direct),this._set("horizontalDistance",e.horizontal),this._set("verticalDistance",e.vertical),this._set("geodesicDistance",t.distance),this._set("geodesicAngle",t.angle)},i.__decorate([u.property()],t.prototype,"messages",void 0),i.__decorate([u.property({constructOnly:!0})],t.prototype,"sceneView",void 0),i.__decorate([u.property({value:null})],t.prototype,"startPoint",null),i.__decorate([u.property({value:null})],t.prototype,"startPointSurfaceLocation",null),i.__decorate([u.property({value:null})],t.prototype,"endPoint",null),i.__decorate([u.property({value:null})],t.prototype,"endPointSurfaceLocation",null),i.__decorate([u.property({dependsOn:["startPointSurfaceLocation","endPointSurfaceLocation"]})],t.prototype,"measurementSurfaceLocation",null),i.__decorate([u.property()],t.prototype,"cursorPoint",void 0),i.__decorate([u.property()],t.prototype,"state",void 0),i.__decorate([u.property()],t.prototype,"mode",void 0),i.__decorate([u.property()],t.prototype,"unit",void 0),i.__decorate([u.property()],t.prototype,"active",void 0),i.__decorate([u.property({readOnly:!0,dependsOn:["startPoint","endPoint"]})],t.prototype,"validMeasurement",null),i.__decorate([u.property({readOnly:!0,dependsOn:["startPoint"]})],t.prototype,"isMeasuring",null),i.__decorate([u.property({readOnly:!0})],t.prototype,"directDistance",void 0),i.__decorate([u.property({readOnly:!0})],t.prototype,"horizontalDistance",void 0),i.__decorate([u.property({readOnly:!0})],t.prototype,"verticalDistance",void 0),i.__decorate([u.property({readOnly:!0})],t.prototype,"geodesicDistance",void 0),i.__decorate([u.property({readOnly:!0})],t.prototype,"geodesicAngle",void 0),i.__decorate([u.property({readOnly:!0,dependsOn:["horizontalDistance","geodesicMeasurementDistanceThreshold"]})],t.prototype,"geodesicDistanceExceeded",null),i.__decorate([u.property({readOnly:!0,dependsOn:["horizontalDistance","unit","geodesicDistanceExceeded"]})],t.prototype,"measurementMode",null),i.__decorate([u.property({readOnly:!0,dependsOn:["messages","unit","measurementMode","startPoint","endPoint","triangleCollapseRatioThreshold"]})],t.prototype,"triangleView",null),i.__decorate([u.property()],t.prototype,"triangleCollapseRatioThreshold",void 0),i.__decorate([u.property()],t.prototype,"geodesicMeasurementDistanceThreshold",void 0),i.__decorate([u.subclass("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DModel")],t)}(n),P=h.vec3f64.create(),L=h.vec3f64.create();return w}).apply(null,r))||(e.exports=n)},Qnoj:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("zOht"),i("eIBl"),i("qsST"),i("qMld"),i("8uEs"),i("8MXS"),i("Vx27"),i("vl3m"),i("SFmM"),i("JcNK")],void 0===(n=(function(e,t,i,r,n,o,s,a,l,c,d,u){"use strict";var p=n.getLogger("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel");return function(e){function t(t){var i=e.call(this,t)||this;return i.supportedViewType="3d",i._handles=new r,i._userUnitOptions=null,i._userUnit=null,i}return i.__extends(t,e),t.prototype.initialize=function(){var e=this;this._handles.add([a.init(this,"unit",(function(t){e.tool&&(e.tool.model.unit=t)}))])},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null},Object.defineProperty(t.prototype,"state",{get:function(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"measurement",{get:function(){if(!this.tool)return null;var e=this.tool.model,t=e.measurementMode,i="geodesic"===t,r=e.validMeasurement;return{mode:t,directDistance:{text:i?null:e.triangleView.directLabel,state:r&&!i?"available":"unavailable"},horizontalDistance:{text:e.triangleView.horizontalLabel,state:r?"available":"unavailable"},verticalDistance:{text:e.triangleView.verticalLabel,state:r?"available":"unavailable"}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unitOptions",{get:function(){return this._filteredOrAllUnits(this._userUnitOptions)},set:function(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unit",{get:function(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)},set:function(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")},enumerable:!1,configurable:!0}),t.prototype.start=function(){return this.createTool()},t.prototype.clear=function(){this.removeTool()},t.prototype.newMeasurement=function(){o.ignoreAbortErrors(this.start())},t.prototype.clearMeasurement=function(){this.clear()},t.prototype.createToolParams=function(){var e=this;return{toolConstructor:c,constructorArguments:function(){return{unit:e.unit}}}},t.prototype.logUnsupportedError=function(){p.error("DirectLineMeasurement3D widget is not implemented for MapView")},t.prototype.logError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.error.apply(p,e)},t.prototype._findSelectableUnit=function(e,t){var i=this.unitOptions;return-1!==i.indexOf(e)?e:t?this._findSelectableUnit(t):i[0]},t.prototype._filteredOrAllUnits=function(e){if(!e)return s.measurementLengthUnits.slice();var t=e.filter((function(e){return-1!==s.measurementLengthUnits.indexOf(e)}));return 0===t.length?s.measurementLengthUnits.slice():t},i.__decorate([l.property({dependsOn:["isDisabled","tool.state"],readOnly:!0})],t.prototype,"state",null),i.__decorate([l.property({dependsOn:["view.ready","tool.model.triangleView","tool.model.directDistance","tool.model.horizontalDistance","tool.model.verticalDistance","tool.model.geodesicDistance","tool.model.measurementMode"],readOnly:!0})],t.prototype,"measurement",null),i.__decorate([l.property()],t.prototype,"tool",void 0),i.__decorate([l.property(d.defaultUnitPropertyMetadata)],t.prototype,"defaultUnit",void 0),i.__decorate([l.property({dependsOn:["view.spatialReference"]})],t.prototype,"unitOptions",null),i.__decorate([l.property({dependsOn:["unitOptions","defaultUnit"]})],t.prototype,"unit",null),i.__decorate([l.subclass("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel")],t)}(u.InteractiveToolViewModel)}).apply(null,r))||(e.exports=n)},SFUH:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("zOht"),i("qMld"),i("Vx27"),i("RHxK"),i("Qnoj"),i("bC3G")],void 0===(n=(function(e,t,i,r,n,o,s,a){"use strict";var l="esri-direct-line-measurement-3d__measurement-item",c="esri-direct-line-measurement-3d__measurement-item-title";return function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.view=null,r.visible=null,r.iconClass="esri-icon-measure-line",r.label=void 0,r.messages=null,r.viewModel=new s,r.unitOptions=null,r.unit=null,r}return i.__extends(t,e),t.prototype.render=function(){var e=this,t=this.viewModel.isSupported,i=this.viewModel.active,r="disabled"===this.viewModel.state,n="measuring"===this.viewModel.state||"measured"===this.viewModel.state,o=this.viewModel.measurement,s=this.messages,d=i&&"ready"===this.viewModel.state?a.tsx("section",{key:"esri-direct-line-measurement-3d__hint",class:"esri-direct-line-measurement-3d__hint"},a.tsx("p",{class:"esri-direct-line-measurement-3d__hint-text"},s.hint)):null,u=t?null:a.tsx("section",{key:"esri-direct-line-measurement-3d__unsupported",class:"esri-direct-line-measurement-3d__panel--error"},a.tsx("p",null,s.unsupported)),p=function(t,i,r){switch(i.state){case"available":return a.tsx("div",{key:r+"-enabled",class:l},a.tsx("span",{class:c},t),a.tsx("span",{class:"esri-direct-line-measurement-3d__measurement-item-value"},i.text));case"unavailable":return a.tsx("div",{key:r+"-disabled",class:e.classes(l,"esri-direct-line-measurement-3d__measurement-item--disabled")},a.tsx("span",{class:c},t))}},h=n?a.tsx("section",{key:"esri-direct-line-measurement-3d__measurement",class:"esri-direct-line-measurement-3d__measurement"},p(s.direct,o.directDistance,"direct"),p(s.horizontal,o.horizontalDistance,"horizontal"),p(s.vertical,o.verticalDistance,"vertical")):null,_=this.id+"__units",v=a.tsx("label",{class:"esri-direct-line-measurement-3d__units-label",for:_},s.unit),m=a.tsx("div",{class:"esri-direct-line-measurement-3d__units-select-wrapper"},a.tsx("select",{class:"esri-direct-line-measurement-3d__units-select esri-select",id:_,onchange:this._changeUnit,bind:this},this.viewModel.unitOptions.map((function(t){return a.tsx("option",t===e.viewModel.unit?{key:t,value:t,selected:!0}:{key:t,value:t},s.units[t])})))),g=a.tsx("section",{key:"esri-direct-line-measurement-3d__units",class:"esri-direct-line-measurement-3d__units"},v,m),f=n?a.tsx("div",{key:"settings",class:"esri-direct-line-measurement-3d__settings"},g):null,y=!t||i&&!n?null:a.tsx("div",{class:"esri-direct-line-measurement-3d__actions"},a.tsx("button",{disabled:r,class:this.classes("esri-button esri-button--secondary","esri-direct-line-measurement-3d__clear-button",r&&"esri-button--disabled"),bind:this,onclick:this._newMeasurement,type:"button"},s.newMeasurement)),b=this.visible?a.tsx("div",{class:"esri-direct-line-measurement-3d__container"},u,d,f,h,y):null;return a.tsx("div",{key:"",class:this.classes("esri-direct-line-measurement-3d","esri-widget","esri-widget--panel"),role:"presentation"},b)},t.prototype._newMeasurement=function(){r.ignoreAbortErrors(this.viewModel.start())},t.prototype._changeUnit=function(e){var t=e.target,i=t.options[t.selectedIndex];i&&(this.unit=i.value)},i.__decorate([n.aliasOf("viewModel.view")],t.prototype,"view",void 0),i.__decorate([n.aliasOf("viewModel.visible"),a.renderable()],t.prototype,"visible",void 0),i.__decorate([n.aliasOf("viewModel.active"),a.renderable()],t.prototype,"active",void 0),i.__decorate([n.property()],t.prototype,"iconClass",void 0),i.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),i.__decorate([n.property(),a.renderable(),a.messageBundle("esri/widgets/DirectLineMeasurement3D/t9n/DirectLineMeasurement3D")],t.prototype,"messages",void 0),i.__decorate([n.property({type:s}),a.renderable(["viewModel.state","viewModel.unitOptions","viewModel.unit","viewModel.measurement"])],t.prototype,"viewModel",void 0),i.__decorate([n.aliasOf("viewModel.unitOptions")],t.prototype,"unitOptions",void 0),i.__decorate([n.aliasOf("viewModel.unit")],t.prototype,"unit",void 0),i.__decorate([a.accessibleHandler()],t.prototype,"_newMeasurement",null),i.__decorate([a.accessibleHandler()],t.prototype,"_changeUnit",null),i.__decorate([n.subclass("esri.widgets.DirectLineMeasurement3D")],t)}(o)}).apply(null,r))||(e.exports=n)},SjTO:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("zOht"),i("7Aei"),i("aExC")],void 0===(n=(function(e,t,i,r,n){"use strict";var o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.build=void 0,t.build=function(){var e=new n.ShaderBuilder;e.vertex.uniforms.add("proj","mat4").add("view","mat4").add("width","float"),e.attributes.add("position","vec3"),e.attributes.add("normal","vec3"),e.attributes.add("uv0","vec2"),e.attributes.add("auxpos1","float"),e.varyings.add("vtc","vec2"),e.varyings.add("vlength","float"),e.varyings.add("vradius","float"),e.vertex.code.add(r.glsl(o||(o=i.__makeTemplateObject(["\n    void main(void) {\n      vec3 bitangent = normal;\n\n      vtc = uv0;\n      vlength = auxpos1;\n      vradius = 0.5 * width;\n\n      vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);\n      gl_Position = proj * pos;\n    }\n  "],["\n    void main(void) {\n      vec3 bitangent = normal;\n\n      vtc = uv0;\n      vlength = auxpos1;\n      vradius = 0.5 * width;\n\n      vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);\n      gl_Position = proj * pos;\n    }\n  "])))),e.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");var t=1/Math.sqrt(2);return e.fragment.code.add(r.glsl(s||(s=i.__makeTemplateObject(["\n    const float INV_SQRT2 = ",";\n\n    vec4 arrowColor(vec2 tc, float len) {\n      float d = INV_SQRT2 * (tc.x - abs(tc.y));\n      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n      d = min(d, 1.0 - abs(tc.y));\n\n      if (d < 0.0) {\n        return vec4(0.0);\n      } else if (d < outlineSize) {\n        return outlineColor;\n      } else {\n        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n      }\n    }\n\n    void main(void) {\n      vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n      vec4 color = arrowColor(ntc, vlength / vradius);\n      if (color.a == 0.0) {\n        discard;\n      }\n      gl_FragColor = color;\n    }\n  "],["\n    const float INV_SQRT2 = ",";\n\n    vec4 arrowColor(vec2 tc, float len) {\n      float d = INV_SQRT2 * (tc.x - abs(tc.y));\n      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n      d = min(d, 1.0 - abs(tc.y));\n\n      if (d < 0.0) {\n        return vec4(0.0);\n      } else if (d < outlineSize) {\n        return outlineColor;\n      } else {\n        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n      }\n    }\n\n    void main(void) {\n      vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n      vec4 color = arrowColor(ntc, vlength / vradius);\n      if (color.a == 0.0) {\n        discard;\n      }\n      gl_FragColor = color;\n    }\n  "])),r.glsl.float(t))),e}}).apply(null,r))||(e.exports=n)},kW7X:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("342/"),i("xtwj")],void 0===(n=(function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PropertiesPool=void 0;var n=function(){function e(e,t){var n=this;for(var o in this.owner=t,this.properties={},this.afterDispatchHandle=null,e){var s=new i.ReentrantObjectPool(e[o],null,null,2,2);this.properties[o]={pool:s,acquired:[]}}this.afterDispatchHandle=r.afterDispatch((function(){return n.release()}))}return e.prototype.destroy=function(){for(var e in this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null),this.properties){for(var t=this.properties[e],i=0,n=t.acquired;i<n.length;i++){var o=n[i];r.isValueInUse(o)||t.pool.release(o)}t.pool.destroy(),t.pool=null,t.acquired=null}this.properties=null,this.owner=null},e.prototype.get=function(e){var t=this.owner._get(e),i=this.properties[e],r=i.pool.acquire();for(i.acquired.push(r);r===t;)i.acquired.push(r),r=i.pool.acquire();return r},e.prototype.release=function(){for(var e in this.properties){for(var t=this.properties[e],i=0,n=0,o=t.acquired;n<o.length;n++){var s=o[n];r.isValueInUse(s)?t.acquired[i++]=s:t.pool.release(s)}t.acquired.length=i}},e}();t.PropertiesPool=n,t.default=n}).apply(null,r))||(e.exports=n)},"t0I+":function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("eIBl"),i("xoE+"),i("jBNx"),i("FXVB"),i("1m5D"),i("W9tT"),i("0LE5"),i("Rdxj"),i("5T2R"),i("QRfi"),i("xFSb"),i("vt78"),i("C7wT"),i("XHwE"),i("vA3N"),i("aWgr"),i("hX2R"),i("mmEe"),i("JjCO"),i("ys4y"),i("AgDx"),i("4ziW"),i("m4lJ"),i("ZO6V"),i("ZJC8"),i("o5p5"),i("FbvD"),i("ugP+"),i("RC9r")],void 0===(n=(function(e,t,i,r,n,o,s,a,l,c,d,u,p,h,_,v,m,g,f,y,b,w,P,L,M,O,D,j,S,C,x){"use strict";var A=[1,.5,0,.75],z={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:A,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:A,guideLineWidth:2,guideLineColor:A,guideStippleLengthPixels:6,labelDistance:25},T=function(){function e(e,t){void 0===t&&(t={}),this._visible=!1,this._laserLineRenderer=null,this._directDistanceLabel=new u,this._horizontalDistanceLabel=new u,this._verticalDistanceLabel=new u,this._handles=new i,this._listenerHandles=null,this._cursorPosition=c.vec3f64.create(),this._startPosition=c.vec3f64.create(),this._endPosition=c.vec3f64.create(),this._centerPosition=c.vec3f64.create(),this._cornerPosition=c.vec3f64.create(),this._arrowLabelSegment=new p,this._horizontalLabelSegment=new p,this._verticalLabelSegment=new p,this._geodesicProjectionLabelSegment=new p,this._origin=c.vec3f64.create(),this._originTransform=s.mat4f64.create(),this._lastDraggedHandle=null,this._model=e,this._view=e.sceneView,this._params=v.copyParameter(z,t),this._layer=new O("point-to-point-measurement",{isPickable:!1}),this._createMaterials(),this._createObjects(),this._intersector=new M.Intersector(this._view.state.mode),this._intersector.options.store=0}return e.prototype.destroy=function(){this.hide(),this._handles.destroy(),this._handles=null},Object.defineProperty(e.prototype,"requiresCursorPoint",{get:function(){return"initial"===this._model.state&&this._model.active},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraAboveGround",{get:function(){return this._view.state.camera.aboveGround},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e?this.show():this.hide()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"testData",{get:function(){return{labels:{direct:this._directDistanceLabel,horizontal:this._horizontalDistanceLabel,vertical:this._verticalDistanceLabel},laserLineRenderer:this._laserLineRenderer}},enumerable:!1,configurable:!0}),e.prototype.createManipulators=function(){var e=this,t=function(){var t=d.createSphereManipulator(e._view,e._params.handleColor,e._params.handleOpacity);return t.available=!1,t.radius=e._params.handleRadius,t},i=t(),r=t();this._model.startPoint&&(i.location=this._model.startPoint,i.available=!0),this._model.endPoint&&(r.location=this._model.endPoint,r.available=!0);var n=function(){var t=e._lastDraggedHandle;i.grabbing&&!r.grabbing&&(t="start"),r.grabbing&&!i.grabbing&&(t="end"),i.grabbing||r.grabbing||(t=null);var n=t!==e._lastDraggedHandle;e._lastDraggedHandle=t,n&&e.visible&&e._updateLaserLine()};return this._handles.add([i.events.on("grab-changed",(function(){n()})),r.events.on("grab-changed",(function(){n()}))]),{start:i,end:r}},e.prototype.show=function(){if(!this._visible){this._visible=!0;var e=this._view._stage;this._laserLineRenderer=new f.LaserLineRenderer(this._view.renderCoordsHelper,{innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,globalAlpha:this._params.laserLineGlobalAlpha}),e.addRenderPlugin(this._laserLineRenderer.renderSlots,this._laserLineRenderer),this._addToStage(e),this._directDistanceLabel.addToView(this._view),this._horizontalDistanceLabel.addToView(this._view),this._verticalDistanceLabel.addToView(this._view),this._initializeListeners(),this._updateCursorPosition(),this._updateStartPosition(),this._updateEndPosition(),this._updateLaserLine(),this._updateView()}},e.prototype.hide=function(){if(this._visible){this._visible=!1;var e=this._view._stage;e.removeRenderPlugin(this._laserLineRenderer),this._laserLineRenderer=null,this._removeFromStage(e),this._directDistanceLabel.removeFromView(this._view),this._horizontalDistanceLabel.removeFromView(this._view),this._verticalDistanceLabel.removeFromView(this._view),this._destroyListeners(),this._view.cursor=null}},e.prototype.pick=function(t){var i=this._view.spatialReference,r=n.screenPointObjectToArray(t.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(r,this._intersector);var o=this._intersector.results.min,s=c.vec3f64.create();if(!o.getIntersectionPoint(s))return new e.PickResult;var a=this._view.renderCoordsHelper.fromRenderCoords(s,i);return new e.PickResult("TerrainRenderer"===o.intersector?"ground":"feature",s,a)},e.prototype.getElevation=function(e){return this._view.basemapTerrain.ready&&m.getElevationAtPoint(this._view.elevationProvider,e)||0},e.prototype.overlappingHandles=function(e,t){return v.pointToPointScreenDistance(e,t,this._view)<=this._params.handleRadius},e.prototype._createMaterials=function(){this._triangleLineMaterial=new x({width:this._params.triangleLineWidth,color:this._params.triangleColor,polygonOffset:!0},"triangle-line"),this._triangleLineMaterial.renderOccluded=4,this._triangleCornerMaterial=new j({color:this._params.triangleColor,transparent:!0,writeDepth:!1,polygonOffset:!0},"triangle-corner"),this._triangleCornerMaterial.renderOccluded=4,this._arrowMaterial=new C({outlineColor:this._params.arrowOutlineColor,stripeEvenColor:this._params.arrowStripeEvenColor,stripeOddColor:this._params.arrowStripeOddColor,polygonOffset:!0},"arrow"),this._arrowMaterial.renderOccluded=4,this._geodesicProjectionLineMaterial=new x({width:this._params.geodesicProjectionLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0},"geodesic-line"),this._geodesicProjectionLineMaterial.renderOccluded=4,this._geodesicGuideLineMaterial=new x({width:this._params.guideLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0,stipplePattern:S.createStipplePatternSimple(this._params.guideStippleLengthPixels),stippleIntegerRepeats:!1},"geodesic-guide"),this._geodesicGuideLineMaterial.renderOccluded=4},e.prototype._createObjects=function(){this._triangleLineObject=new D,this._layer.addObject(this._triangleLineObject),this._triangleCornerObject=new D,this._layer.addObject(this._triangleCornerObject),this._arrowObject=new D,this._layer.addObject(this._arrowObject),this._geodesicProjectionLineObject=new D,this._layer.addObject(this._geodesicProjectionLineObject),this._geodesicProjectionStartGuideObject=new D,this._layer.addObject(this._geodesicProjectionStartGuideObject),this._geodesicProjectionEndGuideObject=new D,this._layer.addObject(this._geodesicProjectionEndGuideObject)},e.prototype._addToStage=function(e){e.add(0,this._layer),e.add(3,this._triangleLineMaterial),e.add(3,this._triangleCornerMaterial),e.add(3,this._arrowMaterial),e.add(3,this._geodesicProjectionLineMaterial),e.add(3,this._geodesicGuideLineMaterial),e.add(1,this._triangleLineObject),e.add(1,this._triangleCornerObject),e.add(1,this._arrowObject),e.add(1,this._geodesicProjectionLineObject),e.add(1,this._geodesicProjectionStartGuideObject),e.add(1,this._geodesicProjectionEndGuideObject),e.addToViewContent([this._layer.id])},e.prototype._removeFromStage=function(e){e.removeFromViewContent([this._layer.id]),e.remove(0,this._layer.id),e.remove(3,this._triangleLineMaterial.id),e.remove(3,this._triangleCornerMaterial.id),e.remove(3,this._arrowMaterial.id),e.remove(3,this._geodesicProjectionLineMaterial.id),e.remove(3,this._geodesicGuideLineMaterial.id),e.remove(1,this._triangleLineObject.id),e.remove(1,this._triangleCornerObject.id),e.remove(1,this._arrowObject.id),e.remove(1,this._geodesicProjectionLineObject.id),e.remove(1,this._geodesicProjectionStartGuideObject.id),e.remove(1,this._geodesicProjectionEndGuideObject.id)},e.prototype._getLabelPositions=function(e,t,i,o,s){var l=this._model.triangleView.collapsed,c=n.castRenderScreenPointArray3(b.sv3d.get()),d=n.castRenderScreenPointArray3(b.sv3d.get());s.projectPoint(i,c),s.projectPoint(t,d);var u={direct:l?"top":"bottom",horizontal:"top",vertical:c[0]<d[0]?"left":"right"};if(!l){var p=b.sv2d.get(),_=b.sv2d.get();if(v.screenSpaceTangent(e,i,p,s),v.screenSpaceTangent(e,t,_,s),a.vec2.dot(p,_)>=V)u.direct=r.sign(p[1])===r.sign(_[1])?h.mirrorPosition(u.vertical):u.vertical;else{var m=n.castRenderScreenPointArray(b.sv2d.get());v.screenSpaceTangent(i,t,m,s),a.vec2.dot(m,_)>=V&&(u.direct=r.sign(m[0])===r.sign(_[0])?h.mirrorPosition(u.horizontal):u.horizontal)}}if("below-the-surface"===o){var g=function(e){return"top"===e?"bottom":"top"};u.direct=g(u.direct),u.horizontal=g(u.horizontal),u.vertical=g(u.vertical)}return u},e.prototype._updateView=function(){var e;if(this._view.ready){var t=this._view._stage.getCamera(),i=this._view.renderCoordsHelper,r=this._model.triangleView;if(!r.visible)return this._triangleLineObject.removeAllGeometries(),this._triangleCornerObject.removeAllGeometries(),this._arrowObject.removeAllGeometries(),this._geodesicProjectionLineObject.removeAllGeometries(),this._geodesicProjectionStartGuideObject.removeAllGeometries(),this._geodesicProjectionEndGuideObject.removeAllGeometries(),this._directDistanceLabel.visible=!1,this._horizontalDistanceLabel.visible=!1,void(this._verticalDistanceLabel.visible=!1);var n="camera-dependent"===this._model.measurementSurfaceLocation?this._view.state.camera.aboveGround?"above-the-surface":"below-the-surface":this._model.measurementSurfaceLocation,s=this._startPosition,a=this._endPosition,c="above-the-surface"===n?1:-1,d=c*(i.getAltitude(a)-i.getAltitude(s));d<0&&(s=(e=[a,s])[0],a=e[1]);var u=this._cornerPosition;i.worldUpAtPosition(s,u),l.vec3.scale(u,u,c*Math.abs(d)),l.vec3.add(u,u,s);var p=this._centerPosition;v.midpoint([s,a,u],p),l.vec3.copy(this._origin,p),o.mat4.identity(this._originTransform),o.mat4.translate(this._originTransform,this._originTransform,this._origin),r.collapsed?(this._triangleLineObject.removeAllGeometries(),this._triangleCornerObject.removeAllGeometries()):this._updateTriangleObjects(this._triangleLineObject,this._triangleCornerObject,s,a,u,this._origin,this._originTransform,t,this._horizontalLabelSegment,this._verticalLabelSegment),this._updateArrowObject(this._arrowObject,this._startPosition,this._endPosition,this._origin,this._originTransform,r.stripeLength,t,r.mode,this._arrowLabelSegment);var h=this._requiresGeodesicVisualElements(this._startPosition,this._endPosition,t,r.mode);this._updateGeodesicProjectionLineObject(this._geodesicProjectionLineObject,this._startPosition,this._endPosition,this._origin,this._originTransform,h,this._geodesicProjectionLabelSegment),this._updateGeodesicProjectionGuideObjects(h);var _=this._params.labelDistance,m=this._getLabelPositions(s,a,u,n,t);this._updateAuxiliaryMeasureLabels(r,t,m),"geodesic"!==r.mode?this._updateLabel(this._directDistanceLabel,this._arrowLabelSegment,_,m.direct,r.directLabel,r.visible,16,t):(this._updateLabel(this._horizontalDistanceLabel,h?this._geodesicProjectionLabelSegment:this._arrowLabelSegment,_,m.horizontal,r.horizontalLabel,r.visible,16,t),this._directDistanceLabel.visible=!1)}},e.prototype._updateAuxiliaryMeasureLabels=function(e,t,i){if(e.collapsed)return this._horizontalDistanceLabel.visible=!1,void(this._verticalDistanceLabel.visible=!1);var r=this._params.labelDistance;this._updateLabel(this._horizontalDistanceLabel,this._horizontalLabelSegment,r,i.horizontal,e.horizontalLabel,!0,12,t),this._updateLabel(this._verticalDistanceLabel,this._verticalLabelSegment,r,i.vertical,e.verticalLabel,!0,12,t)},e.prototype._updateTriangleObjects=function(e,t,i,r,n,o,s,a,c,d){var u=[l.vec3.subtract(b.sv3d.get(),i,o),l.vec3.subtract(b.sv3d.get(),n,o),l.vec3.subtract(b.sv3d.get(),r,o)];c.update(n,r),d.update(i,n);var p=new w(L.createPolylineGeometry(u),"triangle-line");e.removeAllGeometries(),e.addGeometry(p,this._triangleLineMaterial,s);var h=b.sv3d.get(),_=b.sv3d.get();l.vec3.subtract(h,n,i),l.vec3.normalize(h,h),l.vec3.subtract(_,r,n),l.vec3.normalize(_,_);var v=.33*Math.min(l.vec3.distance(n,i),l.vec3.distance(n,r)),m=this._params.triangleCornerSize*a.computeScreenPixelSizeAt(n),g=Math.min(v,m),f=new w(this._quadGeometryData(n,h,_,g,o),"triangle-corner");t.removeAllGeometries(),t.addGeometry(f,this._triangleCornerMaterial,s)},e.prototype._updateArrowObject=function(e,t,i,r,n,o,s,a,l){this._createInterpolatedLineGeometry(e,this._arrowMaterial,"arrow",t,i,r,n,a,this._arrowLabelSegment);var c=s.computeScreenPixelSizeAt(l.origin);this._arrowMaterial.setParameterValues({width:this._params.arrowWidth*c,stripeLength:o})},e.prototype._getSegmentInterpolator=function(e,t){var i=this._view.renderCoordsHelper.spatialReference;return y.canProject(this._view.spatialReference,y.SphericalECEFSpatialReference)?new _.Spherical(e,t,i,i):new _.Linear(e,t)},e.prototype._updateGeodesicProjectionLineObject=function(e,t,i,r,n,o,s){if(o){var a=this._view.renderCoordsHelper,c=l.vec3.copy(b.sv3d.get(),t),d=l.vec3.copy(b.sv3d.get(),i);a.setAltitude(0,c),a.setAltitude(0,d),this._createInterpolatedLineGeometry(e,this._geodesicProjectionLineMaterial,"geodesicProjectionLine",c,d,r,n,"geodesic",s)}else e.removeAllGeometries()},e.prototype._requiresGeodesicVisualElements=function(e,t,i,r){return!("geodesic"!==r||!this._model.geodesicDistanceExceeded)&&(this._requiresGeodesicGuideAt(e,i)||this._requiresGeodesicGuideAt(t,i))},e.prototype._requiresGeodesicGuideAt=function(e,t){var i=this._view.renderCoordsHelper,r=t.computeScreenPixelSizeAt(e);return i.getAltitude(e)/r>=10},e.prototype._updateGeodesicProjectionGuideObjects=function(e){if(!e)return this._geodesicProjectionStartGuideObject.removeAllGeometries(),void this._geodesicProjectionEndGuideObject.removeAllGeometries();var t=this._view.renderCoordsHelper,i=l.vec3.copy(b.sv3d.get(),this._startPosition),r=l.vec3.copy(b.sv3d.get(),this._endPosition);t.setAltitude(0,i),t.setAltitude(0,r),this._createInterpolatedLineGeometry(this._geodesicProjectionStartGuideObject,this._geodesicGuideLineMaterial,"geodesicGuideLine",i,this._startPosition,this._origin,this._originTransform,"euclidean"),this._createInterpolatedLineGeometry(this._geodesicProjectionEndGuideObject,this._geodesicGuideLineMaterial,"geodesicGuideLine",r,this._endPosition,this._origin,this._originTransform,"euclidean")},e.prototype._createInterpolatedLineGeometry=function(e,t,i,r,n,o,s,a,c){var d=this._view.renderCoordsHelper,u=[],p=[],h=function(e,t){var i=b.sv3d.get();l.vec3.subtract(i,e,o),u.push(i),p.push(t)};if("euclidean"===a){var _=b.sv3d.get();v.midpoint([r,n],_);var m=b.sv3d.get();d.worldUpAtPosition(_,m),h(r,m),h(n,m),c&&c.update(r,n)}else{for(var g=this._getSegmentInterpolator(r,n),f=this._params.arrowSubdivisions+1&-2,y=null,P=null,M=0;M<f;++M){var O=M/(f-1),D=b.sv3d.get();m=b.sv3d.get(),g.eval(O,D),d.worldUpAtPosition(D,m),M===f/2-1?y=D:M===f/2&&(P=D),h(D,m)}c&&c.update(y,P)}var j=new w(L.createPolylineGeometry(u,p),i);e.removeAllGeometries(),e.addGeometry(j,t,s)},e.prototype._quadGeometryData=function(e,t,i,r,n){var o=b.sv3d.get(),s=[],a=b.sv3d.get();l.vec3.scale(a,i,r);var c=b.sv3d.get();l.vec3.scale(c,t,-r);for(var d=0;d<4;++d)l.vec3.copy(o,e),l.vec3.subtract(o,o,n),1&d&&l.vec3.add(o,o,a),2&d&&l.vec3.add(o,o,c),s.push(o[0],o[1],o[2]);return new P.GeometryData({position:{size:3,data:s}},{position:new Uint32Array([0,1,2,1,2,3])})},e.prototype._updateLabel=function(e,t,i,r,o,s,a,l){var c=n.castScreenPointArray(b.sv2d.get()),d=n.castScreenPointArray(b.sv2d.get()),u=h.computeLabelPositionFromSegment(l,t,i,r,c,d);e.updatePosition(c,d),e.text=o,e.visible=u&&s,e.fontSize=a},e.prototype._updateCursorPosition=function(){this._model.cursorPoint&&this._view.renderCoordsHelper.toRenderCoords(this._model.cursorPoint,this._cursorPosition),this._updateLaserLine()},e.prototype._updateStartPosition=function(){this._model.startPoint&&this._view.renderCoordsHelper.toRenderCoords(this._model.startPoint,this._startPosition)},e.prototype._updateEndPosition=function(){this._model.endPoint&&this._view.renderCoordsHelper.toRenderCoords(this._model.endPoint,this._endPosition)},e.prototype._getFocusPosition=function(){var e=this._model,t=e.triangleView.visible&&e.triangleView.collapsed&&"euclidean"===e.measurementMode;switch(e.state){case"drawing":return t?this._startPosition:e.endPoint?this._endPosition:this._startPosition;case"editing":return t?"start"===this._lastDraggedHandle?this._endPosition:this._startPosition:"start"===this._lastDraggedHandle?this._startPosition:this._endPosition;default:return e.cursorPoint?this._cursorPosition:null}},e.prototype._getFocusSpherePosition=function(){return"drawing"===this._model.state||"end"===this._lastDraggedHandle?this._startPosition:this._endPosition},e.prototype._updateLaserLine=function(){var e=this._model,t=this._getFocusPosition(),i=this._params.laserLineEnabled&&!!t&&"measured"!==e.state&&e.active;i?(this._laserLineRenderer.heightManifoldEnabled=i&&"euclidean"===e.measurementMode,this._laserLineRenderer.pointDistanceEnabled=i&&!!e.startPoint&&"geodesic"===e.measurementMode,this._laserLineRenderer.heightManifoldTarget=t,this._laserLineRenderer.pointDistanceOrigin=this._getFocusSpherePosition(),this._laserLineRenderer.pointDistanceTarget=t,this._laserLineRenderer.lineVerticalPlaneEnabled=i&&e.triangleView.visible&&!e.triangleView.collapsed,this._laserLineRenderer.lineVerticalPlaneSegment=g.lineSegment.fromPoints(this._startPosition,this._endPosition,G)):(this._laserLineRenderer.heightManifoldEnabled=!1,this._laserLineRenderer.pointDistanceEnabled=!1,this._laserLineRenderer.lineVerticalPlaneEnabled=!1)},e.prototype._initializeListeners=function(){var e=this;this._listenerHandles=new i,this._listenerHandles.add([this._model.watch("state",(function(){e._updateLaserLine()})),this._model.watch("measurementMode",(function(){e._updateLaserLine()})),this._model.watch("hoveredHandle",(function(){e._updateView()})),this._model.watch("cursorPoint",(function(){e._updateCursorPosition()})),this._model.watch("startPoint",(function(){e._updateStartPosition(),e._updateView(),e._updateLaserLine()})),this._model.watch("endPoint",(function(){e._updateEndPosition(),e._updateView(),e._updateLaserLine()})),this._model.watch("messages",(function(){e._updateView()})),this._model.watch("unit",(function(){e._updateView()})),this._model.watch("active",(function(){e._updateLaserLine(),e._updateView()})),this._view.state.watch("camera",(function(){e._updateView()}))])},e.prototype._destroyListeners=function(){this._listenerHandles.destroy(),this._listenerHandles=null},e}();!function(e){e.PickRequest=function(){},e.PickResult=function(e,t,i){void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=null),this.type=e,this.scenePoint=t,this.mapPoint=i}}(T||(T={}));var V=Math.cos(r.deg2rad(12)),G=g.lineSegment.create();return T}).apply(null,r))||(e.exports=n)},"ugP+":function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("zOht"),i("0LE5"),i("Rdxj"),i("2B1V"),i("tUyH"),i("FNtW"),i("CIy2"),i("s6rJ"),i("y+gz")],void 0===(n=(function(e,t,i,r,n,o,s,a,l,c,d){"use strict";var u=function(e){function t(t,i){var r=e.call(this,i)||this;return r.techniqueConfig=new d.MeasurementArrowTechniqueConfiguration,r.params=c.copyParameters(t,h),r}return i.__extends(t,e),t.prototype.getTechniqueConfig=function(){return this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig},t.prototype.dispose=function(){},t.prototype.setParameterValues=function(e){c.updateParameters(this.params,e)&&this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getPassParameters=function(){return this.params},t.prototype.intersect=function(){},t.prototype.createBufferWriter=function(){return new b},t.prototype.getGLMaterial=function(e){return 0===e.output?new p(e):void 0},t}(a.Material),p=function(e){function t(t){var i=e.call(this,t)||this;return i.updateParameters(),i}return i.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(d.MeasurementArrowTechnique,this.material.getTechniqueConfig(),this.technique)},t.prototype.beginSlot=function(e){return 3===e},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t}(s.GLMaterial),h={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1},_=o.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec3f(l.VertexAttrConstants.NORMAL).vec2f(l.VertexAttrConstants.UV0).f32(l.VertexAttrConstants.AUXPOS1),v=n.vec3f64.create(),m=n.vec3f64.create(),g=n.vec3f64.create(),f=n.vec3f64.create(),y=n.vec3f64.create(),b=function(){function e(){this.vertexBufferLayout=_}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 2*(e.indices[l.VertexAttrConstants.POSITION].length/2+1)},e.prototype.write=function(e,t,i,n){var o=t.vertexAttr[l.VertexAttrConstants.POSITION].data,s=t.vertexAttr[l.VertexAttrConstants.NORMAL].data,a=o.length/3,c=t&&t.indices&&t.indices.position;c&&c.length!==2*(a-1)&&console.warn("MeasurementArrowMaterial does not support indices");for(var d=v,u=m,p=g,h=f,_=y,b=e.transformation,w=e.invTranspTransformation,P=i.position,L=i.normal,M=i.uv0,O=0,D=0;D<a;++D){var j=3*D;if(r.vec3.set(d,o[j],o[j+1],o[j+2]),D<a-1){var S=3*(D+1);r.vec3.set(u,o[S],o[S+1],o[S+2]),r.vec3.set(_,s[S],s[S+1],s[S+2]),r.vec3.normalize(_,_),r.vec3.subtract(p,u,d),r.vec3.normalize(p,p),r.vec3.cross(h,_,p),r.vec3.normalize(h,h)}var C=r.vec3.distance(d,u);b&&w&&(r.vec3.transformMat4(d,d,b),r.vec3.transformMat4(u,u,b),r.vec3.transformMat4(h,h,w));var x=n+2*D,A=x+1;P.setVec(x,d),P.setVec(A,d),L.setVec(x,h),L.setVec(A,h),M.set(x,0,O),M.set(x,1,-1),M.set(A,0,O),M.set(A,1,1),D<a-1&&(O+=C)}var z=i.auxpos1;for(D=0;D<2*a;++D)z.set(n+D,O)},e}();return u}).apply(null,r))||(e.exports=n)},vl3m:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("zOht"),i("TMur"),i("eIBl"),i("jBNx"),i("8MXS"),i("Vx27"),i("xdO3"),i("B3XD"),i("85VY"),i("t0I+"),i("bz+r"),i("X7Ps")],void 0===(n=(function(e,t,i,r,n,o,s,a,l,c,d,u,p,h){"use strict";var _=function(e){function t(t){var i=e.call(this,t)||this;return i._handles=new n,i._cachedPickRequest=new u.PickRequest,i._cachedPickResult=new u.PickResult,i._isAnyPointerDown=!1,i.deferCreation=!0,i.startManipulator=null,i.endManipulator=null,i.model=new d({sceneView:t.view}),i}return i.__extends(t,e),t.prototype.initialize=function(){var e=this;this._view=new u(this.model);var t=s.init(this,"state",(function(t){"ready"!==t&&e.create(),"measured"===t&&e.complete()}),!0);this._handles.add(t);var i=this._view.createManipulators(),r=i.start,n=i.end,o=function(t,i,r){return p.createManipulatorDragEventPipeline(t,(function(t,n,o){var s=c.hideManipulatorWhileDragging(t);n.next(s).next(c.screenToMap3D(e.view)).next((function(e){return"start"!==e.action?e:null})).next((function(n){var o=l.clonePoint(n.mapEnd,v);e.model[i]=o,t.location=o,e.model[r]=e._surfaceLocation(o,n.surfaceType)})),o.next(s).next(p.resetProperties(e.model,[i,r])).next((function(){t.location=e.model[i]}))}))};this._handles.add([o(r,"startPoint","startPointSurfaceLocation"),o(n,"endPoint","endPointSurfaceLocation")]),[r,n].forEach((function(t){e._handles.add([t.events.on("grab-changed",(function(){var t=r.grabbing||n.grabbing;t&&"measured"===e.model.state&&(e.model.state="editing"),t||(e.model.finishMeasurement(),"editing"===e.model.state&&(e.model.state="measured"))}))])})),this.manipulators.add(r),this.manipulators.add(n),this.startManipulator=r,this.endManipulator=n},t.prototype.destroy=function(){this._view.destroy(),this._view=null,this._handles.destroy(),this._handles=null},Object.defineProperty(t.prototype,"state",{get:function(){return this.model.isMeasuring?"measured"===this.model.state?"measured":"measuring":"ready"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"creating",{get:function(){return"initial"===this.model.state||"drawing"===this.model.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSupported",{get:function(){return"3d"===this.get("view.type")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{get:function(){return!this.model.active||"drawing"!==this.model.state&&"initial"!==this.model.state?null:"crosshair"},enumerable:!1,configurable:!0}),t.prototype.activate=function(){this.model.active=!0},t.prototype.deactivate=function(){this.model.active=!1},t.prototype.onDetach=function(){this.model.reset()},t.prototype.onShow=function(){this._view.show(),this._updateManipulatorVisibility()},t.prototype.onHide=function(){this._view.hide()},t.prototype.onInputEvent=function(e){switch(e.type){case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"pointer-down":this._handlePointerDown();break;case"pointer-up":this._handlePointerUp()}this._updateManipulatorVisibility()},t.prototype._handlePointerMove=function(e){this._clearCachedPickRequest();var t=o.createScreenPointFromEvent(e);"mouse"===e.pointerType&&(this._hoverAt(t),"drawing"===this.model.state&&(this.endManipulator.events.emit("drag",{action:"update",start:t,screenPoint:t}),e.stopPropagation()))},t.prototype._handlePointerDown=function(){this._isAnyPointerDown=!0},t.prototype._handlePointerUp=function(){this._isAnyPointerDown=!1},t.prototype._handleImmediateClick=function(e){if(this._clearCachedPickRequest(),function(e){return"mouse"!==e.pointerType||0===e.button}(e)){var t=o.createScreenPointFromEvent(e),i=!1;if(this.model.active)switch(this.model.state){case"initial":this.startManipulator.events.emit("drag",{action:"start",start:t,screenPoint:t}),this.startManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),this.model.startPoint&&(this.startManipulator.interactive=!1,this.endManipulator.interactive=!1,this.model.state="drawing",this.endManipulator.events.emit("drag",{action:"start",start:t,screenPoint:t}),i=!0);break;case"drawing":this.endManipulator.events.emit("drag",{action:"update",start:t,screenPoint:t}),null!=this.model.endPoint&&(this.endManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),this.startManipulator.interactive=!0,this.endManipulator.interactive=!0,this.model.finishMeasurement(),i=!0)}i&&e.stopPropagation(),"mouse"===e.pointerType&&this._hoverAt(t)}},t.prototype._hoverAt=function(e){if(!this._view.requiresCursorPoint||this._isAnyPointerDown&&"drawing"!==this.model.state&&"editing"!==this.model.state)this.model.cursorPoint=null;else{var t=this._pick(e);t.mapPoint&&(this.model.cursorPoint=t.mapPoint)}},t.prototype._pick=function(e){var t=this._cachedPickRequest.screenPoint;return t&&t.x===e.x&&t.y===e.y||(this._cachedPickRequest.screenPoint=e,this._cachedPickResult=this._view.pick(this._cachedPickRequest)),this._cachedPickResult},t.prototype._clearCachedPickRequest=function(){this._cachedPickRequest.screenPoint=null},t.prototype._surfaceLocation=function(e,t){return 0===t?"on-the-surface":e.z>=this._view.getElevation(e)?"above-the-surface":"below-the-surface"},t.prototype._updateManipulatorVisibility=function(){this.startManipulator.available=null!=this.model.startPoint,this.endManipulator.available=null!=this.model.endPoint},i.__decorate([a.property({dependsOn:["model.isMeasuring","model.state"],readOnly:!0})],t.prototype,"state",null),i.__decorate([a.property({dependsOn:["model.state"],readOnly:!0})],t.prototype,"creating",null),i.__decorate([a.property({dependsOn:["view.type"],readOnly:!0})],t.prototype,"isSupported",null),i.__decorate([a.property({dependsOn:["model.active","model.state"],readOnly:!0})],t.prototype,"cursor",null),i.__decorate([a.property({constructOnly:!0})],t.prototype,"model",void 0),i.__decorate([a.aliasOf("model.mode")],t.prototype,"mode",void 0),i.__decorate([a.aliasOf("model.unit")],t.prototype,"unit",void 0),i.__decorate([a.aliasOf("model.directDistance")],t.prototype,"directDistance",void 0),i.__decorate([a.aliasOf("model.validMeasurement")],t.prototype,"validMeasurement",void 0),i.__decorate([a.aliasOf("model.horizontalDistance")],t.prototype,"horizontalDistance",void 0),i.__decorate([a.aliasOf("model.verticalDistance")],t.prototype,"verticalDistance",void 0),i.__decorate([a.aliasOf("model.geodesicDistance")],t.prototype,"geodesicDistance",void 0),i.__decorate([a.aliasOf("model.geodesicAngle")],t.prototype,"geodesicAngle",void 0),i.__decorate([a.aliasOf("model.triangleView")],t.prototype,"triangleView",void 0),i.__decorate([a.subclass("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DTool")],t)}(h.InteractiveToolBase),v=new r.Point;return _}).apply(null,r))||(e.exports=n)},"y+gz":function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("zOht"),i("2NOe"),i("W/V4"),i("FQ4r"),i("lBa0"),i("ff/U"),i("SjTO"),i("G0ER"),i("qbr3"),i("2Kdy")],void 0===(n=(function(e,t,r,n,o,s,a,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MeasurementArrowTechniqueConfiguration=t.MeasurementArrowTechnique=void 0;var p=function(e){function t(t,i){return e.call(this,t,i)||this}return r.__extends(t,e),t.prototype.initializeProgram=function(e){var i=t.shader.get().build();return new d(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),l.Default3D)},t.prototype.bindPass=function(e,t,i){n.View.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("width",t.width),this.program.setUniform1f("outlineSize",t.outlineSize),this.program.setUniform4fv("outlineColor",t.outlineColor),this.program.setUniform1f("stripeLength",t.stripeLength),this.program.setUniform4fv("stripeEvenColor",t.stripeEvenColor),this.program.setUniform4fv("stripeOddColor",t.stripeOddColor)},t.prototype.bindDraw=function(e){n.View.bindView(this.program,e)},t.prototype.initializePipeline=function(){return u.makePipelineState({polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},depthWrite:u.defaultDepthWriteParams,colorWrite:u.defaultColorWriteParams})},Object.defineProperty(t.prototype,"primitiveType",{get:function(){return 5},enumerable:!1,configurable:!0}),t.shader=new o.ReloadableShaderModule(c,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[i("SjTO")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(s.ShaderTechnique);t.MeasurementArrowTechnique=p;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.polygonOffsetEnabled=!1,t}return r.__extends(t,e),r.__decorate([a.parameter()],t.prototype,"polygonOffsetEnabled",void 0),t}(a.ShaderTechniqueConfiguration);t.MeasurementArrowTechniqueConfiguration=h}).apply(null,r))||(e.exports=n)}}]);