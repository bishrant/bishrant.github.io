!function(){var e,t,n,r,a,o,i,s,c,u,l,d,f,p,m,v,h,b,g,x,y,O,w,T,C,S,M,R,j,_,A,k,I,P,L,B,F,E,N,D,z,V,U,G,H,q,W,J,X,Y,K,Q,Z,$,ee,te,ne,re,ae,oe,ie,se,ce,ue,le,de,fe,pe,me,ve,he,be,ge,xe,ye,Oe,we,Te,Ce,Se,Me,Re,je,_e,Ae,ke,Ie,Pe,Le,Be,Fe,Ee,Ne,De,ze,Ve,Ue,Ge,He,qe,We,Je,Xe,Ye,Ke,Qe,Ze,$e,et,tt,nt,rt,at,ot,it,st,ct,ut,lt,dt,ft,pt,mt,vt,ht,bt,gt,xt,yt,Ot,wt,Tt,Ct,St,Mt,Rt,jt,_t;function At(e){return function(e){if(Array.isArray(e))return Pt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||It(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=It(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function It(e,t){if(e){if("string"==typeof e)return Pt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pt(e,t):void 0}}function Pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Lt(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,a)}function Bt(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function i(e){Lt(o,r,a,i,s,"next",e)}function s(e){Lt(o,r,a,i,s,"throw",e)}i(void 0)})}}function Ft(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ft(Object(n),!0).forEach(function(t){Nt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ft(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Dt(e,t,n){return(Dt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ht(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function zt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vt(e,t)}function Vt(e,t){return(Vt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ut(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Ht(e);if(t){var a=Ht(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Gt(this,n)}}function Gt(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ht(e){return(Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wt(e,t,n){return t&&qt(e.prototype,t),n&&qt(e,n),e}function Jt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xt(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{"0BfS":function(t,n,r){"use strict";r.d(n,"a",function(){return s});var a,o=r("OIYi"),i=r("UBvB");function s(t){t.fragment.include(i.a),t.fragment.uniforms.add("uShadowMapTex","sampler2D"),t.fragment.uniforms.add("uShadowMapNum","int"),t.fragment.uniforms.add("uShadowMapDistance","vec4"),t.fragment.uniforms.add("uShadowMapMatrix","mat4",4),t.fragment.uniforms.add("uDepthHalfPixelSz","float"),t.fragment.code.add(o.a(e||(e=Xt(["\n    int chooseCascade(float _linearDepth, out mat4 mat) {\n      vec4 distance = uShadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];\n\n      return i;\n    }\n\n    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n      return 0.5 * lv.xyz + vec3(0.5);\n    }\n\n    vec2 cascadeCoordinates(int i, vec3 lvpos) {\n      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n    }\n\n    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {\n      return rgba2float(texture2D(_depthTex, uv));\n    }\n\n    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {\n      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;\n    }\n\n    float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);\n      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);\n      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);\n      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      mat4 mat;\n      int i = chooseCascade(_linearDepth, mat);\n\n      if (i >= uShadowMapNum) { return 0.0; }\n\n      vec3 lvpos = lightSpacePosition(_vpos, mat);\n\n      // vertex completely outside? -> no shadow\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = cascadeCoordinates(i, lvpos);\n\n      return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);\n    }\n  "]))))}(a=s||(s={})).bindUniforms=function(e,t,n){t.shadowMappingEnabled&&(t.shadowMap.bind(e,n),t.shadowMap.bindView(e,t.origin))},a.bindViewCustomOrigin=function(e,t,n){t.shadowMappingEnabled&&t.shadowMap.bindView(e,n)},a.bindView=function(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}},"1TnO":function(e,c,u){"use strict";u.d(c,"a",function(){return v});var l,d=u("Cy1f"),f=u("OIYi"),p=u("mmTy"),m=u("aiF/");function v(e,c){c.instanced&&c.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3")),c.instancedDoublePrecision&&(e.vertex.include(m.a,c),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));var u=[f.a(t||(t=Xt(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "])),c.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"),f.a(n||(n=Xt(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),c.instancedDoublePrecision?f.a(r||(r=Xt(["\n          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):"return vpos;"),f.a(a||(a=Xt(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),c.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"),f.a(o||(o=Xt(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),c.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"),c.vertexTangets?f.a(i||(i=Xt(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n\n    }\n    "])),c.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"):f.a(s||(s=Xt([""])))];e.vertex.code.add(u[0]),e.vertex.code.add(u[1]),e.vertex.code.add(u[2]),2===c.output&&e.vertex.code.add(u[3]),e.vertex.code.add(u[4])}(l=v||(v={})).Uniforms=function(){return function e(){Jt(this,e)}}(),l.bindCustomOrigin=function(e,t){Object(p.b)(t,h,b,3),e.setUniform3fv("viewOriginHi",h),e.setUniform3fv("viewOriginLo",b)};var h=Object(d.e)(),b=Object(d.e)()},"1W42":function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n("wSAH");var r=n("OIYi");function a(e,t){r.a(c||(c=Xt(["\n  /*\n  *  ","\n  *  ","\n  */\n  "])),t.name,0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":"")}},"368d":function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n("OIYi");function a(e,t){1===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(r.a(u||(u=Xt(["\n      void forwardTextureCoordinates() {\n        vuv0 = uv0;\n      }\n    "]))))),2===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(r.a(l||(l=Xt(["\n      void forwardTextureCoordinates() {\n        vuv0 = uv0;\n        vuvRegion = uvRegion;\n      }\n    "]))))),0===t.attributeTextureCoordinates&&e.vertex.code.add(r.a(d||(d=Xt(["\n      void forwardTextureCoordinates() {}\n    "]))))}},"6kvK":function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n("OIYi"),a=n("xRv2"),o=n("0BfS"),i=n("XV/G"),s=n("cIib");function c(e,t){var n=e.fragment,a=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===a?(n.uniforms.add("lightingAmbientSH0","vec3"),n.code.add(r.a(f||(f=Xt(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):1===a?(n.uniforms.add("lightingAmbientSH_R","vec4"),n.uniforms.add("lightingAmbientSH_G","vec4"),n.uniforms.add("lightingAmbientSH_B","vec4"),n.code.add(r.a(p||(p=Xt(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 = vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight = vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):2===a&&(n.uniforms.add("lightingAmbientSH0","vec3"),n.uniforms.add("lightingAmbientSH_R1","vec4"),n.uniforms.add("lightingAmbientSH_G1","vec4"),n.uniforms.add("lightingAmbientSH_B1","vec4"),n.uniforms.add("lightingAmbientSH_R2","vec4"),n.uniforms.add("lightingAmbientSH_G2","vec4"),n.uniforms.add("lightingAmbientSH_B2","vec4"),n.code.add(r.a(m||(m=Xt(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 = vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 = vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight += vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight += vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "])))),1!==t.pbrMode&&2!==t.pbrMode||n.code.add(r.a(v||(v=Xt(["\n        const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "])))))}function u(e){var t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.code.add(r.a(h||(h=Xt(["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal = clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "]))))}function l(e,t){var n=e.fragment;e.include(u),e.include(s.a,t),0!==t.pbrMode&&e.include(i.a,t),e.include(c,t),t.receiveShadows&&e.include(o.a,t),n.uniforms.add("lightingGlobalFactor","float"),n.uniforms.add("ambientBoostFactor","float"),e.include(a.a),n.code.add(r.a(b||(b=Xt(["\n    const float GAMMA_SRGB = 2.1;\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ","\n  "])),0===t.pbrMode?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);")),t.useOldSceneLightInterface?n.code.add(r.a(g||(g=Xt(["\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot = -0.5;\n        float dotRange = 1.0 - minDot;\n        float dotNormalization = 0.66; // guessed & hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal = dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal = clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight = calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC = pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight = mainLight + ambientLight + additionalLight;\n      totalLight = min(totalLight, vec3(PI));\n      vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor = pow(outColor, vec3(INV_GAMMA_SRGB));\n\n      return outColor;\n    }\n  "])))):(n.code.add(1===t.viewingMode?r.a(x||(x=Xt(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld = normalize(vPosWorld);\n        float vndl = -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "]))):r.a(y||(y=Xt(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl = -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))),n.code.add(r.a(O||(O=Xt(["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale = _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "])))),0===t.pbrMode||4===t.pbrMode?n.code.add(r.a(w||(w=Xt(["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting = evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        vec3 baseColorLinear = pow(baseColor, vec3(GAMMA_SRGB));\n\n        // physically correct BRDF normalizes by PI\n        vec3 totalLight = mainLighting + ambientLighting + additionalLight;\n        totalLight = min(totalLight, vec3(PI));\n        vec3 outColor = vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor = pow(outColor, vec3(INV_GAMMA_SRGB));\n\n        return outColor;\n      }\n      "])))):1!==t.pbrMode&&2!==t.pbrMode||(n.code.add(r.a(T||(T=Xt(["\n      const float fillLightIntensity = 0.25;\n      const float horizonLightDiffusion = 0.4;\n      const float additionalAmbientIrradianceFactor = 0.02;\n\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection = -viewDir;\n        vec3 mainLightDirection = -lightingMainDirection;\n        vec3 h = normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView = normalize(reflect(viewDirection, normal));\n        inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\n        inputs.ssao = ssao;\n\n        inputs.metalness = mrr[0];\n        inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);\n      "])))),n.code.add(r.a(C||(C=Xt(["\n        inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 = 1.0\n        inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "])))),n.code.add(r.a(S||(S=Xt(["\n        vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\n        ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\n\n        inputs.NdotAmbDir = abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "])))),n.code.add(r.a(M||(M=Xt(["\n        vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH = normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon = dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    =  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);\n        "])))),n.code.add(r.a(R||(R=Xt(["\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "])),2===t.pbrMode?r.a(j||(j=Xt(["vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));"]))):r.a(_||(_=Xt(["vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"])))))))}},AxBq:function(e,t,n){"use strict";n.d(t,"a",function(){return Q}),n.d(t,"b",function(){return K});var r=n("OIYi"),a=n("Tbkp"),o=n("aQrP"),i=n("0nJL"),s=n("0Ect"),c=n("viRi"),u=n("69UF"),l=n("F7CJ"),d=n("xtdb"),f=n("0BfS"),p=n("vXUg"),m=n("XV/G"),v=n("1TnO"),h=n("368d"),b=n("p9cc"),g=n("F8o4"),x=n("wzLF"),y=n("sJp1"),O=n("bLIi"),w=n("bVvB"),T=n("fRF2"),C=n("fiGu"),S=n("DXpj"),M=n("cIib"),R=n("6kvK"),j=n("qrV2"),_=n("1W42"),Y=n("NiZE");function K(e){var t=new o.a,n=t.vertex.code,K=t.fragment.code;return t.include(_.a,{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(y.a),t.varyings.add("vpos","vec3"),t.include(c.a,e),t.include(v.a,e),t.include(l.a,e),0!==e.output&&7!==e.output||(t.include(x.a,e),t.include(a.a,{linearDepth:!1}),0===e.normalType&&e.offsetBackfaces&&t.include(g.a),t.include(S.a,e),t.include(T.a,e),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("localvpos","vec3"),t.include(h.a,e),t.include(p.a,e),t.include(O.a,e),t.include(w.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),n.add(r.a(A||(A=Xt(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt = externalColor;\n        ","\n        vcolorExt *= vvColor();\n        vcolorExt *= getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a < ",") {\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos = calculateVPos();\n          localvpos = vpos - view[3].xyz;\n          vpos = subtractOrigin(vpos);\n          ","\n          vpos = addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position = transformPosition(proj, view, vpos);\n          ","\n        }\n\n        ","\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),e.instancedColor?"vcolorExt *= instanceColor;":"",r.a.float(u.c),0===e.normalType?r.a(k||(k=Xt(["\n          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));"]))):"",e.vertexTangets?"vTangent = dpTransformVertexTangent(tangent);":"",0===e.normalType&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""))),7===e.output&&(t.include(i.a,e),t.include(u.a,e),e.multipassTerrainEnabled&&(t.fragment.include(s.a),t.include(d.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(Y.a),K.add(r.a(I||(I=Xt(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?r.a(P||(P=Xt(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):r.a(L||(L=Xt(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?r.a(B||(B=Xt(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):r.a(F||(F=Xt(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(i.a,e),t.include(R.a,e),t.include(M.a,e),t.include(u.a,e),e.receiveShadows&&t.include(f.a,e),e.multipassTerrainEnabled&&(t.fragment.include(s.a),t.include(d.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(b.a,e),t.include(m.a,e),t.fragment.include(Y.a),t.include(j.a,e),K.add(r.a(E||(E=Xt(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        ","\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?r.a(N||(N=Xt(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):r.a(D||(D=Xt(["vec4 texColor = vec4(1.0);"]))),3===e.normalType?r.a(z||(z=Xt(["\n        vec3 normal = screenDerivativeNormal(localvpos);"]))):r.a(V||(V=Xt(["\n        shadingParams.normalView = vNormalWorld;\n        vec3 normal = shadingNormal(shadingParams);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?r.a(U||(U=Xt(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):r.a(G||(G=Xt(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),e.hasNormalTexture?r.a(H||(H=Xt(["\n              mat3 tangentSpace = ","\n              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);"])),e.vertexTangets?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal = normal;",1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?r.a(q||(q=Xt(["vec3 normalGround = normalize(vpos + localOrigin);"]))):r.a(W||(W=Xt(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):r.a(J||(J=Xt([""]))),1===e.pbrMode||2===e.pbrMode?r.a(X||(X=Xt(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(C.a,e),t}var Q=Object.freeze({__proto__:null,build:K})},DXpj:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n("OIYi"),a=n("fLTx");function o(e,t){var n=e.fragment;n.uniforms.add("normalTexture","sampler2D"),n.uniforms.add("normalTextureSize","vec2"),t.vertexTangets?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),n.code.add(2===t.doubleSidedMode?r.a(Y||(Y=Xt(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "]))):r.a(K||(K=Xt(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = vTangent.w;\n        vec3 tangent = normalize(vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "]))))):(e.extensions.add("GL_OES_standard_derivatives"),n.code.add(r.a(Q||(Q=Xt(['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 = dFdx(pos);\n      vec3 Q2 = dFdy(pos);\n\n      vec2 stx = dFdx(st);\n      vec2 sty = dFdy(st);\n\n      float det = stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T = stx.t * Q2 - sty.t * Q1; // compute tangent\n      T = T - normal * dot(normal, T); // orthogonalize tangent\n      T *= inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B = sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  ']))))),0!==t.attributeTextureCoordinates&&(e.include(a.a,t),n.code.add(r.a(Z||(Z=Xt(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv = uv;\n      ","\n      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),t.supportsTextureAtlas?"vtc.size = normalTextureSize;":"")))}},F8o4:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n("OIYi");function a(e){e.vertex.code.add(r.a($||($=Xt(["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert = posWorld - camPosWorld;\n\n      bool isBackface = dot(camToVert, normalWorld) > 0.0;\n      if (isBackface) {\n        posClip.z += 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "]))))}},NiZE:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n("OIYi"),a=n("Q3fD");function o(e){e.include(a.a),e.code.add(r.a(ee||(ee=Xt(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed = internalColor * textureColor;\n      vec3 allMixed = internalMixed * externalColor;\n\n      if (mode == ",") {\n        return allMixed;\n      }\n      else if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn = rgb2v(internalMixed);\n        vec3 hsvTint = rgb2hsv(externalColor);\n        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed = internalOpacity * textureOpacity;\n      float allMixed = internalMixed * externalOpacity;\n\n      if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),r.a.int(1),r.a.int(2),r.a.int(3),r.a.int(2),r.a.int(3)))}},"XV/G":function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n("OIYi"),a=n("xRv2");function o(e){var t=e.fragment.code;t.add(r.a(te||(te=Xt(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "])))),t.add(r.a(ne||(ne=Xt(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "])))),t.add(r.a(re||(re=Xt(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))}function i(e,t){var n=e.fragment.code;e.include(a.a),3===t.pbrMode||4===t.pbrMode?(n.add(r.a(ae||(ae=Xt(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "])),t.useCustomDTRExponentForWater?"2.2":"2.0")),n.add(r.a(oe||(oe=Xt(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),n.add(r.a(ie||(ie=Xt(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),n.add(r.a(se||(se=Xt(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),n.add(r.a(ce||(ce=Xt(["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  = 1.2;\n      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))))):1!==t.pbrMode&&2!==t.pbrMode||(e.include(o),n.add(r.a(ue||(ue=Xt(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),n.add(r.a(le||(le=Xt(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),n.add(r.a(de||(de=Xt(["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),n.add(r.a(fe||(fe=Xt(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),n.add(r.a(pe||(pe=Xt(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"])))),n.add(r.a(me||(me=Xt(["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "])))))}},"aiF/":function(e,t,n){"use strict";n.d(t,"a",function(){return b}),n.d(t,"b",function(){return g});var r=n("wSAH"),a=n("OIYi"),o=n("srIe"),i=(n("OKTS"),n("Cy1f")),s=n("jjdI"),c=n("EVMh"),u=n("fOQB"),l=n("D6bk"),d=n("mmTy"),f=n("0meK"),p=n("N3sV"),m=function(){function e(t){var n=this;Jt(this,e),this.context=t,this.svgAlwaysPremultipliesAlpha=!1,this._doublePrecisionRequiresObfuscation=null,Object(p.a)(t).then(function(e){n.svgAlwaysPremultipliesAlpha=!e})}return Wt(e,[{key:"doublePrecisionRequiresObfuscation",get:function(){if(Object(o.j)(this._doublePrecisionRequiresObfuscation)){var e=h(this.context,!1),t=h(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation}}]),e}(),v=null;function h(e,t){var n=new f.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),r=u.a.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),a=new l.a(e,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:r}),o=Object(i.g)(5633261.287538229,2626832.878767164,1434988.0495278358),p=Object(i.g)(5633271.46742708,2626873.6381334523,1434963.231608387),m=function(n,r){var a=new s.a(e,"\n\n  precision highp float;\n\n  attribute vec2 a_pos;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ".concat(t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"","\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  "),"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",{a_pos:0}),o=new Float32Array(6);Object(d.a)(n,o,3);var i=new Float32Array(6);return Object(d.a)(r,i,3),e.bindProgram(a),a.setUniform3f("u_highA",o[0],o[2],o[4]),a.setUniform3f("u_lowA",o[1],o[3],o[5]),a.setUniform3f("u_highB",i[0],i[2],i[4]),a.setUniform3f("u_lowB",i[1],i[3],i[5]),a}(o,p),v=e.getBoundFramebufferObject(),h=e.getViewport(),b=h.x,g=h.y,x=h.width,y=h.height;e.bindFramebuffer(n),e.setViewport(0,0,1,1),e.bindVAO(a),e.drawArrays(5,0,4);var O=new Uint8Array(4);n.readPixels(0,0,1,1,6408,5121,O),m.dispose(),a.dispose(!1),r.dispose(),n.dispose(),e.setViewport(b,g,x,y),e.bindFramebuffer(v);var w=(o[2]-p[2])/25,T=Object(c.k)(O);return Math.abs(w-T)}function b(e,t){e.code.add(t.doublePrecisionRequiresObfuscation?a.a(ve||(ve=Xt(["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 = dpPlusFrc(hiA, hiB);\n        vec3 e = dpMinusFrc(t1, hiA);\n        vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "]))):a.a(he||(he=Xt(["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 = hiA + hiB;\n        vec3 e = t1 - hiA;\n        vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "]))))}function g(e){return!!Object(r.a)("force-double-precision-obfuscation")||(t=e,(Object(o.j)(v)||v.context!==t)&&(v=new m(t)),v).doublePrecisionRequiresObfuscation;var t}},bLIi:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n("OIYi");function a(e){e.vertex.code.add(r.a(be||(be=Xt(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha = 0.0;\n\n      const float maxTint = 85.0;\n      const float maxReplace = 170.0;\n      const float scaleAlpha = 3.0;\n\n      if (symbolColor.a > maxReplace) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a > maxTint) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a > 0.0) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode = ",";\n        symbolAlpha = 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),r.a.int(1),r.a.int(3),r.a.int(4),r.a.int(1)))}function o(e,t){t.symbolColor?(e.include(a),e.attributes.add("symbolColor","vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),e.vertex.code.add(t.symbolColor?r.a(ge||(ge=Xt(["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode = float(symbolColorMixMode) + 0.5;\n    }\n  "]))):r.a(xe||(xe=Xt(["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "]))))}},cIib:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n("OIYi");function a(e,t){var n=e.fragment;t.receiveAmbientOcclusion?(n.uniforms.add("ssaoTex","sampler2D"),n.uniforms.add("viewportPixelSz","vec4"),n.code.add(r.a(ye||(ye=Xt(["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n      }\n    "]))))):n.code.add(r.a(Oe||(Oe=Xt(["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "]))))}},fLTx:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n("OIYi"),a=n("368d");function o(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(r.a(we||(we=Xt(["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      // clamp the derivatives to avoid discoloring when zooming out.\n      float maxdUV = 0.125; // Emprirically tuned compromise between discoloring and aliasing noise.\n      vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\n      vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto = dFdx(uvAtlas);\n        vec2 dUVdyAuto = dFdy(uvAtlas);\n        float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "]))))}function i(e,t){e.include(a.a,t),e.fragment.code.add(r.a(Te||(Te=Xt(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),t.supportsTextureAtlas?"vec2 size;":"")),1===t.attributeTextureCoordinates&&e.fragment.code.add(r.a(Ce||(Ce=Xt(["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "])))),2===t.attributeTextureCoordinates&&(e.include(o),e.fragment.code.add(r.a(Se||(Se=Xt(["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "])))))}},fRF2:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var r,a=n("OIYi"),o=n("wzLF"),i=n("Cy1f"),s=n("2uVf"),c=n("r+FG"),u=n("aiF/"),l=n("sJp1");function d(e,t){e.include(l.a),e.vertex.include(u.a,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3"),e.vertex.uniforms.add("uTransform_ProjFromView","mat4"),e.vertex.code.add(a.a(Me||(Me=Xt(["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel = dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative = positionWorldCameraRelative();\n      vPosition_view = position_view();\n      gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "])))),e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.fragment.code.add(a.a(Re||(Re=Xt(["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]))))}function f(e,t){0===t.normalType||1===t.normalType?(e.include(o.a,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),e.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),e.vertex.code.add(a.a(je||(je=Xt(["\n      void forwardNormal() {\n        vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "]))))):2===t.normalType?(e.include(d,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(a.a(_e||(_e=Xt(["\n    void forwardNormal() {\n      vNormalWorld = ","\n    }\n    "])),1===t.viewingMode?a.a(Ae||(Ae=Xt(["normalize(vPositionWorldCameraRelative);"]))):a.a(ke||(ke=Xt(["vec3(0.0, 0.0, 1.0);"])))))):e.vertex.code.add(a.a(Ie||(Ie=Xt(["\n      void forwardNormal() {}\n    "]))))}(r=d||(d={})).ModelTransform=function(){return function e(){Jt(this,e),this.worldFromModel_RS=Object(s.a)(),this.worldFromModel_TH=Object(i.e)(),this.worldFromModel_TL=Object(i.e)()}}(),r.ViewProjectionTransform=function(){return function e(){Jt(this,e),this.worldFromView_TH=Object(i.e)(),this.worldFromView_TL=Object(i.e)(),this.viewFromCameraRelative_RS=Object(s.a)(),this.projFromView=Object(c.b)()}}(),r.bindModelTransform=function(e,t){e.setUniformMatrix3fv("uTransform_WorldFromModel_RS",t.worldFromModel_RS),e.setUniform3fv("uTransform_WorldFromModel_TH",t.worldFromModel_TH),e.setUniform3fv("uTransform_WorldFromModel_TL",t.worldFromModel_TL)},r.bindViewProjTransform=function(e,t){e.setUniform3fv("uTransform_WorldFromView_TH",t.worldFromView_TH),e.setUniform3fv("uTransform_WorldFromView_TL",t.worldFromView_TL),e.setUniformMatrix4fv("uTransform_ProjFromView",t.projFromView),e.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",t.viewFromCameraRelative_RS)},(f||(f={})).bindUniforms=function(e,t){e.setUniformMatrix4fv("viewNormal",t)}},fiGu:function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n("OIYi"),a=n("Tbkp"),o=n("0nJL"),i=n("agdK"),s=n("viRi"),c=n("69UF"),u=n("wtEh"),l=n("368d"),d=n("wzLF"),f=n("fRF2");function p(e,t){var n=e.vertex.code,p=e.fragment.code;1!==t.output&&3!==t.output||(e.include(a.a,{linearDepth:!0}),e.include(l.a,t),e.include(s.a,t),e.include(u.a,t),e.include(o.a,t),e.vertex.uniforms.add("cameraNearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),n.add(r.a(Pe||(Pe=Xt(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "])))),e.include(c.a,t),p.add(r.a(Le||(Le=Xt(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),t.hasColorTexture?r.a(Be||(Be=Xt(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):""))),2===t.output&&(e.include(a.a,{linearDepth:!1}),e.include(d.a,t),e.include(f.a,t),e.include(l.a,t),e.include(s.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),n.add(r.a(Fe||(Fe=Xt(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        ","\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])),0===t.normalType?r.a(Ee||(Ee=Xt(["\n        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));"]))):"")),e.include(o.a,t),e.include(c.a,t),p.add(r.a(Ne||(Ne=Xt(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),t.hasColorTexture?r.a(De||(De=Xt(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",3===t.normalType?r.a(ze||(ze=Xt(["\n            vec3 normal = screenDerivativeNormal(vPositionView);"]))):r.a(Ve||(Ve=Xt(["\n            vec3 normal = normalize(vNormalWorld);\n            if (gl_FrontFacing == false) normal = -normal;"])))))),4===t.output&&(e.include(a.a,{linearDepth:!1}),e.include(l.a,t),e.include(s.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),n.add(r.a(Ue||(Ue=Xt(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])))),e.include(o.a,t),e.include(c.a,t),e.include(i.a),p.add(r.a(Ge||(Ge=Xt(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),t.hasColorTexture?r.a(He||(He=Xt(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"")))}},lKY1:function(e,t,n){"use strict";n.r(t),n.d(t,"fetch",function(){return pt}),n.d(t,"gltfToEngineResources",function(){return ht}),n.d(t,"parseUrl",function(){return vt});var r=n("srIe"),a=n("Cy1f"),o=n("5DEt"),i=n("15Hh"),s=n("SbiP"),c=n("2uVf"),u=n("r+FG"),l=n("HJJS"),d=n("VeZB"),f=n("6S2I"),p=f.a.getLogger("esri.views.3d.support.buffer.math");function m(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],s=n[4],c=n[5],u=n[6],l=n[8],d=n[9],f=n[10],m=n[12],v=n[13],h=n[14],b=e.typedBuffer,g=e.typedBufferStride,x=t.typedBuffer,y=t.typedBufferStride,O=0;O<r;O++){var w=O*g,T=O*y,C=x[T],S=x[T+1],M=x[T+2];b[w]=a*C+s*S+l*M+m,b[w+1]=o*C+c*S+d*M+v,b[w+2]=i*C+u*S+f*M+h}else p.error("source and destination buffers need to have the same number of elements")}function v(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],s=n[3],c=n[4],u=n[5],l=n[6],d=n[7],f=n[8],m=e.typedBuffer,v=e.typedBufferStride,h=t.typedBuffer,b=t.typedBufferStride,g=0;g<r;g++){var x=g*v,y=g*b,O=h[y],w=h[y+1],T=h[y+2];m[x]=a*O+s*w+l*T,m[x+1]=o*O+c*w+d*T,m[x+2]=i*O+u*w+f*T}else p.error("source and destination buffers need to have the same number of elements")}function h(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,c=0;c<r;c++){var u=c*o,l=c*s;a[u]=n*i[l],a[u+1]=n*i[l+1],a[u+2]=n*i[l+2]}}Object.freeze({__proto__:null,transformMat4:m,transformMat3:v,scale:h,shiftRight:function(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,c=0;c<r;c++){var u=c*o,l=c*s;a[u]=i[l]>>n,a[u+1]=i[l+1]>>n,a[u+2]=i[l+2]>>n}}});var b=n("QmHG"),g=n("Ango"),x=n("/ADo"),y=n("qXiY"),O=n("aK8v"),w=n("fFEv"),T=n("NbNv"),C=n("WVfK"),S=n("69UF"),M=n("dDjh"),R=n("pO5D"),j=n("w6Td"),_=n("ypgp"),A=n("2jVe"),k=n("+h6m"),I=n("jjdI"),P=n("GJyJ"),L=n("jpeq"),B=n("0nJL"),F=n("agdK"),E=n("viRi"),N=n("F7CJ"),D=n("xtdb"),z=n("h7dw"),V=n("0BfS"),U=n("aiF/"),G=n("1TnO"),H=n("p9cc"),q=n("AxBq"),W=function(e){zt(n,e);var t=Ut(n);function n(){return Jt(this,n),t.apply(this,arguments)}return Wt(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,a=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:r.usePBR?r.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:r.hasMetalnessAndRoughnessTexture,hasEmissionTexture:r.hasEmissionTexture,hasOcclusionTexture:r.hasOcclusionTexture,hasNormalTexture:r.hasNormalTexture,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:r.normalsTypeDerivate?3:0,doubleSidedMode:r.doubleSidedMode,vertexTangets:r.vertexTangents,attributeTextureCoordinates:r.hasMetalnessAndRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture||r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(U.b)(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new I.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),k.a)}},{key:"bindPass",value:function(e,t,n){L.a.bindProjectionMatrix(this.program,n.camera.projectionMatrix);var r=this.configuration.output;(1===this.configuration.output||n.multipassTerrainEnabled||3===r)&&this.program.setUniform2fv("cameraNearFar",n.camera.nearFar),n.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",n.inverseViewport),Object(D.a)(this.program,e,n)),7===r&&(this.program.setUniform1f("opacity",t.opacity),this.program.setUniform1f("layerOpacity",t.layerOpacity),this.program.setUniform4fv("externalColor",t.externalColor),this.program.setUniform1i("colorMixMode",w.b[t.colorMixMode])),0===r?(n.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",t.ambient),this.program.setUniform3fv("diffuse",t.diffuse),this.program.setUniform4fv("externalColor",t.externalColor),this.program.setUniform1i("colorMixMode",w.b[t.colorMixMode]),this.program.setUniform1f("opacity",t.opacity),this.program.setUniform1f("layerOpacity",t.layerOpacity),this.configuration.usePBR&&H.a.bindUniforms(this.program,t,this.configuration.isSchematic)):4===r&&F.a.bindOutputHighlight(e,this.program,n),E.a.bindUniformsForSymbols(this.program,t),N.a.bindUniforms(this.program,t,n),Object(w.a)(t.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),2!==t.textureAlphaMode&&3!==t.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",t.textureAlphaCutoff)}},{key:"bindDraw",value:function(e){var t=this.configuration.instancedDoublePrecision?Object(a.g)(e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]):e.origin;L.a.bindViewCustomOrigin(this.program,t,e.camera.viewMatrix),(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&L.a.bindCamPosition(this.program,t,e.camera.viewInverseTransposeMatrix),2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&G.a.bindCustomOrigin(this.program,t),B.a.bindUniforms(this.program,this.configuration,e.slicePlane,t),0===this.configuration.output&&V.a.bindViewCustomOrigin(this.program,e,t)}},{key:"setPipeline",value:function(e,t){var n=this.configuration,r=3===e,a=2===e;return Object(P.d)({blending:0!==n.output&&7!==n.output||!n.transparent?null:r?M.f:Object(M.a)(e),culling:J(n),depthTest:{func:Object(M.b)(e)},depthWrite:r||a?n.writeDepth&&P.c:null,colorWrite:P.b,stencilWrite:n.sceneHasOcludees?z.h:null,stencilTest:n.sceneHasOcludees?t?z.d:z.c:null,polygonOffset:r||a?null:Object(M.g)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0),this.setPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),n}(_.a);W.shader=new j.a(q.a,function(){return n.e(173).then(n.bind(null,"SjXz"))});var J=function(e){return function(e){return e.cullFace?0!==e.cullFace:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}(e)&&{face:1===e.cullFace?1028:1029,mode:2305}},X=function(e){zt(n,e);var t=Ut(n);function n(){var e;return Jt(this,n),(e=t.apply(this,arguments)).output=0,e.alphaDiscardMode=1,e.doubleSidedMode=0,e.isSchematic=!1,e.vertexColors=!1,e.offsetBackfaces=!1,e.symbolColors=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.sliceHighlightDisabled=!1,e.receiveAmbientOcclusion=!1,e.screenSizePerspective=!1,e.textureAlphaPremultiplied=!1,e.hasColorTexture=!1,e.usePBR=!1,e.hasMetalnessAndRoughnessTexture=!1,e.hasEmissionTexture=!1,e.hasOcclusionTexture=!1,e.hasNormalTexture=!1,e.instanced=!1,e.instancedColor=!1,e.instancedDoublePrecision=!1,e.vertexTangents=!1,e.normalsTypeDerivate=!1,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparent=!1,e.enableOffset=!0,e.cullFace=0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!0,e}return n}(A.a);Object(R.a)([Object(A.b)({count:8})],X.prototype,"output",void 0),Object(R.a)([Object(A.b)({count:4})],X.prototype,"alphaDiscardMode",void 0),Object(R.a)([Object(A.b)({count:3})],X.prototype,"doubleSidedMode",void 0),Object(R.a)([Object(A.b)()],X.prototype,"isSchematic",void 0),Object(R.a)([Object(A.b)()],X.prototype,"vertexColors",void 0),Object(R.a)([Object(A.b)()],X.prototype,"offsetBackfaces",void 0),Object(R.a)([Object(A.b)()],X.prototype,"symbolColors",void 0),Object(R.a)([Object(A.b)()],X.prototype,"vvSize",void 0),Object(R.a)([Object(A.b)()],X.prototype,"vvColor",void 0),Object(R.a)([Object(A.b)()],X.prototype,"verticalOffset",void 0),Object(R.a)([Object(A.b)()],X.prototype,"receiveShadows",void 0),Object(R.a)([Object(A.b)()],X.prototype,"slicePlaneEnabled",void 0),Object(R.a)([Object(A.b)()],X.prototype,"sliceHighlightDisabled",void 0),Object(R.a)([Object(A.b)()],X.prototype,"receiveAmbientOcclusion",void 0),Object(R.a)([Object(A.b)()],X.prototype,"screenSizePerspective",void 0),Object(R.a)([Object(A.b)()],X.prototype,"textureAlphaPremultiplied",void 0),Object(R.a)([Object(A.b)()],X.prototype,"hasColorTexture",void 0),Object(R.a)([Object(A.b)()],X.prototype,"usePBR",void 0),Object(R.a)([Object(A.b)()],X.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(R.a)([Object(A.b)()],X.prototype,"hasEmissionTexture",void 0),Object(R.a)([Object(A.b)()],X.prototype,"hasOcclusionTexture",void 0),Object(R.a)([Object(A.b)()],X.prototype,"hasNormalTexture",void 0),Object(R.a)([Object(A.b)()],X.prototype,"instanced",void 0),Object(R.a)([Object(A.b)()],X.prototype,"instancedColor",void 0),Object(R.a)([Object(A.b)()],X.prototype,"instancedDoublePrecision",void 0),Object(R.a)([Object(A.b)()],X.prototype,"vertexTangents",void 0),Object(R.a)([Object(A.b)()],X.prototype,"normalsTypeDerivate",void 0),Object(R.a)([Object(A.b)()],X.prototype,"writeDepth",void 0),Object(R.a)([Object(A.b)()],X.prototype,"sceneHasOcludees",void 0),Object(R.a)([Object(A.b)()],X.prototype,"transparent",void 0),Object(R.a)([Object(A.b)()],X.prototype,"enableOffset",void 0),Object(R.a)([Object(A.b)({count:3})],X.prototype,"cullFace",void 0),Object(R.a)([Object(A.b)({count:4})],X.prototype,"transparencyPassType",void 0),Object(R.a)([Object(A.b)()],X.prototype,"multipassTerrainEnabled",void 0),Object(R.a)([Object(A.b)()],X.prototype,"cullAboveGround",void 0);var Y=n("sKsC"),K=function(e){zt(n,e);var t=Ut(n);function n(){return Jt(this,n),t.apply(this,arguments)}return Wt(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,a=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:r.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangets:!1,attributeTextureCoordinates:r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(U.b)(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new I.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),k.a)}}]),n}(W);K.shader=new j.a(Y.a,function(){return n.e(169).then(n.bind(null,"FmK6"))});var Q=function(e){zt(n,e);var t=Ut(n);function n(e){var r;return Jt(this,n),(r=t.call(this,e,ee)).supportsEdges=!0,r.techniqueConfig=new X,r.vertexBufferLayout=n.getVertexBufferLayout(r.params),r.instanceBufferLayout=e.instanced?n.getInstanceBufferLayout(r.params):null,r}return Wt(n,[{key:"isVisibleInPass",value:function(e){return 4!==e&&6!==e&&7!==e||this.params.castShadows}},{key:"isVisible",value:function(){var e=this.params;if(!Dt(Ht(n.prototype),"isVisible",this).call(this)||0===e.layerOpacity)return!1;var t=e.instanced,r=e.vertexColors,a=e.symbolColors,o=!!t&&t.indexOf("color")>-1,i=e.vvColorEnabled,s="replace"===e.colorMixMode,c=e.opacity>0,u=e.externalColor&&e.externalColor[3]>0;return r&&(o||i||a)?!!s||c:r?s?u:c:o||i||a?!!s||c:s?u:c}},{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.params.textureId,this.techniqueConfig.vertexTangents=this.params.vertexTangents,this.techniqueConfig.instanced=!!this.params.instanced,this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.cullFace=null!=this.params.cullFace?this.params.cullFace:0,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,0!==e&&7!==e||(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.techniqueConfig.doubleSidedMode=this.params.treeRendering?2:this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&this.params.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!(!t||!t.ssaoEnabled)&&this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<M.e),this.techniqueConfig}},{key:"intersect",value:function(e,t,n,r,a,i,s){if(null!==this.params.verticalOffset){var c=r.camera;Object(o.v)(se,n[12],n[13],n[14]);var u=null;switch(r.viewingMode){case 1:u=Object(o.q)(oe,se);break;case 2:u=Object(o.j)(oe,ae)}var l=0;if(null!==this.params.verticalOffset){var d=Object(o.i)(ce,se,c.eye),f=Object(o.o)(d),p=Object(o.d)(d,d,1/f),m=null;this.params.screenSizePerspective&&(m=Object(o.g)(u,p)),l+=Object(w.g)(c,f,this.params.verticalOffset,m,this.params.screenSizePerspective)}Object(o.d)(u,u,l),Object(o.w)(ie,u,r.transform.inverseRotation),a=Object(o.i)(ne,a,ie),i=Object(o.i)(re,i,ie)}Object(w.e)(e,t,r,a,i,Object(y.f)(r.verticalOffset),s)}},{key:"getGLMaterial",value:function(e){if(0===e.output||7===e.output||1===e.output||2===e.output||3===e.output||4===e.output)return new Z(e)}},{key:"createBufferWriter",value:function(){return new te(this.vertexBufferLayout,this.instanceBufferLayout)}}],[{key:"getVertexBufferLayout",value:function(e){var t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,n=Object(x.a)().vec3f("position").vec3f("normal");return e.vertexTangents&&n.vec4f("tangent"),t&&n.vec2f("uv0"),e.vertexColors&&n.vec4u8("color"),e.symbolColors&&n.vec4u8("symbolColor"),n}},{key:"getInstanceBufferLayout",value:function(e){var t=Object(x.a)();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t}}]),n}(T.a),Z=function(e){zt(n,e);var t=Ut(n);function n(e){var r;Jt(this,n);var a=e.material;return(r=t.call(this,Et(Et({},e),a.params))).updateParameters(),r}return Wt(n,[{key:"updateParameters",value:function(e){var t=this.material.params;this.updateTexture(t.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(t.treeRendering?K:W,this.material.getTechniqueConfig(this.output,e),this.technique)}},{key:"selectPipelines",value:function(){}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this.material.params.shadowMappingEnabled&&this.material.setParameterValues({shadowMappingEnabled:e.shadowMappingEnabled})}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"ensureParameters",value:function(e){0!==this.output&&7!==this.output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.params,t),this.bindTexture(e,this.technique.program)}},{key:"beginSlot",value:function(e){return e===(this.material.params.transparent?this.material.params.writeDepth?5:8:3)}},{key:"getPipelineState",value:function(e,t){return this.technique.getPipelineState(t)}}]),n}(O.a),$=2.1,ee=Et({textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(c.a)(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:S.b,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},T.b),te=function(){function e(t,n){Jt(this,e),this.vertexBufferLayout=t,this.instanceBufferLayout=n}return Wt(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,n,r){Object(C.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,r)}}]),e}(),ne=Object(a.e)(),re=Object(a.e)(),ae=Object(a.g)(0,0,1),oe=Object(a.e)(),ie=Object(a.e)(),se=Object(a.e)(),ce=Object(a.e)(),ue=n("Hizz"),le=n("zlDU"),de=n("4EHJ"),fe=n("9MzC"),pe=n("Lqtk"),me=n("eSsm"),ve=function(){function e(t){Jt(this,e),this.streamDataRequester=t}var t,n,a,o;return Wt(e,[{key:"loadJSON",value:(o=Bt(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.load("json",t,n));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"loadBinary",value:(a=Bt(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(de.u)(t)?(Object(fe.u)(n),Object(de.j)(t)):this.load("binary",t,n));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"loadImage",value:(n=Bt(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.load("image",t,n));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"load",value:(t=Bt(regeneratorRuntime.mark(function e(t,n,a){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(r.j)(this.streamDataRequester)){e.next=4;break}return e.next=3,Object(pe.default)(n,{responseType:he[t]});case 3:return e.abrupt("return",e.sent.data);case 4:return e.next=6,Object(me.c)(this.streamDataRequester.request(n,t,a));case 6:if(!0!==(o=e.sent).ok){e.next=9;break}return e.abrupt("return",o.value);case 9:throw Object(fe.t)(o.error),new le.a("","Request for resource failed: ".concat(o.error));case 10:case"end":return e.stop()}},e,this)})),function(e,n,r){return t.apply(this,arguments)})}]),e}(),he={image:"image",binary:"array-buffer",json:"json"},be=n("grla");function ge(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<s;++l)r[c]=o[u],r[c+1]=o[u+1],c+=a,u+=i}function xe(e,t,n){var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i;if(Object(be.b)(t.elementType)){var l=Object(be.d)(t.elementType);if(Object(be.c)(t.elementType))for(var d=0;d<s;++d)r[c]=Math.max(o[u]/l,-1),r[c+1]=Math.max(o[u+1]/l,-1),c+=a,u+=i;else for(var f=0;f<s;++f)r[c]=o[u]/l,r[c+1]=o[u+1]/l,c+=a,u+=i}else ge(e,t,n);return e}function ye(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<s;++l)r[c]=o[u],r[c+1]=o[u+1],r[c+2]=o[u+2],c+=a,u+=i}function Oe(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<s;++l)r[c]=o[u],r[c+1]=o[u+1],r[c+2]=o[u+2],r[c+3]=o[u+3],c+=a,u+=i}function we(e,t,n,r,a,o){for(var i=e.typedBuffer,s=e.typedBufferStride,c=o?o.count:e.count,u=(o&&o.dstIndex?o.dstIndex:0)*s,l=0;l<c;++l)i[u]=t,i[u+1]=n,i[u+2]=r,i[u+3]=a,u+=s}function Te(e,t){var n=e.count;t||(t=new e.TypedArrayConstructor(n));for(var r=0;r<n;r++)t[r]=e.get(r);return t}function Ce(e,t){return new e(new ArrayBuffer(t*e.ElementCount*Object(be.a)(e.ElementType)))}Object.freeze({__proto__:null,copy:ge,normalizeIntegerBuffer:xe}),Object.freeze({__proto__:null,copy:ye}),Object.freeze({__proto__:null,copy:Oe,fill:we}),Object.freeze({__proto__:null,copy:function(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<s;++l){for(var d=0;d<9;++d)r[c+d]=o[u+d];c+=a,u+=i}}}),Object.freeze({__proto__:null,copy:function(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<s;++l){for(var d=0;d<16;++d)r[c+d]=o[u+d];c+=a,u+=i}}}),Object.freeze({__proto__:null,copy:function(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<s;++l)r[c]=o[u],c+=a,u+=i},makeDense:Te});var Se=f.a.getLogger("esri.views.3d.glTF"),Me=n("bJda"),Re=n("VJrH"),je=n("sTkM"),_e=n("BPBZ"),Ae=function(){function e(t){Jt(this,e),this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}return Wt(e,[{key:"readUint32",value:function(){var e=this.offset4;return this.offset4+=1,this.dataUint32[e]}},{key:"readUint8Array",value:function(e){var t=4*this.offset4;return this.offset4+=e/4,new Uint8Array(this.data,t,e)}},{key:"remainingBytes",value:function(){return this.data.byteLength-4*this.offset4}}]),e}(),ke={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Ie={pbrMetallicRoughness:ke,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Pe={ESRI_externalColorMixMode:"tint"},Le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Et(Et({},ke),e.pbrMetallicRoughness),n=function(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:Object(Me.a)(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return e}(Et(Et({},Pe),e.extras));return Et(Et(Et({},Ie),e),{},{pbrMetallicRoughness:t,extras:n})},Be={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497},Fe=function(){function e(t,n,r,a,o){Jt(this,e),this.context=t,this.errorContext=n,this.uri=r,this.json=a,this.glbBuffer=o,this.bufferCache=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=function(e){var t,n;return e.replace(/^(.*\/)?([^/]*)$/,function(e,r,a){return t=r||"",n=a||"",""}),{dirPart:t,filePart:n}}(this.uri).dirPart,this.checkVersionSupported(),this.checkRequiredExtensionsSupported(),n.errorUnsupportedIf(null==a.scenes,"Scenes must be defined."),n.errorUnsupportedIf(null==a.meshes,"Meshes must be defined"),n.errorUnsupportedIf(null==a.nodes,"Nodes must be defined."),this.computeNodeParents()}var t,n,r,a,o,s,c,l,f,p,m,v,h;return Wt(e,[{key:"getBuffer",value:(h=Bt(regeneratorRuntime.mark(function e(t,n){var r,a,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.json.buffers[t],a=this.errorContext,null!=r.uri){e.next=3;break}return e.abrupt("return",(a.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer));case 3:if(o=this.bufferCache.get(t)){e.next=9;break}return e.next=7,this.context.loadBinary(this.resolveUri(r.uri),n);case 7:i=e.sent,o=new Uint8Array(i),this.bufferCache.set(t,o),a.assert(o.byteLength===r.byteLength,"Buffer byte lengths should match.");case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"getAccessor",value:(v=Bt(regeneratorRuntime.mark(function e(t,n){var r,a,o,i,s,c,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.json.accessors[t],(a=this.errorContext).errorUnsupportedIf(null==r.bufferView,"Some accessor does not specify a bufferView."),a.errorUnsupportedIf(r.type in["MAT2","MAT3","MAT4"],"AttributeType ".concat(r.type," is not supported")),o=this.json.bufferViews[r.bufferView],e.next=5,this.getBuffer(o.buffer,n);case 5:return i=e.sent,s=ze[r.type],c=Ve[r.componentType],u=s*c,l=o.byteStride||u,e.abrupt("return",{raw:i.buffer,byteStride:l,byteOffset:i.byteOffset+(o.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:l===u,componentCount:s,componentByteSize:c,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized});case 11:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"getIndexData",value:(m=Bt(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.indices){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.getAccessor(t.indices,n);case 4:if(!(r=e.sent).isDenselyPacked){e.next=14;break}e.t0=r.componentType,e.next=5121===e.t0?9:5123===e.t0?10:5125===e.t0?11:12;break;case 9:return e.abrupt("return",new Uint8Array(r.raw,r.byteOffset,r.entryCount));case 10:return e.abrupt("return",new Uint16Array(r.raw,r.byteOffset,r.entryCount));case 11:return e.abrupt("return",new Uint32Array(r.raw,r.byteOffset,r.entryCount));case 12:e.next=20;break;case 14:e.t1=r.componentType,e.next=5121===e.t1?17:5123===e.t1?18:5125===e.t1?19:20;break;case 17:return e.abrupt("return",Te(this.wrapAccessor(d.l,r)));case 18:return e.abrupt("return",Te(this.wrapAccessor(d.j,r)));case 19:return e.abrupt("return",Te(this.wrapAccessor(d.k,r)));case 20:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"getPositionData",value:(p=Bt(regeneratorRuntime.mark(function e(t,n){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).errorUnsupportedIf(null==t.attributes.POSITION,"No POSITION vertex data found."),e.next=4,this.getAccessor(t.attributes.POSITION,n);case 4:return a=e.sent,e.abrupt("return",(r.errorUnsupportedIf(5126!==a.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+He[a.componentType]),r.errorUnsupportedIf(3!==a.componentCount,"POSITION vertex attribute must have 3 components, but found "+a.componentCount.toFixed()),this.wrapAccessor(d.u,a)));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"getNormalData",value:(f=Bt(regeneratorRuntime.mark(function e(t,n){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.NORMAL,"No NORMAL vertex data found."),e.next=4,this.getAccessor(t.attributes.NORMAL,n);case 4:return a=e.sent,e.abrupt("return",(r.errorUnsupportedIf(5126!==a.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+He[a.componentType]),r.errorUnsupportedIf(3!==a.componentCount,"NORMAL vertex attribute must have 3 components, but found "+a.componentCount.toFixed()),this.wrapAccessor(d.u,a)));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"getTangentData",value:(l=Bt(regeneratorRuntime.mark(function e(t,n){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.TANGENT,"No TANGENT vertex data found."),e.next=4,this.getAccessor(t.attributes.TANGENT,n);case 4:return a=e.sent,e.abrupt("return",(r.errorUnsupportedIf(5126!==a.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+He[a.componentType]),r.errorUnsupportedIf(4!==a.componentCount,"TANGENT vertex attribute must have 4 components, but found "+a.componentCount.toFixed()),new d.C(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount)));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"getTextureCoordinates",value:(c=Bt(regeneratorRuntime.mark(function e(t,n){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found."),e.next=4,this.getAccessor(t.attributes.TEXCOORD_0,n);case 4:return a=e.sent,e.abrupt("return",(r.errorUnsupportedIf(2!==a.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+a.componentCount.toFixed()),5126===a.componentType?this.wrapAccessor(d.m,a):(r.errorUnsupportedIf(!a.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),function(e){switch(e.componentType){case 5120:return new d.q(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5121:return new d.t(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5122:return new d.o(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5123:return new d.r(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5125:return new d.s(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5126:return new d.m(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void Object(Me.a)(e.componentType)}}(a))));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"getVertexColors",value:(s=Bt(regeneratorRuntime.mark(function e(t,n){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.COLOR_0,"No COLOR_0 vertex data found."),e.next=4,this.getAccessor(t.attributes.COLOR_0,n);case 4:if(a=e.sent,r.errorUnsupportedIf(4!==a.componentCount&&3!==a.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+a.componentCount.toFixed()),4!==a.componentCount){e.next=14;break}if(5126!==a.componentType){e.next=8;break}return e.abrupt("return",this.wrapAccessor(d.C,a));case 8:if(5121!==a.componentType){e.next=10;break}return e.abrupt("return",this.wrapAccessor(d.J,a));case 10:if(5123!==a.componentType){e.next=12;break}return e.abrupt("return",this.wrapAccessor(d.H,a));case 12:e.next=21;break;case 14:if(3!==a.componentCount){e.next=21;break}if(5126!==a.componentType){e.next=17;break}return e.abrupt("return",this.wrapAccessor(d.u,a));case 17:if(5121!==a.componentType){e.next=19;break}return e.abrupt("return",this.wrapAccessor(d.B,a));case 19:if(5123!==a.componentType){e.next=21;break}return e.abrupt("return",this.wrapAccessor(d.z,a));case 21:r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+He[a.componentType]);case 22:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"hasPositions",value:function(e){return void 0!==e.attributes.POSITION}},{key:"hasNormals",value:function(e){return void 0!==e.attributes.NORMAL}},{key:"hasVertexColors",value:function(e){return void 0!==e.attributes.COLOR_0}},{key:"hasTextureCoordinates",value:function(e){return void 0!==e.attributes.TEXCOORD_0}},{key:"hasTangents",value:function(e){return void 0!==e.attributes.TANGENT}},{key:"getMaterial",value:(o=Bt(regeneratorRuntime.mark(function e(t,n,r){var a,o,i,s,c,u,l,d,f,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.errorContext,o=this.materialCache.get(t.material)){e.next=47;break}if(i=null!=t.material?Le(this.json.materials[t.material]):Le(),s=i.pbrMetallicRoughness,c=this.hasVertexColors(t),e.t0=s.baseColorTexture,!e.t0){e.next=10;break}return a.errorUnsupportedIf(0!==(s.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported."),e.next=9,this.getTexture(s.baseColorTexture.index,n);case 9:u=e.sent;case 10:if(e.t1=i.normalTexture,!e.t1){e.next=19;break}if(0===(i.normalTexture.texCoord||0)){e.next=16;break}a.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture."),e.next=19;break;case 16:return e.next=18,this.getTexture(i.normalTexture.index,n);case 18:l=e.sent;case 19:if(e.t2=i.occlusionTexture&&r,!e.t2){e.next=28;break}if(0===(i.occlusionTexture.texCoord||0)){e.next=25;break}a.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture."),e.next=28;break;case 25:return e.next=27,this.getTexture(i.occlusionTexture.index,n);case 27:d=e.sent;case 28:if(e.t3=i.emissiveTexture&&r,!e.t3){e.next=37;break}if(0===(i.emissiveTexture.texCoord||0)){e.next=34;break}a.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture."),e.next=37;break;case 34:return e.next=36,this.getTexture(i.emissiveTexture.index,n);case 36:f=e.sent;case 37:if(e.t4=s.metallicRoughnessTexture&&r,!e.t4){e.next=46;break}if(0===(s.metallicRoughnessTexture.texCoord||0)){e.next=43;break}a.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture."),e.next=46;break;case 43:return e.next=45,this.getTexture(s.metallicRoughnessTexture.index,n);case 45:p=e.sent;case 46:o={alphaMode:i.alphaMode,alphaCutoff:i.alphaCutoff,color:s.baseColorFactor,doubleSided:!!i.doubleSided,colorTexture:u,normalTexture:l,name:i.name,id:null!=t.material?t.material:-1,occlusionTexture:d,emissiveTexture:f,emissiveFactor:i.emissiveFactor,metallicFactor:s.metallicFactor,roughnessFactor:s.roughnessFactor,metallicRoughnessTexture:p,vertexColors:c,ESRI_externalColorMixMode:i.extras.ESRI_externalColorMixMode};case 47:return e.abrupt("return",o);case 48:case"end":return e.stop()}},e,this)})),function(e,t,n){return o.apply(this,arguments)})},{key:"getTexture",value:(a=Bt(regeneratorRuntime.mark(function e(t,n){var r,a,o,i,s,c,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.errorContext,a=this.json.textures[t],o=function(e){return Et(Et({},Be),e)}(null!=a.sampler?this.json.samplers[a.sampler]:{}),r.errorUnsupportedIf(null==a.source,"Source is expected to be defined for a texture."),i=this.json.images[a.source],s=this.textureCache.get(t)){e.next=21;break}if(!i.uri){e.next=11;break}return e.next=8,this.context.loadImage(this.resolveUri(i.uri),n);case 8:c=e.sent,e.next=20;break;case 11:return r.errorUnsupportedIf(null==i.bufferView,"Image bufferView must be defined."),r.errorUnsupportedIf(null==i.mimeType,"Image mimeType must be defined."),u=this.json.bufferViews[i.bufferView],e.next=15,this.getBuffer(u.buffer,n);case 15:return l=e.sent,r.errorUnsupportedIf(null!=u.byteStride,"byteStride not supported for image buffer"),e.next=19,function(){var e=Bt(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){var a=new Blob([t],{type:n}),o=URL.createObjectURL(a),i=new Image;i.addEventListener("load",function(){URL.revokeObjectURL(o),"decode"in i?i.decode().then(function(){return e(i)},function(){return e(i)}):e(i)}),i.addEventListener("error",function(e){URL.revokeObjectURL(o),r(e)}),i.src=o}));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(new Uint8Array(l.buffer,l.byteOffset+(u.byteOffset||0),u.byteLength),i.mimeType);case 19:c=e.sent;case 20:s={data:c,wrapS:o.wrapS,wrapT:o.wrapT,minFilter:o.minFilter,name:i.name,id:t},this.textureCache.set(t,s);case 21:return e.abrupt("return",s);case 22:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"getNodeTransform",value:function(e){if(void 0===e)return Ne;var t=this.nodeTransformCache.get(e);if(!t){var n=this.getNodeTransform(this.getNodeParent(e)),r=this.json.nodes[e];r.matrix?t=Object(i.l)(Object(u.b)(),n,r.matrix):r.translation||r.rotation||r.scale?(t=Object(u.c)(n),r.translation&&Object(i.s)(t,t,r.translation),r.rotation&&(De[3]=Object(_e.b)(De,r.rotation),Object(i.q)(t,t,De[3],De)),r.scale&&Object(i.r)(t,t,r.scale)):t=n,this.nodeTransformCache.set(e,t)}return t}},{key:"wrapAccessor",value:function(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}},{key:"resolveUri",value:function(e){return Object(de.z)(e,this.baseUri)}},{key:"getNodeParent",value:function(e){return this.nodeParentMap.get(e)}},{key:"checkVersionSupported",value:function(){var e=Re.a.parse(this.json.asset.version,"glTF");Ee.validate(e)}},{key:"checkRequiredExtensionsSupported",value:function(){var e=this.json;e.extensionsRequired&&0!==e.extensionsRequired.length&&this.errorContext.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}},{key:"computeNodeParents",value:function(){var e=this;this.json.nodes.forEach(function(t,n){t.children&&t.children.forEach(function(t){e.nodeParentMap.set(t,n)})})}}],[{key:"load",value:(r=Bt(regeneratorRuntime.mark(function t(n,r,a,o){var i,s,c,u,l,d;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!Object(de.u)(a)){t.next=13;break}if("model/gltf-binary"===(i=Object(de.i)(a)).mediaType){t.next=10;break}return t.prev=3,s=JSON.parse(i.isBase64?atob(i.data):i.data),t.abrupt("return",new e(n,r,a,s));case 8:t.prev=8,t.t0=t.catch(3);case 10:if(c=Object(de.j)(a),!e.isGLBData(c)){t.next=13;break}return t.abrupt("return",this.fromGLBData(n,r,a,c));case 13:if(!a.endsWith(".gltf")){t.next=18;break}return t.next=16,n.loadJSON(a,o);case 16:return u=t.sent,t.abrupt("return",new e(n,r,a,u));case 18:return t.next=20,n.loadBinary(a,o);case 20:if(l=t.sent,!e.isGLBData(l)){t.next=23;break}return t.abrupt("return",this.fromGLBData(n,r,a,l));case 23:return t.next=25,n.loadJSON(a,o);case 25:return d=t.sent,t.abrupt("return",new e(n,r,a,d));case 27:case"end":return t.stop()}},t,this,[[3,8]])})),function(e,t,n,a){return r.apply(this,arguments)})},{key:"isGLBData",value:function(e){var t=new Ae(e);return t.remainingBytes()>=4&&1179937895===t.readUint32()}},{key:"fromGLBData",value:(n=Bt(regeneratorRuntime.mark(function t(n,r,a,o){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.parseGLBData(r,o);case 2:return i=t.sent,t.abrupt("return",new e(n,r,a,i.json,i.binaryData));case 4:case"end":return t.stop()}},t)})),function(e,t,r,a){return n.apply(this,arguments)})},{key:"parseGLBData",value:(t=Bt(regeneratorRuntime.mark(function e(t,n){var r,a,o,i,s,c,u,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=new Ae(n),t.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large."),a=r.readUint32(),o=r.readUint32(),i=r.readUint32(),t.assert(1179937895===a,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(n.byteLength>=i,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(2!==o,"An unsupported GLB container version was detected. Only version 2 is supported."),u=0;case 5:if(!(r.remainingBytes()>=8)){e.next=19;break}if(l=r.readUint32(),d=r.readUint32(),0!==u){e.next=15;break}return t.assert(1313821514===d,"First GLB chunk must be JSON."),t.assert(l>=0,"No JSON data found."),e.next=12,Ue(r.readUint8Array(l));case 12:s=e.sent,e.next=16;break;case 15:1===u?(t.errorUnsupportedIf(5130562!==d,"Second GLB chunk expected to be BIN."),c=r.readUint8Array(l)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping.");case 16:u+=1;case 17:e.next=5;break;case 19:return e.abrupt("return",(s||t.error("No GLB JSON chunk detected."),{json:s,binaryData:c}));case 20:case"end":return e.stop()}},e)})),function(e,n){return t.apply(this,arguments)})}]),e}(),Ee=new Re.a(2,0,"glTF"),Ne=Object(i.j)(Object(u.b)(),Math.PI/2),De=Object(je.a)(),ze={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Ve={5120:1,5121:1,5122:2,5123:2,5126:4,5125:4};function Ue(e){return Ge.apply(this,arguments)}function Ge(){return(Ge=Bt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var r=new Blob([t]),a=new FileReader;a.onload=function(){e(JSON.parse(a.result))},a.onerror=function(e){n(e)},a.readAsText(r)}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var He={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"},qe=0;function We(e){var t=null;return e.json.nodes.forEach(function(e){var n=e.extras;Object(r.k)(n)&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(t=n)}),t}function Je(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function Xe(e,t,n){var r=function(t){var r="".concat(n,"_tex_").concat(t&&t.id).concat(t&&t.name?"_"+t.name:"");if(t&&!e.textures.has(r)){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{data:e,parameters:Et({wrap:Et({s:10497,t:10497},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}(t.data,{wrap:{s:Ye(t.wrapS),t:Ye(t.wrapT)},mipmap:Qe.some(function(e){return e===t.minFilter}),noUnpackFlip:!0});e.textures.set(r,a)}return r},a="".concat(n,"_mat_").concat(t.id,"_").concat(t.name);if(!e.materials.has(a)){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Et({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},e)}({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(a,o)}return a}function Ye(e){if(33071===e||33648===e||10497===e)return e;Ke.error("Unexpected TextureSampler WrapMode: ".concat(e))}var Ke=new(function(){function e(){Jt(this,e)}return Wt(e,[{key:"error",value:function(e){throw new le.a("gltf-loader-error",e)}},{key:"errorUnsupported",value:function(e){throw new le.a("gltf-loader-unsupported-feature",e)}},{key:"errorUnsupportedIf",value:function(e,t){e&&this.errorUnsupported(t)}},{key:"assert",value:function(e,t){e||this.error(t)}},{key:"warn",value:function(e){Se.warn(e)}},{key:"warnUnsupported",value:function(e){this.warn("[Unsupported Feature] "+e)}},{key:"warnUnsupportedIf",value:function(e,t){e&&this.warnUnsupported(t)}}]),e}()),Qe=[9987,9985],Ze=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"],$e=n("ohva"),et=n("EDiM"),tt=n("LbAs"),nt=f.a.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function rt(e){throw new le.a("","Request for object resource failed: ".concat(e))}function at(e){var t=e.params,n=t.topology,r=!0;switch(t.vertexAttributes||(nt.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var a=t.faces;if(a){if(t.vertexAttributes)for(var o in t.vertexAttributes){var i=a[o];i&&i.values?(null!=i.valueType&&"UInt32"!==i.valueType&&(nt.warn("Unsupported indexed geometry indices type '".concat(i.valueType,"', only UInt32 is currently supported")),r=!1),null!=i.valuesPerElement&&1!==i.valuesPerElement&&(nt.warn("Unsupported indexed geometry values per element '".concat(i.valuesPerElement,"', only 1 is currently supported")),r=!1)):(nt.warn("Indexed geometry does not specify face indices for '".concat(o,"' attribute")),r=!1)}}else nt.warn("Indexed geometries must specify faces"),r=!1;break;default:nt.warn("Unsupported topology '".concat(n,"'")),r=!1}e.params.material||(nt.warn("Geometry requires material"),r=!1);var s=e.params.vertexAttributes;for(var c in s)s[c].values||(nt.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function ot(e){var t=Object(b.e)();return e.forEach(function(e){var n=e.boundingInfo;Object(r.k)(n)&&(Object(b.j)(t,n.getBBMin()),Object(b.j)(t,n.getBBMax()))}),t}function it(e,t){return st.apply(this,arguments)}function st(){return(st=Bt(regeneratorRuntime.mark(function e(t,n){var a,o,i,s,c,u,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=[],o=function(e){var o=t[e],i=o.images[0].data;if(!i)return nt.warn("Externally referenced texture data is not yet supported"),"continue";var s=o.encoding+";base64,"+i,c="/textureDefinitions/"+e,u={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0},l=Object(r.k)(n)&&n.disableTextures?Promise.resolve(null):Object(tt.a)(s,n);a.push(l.then(function(e){return{refId:c,image:e,params:u,alphaChannelUsage:"rgba"===o.channels?o.alphaChannelUsage||"transparency":"none"}}))},e.t0=regeneratorRuntime.keys(t);case 3:if((e.t1=e.t0()).done){e.next=10;break}if(i=e.t1.value,"continue"!==o(i)){e.next=8;break}return e.abrupt("continue",3);case 8:e.next=3;break;case 10:return e.next=12,Promise.all(a);case 12:s=e.sent,c={},u=kt(s);try{for(u.s();!(l=u.n()).done;)d=l.value,c[d.refId]=d}catch(f){u.e(f)}finally{u.f()}return e.abrupt("return",c);case 17:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ct(e){switch(e){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;case"transparency":default:return 0}}function ut(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}var lt=new Re.a(1,2,"wosr");function dt(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],s=n[3],c=n[4],u=n[5],l=n[6],d=n[7],f=n[8],m=e.typedBuffer,v=e.typedBufferStride,h=t.typedBuffer,b=t.typedBufferStride,g=0;g<r;g++){var x=g*v,y=g*b,O=h[y],w=h[y+1],T=h[y+2],C=h[y+3];m[x]=a*O+s*w+l*T,m[x+1]=o*O+c*w+d*T,m[x+2]=i*O+u*w+f*T,m[x+3]=C}else p.error("source and destination buffers need to have the same number of elements")}function ft(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,c=0;c<r;c++){var u=c*o,l=c*s;a[u]=n*i[l],a[u+1]=n*i[l+1],a[u+2]=n*i[l+2],a[u+3]=n*i[l+3]}}function pt(e,t){return mt.apply(this,arguments)}function mt(){return(mt=Bt(regeneratorRuntime.mark(function e(t,n){var c,l,f,p,m,v,h,b,x,y;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("wosr"!==(c=vt(Object(s.a)(t))).fileType){e.next=7;break}return e.next=4,n.cache?n.cache.loadWOSR(c.url,n):function(){var e=Bt(regeneratorRuntime.mark(function e(t,n){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(){var e=Bt(regeneratorRuntime.mark(function e(t,n){var a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=Object(r.k)(n)&&n.streamDataRequester)){e.next=3;break}return e.abrupt("return",function(){var e=Bt(regeneratorRuntime.mark(function e(t,n,r){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(me.c)(n.request(t,"json",r));case 2:if(!0!==(a=e.sent).ok){e.next=5;break}return e.abrupt("return",a.value);case 5:Object(fe.t)(a.error),rt(a.error.details.url);case 6:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()(t,a,n));case 3:return e.next=5,Object(me.c)(Object(pe.default)(t,Object(r.q)(n)));case 5:if(!0!==(o=e.sent).ok){e.next=8;break}return e.abrupt("return",o.value.data);case 8:Object(fe.t)(o.error),rt(o.error);case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 2:return a=e.sent,e.t0=a,e.next=6,it(a.textureDefinitions,n);case 6:return e.t1=e.sent,e.abrupt("return",{resource:e.t0,textures:e.t1});case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(c.url,n);case 4:return l=e.sent,f=function(e,t){var n=[],o=[],i=[],s=[],c=e.resource,u=Re.a.parse(c.version||"1.0","wosr");lt.validate(u);for(var l=c.model.name,d=c.model.geometries,f=c.materialDefinitions,p=e.textures,m=0,v=new Map,h=0;h<d.length;h++){var b=d[h];if(at(b)){var x=ut(b),y=b.params.vertexAttributes,O=[];for(var w in y){var T=y[w];O.push([w,{data:T.values,size:T.valuesPerElement,exclusive:!0}])}var C=[];if("PerAttributeArray"!==b.params.topology){var S=b.params.faces;for(var M in S)C.push([M,new Uint32Array(S[M].values)])}var R=p&&p[x.texture];if(R&&!v.has(x.texture)){var j=R.image,_=R.params,A=new ue.a(j,_);s.push(A),v.set(x.texture,A)}var k=v.get(x.texture),I=k?k.id:void 0,P=i[x.material]?i[x.material][x.texture]:null;if(!P){var L=f[x.material.substring(x.material.lastIndexOf("/")+1)].params;1===L.transparency&&(L.transparency=0);var B=R&&R.alphaChannelUsage,F=L.transparency>0||"transparency"===B||"maskAndTransparency"===B,E={ambient:Object(a.f)(L.diffuse),diffuse:Object(a.f)(L.diffuse),opacity:1-(L.transparency||0),transparent:F,textureAlphaMode:R?ct(R.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:I,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:L.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};Object(r.k)(t)&&t.materialParamsMixin&&Object.assign(E,t.materialParamsMixin),P=new Q(E),i[x.material]||(i[x.material]={}),i[x.material][x.texture]=P}o.push(P);var N=new g.a(O,C);m+=C.position?C.position.length:0,n.push(N)}}return{name:l,stageResources:{textures:s,materials:o,geometries:n},pivotOffset:c.model.pivotOffset,boundingBox:ot(n),numberOfVertices:m,lodThreshold:null}}(l,n),e.abrupt("return",{lods:[f],referenceBoundingBox:f.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:l.remove});case 7:return e.next=9,n.cache?n.cache.loadGLTF(c.url,n,n.usePBR):function(){var e=Bt(regeneratorRuntime.mark(function e(t,n){var a,o,i,s,c,l,d=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=d.length>2&&void 0!==d[2]?d[2]:{},o=!(d.length>3&&void 0!==d[3])||d[3],e.next=4,Fe.load(t,Ke,n,a);case 4:return i=e.sent,s="gltf_"+qe++,c={lods:[],materials:new Map,textures:new Map,meta:We(i)},l=!(!i.json.asset.extras||"symbolResource"!==i.json.asset.extras.ESRI_type),e.next=10,function(){var e=Bt(regeneratorRuntime.mark(function e(t,n){var r,a,o,i,s,c,u,l,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:f=function(){return(f=Bt(regeneratorRuntime.mark(function e(a,o){var i,s,c,u,l,f,p,m,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.nodes[a],s=t.getNodeTransform(a),Ke.warnUnsupportedIf(null!=i.weights,"Morph targets are not supported."),null==i.mesh){e.next=20;break}c=r.meshes[i.mesh],u=kt(c.primitives),e.prev=4,u.s();case 6:if((l=u.n()).done){e.next=12;break}return f=l.value,e.next=10,n(f,s,o,c.name);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),u.e(e.t0);case 17:return e.prev=17,u.f(),e.finish(17);case 20:p=kt(i.children||[]),e.prev=21,p.s();case 23:if((m=p.n()).done){e.next=29;break}return v=m.value,e.next=27,d(v,o);case 27:e.next=23;break;case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(21),p.e(e.t1);case 34:return e.prev=34,p.f(),e.finish(34);case 37:case"end":return e.stop()}},e,null,[[4,14,17,20],[21,31,34,37]])}))).apply(this,arguments)},d=function(e,t){return f.apply(this,arguments)},r=t.json,a=r.scenes[r.scene||0].nodes,o=a.length>1,i=kt(a),e.prev=4,i.s();case 6:if((s=i.n()).done){e.next=14;break}return c=s.value,u=r.nodes[c],l=[d(c,0)],Je(u)&&!o&&l.push.apply(l,At(u.extensions.MSFT_lod.ids.map(function(e,t){return d(e,t+1)}))),e.next=12,Promise.all(l);case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),i.e(e.t0);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}},e,null,[[4,16,19,22]])}));return function(t,n){return e.apply(this,arguments)}}()(i,function(){var e=Bt(regeneratorRuntime.mark(function e(t,n,l,d){var f,p,m,v,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f=void 0!==t.mode?t.mode:4,p=function(e){switch(e){case 4:case 5:case 6:return e;default:return null}}(f),!Object(r.j)(p)){e.next=3;break}return e.abrupt("return",void Ke.warnUnsupported("Unsupported primitive mode ("+Ze[f]+"). Skipping primitive."));case 3:if(i.hasPositions(t)){e.next=5;break}return e.abrupt("return",void Ke.warn("Skipping primitive without POSITION vertex attribute."));case 5:return e.next=7,i.getMaterial(t,a,o);case 7:return m=e.sent,e.t0=Object(u.c)(n),e.next=11,i.getPositionData(t,a);case 11:return e.t1=e.sent,e.t2={position:e.t1,normal:null,texCoord0:null,color:null,tangent:null},e.next=15,i.getIndexData(t,a);case 15:if(e.t3=e.sent,e.t4=p,e.t5=Xe(c,m,s),v={transform:e.t0,attributes:e.t2,indices:e.t3,primitiveType:e.t4,material:e.t5},e.t6=i.hasNormals(t),!e.t6){e.next=24;break}return e.next=23,i.getNormalData(t,a);case 23:v.attributes.normal=e.sent;case 24:if(e.t7=i.hasTangents(t),!e.t7){e.next=29;break}return e.next=28,i.getTangentData(t,a);case 28:v.attributes.tangent=e.sent;case 29:if(e.t8=i.hasTextureCoordinates(t),!e.t8){e.next=34;break}return e.next=33,i.getTextureCoordinates(t,a);case 33:v.attributes.texCoord0=e.sent;case 34:if(e.t9=i.hasVertexColors(t),!e.t9){e.next=39;break}return e.next=38,i.getVertexColors(t,a);case 38:v.attributes.color=e.sent;case 39:h=null,Object(r.k)(c.meta)&&Object(r.k)(c.meta.ESRI_lod)&&"screenSpaceRadius"===c.meta.ESRI_lod.metric&&(h=c.meta.ESRI_lod.thresholds[l]),c.lods[l]=c.lods[l]||{parts:[],name:d,lodThreshold:h},c.lods[l].parts.push(v);case 41:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}());case 10:return e.abrupt("return",{model:c,meta:{isEsriSymbolResource:l,uri:i.uri},customMeta:{}});case 11:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(new ve(n.streamDataRequester),c.url,n,n.usePBR);case 9:if(p=e.sent,m=Object(r.i)(p.model.meta,"ESRI_proxyEllipsoid"),p.meta.isEsriSymbolResource&&Object(r.k)(m)&&-1!==p.meta.uri.indexOf("/RealisticTrees/")&&function(e,t){for(var n=0;n<e.model.lods.length;++n){var s=e.model.lods[n];e.customMeta.esriTreeRendering=!0;var c,l=kt(s.parts);try{for(l.s();!(c=l.n()).done;){var f=c.value,p=f.attributes.normal;if(Object(r.j)(p))return;for(var m=f.attributes.position,v=m.count,h=Object(a.e)(),b=Object(a.e)(),g=Object(a.e)(),x=Ce(d.J,v),y=Ce(d.u,v),O=Object(i.a)(Object(u.b)(),f.transform),w=0;w<v;w++){m.getVec(w,b),p.getVec(w,h),Object(o.l)(b,b,f.transform),Object(o.i)(g,b,t.center),Object(o.a)(g,g,t.radius);var T=g[2],C=Object(o.o)(g),S=Math.min(.45+.55*C*C,1);Object(o.a)(g,g,t.radius),Object(o.l)(g,g,O),Object(o.q)(g,g),n+1!==e.model.lods.length&&e.model.lods.length>1&&Object(o.h)(g,g,h,T>-1?.2:Math.min(-4*T-3.8,1)),y.setVec(w,g),x.set(w,0,255*S),x.set(w,1,255*S),x.set(w,2,255*S),x.set(w,3,255)}f.attributes.normal=y,f.attributes.color=x}}catch(M){l.e(M)}finally{l.f()}}}(p,m),v=p.meta.isEsriSymbolResource?{usePBR:n.usePBR,isSchematic:!1,treeRendering:p.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:n.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},h=Et(Et({},n.materialParamsMixin),{},{treeRendering:p.customMeta.esriTreeRendering}),null==c.specifiedLodIndex){e.next=17;break}return b=ht(p,v,h,c.specifiedLodIndex),x=b[0].boundingBox,e.abrupt("return",(0!==c.specifiedLodIndex&&(x=ht(p,v,h,0)[0].boundingBox),{lods:b,referenceBoundingBox:x,isEsriSymbolResource:p.meta.isEsriSymbolResource,isWosr:!1,remove:p.remove}));case 17:return y=ht(p,v,h),e.abrupt("return",{lods:y,referenceBoundingBox:y[0].boundingBox,isEsriSymbolResource:p.meta.isEsriSymbolResource,isWosr:!1,remove:p.remove});case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}function vt(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function ht(e,t,n,a){var o=e.model,i=Object(c.a)(),s=new Array,u=new Map,f=new Map;return o.lods.forEach(function(e,c){if(void 0===a||c===a){var p={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:Object(r.k)(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Object(b.e)()};s.push(p),e.parts.forEach(function(e){var a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),s=o.materials.get(e.material),c=Object(r.k)(e.attributes.texCoord0),x=Object(r.k)(e.attributes.normal);if(!u.has(a)){if(c){if(Object(r.k)(s.textureColor)&&!f.has(s.textureColor)){var y=o.textures.get(s.textureColor),O=Et(Et({},y.parameters),{},{preMultiplyAlpha:!0});f.set(s.textureColor,new ue.a(y.data,O))}if(Object(r.k)(s.textureNormal)&&!f.has(s.textureNormal)){var w=o.textures.get(s.textureNormal),T=Et(Et({},w.parameters),{},{preMultiplyAlpha:!0});f.set(s.textureNormal,new ue.a(w.data,T))}if(Object(r.k)(s.textureOcclusion)&&!f.has(s.textureOcclusion)){var C=o.textures.get(s.textureOcclusion),S=Et(Et({},C.parameters),{},{preMultiplyAlpha:!0});f.set(s.textureOcclusion,new ue.a(C.data,S))}if(Object(r.k)(s.textureEmissive)&&!f.has(s.textureEmissive)){var M=o.textures.get(s.textureEmissive),R=Et(Et({},M.parameters),{},{preMultiplyAlpha:!0});f.set(s.textureEmissive,new ue.a(M.data,R))}if(Object(r.k)(s.textureMetallicRoughness)&&!f.has(s.textureMetallicRoughness)){var j=o.textures.get(s.textureMetallicRoughness),_=Et(Et({},j.parameters),{},{preMultiplyAlpha:!0});f.set(s.textureMetallicRoughness,new ue.a(j.data,_))}}var A=Math.pow(s.color[0],1/$),k=Math.pow(s.color[1],1/$),I=Math.pow(s.color[2],1/$),P=Math.pow(s.emissiveFactor[0],1/$),L=Math.pow(s.emissiveFactor[1],1/$),B=Math.pow(s.emissiveFactor[2],1/$);u.set(a,new Q(Et(Et({},t),{},{transparent:"BLEND"===s.alphaMode,textureAlphaMode:bt(s.alphaMode),textureAlphaCutoff:s.alphaCutoff,diffuse:[A,k,I],ambient:[A,k,I],opacity:s.opacity,doubleSided:s.doubleSided,doubleSidedType:"winding-order",cullFace:s.doubleSided?0:2,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:x?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:Object(r.k)(s.textureColor)&&c?f.get(s.textureColor).id:void 0,colorMixMode:s.colorMixMode,normalTextureId:Object(r.k)(s.textureNormal)&&c?f.get(s.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:Object(r.k)(s.textureOcclusion)&&c?f.get(s.textureOcclusion).id:void 0,emissiveTextureId:Object(r.k)(s.textureEmissive)&&c?f.get(s.textureEmissive).id:void 0,metallicRoughnessTextureId:Object(r.k)(s.textureMetallicRoughness)&&c?f.get(s.textureMetallicRoughness).id:void 0,emissiveFactor:[P,L,B],mrrFactors:[s.metallicFactor,s.roughnessFactor,t.mrrFactors[2]],isSchematic:!1},n)))}var F=function(e,t){switch(t){case 4:return function(e){return"number"==typeof e?Object(et.d)(e):Object($e.i)(e)||Object($e.k)(e)?new Uint32Array(e):e}(e);case 5:return function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);var n=t-2,r=n<=65536?new Uint16Array(3*n):new Uint32Array(3*n);if("number"==typeof e)for(var a=0,o=0;o<n;o+=1)o%2==0?(r[a++]=o,r[a++]=o+1,r[a++]=o+2):(r[a++]=o+1,r[a++]=o,r[a++]=o+2);else for(var i=0,s=0;s<n;s+=1)if(s%2==0){var c=e[s+1],u=e[s+2];r[i++]=e[s],r[i++]=c,r[i++]=u}else{var l=e[s],d=e[s+2];r[i++]=e[s+1],r[i++]=l,r[i++]=d}return r}(e);case 6:return function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);var n=t-2,r=n<=65536?new Uint16Array(3*n):new Uint32Array(3*n);if("number"==typeof e){for(var a=0,o=0;o<n;++o)r[a++]=0,r[a++]=o+1,r[a++]=o+2;return r}for(var i=e[0],s=e[1],c=0,u=0;u<n;++u){var l=e[u+2];r[c++]=i,r[c++]=s,r[c++]=l,s=l}return r}(e)}}(e.indices||e.attributes.position.count,e.primitiveType),E=e.attributes.position.count,N=Ce(d.u,E);m(N,e.attributes.position,e.transform);var D=[["position",{data:N.typedBuffer,size:N.elementCount,exclusive:!0}]],z=[["position",F]];if(Object(r.k)(e.attributes.normal)){var V=Ce(d.u,E);Object(l.h)(i,e.transform),v(V,e.attributes.normal,i),D.push(["normal",{data:V.typedBuffer,size:V.elementCount,exclusive:!0}]),z.push(["normal",F])}if(Object(r.k)(e.attributes.tangent)){var U=Ce(d.C,E);Object(l.h)(i,e.transform),dt(U,e.attributes.tangent,i),D.push(["tangent",{data:U.typedBuffer,size:U.elementCount,exclusive:!0}]),z.push(["tangent",F])}if(Object(r.k)(e.attributes.texCoord0)){var G=Ce(d.m,E);xe(G,e.attributes.texCoord0),D.push(["uv0",{data:G.typedBuffer,size:G.elementCount,exclusive:!0}]),z.push(["uv0",F])}if(Object(r.k)(e.attributes.color)){var H=Ce(d.J,E);if(4===e.attributes.color.elementCount)e.attributes.color instanceof d.C?ft(H,e.attributes.color,255):e.attributes.color instanceof d.J?Oe(H,e.attributes.color):e.attributes.color instanceof d.H&&ft(H,e.attributes.color,1/256);else{we(H,255,255,255,255);var q=new d.B(H.buffer,0,4);e.attributes.color instanceof d.u?h(q,e.attributes.color,255):e.attributes.color instanceof d.B?ye(q,e.attributes.color):e.attributes.color instanceof d.z&&h(q,e.attributes.color,1/256)}D.push(["color",{data:H.typedBuffer,size:H.elementCount,exclusive:!0}]),z.push(["color",F])}var W=new g.a(D,z);p.stageResources.geometries.push(W),p.stageResources.materials.push(u.get(a)),c&&(Object(r.k)(s.textureColor)&&p.stageResources.textures.push(f.get(s.textureColor)),Object(r.k)(s.textureNormal)&&p.stageResources.textures.push(f.get(s.textureNormal)),Object(r.k)(s.textureOcclusion)&&p.stageResources.textures.push(f.get(s.textureOcclusion)),Object(r.k)(s.textureEmissive)&&p.stageResources.textures.push(f.get(s.textureEmissive)),Object(r.k)(s.textureMetallicRoughness)&&p.stageResources.textures.push(f.get(s.textureMetallicRoughness))),p.numberOfVertices+=E;var J=W.boundingInfo;Object(r.k)(J)&&(Object(b.j)(p.boundingBox,J.getBBMin()),Object(b.j)(p.boundingBox,J.getBBMax()))})}}),s}function bt(e){switch(e){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":return 1;default:return 0}}Object.freeze({__proto__:null,transformMat4:function(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],s=n[3],c=n[4],u=n[5],l=n[6],d=n[7],f=n[8],m=n[9],v=n[10],h=n[11],b=n[12],g=n[13],x=n[14],y=n[15],O=e.typedBuffer,w=e.typedBufferStride,T=t.typedBuffer,C=t.typedBufferStride,S=0;S<r;S++){var M=S*w,R=S*C,j=T[R],_=T[R+1],A=T[R+2],k=T[R+3];O[M]=a*j+c*_+f*A+b*k,O[M+1]=o*j+u*_+m*A+g*k,O[M+2]=i*j+l*_+v*A+x*k,O[M+3]=s*j+d*_+h*A+y*k}else p.error("source and destination buffers need to have the same number of elements")},transformMat3:dt,scale:ft,shiftRight:function(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,c=0;c<r;c++){var u=c*o,l=c*s;a[u]=i[l]>>n,a[u+1]=i[l+1]>>n,a[u+2]=i[l+2]>>n,a[u+3]=i[l+3]>>n}}})},p9cc:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n("OIYi"),a=n("R/jG"),o=n("fLTx");function i(e,t){var n=e.fragment,a=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;1===t.pbrMode&&a&&e.include(o.a,t),2!==t.pbrMode?(0===t.pbrMode&&n.code.add(r.a(qe||(qe=Xt(["\n      float getBakedOcclusion() { return 1.0; }\n  "])))),1===t.pbrMode&&(n.uniforms.add("emissionFactor","vec3"),n.uniforms.add("mrrFactors","vec3"),n.code.add(r.a(We||(We=Xt(["\n      vec3 mrr;\n      vec3 emission;\n      float occlusion;\n    "])))),t.hasMetalnessAndRoughnessTexture&&(n.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texMetallicRoughnessSize","vec2"),n.code.add(r.a(Je||(Je=Xt(["\n      void applyMetallnessAndRoughness(TextureLookupParameter params) {\n        vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;\n\n        mrr[0] *= metallicRoughness.b;\n        mrr[1] *= metallicRoughness.g;\n      }"]))))),t.hasEmissionTexture&&(n.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texEmissionSize","vec2"),n.code.add(r.a(Xe||(Xe=Xt(["\n      void applyEmission(TextureLookupParameter params) {\n        emission *= textureLookup(texEmission, params).rgb;\n      }"]))))),t.hasOcclusionTexture?(n.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texOcclusionSize","vec2"),n.code.add(r.a(Ye||(Ye=Xt(["\n      void applyOcclusion(TextureLookupParameter params) {\n        occlusion *= textureLookup(texOcclusion, params).r;\n      }\n\n      float getBakedOcclusion() {\n        return occlusion;\n      }\n      "]))))):n.code.add(r.a(Ke||(Ke=Xt(["\n      float getBakedOcclusion() { return 1.0; }\n      "])))),n.code.add(r.a(Qe||(Qe=Xt(["\n    void applyPBRFactors() {\n      mrr = mrrFactors;\n      emission = emissionFactor;\n      occlusion = 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "])),a?"vtc.uv = vuv0;":"",t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":"")))):n.code.add(r.a(Ze||(Ze=Xt(["\n      const vec3 mrr = vec3(0.0, 0.6, 0.2);\n      const vec3 emission = vec3(0.0);\n      float occlusion = 1.0;\n\n      void applyPBRFactors() {}\n\n      float getBakedOcclusion() { return 1.0; }\n    "]))))}Object(a.c)(0,.6,.2),(i||(i={})).bindUniforms=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}},qXiY:function(e,t,n){"use strict";n.d(t,"a",function(){return g}),n.d(t,"b",function(){return w}),n.d(t,"c",function(){return O}),n.d(t,"d",function(){return x}),n.d(t,"e",function(){return R}),n.d(t,"f",function(){return M});var r=n("srIe"),a=n("Cy1f"),o=n("5DEt"),i=n("15Hh"),s=n("2uVf"),c=n("r+FG"),u=n("sTkM"),l=n("D8Ta"),d=n("HJJS"),f=n("dXfX"),p=n("BPBZ"),m=n("R/jG"),v=n("+JUG"),h=(n("DZ/s"),n("0Kx6")),b=n("WiJz"),g=function e(){Jt(this,e),this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2},x=function(){function e(){Jt(this,e),this._transform=Object(c.b)(),this._transformInverse=new y({value:this._transform},i.a,c.b),this._transformInverseTranspose=new y(this._transformInverse,i.b,c.b),this._transformTranspose=new y({value:this._transform},i.b,c.b),this._transformInverseRotation=new y({value:this._transform},d.b,s.a)}return Wt(e,[{key:"invalidateLazyTransforms",value:function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}},{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}},{key:"setTransformMatrix",value:function(e){Object(i.c)(this._transform,e)}},{key:"multiplyTransform",value:function(e){Object(i.l)(this._transform,this._transform,e)}},{key:"set",value:function(e){Object(i.c)(this._transform,e),this.invalidateLazyTransforms()}},{key:"setAndInvalidateLazyTransforms",value:function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()}}]),e}(),y=function(){function e(t,n,r){Jt(this,e),this.original=t,this.update=n,this.dirty=!0,this.transform=r()}return Wt(e,[{key:"invalidate",value:function(){this.dirty=!0}},{key:"value",get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}]),e}(),O=function(){function e(){Jt(this,e),this.min=new w,this.max=new w,this.hud=new w,this.ground=new w}return Wt(e,[{key:"init",value:function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]}}]),e}(),w=function(){function e(t){Jt(this,e),this.normal=Object(a.e)(),this.transformation=Object(c.b)(),this._ray=h.f.create(),this.init(t)}return Wt(e,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return Object(o.d)(j,this.ray.direction,this.dist),Object(o.o)(j)}},{key:"getIntersectionPoint",value:function(e){return!!this.hasIntersectionPoint&&(Object(o.d)(j,this.ray.direction,this.dist),Object(o.e)(e,this.ray.origin,j),!0)}},{key:"getTransformedNormal",value:function(e){return Object(o.j)(_,this.normal),_[3]=0,Object(f.m)(_,_,this.transformation),Object(o.j)(e,_),Object(o.q)(e,e),e}},{key:"init",value:function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?h.f.copy(e,this._ray):this._ray=h.f.create()}},{key:"set",value:function(e,t,n,r,s,c,u,l,d,f){e instanceof b.a&&(e={type:"stage",obj:e}),this.dist=n,Object(o.j)(this.normal,r),Object(i.c)(this.transformation,s),this.target=e,this.name=t,this.drapedLayerOrder=c,this.center=u?Object(a.d)(u):null,this.geometryId=l,this.triangleNr=d,this.drapedLayerGraphicOrder=f}},{key:"copyFrom",value:function(e){h.f.copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?Object(a.d)(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(o.j)(this.normal,e.normal),Object(i.c)(this.transformation,e.transformation)}},{key:"toOwner",value:function(e){if(!this.target)return null;switch(this.target.type){case"stage":return T(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e,t){var n=e.metadata.layerUid;return null!=n?t.map.findLayerByUid(n):null}(this.target,e);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return T(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null}},{key:"toGraphic",value:function(e){if(!this.target)return null;switch(this.target.type){case"stage":return C(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e){return e.metadata.createGraphic()}(this.target);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return C(this.target.metadata,e)}}return null}}]),e}();function T(e,t){return Object(r.j)(e)||null==e.layerUid?null:Object(r.k)(t.graphicsView)&&e.layerUid===t.graphicsView.graphics3d.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function C(e,t){if(Object(r.j)(e))return null;var n=T(e,t);if(Object(r.j)(n))return null;if(n===t.graphics)return Object(r.k)(t.graphicsView)?Object(r.q)(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;var a,o,i=t.allLayerViews.find(function(e){return e.layer===n});return i?(o=e,!(a=i)||a.suspended?null:"getGraphicFromIntersectorMetadata"in a&&o?a.getGraphicFromIntersectorMetadata(o):"getGraphicFromGraphicUid"in a&&null!=o.graphicUid?a.getGraphicFromGraphicUid(o.graphicUid):null):null}var S=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Jt(this,e),this.offset=t,this.sphere=Object(v.b)(),this.tmpVertex=Object(a.e)()}return Wt(e,[{key:"applyToVertex",value:function(e,t,n){var r=this.objectTransform.transform,a=r[0]*e+r[4]*t+r[8]*n+r[12],o=r[1]*e+r[5]*t+r[9]*n+r[13],i=r[2]*e+r[6]*t+r[10]*n+r[14],s=this.offset/Math.sqrt(a*a+o*o+i*i);a+=a*s,o+=o*s,i+=i*s;var c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*a+c[4]*o+c[8]*i+c[12],this.tmpVertex[1]=c[1]*a+c[5]*o+c[9]*i+c[13],this.tmpVertex[2]=c[2]*a+c[6]*o+c[10]*i+c[14],this.tmpVertex}},{key:"applyToMinMax",value:function(e,t){var n=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*n,e[1]+=e[1]*n,e[2]+=e[2]*n;var r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r}},{key:"applyToAabb",value:function(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var n=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*n,e[4]+=e[4]*n,e[5]+=e[5]*n,e}},{key:"applyToBoundingSphere",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=this.offset/t;return this.sphere[0]=e[0]+e[0]*n,this.sphere[1]=e[1]+e[1]*n,this.sphere[2]=e[2]+e[2]*n,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}]),e}());function M(e){return Object(r.k)(e)?(S.offset=e,S):null}new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Jt(this,e),this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=Object(a.e)(),this.mbs=Object(l.c)(),this.obb={center:Object(a.e)(),halfSize:Object(m.b)(),quaternion:null}}return Wt(e,[{key:"localOrigin",set:function(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}},{key:"applyToVertex",value:function(e,t,n){var r=e,a=t,o=n+this.componentLocalOriginLength,i=this.offset/Math.sqrt(r*r+a*a+o*o);return this.tmpVertex[0]=e+r*i,this.tmpVertex[1]=t+a*i,this.tmpVertex[2]=n+o*i,this.tmpVertex}},{key:"applyToAabb",value:function(e){var t=e[0],n=e[1],r=e[2]+this.componentLocalOriginLength,a=e[3],o=e[4],i=e[5]+this.componentLocalOriginLength,s=this.offset/Math.sqrt(t*t+n*n+r*r);e[0]+=t*s,e[1]+=n*s,e[2]+=r*s;var c=this.offset/Math.sqrt(a*a+o*o+i*i);return e[3]+=a*c,e[4]+=o*c,e[5]+=i*c,e}},{key:"applyToMbs",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=this.offset/t;return this.mbs[0]=e[0]+e[0]*n,this.mbs[1]=e[1]+e[1]*n,this.mbs[2]=e[2]+e[2]*n,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}},{key:"applyToObb",value:function(e){var t=e.center,n=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*n,this.obb.center[1]=t[1]+t[1]*n,this.obb.center[2]=t[2]+t[2]*n,Object(o.t)(this.obb.halfSize,e.halfSize,e.quaternion),Object(o.e)(this.obb.halfSize,this.obb.halfSize,e.center);var r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,Object(o.i)(this.obb.halfSize,this.obb.halfSize,e.center),Object(p.a)(A,e.quaternion),Object(o.t)(this.obb.halfSize,this.obb.halfSize,A),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}}]),e}()),new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Jt(this,e),this.offset=t,this.tmpVertex=Object(a.e)()}return Wt(e,[{key:"applyToVertex",value:function(e,t,n){var r=e+this.localOrigin[0],a=t+this.localOrigin[1],o=n+this.localOrigin[2],i=this.offset/Math.sqrt(r*r+a*a+o*o);return this.tmpVertex[0]=e+r*i,this.tmpVertex[1]=t+a*i,this.tmpVertex[2]=n+o*i,this.tmpVertex}},{key:"applyToAabb",value:function(e){var t=e[0]+this.localOrigin[0],n=e[1]+this.localOrigin[1],r=e[2]+this.localOrigin[2],a=e[3]+this.localOrigin[0],o=e[4]+this.localOrigin[1],i=e[5]+this.localOrigin[2],s=this.offset/Math.sqrt(t*t+n*n+r*r);e[0]+=t*s,e[1]+=n*s,e[2]+=r*s;var c=this.offset/Math.sqrt(a*a+o*o+i*i);return e[3]+=a*c,e[4]+=o*c,e[5]+=i*c,e}}]),e}());var R="terrain",j=(Object(a.e)(),Object(a.e)()),_=Object(l.c)(),A=Object(u.a)()},qrV2:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n("OIYi");function a(e,t){var n=e.fragment;n.code.add(r.a($e||($e=Xt(["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "])))),n.code.add(1===t.doubleSidedMode?r.a(et||(et=Xt(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "]))):2===t.doubleSidedMode?r.a(tt||(tt=Xt(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "]))):r.a(nt||(nt=Xt(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "]))))}},sJp1:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n("OIYi");function a(e){e.attributes.add("position","vec3"),e.vertex.code.add(r.a(rt||(rt=Xt(["\n    vec3 positionModel() { return position; }\n  "]))))}},sKsC:function(e,t,n){"use strict";n.d(t,"a",function(){return j}),n.d(t,"b",function(){return R});var r=n("OIYi"),a=n("Tbkp"),o=n("aQrP"),i=n("0nJL"),s=n("0Ect"),c=n("viRi"),u=n("69UF"),l=n("F7CJ"),d=n("xtdb"),f=n("0BfS"),p=n("vXUg"),m=n("XV/G"),v=n("1TnO"),h=n("368d"),b=n("p9cc"),g=n("F8o4"),x=n("wzLF"),y=n("sJp1"),O=n("bLIi"),w=n("bVvB"),T=n("fiGu"),C=n("cIib"),S=n("6kvK"),M=n("NiZE");function R(e){var t=new o.a,n=t.vertex.code,R=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(y.a),t.varyings.add("vpos","vec3"),t.include(c.a,e),t.include(v.a,e),t.include(l.a,e),0!==e.output&&7!==e.output||(t.include(x.a,e),t.include(a.a,{linearDepth:!1}),e.offsetBackfaces&&t.include(g.a),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.include(h.a,e),t.include(p.a,e),t.include(O.a,e),t.include(w.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),n.add(r.a(at||(at=Xt(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt = externalColor;\n          ","\n          vcolorExt *= vvColor();\n          vcolorExt *= getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a < ",") {\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos = calculateVPos();\n            localvpos = vpos - view[3].xyz;\n            vpos = subtractOrigin(vpos);\n            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));\n            vpos = addVerticalOffset(vpos, localOrigin);\n            gl_Position = transformPosition(proj, view, vpos);\n            ","\n          }\n          ","\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),e.instancedColor?"vcolorExt *= instanceColor;":"",r.a.float(u.c),e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?r.a(ot||(ot=Xt(["depth = (view * vec4(vpos, 1.0)).z;"]))):""))),7===e.output&&(t.include(i.a,e),t.include(u.a,e),e.multipassTerrainEnabled&&(t.fragment.include(s.a),t.include(d.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(M.a),R.add(r.a(it||(it=Xt(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?r.a(st||(st=Xt(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?r.a(ct||(ct=Xt(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):r.a(ut||(ut=Xt(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?r.a(lt||(lt=Xt(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):r.a(dt||(dt=Xt(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(i.a,e),t.include(S.a,e),t.include(C.a,e),t.include(u.a,e),e.receiveShadows&&t.include(f.a,e),e.multipassTerrainEnabled&&(t.fragment.include(s.a),t.include(d.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(b.a,e),t.include(m.a,e),t.fragment.include(M.a),R.add(r.a(ft||(ft=Xt(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        vec3 viewDirection = normalize(vpos - camPos);\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?r.a(pt||(pt=Xt(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?r.a(mt||(mt=Xt(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):r.a(vt||(vt=Xt(["vec4 texColor = vec4(1.0);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?r.a(ht||(ht=Xt(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):r.a(bt||(bt=Xt(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),r.a(gt||(gt=Xt(["\n        vec3 shadedNormal = normalize(vNormalWorld);\n        albedo_ *= 1.2;\n        vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView = clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance = 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff = vColor.r;\n        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight += backLightFactor * lightingMainIntensity;"]))),1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?r.a(xt||(xt=Xt(["vec3 normalGround = normalize(vpos + localOrigin);"]))):r.a(yt||(yt=Xt(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):r.a(Ot||(Ot=Xt([""]))),1===e.pbrMode||2===e.pbrMode?r.a(wt||(wt=Xt(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(T.a,e),t}var j=Object.freeze({__proto__:null,build:R})},vXUg:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n("OIYi");function a(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(r.a(Tt||(Tt=Xt(["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "]))))):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("cameraNearFar","vec2"),e.vertex.code.add(r.a(Ct||(Ct=Xt(["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);\n      }\n    "]))))):e.vertex.code.add(r.a(St||(St=Xt(["\n      void forwardLinearDepth() {}\n    "]))))}},wzLF:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n("OIYi");function a(e){var t=r.a(Mt||(Mt=Xt(["\n    vec3 decodeNormal(vec2 f) {\n      float z = 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "])));e.fragment.code.add(t),e.vertex.code.add(t)}function o(e,t){0===t.normalType&&(e.attributes.add("normal","vec3"),e.vertex.code.add(r.a(Rt||(Rt=Xt(["\n      vec3 normalModel() {\n        return normal;\n      }\n    "]))))),1===t.normalType&&(e.include(a),e.attributes.add("normalCompressed","vec2"),e.vertex.code.add(r.a(jt||(jt=Xt(["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "]))))),3===t.normalType&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(r.a(_t||(_t=Xt(["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "])))))}}}])}();