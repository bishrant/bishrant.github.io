(function(){var e={"esri/views/3d/webgl-engine/lib/geometryDataUtils":"+nCE","esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":"+wMf","esri/views/3d/webgl-engine/lib/glUtil3D":"/Bau","esri/views/3d/support/geometryUtils/sphere":"/dtL","esri/views/3d/support/geometryUtils/vector":"18xY","esri/views/3d/webgl-engine/lib/doublePrecisionUtils":"1f+t","esri/core/libs/gl-matrix-2/mat4f64":"1m5D","esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":"2NOe","esri/views/3d/support/geometryUtils/boundedPlane":"2eYJ","esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":"2o+p","esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":"3PFg","esri/views/3d/webgl-engine/lib/BoundingInfo":"3RHn","esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":"3kdR","esri/views/3d/support/geometryUtils/ray":"4p4v","esri/core/libs/gl-matrix-2/mat3f64":"51bw","esri/views/3d/webgl-engine/lib/Object3DStateSet":"62Ht","esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":"6t3m","esri/views/3d/webgl-engine/core/shaderModules/interfaces":"7Aei","esri/views/3d/webgl-engine/lib/intersectorUtils":"9DjX","esri/views/3d/webgl-engine/lib/GLMaterialTexture":"9FJH","esri/views/3d/webgl-engine/lib/GeometryData":"AgDx","esri/views/3d/webgl-engine/lib/Util":"CIy2","esri/core/libs/gl-matrix-2/factories/mat4f64":"CIzB","esri/views/3d/webgl-engine/lib/GeometryRecord":"Cvn+","esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":"DKwL","esri/views/3d/webgl-engine/lib/DefaultTextureUnits":"EiD/","esri/views/3d/webgl-engine/lib/DDSUtil":"EyQ4","esri/views/3d/webgl-engine/lib/Material":"FNtW","esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":"FQ4r","esri/views/3d/support/geometryUtils/plane":"GG08","esri/views/3d/support/geometryUtils/axisAngle":"GyfB","esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":"ILj8","esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":"IwVr","esri/views/3d/support/stack":"JjCO","esri/views/3d/webgl-engine/lib/AutoDisposable":"KRuQ","esri/views/3d/support/geometryUtils/lineSegment":"N5NQ","esri/core/ObjectStack":"PHan","esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":"PaEL","esri/views/3d/webgl-engine/materials/renderers/utils":"PwS/","esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":"W/V4","esri/views/3d/webgl-engine/lib/IdGen":"W0kZ","esri/views/3d/webgl-engine/lib/Object3D":"ZJC8","esri/views/3d/support/geometryUtils/triangle":"ZjcA","esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":"aExC","esri/views/3d/support/geometryUtils":"aWgr","esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":"cj3m","esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":"cmSR","esri/views/3d/support/geometryUtils/frustum":"cpxo","esri/views/3d/support/geometryUtils/clipRay":"fXZm","esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":"fese","esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":"ff/U","esri/core/libs/gl-matrix-2/factories/vec3f32":"iHt0","esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":"juLw","esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":"lBa0","esri/views/3d/webgl-engine/lib/StencilUtils":"lfQW","esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":"piY7","esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":"quQL","esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":"rCq5","esri/views/3d/webgl-engine/materials/internal/MaterialUtil":"s6rJ","esri/views/3d/webgl-engine/lib/GLMaterial":"tUyH","esri/core/libs/gl-matrix-2/vec3f32":"vlC2","esri/core/VectorStack":"wSO/","esri/views/3d/support/imageUtils":"weRx","esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":"xDGw","esri/views/3d/webgl-engine/lib/Texture":"yqrJ","esri/views/3d/webgl-engine/lib/Geometry":"ys4y","esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":"zZCp"},t=this||window,n=t.webpackJsonp=t.webpackJsonp||[];n.registerAbsMids?n.registerAbsMids(e):(n.absMidsWaiting=n.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"+nCE":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("0LE5"),n("Rdxj"),n("ZjcA")],void 0===(i=(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNewId=t.computeAttachmentOriginLines=t.computeAttachmentOriginPoints=t.computeAttachmentOriginTriangles=t.generateDefaultIndexArray=void 0;var o=1,a=null,s=new Uint32Array([0]);t.generateDefaultIndexArray=function(e){if(1===e)return s;if(e>o||null==a){for(;e>o;)o*=2;a=new Uint32Array(o);for(var t=0;t<o;t++)a[t]=t}return new Uint32Array(a.buffer,0,e)},t.computeAttachmentOriginTriangles=function(e,t,r){if(!e)return!1;var o=e.strideIdx,a=e.offsetIdx,s=e.data;n.vec3.set(r,0,0,0),n.vec3.set(d,0,0,0);for(var c=0,v=0,p=0;p<t.length-2;p+=3){var h=t[p+0]*o+a,m=t[p+1]*o+a,g=t[p+2]*o+a;n.vec3.set(l,s[h+0],s[h+1],s[h+2]),n.vec3.set(u,s[m+0],s[m+1],s[m+2]),n.vec3.set(f,s[g+0],s[g+1],s[g+2]);var b=i.areaPoints3d(l,u,f);b?(n.vec3.add(l,l,u),n.vec3.add(l,l,f),n.vec3.scale(l,l,1/3*b),n.vec3.add(r,r,l),c+=b):(n.vec3.add(d,d,l),n.vec3.add(d,d,u),n.vec3.add(d,d,f),v+=3)}return!(0===v&&0===c||(0!==c?(n.vec3.scale(r,r,1/c),0):0===v||(n.vec3.scale(r,d,1/v),0)))},t.computeAttachmentOriginPoints=function(e,t,r){if(!e||!t)return!1;var i=e.strideIdx,o=e.offsetIdx,a=e.data;n.vec3.set(r,0,0,0);for(var s=-1,c=0,l=0;l<t.length;l++){var u=t[l]*i+o;s!==u&&(r[0]+=a[u+0],r[1]+=a[u+1],r[2]+=a[u+2],c++),s=u}return c>1&&n.vec3.scale(r,r,1/c),c>0},t.computeAttachmentOriginLines=function(e,t,r,i){if(!e)return!1;var o=e.strideIdx,a=e.offsetIdx,s=e.data;n.vec3.set(i,0,0,0),n.vec3.set(d,0,0,0);for(var c=0,f=0,v=t?t.length-1:s.length/o-1,p=v+(r?2:0),h=0;h<p;h+=2){var m=h<v?h:v,g=h<v?h+1:0,b=(t?t[m]:m)*o+a,y=(t?t[g]:g)*o+a;l[0]=s[b+0],l[1]=s[b+1],l[2]=s[b+2],u[0]=s[y+0],u[1]=s[y+1],u[2]=s[y+2],n.vec3.scale(l,n.vec3.add(l,l,u),.5);var x=n.vec3.dist(l,u);x>0?(n.vec3.add(i,i,n.vec3.scale(l,l,x)),c+=x):(n.vec3.add(d,d,l),f++)}return 0!==c?(n.vec3.scale(i,i,1/c),!0):0!==f&&(n.vec3.scale(i,d,1/f),!0)};var c=0;t.getNewId=function(){return c++};var l=r.vec3f64.create(),u=r.vec3f64.create(),f=r.vec3f64.create(),d=r.vec3f64.create()}).apply(null,r))||(e.exports=i)},"+wMf":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("KDna")],void 0===(i=(function(e,t,n,r){"use strict";function i(e,t,n){var r=n.parameters,i=n.paddingPixelsOverride;return u.scale=Math.min(r.divisor/(t-r.offset),1),u.factor=function(e){return Math.abs(e*e*e)}(e),u.minPixelSize=r.minPixelSize,u.paddingPixels=i,u}function o(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function a(e,t){return Math.max(n.lerp(e*t.scale,e,t.factor),o(e,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.scale=t.applyPrecomputedScaleFactor=t.precomputeScaleFactor=t.applyScaleFactorVec2=t.applyScaleFactor=t.getLabelSettings=t.getSettings=void 0,t.getSettings=function(e){return new s(e,c)},t.getLabelSettings=function(e){var t=c.curvatureDependent;return new s(e,{curvatureDependent:{min:{curvature:t.min.curvature,tiltAngle:t.min.tiltAngle,scaleFallOffFactor:l.curvatureDependent.min.scaleFallOffFactor},max:{curvature:t.max.curvature,tiltAngle:t.max.tiltAngle,scaleFallOffFactor:l.curvatureDependent.max.scaleFallOffFactor}},scaleStart:c.scaleStart,scaleFallOffRange:c.scaleFallOffRange,minPixelSize:l.minPixelSize})},t.applyScaleFactor=a,t.applyScaleFactorVec2=function(e,t,r){void 0===r&&(r=[0,0]);var i=Math.min(Math.max(t.scale,o(e[1],t)/e[1]),1);return r[0]=n.lerp(e[0]*i,e[0],t.factor),r[1]=n.lerp(e[1]*i,e[1],t.factor),r},t.precomputeScaleFactor=function(e,t,n,r){r.scale=function(e,t,n){var r=i(e,t,n);return r.minPixelSize=0,r.paddingPixels=0,a(1,r)}(e,t,n),r.factor=0,r.minPixelSize=n.parameters.minPixelSize,r.paddingPixels=n.paddingPixelsOverride},t.applyPrecomputedScaleFactor=function(e,t,n){void 0===n&&(n=[0,0]);var r=Math.min(Math.max(t.scale,o(e[1],t)/e[1]),1);return n[0]=e[0]*r,n[1]=e[1]*r,n},t.scale=function(e,t,n,r){return a(e,i(t,n,r))};var s=function(){function e(e,t,n,r){void 0===n&&(n={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}),this.viewingMode=e,this.description=t,this.parameters=n,this._paddingPixelsOverride=r,2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}return Object.defineProperty(e.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!1,configurable:!0}),e.prototype.update=function(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this.calculateParameters(e,this.parameters),0))},e.prototype.overridePadding=function(t){return t!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.parameters,t):this},e.prototype.calculateParameters=function(e,t){var n=this.description,r=n.scaleStart,i=n.scaleFallOffRange,o=n.minPixelSize,a=e.fovY,s=e.distance,c=this.calculateCurvatureDependentParameters(e),l=this.coverageCompensation(e,c),u=c.tiltAngle,f=c.scaleFallOffFactor,d=Math.sin(u)*s,v=.5*Math.PI-u-a*(.5-r*l),p=d/Math.cos(v),h=(p-f*(d/Math.cos(v+a*i*l)))/(1-f);return t.camera.fovY=e.fovY,t.camera.distance=e.distance,t.offset=h,t.divisor=p-h,t.minPixelSize=o,t},e.prototype.calculateCurvatureDependentParametersLocal=function(e,t){return void 0===t&&(t=f),t.tiltAngle=this.description.curvatureDependent.min.tiltAngle,t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,t},e.prototype.calculateCurvatureDependentParametersGlobal=function(e,t){void 0===t&&(t=f);var i=this.description.curvatureDependent,o=1+e.distance/r.earthRadius,a=Math.sqrt(o*o-1),s=[i.min.curvature,i.max.curvature],c=s[0],l=n.clamp((a-c)/(s[1]-c),0,1),u=[i.min,i.max],d=u[0],v=u[1];return t.tiltAngle=n.lerp(d.tiltAngle,v.tiltAngle,l),t.scaleFallOffFactor=n.lerp(d.scaleFallOffFactor,v.scaleFallOffFactor,l),t},e.prototype.surfaceCoverageCompensationLocal=function(e,t){return(e.fovY-t.tiltAngle)/e.fovY},e.prototype.surfaceCoverageCompensationGlobal=function(e,t){var n=r.earthRadius*r.earthRadius,i=t.tiltAngle+.5*Math.PI,o=e.fovY,a=e.distance,s=a*a+n-2*Math.cos(i)*a*r.earthRadius,c=Math.sqrt(s),l=Math.sqrt(s-n);return(Math.acos(l/c)-Math.asin(r.earthRadius/(c/Math.sin(i)))+.5*o)/o},e}(),c={curvatureDependent:{min:{curvature:n.deg2rad(10),tiltAngle:n.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:n.deg2rad(70),tiltAngle:n.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},l={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14},u={scale:0,factor:0,minPixelSize:0,paddingPixels:0},f={tiltAngle:0,scaleFallOffFactor:0}}).apply(null,r))||(e.exports=i)},"/Bau":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("ff/U"),n("zZCp"),n("QFi0"),n("Zp3t"),n("z2+Q")],void 0===(i=(function(e,t,n,r,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createEmptyDepthTexture=t.createColorTexture=t.createEmptyTexture=t.createQuadVAO=void 0,t.createQuadVAO=function(e,t,o){void 0===t&&(t=r.Pos2),void 0===o&&(o=n.Default3D);var s=null;switch(t){case r.Pos2Tex:s=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;case r.Pos2:default:s=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new a(e,o,{geometry:t},{geometry:i.createVertex(e,35044,s)})},t.createEmptyTexture=function(e,t){return void 0===t&&(t=4),new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,n){void 0===n&&(n=4);for(var r=new Uint8Array(n*n*4),i=0;i<r.length;i+=4)r[i+0]=255*t[0],r[i+1]=255*t[1],r[i+2]=255*t[2],r[i+3]=255*t[3];return new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:n,height:n},r)},t.createEmptyDepthTexture=function(e){return new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}}).apply(null,r))||(e.exports=i)},"/dtL":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("qsST"),n("xoE+"),n("PHan"),n("FXVB"),n("0LE5"),n("Rdxj"),n("AzkI"),n("JjCO"),n("4p4v"),n("18xY")],void 0===(i=(function(e,t,n,r,i,o,a,s,c,l,u,f,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setAltitudeAt=t.altitudeAt=t.axisAt=t.angleToSilhouette=t.distanceToSilhouette=t.projectPoint=t.closestPoint=t.closestPointOnSilhouette=t.intersectRayClosestSilhouette=t.intersectsRay=t.intersectScreen=t.intersectRay=t.setExtent=t.elevate=t.fromValues=t.copy=t.wrap=t.create=void 0;var v=r.getLogger("esri.views.3d.support.geometryUtils.sphere");function p(e){return e?{radius:e.radius,center:c.vec3f64.clone(e.center)}:{radius:1,center:c.vec3f64.create()}}function h(e,t){return void 0===t&&(t=p()),m(e.radius,e.center,t)}function m(e,t,n){return void 0===n&&(n=p()),s.vec3.copy(n.center,t),n.radius=e,n}function g(e,t,n){var r=s.vec3.subtract(u.sv3d.get(),t.origin,e.center),i=s.vec3.dot(t.direction,t.direction),o=2*s.vec3.dot(t.direction,r),a=o*o-4*i*(s.vec3.dot(r,r)-e.radius*e.radius);if(a<0)return!1;var c=Math.sqrt(a),l=(-o-c)/(2*i),f=(-o+c)/(2*i);return(l<0||f<l&&f>0)&&(l=f),!(l<0||(n&&s.vec3.add(n,t.origin,s.vec3.scale(u.sv3d.get(),t.direction,l)),0))}function b(e,t,n){var r=u.sv3d.get(),i=u.sm4d.get();s.vec3.cross(r,t.origin,t.direction),s.vec3.cross(n,r,t.origin),s.vec3.scale(n,n,1/s.vec3.length(n)*e.radius);var o=x(e,t.origin),c=d.angle(t.origin,n);return a.mat4.identity(i),a.mat4.rotate(i,i,c+o,r),s.vec3.transformMat4(n,n,i),n}function y(e,t,n){var r=s.vec3.subtract(u.sv3d.get(),t,e.center),i=s.vec3.scale(u.sv3d.get(),r,e.radius/s.vec3.length(r));return s.vec3.add(n,i,e.center)}function x(e,t){var n=s.vec3.subtract(u.sv3d.get(),t,e.center),r=s.vec3.length(n),o=e.radius+Math.abs(e.radius-r);return i.acosClamped(e.radius/o)}t.create=p,t.wrap=function(e,t){var n=w.get();return n.radius=e,n.center=t||M,n},t.copy=h,t.fromValues=m,t.elevate=function(e,t,n){return e!==n&&s.vec3.copy(n.center,e.center),n.radius=e.radius+t,n},t.setExtent=function(e,t,n){return v.error("sphere.setExtent is not yet supported"),e===n?n:h(e,n)},t.intersectRay=g,t.intersectScreen=function(e,t,n,r){return g(e,f.fromScreenAtEye(t,n,P),r)},t.intersectsRay=function(e,t){return g(e,t,null)},t.intersectRayClosestSilhouette=function(e,t,n){if(g(e,t,n))return n;var r=b(e,t,u.sv3d.get());return s.vec3.add(n,t.origin,s.vec3.scale(u.sv3d.get(),t.direction,s.vec3.distance(t.origin,r)/s.vec3.length(t.direction))),n},t.closestPointOnSilhouette=b,t.closestPoint=function(e,t,n){return g(e,t,n)?n:(f.closestPoint(t,e.center,n),y(e,n,n))},t.projectPoint=y,t.distanceToSilhouette=function(e,t){var n=s.vec3.subtract(u.sv3d.get(),t,e.center),r=s.vec3.squaredLength(n);return Math.sqrt(Math.abs(r-e.radius*e.radius))},t.angleToSilhouette=x;var _=c.vec3f64.create();function S(e,t,r,i){var o=s.vec3.subtract(_,t,e.center);switch(r){case 0:var a=(c=l.cartesianToSpherical(o,_))[2];return s.vec3.set(i,-Math.sin(a),Math.cos(a),0);case 1:var c,u=(c=l.cartesianToSpherical(o,_))[1],f=(a=c[2],Math.sin(u));return s.vec3.set(i,-f*Math.cos(a),-f*Math.sin(a),Math.cos(u));case 2:return s.vec3.normalize(i,o);default:return void n.neverReached(r)}}function O(e,t){var n=s.vec3.subtract(T,t,e.center);return s.vec3.length(n)-e.radius}t.axisAt=S,t.altitudeAt=O,t.setAltitudeAt=function(e,t,n,r){var i=O(e,t),o=S(e,t,2,T),a=s.vec3.scale(T,o,n-i);return s.vec3.add(r,t,a),r};var w=new o.ObjectStack((function(){return{center:null,radius:0}})),P=f.create(),M=c.vec3f64.create(),T=c.vec3f64.create();Object.freeze(M)}).apply(null,r))||(e.exports=i)},"18xY":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("0LE5"),n("Rdxj")],void 0===(i=(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.angleAroundAxis=t.angle=t.projectPointSignedLength=t.projectPoint=void 0,t.projectPoint=function(e,t,n){var i=r.vec3.dot(e,t)/r.vec3.dot(e,e);return r.vec3.scale(n,e,i)},t.projectPointSignedLength=function(e,t){return r.vec3.dot(e,t)/r.vec3.length(e)},t.angle=function(e,t){var i=r.vec3.dot(e,t)/(r.vec3.length(e)*r.vec3.length(t));return-n.acosClamped(i)},t.angleAroundAxis=function(e,t,i){r.vec3.normalize(o,e),r.vec3.normalize(a,t);var s=r.vec3.dot(o,a),c=n.acosClamped(s),l=r.vec3.cross(o,o,a);return r.vec3.dot(l,i)<0?2*Math.PI-c:c};var o=i.vec3f64.create(),a=i.vec3f64.create()}).apply(null,r))||(e.exports=i)},"1f+t":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function n(e,t,n){for(var r=0;r<n;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDoubleArraySplit=t.decodeDoubleArray=t.encodeDoubleArray=t.encodeDouble=void 0,t.encodeDouble=function(e,t){i[0]=e,i[1]=e-i[0],t[0]=i[0],t[1]=i[1]},t.encodeDoubleArray=n,t.decodeDoubleArray=function(e,t,n){for(var r=0;r<n;++r)t[r]=e[2*r]+e[2*r+1]},t.encodeDoubleArraySplit=function(e,t,o,a){for(var s=0;s<a;++s)r[0]=e[s],n(r,i,1),t[s]=i[0],o[s]=i[1]};var r=new Float64Array(1),i=new Float32Array(2)}).apply(null,r))||(e.exports=i)},"1m5D":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("CIzB")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat4f64=void 0,t.mat4f64=n}).apply(null,r))||(e.exports=i)},"2NOe":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("FXVB"),n("oZZu")],void 0===(i=(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0,function(e){function t(e,t,r){n.mat4.translate(i,r,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",i)}e.bindCamPosition=function(e,t,n){e.setUniform3f("camPos",n[3]-t[0],n[7]-t[1],n[11]-t[2])},e.bindProjectionMatrix=function(e,t){e.setUniformMatrix4fv("proj",t)},e.bindNearFar=function(e,t){e.setUniform2fv("nearFar",t)},e.bindViewCustomOrigin=t,e.bindView=function(e,n){t(e,n.origin,n.camera.viewMatrix)},e.bindViewport=function(e,t){e.setUniform4fv("viewport",t.camera.fullViewport)}}(t.View||(t.View={}));var i=r.mat4f32.create()}).apply(null,r))||(e.exports=i)},"2eYJ":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("pcDC"),n("qsST"),n("xoE+"),n("PHan"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("AzkI"),n("JjCO"),n("N5NQ"),n("GG08"),n("4p4v"),n("18xY")],void 0===(i=(function(e,t,n,r,i,o,a,s,c,l,u,f,d,v,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UP=t.normal=t.rotate=t.transform=t.equals=t.setAltitudeAt=t.altitudeAt=t.axisAt=t.extrusionContainsPoint=t.distanceToSilhouette=t.distance=t.distance2=t.projectPointLocal=t.projectPoint=t.closestPoint=t.closestPointOnSilhouette=t.intersectRayClosestSilhouette=t.intersectRay=t.fromAABoundingRect=t.setExtent=t.elevate=t.updateUnboundedPlane=t.fromValues=t.copy=t.wrap=t.create=t.BoundedPlaneClass=void 0;var m=r.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function g(e){return void 0===e&&(e=t.UP),{plane:v.create(e.plane),origin:l.vec3f64.clone(e.origin),basis1:l.vec3f64.clone(e.basis1),basis2:l.vec3f64.clone(e.basis2)}}function b(e,t){return void 0===t&&(t=g()),y(e.origin,e.basis1,e.basis2,t)}function y(e,t,n,r){return void 0===r&&(r=g()),c.vec3.copy(r.origin,e),c.vec3.copy(r.basis1,t),c.vec3.copy(r.basis2,n),x(r),function(e,t){Math.abs(c.vec3.dot(e.basis1,e.basis2)/(c.vec3.length(e.basis1)*c.vec3.length(e.basis2)))>1e-6&&m.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(c.vec3.dot(e.basis1,j(e)))>1e-6&&m.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-c.vec3.dot(j(e),e.origin)-e.plane[3])>1e-6&&m.warn(t,"Plane offset is not consistent with plane origin")}(r,"fromValues()"),r}function x(e){v.fromVectorsAndPoint(e.basis2,e.basis1,e.origin,e.plane)}function _(e,t,n){e!==n&&b(e,n);var r=c.vec3.scale(f.sv3d.get(),j(e),t);return c.vec3.add(n.origin,n.origin,r),n.plane[3]-=t,n}function S(e,t){void 0===t&&(t=g());var n=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return c.vec3.set(t.origin,e[0]+n,e[1]+r,0),c.vec3.set(t.basis1,n,0,0),c.vec3.set(t.basis2,0,r,0),v.fromValues(0,0,1,0,t.plane),t}function O(e,t,n){return!!v.intersectRay(e.plane,t,n)&&V(e,n)}function w(e,t,n){var r=L.get();D(e,t,r,L.get());for(var o=Number.POSITIVE_INFINITY,a=0,s=B;a<s.length;a++){var l=C(e,s[a],F.get()),d=f.sv3d.get();if(v.intersectLineSegment(r,l,d)){var p=u.directionFromTo(f.sv3d.get(),t.origin,d),h=Math.abs(i.acosClamped(c.vec3.dot(t.direction,p)));h<o&&(o=h,c.vec3.copy(n,d))}}return o===Number.POSITIVE_INFINITY?P(e,t,n):n}function P(e,t,n){if(O(e,t,n))return n;var r=L.get(),i=L.get();D(e,t,r,i);for(var o=Number.POSITIVE_INFINITY,a=0,s=B;a<s.length;a++){var l=C(e,s[a],F.get()),u=f.sv3d.get();if(v.intersectLineSegmentClamp(r,l,u)){var d=p.distance2(t,u);if(!v.isPointInside(i,u))continue;d<o&&(o=d,c.vec3.copy(n,u))}}return A(e,t.origin)<o&&M(e,t.origin,n),n}function M(e,t,n){var r=v.projectPoint(e.plane,t,f.sv3d.get()),i=d.projectPointClamp(z(e,e.basis1),r,-1,1,f.sv3d.get()),o=d.projectPointClamp(z(e,e.basis2),r,-1,1,f.sv3d.get());return c.vec3.subtract(n,c.vec3.add(f.sv3d.get(),i,o),e.origin),n}function T(e,t,n){var r=e.origin,i=e.basis1,o=e.basis2,a=c.vec3.subtract(f.sv3d.get(),t,r),s=h.projectPointSignedLength(i,a),l=h.projectPointSignedLength(o,a),u=h.projectPointSignedLength(j(e),a);return c.vec3.set(n,s,l,u)}function A(e,t){var n=T(e,t,f.sv3d.get()),r=e.basis2,i=c.vec3.length(e.basis1),o=c.vec3.length(r),a=Math.max(Math.abs(n[0])-i,0),s=Math.max(Math.abs(n[1])-o,0),l=n[2];return a*a+s*s+l*l}function I(e,t){var n=-e.plane[3];return h.projectPointSignedLength(j(e),t)-n}function j(e){return v.normal(e.plane)}function V(e,t){var n=c.vec3.subtract(f.sv3d.get(),t,e.origin),r=c.vec3.squaredLength(e.basis1),i=c.vec3.squaredLength(e.basis2),o=c.vec3.dot(e.basis1,n),a=c.vec3.dot(e.basis2,n);return-o-r<0&&o-r<0&&-a-i<0&&a-i<0}function z(e,t){var n=F.get();return c.vec3.copy(n.origin,e.origin),c.vec3.copy(n.vector,t),n}function C(e,t,n){var r=e.basis1,i=e.basis2,o=e.origin,a=c.vec3.scale(f.sv3d.get(),r,t.origin[0]),s=c.vec3.scale(f.sv3d.get(),i,t.origin[1]);c.vec3.add(n.origin,a,s),c.vec3.add(n.origin,n.origin,o);var l=c.vec3.scale(f.sv3d.get(),r,t.direction[0]),u=c.vec3.scale(f.sv3d.get(),i,t.direction[1]);return c.vec3.scale(n.vector,c.vec3.add(l,l,u),2),n}function D(e,t,n,r){var i=j(e);v.fromVectorsAndPoint(i,t.direction,t.origin,n),v.fromVectorsAndPoint(v.normal(n),i,t.origin,r)}t.BoundedPlaneClass=function(){this.plane=v.create(),this.origin=l.vec3f64.create(),this.basis1=l.vec3f64.create(),this.basis2=l.vec3f64.create()},t.create=g,t.wrap=function(e,t,n){var r=N.get();return r.origin=e,r.basis1=t,r.basis2=n,r.plane=v.wrap(0,0,0,0),x(r),r},t.copy=b,t.fromValues=y,t.updateUnboundedPlane=x,t.elevate=_,t.setExtent=function(e,t,n){return S(t,n),_(n,I(e,e.origin),n),n},t.fromAABoundingRect=S,t.intersectRay=O,t.intersectRayClosestSilhouette=function(e,t,n){if(O(e,t,n))return n;var r=w(e,t,f.sv3d.get());return c.vec3.add(n,t.origin,c.vec3.scale(f.sv3d.get(),t.direction,c.vec3.distance(t.origin,r)/c.vec3.length(t.direction))),n},t.closestPointOnSilhouette=w,t.closestPoint=P,t.projectPoint=M,t.projectPointLocal=T,t.distance2=A,t.distance=function(e,t){return Math.sqrt(A(e,t))},t.distanceToSilhouette=function(e,t){for(var n=Number.NEGATIVE_INFINITY,r=0,i=B;r<i.length;r++){var o=C(e,i[r],F.get()),a=d.distance2(o,t);a>n&&(n=a)}return Math.sqrt(n)},t.extrusionContainsPoint=function(e,t){return v.isPointInside(e.plane,t)&&V(e,t)},t.axisAt=function(e,t,r,i){return function(e,t,r){switch(t){case 0:c.vec3.copy(r,e.basis1),c.vec3.normalize(r,r);break;case 1:c.vec3.copy(r,e.basis2),c.vec3.normalize(r,r);break;case 2:c.vec3.copy(r,j(e));break;default:n.neverReached(t)}return r}(e,r,i)},t.altitudeAt=I,t.setAltitudeAt=function(e,t,n,r){var i=I(e,t),o=c.vec3.scale(R,j(e),n-i);return c.vec3.add(r,t,o),r},t.equals=function(e,t){return c.vec3.exactEquals(e.basis1,t.basis1)&&c.vec3.exactEquals(e.basis2,t.basis2)&&c.vec3.exactEquals(e.origin,t.origin)},t.transform=function(e,t,n){return e!==n&&b(e,n),a.mat4.invert(E,t),a.mat4.transpose(E,E),c.vec3.transformMat4(n.basis1,e.basis1,E),c.vec3.transformMat4(n.basis2,e.basis2,E),c.vec3.transformMat4(v.normal(n.plane),v.normal(e.plane),E),c.vec3.transformMat4(n.origin,e.origin,t),v.setOffsetFromPoint(n.plane,n.origin,n.plane),n},t.rotate=function(e,t,n,r){return e!==r&&b(e,r),a.mat4.rotate(H,a.mat4.identity(H),t,n),c.vec3.transformMat4(r.basis1,e.basis1,H),c.vec3.transformMat4(r.basis2,e.basis2,H),x(r),r},t.normal=j,t.UP={plane:v.create(),origin:l.vec3f64.fromValues(0,0,0),basis1:l.vec3f64.fromValues(1,0,0),basis2:l.vec3f64.fromValues(0,1,0)};var L=new o.ObjectStack(v.create),F=new o.ObjectStack(d.create),R=l.vec3f64.create(),N=new o.ObjectStack((function(){return{origin:null,basis1:null,basis2:null,plane:null}})),B=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],E=s.mat4f64.create(),H=s.mat4f64.create()}).apply(null,r))||(e.exports=i)},"2o+p":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei"),n("s6rJ")],void 0===(i=(function(e,t,n,r,i){"use strict";function o(e){e.vertex.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize = 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "],["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize = 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "])))),e.vertex.code.add(r.glsl(s||(s=n.__makeTemplateObject(["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "],["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "])))),e.vertex.code.add(r.glsl(c||(c=n.__makeTemplateObject(["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "],["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "])))),e.vertex.code.add(r.glsl(l||(l=n.__makeTemplateObject(["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "],["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "])))),e.vertex.code.add(r.glsl(u||(u=n.__makeTemplateObject(["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "],["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "])))),e.vertex.code.add(r.glsl(f||(f=n.__makeTemplateObject(["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "],["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "])))),e.vertex.code.add(r.glsl(d||(d=n.__makeTemplateObject(["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "]))))}var a,s,c,l,u,f,d;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSizePerspective=void 0,t.ScreenSizePerspective=o,function(e){e.bindUniforms=function(e,t){t.screenSizePerspective&&(i.bindScreenSizePerspective(t.screenSizePerspective,e,"screenSizePerspective"),i.bindScreenSizePerspective(t.screenSizePerspectiveAlignment||t.screenSizePerspective,e,"screenSizePerspectiveAlignment"))}}(o=t.ScreenSizePerspective||(t.ScreenSizePerspective={}))}).apply(null,r))||(e.exports=i)},"3PFg":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";function i(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add("instanceFeatureAttribute","vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "],["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "])))),e.vertex.code.add(r.glsl(s||(s=n.__makeTemplateObject(["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "],["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "])),t.vvInstancingEnabled?r.glsl(a||(a=n.__makeTemplateObject(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"],["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):e.vertex.code.add(r.glsl(c||(c=n.__makeTemplateObject(["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "],["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "])))),t.vvColor?(e.vertex.defines.addInt("VV_COLOR_N",8),e.vertex.code.add(r.glsl(u||(u=n.__makeTemplateObject(["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < VV_COLOR_N; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ","\n    "],["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < VV_COLOR_N; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ","\n    "])),t.vvInstancingEnabled?r.glsl(l||(l=n.__makeTemplateObject(["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"],["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"]))):""))):e.vertex.code.add(r.glsl(f||(f=n.__makeTemplateObject(["\n      vec4 vvColor() { return vec4(1.0); }\n    "],["\n      vec4 vvColor() { return vec4(1.0); }\n    "]))))}var o,a,s,c,l,u,f;Object.defineProperty(t,"__esModule",{value:!0}),t.VisualVariables=void 0,t.VisualVariables=i,function(e){function t(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}e.bindUniforms=t,e.bindUniformsWithOpacity=function(e,n){t(e,n),n.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",n.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",n.vvOpacityOpacities))},e.bindUniformsForSymbols=function(e,n){t(e,n),n.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",n.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",n.vvSymbolRotationMatrix))}}(i=t.VisualVariables||(t.VisualVariables={}))}).apply(null,r))||(e.exports=i)},"3RHn":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("KBgh"),n("0LE5"),n("Rdxj"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o){"use strict";var a=function(){function e(t,n,a,s){this.primitiveIndices=t,this._numIndexPerPrimitive=n,this.indices=a,this._position=s,this.center=i.vec3f64.create(),o.assert(t.length>=1),o.assert(a.length%this._numIndexPerPrimitive==0),o.assert(a.length>=t.length*this._numIndexPerPrimitive),o.assert(3===this._position.size||4===this._position.size);var c=this._position,l=c.data,u=c.offsetIdx,f=c.strideIdx,d=0,v=t.length,p=u+f*a[this._numIndexPerPrimitive*t[d]];for(e.tmpIndices.clear(),e.tmpIndices.push(p),this.bbMin=i.vec3f64.fromValues(l[p],l[p+1],l[p+2]),this.bbMax=i.vec3f64.clone(this.bbMin);d<v;++d)for(var h=this._numIndexPerPrimitive*t[d],m=0;m<this._numIndexPerPrimitive;++m){e.tmpIndices.push(p=u+f*a[h+m]);var g=l[p];this.bbMin[0]=Math.min(g,this.bbMin[0]),this.bbMax[0]=Math.max(g,this.bbMax[0]),g=l[p+1],this.bbMin[1]=Math.min(g,this.bbMin[1]),this.bbMax[1]=Math.max(g,this.bbMax[1]),g=l[p+2],this.bbMin[2]=Math.min(g,this.bbMin[2]),this.bbMax[2]=Math.max(g,this.bbMax[2])}r.vec3.lerp(this.center,this.bbMin,this.bbMax,.5),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var b=this.bsRadius*this.bsRadius;for(d=0;d<e.tmpIndices.length;++d){var y=l[p=e.tmpIndices.data[d]]-this.center[0],x=l[p+1]-this.center[1],_=l[p+2]-this.center[2],S=y*y+x*x+_*_;if(!(S<=b)){var O=Math.sqrt(S),w=.5*(O-this.bsRadius);this.bsRadius=this.bsRadius+w,b=this.bsRadius*this.bsRadius;var P=w/O;this.center[0]+=y*P,this.center[1]+=x*P,this.center[2]+=_*P}}e.tmpIndices.clear()}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this._children)return this._children;if(r.vec3.squaredDistance(this.bbMin,this.bbMax)>1){for(var t=r.vec3.lerp(i.vec3f64.create(),this.bbMin,this.bbMax,.5),n=this.primitiveIndices.length,o=new Uint8Array(n),a=new Array(8),s=0;s<8;++s)a[s]=0;var c=this._position,l=c.data,u=c.offsetIdx,f=c.strideIdx;for(s=0;s<n;++s){for(var d=0,v=this._numIndexPerPrimitive*this.primitiveIndices[s],p=u+f*this.indices[v],h=l[p],m=l[p+1],g=l[p+2],b=1;b<this._numIndexPerPrimitive;++b){var y=l[p=u+f*this.indices[v+b]],x=l[p+1],_=l[p+2];y<h&&(h=y),x<m&&(m=x),_<g&&(g=_)}h<t[0]&&(d|=1),m<t[1]&&(d|=2),g<t[2]&&(d|=4),o[s]=d,++a[d]}var S=0;for(s=0;s<8;++s)a[s]>0&&++S;if(S<2)return;var O=new Array(8);for(s=0;s<8;++s)O[s]=a[s]>0?new Uint32Array(a[s]):void 0;for(s=0;s<8;++s)a[s]=0;for(s=0;s<n;++s)O[d=o[s]][a[d]++]=this.primitiveIndices[s];for(this._children=new Array(8),s=0;s<8;++s)void 0!==O[s]&&(this._children[s]=new e(O[s],this._numIndexPerPrimitive,this.indices,this._position))}return this._children},e}();return function(e){e.tmpIndices=new n({deallocator:null})}(a||(a={})),a}).apply(null,r))||(e.exports=i)},"3kdR":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=void 0,t.Transform=function(e,t){e.vertex.code.add(r.glsl(t.linearDepth?i||(i=n.__makeTemplateObject(["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye = view * vec4(pos, 1.0);\n      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "],["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye = view * vec4(pos, 1.0);\n      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "])):o||(o=n.__makeTemplateObject(["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "],["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "]))))}}).apply(null,r))||(e.exports=i)},"4p4v":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("PHan"),n("jBNx"),n("W9tT"),n("0LE5"),n("Rdxj"),n("JjCO")],void 0===(i=(function(e,t,n,r,i,o,a,s){"use strict";function c(e){return e?{origin:a.vec3f64.clone(e.origin),direction:a.vec3f64.clone(e.direction)}:{origin:a.vec3f64.create(),direction:a.vec3f64.create()}}function l(e,t,n){return void 0===n&&(n=c()),o.vec3.copy(n.origin,e),o.vec3.copy(n.direction,t),n}function u(e,t,n){void 0===n&&(n=c());var a=r.castRenderScreenPointArray3(i.vec2.copy(s.sv3d.get(),t));a[2]=0,e.unprojectPoint(a,n.origin);var l=r.castRenderScreenPointArray3(i.vec2.copy(s.sv3d.get(),t));l[2]=1;var u=e.unprojectPoint(l,s.sv3d.get());return o.vec3.subtract(n.direction,u,n.origin),n}function f(e,t,n){void 0===n&&(n=c()),o.vec3.copy(n.origin,e.eye);var r=o.vec3.set(s.sv3d.get(),t[0],t[1],1),i=e.unprojectPoint(r,s.sv3d.get());return o.vec3.subtract(n.direction,i,n.origin),n}function d(e,t){var n=o.vec3.cross(s.sv3d.get(),o.vec3.normalize(s.sv3d.get(),e.direction),o.vec3.subtract(s.sv3d.get(),t,e.origin));return o.vec3.dot(n,n)}function v(){return{origin:null,direction:null}}Object.defineProperty(t,"__esModule",{value:!0}),t.createWrapper=t.closestPoint=t.distance=t.distance2=t.fromRenderAtEye=t.fromScreenAtEye=t.fromRender=t.fromScreen=t.fromValues=t.fromPoints=t.copy=t.wrap=t.create=void 0,t.create=c,t.wrap=function(e,t){var n=p.get();return n.origin=e,n.direction=t,n},t.copy=function(e,t){return void 0===t&&(t=c()),l(e.origin,e.direction,t)},t.fromPoints=function(e,t,n){return void 0===n&&(n=c()),o.vec3.copy(n.origin,e),o.vec3.subtract(n.direction,t,e),n},t.fromValues=l,t.fromScreen=function(e,t,n){return void 0===n&&(n=c()),u(e,e.screenToRender(t,r.castRenderScreenPointArray3(s.sv3d.get())),n)},t.fromRender=u,t.fromScreenAtEye=function(e,t,n){return void 0===n&&(n=c()),f(e,e.screenToRender(t,r.castRenderScreenPointArray3(s.sv3d.get())),n)},t.fromRenderAtEye=f,t.distance2=d,t.distance=function(e,t){return Math.sqrt(d(e,t))},t.closestPoint=function(e,t,n){var r=o.vec3.dot(e.direction,o.vec3.subtract(n,t,e.origin));return o.vec3.add(n,e.origin,o.vec3.scale(n,e.direction,r)),n},t.createWrapper=v;var p=new n.ObjectStack(v)}).apply(null,r))||(e.exports=i)},"51bw":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xf8T")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3f64=void 0,t.mat3f64=n}).apply(null,r))||(e.exports=i)},"62Ht":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("W0kZ")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Object3DStateSet=t.generateObject3DStateId=void 0;var r=new n.IdGen;t.generateObject3DStateId=function(e){return{id:r.gen(0===e?"highlight":"occludee"),channel:e}};var i=function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:0,objectStateId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,n){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:n})},e.prototype.addExternal=function(e,t){this.items.push({type:2,objectStateId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var n=this.items[t];n.objectStateId===e&&(this._removeObjectStateItem(n),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var n=this.items[t];0===n.type&&n.object===e&&(this._removeObjectStateItem(n),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var n=this.items[t];1===n.type&&n.renderGeometry===e&&(this._removeObjectStateItem(n),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach((function(t){e._removeObjectStateItem(t)})),this.items=[]},e.prototype._removeObjectStateItem=function(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}},e}();t.Object3DStateSet=i}).apply(null,r))||(e.exports=i)},"6t3m":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.VertexColor=void 0,t.VertexColor=function(e,t){t.attributeColor?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n      void forwardVertexColor() { vColor = color; }\n    "],["\n      void forwardVertexColor() { vColor = color; }\n    "])))),e.vertex.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }\n    "],["\n      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }\n    "]))))):e.vertex.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "],["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "]))))}}).apply(null,r))||(e.exports=i)},"7Aei":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function n(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r="",i=0;i<t.length;i++)r+=e[i]+t[i];return r+e[e.length-1]}Object.defineProperty(t,"__esModule",{value:!0}),t.glsl=void 0,t.glsl=n,function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(n=t.glsl||(t.glsl={}))}).apply(null,r))||(e.exports=i)},"9DjX":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("YX1r"),n("51bw"),n("FXVB"),n("1m5D"),n("EuvN"),n("lLWD"),n("0LE5"),n("vlC2"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("2eYJ"),n("/dtL"),n("ZJC8")],void 0===(i=(function(e,t,n,r,i,o,a,s,c,l,u,f,d,v,p,h,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TERRAIN_ID=t.getVerticalOffsetTerrain=t.getVerticalOffsetI3S=t.getVerticalOffsetObject3D=t.Object3DVerticalOffsetGlobalViewingMode=t.I3SVerticalOffsetGlobalViewingMode=t.TerrainVerticalOffsetGlobalViewingMode=t.IntersectorResult=t.IntersectorResults=t.IntersectorTransform=t.IntersectorOptions=t.sliceFilterPredicate=void 0,t.sliceFilterPredicate=function(e){return function(t,n,r){return l.vec3.lerp(j,t,n,r),!h.extrusionContainsPoint(e,j)}},t.IntersectorOptions=function(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2};var b=function(){function e(){this._transform=a.mat4f64.create(),this._transformInverse=new y({value:this._transform},o.mat4.invert,a.mat4f64.create),this._transformInverseTranspose=new y(this._transformInverse,o.mat4.transpose,a.mat4f64.create),this._transformTranspose=new y({value:this._transform},o.mat4.transpose,a.mat4f64.create),this._transformInverseRotation=new y({value:this._transform},r.mat3.normalFromMat4Legacy,i.mat3f64.create)}return e.prototype.invalidateLazyTransforms=function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()},Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!1,configurable:!0}),e.prototype.setTransformMatrix=function(e){o.mat4.copy(this._transform,e)},e.prototype.multiplyTransform=function(e){o.mat4.multiply(this._transform,this._transform,e)},e.prototype.set=function(e){o.mat4.copy(this._transform,e),this.invalidateLazyTransforms()},e.prototype.setAndInvalidateLazyTransforms=function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()},e}();t.IntersectorTransform=b;var y=function(){function e(e,t,n){this.original=e,this.update=t,this.dirty=!0,this.transform=n()}return e.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform},enumerable:!1,configurable:!0}),e}(),x=function(){function e(){this.min=new _,this.max=new _,this.hud=new _,this.ground=new _}return e.prototype.init=function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]},e}();t.IntersectorResults=x;var _=function(){function e(e){this.normal=f.vec3f64.create(),this.transformation=a.mat4f64.create(),this._ray=p.ray.create(),this.init(e)}return Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return l.vec3.scale(V,this.ray.direction,this.dist),l.vec3.length(V)},enumerable:!1,configurable:!0}),e.prototype.getIntersectionPoint=function(e){return!!this.hasIntersectionPoint&&(l.vec3.scale(V,this.ray.direction,this.dist),l.vec3.add(e,this.ray.origin,V),!0)},e.prototype.getTransformedNormal=function(e){return l.vec3.copy(z,this.normal),z[3]=0,d.vec4.transformMat4(z,z,this.transformation),l.vec3.copy(e,z),l.vec3.normalize(e,e),e},e.prototype.init=function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?p.ray.copy(e,this._ray):this._ray=p.ray.create()},e.prototype.set=function(e,t,n,r,i,a,s,c,u,d){e instanceof g&&(e={type:"stage",obj:e}),this.dist=n,l.vec3.copy(this.normal,r),o.mat4.copy(this.transformation,i),this.target=e,this.name=t,this.drapedLayerOrder=a,this.center=s?f.vec3f64.clone(s):null,this.geometryId=c,this.triangleNr=u,this.drapedLayerGraphicOrder=d},e.prototype.copyFrom=function(e){p.ray.copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?f.vec3f64.clone(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,l.vec3.copy(this.normal,e.normal),o.mat4.copy(this.transformation,e.transformation)},e.prototype.toOwner=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return S(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e,t){var n=e.metadata.layerUid;return null!=n?t.map.findLayerByUid(n):null}(this.target,e);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return S(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null},e.prototype.toGraphic=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return O(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return this.target.metadata.createGraphic();case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return O(this.target.metadata,e)}}return null},e}();function S(e,t){return n.isNone(e)||null==e.layerUid?null:n.isSome(t.graphicsView)&&e.layerUid===t.graphicsView.mockLayerId?t.graphics:t.map.findLayerByUid(e.layerUid)}function O(e,t){if(n.isNone(e))return null;var r=S(e,t);if(n.isNone(r))return null;if(r===t.graphics)return n.isSome(t.graphicsView)?n.unwrap(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;var i=t.allLayerViews.find((function(e){return e.layer===r}));return i?function(e,t){return!e||e.suspended?null:"getGraphicFromIntersectorMetadata"in e&&t?e.getGraphicFromIntersectorMetadata(t):"getGraphicFromGraphicUid"in e&&null!=t.graphicUid?e.getGraphicFromGraphicUid(t.graphicUid):null}(i,e):null}t.IntersectorResult=_;var w=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.tmpVertex=f.vec3f64.create()}return e.prototype.applyToVertex=function(e,t,n){var r=e+this.localOrigin[0],i=t+this.localOrigin[1],o=n+this.localOrigin[2],a=this.offset/Math.sqrt(r*r+i*i+o*o);return this.tmpVertex[0]=e+r*a,this.tmpVertex[1]=t+i*a,this.tmpVertex[2]=n+o*a,this.tmpVertex},e.prototype.applyToAabb=function(e){var t=e[0]+this.localOrigin[0],n=e[1]+this.localOrigin[1],r=e[2]+this.localOrigin[2],i=e[3]+this.localOrigin[0],o=e[4]+this.localOrigin[1],a=e[5]+this.localOrigin[2],s=this.offset/Math.sqrt(t*t+n*n+r*r);e[0]+=t*s,e[1]+=n*s,e[2]+=r*s;var c=this.offset/Math.sqrt(i*i+o*o+a*a);return e[3]+=i*c,e[4]+=o*c,e[5]+=a*c,e},e}();t.TerrainVerticalOffsetGlobalViewingMode=w;var P=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=f.vec3f64.create(),this.mbs=v.vec4f64.create(),this.obb={center:f.vec3f64.create(),halfSize:u.vec3f32.create(),quaternion:null}}return Object.defineProperty(e.prototype,"localOrigin",{set:function(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},enumerable:!1,configurable:!0}),e.prototype.applyToVertex=function(e,t,n){var r=e,i=t,o=n+this.componentLocalOriginLength,a=this.offset/Math.sqrt(r*r+i*i+o*o);return this.tmpVertex[0]=e+r*a,this.tmpVertex[1]=t+i*a,this.tmpVertex[2]=n+o*a,this.tmpVertex},e.prototype.applyToAabb=function(e){var t=e[0],n=e[1],r=e[2]+this.componentLocalOriginLength,i=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,s=this.offset/Math.sqrt(t*t+n*n+r*r);e[0]+=t*s,e[1]+=n*s,e[2]+=r*s;var c=this.offset/Math.sqrt(i*i+o*o+a*a);return e[3]+=i*c,e[4]+=o*c,e[5]+=a*c,e},e.prototype.applyToMbs=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=this.offset/t;return this.mbs[0]=e[0]+e[0]*n,this.mbs[1]=e[1]+e[1]*n,this.mbs[2]=e[2]+e[2]*n,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs},e.prototype.applyToObb=function(e){var t=e.center,n=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*n,this.obb.center[1]=t[1]+t[1]*n,this.obb.center[2]=t[2]+t[2]*n,l.vec3.transformQuat(this.obb.halfSize,e.halfSize,e.quaternion),l.vec3.add(this.obb.halfSize,this.obb.halfSize,e.center);var r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,l.vec3.subtract(this.obb.halfSize,this.obb.halfSize,e.center),s.quat.conjugate(C,e.quaternion),l.vec3.transformQuat(this.obb.halfSize,this.obb.halfSize,C),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb},e}();t.I3SVerticalOffsetGlobalViewingMode=P;var M=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.sphere=m.create(),this.tmpVertex=f.vec3f64.create()}return e.prototype.applyToVertex=function(e,t,n){var r=this.objectTransform.transform,i=r[0]*e+r[4]*t+r[8]*n+r[12],o=r[1]*e+r[5]*t+r[9]*n+r[13],a=r[2]*e+r[6]*t+r[10]*n+r[14],s=this.offset/Math.sqrt(i*i+o*o+a*a),c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*(i+=i*s)+c[4]*(o+=o*s)+c[8]*(a+=a*s)+c[12],this.tmpVertex[1]=c[1]*i+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*i+c[6]*o+c[10]*a+c[14],this.tmpVertex},e.prototype.applyToMinMax=function(e,t){var n=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*n,e[1]+=e[1]*n,e[2]+=e[2]*n;var r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r},e.prototype.applyToAabb=function(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var n=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*n,e[4]+=e[4]*n,e[5]+=e[5]*n,e},e.prototype.applyToBoundingSphere=function(e,t){var n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/n;return this.sphere.center[0]=t[0]+t[0]*r,this.sphere.center[1]=t[1]+t[1]*r,this.sphere.center[2]=t[2]+t[2]*r,this.sphere.radius=e+e*this.offset/n,this.sphere},e}();t.Object3DVerticalOffsetGlobalViewingMode=M;var T=new M;t.getVerticalOffsetObject3D=function(e){return n.isSome(e)?(T.offset=e,T):null};var A=new P;t.getVerticalOffsetI3S=function(e){return n.isSome(e)?(A.offset=e,A):null};var I=new w;t.getVerticalOffsetTerrain=function(e){return n.isSome(e)?(I.offset=e,I):null},t.TERRAIN_ID="terrain";var j=f.vec3f64.create(),V=f.vec3f64.create(),z=v.vec4f64.create(),C=c.quatf64.create()}).apply(null,r))||(e.exports=i)},"9FJH":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("EiD/"),n("tUyH")],void 0===(i=(function(e,t,n,r,i,o){"use strict";return function(e){function t(t){var n=e.call(this,t)||this;return n._textureIDs=new Set,n._textureRepository=t.textureRep,n._textureId=t.textureId,n._initTransparent=!!t.initTextureTransparent,n._texture=n._acquireIfNotUndefined(n._textureId),n._textureNormal=n._acquireIfNotUndefined(t.normalTextureId),n._textureEmissive=n._acquireIfNotUndefined(t.emissiveTextureId),n._textureOcclusion=n._acquireIfNotUndefined(t.occlusionTextureId),n._textureMetallicRoughness=n._acquireIfNotUndefined(t.metallicRoughnessTextureId),n}return n.__extends(t,e),t.prototype.dispose=function(){var e=this;this._textureIDs.forEach((function(t){return e._textureRepository.release(t)})),this._textureIDs.clear()},t.prototype.updateTexture=function(e){e!==this._textureId&&(this._releaseIfNotUndefined(this._textureId),this._textureId=e,this._texture=this._acquireIfNotUndefined(this._textureId))},t.prototype.bindTexture=function(e,t){r.isSome(this._texture)&&(t.setUniform1i("tex",i.DefaultTextureUnits.DIFFUSE),e.bindTexture(this._texture.glTexture,i.DefaultTextureUnits.DIFFUSE)),r.isSome(this._textureNormal)&&(t.setUniform1i("normalTexture",i.DefaultTextureUnits.NORMAL),e.bindTexture(this._textureNormal.glTexture,i.DefaultTextureUnits.NORMAL)),r.isSome(this._textureEmissive)&&(t.setUniform1i("texEmission",i.DefaultTextureUnits.EMISSION),e.bindTexture(this._textureEmissive.glTexture,i.DefaultTextureUnits.EMISSION)),r.isSome(this._textureOcclusion)&&(t.setUniform1i("texOcclusion",i.DefaultTextureUnits.OCCLUSION),e.bindTexture(this._textureOcclusion.glTexture,i.DefaultTextureUnits.OCCLUSION)),r.isSome(this._textureMetallicRoughness)&&(t.setUniform1i("texMetallicRoughness",i.DefaultTextureUnits.METALLIC_ROUGHNESS),e.bindTexture(this._textureMetallicRoughness.glTexture,i.DefaultTextureUnits.METALLIC_ROUGHNESS))},t.prototype.bindTextureScale=function(e,t){var n=r.isSome(this._texture)&&this._texture.glTexture;n&&n.descriptor.textureCoordinateScaleFactor?t.setUniform2fv("textureCoordinateScaleFactor",n.descriptor.textureCoordinateScaleFactor):t.setUniform2f("textureCoordinateScaleFactor",1,1)},t.prototype._acquireIfNotUndefined=function(e){if(!r.isNone(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)},t.prototype._releaseIfNotUndefined=function(e){void 0!==e&&(this._textureIDs.delete(e),this._textureRepository.release(e))},t}(o.GLMaterial)}).apply(null,r))||(e.exports=i)},AgDx:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("+nCE"),n("CIy2")],void 0===(i=(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryData=void 0;var i=function(){function e(t,n,r){void 0===n&&(n=e.DefaultIndices),void 0===r&&(r="triangle"),this.initialize(t,n,r)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){var e=r.getFirstObjectValue(this._indices);return null==e?0:e.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!1,configurable:!0}),e.prototype.getVertexAttr=function(){return this.vertexAttributes},e.prototype.initialize=function(t,i,o){void 0===i&&(i=e.DefaultIndices),void 0===o&&(o="triangle");var a={};for(var s in t){var c=t[s],l=c.size;a[s]={data:c.data,size:l,offsetIdx:0,strideIdx:l}}if(i===e.DefaultIndices){var u=function(e){var t=r.getFirstObjectValue(e);return null==t?0:t.data.length/t.size}(a),f=n.generateDefaultIndexArray(u);for(var d in i={},a)i[d]=f}this._id=n.getNewId(),this._vertexAttributes=a,this._indices=i,this._primitiveType=o},e.prototype.toRenderData=function(){return{id:this._id.toString(),indices:this._indices,vertexAttr:this._vertexAttributes}},e.prototype.getIndices=function(e){return this._indices[e]},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){var e=0;if(this._indices[r.VertexAttrConstants.POSITION]){var t=3;e+=this._indices[r.VertexAttrConstants.POSITION].length*t*4}return this._indices[r.VertexAttrConstants.NORMAL]&&(e+=this._indices[r.VertexAttrConstants.NORMAL].length*(t=3)*4),this._indices[r.VertexAttrConstants.UV0]&&(e+=this._indices[r.VertexAttrConstants.UV0].length*(t=2)*4),this._indices[r.VertexAttrConstants.COLOR]&&(e+=this._indices[r.VertexAttrConstants.COLOR].length*(t=1)*4),e},e.DefaultIndices={},e}();t.GeometryData=i}).apply(null,r))||(e.exports=i)},CIy2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("FXVB"),n("W9tT"),n("DIqE"),n("Rdxj"),n("2fXB"),n("O7NG")],void 0===(i=(function(e,t,n,r,i,o,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inverseProjectionInfo=t.unpackFloatRGBA=t.packFloatRGBA=t.fovd2fovy=t.fovd2fovx=t.fovy2fovd=t.fovx2fovd=t.fovy2fovx=t.fovx2fovy=t.isTranslationMatrix=t.createTranslationMatrix=t.getMatrixTranslation=t.setMatrixTranslation3=t.setMatrixTranslation=t.logWithBase=t.objectEmpty=t.getFirstObjectValue=t.getFirstObjectKey=t.project=t.rayRay2D=t.rayBoxTest=t.rayTriangle3D=t.dec2hex=t.rgb2hex=t.hex2rgb=t.fallbackIfUndefined=t.encodeNormal=t.encodeInt16=t.verify=t.assert=t.VertexAttrConstants=t.AssertException=void 0;var l=c.vec4f64.create(),u=function(){function e(e){this.message=e}return e.prototype.toString=function(){return"AssertException: "+this.message},e}();function f(e,t){if(!e){t=t||"assert";var n=new Error(t);throw n.stack&&console.log(n.stack),new u(t)}}function d(e){for(var t in e)return t}function v(e,t){e[12]=t[0],e[13]=t[1],e[14]=t[2]}function p(e,t){void 0===t&&(t=0);for(var n=0,r=0;r<4;r++)n+=e[t+r]*m[r];return n}t.AssertException=u,t.VertexAttrConstants={POSITION:"position",NORMAL:"normal",UV0:"uv0",UVMAPSPACE:"uvMapSpace",MEANVERTEXPOSITION:"meanVertexPosition",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",BOUND1:"bound1",BOUND2:"bound2",BOUND3:"bound3",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",TANGENT:"tangent"},t.assert=f,t.verify=function(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))},t.encodeInt16=function(e){return n.clamp(Math.round(32767*e),-32767,32767)},t.encodeNormal=function(e,t){var n=Math.abs(e[0]),r=Math.abs(e[1]),i=1/(n+r+Math.abs(e[2])),o=n*i,a=r*i,s=Math.min(e[2]*i,0);t[0]=(e[0]<0?-1:1)*(o-s),t[1]=(e[1]<0?-1:1)*(a-s)},t.fallbackIfUndefined=function(e,t){return void 0===e?t:e},t.hex2rgb=function(e){return[((e=Math.floor(e))>>16&255)/255,(e>>8&255)/255,(255&e)/255]},t.rgb2hex=function(e){return"0x"+((n.clamp(Math.round(255*e[0]),0,255)<<16)+(n.clamp(Math.round(255*e[1]),0,255)<<8)+n.clamp(Math.round(255*e[2]),0,255)).toString(16)},t.dec2hex=function(e){var t=e.toString(16);return"00000000".substr(0,8-t.length)+t},t.rayTriangle3D=function(e,t,n,r,i,o,s,c,l){void 0===l&&(l=a.vec3f64.create());var u=r[s]-n[o],f=r[s+1]-n[o+1],d=r[s+2]-n[o+2],v=i[c]-n[o],p=i[c+1]-n[o+1],h=i[c+2]-n[o+2],m=t[1]*h-p*t[2],g=t[2]*v-h*t[0],b=t[0]*p-v*t[1],y=u*m+f*g+d*b;if(y>-1e-5&&y<1e-5)return!1;var x=1/y,_=e[0]-n[o],S=e[1]-n[o+1],O=e[2]-n[o+2];if(l[1]=x*(_*m+S*g+O*b),l[1]<0||l[1]>1)return!1;var w=S*d-f*O,P=O*u-d*_,M=_*f-u*S;return l[2]=x*(t[0]*w+t[1]*P+t[2]*M),!(l[2]<0||l[1]+l[2]>1||(l[0]=x*(v*w+p*P+h*M),0))},t.rayBoxTest=function(e,t,n,r){var i,o=(n[0]-e[0])/t[0],a=(r[0]-e[0])/t[0];o>a&&(i=o,o=a,a=i);var s=(n[1]-e[1])/t[1],c=(r[1]-e[1])/t[1];if(s>c&&(i=s,s=c,c=i),o>c||s>a)return!1;s>o&&(o=s),c<a&&(a=c);var l=(n[2]-e[2])/t[2],u=(r[2]-e[2])/t[2];return l>u&&(i=l,l=u,u=i),!(o>u||l>a||(u<a&&(a=u),a<0))},t.rayRay2D=function(e,t,n,r,i,a){void 0===a&&(a=o.vec2f64.create());var s=(r[i]-n[i])*(t[0]-e[0])-(r[0]-n[0])*(t[i]-e[i]);if(0===s)return!1;var c=((r[0]-n[0])*(e[i]-n[i])-(r[i]-n[i])*(e[0]-n[0]))/s;return a[0]=e[0]+c*(t[0]-e[0]),a[1]=e[i]+c*(t[i]-e[i]),!0},t.project=function(e,t,n,r,i){i||(i=e),l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=1,s.vec4.transformMat4(l,l,t),i.length>2&&(i[2]=-l[2]),s.vec4.transformMat4(l,l,n),f(0!==l[3]),i[0]=l[0]/l[3],i[1]=l[1]/l[3],i[2]=l[2]/l[3],i[0]=(.5*i[0]+.5)*r[2]+r[0],i[1]=(.5*i[1]+.5)*r[3]+r[1]},t.getFirstObjectKey=d,t.getFirstObjectValue=function(e){return e[d(e)]},t.objectEmpty=function(e){for(var t in e)return!1;return!0},t.logWithBase=function(e,t){return Math.log(e)/Math.log(t)},t.setMatrixTranslation=v,t.setMatrixTranslation3=function(e,t,n,r){e[12]=t,e[13]=n,e[14]=r},t.getMatrixTranslation=function(e,t){return void 0===t&&(t=a.vec3f64.create()),t[0]=e[12],t[1]=e[13],t[2]=e[14],t},t.createTranslationMatrix=function(e,t){return v(e=r.mat4.identity(e),t),e},t.isTranslationMatrix=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]},t.fovx2fovy=function(e,t,n){return 2*Math.atan(n*Math.tan(.5*e)/t)},t.fovy2fovx=function(e,t,n){return 2*Math.atan(t*Math.tan(.5*e)/n)},t.fovx2fovd=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/t)},t.fovy2fovd=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/n)},t.fovd2fovx=function(e,t,n){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+n*n))},t.fovd2fovy=function(e,t,n){return 2*Math.atan(n*Math.tan(.5*e)/Math.sqrt(t*t+n*n))},t.packFloatRGBA=function(e,t,r){void 0===r&&(r=0);for(var i,o=n.clamp(e,0,g),a=0;a<4;a++)t[r+a]=Math.floor(256*((i=o*h[a])-Math.floor(i)))},t.unpackFloatRGBA=p;var h=[1,256,65536,16777216],m=[1/256,1/65536,1/16777216,1/4294967296],g=p(new Uint8ClampedArray([255,255,255,255]));t.inverseProjectionInfo=function(e,t,n,r,o){var a=e;0===e[11]?(r[0]=2/(t*a[0]),r[1]=2/(n*a[5]),r[2]=(1+a[12])/a[0],r[3]=(1+a[13])/a[5],i.vec2.set(o,0,1)):(r[0]=-2/(t*a[0]),r[1]=-2/(n*a[5]),r[2]=(1-a[8])/a[0],r[3]=(1-a[9])/a[5],i.vec2.set(o,1,0))}}).apply(null,r))||(e.exports=i)},CIzB:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IDENTITY=t.createView=t.fromValues=t.clone=t.create=void 0,t.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},t.fromValues=function(e,t,n,r,i,o,a,s,c,l,u,f,d,v,p,h){return[e,t,n,r,i,o,a,s,c,l,u,f,d,v,p,h]},t.createView=function(e,t){return new Float64Array(e,t,16)},t.IDENTITY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}).apply(null,r))||(e.exports=i)},"Cvn+":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("SyoC"),n("0LE5"),n("W0kZ")],void 0===(i=(function(e,t,n,r,i){"use strict";return function(){function e(){}return e.prototype.acquire=function(t,n,r,i,o,a){this.id=e._idGen.gen(t&&t.id),this.geometry=t,this.material=n,this.transformation=r,this.instanceParameters=i,this.origin=o,this.shaderTransformation=a},e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation},e.prototype.computeAttachmentOrigin=function(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(r.vec3.transformMat4(e,e,this.getStaticTransformation()),!0)},e._idGen=new i.IdGen,e.pool=new n(e),e}()}).apply(null,r))||(e.exports=i)},DKwL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.RgbaFloatEncoding=void 0,t.RgbaFloatEncoding=function(e){e.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT =\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat = 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS = vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0->1 back to 0->255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "],["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT =\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat = 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS = vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0->1 back to 0->255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},"EiD/":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultTextureUnits=void 0,t.DefaultTextureUnits={DIFFUSE:0,NORMAL:1,EMISSION:2,OCCLUSION:3,METALLIC_ROUGHNESS:4,SSAO:6,SHADOW_MAP:7}}).apply(null,r))||(e.exports=i)},EyQ4:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("qsST"),n("xoE+"),n("Zp3t")],void 0===(i=(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDDSTextureData=t.createDDSTexture=void 0;var o=n.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function a(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var s=a("DXT1"),c=a("DXT3"),l=a("DXT5");function u(e,t){var n=new Int32Array(e,0,31);if(542327876!==n[0])return o.error("Invalid magic number in DDS header"),null;if(!(4&n[20]))return o.error("Unsupported format, must contain a FourCC code"),null;var i,a,u,f=n[21];switch(f){case s:i=8,a=33776;break;case c:i=16,a=33778;break;case l:i=16,a=33779;break;default:return o.error("Unsupported FourCC code:",(u=f,String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255))),null}var d=1,v=n[4],p=n[3];0==(3&v)&&0==(3&p)||(o.warn("Rounding up compressed texture size to nearest multiple of 4."),v=v+3&-4,p=p+3&-4);var h,m,g=v,b=p;131072&n[2]&&!1!==t&&(d=Math.max(1,n[7])),1===d||r.isPowerOfTwo(v)&&r.isPowerOfTwo(p)||(o.warn("Ignoring mipmaps of non power of two sized compressed texture."),d=1);for(var y=n[1]+4,x=[],_=0;_<d;++_)m=(v+3>>2)*(p+3>>2)*i,h=new Uint8Array(e,y,m),x.push(h),y+=m,v=Math.max(1,v>>1),p=Math.max(1,p>>1);return{textureData:{type:"compressed",levels:x},internalFormat:a,width:g,height:b}}t.createDDSTexture=function(e,t,n,r){var o=u(n,r),a=o.textureData,s=o.internalFormat,c=o.width,l=o.height;t.samplingMode=a.levels.length>1?9987:9729,t.hasMipmap=a.levels.length>1,t.internalFormat=s,t.width=c,t.height=l;var f=new i(e,t,a);return e.bindTexture(f),f},t.createDDSTextureData=u}).apply(null,r))||(e.exports=i)},FNtW:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("ff/U"),n("W0kZ")],void 0===(i=(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.materialPredicate=t.Material=void 0;var o=function(){function e(t){this.supportsEdges=!1,this._visible=!0,this._renderOccluded=1,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=r.Default3D,this.id=e._idGen.gen(t)}return e.prototype.dispose=function(){},e.prototype.update=function(e){return!1},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.parametersChanged())},enumerable:!1,configurable:!0}),e.prototype.isVisibleInPass=function(e){return!0},Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.parametersChanged())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"insertOrder",{get:function(){return this._insertOrder},set:function(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributeLocations",{get:function(){return this._vertexAttributeLocations},enumerable:!1,configurable:!0}),e.prototype.isVisible=function(){return this._visible},e.prototype.parametersChanged=function(){n.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)},e._idGen=new i.IdGen,e}();t.Material=o,t.materialPredicate=function(e,t){return e.isVisible()&&e.isVisibleInPass(t.pass)&&0!=(e.renderOccluded&t.renderOccludedMask)}}).apply(null,r))||(e.exports=i)},FQ4r:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderTechnique=void 0;var n=function(){function e(e,t){t&&(this._config=t.snapshot()),this._program=this.initializeProgram(e),e.commonUniformStore&&(this._commonUniformStore=e.commonUniformStore,this._commonUniformStore.subscribeProgram(this._program)),this._pipeline=this.initializePipeline(e)}return e.prototype.dispose=function(){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose(),this._program=null)},e.prototype.reload=function(e){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose()),this._program=this.initializeProgram(e),this._commonUniformStore&&this._commonUniformStore.subscribeProgram(this._program)},Object.defineProperty(e.prototype,"program",{get:function(){return this._program},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pipeline",{get:function(){return this._pipeline},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._config.key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"configuration",{get:function(){return this._config},enumerable:!1,configurable:!0}),e.prototype.bindPass=function(e,t,n){},e.prototype.bindMaterial=function(e,t,n){},e.prototype.bindDraw=function(e,t,n){},e.prototype.bindPipelineState=function(e){e.setPipelineState(this.pipeline)},e.prototype.ensureAttributeLocations=function(e){this.program.assertCompatibleVertexAttributeLocations(e)},Object.defineProperty(e.prototype,"primitiveType",{get:function(){return 4},enumerable:!1,configurable:!0}),e}();t.ShaderTechnique=n}).apply(null,r))||(e.exports=i)},GG08:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("0LE5"),n("Rdxj"),n("JjCO")],void 0===(i=(function(e,t,n,r,i,o){"use strict";function a(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function s(e,t){return void 0===t&&(t=a()),c(e[0],e[1],e[2],e[3],t)}function c(e,t,n,r,i){return void 0===i&&(i=a()),i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function l(e,t,n){void 0===n&&(n=a()),r.vec3.copy(n,t);var i=r.vec3.dot(t,t);return Math.abs(i-1)>1e-5&&i>1e-12&&r.vec3.scale(n,n,1/Math.sqrt(i)),b(n,e,n),n}function u(e,t,n,i){return void 0===i&&(i=a()),y(r.vec3.subtract(o.sv3d.get(),e,t),r.vec3.subtract(o.sv3d.get(),n,t),e,i)}function f(e,t,n,i,o){if(e.count<3)return!1;e.getVec(n,v);for(var a=i,s=!1;a<e.count-1&&!s;)e.getVec(a,p),a++,s=!r.vec3.exactEquals(v,p);if(!s)return!1;for(a=Math.max(a,o),s=!1;a<e.count&&!s;)e.getVec(a,h),a++,r.vec3.subtract(m,v,p),r.vec3.normalize(m,m),r.vec3.subtract(g,p,h),r.vec3.normalize(g,g),s=!r.vec3.exactEquals(v,h)&&!r.vec3.exactEquals(p,h)&&Math.abs(r.vec3.dot(m,g))<d;return s?(u(v,p,h,t),!0):(0!==n||1!==i||2!==o)&&f(e,t,0,1,2)}Object.defineProperty(t,"__esModule",{value:!0}),t.UP=t.normal=t.signedDistance=t.distance=t.projectVector=t.projectPoint=t.clipInfinite=t.clip=t.isAABBFullyInside=t.isPointOutside=t.isPointInside=t.isSphereFullyOutside=t.isSphereFullyInside=t.intersectLineSegmentClamp=t.intersectLineSegment=t.intersectRay=t.fromVectorsAndPoint=t.negate=t.setOffsetFromPoint=t.fromManyPointsSampleAt=t.fromManyPoints=t.fromPoints=t.fromPositionAndNormal=t.fromNormalAndOffset=t.fromValues=t.copy=t.wrap=t.create=void 0,t.create=a,t.wrap=function(e,t,n,r){return c(e,t,n,r,o.sv4d.get())},t.copy=s,t.fromValues=c,t.fromNormalAndOffset=function(e,t,n){return void 0===n&&(n=a()),r.vec3.copy(n,e),n[3]=t,n},t.fromPositionAndNormal=l,t.fromPoints=u,t.fromManyPoints=function(e,t){return f(e,t,0,1,2)},t.fromManyPointsSampleAt=f;var d=.99619469809,v=i.vec3f64.create(),p=i.vec3f64.create(),h=i.vec3f64.create(),m=i.vec3f64.create(),g=i.vec3f64.create();function b(e,t,n){return e!==n&&s(e,n),n[3]=-r.vec3.dot(n,t),n}function y(e,t,n,i){return void 0===i&&(i=a()),l(n,r.vec3.cross(o.sv3d.get(),t,e),i)}function x(e,t,n){var i=r.vec3.scale(o.sv3d.get(),e,r.vec3.dot(e,t));return r.vec3.subtract(n,t,i),n}function _(e,t){return r.vec3.dot(e,t)+e[3]}function S(e,t,i,o,a,s){var c=r.vec3.dot(e,i);if(0===c)return!1;var l=-(r.vec3.dot(e,t)+e[3])/c;return a&&(l=o?Math.max(0,l):n.clamp(l,0,1)),!(l<0||!o&&l>1||(r.vec3.add(s,t,r.vec3.scale(s,i,l)),0))}t.setOffsetFromPoint=b,t.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},t.fromVectorsAndPoint=y,t.intersectRay=function(e,t,n){return S(e,t.origin,t.direction,!0,!1,n)},t.intersectLineSegment=function(e,t,n){return S(e,t.origin,t.vector,!1,!1,n)},t.intersectLineSegmentClamp=function(e,t,n){return S(e,t.origin,t.vector,!1,!0,n)},t.isSphereFullyInside=function(e,t){var n=t.radius;return _(e,t.center)-n>=0},t.isSphereFullyOutside=function(e,t){var n=t.radius;return _(e,t.center)+n<0},t.isPointInside=function(e,t){return _(e,t)>=0},t.isPointOutside=function(e,t){return _(e,t)<0},t.isAABBFullyInside=function(e,t){return e[0]*(e[0]>0?t[0]:t[3])+e[1]*(e[1]>0?t[1]:t[4])+e[2]*(e[2]>0?t[2]:t[5])+e[3]>=0},t.clip=function(e,t){var n=r.vec3.dot(e,t.ray.direction),i=-_(e,t.ray.origin);if(i<0&&n>=0)return!1;if(n>-1e-6&&n<1e-6)return i>0;if((i<0||n<0)&&!(i<0&&n<0))return!0;var o=i/n;return n>0?o<t.c1&&(t.c1=o):o>t.c0&&(t.c0=o),t.c0<=t.c1},t.clipInfinite=function(e,t){var n=r.vec3.dot(e,t.ray.direction),i=-_(e,t.ray.origin);if(n>-1e-6&&n<1e-6)return i>0;var o=i/n;return n>0?o<t.c1&&(t.c1=o):o>t.c0&&(t.c0=o),t.c0<=t.c1},t.projectPoint=function(e,t,n){var i=r.vec3.scale(o.sv3d.get(),e,-e[3]),a=x(e,r.vec3.subtract(o.sv3d.get(),t,i),o.sv3d.get());return r.vec3.add(n,a,i),n},t.projectVector=x,t.distance=function(e,t){return Math.abs(_(e,t))},t.signedDistance=_,t.normal=function(e){return e},t.UP=[0,0,1,0]}).apply(null,r))||(e.exports=i)},GyfB:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("0LE5"),n("JjCO"),n("18xY")],void 0===(i=(function(e,t,n,r,i){"use strict";function o(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function a(e,t,n,r,i){return void 0===i&&(i=o()),i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}Object.defineProperty(t,"__esModule",{value:!0}),t.UP=t.axis=t.fromPoints=t.fromAxisAndAngle=t.fromValues=t.copy=t.wrapAxisAngle=t.wrap=t.create=void 0,t.create=o,t.wrap=function(e,t,n,i){return a(e,t,n,i,r.sv4d.get())},t.wrapAxisAngle=function(e,t){return a(e[0],e[1],e[2],t,r.sv4d.get())},t.copy=function(e,t){return void 0===t&&(t=o()),a(e[0],e[1],e[2],e[3],t)},t.fromValues=a,t.fromAxisAndAngle=function(e,t,r){return void 0===r&&(r=o()),n.vec3.copy(r,e),r[3]=t,r},t.fromPoints=function(e,t,r){return void 0===r&&(r=o()),n.vec3.cross(r,e,t),n.vec3.normalize(r,r),r[3]=i.angle(e,t),r},t.axis=function(e){return e},t.UP=[0,0,1,0]}).apply(null,r))||(e.exports=i)},ILj8:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("VfPl"),n("CIy2")],void 0===(i=(function(e,t,n,r){"use strict";function i(e,t,n,r,i){var o=n.typedBuffer,a=n.typedBufferStride,s=e.length;if(r*=a,null==i||1===i)for(var c=0;c<s;++c){var l=2*e[c];o[r]=t[l],o[r+1]=t[l+1],r+=a}else for(c=0;c<s;++c){l=2*e[c];for(var u=0;u<i;++u)o[r]=t[l],o[r+1]=t[l+1],r+=a}}function o(e,t,n,r,i){var o=n.typedBuffer,a=n.typedBufferStride,s=e.length;if(r*=a,null==i||1===i)for(var c=0;c<s;++c){var l=3*e[c];o[r]=t[l],o[r+1]=t[l+1],o[r+2]=t[l+2],r+=a}else for(c=0;c<s;++c){l=3*e[c];for(var u=0;u<i;++u)o[r]=t[l],o[r+1]=t[l+1],o[r+2]=t[l+2],r+=a}}function a(e,t,n,r,i){var o=n.typedBuffer,a=n.typedBufferStride,s=e.length;if(r*=a,null==i||1===i)for(var c=0;c<s;++c){var l=4*e[c];o[r]=t[l],o[r+1]=t[l+1],o[r+2]=t[l+2],o[r+3]=t[l+3],r+=a}else for(c=0;c<s;++c){l=4*e[c];for(var u=0;u<i;++u)o[r]=t[l],o[r+1]=t[l+1],o[r+2]=t[l+2],o[r+3]=t[l+3],r+=a}}function s(e,t,n,r,i,a){if(n){var s=n,c=r.typedBuffer,l=r.typedBufferStride,u=e.length;if(i*=l,null==a||1===a)for(var f=0;f<u;++f){var d=t[h=3*e[f]],v=t[h+1],p=t[h+2];c[i]=s[0]*d+s[4]*v+s[8]*p+s[12],c[i+1]=s[1]*d+s[5]*v+s[9]*p+s[13],c[i+2]=s[2]*d+s[6]*v+s[10]*p+s[14],i+=l}else for(f=0;f<u;++f){d=t[h=3*e[f]];for(var h,m=s[0]*d+s[4]*(v=t[h+1])+s[8]*(p=t[h+2])+s[12],g=s[1]*d+s[5]*v+s[9]*p+s[13],b=s[2]*d+s[6]*v+s[10]*p+s[14],y=0;y<a;++y)c[i]=m,c[i+1]=g,c[i+2]=b,i+=l}}else o(e,t,r,i,a)}function c(e,t,n,r,i,a){if(n){var s=r.typedBuffer,c=r.typedBufferStride,l=e.length,u=n[0],f=n[1],d=n[2],v=n[4],p=n[5],h=n[6],m=n[8],g=n[9],b=n[10],y=Math.abs(1-u*u+v*v+m*m)>1e-5||Math.abs(1-f*f+p*p+g*g)>1e-5||Math.abs(1-d*d+h*h+b*b)>1e-5;if(i*=c,null==a||1===a)for(var x=0;x<l;++x){var _=u*(P=t[w=3*e[x]])+v*(M=t[w+1])+m*(T=t[w+2]),S=f*P+p*M+g*T,O=d*P+h*M+b*T;y&&(A=_*_+S*S+O*O)<.999999&&A>1e-6&&(_/=I=Math.sqrt(A),S/=I,O/=I),s[i+0]=_,s[i+1]=S,s[i+2]=O,i+=c}else for(x=0;x<l;++x){var w,P,M,T,A,I,j=u*(P=t[w=3*e[x]])+v*(M=t[w+1])+m*(T=t[w+2]),V=f*P+p*M+g*T,z=d*P+h*M+b*T;y&&(A=j*j+V*V+z*z)<.999999&&A>1e-6&&(j/=I=Math.sqrt(A),V/=I,z/=I);for(var C=0;C<a;++C)s[i+0]=j,s[i+1]=V,s[i+2]=z,i+=c}}else o(e,t,r,i,a)}function l(e,t,n,r,i,o){var a=r.typedBuffer,s=r.typedBufferStride,c=e.length;if(i*=s,null==o||1===o){if(4===n)for(var l=0;l<c;++l){var u=4*e[l];a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=t[u+3],i+=s}else if(3===n)for(l=0;l<c;++l)a[i]=t[u=3*e[l]],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=255,i+=s}else if(4===n)for(l=0;l<c;++l){u=4*e[l];for(var f=0;f<o;++f)a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=t[u+3],i+=s}else if(3===n)for(l=0;l<c;++l)for(u=3*e[l],f=0;f<o;++f)a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=255,i+=s}Object.defineProperty(t,"__esModule",{value:!0}),t.writeDefaultAttributes=t.writeMultipliedColor=t.writeColor=t.writeNormal=t.writePosition=t.writeBufferMat4f=t.writeBufferMat3f=t.writeBufferVec4=t.writeBufferVec3=t.writeBufferVec2=void 0,t.writeBufferVec2=i,t.writeBufferVec3=o,t.writeBufferVec4=a,t.writeBufferMat3f=function(e,t,n,r){var i=n.typedBuffer,o=n.typedBufferStride,a=e.length;r*=o;for(var s=0;s<a;++s){for(var c=9*e[s],l=0;l<9;++l)i[r+l]=t[c+l];r+=o}},t.writeBufferMat4f=function(e,t,n,r){var i=n.typedBuffer,o=n.typedBufferStride,a=e.length;r*=o;for(var s=0;s<a;++s){for(var c=16*e[s],l=0;l<16;++l)i[r+l]=t[c+l];r+=o}},t.writePosition=s,t.writeNormal=c,t.writeColor=l,t.writeMultipliedColor=function(e,t,n,r,i,o,a){var s=i.typedBuffer,c=i.typedBufferStride,l=e.length;if(o*=c,null==a||1===a){if(4===n)for(var u=0;u<l;++u){var f=4*e[u];s[o]=t[f]*r[0],s[o+1]=t[f+1]*r[1],s[o+2]=t[f+2]*r[2],s[o+3]=t[f+3]*r[3],o+=c}else if(3===n){var d=255*r[3];for(u=0;u<l;++u)s[o]=t[f=3*e[u]]*r[0],s[o+1]=t[f+1]*r[1],s[o+2]=t[f+2]*r[2],s[o+3]=d,o+=c}}else if(4===n)for(u=0;u<l;++u){f=4*e[u];for(var v=0;v<a;++v)s[o]=t[f]*r[0],s[o+1]=t[f+1]*r[1],s[o+2]=t[f+2]*r[2],s[o+3]=t[f+3]*r[3],o+=c}else if(3===n)for(d=255*r[3],u=0;u<l;++u)for(f=3*e[u],v=0;v<a;++v)s[o]=t[f]*r[0],s[o+1]=t[f+1]*r[1],s[o+2]=t[f+2]*r[2],s[o+3]=d,o+=c},t.writeDefaultAttributes=function(e,t,o,u,f,d){for(var v=0,p=t.fieldNames;v<p.length;v++){var h=p[v],m=e.vertexAttr[h],g=e.indices[h];if(m&&g)switch(h){case r.VertexAttrConstants.POSITION:r.assert(3===m.size);var b=f.getField(h,n.BufferViewVec3f);b&&s(g,m.data,o,b,d);break;case r.VertexAttrConstants.NORMAL:r.assert(3===m.size);var y=f.getField(h,n.BufferViewVec3f);y&&c(g,m.data,u,y,d);break;case r.VertexAttrConstants.UV0:r.assert(2===m.size);var x=f.getField(h,n.BufferViewVec2f);x&&i(g,m.data,x,d);break;case r.VertexAttrConstants.UVMAPSPACE:r.assert(4===m.size);var _=f.getField(h,n.BufferViewVec4f);_&&a(g,m.data,_,d);break;case r.VertexAttrConstants.MEANVERTEXPOSITION:r.assert(3===m.size);var S=f.getField(h,n.BufferViewVec3f);S&&s(g,m.data,o,S,d);break;case r.VertexAttrConstants.BOUND1:case r.VertexAttrConstants.BOUND2:case r.VertexAttrConstants.BOUND3:r.assert(3===m.size);var O=f.getField(h,n.BufferViewVec3f);O&&s(g,m.data,o,O,d);break;case r.VertexAttrConstants.COLOR:r.assert(3===m.size||4===m.size);var w=f.getField(h,n.BufferViewVec4u8);w&&l(g,m.data,m.size,w,d);break;case r.VertexAttrConstants.SYMBOLCOLOR:r.assert(3===m.size||4===m.size);var P=f.getField(h,n.BufferViewVec4u8);P&&l(g,m.data,m.size,P,d);break;case r.VertexAttrConstants.TANGENT:r.assert(4===m.size);var M=f.getField(h,n.BufferViewVec4f);M&&a(g,m.data,M,d)}}}}).apply(null,r))||(e.exports=i)},IwVr:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.DiscardOrAdjustAlpha=t.symbolAlphaCutoff=t.defaultMaskAlphaCutoff=void 0,t.defaultMaskAlphaCutoff=.1,t.symbolAlphaCutoff=.001,t.DiscardOrAdjustAlpha=function(e,t){var c=e.fragment;switch(t.alphaDiscardMode){case 0:c.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "]))));break;case 1:c.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a = 1.0;\n        }\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a = 1.0;\n        }\n      "]))));break;case 2:c.uniforms.add("textureAlphaCutoff","float"),c.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }\n      "]))));break;case 3:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(r.glsl(s||(s=n.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }\n      "]))))}}}).apply(null,r))||(e.exports=i)},JjCO:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("wSO/")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sq4d=t.sm4d=t.sm3d=t.sv4d=t.sv3d=t.sv2d=void 0,t.sv2d=n.VectorStack.createVec2f64(),t.sv3d=n.VectorStack.createVec3f64(),t.sv4d=n.VectorStack.createVec4f64(),t.sm3d=n.VectorStack.createMat3f64(),t.sm4d=n.VectorStack.createMat4f64(),t.sq4d=n.VectorStack.createQuatf64()}).apply(null,r))||(e.exports=i)},KRuQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autoDispose=t.AutoDisposable=t.AutoDisposableMixin=void 0,t.AutoDisposableMixin=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isDisposed=!1,t}return n.__extends(t,e),t.prototype.dispose=function(){for(var e,t=0,n=null!==(e=this._managedDisposables)&&void 0!==e?e:[];t<n.length;t++){var r=n[t],i=this[r];this[r]=null,i&&"function"==typeof i.dispose&&i.dispose()}this._isDisposed=!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),t}(e)};var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(t.AutoDisposableMixin((function(){})));t.AutoDisposable=r,t.autoDispose=function(){return function(e,t){var n,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!==(r=null===(n=e._managedDisposables)||void 0===n?void 0:n.slice())&&void 0!==r?r:[]),e._managedDisposables.unshift(t)}}}).apply(null,r))||(e.exports=i)},N5NQ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("PHan"),n("0LE5"),n("Rdxj"),n("JjCO")],void 0===(i=(function(e,t,n,r,i,o,a){"use strict";function s(e){return e?{origin:o.vec3f64.clone(e.origin),vector:o.vec3f64.clone(e.vector)}:{origin:o.vec3f64.create(),vector:o.vec3f64.create()}}function c(e,t){var n=p.get();return n.origin=e,n.vector=t,n}function l(e,t,n){return void 0===n&&(n=s()),i.vec3.copy(n.origin,e),i.vec3.copy(n.vector,t),n}function u(e,t){var r=i.vec3.subtract(a.sv3d.get(),t,e.origin),o=i.vec3.dot(e.vector,r),s=i.vec3.dot(e.vector,e.vector),c=n.clamp(o/s,0,1),l=i.vec3.subtract(a.sv3d.get(),i.vec3.scale(a.sv3d.get(),e.vector,c),r);return i.vec3.dot(l,l)}function f(e,t,r,o,s){var c=e.vector,l=e.origin,u=i.vec3.subtract(a.sv3d.get(),t,l),f=i.vec3.length(c),d=i.vec3.dot(c,u)/f;return i.vec3.scale(s,c,n.clamp(d,r,o)),i.vec3.add(s,s,e.origin)}function d(e,t,r,o){var s=e.origin,c=i.vec3.add(a.sv3d.get(),s,e.vector),l=t.origin,u=i.vec3.add(a.sv3d.get(),l,t.vector),f=a.sv3d.get(),d=a.sv3d.get();if(f[0]=s[0]-l[0],f[1]=s[1]-l[1],f[2]=s[2]-l[2],d[0]=u[0]-l[0],d[1]=u[1]-l[1],d[2]=u[2]-l[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;var v=a.sv3d.get();if(v[0]=c[0]-s[0],v[1]=c[1]-s[1],v[2]=c[2]-s[2],Math.abs(v[0])<1e-6&&Math.abs(v[1])<1e-6&&Math.abs(v[2])<1e-6)return!1;var p=f[0]*d[0]+f[1]*d[1]+f[2]*d[2],h=d[0]*v[0]+d[1]*v[1]+d[2]*v[2],m=f[0]*v[0]+f[1]*v[1]+f[2]*v[2],g=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],b=(v[0]*v[0]+v[1]*v[1]+v[2]*v[2])*g-h*h;if(Math.abs(b)<1e-6)return!1;var y=(p*h-m*g)/b,x=(p+h*y)/g;r&&(y=n.clamp(y,0,1),x=n.clamp(x,0,1));var _=a.sv3d.get(),S=a.sv3d.get();return _[0]=s[0]+y*v[0],_[1]=s[1]+y*v[1],_[2]=s[2]+y*v[2],S[0]=l[0]+x*d[0],S[1]=l[1]+x*d[1],S[2]=l[2]+x*d[2],o.tA=y,o.tB=x,o.pA=_,o.pB=S,o.distance2=i.vec3.squaredDistance(_,S),!0}Object.defineProperty(t,"__esModule",{value:!0}),t.closestLineSegmentDistance2=t.closestLineSegmentPoint=t.closestRayDistance2=t.projectPointClamp=t.pointAt=t.projectPoint=t.distance=t.distance2=t.fromPoints=t.fromValues=t.copy=t.wrap=t.create=void 0,t.create=s,t.wrap=c,t.copy=function(e,t){return void 0===t&&(t=s()),l(e.origin,e.vector,t)},t.fromValues=l,t.fromPoints=function(e,t,n){return void 0===n&&(n=s()),i.vec3.copy(n.origin,e),i.vec3.subtract(n.vector,t,e),n},t.distance2=u,t.distance=function(e,t){return Math.sqrt(u(e,t))},t.projectPoint=function(e,t,n){return f(e,t,0,1,n)},t.pointAt=function(e,t,n){return i.vec3.add(n,e.origin,i.vec3.scale(n,e.vector,t))},t.projectPointClamp=f,t.closestRayDistance2=function(e,t){if(d(e,c(t.origin,t.direction),!1,v)){var n=v.tA,r=v.pB;if(n>=0&&n<=1)return v.distance2;if(n<0)return i.vec3.squaredDistance(e.origin,r);if(n>1)return i.vec3.squaredDistance(i.vec3.add(a.sv3d.get(),e.origin,e.vector),r)}return null},t.closestLineSegmentPoint=function(e,t,n){return!!d(e,t,!0,v)&&(i.vec3.copy(n,v.pA),!0)},t.closestLineSegmentDistance2=function(e,t){return d(e,t,!0,v)?v.distance2:null};var v={tA:0,tB:0,pA:o.vec3f64.create(),pB:o.vec3f64.create(),distance2:0},p=new r.ObjectStack((function(){return{origin:null,vector:null}}))}).apply(null,r))||(e.exports=i)},PHan:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("6DRN")],void 0===(i=(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectStack=void 0;var i=function(){function e(e){var t=this;this.allocator=e,this.items=[],this.itemsPtr=0,this.tickHandle=r.before((function(){return t.reset()})),this.grow()}return e.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=n.nullifyNonnullableForDispose(this.tickHandle)),this.items=n.nullifyNonnullableForDispose(this.items)},e.prototype.get=function(){return 0===this.itemsPtr&&r((function(){})),this.itemsPtr===this.items.length&&this.grow(),this.items[this.itemsPtr++]},e.prototype.reset=function(){var e=Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*o);this.items.length=Math.min(e,this.items.length),this.itemsPtr=0},e.prototype.grow=function(){for(var e=0;e<Math.max(8,Math.min(this.items.length,o));e++)this.items.push(this.allocator())},e}();t.ObjectStack=i;var o=1024;t.default=i}).apply(null,r))||(e.exports=i)},PaEL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";function i(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n    void outputHighlight() {\n      vec4 fragCoord = gl_FragCoord;\n\n      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z > sceneDepth + 5e-7) {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "],["\n    void outputHighlight() {\n      vec4 fragCoord = gl_FragCoord;\n\n      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z > sceneDepth + 5e-7) {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "]))))}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.OutputHighlight=void 0,t.OutputHighlight=i,function(e){e.bindOutputHighlight=function(e,t,n){e.bindTexture(n.highlightDepthTexture,5),t.setUniform1i("depthTex",5),t.setUniform4f("highlightViewportPixelSz",0,0,n.inverseViewport[0],n.inverseViewport[1])}}(i=t.OutputHighlight||(t.OutputHighlight={}))}).apply(null,r))||(e.exports=i)},"PwS/":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("LxLY"),n("FXVB"),n("1m5D"),n("1f+t"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDoubleVec3=t.calculateTransformRelToOrigin=t.releaseMaterials=t.acquireMaterials=t.isInstanceHidden=t.removeObject3DStateID=t.addObject3DStateID=void 0,t.addObject3DStateID=function(e,t){return n.isNone(e)&&(e=[]),e.push(t),e},t.removeObject3DStateID=function(e,t){if(n.isNone(e))return e;var r=e.filter((function(e){return e!==t}));return 0===r.length?null:r},t.isInstanceHidden=function(e){return!!r.isSome(e)&&!e.visible},t.acquireMaterials=function(e,t){var n=new Map;return n.set(0,t.acquire(e,0)),n.set(3,t.acquire(e,3)),n.set(2,t.acquire(e,2)),n.set(1,t.acquire(e,1)),n.set(4,t.acquire(e,4)),n},t.releaseMaterials=function(e,t){t.release(e,0),t.release(e,3),t.release(e,2),t.release(e,1),t.release(e,4)},t.calculateTransformRelToOrigin=function(e,t,n){var o=e.origin.vec3;s.setMatrixTranslation3(u,-o[0],-o[1],-o[2]),r.isSome(e.transformation)?i.mat4.multiply(t,u,e.transformation):i.mat4.copy(t,u),n&&(i.mat4.invert(n,t),i.mat4.transpose(n,n))},t.encodeDoubleVec3=function(e,t,n,r,i){c[0]=e.get(t,0),c[1]=e.get(t,1),c[2]=e.get(t,2),a.encodeDoubleArray(c,l,3),n.set(i,0,l[0]),r.set(i,0,l[1]),n.set(i,1,l[2]),r.set(i,1,l[3]),n.set(i,2,l[4]),r.set(i,2,l[5])};var c=new Float64Array(3),l=new Float32Array(6),u=o.mat4f64.create()}).apply(null,r))||(e.exports=i)},"W/V4":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReloadableShaderModule=void 0;var r=function(){function e(e,t){this._module=e,this._loadModule=t}return e.prototype.get=function(){return this._module},e.prototype.reload=function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return e=this,[4,this._loadModule()];case 1:return e._module=t.sent(),[2,this._module]}}))}))},e}();t.ReloadableShaderModule=r}).apply(null,r))||(e.exports=i)},W0kZ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdGen=void 0;var n=function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}();t.IdGen=n}).apply(null,r))||(e.exports=i)},ZJC8:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("AzkI"),n("Cvn+"),n("W0kZ"),n("62Ht"),n("CIy2"),n("PwS/")],void 0===(i=(function(e,t,n,r,i,o,a,s,c,l,u,f,d,v){"use strict";var p=function(){function e(t){void 0===t&&(t={}),this._objectTransformation=o.mat4f64.create(),this._bvObjectSpace=new m,this._bvWorldSpace=new m,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.id=e._idGen.gen(t.idHint),this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new h),this.objectTransformation=o.mat4f64.create(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations,t.origins)}return Object.defineProperty(e.prototype,"geometryRecords",{get:function(){return this._geometryRecords},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"geometries",{get:function(){return this._geometries},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(e){i.mat4.copy(this._objectTransformation,e),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){for(var e=0,t=this._geometryRecords;e<t.length;e++)l.pool.release(t[e]);this._geometryRecords=null,this._geometries=null},e.prototype._initializeGeometryRecords=function(e,t,n,r){if(!Array.isArray(e))return this._geometryRecords=[],void(this._geometries=[]);d.assert(t.length===e.length,"Object3D: materials don't match geometries"),d.assert(n.length===e.length,"Object3D: transformations don't match geometries"),this._geometryRecords=new Array(e.length),this._geometries=e.slice();for(var i=0;i<e.length;i++)this._geometryRecords[i]=l.pool.acquire(e[i],t[i],o.mat4f64.clone(n[i]),{highlights:null,occludees:null,visible:!0},r&&r[i]);this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){d.assert(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!1,configurable:!0}),e.prototype.getNumGeometryRecords=function(){return this._geometryRecords.length},e.prototype.getGeometryRecord=function(e){return d.assert(e>=0&&e<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this._geometryRecords[e]},e.prototype.addGeometry=function(e,t,n,r,i,a){n=n||o.mat4f64.IDENTITY,this._geometries.push(e);var s=l.pool.acquire(e,t,n,r||{highlights:null,occludees:null,visible:!0},i,a);return this._geometryRecords.push(s),this._hasVolatileTransformation=this._geometryRecords.some((function(e){return!!e.shaderTransformation})),this._notifyDirty("objGeometryAdded",s),this._invalidateBoundingVolume(),s},e.prototype.removeGeometry=function(e){var t=this._geometryRecords.splice(e,1)[0];return l.pool.release(t),this._hasVolatileTransformation=this._geometryRecords.some((function(e){return!!e.shaderTransformation})),this._geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this._geometryRecords[e]),this._invalidateBoundingVolume()},Object.defineProperty(e.prototype,"isVisible",{get:function(){return this._visible},enumerable:!1,configurable:!0}),e.prototype.setVisible=function(e){this._visible=e;for(var t=0,n=this._geometryRecords;t<n.length;t++)n[t].instanceParameters.visible=this._visible;this._notifyDirty("visibilityChanged")},e.prototype.occlude=function(){for(var e=f.generateObject3DStateId(1),t=0,n=this._geometryRecords;t<n.length;t++){var r=n[t];r.instanceParameters.occludees=v.addObject3DStateID(r.instanceParameters.occludees,e)}return this._notifyDirty("occlusionChanged"),e},e.prototype.removeOcclude=function(e){for(var t=0,n=this._geometryRecords;t<n.length;t++){var r=n[t];r.instanceParameters.occludees=v.removeObject3DStateID(r.instanceParameters.occludees,e)}this._notifyDirty("occlusionChanged")},e.prototype.highlight=function(){for(var e=f.generateObject3DStateId(0),t=0,n=this._geometryRecords;t<n.length;t++){var r=n[t];r.instanceParameters.highlights=v.addObject3DStateID(r.instanceParameters.highlights,e)}return this._notifyDirty("highlightChanged"),e},e.prototype.removeHighlight=function(e){for(var t=0,n=this._geometryRecords;t<n.length;t++){var r=n[t];r.instanceParameters.highlights=v.removeObject3DStateID(r.instanceParameters.highlights,e)}this._notifyDirty("highlightChanged")},e.prototype.getCombinedStaticTransformation=function(e,t){return i.mat4.multiply(r.unwrapOr(t,o.mat4f64.create()),this.objectTransformation,e.getStaticTransformation())},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||o.mat4f64.create(),i.mat4.multiply(t,this.objectTransformation,e.getShaderTransformation()),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this._geometryRecords.length;++e){var t=this._geometries[e],n=this._geometryRecords[e],r=t.boundingInfo;this._calculateTransformedBoundingVolume(r,this._bvObjectSpace,n.getShaderTransformation()),this._calculateTransformedBoundingVolume(r,this._bvWorldSpace,this.getCombinedShaderTransformation(n))}a.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5),a.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);var i=s.vec3f64.create(),o=s.vec3f64.create(),l=c.maxScale(this.objectTransformation);for(e=0;e<this._geometryRecords.length;++e){t=this._geometries[e];var u=this._geometryRecords[e].getShaderTransformation(),f=c.maxScale(u);a.vec3.transformMat4(i,(r=t.boundingInfo).getCenter(),u);var d=a.vec3.distance(i,this._bvObjectSpace.center),v=r.getBSRadius()*f;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,d+v),a.vec3.transformMat4(o,i,this.objectTransformation);var p=a.vec3.distance(o,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,p+v*l)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,n){var r=e.getBBMin(),i=e.getBBMax(),o=s.vec3f64.clone(r),c=s.vec3f64.clone(i);a.vec3.transformMat4(o,o,n),a.vec3.transformMat4(c,c,n);for(var l=0;l<3;++l)t.bbMin[l]=Math.min(t.bbMin[l],o[l],c[l]),t.bbMax[l]=Math.max(t.bbMax[l],o[l],c[l]);for(l=0;l<3;++l){a.vec3.copy(o,r),a.vec3.copy(c,i),o[l]=i[l],c[l]=r[l],a.vec3.transformMat4(o,o,n),a.vec3.transformMat4(c,c,n);for(var u=0;u<3;++u)t.bbMin[u]=Math.min(t.bbMin[u],o[u],c[u]),t.bbMax[u]=Math.max(t.bbMax[u],o[u],c[u])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,n,r){this._parentLayer&&this._parentLayer.notifyDirty(e,t,n=n||1,r||this)},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{hasGeometry:function(t){return e._geometries.indexOf(t)>-1},getGeometryIndex:function(t){return e._geometries.indexOf(t)}}},enumerable:!1,configurable:!0}),e._idGen=new u.IdGen,e}(),h=function(){function e(){this.bbMin=s.vec3f64.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.bbMax=s.vec3f64.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return e.prototype.isEmpty=function(){return this.bbMax[0]<this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<this.bbMin[2]},e}(),m=function(e){function t(){var t=e.call(this)||this;return t.center=s.vec3f64.create(),t.bsRadius=0,t}return n.__extends(t,e),t.prototype.init=function(){a.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a.vec3.set(this.center,0,0,0),this.bsRadius=0},t.prototype.getCenter=function(){return this.center},t.prototype.getBSRadius=function(){return this.bsRadius},t}(h);return p}).apply(null,r))||(e.exports=i)},ZjcA:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("PHan"),n("W9tT"),n("0LE5"),n("Rdxj"),n("JjCO"),n("N5NQ")],void 0===(i=(function(e,t,n,r,i,o,a,s){"use strict";function c(e){return e?{p0:o.vec3f64.clone(e.p0),p1:o.vec3f64.clone(e.p1),p2:o.vec3f64.clone(e.p2)}:{p0:o.vec3f64.create(),p1:o.vec3f64.create(),p2:o.vec3f64.create()}}function l(e,t,n,r){return void 0===r&&(r=c()),i.vec3.copy(r.p0,e),i.vec3.copy(r.p1,t),i.vec3.copy(r.p2,n),r}function u(e,t,n){var i=r.vec2.distance(e,t),o=r.vec2.distance(t,n),a=r.vec2.distance(n,e),s=(i+o+a)/2,c=s*(s-i)*(s-o)*(s-a);return c<=0?0:Math.sqrt(c)}Object.defineProperty(t,"__esModule",{value:!0}),t.areaPoints3d=t.area2d=t.areaPoints2d=t.intersectRay=t.distance2=t.fromValues=t.copy=t.wrap=t.create=void 0,t.create=c,t.wrap=function(e,t,n){var r=d.get();return r.p0=e,r.p1=t,r.p2=n,r},t.copy=function(e,t){return void 0===t&&(t=c()),l(e.p0,e.p1,e.p2,t)},t.fromValues=l,t.distance2=function(e,t){var n=e.p0,r=e.p1,o=e.p2,c=i.vec3.subtract(a.sv3d.get(),r,n),l=i.vec3.subtract(a.sv3d.get(),o,r),u=i.vec3.subtract(a.sv3d.get(),n,o),d=i.vec3.subtract(a.sv3d.get(),t,n),v=i.vec3.subtract(a.sv3d.get(),t,r),p=i.vec3.subtract(a.sv3d.get(),t,o),h=i.vec3.cross(c,c,u),m=i.vec3.dot(i.vec3.cross(a.sv3d.get(),c,h),d),g=i.vec3.dot(i.vec3.cross(a.sv3d.get(),l,h),v),b=i.vec3.dot(i.vec3.cross(a.sv3d.get(),u,h),p);if(m>0&&g>0&&b>0){var y=i.vec3.dot(h,d);return y*y/i.vec3.dot(h,h)}var x=s.distance2(s.fromValues(n,c,f.get()),t),_=s.distance2(s.fromValues(r,l,f.get()),t),S=s.distance2(s.fromValues(o,u,f.get()),t);return Math.min(x,_,S)},t.intersectRay=function(e,t,n){var r=t.direction,o=t.origin,a=e.p0,s=e.p1,c=e.p2,l=s[0]-a[0],u=s[1]-a[1],f=s[2]-a[2],d=c[0]-a[0],v=c[1]-a[1],p=c[2]-a[2],h=r[1]*p-v*r[2],m=r[2]*d-p*r[0],g=r[0]*v-d*r[1],b=l*h+u*m+f*g;if(b>-1e-5&&b<1e-5)return!1;var y=1/b,x=o[0]-a[0],_=o[1]-a[1],S=o[2]-a[2],O=y*(x*h+_*m+S*g);if(O<0||O>1)return!1;var w=_*f-u*S,P=S*l-f*x,M=x*u-l*_,T=y*(r[0]*w+r[1]*P+r[2]*M);return!(T<0||O+T>1||(n&&(i.vec3.scale(n,r,y*(d*w+v*P+p*M)),i.vec3.add(n,o,n)),0))},t.areaPoints2d=u,t.area2d=function(e){return u(e.p0,e.p1,e.p2)},t.areaPoints3d=function(e,t,n){return i.vec3.subtract(v,t,e),i.vec3.subtract(p,n,e),i.vec3.length(i.vec3.cross(v,v,p))/2};var f=new n.ObjectStack(s.create),d=new n.ObjectStack((function(){return{p0:null,p1:null,p2:null}})),v=o.vec3f64.create(),p=o.vec3f64.create()}).apply(null,r))||(e.exports=i)},aExC:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("qsST"),n("R2Zq"),n("ULaq")],void 0===(i=(function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.Code=t.ShaderBuilder=t.Includes=void 0;var a=r.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder"),s=function(){function e(){this.includedModules=new Map}return e.prototype.include=function(e,t){this.includedModules.has(e)?this.includedModules.get(e)!==t&&a.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(e,t),e(this.builder,t))},e}();t.Includes=s;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vertex=new f,t.fragment=new f,t.attributes=new d,t.varyings=new v,t.extensions=new p,t.defines=new h,t}return n.__extends(t,e),Object.defineProperty(t.prototype,"builder",{get:function(){return this},enumerable:!1,configurable:!0}),t.prototype.generateSource=function(e){var t=this.extensions.generateSource(e),n=this.attributes.generateSource(e),r=this.varyings.generateSource(),i="vertex"===e?this.vertex:this.fragment,o=i.uniforms.generateSource(),a=i.code.generateSource(),s="vertex"===e?g:m,c=this.defines.generateSource().concat(i.defines.generateSource());return"\n"+t.join("\n")+"\n\n"+c.join("\n")+"\n\n"+s+"\n\n"+o.join("\n")+"\n\n"+n.join("\n")+"\n\n"+r.join("\n")+"\n\n"+a.join("\n")},t}(s);t.ShaderBuilder=c;var l=function(){function e(){this._entries=new Array,this._set=new Set}return e.prototype.add=function(e,t,n){var r=e+"_"+t+"_"+n;return this._set.has(r)||(this._entries.push([e,t,n]),this._set.add(r)),this},e.prototype.generateSource=function(){return this._entries.map((function(e){return"uniform "+e[1]+" "+e[0]+((t=e[2])?"["+t+"]":"")+";";var t}))},e}(),u=function(){function e(){this._entries=new Array}return e.prototype.add=function(e){this._entries.push(e)},e.prototype.generateSource=function(){return this._entries},e}();t.Code=u;var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uniforms=new l,t.code=new u,t.defines=new h,t}return n.__extends(t,e),Object.defineProperty(t.prototype,"builder",{get:function(){return this},enumerable:!1,configurable:!0}),t}(s);t.Stage=f;var d=function(){function e(){this._entries=new Array}return e.prototype.add=function(e,t){this._entries.push([e,t])},e.prototype.generateSource=function(e){return"fragment"===e?[]:this._entries.map((function(e){return"attribute "+e[1]+" "+e[0]+";"}))},e}(),v=function(){function e(){this._entries=new Array}return e.prototype.add=function(e,t){this._entries.push([e,t])},e.prototype.generateSource=function(){return this._entries.map((function(e){return"varying "+e[1]+" "+e[0]+";"}))},e}(),p=function(){function e(){this._entries=new Set}return e.prototype.add=function(e){this._entries.add(e)},e.prototype.generateSource=function(t){var n="vertex"===t?e.ALLOWLIST_VERTEX:e.ALLOWLIST_FRAGMENT;return o.valuesOfSet(this._entries).filter((function(e){return n.indexOf(e)>=0})).map((function(e){return"#extension "+e+" : enable"}))},e.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],e.ALLOWLIST_VERTEX=[],e}(),h=function(){function e(){this._entries=new Map}return e.prototype.addInt=function(e,t){var n=t%1==0?t.toFixed(0):t.toString();this._entries.set(e,n)},e.prototype.addFloat=function(e,t){var n=t%1==0?t.toFixed(1):t.toString();this._entries.set(e,n)},e.prototype.generateSource=function(){return i.pairsOfMap(this._entries).map((function(e){return"#define "+e[0]+" "+e[1]}))},e}(),m="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",g="precision highp float;\nprecision highp sampler2D;"}).apply(null,r))||(e.exports=i)},aWgr:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("GyfB"),n("2eYJ"),n("fXZm"),n("cpxo"),n("N5NQ"),n("GG08"),n("4p4v"),n("/dtL"),n("ZjcA"),n("18xY")],void 0===(i=(function(e,t,n,r,i,o,a,s,c,l,u,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.axisAngle=t.vector=t.frustum=t.sphere=t.clipRay=t.ray=t.lineSegment=t.triangle=t.boundedPlane=t.plane=void 0,t.plane=s,t.boundedPlane=r,t.triangle=u,t.lineSegment=a,t.ray=c,t.clipRay=i,t.sphere=l,t.frustum=o,t.vector=f,t.axisAngle=n}).apply(null,r))||(e.exports=i)},cj3m:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("DKwL"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){"use strict";function o(e){e.fragment.include(r.RgbaFloatEncoding),e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("shadowMapNum","int"),e.fragment.uniforms.add("shadowMapDistance","vec4"),e.fragment.uniforms.add("shadowMapMatrix","mat4",4),e.fragment.uniforms.add("depthHalfPixelSz","float"),e.fragment.code.add(i.glsl(a||(a=n.__makeTemplateObject(["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize = depthHalfPixelSz;\n      vec4 distance = shadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      if (i >= shadowMapNum) { return 0.0; }\n\n      mat4 mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n\n      // vertex completely outside? -> no shadow\n      vec3 lvpos = 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "],["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize = depthHalfPixelSz;\n      vec4 distance = shadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      if (i >= shadowMapNum) { return 0.0; }\n\n      mat4 mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n\n      // vertex completely outside? -> no shadow\n      vec3 lvpos = 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "]))))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.ReadShadowMap=void 0,t.ReadShadowMap=o,function(e){e.bindUniforms=function(e,t,n){t.shadowMappingEnabled&&(t.shadowMap.bind(e,n),t.shadowMap.bindView(e,t.origin))},e.bindViewCustomOrigin=function(e,t,n){t.shadowMappingEnabled&&t.shadowMap.bindView(e,n)},e.bindView=function(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}}(o=t.ReadShadowMap||(t.ReadShadowMap={}))}).apply(null,r))||(e.exports=i)},cmSR:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.ForwardLinearDepth=void 0,t.ForwardLinearDepth=function(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "],["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "]))))):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("uCameraNearFar","vec2"),e.vertex.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "],["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "]))))):e.vertex.code.add(r.glsl(a||(a=n.__makeTemplateObject(["\n      void forwardLinearDepth() {}\n    "],["\n      void forwardLinearDepth() {}\n    "]))))}}).apply(null,r))||(e.exports=i)},cpxo:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("PHan"),n("FXVB"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("JjCO"),n("fXZm"),n("GG08")],void 0===(i=(function(e,t,n,r,i,o,a,s,c,l,u){"use strict";function f(e){if(e){var t=e.planes,n=e.points;return{planes:[u.create(t[0]),u.create(t[1]),u.create(t[2]),u.create(t[3]),u.create(t[4]),u.create(t[5])],points:[o.vec3f64.clone(n[0]),o.vec3f64.clone(n[1]),o.vec3f64.clone(n[2]),o.vec3f64.clone(n[3]),o.vec3f64.clone(n[4]),o.vec3f64.clone(n[5]),o.vec3f64.clone(n[6]),o.vec3f64.clone(n[7])]}}return{planes:[u.create(),u.create(),u.create(),u.create(),u.create(),u.create()],points:[o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create()]}}function d(e,t,n){void 0===n&&(n=f());for(var r=0;r<6;r++)u.copy(e[r],n.planes[r]);for(r=0;r<8;r++)i.vec3.copy(n.points[r],t[r]);return n}function v(e){var t=e.planes,n=e.points;u.fromPoints(n[4],n[0],n[3],t[0]),u.fromPoints(n[1],n[5],n[6],t[1]),u.fromPoints(n[4],n[5],n[1],t[2]),u.fromPoints(n[3],n[2],n[6],t[3]),u.fromPoints(n[0],n[1],n[2],t[4]),u.fromPoints(n[5],n[4],n[7],t[5])}function p(e,t){for(var n=0;n<6;n++)if(!u.clip(e[n],t))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.planePointIndices=t.intersectsAABB=t.intersectsPoint=t.intersectsLineSegment=t.intersectClipRay=t.intersectsRay=t.intersectsSphere=t.recomputePlanes=t.fromMatrix=t.fromValues=t.copy=t.create=void 0,t.create=f,t.copy=function(e,t){return void 0===t&&(t=f()),d(e.planes,e.points,t)},t.fromValues=d,t.fromMatrix=function(e,t,n){void 0===n&&(n=f());var o=n.points,s=r.mat4.multiply(c.sm4d.get(),t,e);r.mat4.invert(s,s);for(var l=0;l<8;++l){var u=a.vec4.transformMat4(c.sv4d.get(),h[l],s);i.vec3.set(o[l],u[0]/u[3],u[1]/u[3],u[2]/u[3])}return v(n),n},t.recomputePlanes=v,t.intersectsSphere=function(e,t){for(var n=0;n<6;n++)if(u.isSphereFullyInside(e[n],t))return!1;return!0},t.intersectsRay=function(e,t){return p(e,l.fromRay(t,m.get()))},t.intersectClipRay=function(e,t){for(var n=0;n<6;n++)if(!u.clipInfinite(e[n],t))return!1;return!0},t.intersectsLineSegment=function(e,t,n){return p(e,l.fromLineSegmentAndDirection(t,n,m.get()))},t.intersectsPoint=function(e,t){for(var n=0;n<6;n++)if(u.signedDistance(e[n],t)>0)return!1;return!0},t.intersectsAABB=function(e,t){for(var n=0;n<6;n++)if(u.isAABBFullyInside(e[n],t))return!1;return!0},t.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};var h=[s.vec4f64.fromValues(-1,-1,-1,1),s.vec4f64.fromValues(1,-1,-1,1),s.vec4f64.fromValues(1,1,-1,1),s.vec4f64.fromValues(-1,1,-1,1),s.vec4f64.fromValues(-1,-1,1,1),s.vec4f64.fromValues(1,-1,1,1),s.vec4f64.fromValues(1,1,1,1),s.vec4f64.fromValues(-1,1,1,1)],m=new n.ObjectStack(l.create)}).apply(null,r))||(e.exports=i)},fXZm:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("PHan"),n("0LE5"),n("JjCO"),n("4p4v")],void 0===(i=(function(e,t,n,r,i,o){"use strict";function a(e){return e?{ray:o.create(e.ray),c0:e.c0,c1:e.c1}:{ray:o.create(),c0:0,c1:Number.MAX_VALUE}}function s(e,t,n,r){return void 0===r&&(r=a()),o.copy(e,r.ray),r.c0=t,r.c1=n,r}function c(e,t,n){void 0===n&&(n=a());var i=r.vec3.length(e.vector);return o.fromValues(e.origin,t,n.ray),n.c0=0,n.c1=i,n}function l(e,t,n){return r.vec3.add(n,e.ray.origin,r.vec3.scale(n,e.ray.direction,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.getAt=t.getEnd=t.getStart=t.fromLineSegmentAndDirection=t.fromLineSegment=t.fromRay=t.fromValues=t.copy=t.wrap=t.create=void 0,t.create=a,t.wrap=function(e,t,n){var r=u.get();return r.ray=e,r.c0=t,r.c1=n,r},t.copy=function(e,t){return void 0===t&&(t=a()),s(e.ray,e.c0,e.c1,t)},t.fromValues=s,t.fromRay=function(e,t){return void 0===t&&(t=a()),o.copy(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t},t.fromLineSegment=function(e,t){return void 0===t&&(t=a()),c(e,r.vec3.normalize(i.sv3d.get(),e.vector),t)},t.fromLineSegmentAndDirection=c,t.getStart=function(e,t){return l(e,e.c0,t)},t.getEnd=function(e,t){return l(e,e.c1,t)},t.getAt=l;var u=new n.ObjectStack((function(){return{c0:0,c1:0,ray:null}}))}).apply(null,r))||(e.exports=i)},fese:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("LxLY"),n("0LE5"),n("Rdxj"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,o,a){"use strict";function s(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");var r=a.glsl(c||(c=n.__makeTemplateObject(["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel = pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot = dot(slicePlaneBasis1, rel);\n        float basis2Dot = dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front < 0.0\n          && factors.side0 < 0.0\n          && factors.side1 < 0.0\n          && factors.side2 < 0.0\n          && factors.side3 < 0.0;\n      }\n\n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "],["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel = pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot = dot(slicePlaneBasis1, rel);\n        float basis2Dot = dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front < 0.0\n          && factors.side0 < 0.0\n          && factors.side1 < 0.0\n          && factors.side2 < 0.0\n          && factors.side3 < 0.0;\n      }\n\n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "]))),i=a.glsl(l||(l=n.__makeTemplateObject(["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors = calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH = 1.0;\n        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor = (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "],["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors = calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH = 1.0;\n        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor = (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "]))),o=t.sliceHighlightDisabled?a.glsl(u||(u=n.__makeTemplateObject(["#define highlightSlice(_color_, _pos_) (_color_)"],["#define highlightSlice(_color_, _pos_) (_color_)"]))):a.glsl(f||(f=n.__makeTemplateObject(["\n        ","\n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "],["\n        ","\n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "])),i);t.sliceEnabledForVertexPrograms&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(o)}else{var s=a.glsl(d||(d=n.__makeTemplateObject(["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "],["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "])));t.sliceEnabledForVertexPrograms&&e.vertex.code.add(s),e.fragment.code.add(s)}}Object.defineProperty(t,"__esModule",{value:!0}),t.Slice=void 0,t.Slice=s,function(e){e.bindUniformsWithOrigin=function(t,n,r){e.bindUniforms(t,n,r.slicePlane,r.origin)},e.bindUniforms=function(e,t,n,a){t.slicePlaneEnabled&&(r.isSome(n)?(a?(i.vec3.subtract(v,n.origin,a),e.setUniform3fv("slicePlaneOrigin",v)):e.setUniform3fv("slicePlaneOrigin",n.origin),e.setUniform3fv("slicePlaneBasis1",n.basis1),e.setUniform3fv("slicePlaneBasis2",n.basis2)):(e.setUniform3fv("slicePlaneBasis1",o.vec3f64.ZEROS),e.setUniform3fv("slicePlaneBasis2",o.vec3f64.ZEROS),e.setUniform3fv("slicePlaneOrigin",o.vec3f64.ZEROS)))}}(s=t.Slice||(t.Slice={}));var c,l,u,f,d,v=o.vec3f64.create()}).apply(null,r))||(e.exports=i)},"ff/U":function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D=void 0,t.Default3D={position:0,normal:1,uv0:2,color:3,size:4,tangent:4,uvMapSpace:4,auxpos1:5,symbolColor:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,instanceColor:7,bound1:5,bound2:6,bound3:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}).apply(null,r))||(e.exports=i)},iHt0:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function n(){return new Float32Array(3)}function r(e,t,n){var r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=n,r}function i(){return n()}function o(){return r(1,1,1)}function a(){return r(1,0,0)}function s(){return r(0,1,0)}function c(){return r(0,0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.UNIT_Z=t.UNIT_Y=t.UNIT_X=t.ONES=t.ZEROS=t.unitZ=t.unitY=t.unitX=t.ones=t.zeros=t.createView=t.fromValues=t.clone=t.create=void 0,t.create=n,t.clone=function(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.fromValues=r,t.createView=function(e,t){return new Float32Array(e,t,3)},t.zeros=i,t.ones=o,t.unitX=a,t.unitY=s,t.unitZ=c,t.ZEROS=i(),t.ONES=o(),t.UNIT_X=a(),t.UNIT_Y=s(),t.UNIT_Z=c()}).apply(null,r))||(e.exports=i)},juLw:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyticalSkyModel=void 0,t.AnalyticalSkyModel=function(e){var t=e.fragment.code;t.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "])))),t.add(r.glsl(o||(o=n.__makeTemplateObject(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "],["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "])))),t.add(r.glsl(a||(a=n.__makeTemplateObject(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))}}).apply(null,r))||(e.exports=i)},lBa0:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parameter=t.ShaderTechniqueConfiguration=void 0;var r=function(){function e(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits.map((function(){return 0}))}return Object.defineProperty(e.prototype,"key",{get:function(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key},enumerable:!1,configurable:!0}),e.prototype.snapshot=function(){for(var e={key:this.key},t=0,n=this._parameterNames;t<n.length;t++){var r=n[t];e[r]=this[r]}return e},e}();t.ShaderTechniqueConfiguration=r,t.parameter=function(e){return void 0===e&&(e={}),function(t,r){var i,o;t._parameterNames=null!==(i=t._parameterNames)&&void 0!==i?i:[],t._parameterNames.push(r);for(var a=t._parameterNames.length-1,s=Math.ceil(n.log2(e.count||2)),c=null!==(o=t._parameterBits)&&void 0!==o?o:[0],l=0;c[l]+s>16;)++l>=c.length&&c.push(0);t._parameterBits=c;var u=c[l],f=(1<<s)-1<<u;c[l]+=s,Object.defineProperty(t,r,{get:function(){return this[a]},set:function(e){if(this[a]!==e&&(this[a]=e,this._keyDirty=!0,this._parameterBits[l]=this._parameterBits[l]&~f|+e<<u&f,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration values must be booleans or numbers!"}})}}}).apply(null,r))||(e.exports=i)},lfQW:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stencilToolTransparentOccluderParams=t.stencilToolMaskOccluderParams=t.stencilToolMaskBaseParams=t.stencilBaseAllZerosParams=t.replaceBitWhenDepthTestPasses=t.renderWhenBitIsNotSet=t.stencilWriteMaskOff=t.stencilWriteMaskOn=t.depthCompareAlways=t.depthCompareLess=void 0,t.depthCompareLess={func:513},t.depthCompareAlways={func:519},t.stencilWriteMaskOn={mask:255},t.stencilWriteMaskOff={mask:0},t.renderWhenBitIsNotSet=function(e){return{function:{func:517,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7680}}},t.replaceBitWhenDepthTestPasses=function(e){return{function:{func:519,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7681}}},t.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},t.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},t.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},t.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}}).apply(null,r))||(e.exports=i)},piY7:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("juLw"),n("quQL"),n("7Aei")],void 0===(i=(function(e,t,n,r,i,o){"use strict";var a,s,c,l,u,f,d,v,p,h,m;Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicallyBasedRendering=void 0,t.PhysicallyBasedRendering=function(e,t){var g=e.fragment.code;e.include(i.PiUtils),3===t.pbrMode||4===t.pbrMode?(g.add(o.glsl(a||(a=n.__makeTemplateObject(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "],["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "])),t.useCustomDTRExponentForWater?"2.2":"2.0")),g.add(o.glsl(s||(s=n.__makeTemplateObject(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "],["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),g.add(o.glsl(c||(c=n.__makeTemplateObject(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "],["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),g.add(o.glsl(l||(l=n.__makeTemplateObject(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "],["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),g.add(o.glsl(u||(u=n.__makeTemplateObject(["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  = 1.2;\n      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "],["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  = 1.2;\n      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))))):1!==t.pbrMode&&2!==t.pbrMode||(e.include(r.AnalyticalSkyModel),g.add(o.glsl(f||(f=n.__makeTemplateObject(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "],["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),g.add(o.glsl(d||(d=n.__makeTemplateObject(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "],["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),g.add(o.glsl(v||(v=n.__makeTemplateObject(["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "],["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),g.add(o.glsl(p||(p=n.__makeTemplateObject(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "],["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),g.add(o.glsl(h||(h=n.__makeTemplateObject(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"],["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"])))),g.add(o.glsl(m||(m=n.__makeTemplateObject(["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "],["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "])))))}}).apply(null,r))||(e.exports=i)},quQL:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.PiUtils=void 0,t.PiUtils=function(e){e.vertex.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    const float PI = 3.141592653589793;\n  "],["\n    const float PI = 3.141592653589793;\n  "])))),e.fragment.code.add(r.glsl(o||(o=n.__makeTemplateObject(["\n    const float PI = 3.141592653589793;\n    const float LIGHT_NORMALIZATION = 1.0 / PI;\n    const float INV_PI = 0.3183098861837907;\n    const float HALF_PI = 1.570796326794897;\n    "],["\n    const float PI = 3.141592653589793;\n    const float LIGHT_NORMALIZATION = 1.0 / PI;\n    const float INV_PI = 0.3183098861837907;\n    const float HALF_PI = 1.570796326794897;\n    "]))))}}).apply(null,r))||(e.exports=i)},rCq5:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("7Aei")],void 0===(i=(function(e,t,n,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConversion=void 0,t.ColorConversion=function(e){e.code.add(r.glsl(i||(i=n.__makeTemplateObject(["\n    vec4 premultiplyAlpha(vec4 v) {\n      return vec4(v.rgb * v.a, v.a);\n    }\n\n    // Note: the min in the last line has been added to fix an instability in chrome.\n    // See https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/23911\n    // With proper floating point handling, the value could never be >1.\n    vec3 rgb2hsv(vec3 c) {\n      vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n      vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n      vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n      float d = q.x - min(q.w, q.y);\n      float e = 1.0e-10;\n      return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n    }\n\n    vec3 hsv2rgb(vec3 c) {\n      vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n      vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n      return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }\n\n    float rgb2v(vec3 c) {\n      return max(c.x, max(c.y, c.z));\n    }\n  "],["\n    vec4 premultiplyAlpha(vec4 v) {\n      return vec4(v.rgb * v.a, v.a);\n    }\n\n    // Note: the min in the last line has been added to fix an instability in chrome.\n    // See https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/23911\n    // With proper floating point handling, the value could never be >1.\n    vec3 rgb2hsv(vec3 c) {\n      vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n      vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n      vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n      float d = q.x - min(q.w, q.y);\n      float e = 1.0e-10;\n      return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n    }\n\n    vec3 hsv2rgb(vec3 c) {\n      vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n      vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n      return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }\n\n    float rgb2v(vec3 c) {\n      return max(c.x, max(c.y, c.z));\n    }\n  "]))))}}).apply(null,r))||(e.exports=i)},s6rJ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("xoE+"),n("LxLY"),n("0LE5"),n("Rdxj"),n("WRgd"),n("+wMf"),n("CIy2"),n("PwS/")],void 0===(i=(function(e,t,n,r,i,o,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.colorMixModes=t.intersectDrapedRenderLineGeometry=t.updateParameters=t.copyParameters=t.bindScreenSizePerspective=t.verticalOffsetAtDistance=t.intersectAabbInvDirBefore=t.intersectAabbInvDir=t.computeInvDir=t.computeNormal=t.intersectTriangles=t.intersectTriangleGeometry=void 0;var u=a.create(),f=c.VertexAttrConstants;t.intersectTriangleGeometry=function(e,t,n,i,o,s,v){var p=l.isInstanceHidden(t),m=n.tolerance;if(!p)if(e.boundingInfo)c.assert("triangle"===e.data.primitiveType),function e(t,n,i,o,s,c){var l=y(n,i,d);if(a.setMin(u,t.getBBMin()),a.setMax(u,t.getBBMax()),r.isSome(s)&&s.applyToAabb(u),x(u,n,l,o)){var f=t.getPrimitiveIndices(),v=t.getIndices(),p=t.getPosition(),m=f?f.length:v.length/3;if(m>O){var g=t.getChildren();if(void 0!==g){for(var b=0;b<8;++b)void 0!==g[b]&&e(g[b],n,i,o,s,c);return}}h(n,i,0,m,v,p,f,s,c)}}(e.boundingInfo,i,o,m,s,v);else{var g=e.getIndices(f.POSITION),b=e.getAttribute(f.POSITION);h(i,o,0,g.length/3,g,b,void 0,s,v)}};var d=o.vec3f64.create(),v=Math.pow(2,-52),p=o.vec3f64.create();function h(e,t,n,i,o,a,s,c,l){var u,f,d;if(s)return function(e,t,n,i,o,a,s,c,l){for(var u,f,d,h=a.data,m=a.offsetIdx,g=a.strideIdx,y=e[0],x=e[1],_=e[2],S=t[0]-y,O=t[1]-x,w=t[2]-_,P=n;P<i;++P){var M=s[P],T=3*M,A=m+g*o[T++],I=h[A++],j=h[A++],V=h[A];A=m+g*o[T++];var z=h[A++],C=h[A++],D=h[A];A=m+g*o[T];var L=h[A++],F=h[A++],R=h[A];r.isSome(c)&&(I=(u=c.applyToVertex(I,j,V))[0],j=u[1],V=u[2],z=(f=c.applyToVertex(z,C,D))[0],C=f[1],D=f[2],L=(d=c.applyToVertex(L,F,R))[0],F=d[1],R=d[2]);var N=z-I,B=C-j,E=D-V,H=L-I,k=F-j,U=R-V,G=O*U-k*w,q=w*H-U*S,W=S*k-H*O,X=N*G+B*q+E*W;if(!(Math.abs(X)<=v)){var Y=y-I,Z=x-j,K=_-V,J=Y*G+Z*q+K*W;if(X>0){if(J<0||J>X)continue}else if(J>0||J<X)continue;var Q=Z*E-B*K,$=K*N-E*Y,ee=Y*B-N*Z,te=S*Q+O*$+w*ee;if(X>0){if(te<0||J+te>X)continue}else if(te>0||J+te<X)continue;var ne=(H*Q+k*$+U*ee)/X;ne>=0&&l(ne,b(N,B,E,H,k,U,p),M)}}}(e,t,n,i,o,a,s,c,l);for(var h=a.data,m=a.offsetIdx,g=a.strideIdx,y=e[0],x=e[1],_=e[2],S=t[0]-y,O=t[1]-x,w=t[2]-_,P=n,M=3*n;P<i;++P){var T=m+g*o[M++],A=h[T++],I=h[T++],j=h[T];T=m+g*o[M++];var V=h[T++],z=h[T++],C=h[T];T=m+g*o[M++];var D=h[T++],L=h[T++],F=h[T];r.isSome(c)&&(A=(u=c.applyToVertex(A,I,j))[0],I=u[1],j=u[2],V=(f=c.applyToVertex(V,z,C))[0],z=f[1],C=f[2],D=(d=c.applyToVertex(D,L,F))[0],L=d[1],F=d[2]);var R=V-A,N=z-I,B=C-j,E=D-A,H=L-I,k=F-j,U=O*k-H*w,G=w*E-k*S,q=S*H-E*O,W=R*U+N*G+B*q;if(!(Math.abs(W)<=v)){var X=y-A,Y=x-I,Z=_-j,K=X*U+Y*G+Z*q;if(W>0){if(K<0||K>W)continue}else if(K>0||K<W)continue;var J=Y*B-N*Z,Q=Z*R-B*X,$=X*N-R*Y,ee=S*J+O*Q+w*$;if(W>0){if(ee<0||K+ee>W)continue}else if(ee>0||K+ee<W)continue;var te=(E*J+H*Q+k*$)/W;te>=0&&l(te,b(R,N,B,E,H,k,p),P)}}}t.intersectTriangles=h;var m=o.vec3f64.create(),g=o.vec3f64.create();function b(e,t,n,r,o,a,s){return i.vec3.set(m,e,t,n),i.vec3.set(g,r,o,a),i.vec3.cross(s,m,g),i.vec3.normalize(s,s),s}function y(e,t,n){return i.vec3.set(n,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function x(e,t,n,r){return _(e,t,n,r,1/0)}function _(e,t,n,r,i){var o=(e[0]-r-t[0])*n[0],a=(e[3]+r-t[0])*n[0],s=Math.min(o,a),c=Math.max(o,a),l=(e[1]-r-t[1])*n[1],u=(e[4]+r-t[1])*n[1];if((c=Math.min(c,Math.max(l,u)))<0)return!1;if((s=Math.max(s,Math.min(l,u)))>c)return!1;var f=(e[2]-r-t[2])*n[2],d=(e[5]+r-t[2])*n[2];return!((c=Math.min(c,Math.max(f,d)))<0)&&!((s=Math.max(s,Math.min(f,d)))>c)&&s<i}function S(e){var t=[];return e.forEach((function(e){return t.push(e)})),t}t.computeNormal=b,t.computeInvDir=y,t.intersectAabbInvDir=x,t.intersectAabbInvDirBefore=_,t.verticalOffsetAtDistance=function(e,t,r,i,o){var a=(r.screenLength||0)*e.pixelRatio;o&&(a=s.scale(a,i,t,o));var c=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return n.glClamp(c*t,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)},t.bindScreenSizePerspective=function(e,t,n){if(e){var r=e.parameters;t.setUniform4f(n,r.divisor,r.offset,r.minPixelSize,e.paddingPixelsOverride)}},t.copyParameters=function e(t,n){var r=n?e(n):{};for(var i in t){var o=t[i];o&&o.forEach&&(o=S(o)),null==o&&i in r||(r[i]=o)}return r},t.updateParameters=function(e,t){var n=!1;for(var r in t){var i=t[r];void 0!==i&&(n=!0,e[r]=Array.isArray(i)?i.slice():i)}return n},t.intersectDrapedRenderLineGeometry=function(e,t,r,i,o){if(t.options.selectionMode){for(var a=e.getAttribute(f.POSITION).data,s=e.getAttribute(f.SIZE),c=r[0],l=r[1],u=(((s&&s.data[0])+i)/2+4)*e.screenToWorldRatio,d=Number.MAX_VALUE,v=0;v<a.length-5;v+=3){var p=a[v],h=a[v+1],m=c-p,g=l-h,b=a[v+3]-p,y=a[v+4]-h,x=n.clamp((b*m+y*g)/(b*b+y*y),0,1),_=b*x-m,S=y*x-g,O=_*_+S*S;O<d&&(d=O)}d<u*u&&o()}},t.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var O=1e3}).apply(null,r))||(e.exports=i)},tUyH:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("KRuQ")],void 0===(i=(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLMaterial=void 0;var i=function(e){function t(t){var n=e.call(this)||this;return n.material=t.material,n.techniqueRep=t.techniqueRep,n.output=t.output,n}return n.__extends(t,e),t.prototype.getTechnique=function(){return this.technique},t.prototype.getPipelineState=function(e,t){return this.getTechnique().pipeline},t.prototype.ensureResources=function(e){return 2},t.prototype.ensureParameters=function(e){},t}(r.AutoDisposable);t.GLMaterial=i}).apply(null,r))||(e.exports=i)},vlC2:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("iHt0")],void 0===(i=(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec3f32=void 0,t.vec3f32=n}).apply(null,r))||(e.exports=i)},"wSO/":function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("LxLY"),n("6DRN"),n("51bw"),n("1m5D"),n("lLWD"),n("DIqE"),n("Rdxj"),n("O7NG")],void 0===(i=(function(e,t,n,r,i,o,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorStack=void 0;var u=function(){function e(e,t,n){var i=this;this.itemByteSize=e,this.itemCreate=t,this.buffers=[],this.items=[],this.itemsPerBuffer=0,this.itemsPtr=0,this.itemsPerBuffer=Math.ceil(n/this.itemByteSize),this.tickHandle=r.before((function(){return i.reset()}))}return e.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=n.nullifyNonnullableForDispose(this.tickHandle)),this.itemsPtr=0,this.items=n.nullifyNonnullableForDispose(this.items),this.buffers=n.nullifyNonnullableForDispose(this.buffers)},e.prototype.get=function(){0===this.itemsPtr&&r((function(){}));for(var e=Math.floor(this.itemsPtr/this.itemsPerBuffer);this.buffers.length<=e;){for(var t=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),n=0;n<this.itemsPerBuffer;++n)this.items.push(this.itemCreate(t,n*this.itemByteSize));this.buffers.push(t)}return this.items[this.itemsPtr++]},e.prototype.reset=function(){for(var e=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>e;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0},e.createVec2f64=function(t){return void 0===t&&(t=f),new e(16,s.vec2f64.createView,t)},e.createVec3f64=function(t){return void 0===t&&(t=f),new e(24,c.vec3f64.createView,t)},e.createVec4f64=function(t){return void 0===t&&(t=f),new e(32,l.vec4f64.createView,t)},e.createMat3f64=function(t){return void 0===t&&(t=f),new e(72,i.mat3f64.createView,t)},e.createMat4f64=function(t){return void 0===t&&(t=f),new e(128,o.mat4f64.createView,t)},e.createQuatf64=function(t){return void 0===t&&(t=f),new e(32,a.quatf64.createView,t)},Object.defineProperty(e.prototype,"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!1,configurable:!0}),e}();t.VectorStack=u;var f=4096}).apply(null,r))||(e.exports=i)},weRx:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("zp6E")],void 0===(i=(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestImage=void 0,t.requestImage=function(e,t){return r(e,n.__assign({responseType:"image"},t)).then((function(e){return e.data}))}}).apply(null,r))||(e.exports=i)},xDGw:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("2o+p"),n("7Aei")],void 0===(i=(function(e,t,n,r,i){"use strict";function o(e,t){var o=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(r.ScreenSizePerspective),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),o.add(i.glsl(f||(f=n.__makeTemplateObject(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "],["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),i.glsl(1===t.viewingMode?s||(s=n.__makeTemplateObject(["vec3 worldNormal = normalize(worldPos + localOrigin);"],["vec3 worldNormal = normalize(worldPos + localOrigin);"])):c||(c=n.__makeTemplateObject(["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"],["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"]))),i.glsl(t.screenSizePerspectiveEnabled?l||(l=n.__makeTemplateObject(["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"],["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"])):u||(u=n.__makeTemplateObject(["\n          float verticalOffsetScreenHeight = verticalOffset.x;"],["\n          float verticalOffsetScreenHeight = verticalOffset.x;"])))))):o.add(i.glsl(d||(d=n.__makeTemplateObject(["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "],["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "]))))}function a(e,t,n,r){return void 0===r&&(r=v),r.screenLength=e.screenLength,r.perDistance=Math.tan(.5*t)/(.5*n),r.minWorldLength=e.minWorldLength,r.maxWorldLength=e.maxWorldLength,r}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateVerticalOffsetFactors=t.VerticalOffset=void 0,t.VerticalOffset=o,function(e){e.bindUniforms=function(e,t,n){if(t.verticalOffset){var r=a(t.verticalOffset,n.camera.fovY,n.camera.fullViewport[3]);e.setUniform4f("verticalOffset",r.screenLength*(n.camera.pixelRatio||1),r.perDistance,r.minWorldLength,r.maxWorldLength)}}}(o=t.VerticalOffset||(t.VerticalOffset={})),t.calculateVerticalOffsetFactors=a;var s,c,l,u,f,d,v={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}}).apply(null,r))||(e.exports=i)},yqrJ:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("zOht"),n("pcDC"),n("ma1f"),n("BcWh"),n("xoE+"),n("xoE+"),n("LxLY"),n("qMld"),n("rusB"),n("jfWY"),n("R6Tp"),n("weRx"),n("EyQ4"),n("/Bau"),n("W0kZ"),n("CIy2"),n("/f24"),n("Zp3t"),n("Kfys"),n("7laH")],void 0===(i=(function(e,t,n,r,i,o,a,s,c,l,u,f,d,v,p,h,m,g,b,y,x,_){"use strict";return function(){function e(t,n,r){this.data=t,this.glTexture=null,this.powerOfTwoStretchInfo=null,this.loadingPromise=null,this.loadingController=null,this.events=new o,this.data=t,this.id=e.idGen.gen(n),this.params=r||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=e.estimateTexMemRequired(this.data,this.params),this.startPreload()}return e.prototype.startPreload=function(){var e=this.data;c.isNone(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))},e.prototype.startPreloadVideoElement=function(e){f.isBlobProtocol(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)},e.prototype.startPreloadImageElement=function(e){f.isDataProtocol(e.src)||f.isBlobProtocol(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)},e.getDataDimensions=function(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e},e.estimateTexMemRequired=function(t,n){if(c.isNone(t))return 0;if(u.isArrayBuffer(t)||u.isUint8Array(t))return t.byteLength;var r=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?e.getDataDimensions(t):n;return(n.mipmap?4/3:1)*r.width*r.height*(n.components||4)||0},e.prototype.dispose=function(){this.data=void 0},Object.defineProperty(e.prototype,"width",{get:function(){return this.params.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.params.height},enumerable:!1,configurable:!0}),e.prototype.createDescriptor=function(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.mipmap&&!this.params.disableAnisotropy?e.parameters.maxMaxAnisotropy:void 0}},e.prototype.load=function(t,n){if(c.isSome(this.glTexture))return this.glTexture;if(c.isSome(this.loadingPromise))return this.loadingPromise;var i=this.data;return c.isNone(i)?(this.glTexture=new y(t,this.createDescriptor(t),null),t.bindTexture(this.glTexture),this.glTexture):"string"==typeof i?this.loadFromURL(t,n,i):i instanceof Image?this.loadFromImageElement(t,n,i):i instanceof HTMLVideoElement?this.loadFromVideoElement(t,n,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this.loadFromImage(t,i,n):(u.isArrayBuffer(i)||u.isUint8Array(i))&&this.params.encoding===e.DDS_ENCODING?this.loadFromDDSData(t,i):u.isUint8Array(i)?this.loadFromPixelData(t,i):u.isArrayBuffer(i)?this.loadFromPixelData(t,new Uint8Array(i)):(r.neverReachedSilent(i),null)},Object.defineProperty(e.prototype,"requiresFrameUpdates",{get:function(){return this.data instanceof HTMLVideoElement},enumerable:!1,configurable:!0}),e.prototype.frameUpdate=function(e,t,n){if(!(this.data instanceof HTMLVideoElement)||c.isNone(this.glTexture))return n;if(this.data.readyState<2||n===this.data.currentTime)return n;if(c.isSome(this.powerOfTwoStretchInfo)){var r=this.powerOfTwoStretchInfo,i=r.framebuffer,o=r.vao,a=r.sourceTexture;a.setData(this.data),this.drawStretchedTexture(e,t,i,o,a,this.glTexture)}else{var s=this.data,l=s.width,u=s.height,f=this.glTexture.descriptor,d=f.width,v=f.height;l!==d||u!==v?this.glTexture.updateData(0,0,0,Math.min(l,d),Math.min(u,v),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime},e.prototype.loadFromDDSData=function(e,t){return this.glTexture=p.createDDSTexture(e,this.createDescriptor(e),t,this.params.mipmap),e.bindTexture(this.glTexture),this.glTexture},e.prototype.loadFromPixelData=function(e,t){g.assert(this.params.width>0&&this.params.height>0);var n=this.createDescriptor(e);return n.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,n.width=this.params.width,n.height=this.params.height,this.glTexture=new y(e,n,t),e.bindTexture(this.glTexture),this.glTexture},e.prototype.loadAsync=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i,o=this;return n.__generator(this,(function(n){return t=l.createAbortController(),this.loadingController=t,r=e(t.signal),this.loadingPromise=r,r.then(i=function(){o.loadingController===t&&(o.loadingController=null),o.loadingPromise===r&&(o.loadingPromise=null)},i),[2,r]}))}))},e.prototype.loadFromURL=function(e,t,r){var i=this;return this.loadAsync((function(o){return n.__awaiter(i,void 0,void 0,(function(){var i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,v.requestImage(r,{signal:o})];case 1:return i=n.sent(),[2,this.loadFromImage(e,i,t)]}}))}))}))},e.prototype.loadFromImageElement=function(e,t,r){var i=this;return r.complete?this.loadFromImage(e,r,t):this.loadAsync((function(o){return n.__awaiter(i,void 0,void 0,(function(){var i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,d.loadImageAsync(r,r.src,!1,o)];case 1:return i=n.sent(),[2,this.loadFromImage(e,i,t)]}}))}))}))},e.prototype.loadFromVideoElement=function(e,t,n){return n.readyState>=2?this.loadFromImage(e,n,t):this.loadFromVideoElementAsync(e,t,n)},e.prototype.loadFromVideoElementAsync=function(e,t,n){var r=this;return this.loadAsync((function(o){return l.create((function(a,s){var u=function(){n.removeEventListener("loadeddata",f),n.removeEventListener("error",d),c.isSome(v)&&v.remove()},f=function(){n.readyState>=2&&(u(),a(r.loadFromImage(e,n,t)))},d=function(e){u(),s(e||new i("Failed to load video"))};n.addEventListener("loadeddata",f),n.addEventListener("error",d);var v=l.onAbort(o,(function(){return d(l.createAbortError())}))}))}))},e.prototype.loadFromImage=function(t,n,r){var i=e.getDataDimensions(n);this.params.width=i.width,this.params.height=i.height;var o=this.createDescriptor(t);return o.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(t,o)||s.isPowerOfTwo(i.width)&&s.isPowerOfTwo(i.height)?(o.width=i.width,o.height=i.height,this.glTexture=new y(t,o,n),t.bindTexture(this.glTexture),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(t,n,i,o,r),t.bindTexture(this.glTexture),this.glTexture)},e.prototype.requiresPowerOfTwo=function(e,t){var n="number"==typeof t.wrapMode?33071===t.wrapMode:33071===t.wrapMode.s&&33071===t.wrapMode.t;return!_.default(e.gl)&&(t.hasMipmap||!n)},e.prototype.makePowerOfTwoTexture=function(e,t,n,i,o){var s,c=n.width,l=n.height,u=a.nextHighestPowerOfTwo(c),f=a.nextHighestPowerOfTwo(l);switch(i.width=u,i.height=f,this.params.powerOfTwoResizeMode){case 2:i.textureCoordinateScaleFactor=[c/u,l/f],(s=new y(e,i)).updateData(0,0,0,c,l,t);break;case 1:case null:case void 0:s=this.stretchToPowerOfTwo(e,t,i,o);break;default:r.neverReached(this.params.powerOfTwoResizeMode)}return i.hasMipmap&&s.generateMipmap(),s},e.prototype.stretchToPowerOfTwo=function(e,t,n,r){var i=new y(e,n),o=new b(e,{colorTarget:0,depthStencilTarget:0},i),a=new y(e,{target:3553,pixelFormat:n.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!n.flipped,maxAnisotropy:8,preMultiplyAlpha:n.preMultiplyAlpha},t),s=h.createQuadVAO(e);return this.drawStretchedTexture(e,r,o,s,a,i),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:s,sourceTexture:a,framebuffer:o}:(s.dispose(!0),a.dispose(),o.detachColorTexture(),e.bindFramebuffer(null),o.dispose()),i},e.prototype.drawStretchedTexture=function(e,t,n,r,i,o){e.bindFramebuffer(n);var a=e.getViewport();e.setViewport(0,0,o.descriptor.width,o.descriptor.height);var s=t.program;e.bindProgram(s),s.setUniform4f("color",1,1,1,1),s.setUniform1i("tex",0),e.bindTexture(i,0),e.bindVAO(r),e.setPipelineState(t.pipeline),e.drawArrays(5,0,x.vertexCount(r,"geometry")),e.bindFramebuffer(null),e.setViewport(a.x,a.y,a.width,a.height)},e.prototype.unload=function(){if(c.isSome(this.powerOfTwoStretchInfo)){var e=this.powerOfTwoStretchInfo,t=e.framebuffer,n=e.sourceTexture;e.vao.dispose(!0),n.dispose(),t.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if(c.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),c.isSome(this.loadingController)){var r=this.loadingController;this.loadingController=null,this.loadingPromise=null,r.abort()}this.events.emit("unloaded")},e.idGen=new m.IdGen,e.DDS_ENCODING="image/vnd-ms.dds",e}()}).apply(null,r))||(e.exports=i)},ys4y:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n("3RHn"),n("+nCE"),n("W0kZ"),n("CIy2"),n("CIy2")],void 0===(i=(function(e,t,n,r,i,o,a){"use strict";return function(){function e(t,n,r){this._boundingInfo=null,this._id=e.__idGen.gen(n),this._data=t,this._boundingInfo=r}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),e.prototype.getIndices=function(e){return this.data.getIndices(e)},Object.defineProperty(e.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!1,configurable:!0}),e.prototype.getAttribute=function(e){return this.data.getAttribute(e)},Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo},enumerable:!1,configurable:!0}),e.prototype.computeAttachmentOrigin=function(e){return"triangle"===this.data.primitiveType?this.computeAttachmentOriginTriangles(e):this.computeAttachmentOriginPoints(e)},e.prototype.computeAttachmentOriginTriangles=function(e){var t=this.getIndices(a.VertexAttrConstants.POSITION),n=this.getAttribute(a.VertexAttrConstants.POSITION);return r.computeAttachmentOriginTriangles(n,t,e)},e.prototype.computeAttachmentOriginPoints=function(e){var t=this.getIndices(a.VertexAttrConstants.POSITION),n=this.getAttribute(a.VertexAttrConstants.POSITION);return r.computeAttachmentOriginPoints(n,t,e)},e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null},e.prototype._calculateBoundingInfo=function(){var e=this.data.getIndices(a.VertexAttrConstants.POSITION),t=this.data.getAttribute(a.VertexAttrConstants.POSITION),i="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(i);for(var s=0;s<i;++s)e[s]=s}var c=e.length;o.assert(c%i==0,"Indexing error: "+c.toFixed(0)+" not divisible by "+i.toFixed(0));var l=r.generateDefaultIndexArray(c/i);return new n(l,i,e,t)},e.__idGen=new i.IdGen,e}()}).apply(null,r))||(e.exports=i)},zZCp:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pos2Tex=t.Pos2=t.Pos3Col=t.Pos3NormalTex=t.Pos3Tex=t.Pos3=void 0,t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}).apply(null,r))||(e.exports=i)}}]);