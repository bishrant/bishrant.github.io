(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{"64Oa":function(e,t,i){"use strict";i.r(t);var r=i("srIe"),s=i("6S2I"),n=i("zlDU"),o=i("KLE9"),l=i("kYAx"),a=i("xk++"),u=i("Hu/a"),c=i("Klsb"),f=i("q7ja"),h=i("DJok");const d=s.a.getLogger("esri.views.2d.layers.features.support.whereUtils"),p={getAttribute:(e,t)=>e.field(t)},y=s.a.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter");t.default=class{constructor(e){this._geometryBounds=Object(l.g)(),this._idToVisibility=new Map,this._serviceInfo=e}get hash(){return this._hash}check(e){return this._applyFilter(e)}clear(){const e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}invalidate(){this._idToVisibility.forEach((e,t)=>{this._idToVisibility.set(t,0)})}setKnownIds(e){for(const t of e)this._idToVisibility.set(t,1)}setTrue(e){const t=[],i=[],r=new Set(e);return this._idToVisibility.forEach((e,s)=>{const n=!!(1&this._idToVisibility.get(s)),o=r.has(s);!n&&o?t.push(s):n&&!o&&i.push(s),this._idToVisibility.set(s,o?3:0)}),{show:t,hide:i}}createQuery(){const{geometry:e,spatialRel:t,where:i,timeExtent:r,objectIds:s}=this;return a.a.fromJSON({geometry:e,spatialRel:t,where:i,timeExtent:r,objectIds:s})}async update(e,t){this._hash=JSON.stringify(e);const i=await Object(u.e)(e,null,t);await Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(e){if(!e||!e.where)return this._clause=null,void(this.where=null);this._clause=await async function(e,t){const r=await i.e(6).then(i.bind(null,"ZqIb"));try{const i=r.WhereClause.create(e,t);if(!i.isStandardized){const e=new n.a("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",i);d.error(e)}return e=>{const t=e.readArcadeFeature();return i.testFeature(t,p)}}catch(s){return d.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",e),e=>!0}}(e.where,this._serviceInfo.fieldsIndex),this.where=e.where}_setIdFilter(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}async _setGeometryFilter(e){if(!e||!e.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const t=e.geometry,i=e.spatialRel||"esriSpatialRelIntersects",r=await Object(c.c)(i,t,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);Object(o.a)(this._geometryBounds,t),this._spatialQueryOperator=r,this.geometry=t,this.spatialRel=i}_setTimeFilter(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=Object(f.b)(this._serviceInfo.timeInfo,e.timeExtent,h.b);else{const t=new n.a("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);y.error(t)}}_applyFilter(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}_filterByExpression(e){return!this.where||this._clause(e)}_filterById(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;const t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}_filterByTime(e){return!Object(r.k)(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){const e=[];return this._idToVisibility.forEach((t,i)=>{1&t||(this._idToVisibility.set(i,1),e.push(i))}),e}}},"Hu/a":function(e,t,i){"use strict";i.d(t,"a",function(){return p}),i.d(t,"b",function(){return j}),i.d(t,"c",function(){return _}),i.d(t,"d",function(){return O}),i.d(t,"e",function(){return S}),i.d(t,"f",function(){return w});var r=i("srIe"),s=i("+opI"),n=i("f4Nx"),o=i("+NQI"),l=i("qatw"),a=i("gEht"),u=i("qNUd"),c=i("gVKr"),f=i("ZlUD"),h=(i("2X7Z"),i("HsO1"));const d=new s.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),p=Object.freeze({}),y=new c.a,m=new c.a,b=new c.a,g={esriGeometryPoint:f.m,esriGeometryPolyline:f.o,esriGeometryPolygon:f.n,esriGeometryMultipoint:f.l};function w(e,t,i,r=e.hasZ,s=e.hasM){const n=e.hasZ&&r,o=e.hasM&&s;if(i){const l=Object(f.u)(b,t,e.hasZ,e.hasM,"esriGeometryPoint",i,r,s);return Object(f.m)(l,n,o)}return Object(f.m)(t,n,o)}function _(e,t,i,r,s,n,o=t,l=i){const a=t&&o,u=i&&l,c=r?"coords"in r?r:r.geometry:null;if(!c)return null;if(s){let r=Object(f.q)(m,c,t,i,e,s,o,l);return n&&(r=Object(f.u)(b,r,a,u,e,n)),g[e](r,a,u)}if(n){const r=Object(f.u)(b,c,t,i,e,n,o,l);return g[e](r,a,u)}return Object(f.x)(y,c,t,i,o,l),g[e](y,a,u)}async function O(e,t,i){const{outFields:r,orderByFields:s,groupByFieldsForStatistics:n,outStatistics:o}=e;if(r)for(let l=0;l<r.length;l++)r[l]=r[l].trim();if(s)for(let l=0;l<s.length;l++)s[l]=s[l].trim();if(n)for(let l=0;l<n.length;l++)n[l]=n[l].trim();if(o)for(let l=0;l<o.length;l++)o[l].onStatisticField&&(o[l].onStatisticField=o[l].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),S(e,t,i)}async function S(e,t,s){if(!e)return null;let{where:c}=e;if(e.where=c=c&&c.trim(),(!c||/^1 *= *1$/.test(c)||t&&t===c)&&(e.where=null),!e.geometry)return e;let f=await async function(e){const{geometry:t,distance:r,units:s}=e;if(null==r||"vertexAttributes"in t)return t;const o=t.spatialReference,l=s?d.fromJSON(s):Object(a.h)(o),u=o&&(Object(n.f)(o)||Object(n.m)(o))?t:await Object(h.a)(o,n.a).then(()=>Object(h.b)(t,n.a));return(await async function(){return(await Promise.all([i.e(0),i.e(20)]).then(i.bind(null,"AKzY"))).geodesicBuffer}())(u.spatialReference,u,r,l)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;f=Object(o.a)(f),f.spatialReference=t}e.geometry=f,await Object(h.a)(f.spatialReference,s);const y=(await Object(u.a)(Object(l.a)(f)))[0];if(Object(r.j)(y))throw p;const m=y.toJSON(),b=await Object(h.b)(m,m.spatialReference,s);if(!b)throw p;return b.spatialReference=s,e.geometry=b,e}function j(e){return e&&R in e?JSON.parse(JSON.stringify(e,I)):e}const R="_geVersion",I=(e,t)=>e!==R?t:void 0},Klsb:function(e,t,i){"use strict";i.d(t,"a",function(){return O}),i.d(t,"b",function(){return _}),i.d(t,"c",function(){return w});var r=i("zlDU"),s=i("f4Nx"),n=i("IXLn"),o=i("PNY3"),l=i("qatw"),a=i("gVKr"),u=i("ZlUD");function c(e,t){return e?t?4:3:t?3:2}function f(e,t,i,r,s){if(!e)return!1;const n=c(t,i),{coords:o,lengths:l}=e;let a=!1,u=0;for(const c of l)a=h(a,o,n,u,c,r,s),u+=c*n;return a}function h(e,t,i,r,s,n,o){let l=e,a=r;for(let u=r,c=r+s*i;u<c;u+=i){a=u+i,a===c&&(a=r);const e=t[u],s=t[u+1],f=t[a],h=t[a+1];(s<o&&h>=o||h<o&&s>=o)&&e+(o-s)/(h-s)*(f-e)<n&&(l=!l)}return l}var d=i("HsO1"),p=i("Hu/a");const y={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},m={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},b={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},g={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function w(e,t,r,s,h){if(Object(l.g)(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=Object(u.g)(new a.a,t,!1,!1);return Promise.resolve(t=>function(e,t,i,r){return f(e,!1,!1,r.coords[0],r.coords[1])}(e,0,0,t))}if(Object(l.g)(t)&&"esriGeometryMultipoint"===r){const i=Object(u.g)(new a.a,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve(e=>function(e,t,i,r,s,n){const o=c(s,n),{coords:l,lengths:a}=r;if(!a)return!1;for(let u=0,c=0;u<a.length;u++,c+=o)if(!f(e,!1,!1,l[c],l[c+1]))return!1;return!0}(i,0,0,e,s,h))}if(Object(l.d)(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve(e=>Object(n.e)(t,Object(p.c)(r,s,h,e)));if(Object(l.d)(t)&&"esriGeometryMultipoint"===r&&"esriSpatialRelContains"===e)return Promise.resolve(e=>Object(n.d)(t,Object(p.c)(r,s,h,e)));if(Object(l.d)(t)&&"esriSpatialRelIntersects"===e){const e=Object(o.b)(r);return Promise.resolve(i=>e(t,Object(p.c)(r,s,h,i)))}return Promise.all([i.e(0),i.e(20)]).then(i.bind(null,"AKzY")).then(i=>{const n=i[y[e]].bind(null,t.spatialReference,t);return e=>n(Object(p.c)(r,s,h,e))})}async function _(e,t,i){const{spatialRel:n,geometry:o}=e;if(o){if(!0!==m[n])throw new r.a("feature-store:unsupported-query","Unsupported query spatial relationship",{query:e});if(Object(s.i)(o.spatialReference)&&Object(s.i)(i)){if(a=o,!0!==b[Object(l.c)(a)])throw new r.a("feature-store:unsupported-query","Unsupported query geometry type",{query:e});if(!function(e){return!0===g[e]}(t))throw new r.a("feature-store:unsupported-query","Unsupported layer geometry type",{query:e});if(e.outSR)return Object(d.a)(e.geometry&&e.geometry.spatialReference,e.outSR)}}var a}function O(e){if(Object(l.d)(e))return!0;if(Object(l.g)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},q7ja:function(e,t,i){"use strict";function r(e,t){if(!e)return null;const i=t.featureAdapter,{startTimeField:r,endTimeField:s}=e;let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(r&&s)t.forEach(e=>{const t=i.getAttribute(e,r),l=i.getAttribute(e,s);null==t||isNaN(t)||(n=Math.min(n,t)),null==l||isNaN(l)||(o=Math.max(o,l))});else{const e=r||s;t.forEach(t=>{const r=i.getAttribute(t,e);null==r||isNaN(r)||(n=Math.min(n,r),o=Math.max(o,r))})}return{start:n,end:o}}function s(e,t,i){if(!t||!e)return null;const{startTimeField:r,endTimeField:s}=e;if(!r&&!s)return null;const{start:n,end:o}=t;return null===n&&null===o?null:void 0===n&&void 0===o?()=>!1:r&&s?function(e,t,i,r,s){return null!=r&&null!=s?n=>{const o=e.getAttribute(n,t),l=e.getAttribute(n,i);return(null==o||o<=s)&&(null==l||l>=r)}:null!=r?t=>{const s=e.getAttribute(t,i);return null==s||s>=r}:null!=s?i=>{const r=e.getAttribute(i,t);return null==r||r<=s}:void 0}(i,r,s,n,o):function(e,t,i,r){return null!=i&&null!=r&&i===r?r=>e.getAttribute(r,t)===i:null!=i&&null!=r?s=>{const n=e.getAttribute(s,t);return n>=i&&n<=r}:null!=i?r=>e.getAttribute(r,t)>=i:null!=r?i=>e.getAttribute(i,t)<=r:void 0}(i,r||s,n,o)}i.d(t,"a",function(){return r}),i.d(t,"b",function(){return s})}}]);