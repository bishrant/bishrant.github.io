(function(){(this||window).webpackJsonp.registerAbsMids({"arcgis-js-api/views/layers/support/Path":"20TT","arcgis-js-api/views/2d/layers/LayerView2D":"6i4F","arcgis-js-api/views/layers/support/ClipRect":"7MXx","arcgis-js-api/views/2d/engine/vectorTiles/GlyphMosaic":"7wYu","esri/core/requireUtils":"ADZV","arcgis-js-api/core/requireUtils":"ADZV","arcgis-js-api/views/2d/engine/vectorTiles/TileHandler":"BEij","arcgis-js-api/layers/support/TilemapCache":"Cobz","arcgis-js-api/views/2d/engine/vectorTiles/RenderBucket":"KyfE","arcgis-js-api/views/2d/engine/vectorTiles/RectangleBinPack":"VIUv","arcgis-js-api/views/2d/engine/vectorTiles/VectorTile":"VjU6","arcgis-js-api/views/layers/LayerView":"WsO6","arcgis-js-api/views/2d/tiling/TileInfoViewPOT":"YOjP","arcgis-js-api/core/ItemCache":"ZHL0","esri/core/ItemCache":"ZHL0","arcgis-js-api/views/layers/support/ClipArea":"ZMIQ","arcgis-js-api/views/2d/engine/vectorTiles/FadeRecorder":"hwgr","arcgis-js-api/views/2d/engine/vectorTiles/SpriteMosaic":"mFzi","arcgis-js-api/views/2d/engine/vectorTiles/TileIndex":"soIt","arcgis-js-api/views/2d/engine/vectorTiles/GlyphSource":"suOV","arcgis-js-api/views/layers/support/Geometry":"ts8o","arcgis-js-api/views/2d/engine/vectorTiles/VectorTileContainer":"uf/D","arcgis-js-api/views/2d/layers/VectorTileLayerView2D":"xkJJ","arcgis-js-api/layers/support/Tilemap":"xojL"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{"20TT":function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("qKT0"),i("9opi"),i("Vx27"),i("ZMIQ")],void 0===(n=(function(e,t,i,r,n,a){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="path",t.path=[],t}return r(t,e),Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),i([n.property({type:[[[Number]]],json:{write:!0}})],t.prototype,"path",void 0),i([n.property({readOnly:!0,dependsOn:["path"]})],t.prototype,"version",null),i([n.subclass("esri.views.layers.support.Path")],t)}(n.declared(a))}).apply(null,r))||(e.exports=n)},"6i4F":function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("9opi"),i("qKT0"),i("y4WC"),i("K2Kz"),i("8MXS"),i("Vx27"),i("ZMIQ"),i("7MXx"),i("ts8o"),i("20TT")],void 0===(n=(function(e,t,i,r,n,a,o,s,l,u,c,h){Object.defineProperty(t,"__esModule",{value:!0});var p=n.ofType({key:"type",base:l,typeMap:{rect:u,path:h,geometry:c}});t.LayerView2D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clips=new p,t.moving=!1,t.attached=!1,t.lastUpdateId=-1,t.updateRequested=!1,t}return i(t,e),t.prototype.initialize=function(){var e=this;this.when((function(){e.requestUpdate()}),(function(){}));var t=function(){return e.notifyChange("rendering")};this.handles.add([o.init(this,"suspended",(function(t){e.container&&(e.container.visible=!t),e.view&&!t&&e.updateRequested&&e.view.requestLayerViewUpdate(e)}),!0),o.init(this,["fullOpacity","container"],(function(){e.container&&(e.container.opacity=e.fullOpacity)}),!0),o.on(this,"container","post-render",t),o.on(this,"container","will-render",t)])},t.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach()),this.handles.remove("initialize"),this.updateRequested=!1,this.layer=null,this.view=null},Object.defineProperty(t.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0}),t.prototype.isVisibleAtScale=function(e){var t=!0,i=this.layer,r=i.minScale,n=i.maxScale;if(null!=r&&null!=n){var a=!r,o=!n;!a&&e<=r&&(a=!0),!o&&e>=n&&(o=!0),t=a&&o}return t},t.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))},t.prototype.processUpdate=function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1},t.prototype.isUpdating=function(){return!1},t.prototype.isRendering=function(){return!1},t.prototype.canResume=function(){var e=this.inherited(arguments);return e&&(e=this.isVisibleAtScale(this.view.scale)),e},r([s.property({type:p,set:function(e){var t=a.referenceSetter(e,this._get("clips"),p);this._set("clips",t)}})],t.prototype,"clips",void 0),r([s.property()],t.prototype,"moving",void 0),r([s.property({dependsOn:["attached","suspended","moving"]})],t.prototype,"rendering",null),r([s.property()],t.prototype,"attached",void 0),r([s.property()],t.prototype,"container",void 0),r([s.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),r([s.property({readOnly:!0})],t.prototype,"updateParameters",void 0),r([s.property()],t.prototype,"updateRequested",void 0),r([s.property({dependsOn:["updateRequested","attached","suspended"]})],t.prototype,"updating",null),r([s.property()],t.prototype,"view",void 0),r([s.subclass("esri.views.2d.layers.LayerView2D")],t)}(s.declared(e))}}).apply(null,r))||(e.exports=n)},"7MXx":function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("qKT0"),i("9opi"),i("Vx27"),i("ZMIQ")],void 0===(n=(function(e,t,i,r,n,a){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="rect",t.left=null,t.right=null,t.top=null,t.bottom=null,t}var a;return r(t,e),a=t,t.prototype.clone=function(){return new a({left:this.left,right:this.right,top:this.top,bottom:this.bottom})},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"left",void 0),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"right",void 0),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"top",void 0),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"bottom",void 0),i([n.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],t.prototype,"version",null),a=i([n.subclass("esri.views.layers.support.ClipRect")],t)}(n.declared(a))}).apply(null,r))||(e.exports=n)},"7wYu":function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("H1tY"),i("qMld"),i("DJpR"),i("VIUv"),i("6cAc")],void 0===(n=(function(e,t,i,r,n,a,o){var s;return function(){function e(e,t,r){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,!s&&i("stable-symbol-rendering")&&(s=new Set),this.width=e,this.height=t,this._glyphSource=r,this._binPack=new a(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(void 0)}return e.prototype.getGlyphItems=function(e,t){for(var n=this,l=[],u=this._glyphSource,c=new Set,h=0,p=t;h<p.length;h++){var f=Math.floor(p[h]*(1/256));c.add(f)}var d=[];return c.forEach((function(t){if(t<=256){var i=e+t;if(n._rangePromises.has(i))d.push(n._rangePromises.get(i));else{var r=u.getRange(e,t).then((function(){n._rangePromises.delete(i)}),(function(){n._rangePromises.delete(i)}));n._rangePromises.set(i,r),d.push(r)}}})),r.all(d).then((function(){var r,h=n._glyphIndex[e];if(h||(n._glyphIndex[e]=h={}),i("stable-symbol-rendering")){s.clear();for(var p=0,f=t;p<f.length;p++)s.add(w=f[p]);var d=[];c.forEach((function(e){d.push(e)})),d.sort(),r=[];for(var y=0,v=d;y<v.length;y++)for(var g=v[y],_=0;_<256;++_)r.push(256*g+_)}else r=t;for(var m=0,b=r;m<b.length;m++){var w,x=h[w=b[m]];if(x)i("stable-symbol-rendering")&&!s.has(w)||(l[w]={sdf:!0,rect:x.rect,metrics:x.metrics,page:x.page});else{var D=u.getGlyph(e,w);if(D&&D.metrics){var T=D.metrics,S=void 0;if(0===T.width)S=new o.default(0,0,0,0);else{var I=T.width+6,P=T.height+6,B=I%4?4-I%4:4,R=P%4?4-P%4:4;1===B&&(B=5),1===R&&(R=5),(S=n._binPack.allocate(I+B,P+R)).isEmpty&&(n._dirties[n._currentPage]||(n._glyphData[n._currentPage]=null),n._currentPage=n._glyphData.length,n._glyphData.push(new Uint8Array(n.width*n.height)),n._dirties.push(!0),n._textures.push(void 0),n._binPack=new a(n.width-4,n.height-4),S=n._binPack.allocate(I+B,P+R));var j=n._glyphData[n._currentPage],V=D.bitmap,C=void 0,M=void 0;if(V)for(var O=0;O<P;O++){C=I*O,M=n.width*(S.y+O+1)+S.x;for(var A=0;A<I;A++)j[M+A+1]=V[C+A]}}h[w]={rect:S,metrics:T,tileIDs:null,page:n._currentPage},i("stable-symbol-rendering")&&!s.has(w)||(l[w]={sdf:!0,rect:S,metrics:T,page:n._currentPage}),n._dirties[n._currentPage]=!0}}}return l}))},e.prototype.removeGlyphs=function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var n in i)if((r=i[n]).tileIDs.delete(e),0===r.tileIDs.size){for(var a=this._glyphData[r.page],o=r.rect,s=void 0,l=void 0,u=0;u<o.height;u++)for(s=this.width*(o.y+u)+o.x,l=0;l<o.width;l++)a[s+l]=0;delete i[n],this._dirties[r.page]=!0}}}},e.prototype.bind=function(e,t,i,r){void 0===r&&(r=0),this._textures[i]||(this._textures[i]=new n.Texture(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var a=this._textures[i];a.setSamplingMode(t),this._dirties[i]&&a.setData(this._glyphData[i]),e.bindTexture(a,r),this._dirties[i]=!1},e.prototype.dispose=function(){this._binPack=null;for(var e=0,t=this._textures;e<t.length;e++){var i=t[e];i&&i.dispose()}this._textures.length=0},e}()}).apply(null,r))||(e.exports=n)},ADZV:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("7bfM"),i("qsST"),i("qMld")],void 0===(n=(function(e,t,i,r,n){Object.defineProperty(t,"__esModule",{value:!0});var a=r.getLogger("esri.core.requireUtils");t.when=function e(t,r){return i.deprecatedFunction(a,"when",{moduleName:"requireUtils",replacement:"Use `promiseUtils.create()` instead.",version:"4.10",warnOnce:!0}),Array.isArray(r)?n.create((function(e){t(r,(function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];e(t)}))})):e(t,[r]).then((function(e){return e[0]}))},t.getAbsMid=function(e,t,i){return t.toAbsMid?t.toAbsMid(e):i.id.replace(/\/[^\/]*$/gi,"/")+e}}).apply(null,r))||(e.exports=n)},BEij:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("2Atf"),i("Q2wQ"),i("HZ3d"),i("zp6E"),i("H1tY"),i("ZHL0"),i("LxLY"),i("r7jh"),i("qMld"),i("ADZV"),i("8V7H"),i("lRq4"),i("VjU6"),i("c9QS"),i("7wYu"),i("suOV"),i("mFzi"),i("soIt"),i("f3JK"),i.dj.m(e)],void 0===(n=(function(e,t,i,r,n,a,o,s,l,u,c,h,p,f,d,y,v,g,_,m,b,w){Object.defineProperty(t,"__esModule",{value:!0});var x=new s(10),D=new Map,T=function(){function t(e,t,i,r,n){this._vectorTileLayer=e,this.devicePixelRatio=t,this.allowUpdates=i,this._container=r,this._memCache=n,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._updateToAbortController=new Map,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map}return t.prototype.destroy=function(){this._updateToAbortController&&this._updateToAbortController.forEach((function(e){return e.abort()})),this._ongoingTileRequests&&this.abortAll(),this._connection&&(this._connection.close(),this._connection=null),this._vectorTileLayer=null,this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)},Object.defineProperty(t.prototype,"spriteMosaic",{get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0}),t.prototype.start=function(t){return n(this,void 0,void 0,(function(){var n,a,s,l,u,f=this;return r(this,(function(r){for(s in a=[],n=this._vectorTileLayer.sourceNameToSource)a.push(this._fetchTileMap(n[s],t));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then((function(e){f._spriteMosaic=new _(1024,1024,250),f._spriteMosaic.setSpriteSource(e),o("stable-symbol-rendering")&&f._spriteMosaic.preloadSpriteItems()})),u=new g((l=this._vectorTileLayer.styleRepository).glyphs),this._glyphMosaic=new v(1024,1024,u),this._broadcastPromise=p.open(h.getAbsMid("../vectorTiles/WorkerTileHandler",e,w),{client:this,scheduler:t.scheduler,signal:t.signal}).then((function(e){return f._connection=e,c.all(f._connection.broadcast("setLayers",l.styleJSON,i({},t)))})),[2,c.all(a)]}))}))},t.prototype.updateStyle=function(){return n(this,void 0,void 0,(function(){var e,t=this;return r(this,(function(i){switch(i.label){case 0:return[4,this._broadcastPromise];case 1:return i.sent(),this._updateToAbortController.forEach((function(e){return e.abort()})),this._updateToAbortController.clear(),e=this._vectorTileLayer.styleRepository,this._broadcastPromise=c.create((function(i,r){c.all(t._connection.broadcast("updateStyle",e.styleJSON)).then(i,r)})),[2,this._broadcastPromise]}}))}))},t.prototype.abortTileUpdate=function(e){this._updateToAbortController.has(e)&&(this._updateToAbortController.get(e).abort(),this._updateToAbortController.delete(e))},t.prototype.updateTile=function(e,t){return n(this,void 0,void 0,(function(){var i,n,a,o,s=this;return r(this,(function(r){switch(r.label){case 0:return this.allowUpdates&&e.isReady?[4,this._broadcastPromise]:[2];case 1:return r.sent(),i=Math.round(y.degToByte(t.state.rotation)),e.rotation===i?[2,null]:(this._updateToAbortController.has((a=e.key).id)&&((n=this._updateToAbortController.get(a.id)).abort(),this._updateToAbortController.delete(a.id)),n=c.createAbortController(),e.rotation=i,o=e.client.invoke("updateSymbols",{key:e.id,rotation:i},{signal:n.signal}).then((function(t){s._updateToAbortController.delete(a.id),e.isReady&&e.updateSymbolData(t)})).catch((function(e){c.isAbortError(e)||s._updateToAbortController.delete(a.id)})),this._updateToAbortController.set(e.id,n),[2,o])}}))}))},t.prototype.updateTileData=function(e){for(var t,i=e.tileId,r=this._container.children,n=0;n<r.length;n++)if((t=r[n]).id===i){t.updateTileData(e.tileData);break}},t.prototype.getVectorTile=function(e,t,i){return n(this,void 0,void 0,(function(){var n,a,o,s,c,h;return r(this,(function(r){switch(r.label){case 0:return n=new b(e,t,i,0),l.isSome(this._memCache)&&(a=this._memCache.get(n.id))?(a.reference(),[2,a]):[4,this._getVectorTileData(n,null)];case 1:return o=r.sent(),l.isSome(this._memCache)&&(s=this._memCache.get(n.id))?(s.reference(),[2,s]):(c=this._vectorTileLayer.tileInfo.getTileBounds(f.create(),n),h=new d.VectorTile(n,this._vectorTileLayer.styleRepository,c,[512,512]),o&&o.tileData?(h.setData(o.tileData,o.client),l.isSome(this._memCache)&&(h.reference(),this._memCache.put(h.key.id,h,h.getMemoryUsage()*h.referenced,u.MIN_PRIORITY))):h.setData(null,null),[2,h])}}))}))},t.prototype.releaseVectorTile=function(e){l.isNone(this._memCache)||e.release()||this._memCache.updateSize(e.key.id,e,e.getMemoryUsage()*e.referenced)},t.prototype.fetchTileData=function(e,t){return n(this,void 0,void 0,(function(){var i,n,a;return r(this,(function(r){switch(r.label){case 0:return[4,this._getRefKeys(e,t)];case 1:for(a in i=r.sent(),n=[],this._vectorTileLayer.sourceNameToSource)n.push(a);return[2,this._getSourcesData(n,i,t)]}}))}))},t.prototype.parseTileData=function(e,t,a){return n(this,void 0,void 0,(function(){var n,s,l,u,c,h,p,f;return r(this,(function(r){switch(r.label){case 0:return(n=e&&e.data)?(s=n.sourceName2DataAndRefKey,l=n.transferList,0===Object.keys(s).length?[2,null]:[4,this._broadcastPromise]):[2,null];case 1:return r.sent(),u=Math.round(y.degToByte(t)),[4,(c=this._connection.getAvailableClient()).invoke("createTileAndParse",{key:e.key.id,rotation:u,cacheTile:this.allowUpdates,sourceName2DataAndRefKey:s},i({},a,{transferList:l})).catch((function(){return c.invoke("destructTileData",e.key.id),null}))];case 2:if(h=r.sent(),o("esri-vector-tiles-debug")){for(f in p={},s)p[f]=s[f].refKey;return[2,{tileData:h,client:c,refKeys:p}]}return[2,{tileData:h,client:c}]}}))}))},Object.defineProperty(t.prototype,"updating",{get:function(){return this._ongoingTileRequests.size>0},enumerable:!0,configurable:!0}),t.prototype.abortAll=function(){this._ongoingRequestToController.forEach((function(e){return e.abort()})),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()},t.prototype.getSprites=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this._spriteSourcePromise];case 1:return t.sent(),[2,this._spriteMosaic.getSpriteItems(e)]}}))}))},t.prototype.getGlyphs=function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)},t.prototype.getStyleRepository=function(){return this._vectorTileLayer.styleRepository},t.prototype._getTilePayload=function(e,t,o){return n(this,void 0,void 0,(function(){var n,s;return r(this,(function(r){switch(r.label){case 0:return n=b.pool.acquire(e.id),s=this._vectorTileLayer.sourceNameToSource[t].getSourceTileUrl(n.level,n.row,n.col),b.pool.release(n),[4,a(s,i({responseType:"array-buffer"},o))];case 1:return[2,{protobuff:r.sent().data,sourceName:t}]}}))}))},t.prototype._fetchTileMap=function(e,t){if(e.capabilities.operations.supportsTileMap&&e.tileIndex)return c.resolve();if(!e.tileMapURL)return c.resolve();var i=x.get(e.tileMapURL);if(i)return e.tileIndex=i,c.resolve();if(D.has(e.tileMapURL))return D.get(e.tileMapURL).then((function(t){e.tileIndex=new m(t.data)}));var r=a(e.tileMapURL,t);return r.then((function(t){e.tileIndex=new m(t.data),D.delete(e.tileMapURL),x.put(e.tileMapURL,e.tileIndex)})),D.set(e.tileMapURL,r),r},t.prototype._getRefKeys=function(e,t){return n(this,void 0,void 0,(function(){var i,n,a,o;return r(this,(function(r){for(a in i=this._vectorTileLayer.sourceNameToSource,n=new Array,i)o=i[a].getRefKey(e,t),n.push(o);return[2,c.eachAlways(n)]}))}))},t.prototype._getSourcesData=function(e,t,i){return n(this,void 0,void 0,(function(){var n,a,o,s,l,u;return r(this,(function(r){switch(r.label){case 0:for(n=[],u=0;u<t.length;u++)null==t[u].value||null==e[u]?n.push(null):(a=this._getTilePayload(t[u].value,e[u],i),n.push(a));return[4,c.eachAlways(n)];case 1:for(o=r.sent(),s={},l=[],u=0;u<o.length;u++)o[u].value&&o[u].value&&o[u].value.protobuff&&o[u].value.protobuff.byteLength>0&&(s[o[u].value.sourceName]={refKey:t[u].value.id,protobuff:o[u].value.protobuff},l.push(o[u].value.protobuff));return[2,{sourceName2DataAndRefKey:s,transferList:l}]}}))}))},t.prototype._getVectorTileData=function(e,t){return n(this,void 0,void 0,(function(){var i,n,a,o,s=this;return r(this,(function(r){return this._ongoingTileRequests.has(i=e.id)?[2,this._ongoingTileRequests.get(i)]:(n=new AbortController,a=t&&t.signal,o=this._getParsedVectorTileData(e,{signal:n.signal}).then((function(e){return s._ongoingTileRequests.delete(i),s._ongoingRequestToController.delete(i),e})).catch((function(){return s._ongoingTileRequests.delete(i),s._ongoingRequestToController.delete(i),null})),this._ongoingTileRequests.set(i,o),this._ongoingRequestToController.set(i,n),a&&c.onAbort(a,(function(){n.abort(),s._ongoingTileRequests.delete(i),s._ongoingRequestToController.delete(i)})),[2,o])}))}))},t.prototype._getParsedVectorTileData=function(e,t){return n(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return[4,this.fetchTileData(e,t)];case 1:return i=r.sent(),[2,this.parseTileData({key:e,data:i},0,t)]}}))}))},t}();t.TileHandler=T}).apply(null,r))||(e.exports=n)},Cobz:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("2Atf"),i("9opi"),i("qKT0"),i("Q2wQ"),i("HZ3d"),i("zp6E"),i("Gtr7"),i("ma1f"),i("eIBl"),i("qsST"),i("W6K4"),i("KBgh"),i("qMld"),i("afW+"),i("jfWY"),i("8MXS"),i("Vx27"),i("xojL")],void 0===(n=(function(e,t,i,r,n,a,o,s,l,u,c,h,p,f,d,y,v,g,_,m){Object.defineProperty(t,"__esModule",{value:!0}),t.TILEMAP_SIZE_EXP=5;var b=h.getLogger("esri.layers.support.TilemapCache"),w=function(e){function l(t){var i=e.call(this,t)||this;return i._handles=new c,i._pendingTilemapRequests={},i._availableLevels={},i.levels=5,i.cacheByteSize=2097152,i.request=s,i._prefetchingEnabled=!0,i}var h;return r(l,e),h=l,l.prototype.initialize=function(){var e=this;this._tilemapCache=new p(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(function(){return e._initializeTilemapDefinition()})),g.init(this,"layer.tileInfo.lods",(function(t){return e._initializeAvailableLevels(t)}),!0)]),this._initializeTilemapDefinition()},l.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},l.prototype.castLevels=function(e){return e<=2?(b.error("Minimum levels for Tilemap is 3, but got ",e),3):e},Object.defineProperty(l.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0}),l.prototype.fetchTilemap=function(e,t,r,n){var a=this;if(!this._availableLevels[e])return d.reject(new u("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"));var o=this._tmpTilemapDefinition,s=this._tilemapFromCache(e,t,r,o);if(s)return d.resolve(s);var l=n&&n.signal;return n=i({},n,{signal:null}),d.create((function(e,t){d.onAbort(l,(function(){return t(d.createAbortError())}));var i=m.tilemapDefinitionId(o),r=a._pendingTilemapRequests[i];if(!r){r=m.Tilemap.fromDefinition(o,n).then((function(e){return a._tilemapCache.put(i,e,e.byteSize),e}));var s=function(){return delete a._pendingTilemapRequests[i]};a._pendingTilemapRequests[i]=r,r.then(s,s)}r.then(e,t)}))},l.prototype.getAvailability=function(e,t,i){if(!this._availableLevels[e])return"unavailable";var r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"},l.prototype.getAvailabilityUpsample=function(e,t,i,r){r.level=e,r.row=t,r.col=i;var n=this.layer.tileInfo;for(n.updateTileInfo(r);;){var a=this.getAvailability(r.level,r.row,r.col);if("unavailable"!==a)return a;if(!n.upsampleTile(r))return"unavailable"}},l.prototype.fetchAvailability=function(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch((function(e){return e})).then((function(r){if(r instanceof m.Tilemap){var n=r.getAvailability(t,i);return"unavailable"===n?d.reject(new u("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):n}if(d.isAbortError(r))throw r;return"unknown"})):d.reject(new u("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"))},l.prototype.fetchAvailabilityUpsample=function(e,t,i,r,n){var a=this;r.level=e,r.row=t,r.col=i;var o=this.layer.tileInfo;o.updateTileInfo(r);var s=this.fetchAvailability(e,t,i,n).catch((function(e){if(d.isAbortError(e))throw e;if(o.upsampleTile(r))return a.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e}));return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,n,s),s},l.prototype._fetchAvailabilityUpsamplePrefetch=function(e,t,r,n,s,l){return o(this,void 0,void 0,(function(){var o,u,c,p,f,v,g,_,m;return a(this,(function(a){switch(a.label){case 0:if(!this._prefetchingEnabled)return[2];if(this._handles.has(o="prefetch-"+e))return[2];u=d.createAbortController(),l.then((function(){return u.abort()}),(function(){return u.abort()})),c=!1,this._handles.add({remove:function(){c||(c=!0,u.abort())}},o),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,y.waitTicks(10,u.signal)];case 2:case 3:return a.sent(),[3,4];case 4:if(c||(c=!0,this._handles.remove(o)),d.isAborted(u))return[2];for(p={id:e,level:t,row:r,col:n},f=i({},s,{signal:u.signal}),v=this.layer.tileInfo,g=function(e){var t=_.fetchAvailability(p.level,p.row,p.col,f);h._prefetches.push(t);var i=function(){h._prefetches.removeUnordered(t)};t.then(i,i)},_=this,m=0;h._prefetches.length<h._maxPrefetch&&v.upsampleTile(p);++m)g();return[2]}}))}))},l.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?v.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}},l.prototype._tilemapFromCache=function(e,t,i,r){var n=this._getTilemapDefinition(e,t,i,r),a=m.tilemapDefinitionId(n);return this._tilemapCache.get(a)},l.prototype._getTilemapDefinition=function(e,i,r,n){n.level=e;var a=e>t.TILEMAP_SIZE_EXP;return n.row=a?i-i%this.size:i,n.col=a?r-r%this.size:r,n},l.prototype._initializeAvailableLevels=function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))},Object.defineProperty(l.prototype,"test",{get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,i,r){return!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0}),l._maxPrefetch=4,l._prefetches=new f({initialSize:h._maxPrefetch}),n([_.property({constructOnly:!0,type:Number})],l.prototype,"levels",void 0),n([_.cast("levels")],l.prototype,"castLevels",null),n([_.property({readOnly:!0,dependsOn:["levels"],type:Number})],l.prototype,"size",null),n([_.property({constructOnly:!0,type:Number})],l.prototype,"cacheByteSize",void 0),n([_.property({constructOnly:!0})],l.prototype,"layer",void 0),n([_.property({constructOnly:!0})],l.prototype,"request",void 0),h=n([_.subclass("esri.layers.support.TilemapCache")],l)}(_.declared(l));t.TilemapCache=w}).apply(null,r))||(e.exports=n)},KyfE:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("xhoE")],void 0===(n=(function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.type=e};t.RenderBucket=r;var n=function(e){function t(){var t=e.call(this,2)||this;return t.triangleElementStart=0,t.triangleElementCount=0,t}return i(t,e),t.prototype.hasData=function(){return this.triangleElementCount>0},t.prototype.triangleCount=function(){return this.triangleElementCount/3},t}(r);t.LineRenderBucket=n;var a=function(e){function t(){var t=e.call(this,1)||this;return t.triangleElementStart=0,t.triangleElementCount=0,t.outlineElementStart=0,t.outlineElementCount=0,t}return i(t,e),t.prototype.hasData=function(){return this.triangleElementCount>0||this.outlineElementCount>0},t.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3},t}(r);t.FillRenderBucket=a;var o=function(e){function t(){var t=e.call(this,3)||this;return t.iconPerPageElementsMap=new Map,t.glyphPerPageElementsMap=new Map,t.isSDF=!1,t}return i(t,e),t.prototype.hasData=function(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0},t.prototype.triangleCount=function(){var e=0;return this.iconPerPageElementsMap.forEach((function(t){e+=t[1]})),this.glyphPerPageElementsMap.forEach((function(t){e+=t[1]})),e/3},t}(r);t.SymbolRenderBucket=o;var s=function(e){function t(){var t=e.call(this,4)||this;return t.triangleElementStart=0,t.triangleElementCount=0,t}return i(t,e),t.prototype.hasData=function(){return this.triangleElementCount>0},t.prototype.triangleCount=function(){return this.triangleElementCount/3},t}(r);t.CircleRenderBucket=s;var l=function(e){function t(){return e.call(this,0)||this}return i(t,e),t.prototype.hasData=function(){return!0},t.prototype.triangleCount=function(){return 2},t}(r);t.BackgroundRenderBucket=l}).apply(null,r))||(e.exports=n)},VIUv:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("6cAc")],void 0===(n=(function(e,t,i){return function(){function e(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new i.default(0,0,e,t))}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.allocate=function(e,t){if(e>this._width||t>this._height)return new i.default;for(var r=null,n=-1,a=0;a<this._free.length;++a){var o=this._free[a];e<=o.width&&t<=o.height&&(null===r||o.y<=r.y&&o.x<=r.x)&&(r=o,n=a)}return null===r?new i.default:(this._free.splice(n,1),r.width<r.height?(r.width>e&&this._free.push(new i.default(r.x+e,r.y,r.width-e,t)),r.height>t&&this._free.push(new i.default(r.x,r.y+t,r.width,r.height-t))):(r.width>e&&this._free.push(new i.default(r.x+e,r.y,r.width-e,r.height)),r.height>t&&this._free.push(new i.default(r.x,r.y+t,e,r.height-t))),new i.default(r.x,r.y,e,t))},e.prototype.release=function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)},e}()}).apply(null,r))||(e.exports=n)},VjU6:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("xhoE"),i("VCyw"),i("DJpR"),i("KyfE"),i("gi5q")],void 0===(n=(function(e,t,i,r,n,a,o){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t,i,r,n){var a=e.call(this,t,r,n,[4096,4096])||this;return a._referenced=0,a._symbolFadeHold=null,a._vectorTileData=null,a._setData=!1,a._symbolUpdateData=null,a._memoryUsed=l,a.rotation=0,a.layerData={},a.status="loading",a._referenced=1,a.styleLayers=i,a.id=t.id,a}return i(t,e),Object.defineProperty(t.prototype,"hasSymbolBuckets",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHoldingForFade",{get:function(){return null!==this._symbolFadeHold},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSymbolFadeDone",{get:function(){return!this._symbolFadeHold||this._symbolFadeHold<r()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wasRequested",{get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status},enumerable:!0,configurable:!0}),t.prototype.setData=function(e,t,i){this._vectorTileData=e,this.client=t,this.refKeys=i,this._memoryUsed=l,this.ready(),this._setData=!0},t.prototype.updateSymbolData=function(e){e&&(this._symbolUpdateData=e,this.requestRender())},t.prototype.updateTileData=function(e){this._vectorTileData=e,this.stage.requestRender(),this._memoryUsed=l},t.prototype.clearSymbolFadeHold=function(){this._symbolFadeHold=null},t.prototype.setSymbolHoldDuration=function(e){this._symbolFadeHold=r()+e},t.prototype.hasData=function(){return Object.keys(this.layerData).length>0},t.prototype.dispose=function(){this._deleteBufferMemory(),this.destroy(),this._memoryUsed=l},t.prototype.release=function(){return 0==--this._referenced&&(this.dispose(),this.attached=!1,this.stage=null,!0)},t.prototype.reference=function(){++this._referenced},Object.defineProperty(t.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0}),t.prototype.getMemoryUsage=function(){var e=this;return this._memoryUsed===l&&(this._memoryUsed=u.reduce((function(t,i){return e[i]?t+e[i].size:t}),0),this.texture&&(this._memoryUsed+=this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce((function(e,t){return e+t.byteLength}),this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength))),this._memoryUsed/(this._referenced||1)},t.prototype.commitChanges=function(){if(this._vectorTileData||this._symbolUpdateData)return this._vectorTileData?(this._deleteBufferMemory(),this._createRenderBuckets(),this._createBufferObjects(),void(this._vectorTileData=null)):void(this._symbolUpdateData&&(this._updateSymbolData(this._symbolUpdateData),this._symbolUpdateData=null))},t.prototype._deleteBufferMemory=function(){for(var e=0,t=["fillVertexArrayObject","fillDDVertexArrayObject","outlineVertexArrayObject","lineVertexArrayObject","lineDDVertexArrayObject","iconVertexArrayObject","iconDDVertexArrayObject","textVertexArrayObject","textDDVertexArrayObject","circleVertexArrayObject","fillVertexBuffer","fillDDVertexBuffer","fillIndexBuffer","outlineVertexBuffer","outlineDDVertexBuffer","outlineIndexBuffer","lineVertexBuffer","lineDDVertexBuffer","lineIndexBuffer","iconVertexBuffer","iconDDVertexBuffer","iconIndexBuffer","textVertexBuffer","textDDVertexBuffer","textIndexBuffer","circleVertexBuffer","circleIndexBuffer","texture"];e<t.length;e++){var i=t[e];this[i]&&(this[i].dispose(),this[i]=null)}this.layerData={},this.triangleCount=0},t.prototype._createRenderBuckets=function(){for(var e=new Uint32Array(this._vectorTileData.bucketDataInfo),t=e.length,i=0;i<t;){var r=e[i];switch(e[i+1]){case 0:(new a.BackgroundRenderBucket).layerID=r,i+=2;break;case 1:var n=new a.FillRenderBucket;n.layerID=r,n.triangleElementStart=e[i+2],n.triangleElementCount=e[i+3],n.outlineElementStart=e[i+4],n.outlineElementCount=e[i+5],0===n.triangleElementCount&&0===n.outlineElementCount||(this.layerData[r]=n),i+=6;break;case 2:var o=new a.LineRenderBucket;o.layerID=r,o.triangleElementStart=e[i+2],o.triangleElementCount=e[i+3],o.triangleElementCount>0&&(this.layerData[r]=o),i+=4;break;case 3:var s=new a.SymbolRenderBucket;s.layerID=r,s.isSDF=0!==e[i+2];var l=i+3,u=e[l];l++;for(var c=0;c<u;c++)s.iconPerPageElementsMap.set(e[l],[e[l+1],e[l+2]]),l+=3;var h=l,p=e[h];for(h++,c=0;c<p;c++)s.glyphPerPageElementsMap.set(e[h],[e[h+1],e[h+2]]),h+=3;(s.iconPerPageElementsMap.size>0||s.glyphPerPageElementsMap.size>0)&&(this.layerData[r]=s),i+=5+3*u+3*p;break;case 4:var f=new a.CircleRenderBucket;f.layerID=r,f.triangleElementStart=e[i+2],f.triangleElementCount=e[i+3],f.triangleElementCount>0&&(this.layerData[r]=f),i+=4;break;default:console.error("Bad bucket type!"),i+=2}}},t.prototype.attach=function(){return this._setData},t.prototype.attachWithContext=function(e){this.stage={context:e},this.attached=this.attach()},t.prototype.detach=function(){this.isReady&&this.client&&this.client.invoke("destructTileData",this.id),this.dispose(),e.prototype.detach.call(this)},t.prototype._updateSymbolData=function(e){if(!e||!e.bucketDataInfo)return!0;var t=new Uint32Array(e.bucketDataInfo),i=t.length;if(0===i)return!0;if(!this.isReady)return this.requestRender(),!1;for(var r=this.stage.context,o=new Uint32Array(e.bufferDataInfo),s=o.length,l=0,u=0;u<s;u+=2,l++)switch(o[u]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null),this.iconVertexBuffer=n.BufferObject.createVertex(r,35044,e.bufferData[l]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null),this.iconDDVertexBuffer=n.BufferObject.createVertex(r,35044,e.bufferData[l]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null),this.iconIndexBuffer=n.BufferObject.createIndex(r,35044,e.bufferData[l]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null),this.textVertexBuffer=n.BufferObject.createVertex(r,35044,e.bufferData[l]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null),this.textDDVertexBuffer=n.BufferObject.createVertex(r,35044,e.bufferData[l]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=n.BufferObject.createIndex(r,35044,e.bufferData[l])}var c={};for(var h in this.layerData)3!==this.layerData[h].type&&(c[h]=this.layerData[h]);this.layerData=c;for(var p,f=this.styleLayers.layers,d=0;d<i;){h=t[d],(p=new a.SymbolRenderBucket).layerID=h,p.isSDF=0!==t[d+2],f.length>p.layerID&&f[p.layerID].type===p.type&&(c[p.layerID]=p);var y=d+3,v=t[y];y++;for(var g=0;g<v;g++)p.iconPerPageElementsMap.set(t[y],[t[y+1],t[y+2]]),y+=3;var _=y,m=t[_];for(_++,g=0;g<m;g++)p.glyphPerPageElementsMap.set(t[_],[t[_+1],t[_+2]]),_+=3;d+=5+3*v+3*m}return this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null),this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null),this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null),this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null),!0},t._createBufferToObject=function(){var e=[];return e[1]={create:n.BufferObject.createVertex,var:"fillVertexBuffer"},e[2]={create:n.BufferObject.createVertex,var:"fillDDVertexBuffer"},e[3]={create:n.BufferObject.createIndex,var:"fillIndexBuffer"},e[4]={create:n.BufferObject.createVertex,var:"outlineVertexBuffer"},e[5]={create:n.BufferObject.createVertex,var:"outlineDDVertexBuffer"},e[6]={create:n.BufferObject.createIndex,var:"outlineIndexBuffer"},e[7]={create:n.BufferObject.createVertex,var:"lineVertexBuffer"},e[8]={create:n.BufferObject.createVertex,var:"lineDDVertexBuffer"},e[9]={create:n.BufferObject.createIndex,var:"lineIndexBuffer"},e[10]={create:n.BufferObject.createVertex,var:"iconVertexBuffer"},e[11]={create:n.BufferObject.createVertex,var:"iconDDVertexBuffer"},e[12]={create:n.BufferObject.createIndex,var:"iconIndexBuffer"},e[13]={create:n.BufferObject.createVertex,var:"textVertexBuffer"},e[14]={create:n.BufferObject.createVertex,var:"textDDVertexBuffer"},e[15]={create:n.BufferObject.createIndex,var:"textIndexBuffer"},e[16]={create:n.BufferObject.createVertex,var:"circleVertexBuffer"},e[17]={create:n.BufferObject.createIndex,var:"circleIndexBuffer"},e},t.prototype._createBufferObjects=function(){for(var e=this.stage.context,i=new Uint32Array(this._vectorTileData.bufferDataInfo),r=i.length,n=0;n<r;n+=2){var a=n/2;if(!(i[n+1]<=0||0===this._vectorTileData.bufferData[a].byteLength)){var o=i[n],s=t.bufferToObject[o];s?this[s.var]?this[s.var].setData(this._vectorTileData.bufferData[a]):this[s.var]=s.create(e,35044,this._vectorTileData.bufferData[a]):console.error("Bad buffer type "+o)}}},t.bufferToObject=t._createBufferToObject(),t}(o.TiledDisplayObject);t.VectorTile=s;var l=-1,u=["fillVertexBuffer","fillDDVertexBuffer","fillIndexBuffer","outlineVertexBuffer","outlineDDVertexBuffer","outlineIndexBuffer","lineVertexBuffer","lineDDVertexBuffer","lineIndexBuffer","iconVertexBuffer","iconDDVertexBuffer","iconIndexBuffer","textVertexBuffer","textDDVertexBuffer","textIndexBuffer","circleVertexBuffer","circleIndexBuffer"]}).apply(null,r))||(e.exports=n)},WsO6:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("9opi"),i("qKT0"),i("Gtr7"),i("BcWh"),i("7MDj"),i("NfRO"),i("qsST"),i("SZNs"),i("Vx27")],void 0===(n=(function(e,t,i,r,n,a,o,s,l,u,c){return function(e){function t(t){var i=e.call(this,t)||this;return i.layer=null,i.parent=null,i}return i(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch((function(t){if("layerview:create-error"!==t.name){var i=e.layer&&e.layer.id||"no id",r=e.layer&&e.layer.title||"no title";throw l.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+r+"', id: '"+i+"')",t),t}}))},t.prototype.destroy=function(){this.layer=this.parent=null},Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},r([c.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),r([c.property()],t.prototype,"layer",void 0),r([c.property()],t.prototype,"parent",void 0),r([c.property({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),r([c.property({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],t.prototype,"updating",null),r([c.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),r([c.subclass("esri.views.layers.LayerView")],t)}(c.declared(o.HandleOwnerMixin(s.IdentifiableMixin(u.EsriPromiseMixin(a.EventedMixin(n))))))}).apply(null,r))||(e.exports=n)},YOjP:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("xhoE"),i("qKT0"),i("pMLx"),i("M3W5"),i("f3JK")],void 0===(n=(function(e,t,i,r,n,a,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._fullCacheLodInfos=null,t._levelByScale={},t}return i(t,e),t.prototype.getTileParentId=function(e){var t=o.pool.acquire(e),i=0===t.level?null:o.getId(t.level-1,t.row>>1,t.col>>1,t.world);return o.pool.release(t),i},t.prototype.getTileCoverage=function(t,i,r){var n=e.prototype.getTileCoverage.call(this,t,i,r);if(!n)return n;var a=1<<n.lodInfo.level;return n.spans=n.spans.filter((function(e){return e.row>=0&&e.row<a})),n},t.prototype.scaleToLevel=function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t=this._fullCacheLodInfos;if(e>t[0].scale)return t[0].level;for(var i=void 0,r=void 0,n=0;n<t.length-1;n++)if(e>(r=t[n+1]).scale)return(i=t[n]).level+(i.scale-e)/(i.scale-r.scale);return t[t.length-1].level},t.prototype._initializeFullCacheLODs=function(e){var t;t=0===e[0].level?e.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}})):n.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}));for(var i=0;i<t.length;i++)this._levelByScale[t[i].scale]=t[i].level;this._fullCacheLodInfos=t},t}(a)}).apply(null,r))||(e.exports=n)},ZHL0:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("r7jh")],void 0===(n=(function(e,t,i){return function(){function e(e,t){this._storage=new i.MemCacheStorage,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}return e.prototype.put=function(e,t){this._storage.put(e,t,1,1)},e.prototype.pop=function(e){return this._storage.pop(e)},e.prototype.get=function(e){return this._storage.get(e)},e.prototype.clear=function(){this._storage.clearAll()},e.prototype.destroy=function(){this._storage.clearAll()},e}()}).apply(null,r))||(e.exports=n)},ZMIQ:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("qKT0"),i("9opi"),i("ycL1"),i("Vx27")],void 0===(n=(function(e,t,i,r,n,a){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),i([a.subclass("esri.views.layers.support.ClipArea")],t)}(a.declared(n.JSONSupport))}).apply(null,r))||(e.exports=n)},hwgr:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("VCyw")],void 0===(n=(function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.FadeProperties=function(e,t,i,r){this.fadeSpeed=e,this.minfadeLevel=t,this.maxfadeLevel=i,this.fadeChange=r};var r=function(){function e(e,t){void 0===e&&(e=300),void 0===t&&(t=!1),this._levelSnapshots=[],this._duration=e,this._ignoreSpeed=t}return e.prototype.recordLevel=function(e){var t=i(),r=this._levelSnapshots;0===r.length&&(r.push({level:e,now:0}),r.push({level:e,now:0})),2!==r.length&&r[0].level===e||r.push({level:e,now:t})},e.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var e=this._duration,t=this._levelSnapshots,i=t.length,r=t[i-1],n=-1;i>n+1&&t[n+1].now+e<r.now;)n++;for(n<0&&(n=0);n<i;n++)if(t[n].level!==r.level)return!0;return!1},e.prototype.getFadeValues=function(){for(var e=this._duration,t=i(),r=this._levelSnapshots;r.length>3&&r[1].now+e<t;)r.shift();r[1].now+e<t&&(r[0].level=r[1].level);var n=r[0].level,a=r[r.length-1],o=a.level,s=Math.min(n,o),l=Math.max(n,o),u=(a.level-r[1].level)/((a.now-r[1].now)/e);return this._ignoreSpeed?{fadeSpeed:0,minfadeLevel:s,maxfadeLevel:l,fadeChange:0}:{fadeSpeed:u,minfadeLevel:s,maxfadeLevel:l,fadeChange:(t-a.now)/e*u}},e}();t.FadeRecorder=r}).apply(null,r))||(e.exports=n)},mFzi:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("DJpR"),i("VIUv"),i("6cAc")],void 0===(n=(function(e,t,i,r,n){return function(){function e(e,t,i){void 0===i&&(i=0),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(e<=0||t<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,i>0&&(this._maxItemSize=i),this._binPack=new r(e-4,t-4)}return e.prototype.getWidth=function(e){return e>=this._size.length?-1:this._size[e][0]},e.prototype.getHeight=function(e){return e>=this._size.length?-1:this._size[e][1]},e.prototype.setSpriteSource=function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new r(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),n=new Uint32Array(t*i);this._mosaicsData[0]=n,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e},e.prototype.getSpriteItem=function(e,t){void 0===t&&(t=!1);var i=this._mosaicRects[e];if(i)return i;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;var r=this._sprites.getSpriteInfo(e);if(!r||!r.width||!r.height||r.width<0||r.height<0)return null;var n=r.width,a=r.height,o=this._allocateImage(n,a),s=o[0],l=o[1];return s.width<=0?null:(this._copy(s,r,l,o[2],t),this._mosaicRects[e]=i={rect:s,width:n,height:a,sdf:r.sdf,simplePattern:!1,pixelRatio:r.pixelRatio,page:l},i)},e.prototype.preloadSpriteItems=function(){for(var e=0,t=this._sprites.spriteNames;e<t.length;e++)this.getSpriteItem(t[e],!0)},e.prototype.getSpriteItems=function(e){for(var t={},i=0,r=e;i<r.length;i++){var n=r[i];t[n]=this.getSpriteItem(n)}return t},e.prototype.getMosaicItemPosition=function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;return r?(r.width=i.width,r.height=i.height,{size:[i.width,i.height],tl:[(r.x+2)/this._size[i.page][0],(r.y+2)/this._size[i.page][1]],br:[(r.x+2+i.width)/this._size[i.page][0],(r.y+2+i.height)/this._size[i.page][1]],page:i.page}):null},e.prototype.bind=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this._textures[r]||(this._textures[r]=new i.Texture(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[r][0],height:this._size[r][1]},new Uint8Array(this._mosaicsData[r].buffer)));var a=this._textures[r];a.setSamplingMode(t),this._dirties[r]&&a.setData(new Uint8Array(this._mosaicsData[r].buffer)),e.bindTexture(a,n),this._dirties[r]=!1},e._copyBits=function(e,t,i,r,n,a,o,s,l,u,c){var h=r*t+i,p=s*a+o;if(c){p-=a;for(var f=-1;f<=u;h=((++f+u)%u+r)*t+i,p+=a)for(var d=-1;d<=l;d++)n[p+d]=e[h+(d+l)%l]}else for(f=0;f<u;f++){for(d=0;d<l;d++)n[p+d]=e[h+d];h+=t,p+=a}},e.prototype._copy=function(t,i,r,n,a,o){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var s=new Uint32Array(o?o.buffer:this._sprites.image.buffer),l=this._mosaicsData[r];l&&s||console.error("Source or target images are uninitialized!"),e._copyBits(s,o?i.width:this._sprites.width,i.x,i.y,l,n[0],t.x+2,t.y+2,i.width,i.height,a),this._dirties[r]=!0}},e.prototype._allocateImage=function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var a=new n.default(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[a,this._mosaicsData.length-1,[e,t]]}var o=e%4?4-e%4:4,s=t%4?4-t%4:4;1===o&&(o=5),1===s&&(s=5);var l=this._binPack.allocate(e+o,t+s);return l.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new r(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[l,this._currentPage,[this._pageWidth,this._pageHeight]]},e.prototype.dispose=function(){this._binPack=null,this._mosaicRects={};for(var e=0,t=this._textures;e<t.length;e++){var i=t[e];i&&i.dispose()}this._textures.length=0},e}()}).apply(null,r))||(e.exports=n)},soIt:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("qMld"),i("Cobz"),i("f3JK")],void 0===(n=(function(e,t,i,r,n){return function(){function e(e){if(e instanceof r.TilemapCache)this._tilemapCache=e;else{if(!(e&&"index"in e))throw new Error("Invalid tilemap!");this._tilemap=e.index}}return e.prototype.dataKey=function(e,t){if(this._tilemapCache){var r=e.level,a=e.row,o=e.col,s=new n(e);return this._tilemapCache.fetchAvailabilityUpsample(r,a,o,s,t).then((function(){return s})).catch((function(e){if(i.isAbortError(e))throw e;return s.level=r,s.row=a,s.col=o,s}))}return this._getIndexedDataKey(e)},e.prototype.forEach=function(e,t,i,r,n){this._callback=n,this._maxLevel=t+e,this._forEach(this._tilemap,t,i,r)},e.prototype._forEach=function(e,t,i,r){0!==e&&(this._callback(t,i,r),t!==this._maxLevel&&"object"==typeof e&&(this._forEach(e[0],t+1,2*i,2*r),this._forEach(e[1],t+1,2*i,2*r+1),this._forEach(e[2],t+1,2*i+1,2*r),this._forEach(e[3],t+1,2*i+1,2*r+1)))},e.prototype._getIndexedDataKey=function(e){var t=[e];if(e.level<0||e.row<0||e.col<0||e.row>>e.level>0||e.col>>e.level>0)return i.resolve(null);for(var r=e;0!==r.level;)r=new n(r.level-1,r.row>>1,r.col>>1,r.world),t.push(r);var a,o,s=this._tilemap,l=t.pop();if(1===s)return i.resolve(l);for(;t.length;)if(o=(1&(a=t.pop()).col)+((1&a.row)<<1),s){if(0===s[o]){l=null;break}if(1===s[o]){l=a;break}l=a,s=s[o]}return i.resolve(l)},e}()}).apply(null,r))||(e.exports=n)},suOV:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("zp6E"),i("H1tY"),i("v7zm"),i("qMld")],void 0===(n=(function(e,t,i,r,n,a){var o=function(){function e(e){if(this._metrics=[],this._bitmaps=[],e)for(;e.next();)switch(e.tag()){case 1:for(var t=e.getMessage();t.next();)switch(t.tag()){case 3:for(var i=t.getMessage(),r=void 0,n=void 0,a=void 0,o=void 0,s=void 0,l=void 0,u=void 0;i.next();)switch(i.tag()){case 1:r=i.getUInt32();break;case 2:n=i.getBytes();break;case 3:a=i.getUInt32();break;case 4:o=i.getUInt32();break;case 5:s=i.getSInt32();break;case 6:l=i.getSInt32();break;case 7:u=i.getUInt32();break;default:i.skip()}i.release(),r&&(this._metrics[r]={width:a,height:o,left:s,top:l,advance:u},this._bitmaps[r]=n);break;default:t.skip()}t.release();break;default:e.skip()}}return e.prototype.getMetrics=function(e){return this._metrics[e]},e.prototype.getBitmap=function(e){return this._bitmaps[e]},e}(),s=function(){function e(){this._ranges=[]}return e.prototype.getRange=function(e){return this._ranges[e]},e.prototype.addRange=function(e,t){this._ranges[e]=t},e}();return function(){function e(e){this._glyphInfo={},this._baseURL=e}return e.prototype.getRange=function(e,t){var s=this._getFontStack(e);if(r("stable-symbol-rendering")&&t>0)return s.addRange(t,new o),a.resolve();if(s.getRange(t))return a.resolve();var l=256*t,u=l+255,c=this._baseURL.replace("{fontstack}",e).replace("{range}",l+"-"+u);return i(c,{responseType:"array-buffer"}).then((function(e){s.addRange(t,new o(new n(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){s.addRange(t,new o)}))},e.prototype.getGlyph=function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var n=i.getRange(r);if(n)return{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}}}},e.prototype._getFontStack=function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new s),t},e}()}).apply(null,r))||(e.exports=n)},ts8o:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("qKT0"),i("9opi"),i("TMur"),i("Vx27"),i("YADd"),i("Lzvl"),i("ZMIQ")],void 0===(n=(function(e,t,i,r,n,a,o,s,l){var u={base:o,key:"type",typeMap:{extent:n.Extent,polygon:n.Polygon}};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="geometry",t.geometry=null,t}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n({geometry:this.geometry.clone()})},i([a.property({types:u,json:{read:s.fromJSON,write:!0}})],t.prototype,"geometry",void 0),i([a.property({readOnly:!0,dependsOn:["geometry"]})],t.prototype,"version",null),n=i([a.subclass("esri.views.layers.support.Geometry")],t)}(a.declared(l))}).apply(null,r))||(e.exports=n)},"uf/D":function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("xhoE"),i("2Atf"),i("Q2wQ"),i("HZ3d"),i("9sIV"),i("LxLY"),i("qMld"),i("lRq4"),i("DJpR"),i("YaB4"),i("VjU6"),i("hwgr"),i("tI6k"),i("JNkf"),i("gi5q"),i("7Lgj"),i("f3JK")],void 0===(n=(function(e,t,i,r,n,a,o,s,l,u,c,h,p,f,d,y,v,g,_){Object.defineProperty(t,"__esModule",{value:!0});var m=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._backgroundTiles=[],r._fadeRecorder=new f.FadeRecorder(400),r._pointToCallbacks=new Map,r._parsedDataQueue=new Map,r}return i(t,e),t.prototype.destroy=function(){this.removeAllChildren(),this.children.forEach((function(e){return e.destroy()}))},t.prototype.dispose=function(){this._spriteMosaic&&this._spriteMosaic.dispose(),this._glyphMosaic&&this._glyphMosaic.dispose(),e.prototype.dispose.call(this)},t.prototype.setStyleResources=function(e,t,i){this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=i},t.prototype.hitTest=function(e,t){return a(this,void 0,void 0,(function(){var i,r;return n(this,(function(n){return i=[e,t],r=l.createResolver(),this._pointToCallbacks.set(i,r),this.requestRender(),[2,r.promise]}))}))},t.prototype.setTileData=function(e,t){var i=this.stage;return i.dataUploadCounter<d.MAX_GPU_UPLOADS_PER_FRAME&&t?(e.setData(t.tileData,t.client,t.refKeys),void i.dataUploadCounter++):t?void this._parsedDataQueue.set(e,t):void e.setData(null,null)},t.prototype.createRenderParams=function(t){return r({},e.prototype.createRenderParams.call(this,t),{renderPass:null,styleLayer:null,styleLayerId:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,fadeRecorder:this._fadeRecorder,hasClipping:!!this._clippingInfos})},t.prototype.doRender=function(t){!this.visible||t.drawPhase!==y.WGLDrawPhase.MAP&&t.drawPhase!==y.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||e.prototype.doRender.call(this,t)},t.prototype.createTile=function(e){var t=this._tileInfoView.getTileBounds(u.create(),e),i=new p.VectorTile(e,this._styleRepository,t,[512,512]);return i.rotation=this.stage.state.rotation,i},t.prototype.destroyTile=function(e){e.destroy()},t.prototype.removeChild=function(t){return this._parsedDataQueue.has(t)&&this._parsedDataQueue.delete(t),e.prototype.removeChild.call(this,t)},t.prototype.renderChildren=function(t){if(t.drawPhase!==y.WGLDrawPhase.DEBUG){var i=this.stage;if(this._parsedDataQueue.size>0&&i.dataUploadCounter<d.MAX_GPU_UPLOADS_PER_FRAME)for(var r=o.pairsOfMap(this._parsedDataQueue),n=0;n<r.length&&i.dataUploadCounter<d.MAX_GPU_UPLOADS_PER_FRAME;n++){var a=r[n][0],s=r[n][1];a.setData(s.tileData,s.client,s.refKeys),this._parsedDataQueue.delete(a),i.dataUploadCounter++}if(this._fadeRecorder.recordLevel(t.displayLevel),this._doRender(t),(this._parsedDataQueue.size>0||this._fadeRecorder.needsRedraw())&&this.requestRender(),this._pointToCallbacks.size>0){var l=t.context,u=l.getBoundFramebufferObject();t.drawPhase=y.WGLDrawPhase.HITTEST;var c=t.painter.effects.hittest;c.bind(t),this._doRender(t),c.draw(t,this._pointToCallbacks,6),l.bindFramebuffer(u)}}else e.prototype.renderChildren.call(this,t)},t.prototype.removeAllChildren=function(){this._parsedDataQueue.clear();for(var t=0;t<this.children.length;t++)this.children[t].dispose();e.prototype.removeAllChildren.call(this)},t.prototype._doRender=function(t){var i=t.context,r=this._styleRepository,n=r.layers;r.backgroundBucketIds.length>0&&(t.renderPass="background",this._renderBackgroundLayers(t,r.backgroundBucketIds)),e.prototype.renderChildren.call(this,t);for(var a=this.children.filter((function(e){return e.visible})),o=0,s=a;o<s.length;o++){var l=s[o];l.triangleCount=0,l.commitChanges()}i.setStencilWriteMask(0),i.setColorMask(!0,!0,!0,!0),i.setStencilOp(7680,7680,7681),i.setStencilTestEnabled(!0),i.setBlendingEnabled(!1),i.setDepthTestEnabled(!0),i.setDepthWriteEnabled(!0),i.setDepthFunction(515),i.setClearDepth(1),i.clear(i.gl.DEPTH_BUFFER_BIT),t.renderPass="opaque";for(var u=n.length-1;u>=0;u--)this._renderStyleLayer(u,t,a);for(i.setDepthWriteEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(1,771,1,771),t.renderPass="translucent",u=0;u<n.length;u++)this._renderStyleLayer(u,t,a);for(i.setDepthTestEnabled(!1),t.renderPass="symbol",u=0;u<n.length;u++)this._renderStyleLayer(u,t,a);i.bindVAO(),i.setStencilTestEnabled(!0)},t.prototype._renderStyleLayer=function(e,t,i){var r=t.painter,n=t.renderPass,a=this._styleRepository.layers[e];if(void 0!==a){var o;switch(a.type){case 0:return;case 1:if("opaque"!==n&&"translucent"!==t.renderPass)return;o="vtlFill";break;case 2:if("translucent"!==n)return;o="vtlLine";break;case 4:if("symbol"!==n)return;o="vtlCircle";break;case 3:if("symbol"!==n)return;o="vtlSymbol"}var s=t.displayLevel;if(!(0===i.length||void 0!==a.minzoom&&a.minzoom>=s+1e-6||void 0!==a.maxzoom&&a.maxzoom<s-1e-6)){t.styleLayerId=e,t.styleLayer=a;for(var l=0,u=i;l<u.length;l++)if(u[l].layerData[e]){r.renderObjects(t,i,o);break}}}},t.prototype._renderBackgroundLayers=function(e,t){var i=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),r=i.spans,n=i.lodInfo,a=n.level,o=this._styleRepository,l=e.context,c=e.displayLevel,h=e.painter,p=e.state,f=u.create(),d=[];if(this._renderPasses){var y=this._renderPasses[0];s.isSome(this._clippingInfos)&&(y.brushes[0].prepareState(e,this._clippingInfos[0]),y.brushes[0].drawMany(e,this._clippingInfos))}for(var m,b=this._backgroundTiles,w=0,x=0,D=r;x<D.length;x++)for(var T=D[x],S=T.row,I=T.colTo,P=T.colFrom;P<=I;P++){if(w<b.length)(m=b[w]).key.set(a,S,n.normalizeCol(P),n.getWorldForColumn(P)),this._tileInfoView.getTileBounds(f,m.key,!1),m.bounds=f,m.coords[0]=f[0],m.coords[1]=f[3];else{var B=new _(a,S,n.normalizeCol(P),n.getWorldForColumn(P));m=new v.TiledDisplayObject(B,this._tileInfoView.getTileBounds(u.create(),B),[512,512],[4096,4096]),b.push(m)}m.setTransform(p,this._tileInfoView.getTileResolution(m.key)),d.push(m),w++}l.setStencilWriteMask(0),l.setColorMask(!0,!0,!0,!0),l.setStencilOp(7680,7680,7681),l.setStencilFunction(514,0,255),l.setStencilTestEnabled(!0);for(var R=0,j=t;R<j.length;R++){var V=j[R],C=o.layers[V];!C||void 0!==C.minzoom&&C.minzoom>=c+1e-6||void 0!==C.maxzoom&&C.maxzoom<c-1e-6||(e.styleLayerId=V,e.styleLayer=C,h.renderObjects(e,d,"vtlBackground"))}g.pool.release(i)},t}(h.TileContainer);t.VectorTileContainer=m}).apply(null,r))||(e.exports=n)},xkJJ:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("9opi"),i("qKT0"),i("Q2wQ"),i("HZ3d"),i("jZlN"),i("ma1f"),i("eIBl"),i("qsST"),i("qMld"),i("Vx27"),i("BEij"),i("uf/D"),i("6i4F"),i("YOjP"),i("EBSo"),i("ovos"),i("WsO6")],void 0===(n=(function(e,t,i,r,n,a,o,s,l,u,c,h,p,f,d,y,v,g,_){var m=u.getLogger("esri.views.2d.layers.VectorTileLayerView2D");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new l,t._fetchQueue=null,t._parseQueue=null,t._isTileHandlerPromiseFulfilled=!1,t._invalidateStyle=!1,t}return i(t,e),t.prototype.initialize=function(){var e=this,t=this.layer.tileInfo;(t&&t.spatialReference).equals(this.view.spatialReference)?(this._tileInfoView=new y(this.layer.tileInfo,this.layer.fullExtent),this.container=new f.VectorTileContainer(this._tileInfoView,this.clips),this._tileHandler=new p.TileHandler(this.layer,window.devicePixelRatio||1,!0,this.container,null),this.handles.add([this.watch("layer.currentStyleInfo",(function(){return e._start()})),this.clips.on("change",(function(){return e.container.setClips(e.clips)}))])):this.addResolvingPromise(c.reject(new s("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))},t.prototype.destroy=function(){this._stop(),this.container.dispose(),this._tileHandler&&(this._tileHandler.destroy(),this._tileHandler=null)},t.prototype.hitTest=function(e,t){return a(this,void 0,void 0,(function(){var i,r,a,s;return n(this,(function(n){switch(n.label){case 0:return this.suspended||!this._tileHandlerPromise?[2,null]:[4,this._tileHandlerPromise];case 1:return n.sent(),[4,this.container.hitTest(e,t)];case 2:return(i=n.sent())&&0!==i.length?(r=i[0],a=this._tileHandler.getStyleRepository().layers,r>=a.length?[2,null]:((s=new o({attributes:{layerId:r,layerName:a[r].id}})).layer=this.layer,s.sourceLayer=this.layer,[2,s])):[2,null]}}))}))},t.prototype.update=function(e){var t=this;this.notifyChange("updating");var i=this._tileHandlerPromise;i&&i.then((function(){if(e.pixelRatio!==t._tileHandler.devicePixelRatio)return t._start(),void(t._tileHandler.devicePixelRatio=e.pixelRatio);t._invalidateStyle?(t._issueStyleInvalidation(),t._invalidateStyle=!1):(t._fetchQueue.pause(),t._parseQueue.pause(),t._fetchQueue.state=e.state,t._parseQueue.state=e.state,t._tileStrategy.update(e),t._parseQueue.resume(),t._fetchQueue.resume());for(var i=0,r=t.container.children;i<r.length;i++)t._tileHandler.updateTile(r[i],e)}))},t.prototype.attach=function(){var e=this;this._start(),this._handles.add(this.layer.on("paint-change",(function(){return e.container.requestRender()}))),this._handles.add(this.layer.on("layout-change",(function(){e._invalidateStyle=!0,e.requestUpdate()})))},t.prototype.detach=function(){this._stop(),this._handles.removeAll()},t.prototype.moveStart=function(){this.requestUpdate()},t.prototype.viewChange=function(){this.requestUpdate()},t.prototype.moveEnd=function(){this.requestUpdate()},t.prototype.canResume=function(){var e=this.inherited(arguments),t=this.layer;if(e&&t.currentStyleInfo){var i=this.view.scale,r=t.currentStyleInfo;if(r&&r.layerDefinition){var n=r.layerDefinition;n.minScale&&n.minScale<i&&(e=!1),n.maxScale&&n.maxScale>i&&(e=!1)}}return e},t.prototype.isUpdating=function(){return!this._isTileHandlerPromiseFulfilled||this._fetchQueue.updating||this._parseQueue.updating},t.prototype.acquireTile=function(e){var t=this,i=this.container.createTile(e);return this._tileHandlerPromise.then((function(){t.notifyChange("updating"),t._fetchQueue.push(i.key).then((function(e){return t._parseQueue.push(e)})).then((function(e){i.once("attach",(function(){return t.requestUpdate()})),t.container.setTileData(i,e),t.container.addChild(i),t.notifyChange("updating")})).catch((function(e){t.notifyChange("updating"),c.isAbortError(e)||m.error(e),i.destroy()}))})),i},t.prototype.releaseTile=function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this._tileHandler.abortTileUpdate(t),this.container.removeChild(e),this.requestUpdate(),this.notifyChange("updating")},t.prototype._start=function(){var e=this;if(this._stop(),this.layer.currentStyleInfo&&this.attached){var t=new AbortController,i=this._tileHandler.start({signal:t.signal}).then((function(){e._tileStrategy=new g({cachePolicy:"keep",coveragePolicy:"smallest",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:e._tileInfoView,cacheSize:40,buffer:0}),e._fetchQueue=new v({tileInfoView:e._tileInfoView,process:function(t,i){return e._getTileData(t,i)},concurrency:15}),e._parseQueue=new v({tileInfoView:e._tileInfoView,process:function(t,i){return e._parseTileData(t,i)},concurrency:8}),e.requestUpdate(),e._isTileHandlerPromiseFulfilled=!0}));this._tileHandler.spriteMosaic.then((function(t){e.container.setStyleResources(t,e._tileHandler.glyphMosaic,e.layer.styleRepository),e.requestUpdate()})),this._tileHandlerAbortController=t,this._tileHandlerPromise=i}},t.prototype._stop=function(){if(this._tileHandlerAbortController){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerPromiseFulfilled=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this.container.removeAllChildren()}},t.prototype._getTileData=function(e,t){return a(this,void 0,void 0,(function(){var i;return n(this,(function(r){switch(r.label){case 0:return[4,this._tileHandler.fetchTileData(e,t)];case 1:return i=r.sent(),this.notifyChange("updating"),[2,{key:e,data:i}]}}))}))},t.prototype._parseTileData=function(e,t){return a(this,void 0,void 0,(function(){return n(this,(function(i){return[2,this._tileHandler.parseTileData(e,this.updateParameters.state.rotation,t)]}))}))},t.prototype._issueStyleInvalidation=function(){var e=this;this.notifyChange("updating"),this._tileHandlerPromise=this._tileHandler.updateStyle().then((function(){e._tileHandler.spriteMosaic.then((function(t){return e.container.setStyleResources(t,e._tileHandler.glyphMosaic,e.layer.styleRepository)})),e._fetchQueue.pause(),e._parseQueue.pause(),e._fetchQueue.clear(),e._parseQueue.clear(),e._parseQueue.resume(),e._fetchQueue.resume(),e.notifyChange("updating"),e.requestUpdate()}))},r([h.property({dependsOn:["view.scale","layer.currentStyleInfo"]})],t.prototype,"suspended",void 0),r([h.subclass("esri.views.2d.layers.VectorTileLayerView2D")],t)}(h.declared(d.LayerView2D(_)))}).apply(null,r))||(e.exports=n)},xojL:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("2Atf"),i("zp6E"),i("KY0m"),i("ma1f"),i("rg9i")],void 0===(n=(function(e,t,i,r,n,a,o){function s(e){var t;if("vector-tile"===e.service.type)t=e.service.url+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height;else{var i=e.service.tileServers;t=(i&&i.length?i[e.row%i.length]:e.service.url)+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height}var r=e.service.query;return r&&(t=t+"?"+r),t}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return e.prototype.getAvailability=function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i>>3,n=this._tileAvailabilityBitSet;return r<0||r>n.length?"unknown":n[r]&1<<i%8?"available":"unavailable"},e.prototype._updateFromData=function(e){for(var t=!0,i=!0,r=Math.ceil(this.location.width*this.location.height/8),n=new Uint8Array(r),a=0,o=0;o<e.length;o++){var s=o%8;e[o]?(i=!1,n[a]|=1<<s):t=!1,7===s&&++a}i?this._allAvailability="unavailable":t?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=n,this.byteSize+=n.length)},e.fromDefinition=function(t,o){var l=t.service.request||r,u=t.row,c=t.col,h=t.width,p=t.height,f={query:{f:"json"}};return o=o?i({},f,o):f,l(s(t),o).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:u,left:c,width:h,height:p},valid:!0,data:n.constant(h*p,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==u||t.location.left!==c||t.location.width!==h||t.location.height!==p))throw new a("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:u,left:c,width:h,height:p}});return e.fromJSON(t)}))},e.fromJSON=function(t){e.validateJSON(t);var i=new e;return i.location=Object.freeze(o.clone(t.location)),i._updateFromData(t.data),Object.freeze(i)},e.validateJSON=function(e){if(!e||!e.location)throw new a("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new a("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new a("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new a("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new a("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();t.Tilemap=l,t.tilemapDefinitionId=function(e){return e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height},t.tilemapDefinitionUrl=s,t.default=l}).apply(null,r))||(e.exports=n)}}]);