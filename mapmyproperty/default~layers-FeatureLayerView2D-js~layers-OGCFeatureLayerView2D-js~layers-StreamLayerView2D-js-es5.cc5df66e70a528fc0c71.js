!function(){function e(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,u=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){o=!0,s=e},f:function(){try{u||null==r.return||r.return()}finally{if(o)throw s}}}}function t(e,t,r,n,i,a,s){try{var u=e[a](s),o=u.value}catch(c){return void r(c)}u.done?t(o):Promise.resolve(o).then(n,i)}function r(e){return function(){var r=this,n=arguments;return new Promise((function(i,a){var s=e.apply(r,n);function u(e){t(s,i,a,u,o,"next",e)}function o(e){t(s,i,a,u,o,"throw",e)}u(void 0)}))}}function n(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,r){return t&&p(e.prototype,t),r&&p(e,r),e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=g(e);if(t){var i=g(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return b(this,r)}}function b(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[17,187],{"6UvW":function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return o}));var n=r("srIe"),i=r("OvF4"),a=(r("4GrV"),r("gEht")),s=r("U282");function u(e,t,r){var s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i.a;if("2d"===r.type)s=t*r.resolution;else if("3d"===r.type){var o=r.overlayPixelSizeInMapUnits(e),c=r.basemapSpatialReference;s=Object(n.k)(c)&&!c.equals(r.spatialReference)?Object(a.f)(c)/Object(a.f)(r.spatialReference):t*o}var l=e.x-s,p=e.y-s,f=e.x+s,d=e.y+s,h=r.spatialReference;return u.xmin=Math.min(l,f),u.ymin=Math.min(p,d),u.xmax=Math.max(l,f),u.ymax=Math.max(p,d),u.spatialReference=h,u}function o(e,t,r){var i=r.toMap(e);return!Object(n.j)(i)&&u(i,Object(s.a)(),r,c).intersects(t)}var c=new i.a},GJxj:function(t,i,a){"use strict";a.r(i);var u,c=a("pO5D"),p=a("wSAH"),h=a("f/qv"),b=a("srIe"),m=a("6S2I"),O=(a("zqDF"),a("WbKI")),j=a("04ZG"),k=a("zlDU"),_=(a("4EHJ"),a("ju1D"),a("9AIY"),a("tQ+6")),x=a("9MzC"),w=a("OvF4"),R=a("4GrV"),I=a("LE9a"),S=a("jWBI"),E=u=function(e){d(r,e);var t=y(r);function r(){var e;return l(this,r),(e=t.apply(this,arguments)).isAggregate=!0,e}return f(r,[{key:"getEffectivePopupTemplate",value:function(){if(this.popupTemplate)return this.popupTemplate;var e=this.sourceLayer&&this.sourceLayer.featureReduction;return e&&"popupTemplate"in e&&e.popupEnabled?e.popupTemplate:null}},{key:"getObjectId",value:function(){return this.objectId}},{key:"clone",value:function(){return new u(o({objectId:this.objectId},this.cloneProperties()))}}]),r}(S.a);Object(c.a)([Object(O.b)({type:Boolean})],E.prototype,"isAggregate",void 0),Object(c.a)([Object(O.b)({type:Number,json:{read:!0}})],E.prototype,"objectId",void 0);var F,P=E=u=Object(c.a)([Object(j.a)("esri.AggregateGraphic")],E),q=a("N5XI"),U=a("VLTf"),T=a("8prj"),C=a("xk++"),V=a("jIHu"),A=a("sq/B"),N=a("bHqs"),M=a("NloG"),L=a("U282"),z=a("6UvW"),D=a("m662"),H=a("q0q8"),G=a("bzbK"),J=a("RaXU"),Q=a("owVx"),B=a("+opI"),W=a("Cduq"),K=a("ag7Y"),Z=a("qatw"),X=a("ZYtI"),Y=new B.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),$=new B.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),ee=F=function(e){d(r,e);var t=y(r);function r(e){var n;return l(this,r),(n=t.call(this,e)).where=null,n.geometry=null,n.spatialRelationship="intersects",n.hiddenIds=new Set,n.distance=void 0,n.objectIds=null,n.units=null,n.timeExtent=null,n.enabled=!1,n}return f(r,[{key:"writeWhere",value:function(e,t){t.where=e||"1=1"}},{key:"enable",value:function(){this._set("enabled",!0)}},{key:"createQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.where,r=this.geometry,n=this.spatialRelationship,i=this.timeExtent,a=this.objectIds,s=this.units,u=this.distance;return new C.a(o({geometry:Object(h.a)(r),objectIds:Object(h.a)(a),spatialRelationship:n,timeExtent:Object(h.a)(i),where:t,units:s,distance:u},e))}},{key:"clone",value:function(){var e=this.where,t=this.geometry,r=this.spatialRelationship,n=this.hiddenIds,i=this.timeExtent,a=this.objectIds,s=this.units,u=this.distance,o=new Set;return n.forEach((function(e){return o.add(e)})),new F({geometry:Object(h.a)(t),hiddenIds:o,objectIds:Object(h.a)(a),spatialRelationship:r,timeExtent:Object(h.a)(i),where:e,units:s,distance:u})}}]),r}(K.a);Object(c.a)([Object(O.b)({type:String})],ee.prototype,"where",void 0),Object(c.a)([Object(W.a)("where")],ee.prototype,"writeWhere",null),Object(c.a)([Object(O.b)({types:R.e,json:{read:Z.a,write:!0}})],ee.prototype,"geometry",void 0),Object(c.a)([Object(O.b)({type:String,json:{read:{source:"spatialRel",reader:Y.read},write:{target:"spatialRel",writer:Y.write}}})],ee.prototype,"spatialRelationship",void 0),Object(c.a)([Object(O.b)({json:{write:function(e,t,r){return t[r]=Array.from(e)},read:function(e){return new Set(e)}}})],ee.prototype,"hiddenIds",void 0),Object(c.a)([Object(O.b)({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],ee.prototype,"distance",void 0),Object(c.a)([Object(O.b)({type:[Number],json:{write:!0}})],ee.prototype,"objectIds",void 0),Object(c.a)([Object(O.b)({type:String,json:{read:$.read,write:{writer:$.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],ee.prototype,"units",void 0),Object(c.a)([Object(O.b)({type:X.a,json:{write:!0}})],ee.prototype,"timeExtent",void 0),Object(c.a)([Object(O.b)({readOnly:!0})],ee.prototype,"enabled",void 0);var te,re=ee=F=Object(c.a)([Object(j.a)("esri.views.layers.support.FeatureFilter")],ee),ne=te=function(e){d(r,e);var t=y(r);function r(){var e;return l(this,r),(e=t.apply(this,arguments)).filter=null,e.includedEffect=null,e.excludedEffect=null,e.excludedLabelsVisible=!1,e}return f(r,[{key:"clone",value:function(){return new te({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}}]),r}(K.a);Object(c.a)([Object(O.b)({type:re,json:{write:!0}})],ne.prototype,"filter",void 0),Object(c.a)([Object(O.b)({json:{write:!0}})],ne.prototype,"includedEffect",void 0),Object(c.a)([Object(O.b)({json:{write:!0}})],ne.prototype,"excludedEffect",void 0),Object(c.a)([Object(O.b)({type:Boolean,json:{write:!0}})],ne.prototype,"excludedLabelsVisible",void 0);var ie=ne=te=Object(c.a)([Object(j.a)("esri.views.layers.support.FeatureEffect")],ne),ae=a("gvqN"),se=a("wdpY"),ue=a("IvSi"),oe=a("rXMu"),ce=m.a.getLogger("esri.views.layers.FeatureLayerView"),le=a("Vm2Q"),pe=a("+rMe"),fe=a("36Co"),de=function(e){d(E,e);var t,n,i,a,s,u,o,c,p,h,b,v,g,m,O,j,k,_,w,R,I,S=y(E);function E(e){var t;return l(this,E),(t=S.call(this,e))._startupResolver=Object(x.g)(),t.isReady=!1,t}return f(E,[{key:"initialize",value:function(){this._controller=Object(x.d)(),this.addResolvingPromise(this._startWorker(this._controller.signal))}},{key:"destroy",value:function(){this._controller.abort(),this._connection&&this._connection.close()}},{key:"tileRenderer",set:function(e){this.client.tileRenderer=e}},{key:"closed",get:function(){return this._connection.closed}},{key:"startup",value:(I=r(regeneratorRuntime.mark((function e(t,r,n,i){var a,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.when();case 2:return a=this._controller.signal,s=function(e){return Array.isArray(e)}(n.source)?{transferList:n.source,signal:a}:void 0,u={service:n,config:r,tileInfo:t.tileInfo.toJSON(),tiles:i},e.next=5,this._connection.invoke("startup",u,s);case 5:this._startupResolver.resolve(),this._set("isReady",!0);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return I.apply(this,arguments)})},{key:"updateTiles",value:(R=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(x.l)(this._connection.invoke("updateTiles",t)));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"update",value:(w=r(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={config:t},e.next=3,this._startupResolver.promise;case 3:return e.abrupt("return",this._connection.invoke("update",r));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"applyUpdate",value:(_=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("applyUpdate",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"setHighlight",value:(k=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(x.l)(this._connection.invoke("controller.setHighlight",t)));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"refresh",value:(j=r(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(x.l)(this._connection.invoke("controller.refresh")));case 3:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"queryFeatures",value:(O=r(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatures",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"queryObjectIds",value:(m=r(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryObjectIds",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"queryFeatureCount",value:(g=r(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatureCount",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"queryExtent",value:(v=r(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._connection.invoke("controller.queryExtent",t.toJSON(),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"queryLatestObservations",value:(b=r(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryLatestObservations",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"queryStatistics",value:(h=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryStatistics",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getObjectId",value:(p=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getObjectId",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"getDisplayId",value:(c=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getDisplayId",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getFeature",value:(o=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getFeature",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getAggregate",value:(u=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregate",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getAggregateValueRanges",value:(s=r(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregateValueRanges"));case 3:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"mapValidDisplayIds",value:(a=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.mapValidDisplayIds",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"onEdits",value:(i=r(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return r=t.addedFeatures,n=t.deletedFeatures,i=t.updatedFeatures,e.abrupt("return",Object(x.l)(this._connection.invoke("controller.onEdits",{addedFeatures:r,deletedFeatures:n,updatedFeatures:i})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"enableEvent",value:(n=r(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(x.l)(this._connection.invoke("controller.enableEvent",{name:t,value:r})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_startWorker",value:(t=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(fe.b)("Pipeline",{client:this.client,strategy:"dedicated",signal:t});case 3:this._connection=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),Object(x.v)(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return t.apply(this,arguments)})}]),E}(pe.a);Object(c.a)([Object(O.b)()],de.prototype,"isReady",void 0),Object(c.a)([Object(O.b)()],de.prototype,"client",void 0),Object(c.a)([Object(O.b)()],de.prototype,"tileRenderer",null);var he=de=Object(c.a)([Object(j.a)("esri.views.2d.layers.support.FeatureLayerProxy")],de),ye=a("rlSK"),be=a("umoc"),ve=function(){function t(e){l(this,t),this._tiles=new Map,this.buffer=0,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.buffer=e.buffer}return f(t,[{key:"destroy",value:function(){}},{key:"clear",value:function(){var e=this;this._tiles.forEach((function(t){return e._releaseTile(t)}))}},{key:"tileKeys",value:function(){var e=[];return this._tiles.forEach((function(t,r){return e.push(r)})),e}},{key:"update",value:function(t){var r,n=this,i=this.tileInfoView.getTileCoverage(t.state,this.buffer,"closest"),a=i.spans,s=i.lodInfo,u=s.level,o=[],c=[],l=new Set,p=new Set,f=e(a);try{for(f.s();!(r=f.n()).done;)for(var d=r.value,h=d.row,y=d.colFrom,b=d.colTo,v=y;v<=b;v++){var g=ye.a.getId(u,h,s.normalizeCol(v),s.getWorldForColumn(v)),m=this._getOrAcquireTile(o,g);l.add(g),m.isReady?m.visible=!0:p.add(m.key)}}catch(O){f.e(O)}finally{f.f()}return p.forEach((function(e){return n._addPlaceholders(l,e)})),this._tiles.forEach((function(e){l.has(e.key.id)||(c.push(e.key.id),n._releaseTile(e))})),be.a.pool.release(i),{hasMissingTiles:p.size>0,added:o,removed:c}}},{key:"_getOrAcquireTile",value:function(e,t){if(!this._tiles.has(t)){var r=this.acquireTile(new ye.a(t));e.push(t),this._tiles.set(t,r),r.visible=!1}return this._tiles.get(t)}},{key:"_getTile",value:function(e){return this._tiles.get(e)}},{key:"_releaseTile",value:function(e){this._tiles.delete(e.key.id),this.releaseTile(e)}},{key:"_addPlaceholders",value:function(e,t){var r=this._addPlaceholderChildren(e,t);Math.abs(1-r)<1e-6||this._addPlaceholderParent(e,t)||(this._getTile(t.id).visible=!0)}},{key:"_addPlaceholderChildren",value:function(e,t){var r=this,n=0;return this._tiles.forEach((function(i){n+=r._addPlaceholderChild(e,i,t)})),n}},{key:"_addPlaceholderChild",value:function(e,t,r){return t.key.level<=r.level||!t.hasData||!r.contains(t.key)?0:(t.visible=!0,e.add(t.key.id),1/(1<<2*(t.key.level-r.level)))}},{key:"_addPlaceholderParent",value:function(e,t){for(var r=t.getParentKey(),n=0,i=null;Object(b.k)(r);){if(e.has(r.id))return!0;var a=this._getTile(r.id);if(null!=a&&a.isReady)return a.visible=!0,e.add(a.key.id),!0;null!=a&&a.hasData&&a.patchCount>n&&(n=a.patchCount,i=a),r=r.getParentKey()}return!!i&&(i.visible=!0,e.add(i.key.id),!0)}}]),t}();function ge(e){return e&&"openPorts"in e}var me,Oe,je=m.a.getLogger("esri.views.2d.layers.FeatureLayerView2D"),ke=function(t){d(F,t);var n,i,s,u,c,g,m,O,j,R,E=y(F);function F(){var e;return l(this,F),(e=E.apply(this,arguments))._pipelineIsUpdating=!0,e._updatingPipelineConfig=!1,e._onGoingEdits=0,e._isRefreshing=!1,e._visibilityOverrides=new Set,e._effect=null,e._highlightIds=new Map,e._lastPixelBuffer=0,e.filter=null,e.effectLists={included:new H.a,excluded:new H.a},e.doRefresh=Object(x.i)(r(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e.isUpdating(),!t.t0){t.next=4;break}return t.next=4,Object(q.whenFalseOnce)(v(e),"updating");case 4:return e._set("_isRefreshing",!0),e._lockGPUUploads(),t.prev=6,t.next=9,e._proxy.refresh();case 9:t.next=14;break;case 11:t.prev=11,t.t1=t.catch(6),Object(x.m)(t.t1);case 14:e._unlockGPUUploads(),e._set("_isRefreshing",!1);case 15:case"end":return t.stop()}}),t,null,[[6,11]])})))),e._doUpdate=Object(x.i)(r(regeneratorRuntime.mark((function t(){var r,n,i,a,s,u,o,c,l,p,f,d,h,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.destroyed&&e._hasRequiredSupport(e.layer)){t.next=3;break}return t.abrupt("return");case 3:return e._set("_updatingPipelineConfig",!0),t.next=6,Object(q.whenFalseOnce)(v(e),"_isRefreshing");case 6:return r=v(e),n=r.effect,i=r.filter,t.next=9,e._updateRequiredFields();case 9:return a=e._getEffectiveRenderer(),s=a.renderer,e._set("_effectiveRenderer",s),u={renderer:e.layer.renderer,spatialReference:e.layer.spatialReference,timeExtent:e.layer.timeExtent,definitionExpression:e.layer.definitionExpression,featureReduction:e.layer.featureReduction,fields:e.layer.fields,geometryType:e.layer.geometryType,historicMoment:"feature"===e.layer.type?e.layer.historicMoment:null,labelsVisible:e.layer.labelsVisible,labelingInfo:e.layer.labelingInfo,availableFields:e.availableFields,effect:e.effect,filter:e.filter,gdbVersion:"feature"===e.layer.type?e.layer.gdbVersion:null,pixelBuffer:0},o=Object(J.a)(e.layer.geometryType),t.next=15,Object(G.a)(s,o,e.layer.featureReduction);case 15:if(c=t.sent,l=e._createConfiguration(u,i,n),e._lastPixelBuffer=0===c?0:Math.max(c,e._lastPixelBuffer),l.schema.source.pixelBuffer=e._lastPixelBuffer,(p=e._createTileRendererHash(s))===e._tileRendererHash){t.next=41;break}return t.next=22,e._initTileRenderer(s);case 22:if(f=e._serviceOptions,e.effects.forEach((function(e){return Object(b.k)(e)&&Object(b.k)(e.filter)&&e.filter.enable()})),e.tileRenderer.onConfigUpdate(s),d={added:e._tileStrategy.tileKeys(),removed:[]},h=e.layer,t.t0="stream"!==h.type&&ge(h.source),!t.t0){t.next=30;break}return t.next=29,h.source.openPorts();case 29:f.source=t.sent;case 30:return t.next=32,e._proxy.startup(e.view.featuresTilingScheme,l,f,d);case 32:if(t.t1=e.hasHighlight(),!t.t1){t.next=36;break}return t.next=36,e._proxy.setHighlight(Array.from(e._highlightIds.keys()));case 36:return t.next=38,e._onceTilesUpdated();case 38:e.tileRenderer.onConfigUpdate(s),t.next=54;break;case 41:return t.next=43,e._proxy.update(l);case 43:return((y=t.sent).mesh||y.targets.aggregate)&&e._lockGPUUploads(),t.prev=45,t.next=48,e._proxy.applyUpdate(y);case 48:t.next=53;break;case 50:t.prev=50,t.t2=t.catch(45),Object(x.m)(t.t2)||je.error(t.t2);case 53:(y.mesh||y.targets.aggregate)&&e._unlockGPUUploads(),e.effects.forEach((function(e){return Object(b.k)(e)&&Object(b.k)(e.filter)&&e.filter.enable()})),e.tileRenderer.onConfigUpdate(s),e._forceAttributeTextureUpload();case 54:e._tileRendererHash=p,e.tileRenderer.invalidateLabels(),e.requestUpdate(),t.next=59;break;case 57:t.prev=57,t.t3=t.catch(0);case 59:case"end":return t.stop()}}),t,null,[[0,57],[45,50]])})))),e._updateHighlight=Object(x.i)(r(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._proxy.setHighlight(Array.from(e._highlightIds.keys())));case 1:case"end":return t.stop()}}),t)})))),e}return f(F,[{key:"destroy",value:function(){var e,t;null==(e=this._proxy)||e.destroy(),Object(b.b)(this._updateClusterSizeTask,(function(e){return e.remove()})),null==(t=this.tileRenderer)||t.destroy()}},{key:"initialize",value:function(){var e=this;this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on("valueRangesChanged",(function(t){e._set("_aggregateValueRanges",t.valueRanges)})),Object(q.init)(this,"effect",(function(t){e.effectLists.included.effect=null==t?void 0:t.includedEffect})),Object(q.init)(this,"effect",(function(t){e.effectLists.excluded.effect=null==t?void 0:t.excludedEffect}))])}},{key:"_initProxy",value:(R=r(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"===this.layer.type||"ogc-feature"===this.layer.type||!this.layer.isTable){e.next=2;break}throw new k.a("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});case 2:return this._proxy&&this._proxy.destroy(),t=this._createClientOptions(),e.abrupt("return",(this._set("_proxy",new he({client:t})),this._proxy.when()));case 5:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"_initServiceOptions",value:(j=r(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._createServiceOptions();case 3:e.t1=e.sent,e.t0._set.call(e.t0,"_serviceOptions",e.t1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"labelsVisible",get:function(){return!this.suspended&&this.layer.labelingInfo&&this.layer.labelsVisible}},{key:"effect",get:function(){return Object(b.r)(this._effect,null)},set:function(e){var t=this._effect;Object(b.k)(t)&&Object(b.k)(t.filter)&&t.filter.enabled&&Object(b.k)(e)&&Object(b.k)(e.filter)&&e.filter.enable(),this._effect=e,this.notifyChange("effect")}},{key:"effects",get:function(){return this.effect&&[this.effect]||[]}},{key:"queryMode",get:function(){return this._serviceOptions.type}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;var e=this.availableFields,t=this.layer,r=this.view.floors,n=t.definitionExpression,i=t.renderer,a=t.labelingInfo,s="feature"===t.type?t.gdbVersion:void 0,u="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,o=this.timeExtent,c="stream"===t.type?"".concat(JSON.stringify(t.geometryDefinition)).concat(t.definitionExpression):null,l=JSON.stringify(this.clips),p=t.featureReduction&&t.featureReduction.toJSON();return JSON.stringify({filterHash:Object(b.k)(this.filter)&&this.filter.toJSON(),effectHash:Object(b.k)(this.effect)&&this.effect.toJSON(),streamFilter:c,gdbVersion:s,definitionExpression:n,historicMoment:u,availableFields:e,renderer:i,labelingInfo:t.labelsVisible&&a,timeExtent:o,floors:r,clipsHash:l,featureReduction:p})}},{key:"hasEffects",get:function(){return this.effectLists.included.hasEffects||this.effectLists.excluded.hasEffects}},{key:"highlight",value:function(e){var t,r=this;return e instanceof S.a?t=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?t=[e]:I.a.isCollection(e)?t=e.map((function(e){return e&&e.getAttribute(r.layer.objectIdField)})).toArray():Array.isArray(e)&&e.length>0&&(t="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((function(e){return e&&e.getAttribute(r.layer.objectIdField)}))),t&&t.length?(t=t.filter((function(e){return null!=e})),this._addHighlight(t),{remove:function(){return r._removeHighlight(t)}}):{remove:function(){}}}},{key:"hasHighlight",value:function(){return!!this._highlightIds.size}},{key:"hitTest",value:function(e,t){return this._hitTest(e,t)}},{key:"queryStatistics",value:function(){return this._proxy.queryStatistics()}},{key:"queryFeatures",value:function(e,t){var r=this;return this.queryFeaturesJSON(e,t).then((function(e){var t=T.default.fromJSON(e);return t.features.forEach((function(e){e.layer=r.layer,e.sourceLayer=r.layer})),t}))}},{key:"queryFeaturesJSON",value:function(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}},{key:"queryObjectIds",value:function(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}},{key:"queryFeatureCount",value:function(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}},{key:"queryExtent",value:function(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((function(e){return{count:e.count,extent:w.a.fromJSON(e.extent)}}))}},{key:"setVisibility",value:function(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}},{key:"update",value:function(e){if(this._tileStrategy&&this.tileRenderer){var t=this._tileStrategy.update(e),r=t.hasMissingTiles,n=t.added,i=t.removed;(n.length||i.length)&&this._proxy.updateTiles({added:n,removed:i}),r&&this.requestUpdate(),this.notifyChange("updating")}}},{key:"attach",value:function(){var e=this;this.view.timeline.record(this.layer.title+" (FeatureLayer) Attach"),this._tileStrategy=new ve({acquireTile:function(t){return e._acquireTile(t)},releaseTile:function(t){return e._releaseTile(t)},tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add(Object(q.init)(this,"renderingConfigHash",(function(){return e._update()})),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",function(){var t=r(regeneratorRuntime.mark((function t(r){var n,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._set("_onGoingEdits",e._onGoingEdits+1),t.prev=1,n="globalIdField"in e.layer&&e.layer.globalIdField,i=r.deletedFeatures.some((function(e){return-1===e.objectId||!e.objectId})),a=n&&e.availableFields.includes(n),!i||a){t.next=5;break}return t.abrupt("return",void je.error(new k.a("mapview-apply-edits","Editing the specified service requires the layer's globalIdField, ".concat(n," to be included the layer's outFields for updates to be reflected on the map"))));case 5:return t.next=7,e._proxy.onEdits(r);case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),Object(x.m)(t.t0);case 12:e._set("_onGoingEdits",Math.max(0,e._onGoingEdits-1));case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}()),"attach")}},{key:"detach",value:function(){this.container.removeAllChildren(),this.handles.remove("attach"),this._updatingPipelineConfig=!1,this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"fetchPopupFeatures",value:(O=r(regeneratorRuntime.mark((function e(t,r){var n,i,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(b.k)(r)||!r.clientGraphics.length){e.next=4;break}if(!((n=r.clientGraphics[0])instanceof P)){e.next=4;break}return e.abrupt("return",[n]);case 4:if(!(i=this.validateFetchPopupFeatures(r))){e.next=7;break}throw i;case 7:if(!Object(b.k)(r)||0!==r.clientGraphics.length){e.next=9;break}return e.abrupt("return",[]);case 9:if(a=this.fetchClientPopupFeatures(r),t){e.next=12;break}return e.abrupt("return",a);case 12:return s=this._fetchServicePopupFeatures(t,r),e.abrupt("return",Object(x.k)([a,s]).then(_.d));case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"_fetchServicePopupFeatures",value:(m=r(regeneratorRuntime.mark((function t(r,n){var i,a,s,u,o,c,l,p,f,d,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("stream"!==this.layer.type&&"ogc-feature"!==this.layer.type){t.next=2;break}return t.abrupt("return",[]);case 2:return t.next=4,this.createPopupQuery(n);case 4:if(i=t.sent,a=this.layer,s=a.renderer,u=Object(b.k)(n)?n.event:null,o=Object(L.a)({renderer:s,event:u}),i.geometry=this.createFetchPopupFeaturesQueryGeometry(r,o),c=new Set,l=a.objectIdField,p=Object(b.k)(n)?n.clientGraphics:null){f=e(p);try{for(f.s();!(d=f.n()).done;)h=d.value,c.add(h.attributes[l])}catch(y){f.e(y)}finally{f.f()}}return t.abrupt("return",a.queryFeatures(i).then((function(e){return e.features.filter((function(e){return!c.has(e.attributes[l])}))})));case 13:case"end":return t.stop()}}),t,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return Object(z.a)(e,t,this.view)}},{key:"isUpdating",value:function(){return null!=this.layer.renderer&&(null!=this._updatingRequiredFieldsPromise||null==this.tileRenderer||!this._proxy||!this._proxy.isReady||this._pipelineIsUpdating||this._updatingPipelineConfig||this.tileRenderer.updating||this._onGoingEdits>0)}},{key:"_createClientOptions",value:function(){var e=this;return{setUpdating:function(t){e._set("_pipelineIsUpdating",t)},emitEvent:function(t){e.emit(t.name,t.event)}}}},{key:"_detectQueryMode",value:(g=r(regeneratorRuntime.mark((function e(t){var r,n,i,a,s,u,o,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("path"in t)||!Object(U.c)(t.path)||"feature"!==this.layer.type||"point"!==this.layer.geometryType||this.layer.capabilities.operations.supportsEditing||!Object(p.a)("featurelayer-snapshot-enabled")){e.next=15;break}return e.prev=1,e.next=4,this.layer.queryFeatureCount();case 4:if(!((r=e.sent)<=Object(p.a)("featurelayer-snapshot-point-min-threshold"))){e.next=7;break}return e.abrupt("return",{mode:"snapshot",featureCount:r});case 7:if(n=Object(p.a)("featurelayer-snapshot-point-max-threshold"),i=Object(p.a)("featurelayer-snapshot-point-coverage"),a=this.view.extent,s=this.layer.fullExtent,u=null==s?void 0:s.clone().intersection(a),o=(null==u?void 0:u.width)*(null==u?void 0:u.height),c=(null==s?void 0:s.width)*(null==s?void 0:s.height),l=0===c?0:o/c,!(r<=n&&l>=i)){e.next=10;break}return e.abrupt("return",{mode:"snapshot",featureCount:r});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),je.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:e.t0});case 15:return e.abrupt("return",{mode:"on-demand"});case 16:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e){return g.apply(this,arguments)})},{key:"_createServiceOptions",value:(c=r(regeneratorRuntime.mark((function e(){var t,r,n,i,a,s,u,o,c,l,p,f,d,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"!==(t=this.layer).type){e.next=3;break}return e.abrupt("return",null);case 3:if(r=t.capabilities,n=t.objectIdField,i=t.fields.map((function(e){return e.toJSON()})),a=t.fullExtent&&t.fullExtent.toJSON(),s=Object(J.a)(t.geometryType),u=t.timeInfo&&t.timeInfo.toJSON()||null,o=t.spatialReference?t.spatialReference.toJSON():null,c="feature"===t.type?t.customParameters:null,l="feature"===t.type?t.globalIdField:null,"ogc-feature"!==t.type){e.next=8;break}p=t.source.getFeatureDefinition(),e.next=15;break;case 8:if(!ge(t.source)){e.next=14;break}return e.next=11,t.source.openPorts();case 11:p=e.sent,e.next=15;break;case 14:t.parsedUrl&&(p=Object(h.a)(t.parsedUrl),"dynamicDataSource"in t&&t.dynamicDataSource&&(p.query={layer:JSON.stringify({source:t.dynamicDataSource})}));case 15:return e.next=17,this._detectQueryMode(p);case 17:return f=e.sent,d=f.mode,y=f.featureCount,e.abrupt("return",{type:d,featureCount:y,globalIdField:l,maxRecordCount:r.query.maxRecordCount,tileMaxRecordCount:r.query.tileMaxRecordCount,capabilities:r,fields:i,fullExtent:a,geometryType:s,objectIdField:n,source:p,timeInfo:u,spatialReference:o,customParameters:c});case 21:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"_createMemoryServiceOptions",value:(u=r(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.openPorts();case 2:return r=e.sent,e.abrupt("return",o(o({},this._createServiceOptions()),{},{type:"memory",source:r}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"_cleanUpQuery",value:function(e){var t=C.a.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}},{key:"_createUpdateClusterSizeTask",value:function(e,t){var n=this;return this.watch("_aggregateValueRanges",function(){var i=r(regeneratorRuntime.mark((function r(i){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n._updateClusterEffectiveRendererSizeVariable(e,t,i),n._updatingPipelineConfig||n.tileRenderer.onConfigUpdate(n._effectiveRenderer);case 1:case"end":return r.stop()}}),r)})));return function(e){return i.apply(this,arguments)}}())}},{key:"_updateClusterEffectiveRendererSizeVariable",value:(s=r(regeneratorRuntime.mark((function e(t,r,n){var i,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.dynamicClusterSize&&"visualVariables"in t&&t.visualVariables&&(i=Object(D.c)(t.visualVariables),Object(b.k)(i)&&"cluster_count"===i.field&&(a=t.visualVariables.indexOf(i),t.visualVariables[a]=Object(D.a)(r,n),(s=t.clone()).dynamicClusterSize=!0,this._set("_effectiveRenderer",s)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return s.apply(this,arguments)})},{key:"_getEffectiveRenderer",value:function(){var e=this.layer.renderer,t=this.layer.featureReduction;if(Object(b.k)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"cluster"===t.type&&Object(D.d)(e)){var r=t,n=[],i=Object(D.b)(n,e,r,this._aggregateValueRanges);return Object(b.b)(this._updateClusterSizeTask,(function(e){return e.remove()})),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(i,r),{renderer:i,aggregateFields:n,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}},{key:"_acquireTile",value:function(e){var t=this,r=this.tileRenderer.acquireTile(e);return r.once("attach",(function(){t.requestUpdate()})),r}},{key:"_releaseTile",value:function(e){this.tileRenderer.releaseTile(e)}},{key:"_initTileRenderer",value:(i=r(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(){var e=r(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:e.t0=t.type,e.next="class-breaks"===e.t0||"simple"===e.t0||"unique-value"===e.t0||"dot-density"===e.t0||"dictionary"===e.t0?5:"heatmap"===e.t0?10:15;break;case 5:return e.next=7,Promise.all([a.e(3),a.e(0),a.e(176)]).then(a.bind(null,"wfc5"));case 7:return e.t1=e.sent.default,e.t2=r,e.abrupt("return",new e.t1(e.t2));case 10:return e.next=12,Promise.all([a.e(3),a.e(0),a.e(175)]).then(a.bind(null,"jncx"));case 12:return e.t3=e.sent.default,e.t4=r,e.abrupt("return",new e.t3(e.t4));case 15:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()(t,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});case 2:return n=e.sent,e.abrupt("return",(this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null),this.destroyed?null:(this._proxy.tileRenderer=n,this._set("tileRenderer",n),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(t),this.requestUpdate(),this.tileRenderer)));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_createTileRendererHash",value:function(e){return"".concat("heatmap"===e.type?"heatmap":"symbol",".").concat("dot-density"===e.type)}},{key:"_createFeatureDataHash",value:function(e,t,r){var n=e.getAttributeHash(),i=JSON.stringify(t),a=Object(b.k)(r)&&JSON.stringify(r.filter),s=JSON.stringify(this.timeExtent),u="";return this._visibilityOverrides.forEach((function(e){return u+=e})),"".concat(n,".").concat(i,".").concat(a,".").concat(s,".").concat(u)}},{key:"hasFilter",get:function(){return!!(this.filter||"floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length||this._visibilityOverrides.size||this.timeExtent)}},{key:"_injectOverrides",value:function(e){var t=Object(b.k)(e)?e.timeExtent:null,r=Object(b.k)(this.timeExtent)&&Object(b.k)(t)?this.timeExtent.intersection(t):this.timeExtent||t,n=null,i="floorInfo"in this.layer&&this.layer.floorInfo;if(i){var a=Object(b.k)(e)&&e.where;n=this._addFloorFilterClause(a)}if(!this._visibilityOverrides.size&&!r&&!i)return e;var s=Object(b.k)(e)&&e.clone()||new re;return s.hiddenIds=this._visibilityOverrides,s.timeExtent=r,n&&(s.where=n),s}},{key:"_addFloorFilterClause",value:function(e){var t=this.layer,r=e||"";if("floorInfo"in t&&t.floorInfo){var n,i=this.view.floors;if(!i||!i.length)return r;null!=(n=t.floorInfo.viewAllLevelIds)&&n.length&&(i=t.floorInfo.viewAllLevelIds);var a=i.filter((function(e){return""!==e})).map((function(e){return"'"+e+"'"}));a.push("''");var s=t.floorInfo.floorField,u="("+s+" IN ({ids}) OR "+s+" IS NULL)";if(u=u.replace("{ids}",a.join(", ")),Object(b.k)(r)&&r.includes(s)){var o=new RegExp("AND \\("+s+".*NULL\\)","g");r=r.replace(o,""),o=new RegExp("\\("+s+".*NULL\\)","g"),r=(r=r.replace(o,"")).replace(/\s+/g," ").trim()}r=""!==r?"("+r+") AND "+u:u}return""!==r?r:null}},{key:"_createConfiguration",value:function(e,t,r){var n="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,i="feature"===this.layer.type?this.layer.gdbVersion:void 0,a=new Array(V.m),s=this._injectOverrides(t);a[0]=Object(b.k)(s)?s.toJSON():null,a[1]=Object(b.k)(r)&&r.filter?r.filter.toJSON():null;var u=Object(Q.b)(e);if(Object(b.j)(u))return null;var o=Object(A.a)();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:i,historicMoment:n,devicePixelRatio:window.devicePixelRatio||1,filters:a,schema:u,supportsTextureFloat:o.supportsTextureFloat,maxTextureSize:o.maxTextureSize}}},{key:"_hasRequiredSupport",value:function(e){var t;return!("dot-density"===(null==(t=e.renderer)?void 0:t.type)&&!Object(A.a)().supportsTextureFloat&&(je.error(new k.a("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))}},{key:"_onceTilesUpdated",value:function(){return this.requestUpdate(),Object(q.whenFalseOnce)(this,"_pipelineIsUpdating",!1)}},{key:"_lockGPUUploads",value:function(){this.tileRenderer&&this.tileRenderer.lockGPUUploads()}},{key:"_unlockGPUUploads",value:function(){this.tileRenderer&&this.tileRenderer.unlockGPUUploads()}},{key:"_forceAttributeTextureUpload",value:function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}},{key:"_update",value:function(){var e=this;this.view.timeline.begin(this.layer.title+" (FeatureLayer) Initial Pipeline Config");var t=this._doUpdate();this._updatingPromise=t;var r=function(){t===e._updatingPromise&&e._set("_updatingPipelineConfig",!1),e.view&&e.view.timeline.end(e.layer.title+" (FeatureLayer) Initial Pipeline Config")};t.then(r).catch((function(e){Object(x.m)(e)||je.error(e),r()}))}},{key:"_addHighlight",value:function(t){var r,n=e(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(this._highlightIds.has(i)){var a=this._highlightIds.get(i);this._highlightIds.set(i,a+1)}else this._highlightIds.set(i,1)}}catch(s){n.e(s)}finally{n.f()}this._updateHighlight().catch((function(e){Object(x.m)(e)||je.error(e)}))}},{key:"_removeHighlight",value:function(t){var r,n=e(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(this._highlightIds.has(i)){var a=this._highlightIds.get(i)-1;0===a?this._highlightIds.delete(i):this._highlightIds.set(i,a)}}}catch(s){n.e(s)}finally{n.f()}this._updateHighlight().catch((function(e){Object(x.m)(e)||je.error(e)}))}},{key:"_createHittestResult",value:function(e){return e.layer=this.layer,e.sourceLayer=this.layer,Object(b.k)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}},{key:"_hitTest",value:(n=r(regeneratorRuntime.mark((function e(t,r){var n,i,a,s,u,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended&&this.tileRenderer){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.tileRenderer.hitTest(t,r);case 4:if(0!==(n=e.sent).length){e.next=9;break}return e.next=8,Object(x.a)(1);case 8:return e.abrupt("return",null);case 9:if(function(e){return(2147483648&e)>>>31==1}(i=n[0])){e.next=15;break}return e.next=13,this._proxy.getFeature(i);case 13:return a=e.sent,e.abrupt("return",Object(b.b)(a,(function(e){return o._createHittestResult(S.a.fromJSON(e))})));case 15:return e.next=17,this._proxy.getAggregate(i);case 17:if(s=e.sent,!Object(b.j)(s)){e.next=20;break}return e.abrupt("return",null);case 20:if(!Object(b.k)(s.referenceId)){e.next=25;break}return e.next=23,this._proxy.getFeature(s.referenceId);case 23:return u=e.sent,e.abrupt("return",Object(b.b)(u,(function(e){return o._createHittestResult(S.a.fromJSON(e))})));case 25:return e.abrupt("return",this._createHittestResult(P.fromJSON(s)));case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}]),F}((me=Object(N.a)(Object(le.a)(M.a)),Oe=function(t){d(c,t);var i,a,u,o=y(c);function c(){var e;l(this,c);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=o.call.apply(o,[this].concat(r)))._updatingRequiredFieldsPromise=null,e.effect=null,e.filter=null,e.timeExtent=null,e.layer=null,e.requiredFields=[],e.view=null,e}return f(c,[{key:"initialize",value:function(){var e=this;Object(q.init)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","effect","layer.timeInfo","layer.floorInfo","timeExtent"],(function(){return e._handleRequiredFieldsChange()}),!0),Object(q.on)(this,"view.floors","change",(function(){return e._handleRequiredFieldsChange()}))}},{key:"availableFields",get:function(){var e=this.layer,t=this.layer.fields,r=this.requiredFields;return"outFields"in e&&e.outFields?Object(se.i)(t,[].concat(n(Object(se.t)(t,e.outFields)),n(r))):Object(se.i)(t,r)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(e){ce.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"highlight",value:function(e){throw new Error("missing implementation")}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=Object(b.k)(this.filter)?this.filter.createQuery(e):new C.a(e);return Object(b.k)(this.timeExtent)&&(t.timeExtent=Object(b.k)(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}},{key:"queryFeatures",value:function(e,t){throw new Error("missing implementation")}},{key:"queryObjectIds",value:function(e,t){throw new Error("missing implementation")}},{key:"queryFeatureCount",value:function(e,t){throw new Error("missing implementation")}},{key:"queryExtent",value:function(e,t){throw new Error("missing implementation")}},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length"))return Object(ae.e)()}},{key:"_handleRequiredFieldsChange",value:function(){var e=this,t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then((function(){e._updatingRequiredFieldsPromise===t&&e._set("_updatingRequiredFieldsPromise",null)}))}},{key:"_updateRequiredFields",value:(u=r(regeneratorRuntime.mark((function t(){var r,n,i,a,s,u,o,c,l,p,f,d,h,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.layer&&this.view){t.next=2;break}return t.abrupt("return");case 2:return r="3d"===this.view.type,n=this.layer,i=this.layer,a=i.fields,s=i.objectIdField,u=i.renderer,o=i.displayField,c=n.featureReduction,l=new Set,t.next=13,Object(x.j)([u?u.collectRequiredFields(l,a):null,Object(se.g)(l,n),r?Object(se.b)(l,n):null,Object(b.k)(this.filter)?Object(se.f)(l,n,this.filter):null,this.effect?Object(se.f)(l,n,this.effect.filter):null,c?Object(se.c)(l,n,c):null]);case 13:p=t.sent,n.timeInfo&&this.timeExtent&&Object(se.e)(l,n.fields,[n.timeInfo.startField,n.timeInfo.endField]),"feature"===n.type&&n.floorInfo&&Object(se.e)(l,n.fields,[n.floorInfo.floorField]),f=e(p);try{for(f.s();!(d=f.n()).done;)(h=d.value).error&&ce.error(h.error)}catch(v){f.e(v)}finally{f.f()}Object(se.d)(l,a,s),r&&o&&Object(se.d)(l,a,o),y=Array.from(l).sort(),this._set("requiredFields",y);case 20:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"validateFetchPopupFeatures",value:function(e){var t=this.layer;return this.layer.popupEnabled?Object(oe.a)(this.layer,e)?void 0:new k.a("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new k.a("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:t})}},{key:"fetchClientPopupFeatures",value:(a=r(regeneratorRuntime.mark((function t(r){var n,i,a,s,u,o,c,l,p,f,d,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=Object(b.k)(r)?r.clientGraphics:null)&&0!==n.length){t.next=3;break}return t.abrupt("return",Promise.resolve([]));case 3:if(i=[],a=[],s=this.layer,u=Object(oe.a)(s,r),Object(b.k)(u)){t.next=6;break}return t.abrupt("return",Promise.resolve([]));case 6:return t.next=8,this._loadArcadeModules(u);case 8:return o=t.sent,c=o&&o.arcadeUtils.hasGeometryOperations(u),t.next=12,this.createPopupQuery(r);case 12:l=t.sent,p=Object(se.t)(s.fields,l.outFields),f=e(n);try{for(f.s();!(d=f.n()).done;)h=d.value,c||!Object(se.h)(p,h)?a.push(h):i.push(h)}catch(y){f.e(y)}finally{f.f()}return t.abrupt("return","stream"===s.type||0===a.length?Promise.resolve(i):(l.objectIds=a.map((function(e){return e.attributes[s.objectIdField]})),s.queryFeatures(l).then((function(e){return i.concat(e.features)})).catch((function(){return a}))));case 17:case"end":return t.stop()}}),t,this)}))),function(e){return a.apply(this,arguments)})},{key:"createPopupQuery",value:(i=r(regeneratorRuntime.mark((function e(t){var r,n,i,a,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.layer,n=r.createQuery(),i=Object(oe.a)(r,t),e.t0=Object(b.k)(i),!e.t0){e.next=8;break}return e.next=7,this._loadArcadeModules(i);case 7:e.t0=e.sent;case 8:return a=e.t0,s=Object(b.k)(i)&&a&&a.arcadeUtils.hasGeometryOperations(i),u=!("point"!==r.geometryType&&!s),n.returnGeometry=u,n.returnZ=u,n.returnM=u,e.next=16,Object(oe.b)(this.layer,i);case 16:return n.outFields=e.sent,n.outSpatialReference=this.view.spatialReference,e.abrupt("return",n);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"canResume",value:function(){return!(!s(g(c.prototype),"canResume",this).call(this)||Object(b.k)(this.timeExtent)&&this.timeExtent.isEmpty)}}]),c}(me),Object(c.a)([Object(O.b)()],Oe.prototype,"_updatingRequiredFieldsPromise",void 0),Object(c.a)([Object(O.b)({readOnly:!0})],Oe.prototype,"availableFields",null),Object(c.a)([Object(O.b)({type:ie})],Oe.prototype,"effect",void 0),Object(c.a)([Object(O.b)({type:re})],Oe.prototype,"filter",void 0),Object(c.a)([Object(O.b)(ue.a)],Oe.prototype,"timeExtent",void 0),Object(c.a)([Object(O.b)()],Oe.prototype,"layer",void 0),Object(c.a)([Object(O.b)({type:Number})],Oe.prototype,"maximumNumberOfFeatures",null),Object(c.a)([Object(O.b)({readOnly:!0,type:Boolean})],Oe.prototype,"maximumNumberOfFeaturesExceeded",null),Object(c.a)([Object(O.b)({readOnly:!0})],Oe.prototype,"requiredFields",void 0),Object(c.a)([Object(O.b)()],Oe.prototype,"suspended",void 0),Object(c.a)([Object(O.b)()],Oe.prototype,"view",void 0),Oe=Object(c.a)([Object(j.a)("esri.views.layers.FeatureLayerView")],Oe)));Object(c.a)([Object(O.b)()],ke.prototype,"_serviceOptions",void 0),Object(c.a)([Object(O.b)()],ke.prototype,"_proxy",void 0),Object(c.a)([Object(O.b)()],ke.prototype,"_pipelineIsUpdating",void 0),Object(c.a)([Object(O.b)()],ke.prototype,"_updatingPipelineConfig",void 0),Object(c.a)([Object(O.b)()],ke.prototype,"_effectiveRenderer",void 0),Object(c.a)([Object(O.b)()],ke.prototype,"_aggregateValueRanges",void 0),Object(c.a)([Object(O.b)()],ke.prototype,"_onGoingEdits",void 0),Object(c.a)([Object(O.b)()],ke.prototype,"_isRefreshing",void 0),Object(c.a)([Object(O.b)()],ke.prototype,"labelsVisible",null),Object(c.a)([Object(O.b)({type:re})],ke.prototype,"filter",void 0),Object(c.a)([Object(O.b)({type:ie})],ke.prototype,"effect",null),Object(c.a)([Object(O.b)({readOnly:!0})],ke.prototype,"effects",null),Object(c.a)([Object(O.b)({readOnly:!0})],ke.prototype,"queryMode",null),Object(c.a)([Object(O.b)()],ke.prototype,"renderingConfigHash",null),Object(c.a)([Object(O.b)()],ke.prototype,"tileRenderer",void 0),Object(c.a)([Object(O.b)()],ke.prototype,"updating",void 0),ke=Object(c.a)([Object(j.a)("esri.views.2d.layers.FeatureLayerView2D")],ke),i.default=ke},NIRN:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("6S2I"),i=r("zlDU"),a=r("yE7X"),s=r("yN2G"),u=n.a.getLogger("esri.views.2d.engine.webgl");function o(e){return Object(s.o)(e.minDataValue)&&Object(s.o)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?a.e.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?a.e.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?a.e.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?a.e.SIZE_UNIT_VALUE:(u.error(new i.a("mapview-bad-type","Found invalid size VisualVariable",e)),a.e.NONE)}},NloG:function(e,t,r){"use strict";var n=r("pO5D"),i=(r("wSAH"),r("6S2I")),a=(r("zqDF"),r("WbKI")),s=r("04ZG"),u=(r("4EHJ"),r("ju1D"),r("9AIY"),r("/CmD")),o=r("zm0L"),c=r("pdg3"),p=r("+rMe"),h=r("kJYu"),b=function(e){d(r,e);var t=y(r);function r(e){var n;return l(this,r),(n=t.call(this,e)).layer=null,n.parent=null,n}return f(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";throw i.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(n,"', id: '").concat(r,"')"),t),t}}))}},{key:"fullOpacity",get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}(Object(h.b)(Object(c.a)(Object(p.b)(o.a.EventedMixin(u.a)))));Object(n.a)([Object(a.b)()],b.prototype,"fullOpacity",null),Object(n.a)([Object(a.b)()],b.prototype,"layer",void 0),Object(n.a)([Object(a.b)()],b.prototype,"parent",void 0),Object(n.a)([Object(a.b)({readOnly:!0})],b.prototype,"suspended",null),Object(n.a)([Object(a.b)({readOnly:!0})],b.prototype,"suspendInfo",null),Object(n.a)([Object(a.b)({readOnly:!0})],b.prototype,"legendEnabled",null),Object(n.a)([Object(a.b)({type:Boolean,readOnly:!0})],b.prototype,"updating",null),Object(n.a)([Object(a.b)()],b.prototype,"visible",null),b=Object(n.a)([Object(s.a)("esri.views.layers.LayerView")],b),t.a=b},U282:function(e,t,r){"use strict";function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function i(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,n=0;n<e.length;n++){var i=e[n].size;"number"==typeof i&&(t+=i,r++)}return t/r}(e.stops):t}function a(e,t){if(!t)return e;var r=t.filter((function(e){return"size"===e.type})).map((function(t){var r=t.maxSize,n=t.minSize;return(i(r,e)+i(n,e))/2})),n=0,a=r.length;if(0===a)return e;for(var s=0;s<a;s++)n+=r[s];var u=Math.floor(n/a);return Math.max(u,e)}function s(e){var t=e&&e.renderer,r="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return r;var i="visualVariables"in t?a(r,t.visualVariables):r;if("simple"===t.type)return n(i,t.symbol);if("unique-value"===t.type){var s=i;return t.uniqueValueInfos.forEach((function(e){s=n(s,e.symbol)})),s}if("class-breaks"===t.type){var u=i;return t.classBreakInfos.forEach((function(e){u=n(u,e.symbol)})),u}return i}r.d(t,"a",(function(){return s}))},Vm2Q:function(e,t,r){"use strict";r.d(t,"a",(function(){return S}));var n,i=r("pO5D"),a=(r("wSAH"),r("6S2I"),r("zqDF"),r("WbKI")),u=r("04ZG"),o=(r("4EHJ"),r("ju1D"),r("9AIY"),r("LE9a")),c=r("fX31"),p=r("N5XI"),h=r("ZuQG"),b=r("L1EH"),v=r("AMBt"),m=r("N2DF"),O=r("OvF4"),j=r("Ehki"),k=r("qatw");r("4GrV");var _={base:m.a,key:"type",typeMap:{extent:O.a,polygon:j.a}},x=n=function(e){d(r,e);var t=y(r);function r(){var e;return l(this,r),(e=t.apply(this,arguments)).type="geometry",e.geometry=null,e}return f(r,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new n({geometry:this.geometry.clone()})}}]),r}(h.a);Object(i.a)([Object(a.b)({types:_,json:{read:k.a,write:!0}})],x.prototype,"geometry",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],x.prototype,"version",null);var w=x=n=Object(i.a)([Object(u.a)("esri.views.layers.support.Geometry")],x),R=function(e){d(r,e);var t=y(r);function r(){var e;return l(this,r),(e=t.apply(this,arguments)).type="path",e.path=[],e}return f(r,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(h.a);Object(i.a)([Object(a.b)({type:[[[Number]]],json:{write:!0}})],R.prototype,"path",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],R.prototype,"version",null),R=Object(i.a)([Object(u.a)("esri.views.layers.support.Path")],R);var I=o.a.ofType({key:"type",base:h.a,typeMap:{rect:b.a,path:R,geometry:w}}),S=function(e){var t=function(e){d(r,e);var t=y(r);function r(){var e;return l(this,r),(e=t.apply(this,arguments)).clips=new I,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}return f(r,[{key:"initialize",value:function(){var e,t=this;this.container||(this.container=new v.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(p.init)(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),Object(p.init)(this,["layer.opacity","container"],(function(){var e,r;t.container&&(t.container.opacity=null!=(e=null==(r=t.layer)?void 0:r.opacity)?e:1)}),!0),Object(p.init)(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),Object(p.init)(this,["layer.effect"],(function(e){t.container&&(t.container.effect=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))}},{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}},{key:"isVisibleAtScale",value:function(e){var t=!0,r=this.layer,n=r.minScale,i=r.maxScale;if(null!=n&&null!=i){var a=!n,s=!i;!a&&e<=n&&(a=!0),!s&&e>=i&&(s=!0),t=a&&s}return t}},{key:"requestUpdate",value:function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"isUpdating",value:function(){return!1}},{key:"isRendering",value:function(){return!1}},{key:"canResume",value:function(){return!!s(g(r.prototype),"canResume",this).call(this)&&this.isVisibleAtScale(this.view.scale)}}]),r}(e);return Object(i.a)([Object(a.b)({type:I,set:function(e){var t=Object(c.b)(e,this._get("clips"),I);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(i.a)([Object(a.b)()],t.prototype,"moving",void 0),Object(i.a)([Object(a.b)()],t.prototype,"attached",void 0),Object(i.a)([Object(a.b)()],t.prototype,"container",void 0),Object(i.a)([Object(a.b)()],t.prototype,"suspended",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(i.a)([Object(a.b)()],t.prototype,"updateRequested",void 0),Object(i.a)([Object(a.b)()],t.prototype,"updating",null),Object(i.a)([Object(a.b)()],t.prototype,"view",void 0),t=Object(i.a)([Object(u.a)("esri.views.2d.layers.LayerView2D")],t)}},rXMu:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return u}));var a=i("srIe"),s=i("wdpY");function u(e){return o.apply(this,arguments)}function o(){return(o=r(regeneratorRuntime.mark((function e(t){var r,i,u,o,c,l,p,f,d,h=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.length>1&&void 0!==h[1]?h[1]:t.popupTemplate,Object(a.k)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fields);case 5:if(i=e.sent,u=r.lastEditInfoEnabled,o=t.objectIdField,c=t.typeIdField,l=t.globalIdField,p=t.relationships,!i.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!u){e.next=19;break}return e.next=16,Object(s.m)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return f=e.t0,d=Object(s.i)(t.fields,[].concat(n(i),n(f))),e.abrupt("return",(c&&d.push(c),d&&o&&Object(s.p)(t.fields,o)&&-1===d.indexOf(o)&&d.push(o),d&&l&&Object(s.p)(t.fields,l)&&-1===d.indexOf(l)&&d.push(l),p&&p.forEach((function(e){var r=e.keyField;d&&r&&Object(s.p)(t.fields,r)&&-1===d.indexOf(r)&&d.push(r)})),d));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e,t){return e.popupTemplate?e.popupTemplate:Object(a.k)(t)&&t.defaultPopupTemplateEnabled&&Object(a.k)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}])}();