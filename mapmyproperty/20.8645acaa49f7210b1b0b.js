(function(){var e={"arcgis-js-api/views/3d/layers/graphics/elevationAlignmentUtils":"/9Lg","arcgis-js-api/renderers/support/clickToleranceUtils":"/E+R","esri/renderers/support/clickToleranceUtils":"/E+R","arcgis-js-api/views/3d/layers/graphics/GraphicState":"/NuL","esri/core/libs/earcut/earcut":"1E+e","arcgis-js-api/core/libs/earcut/earcut":"1E+e","arcgis-js-api/views/3d/interactive/editingTools/manipulatorUtils":"1eTA","arcgis-js-api/views/3d/webgl-engine/lighting/SphericalHarmonics":"2Mej","arcgis-js-api/views/3d/interactive/visualElements/VisualElementResources":"2W+Z","arcgis-js-api/geometry/support/triangulationUtils":"3Zlx","arcgis-js-api/core/libs/gl-matrix-2/factories/vec4f32":"3gjc","arcgis-js-api/views/3d/interactive/editingTools/manipulations/Manipulation":"48/q","arcgis-js-api/views/3d/interactive/editingTools/transformGraphic/GraphicTransformTool":"4QR8","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYAxisManipulation":"6hC7","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYGraphicManipulation":"73uV","arcgis-js-api/views/3d/interactive/editingTools/moveGraphic/GraphicMoveTool":"A5GR","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":"B4Pz","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveManipulation":"BhkK","arcgis-js-api/views/3d/webgl-engine/materials/WaterGLMaterial":"CP88","arcgis-js-api/core/libs/gl-matrix-2/mat2":"CqfC","arcgis-js-api/views/3d/support/debugFlags":"Dk48","arcgis-js-api/views/3d/webgl-engine/lib/renderStats":"FLCf","arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialRep":"FU3N","arcgis-js-api/views/3d/interactive/editingTools/manipulations/config":"Fe95","arcgis-js-api/views/3d/interactive/editingTools/visualElementUtils":"G+tB","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/CommonUniformStore":"GDWR","arcgis-js-api/views/3d/layers/graphics/constants":"HbaO","arcgis-js-api/views/3d/layers/graphics/sdfPrimitives":"J2BX","arcgis-js-api/views/3d/interactive/editingTools/reshapeGraphic/ReshapeOperation":"JXo2","arcgis-js-api/views/3d/webgl-engine/lib/LongVectorMath":"KPBO","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/util/TextureOnly.glsl":"KQg4","arcgis-js-api/views/3d/interactive/editingTools/ManipulatorState":"Kvb2","arcgis-js-api/core/libs/gl-matrix-2/mat2f64":"KwnQ","arcgis-js-api/views/3d/interactive/visualElements/LaserlineVisualElement":"MCHn","arcgis-js-api/views/3d/terrain/OverlayRenderTarget":"N+ip","arcgis-js-api/views/support/drapedUtils":"NbdF","esri/views/support/drapedUtils":"NbdF","arcgis-js-api/views/3d/interactive/editingTools/lineGraphicVisualElementUtils":"PLh7","arcgis-js-api/views/3d/interactive/visualElements/LineVisualElement":"PXiz","arcgis-js-api/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":"Px2u","arcgis-js-api/views/3d/webgl-engine/lighting/SceneLighting":"QDiq","arcgis-js-api/views/3d/interactive/visualElements/OutlineVisualElement":"R4nD","arcgis-js-api/views/3d/interactive/editingTools/transformGraphic/GraphicScaleRotateTransform":"RWrl","arcgis-js-api/views/3d/webgl-engine/lib/RenderContext":"Raj5","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":"RdU/","arcgis-js-api/views/3d/interactive/visualElements/VerticesVisualElement":"T95R","arcgis-js-api/views/3d/interactive/editingTools/snapping/SnapToScene":"TIRl","arcgis-js-api/views/3d/webgl-engine/shaders/HUDMaterial.glsl":"VQEQ","arcgis-js-api/views/3d/interactive/editingTools/settings":"X5J5","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":"Xakh","arcgis-js-api/views/3d/webgl-engine/lib/TextureTechnique":"XcBT","arcgis-js-api/views/3d/webgl-engine/lib/ResizableFloat32Array":"YseA","arcgis-js-api/views/3d/webgl-engine/materials/renderers/MergedRenderer":"ZeO9","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":"aRjO","arcgis-js-api/views/3d/interactive/visualElements/DrapedVisualElementResources":"as1Q","arcgis-js-api/views/3d/webgl-engine/lib/RenderGeometry":"cjy9","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":"dl/g","arcgis-js-api/views/3d/interactive/editingTools/manipulations/moveUtils":"dtql","arcgis-js-api/views/3d/webgl-engine/lib/localOrigin":"eHCP","arcgis-js-api/views/3d/layers/graphics/ElevationContext":"fOZq","arcgis-js-api/views/3d/interactive/visualElements/VisualElement":"gxI5","arcgis-js-api/views/3d/layers/graphics/lineUtils":"hADE","arcgis-js-api/views/3d/webgl-engine/lib/GridLocalOriginFactory":"hkmr","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":"hs8d","arcgis-js-api/views/3d/interactive/visualElements/PointVisualElement":"i10q","arcgis-js-api/views/3d/terrain/OverlayRenderer":"ij3I","arcgis-js-api/core/libs/gl-matrix-2/vec4f32":"j2SP","arcgis-js-api/views/3d/webgl-engine/shaders/WaterSurface.glsl":"jl7D","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":"pLfv","arcgis-js-api/views/3d/webgl-engine/materials/renderers/Instance":"pbva","arcgis-js-api/views/3d/webgl-engine/shaders/HUDMaterialTechnique":"pqGg","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveZManipulation":"pvGl","arcgis-js-api/views/3d/webgl-engine/lighting/Lightsources":"qUb7","arcgis-js-api/views/3d/interactive/editingTools":"qkUi","arcgis-js-api/core/libs/gl-matrix-2/types/mat4":"qvwY","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":"sQDZ","arcgis-js-api/views/3d/interactive/editingTools/reshapeGraphic/GraphicReshapeTool":"uNfR","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":"uUnu","arcgis-js-api/views/3d/interactive/editingTools/draw/DrawGraphicTool":"ub+M","arcgis-js-api/views/3d/interactive/editingTools/pointGraphicVisualElementUtils":"uinn","arcgis-js-api/views/3d/layers/graphics/pointUtils":"v+nG","arcgis-js-api/views/3d/webgl-engine/materials/WaterTechnique":"v22c","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":"vGsU","arcgis-js-api/core/libs/gl-matrix-2/math/mat2":"vJh7","arcgis-js-api/views/3d/webgl-engine/materials/HUDMaterial":"xFEL","arcgis-js-api/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":"y68M","arcgis-js-api/views/3d/layers/graphics/featureExpressionInfoUtils":"yVFQ","arcgis-js-api/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":"ybGv","arcgis-js-api/views/3d/interactive/editingTools/manipulations/MoveXYDiscManipulation":"yjgM","arcgis-js-api/core/libs/gl-matrix-2/factories/mat2f64":"z4cv","arcgis-js-api/views/3d/webgl-engine/lib/rendererUtils":"znI2"},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"/9Lg":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("FXVB"),r("1m5D"),r("Rdxj"),r("BwdQ"),r("vA3N"),r("mmEe")],void 0===(i=(function(e,t,r,n,i,a,o,s,l){"use strict";function c(e,t,n,i,a){var o=e.z||0;switch(n.mode){case"on-the-ground":var l=s.getElevationAtPoint(t,e,"ground")||0;return a&&(a.verticalDistanceToGround=0,a.sampledElevation=l),l;case"relative-to-ground":l=s.getElevationAtPoint(t,e,"ground")||0;var c=n.geometryZWithOffset(o,i);return a&&(a.verticalDistanceToGround=c,a.sampledElevation=l),c+l;case"relative-to-scene":return l=s.getElevationAtPoint(t,e,"scene")||0,c=n.geometryZWithOffset(o,i),a&&(a.verticalDistanceToGround=c,a.sampledElevation=l),c+l;case"absolute-height":if(c=n.geometryZWithOffset(o,i),a){var u=s.getElevationAtPoint(t,e,"ground")||0;a.verticalDistanceToGround=c-u,a.sampledElevation=u}return c;default:return r.neverReached(n.mode),0}}var u;Object.defineProperty(t,"__esModule",{value:!0}),t.SymbolUpdateType=t.applyElevationAlignmentForHUD=t.needsElevationUpdates3D=t.needsElevationUpdates2D=t.elevationModeChangeUpdateType=t.evaluateElevationAlignmentAtPoint=t.applyPerVertexElevationAlignment=void 0,t.applyPerVertexElevationAlignment=function(e,t,r,n,i,a,o,s,c,u,d){var h,f,v=p[d.mode],m=0;if(l.bufferToBuffer(e,t,r,n,c.spatialReference,i,s)&&(v.requiresAlignment(d)?(m=v.applyElevationAlignmentBuffer(n,i,a,o,s,c,u,d),h=a,f=o):(h=n,f=i),l.bufferToBuffer(h,c.spatialReference,f,a,u.spatialReference,o,s)))return m},t.evaluateElevationAlignmentAtPoint=c,t.elevationModeChangeUpdateType=function(e,t,r){return null==t||null==r?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?u.UPDATE:e.onTheGroundChanged},t.needsElevationUpdates2D=function(e){return"relative-to-ground"===e||"relative-to-scene"===e},t.needsElevationUpdates3D=function(e){return"absolute-height"!==e},t.applyElevationAlignmentForHUD=function(e,t,r,i,a){var s=c(t,r,a,i,h);o.updateVertexAttributeAuxpos1w(e,h.verticalDistanceToGround);var u=h.sampledElevation,p=n.mat4.copy(d,e.objectTransformation);return f[0]=t.x,f[1]=t.y,f[2]=s,l.computeLinearTransformation(t.spatialReference,f,p,i.spatialReference)?e.objectTransformation=p:console.warn("Could not locate symbol object properly, it might be misplaced"),u},function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(u=t.SymbolUpdateType||(t.SymbolUpdateType={}));var p={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,n,i,a,o,s){var l=s.calculateOffsetRenderUnits(o),c=s.featureExpressionInfoContext;t*=3,n*=3;for(var u=0;u<i;++u){var p=e[t+1],d=e[t+2];r[n+0]=e[t+0],r[n+1]=p,r[n+2]=null==c?d+l:l,t+=3,n+=3}return 0},requiresAlignment:function(e){return 0!==e.meterUnitOffset||null!=e.featureExpressionInfoContext}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,n,i,a){var o=0,s=a.spatialReference;t*=3,n*=3;for(var l=0;l<i;++l){var c=e[t+0],u=e[t+1],p=a.getElevation(c,u,e[t+2],s,"ground")||0;o+=p,r[n+0]=c,r[n+1]=u,r[n+2]=p,t+=3,n+=3}return o/i},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,n,i,a,o,s){var l=0,c=s.calculateOffsetRenderUnits(o),u=s.featureExpressionInfoContext,p=a.spatialReference;t*=3,n*=3;for(var d=0;d<i;++d){var h=e[t+0],f=e[t+1],v=e[t+2],m=a.getElevation(h,f,v,p,"ground")||0;l+=m,r[n+0]=h,r[n+1]=f,r[n+2]=null==u?v+m+c:m+c,t+=3,n+=3}return l/i},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,n,i,a,o,s){var l=0,c=s.calculateOffsetRenderUnits(o),u=s.featureExpressionInfoContext,p=a.spatialReference;t*=3,n*=3;for(var d=0;d<i;++d){var h=e[t+0],f=e[t+1],v=e[t+2],m=a.getElevation(h,f,v,p,"scene")||0;l+=m,r[n+0]=h,r[n+1]=f,r[n+2]=null==u?v+m+c:m+c,t+=3,n+=3}return l/i},requiresAlignment:function(){return!0}}},d=i.mat4f64.create(),h={verticalDistanceToGround:0,sampledElevation:0},f=a.vec3f64.create()}).apply(null,n))||(e.exports=i)},"/E+R":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function r(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,n=0;n<e.length;n++){var i=e[n].size;"number"==typeof i&&(t+=i,r++)}return t/r}(e.stops):t}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateTolerance=void 0,t.calculateTolerance=function(e){var t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;var a="visualVariables"in t?function(e,t){if(!t)return e;var r=t.filter((function(e){return"size"===e.type})).map((function(t){var r=t.minSize;return(n(t.maxSize,e)+n(r,e))/2})),i=0,a=r.length;if(0===a)return e;for(var o=0;o<a;o++)i+=r[o];var s=Math.floor(i/a);return Math.max(s,e)}(i,t.visualVariables):i;if("simple"===t.type)return r(a,t.symbol);if("unique-value"===t.type){var o=a;return t.uniqueValueInfos.forEach((function(e){o=r(o,e.symbol)})),o}if("class-breaks"===t.type){var s=a;return t.classBreakInfos.forEach((function(e){s=r(s,e.symbol)})),s}return a}}).apply(null,n))||(e.exports=i)},"/NuL":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("BcWh"),r("Vx27")],void 0===(i=(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicState=void 0;var a=function(e){function t(t){var r=e.call(this,t)||this;return r.tracking=!1,r.displaying=!1,r.isDraped=!1,r}return r.__extends(t,e),r.__decorate([i.property({constructOnly:!0})],t.prototype,"graphic",void 0),r.__decorate([i.property()],t.prototype,"tracking",void 0),r.__decorate([i.property()],t.prototype,"displaying",void 0),r.__decorate([i.property()],t.prototype,"isDraped",void 0),r.__decorate([i.subclass("esri.views.3d.layers.graphics.GraphicState")],t)}(n.EventedAccessor);t.GraphicState=a}).apply(null,n))||(e.exports=i)},"1E+e":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function r(e,t,r,n,i){var a;if(i===h(e,t,r,n)>0)for(var o=t;o<r;o+=n)a=s(o,e[o],e[o+1],a);else for(o=r-n;o>=t;o-=n)a=s(o,e[o],e[o+1],a);return a&&g(a,a.next)&&(l(a),a=a.next),a}function n(e,t){if(void 0===t&&(t=e),!e)return e;var r,n=e;do{if(r=!1,n.steiner||!g(n,n.next)&&0!==p(n.prev,n,n.next))n=n.next;else{if(l(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function i(e,t,r,s,c,u,p){if(void 0===p&&(p=0),e){!p&&u&&(e=function e(t,r,n,i){for(var a=void 0;a!==t;a=a.next){if(null===(a=a||t).z&&(a.z=m(a.x,a.y,r,n,i)),a.prev.next!==a||a.next.prev!==a)return a.prev.next=a,a.next.prev=a,e(t,r,n,i);a.prevZ=a.prev,a.nextZ=a.next}return t.prevZ.nextZ=null,t.prevZ=null,function(e){for(var t,r=1;;){var n=e,i=void 0;e=null,t=null;for(var a=0;n;){a++,i=n;for(var o=0;o<r&&i;o++)i=i.nextZ;for(var s=r;o>0||s>0&&i;){var l=void 0;0===o?(l=i,i=i.nextZ,s--):0!==s&&i?n.z<=i.z?(l=n,n=n.nextZ,o--):(l=i,i=i.nextZ,s--):(l=n,n=n.nextZ,o--),t?t.nextZ=l:e=l,l.prevZ=t,t=l}n=i}if(t.nextZ=null,r*=2,a<2)return e}}(t)}(e,s,c,u));for(var d=e;e.prev!==e.next;){var h=e.prev,f=e.next;if(u?o(e,s,c,u):a(e))t.push(h.index/r),t.push(e.index/r),t.push(f.index/r),l(e),e=f.next,d=f.next;else if((e=f)===d){p?1===p?i(e=_(e,t,r),t,r,s,c,u,2):2===p&&b(e,t,r,s,c,u):i(n(e),t,r,s,c,u,1);break}}}}function a(e){var t=e.prev,r=e,n=e.next;if(p(t,r,n)>=0)return!1;for(var i=e.next.next,a=i,o=0;i!==e.prev&&(0===o||i!==a);){if(o++,f(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&p(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function o(e,t,r,n){var i=e.prev,a=e,o=e.next;if(p(i,a,o)>=0)return!1;for(var s=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,l=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,c=m(i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,t,r,n),u=m(s,l,t,r,n),d=e.prevZ,h=e.nextZ;d&&d.z>=c&&h&&h.z<=u;){if(d!==e.prev&&d!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&p(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,h!==e.prev&&h!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&p(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(;d&&d.z>=c;){if(d!==e.prev&&d!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&p(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;h&&h.z<=u;){if(h!==e.prev&&h!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&p(h.prev,h,h.next)>=0)return!1;h=h.nextZ}return!0}function s(e,t,r,n){var i=new M(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function l(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function c(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function u(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r.prev;var l,c=r,u=r.x,p=r.y,d=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&f(a<p?i:o,a,u,p,a<p?o:i,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&v(n,e)&&(r=n,d=l),n=n.next;return r}(e,t)){var r=w(t,e);n(r,r.next)}}function p(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function d(e,t,r,n){return!!(g(e,t)&&g(r,n)||g(e,n)&&g(r,t))||p(e,t,r)>0!=p(e,t,n)>0&&p(r,n,e)>0!=p(r,n,t)>0}function h(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}function f(e,t,r,n,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function v(e,t){return p(e.prev,e,e.next)<0?p(e,t,e.next)>=0&&p(e,e.prev,t)>=0:p(e,t,e.prev)<0||p(e,e.next,t)<0}function m(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e,t){return e.x===t.x&&e.y===t.y}function y(e,t){return e.x-t.x}function _(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!g(i,a)&&d(i,n,n.next,a)&&v(i,a)&&v(a,i)&&(t.push(i.index/r),t.push(n.index/r),t.push(a.index/r),l(n),l(n.next),n=e=a),n=n.next}while(n!==e);return n}function b(e,t,r,a,o,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.index!==c.index&&x(l,c)){var u=w(l,c);return l=n(l,l.next),u=n(u,u.next),i(l,t,r,a,o,s),void i(u,t,r,a,o,s)}c=c.next}l=l.next}while(l!==e)}function x(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&d(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&v(e,t)&&v(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function w(e,t){var r=new M(e.index,e.x,e.y),n=new M(t.index,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}Object.defineProperty(t,"__esModule",{value:!0}),t.deviation=t.earcut=void 0,t.earcut=function(e,t,a){var o,s,l,p,d,h=t&&t.length,f=h?t[0]*a:e.length,v=r(e,0,f,a,!0),m=new Array;if(!v||v.next===v.prev)return m;if(h&&(v=function(e,t,i,a){for(var o=new Array,s=0,l=t.length;s<l;s++){var p=r(e,t[s]*a,s<l-1?t[s+1]*a:e.length,a,!1);p===p.next&&(p.steiner=!0),o.push(c(p))}o.sort(y);for(var d=0,h=o;d<h.length;d++)u(h[d],i),i=n(i,i.next);return i}(e,t,v,a)),e.length>80*a){o=l=e[0],s=p=e[1];for(var g=a;g<f;g+=a){var _=e[g],b=e[g+1];o=Math.min(o,_),s=Math.min(s,b),l=Math.max(l,_),p=Math.max(p,b)}d=0!==(d=Math.max(l-o,p-s))?1/d:0}return i(v,m,a,o,s,d),m},t.deviation=function(e,t,r,n){var i=t&&t.length,a=Math.abs(h(e,0,i?t[0]*r:e.length,r));if(i)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(h(e,t[o]*r,o<s-1?t[o+1]*r:e.length,r));var l=0;for(o=0;o<n.length;o+=3){var c=n[o]*r,u=n[o+1]*r,p=n[o+2]*r;l+=Math.abs((e[c]-e[p])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[p+1]-e[c+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)};var M=function(e,t,r){this.index=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}).apply(null,n))||(e.exports=i)},"1eTA":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("DtIM")],void 0===(i=(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.disableDisplayOnGrab=t.canMoveZ=void 0,t.canMoveZ=function(e,t){return void 0===t&&(t=n.getGraphicEffectiveElevationInfo(e)),"on-the-ground"!==t.mode&&!(r.isNone(e.geometry)||!e.geometry.hasZ)},t.disableDisplayOnGrab=function(e,t){var n=null,i=e.events.on("grab-changed",(function(i){r.isSome(n)&&(n.remove(),n=null),"start"===i.action?(n=e.disableDisplay(),t&&t(i)):t&&t(i)}));return{remove:function(){r.isSome(n)&&n.remove(),i.remove()}}}}).apply(null,n))||(e.exports=i)},"2Mej":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+"),r("0LE5"),r("Rdxj"),r("KPBO"),r("qUb7")],void 0===(i=(function(e,t,r,n,i,a,o){"use strict";function s(e){return(e+1)*(e+1)}function l(e){return r.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function c(e,t,r){var n=e[0],i=e[1],a=e[2],o=r||[];return o.length=s(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*n,o[2]=.4886025119*a,o[3]=.4886025119*i),t>=2&&(o[4]=1.09254843059*n*i,o[5]=1.09254843059*i*a,o[6]=.31539156525*(3*a*a-1),o[7]=1.09254843059*n*a,o[8]=.54627421529*(n*n-i*i)),o}function u(e,t){var r=s(e),n=t||{r:[],g:[],b:[]};n.r.length=n.g.length=n.b.length=r;for(var i=0;i<r;i++)n.r[i]=n.g[i]=n.b[i]=0;return n}function p(e,t){for(var r=l(t.r.length),i=0,o=e;i<o.length;i++){var s=o[i];n.vec3.negate(y,s.direction),c(y,r,m),a.elementwiseProduct(m,_),a.scalarProduct(m,s.intensity[0],g),a.add(t.r,g),a.scalarProduct(m,s.intensity[1],g),a.add(t.g,g),a.scalarProduct(m,s.intensity[2],g),a.add(t.b,g)}return t}function d(e,t){c(y,0,m);for(var r=0,n=e;r<n.length;r++){var i=n[r];t.r[0]+=m[0]*_[0]*i.intensity[0]*4*Math.PI,t.g[0]+=m[0]*_[0]*i.intensity[1]*4*Math.PI,t.b[0]+=m[0]*_[0]*i.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.combineLights=t.projectAmbientLights=t.projectFillLights=t.initSHCoefficients=t.computeCoefficients=t.orderFromNumberOfCoefficients=t.numberOfCoefficientsInBand=t.numberOfCoefficients=void 0,t.numberOfCoefficients=s,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=l,t.computeCoefficients=c,t.initSHCoefficients=u,t.projectFillLights=p,t.projectAmbientLights=d,t.combineLights=function(e,t,r){u(t,r.sphericalHarmonics.sh),n.vec3.set(r.main.intensity,0,0,0);var i=!1,s=h,l=f,c=v;s.length=0,l.length=0,c.length=0;for(var m=0,g=e;m<g.length;m++)(b=g[m])instanceof o.MainLight&&!i?(n.vec3.copy(r.main.direction,b.direction),r.main.intensity[0]=b.intensity[0],r.main.intensity[1]=b.intensity[1],r.main.intensity[2]=b.intensity[2],r.main.castShadows=b.castShadows,i=!0):b instanceof o.MainLight||b instanceof o.FillLight?s.push(b):b instanceof o.AmbientLight?l.push(b):b instanceof o.SphericalHarmonicsLight&&c.push(b);p(s,r.sphericalHarmonics.sh),d(l,r.sphericalHarmonics.sh);for(var y=0,_=c;y<_.length;y++){var b=_[y];a.add(r.sphericalHarmonics.sh.r,b.sh.r),a.add(r.sphericalHarmonics.sh.g,b.sh.g),a.add(r.sphericalHarmonics.sh.b,b.sh.b)}};var h=[],f=[],v=[],m=[0],g=[0],y=i.vec3f64.create(),_=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}).apply(null,n))||(e.exports=i)},"2W+Z":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("8MXS"),r("ys4y"),r("ZO6V"),r("ZJC8"),r("yqrJ")],void 0===(i=(function(e,t,r,n,i,a,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisualElementResources=void 0;var l=function(){function e(e){this.resourceFactory=e,this._resources=null,this._hidden=!1,this._attached=!1}return e.prototype.destroy=function(){this._destroyResources()},Object.defineProperty(e.prototype,"object",{get:function(){return r.isSome(this._resources)?this._resources.object:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resources",{get:function(){return r.isSome(this._resources)?this._resources.external:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this._hidden},set:function(e){e!==this._hidden&&(this._hidden=e,this._syncHidden())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())},enumerable:!1,configurable:!0}),e.prototype.recreate=function(){this.attached&&this._createResources()},e.prototype.recreateGeometry=function(){if(this.resourceFactory.recreateGeometry){if(!r.isNone(this._resources)){var e=this._resources.object,t=this.resourceFactory.view._stage;this._resources.external.forEach((function(e){e instanceof i&&t.remove(2,e.id)})),e.removeAllGeometries();for(var n=0,a=this.resourceFactory.recreateGeometry(this._resources.external,e,this._resources.layer);n<a.length;n++)t.add(2,a[n])}}else this.recreate()},e.prototype._createOrDestroyResources=function(){this._attached?this._resources||this._createResources():this._destroyResources()},e.prototype._createResources=function(){var e=this;this._destroyResources();var t=this.resourceFactory.view._stage;if(t){var r=new a("element",{isPickable:!1});t.add(0,r),t.addToViewContent([r.id]);var i=new o({idHint:"element",castShadow:!1}),s=this.resourceFactory.createResources(i,r);s.forEach((function(r){t.add(e._contentTypeFromResource(r),r)})),t.add(1,i),r.addObject(i),this._hidden&&i.setVisible(!1);var l=this.resourceFactory.cameraChanged?n.init(this.resourceFactory.view.state,"camera",(function(t){return e.resourceFactory.cameraChanged(t)})):null;this._resources={layer:r,object:i,external:s,cameraHandle:l}}},e.prototype._contentTypeFromResource=function(e){return e instanceof i?2:e instanceof s?4:3},e.prototype._destroyResources=function(){var e=this;if(!r.isNone(this._resources)){var t=this.resourceFactory.view._stage;t.remove(1,this._resources.object.id),t.remove(0,this._resources.layer.id),this._resources.external.forEach((function(r){t.remove(e._contentTypeFromResource(r),r.id),"dispose"in r&&r.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}},e.prototype._syncHidden=function(){r.isNone(this._resources)||this._resources.object.setVisible(!this._hidden)},e}();t.VisualElementResources=l}).apply(null,n))||(e.exports=i)},"3Zlx":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("1E+e"),r("ZPQp"),r("jmRc")],void 0===(i=(function(e,t,r,n,i){"use strict";function a(e,t,r){for(var i=e.length,a=new Array(i),s=new Array(i),l=new Array(i),c=0,u=0,p=0,d=0,h=0;h<i;++h)d+=e[h].length;for(var f=new Float64Array(3*d),v=0,m=i-1;m>=0;m--){var g=e[m],y=1===r&&!n.isClockwise(g,!1,!1);if(y&&1!==i)a[c++]=g;else{var _=g.length;for(h=0;h<c;++h)_+=a[h].length;var b={index:v,pathLengths:new Array(c+1),count:_,holeIndices:new Array(c)};b.pathLengths[0]=g.length,g.length>0&&(l[p++]={index:v,count:g.length}),v=y?o(g,g.length-1,-1,f,v,g.length,t):o(g,0,1,f,v,g.length,t);for(var x=0;x<c;++x){var w=a[x];b.holeIndices[x]=v,b.pathLengths[x+1]=w.length,w.length>0&&(l[p++]={index:v,count:w.length}),v=o(w,0,1,f,v,w.length,t)}c=0,b.count>0&&(s[u++]=b)}}for(x=0;x<c;++x)(w=a[x]).length>0&&(l[p++]={index:v,count:w.length}),v=o(w,0,1,f,v,w.length,t);return u<i&&(s.length=u),p<i&&(l.length=p),{position:f,polygons:s,outlines:l}}function o(e,t,r,n,i,a,o){i*=3;for(var s=0;s<a;++s){var l=e[t];n[i++]=l[0],n[i++]=l[1],n[i++]=o?l[2]:0,t+=r}return i/3}Object.defineProperty(t,"__esModule",{value:!0}),t.pathsToTriangulationInfo=t.triangulate=void 0,t.triangulate=function(e){for(var t=a(e.rings,e.hasZ,1),n=[],o=0,s=0,l=function(e){var i=e.index,a=new Float64Array(t.position.buffer,3*i*t.position.BYTES_PER_ELEMENT,3*e.count),l=e.holeIndices.map((function(e){return e-i})),c=new Uint32Array(r.earcut(a,l,3));n.push({position:a,faces:c}),o+=a.length,s+=c.length},c=0,u=t.polygons;c<u.length;c++)l(u[c]);var p=function(e,t,r){if(1===e.length)return e[0];for(var n=new Float64Array(t),i=new Uint32Array(r),a=0,o=0,s=0,l=0,c=e;l<c.length;l++){for(var u=c[l],p=0;p<u.position.length;p++)n[a++]=u.position[p];for(p=0;p<u.faces.length;p++)i[o++]=u.faces[p]+s;s=a/3}return{position:n,faces:i}}(n,o,s),d=i.default(p.position.buffer,6,{originalIndices:p.faces});return p.position=new Float64Array(d.buffer),p.faces=d.indices,p},t.pathsToTriangulationInfo=a}).apply(null,n))||(e.exports=i)},"3gjc":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function r(){return new Float32Array(4)}function n(e,t,r,n){var i=new Float32Array(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function i(){return r()}function a(){return n(1,1,1,1)}function o(){return n(1,0,0,0)}function s(){return n(0,1,0,0)}function l(){return n(0,0,1,0)}function c(){return n(0,0,0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.UNIT_W=t.UNIT_Z=t.UNIT_Y=t.UNIT_X=t.ONES=t.ZEROS=t.unitW=t.unitZ=t.unitY=t.unitX=t.ones=t.zeros=t.createView=t.fromValues=t.clone=t.create=void 0,t.create=r,t.clone=function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=n,t.createView=function(e,t){return new Float32Array(e,t,4)},t.zeros=i,t.ones=a,t.unitX=o,t.unitY=s,t.unitZ=l,t.unitW=c,t.ZEROS=i(),t.ONES=a(),t.UNIT_X=o(),t.UNIT_Y=s(),t.UNIT_Z=l(),t.UNIT_W=c()}).apply(null,n))||(e.exports=i)},"48/q":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("woUR")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Manipulation=void 0;var n=function(){function e(){this._available=!0}return Object.defineProperty(e.prototype,"location",{set:function(e){this.forEachManipulator3D((function(t){return t.location=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elevationAlignedLocation",{set:function(e){this.forEachManipulator3D((function(t){return t.elevationAlignedLocation=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{set:function(e){this.forEachManipulator3D((function(t){return t.elevationInfo=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"available",{get:function(){return this._available},set:function(e){this._available=e,this.forEachManipulator3D((function(t){return t.available=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grabbing",{get:function(){return this.someManipulator((function(e){return e.grabbing}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dragging",{get:function(){return this.someManipulator((function(e){return e.dragging}))},enumerable:!1,configurable:!0}),e.prototype.hasManipulator=function(e){return this.someManipulator((function(t){return t===e}))},e.prototype.someManipulator=function(e){var t=!1;return this.forEachManipulator((function(r){!t&&e(r)&&(t=!0)})),t},e.prototype.forEachManipulator3D=function(e){this.forEachManipulator((function(t,n){t instanceof r.Manipulator3D&&e(t,n)}))},e}();t.Manipulation=n}).apply(null,n))||(e.exports=i)},"4QR8":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("BcWh"),r("eIBl"),r("XwIv"),r("LxLY"),r("Vx27"),r("qysZ"),r("DtIM"),r("5T2R"),r("1eTA"),r("G+tB"),r("Fe95"),r("BhkK"),r("RWrl"),r("/NuL"),r("X7Ps")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicTransformTool=void 0;var y=function(e){function t(t){var r=e.call(this,t)||this;return r.enableZ=!0,r.enableRotation=!0,r.enableScaling=!0,r.type="transform-3d",r.handles=new i,r.scaleRotate=null,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.graphicState=new m.GraphicState({graphic:this.graphic}),this.moveManipulation=new f.MoveManipulation({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&p.canMoveZ(this.graphic),radius:f.MoveManipulation.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((function(t){return e.handles.add(t.events.on("immediate-click",(function(e){return e.stopPropagation()})))})),this.moveManipulation.elevationInfo=c.getGraphicEffectiveElevationInfo(this.graphic),this.moveManipulation.createGraphicDragPipeline(this.graphicState,(function(t){var r={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(t.action){case"start":e.emit("graphic-translate-start",r);break;case"update":e.emit("graphic-translate",r);break;case"end":e.emit("graphic-translate-stop",r)}})),this.moveManipulation.angle=this.symbolRotationAngle,(this.enableScaling||this.enableRotation)&&(this.scaleRotate=new v.GraphicScaleRotateTransform({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate"}),this.handles.add(this.scaleRotate.events.on("scale-changed",(function(){return e.onScaleChanged()})))),this.handles.add([d.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return a.makeHandle()}}),this.graphic.watch("symbol",(function(){return e.updateMoveAngle()})),this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(function(){return e.updateMoveAngle()}))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()},t.prototype.forEachManipulator=function(e){this.moveManipulation.forEachManipulator(e),o.isSome(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)},t.prototype.hideManipulatorsForGraphicState=function(){var e=this;return this.graphicState.watch("displaying",(function(t){e.forEachManipulator((function(e){return e.available=t})),e.moveManipulation.zManipulation.available=t&&e.enableZ&&p.canMoveZ(e.graphic)}))},t.prototype.destroy=function(){this.handles.destroy(),this.moveManipulation.destroy(),o.isSome(this.scaleRotate)&&(this.scaleRotate.destroy(),this.scaleRotate=null),this._set("view",null),this._set("graphic",null)},Object.defineProperty(t.prototype,"snapToScene",{set:function(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"symbolRotationAngle",{get:function(){var e=this.graphic.symbol;if(e){var t=e.symbolLayers.find((function(e){return"object"===e.type}));return l.toRadian(-(t&&t.heading||0))}return 0},enumerable:!1,configurable:!0}),t.prototype.reset=function(){},t.prototype.onDetach=function(){o.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()},t.prototype.onHide=function(){o.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()},t.prototype.onScaleChanged=function(){if(!o.isNone(this.scaleRotate)){var e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}},t.prototype.updateMoveAngle=function(){this.moveManipulation.angle="local"===this.view.viewingMode||this.view.scale<h.ALIGN_ARROWS_SCALE_THRESHOLD?this.symbolRotationAngle:0},t.prototype.onGeometryChanged=function(){u.placeAtGraphic(this.view,this.moveManipulation,this.graphic)},Object.defineProperty(t.prototype,"test",{get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:o.isSome(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}},enumerable:!1,configurable:!0}),r.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),r.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"graphic",void 0),r.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"enableZ",void 0),r.__decorate([s.property()],t.prototype,"enableRotation",void 0),r.__decorate([s.property()],t.prototype,"enableScaling",void 0),r.__decorate([s.property({value:!1})],t.prototype,"snapToScene",null),r.__decorate([s.property({readOnly:!0})],t.prototype,"type",void 0),r.__decorate([s.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],t)}(n.EventedMixin(g.InteractiveToolBase));t.GraphicTransformTool=y}).apply(null,n))||(e.exports=i)},"6hC7":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("QDcU"),r("BcWh"),r("eIBl"),r("XwIv"),r("LxLY"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("DtIM"),r("woUR"),r("B3XD"),r("X5J5"),r("Fe95"),r("48/q"),r("dtql"),r("JjCO"),r("ys4y"),r("4ziW"),r("o5p5"),r("bz+r")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoveXYAxisManipulation=void 0;var S=function(e){function t(t){var r=e.call(this)||this;return r._handles=new a,r._arrowManipulatorInfos=new Array,r._opaqueMaterial=r.createMaterial(),r._transparentMaterial=r.createMaterial(.5),r._angle=0,r._scale=1,r._radius=m.DISC_RADIUS,r._updateAfterDrag=!1,r.events=new i,r._tool=t.tool,r._view=t.view,null!=t.radius&&(r._radius=t.radius),r._createManipulators(),r.forEachManipulator((function(e){return r._tool.manipulators.add(e)})),r}return r.__extends(t,e),Object.defineProperty(t.prototype,"orthogonalAvailable",{set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0},t.prototype.forEachManipulator=function(e){this._arrowManipulatorInfos.map((function(t){return e(t.manipulator,1)}))},t.prototype.createGraphicDragPipeline=function(e,t){var r=this,n=e.graphic,i=d.getGraphicEffectiveElevationInfo(n),a=s.unwrap(n.geometry).spatialReference;return y.createGraphicMoveDragPipeline(e,t,(function(e){return r.createDragPipeline(e,i,a)}))},t.prototype.createDragPipeline=function(e,t,r){var n=this;return o.handlesGroup(this._arrowManipulatorInfos.map((function(i,a){return M.createManipulatorDragEventPipeline(i.manipulator,(function(i,o,s,l){var c=o.next(f.screenToMapXYAtLocation(n._view,i.elevationAlignedLocation,t,r)).next(M.constrainToMapAxis(i.location,n.angle+(a+1)*Math.PI*.5)).next(M.addScreenDelta());e(i,c,s,l)}))})))},Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayScale",{get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())},enumerable:!1,configurable:!0}),t.prototype._updateManipulators=function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()},t.prototype._updateArrowManipulator=function(e,t){var r=e.manipulator,n=e.transform,i=this._radius/m.DISC_RADIUS,a=m.DISC_TRANSLATE_ARROW_SIZE*i,o=Math.sqrt(a*a*3/4),s=x.createExtrudedTriangle(o,a/2,a/2,m.DISC_HEIGHT);x.transformInPlace(s,l.mat4.fromTranslation(_.sm4d.get(),u.vec3.set(_.sv3d.get(),0,-o/3,0)));var c=new b(s,"move-xy-axis-arrow");r.renderObjects=[{geometry:c,material:this._opaqueMaterial,stateMask:2},{geometry:c,material:this._transparentMaterial,stateMask:1}],r.radius=o/3*2*1.2;var p=l.mat4.identity(_.sm4d.get());l.mat4.fromZRotation(p,t*Math.PI/2);var d=l.mat4.identity(_.sm4d.get());l.mat4.fromTranslation(d,u.vec3.set(_.sv3d.get(),0,m.DISC_TRANSLATE_ARROW_OFFSET*i,0)),l.mat4.multiply(n,p,d)},t.prototype._createManipulators=function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()},t.prototype._updateManipulatorTransform=function(){var e=this.angle,t=l.mat4.identity(_.sm4d.get());l.mat4.rotate(t,t,e,p.vec3f64.fromValues(0,0,1));var r=l.mat4.fromScaling(_.sm4d.get(),u.vec3.set(_.sv3d.get(),this.displayScale,this.displayScale,this.displayScale)),n=l.mat4.identity(_.sm4d.get());l.mat4.multiply(n,r,t);for(var i=0,a=this._arrowManipulatorInfos;i<a.length;i++){var o=a[i],s=l.mat4.multiply(_.sm4d.get(),n,o.transform);o.manipulator.modelTransform=s}},t.prototype._createArrowManipulator=function(e){var t=this,r=new h.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:p.vec3f64.fromValues(0,0,1)}}),n={manipulator:r,transform:c.mat4f64.create()};return this._updateArrowManipulator(n,e),this._handles.add(r.events.on("drag",(function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)}))),n},t.prototype.createMaterial=function(e){void 0===e&&(e=1);var t=n.toUnitRGBA(v.colors.main);t[3]*=e;var r=new w({color:t,transparent:1!==e,cullFace:2},"graphic-transform");return r.renderOccluded=2,r},Object.defineProperty(t.prototype,"test",{get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map((function(e){return e.manipulator}))}},enumerable:!1,configurable:!0}),t}(g.Manipulation);t.MoveXYAxisManipulation=S}).apply(null,n))||(e.exports=i)},"73uV":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("eIBl"),r("LxLY"),r("B3XD"),r("48/q"),r("dtql"),r("bz+r"),r("N78w")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoveXYGraphicManipulation=void 0;var u=function(e){function t(t){var r=e.call(this)||this;return r._handles=new n,r._view=t.view,r._tool=t.tool,r._graphicState=t.graphicState,r._createManipulator(),r.forEachManipulator((function(e){return r._tool.manipulators.add(e)})),r}return r.__extends(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null},t.prototype.forEachManipulator=function(e){e(this._manipulator,1)},t.prototype.createGraphicDragPipeline=function(e){var t=this;return s.createGraphicMoveDragPipeline(this._graphicState,e,(function(e){return t.createDragPipeline(e)}))},t.prototype.createDragPipeline=function(e){var t=this._view,r=this._graphicState.graphic,n=i.isSome(r.geometry)?r.geometry.spatialReference:null;return l.createManipulatorDragEventPipeline(this._manipulator,(function(i,o,s,c){var u=o.next(a.screenToMapXYForGraphic(c,t,r,n)).next(l.addMapDelta()).next(l.addScreenDelta());e(i,u,s,c)}))},t.prototype._createManipulator=function(){this._manipulator=new c.GraphicManipulator({graphic:this._graphicState.graphic,view:this._view,selectable:!0,cursor:"move"})},t}(o.Manipulation);t.MoveXYGraphicManipulation=u}).apply(null,n))||(e.exports=i)},A5GR:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("y4WC"),r("BcWh"),r("eIBl"),r("XwIv"),r("LxLY"),r("Vx27"),r("ZcgO"),r("DtIM"),r("5T2R"),r("1eTA"),r("G+tB"),r("Fe95"),r("BhkK"),r("dtql"),r("73uV"),r("qflc"),r("R4nD"),r("/NuL"),r("bz+r"),r("X7Ps")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicMoveTool=t.GraphicMoveStopEvent=t.GraphicMoveEvent=t.GraphicMoveStartEvent=void 0;var M=function(e){this.allGraphics=e,this.type="graphic-move-start"};t.GraphicMoveStartEvent=M;var S=function(e,t,r){this.dx=e,this.dy=t,this.allGraphics=r,this.type="graphic-move"};t.GraphicMoveEvent=S;var O=function(e){this.allGraphics=e,this.type="graphic-move-stop"};t.GraphicMoveStopEvent=O;var R=function(e){function t(t){var r=e.call(this,t)||this;return r.graphics=new n,r.enableZ=!0,r.type="move-3d",r._toolHandles=new a,r._handles=new a,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._toolHandles.add([this.graphics.on("change",(function(){return e._refreshManipulators()}))]),this._refreshManipulators()},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)},t.prototype.reset=function(){},t.prototype._refreshManipulators=function(){var e=this;this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var t=this.graphics.toArray().filter((function(e){return 0===y.isSupportedGraphic(e)})).map((function(e){return new E(e)}));t.length&&(this.createManipulators(t),this.createVisualElements(t),this._handles.add(t.map((function(t){return e.view.trackGraphicState(t.state)}))),this.updateMoveManipulation(t))},t.prototype.createManipulators=function(e){for(var t=this,n=function(n){var a=n.state;n.manipulationXY=new g.MoveXYGraphicManipulation({tool:i,view:i.view,graphicState:a}),n.manipulationXY.forEachManipulator((function(e){return t._handles.add(e.events.on("immediate-click",(function(e){t.emit("immediate-click",r.__assign(r.__assign({},e),{graphic:a.graphic})),e.stopPropagation()})))})),i._handles.add(n.manipulationXY.createDragPipeline((function(r,n,i){return t.buildDragEventPipeline(r,n,i,e)})))},i=this,a=0,o=e;a<o.length;a++)n(o[a]);this.createMoveManipulation(e)},t.prototype.createMoveManipulation=function(e){var t=this,n=new v.MoveManipulation({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?v.MoveManipulation.radiusForSymbol(e[0].graphic.symbol):f.DISC_RADIUS});this._moveManipulation=n,n.elevationInfo={mode:"absolute-height",offset:0},n.forEachManipulator((function(e){t._handles.add(e.events.on("immediate-click",(function(i){n.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",r.__assign(r.__assign({},i),{graphic:t.graphics.getItemAt(0)})),i.stopPropagation()})))}));for(var i=function(){return t.updateMoveManipulation(e)},a=0,o=e;a<o.length;a++){var l=o[a];this._handles.add([l.state.on("changed",i),l.state.watch("displaying",i)])}var c=e[e.length-1];this._handles.add(c.state.on("changed",(function(){return t.updateMoveManipulationAngle(c)}))),this._handles.add(n.createDragPipeline((function(r,n,i){t.buildDragEventPipeline(r,n,i,e)}),u.getGraphicEffectiveElevationInfo(c.graphic),s.unwrap(c.graphic.geometry).spatialReference)),this.updateMoveManipulationAngle(c)},t.prototype.createVisualElements=function(e){for(var t=this,r=function(r){var i=h.createVisualElements({view:n.view,graphic:r.graphic,forEachManipulator:function(e){r.manipulationXY.forEachManipulator(e),t._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return o.makeHandle()}});r.geometryRepresentation=i.visualElement,r.geometryRepresentation instanceof _.OutlineVisualElement&&n._handles.add([r.geometryRepresentation.events.on("attachment-origin-changed",(function(){r.state.isDraped||t.updateMoveManipulation(e)})),r.state.watch("isDraped",(function(){return t.updateMoveManipulation(e)}))]),n._handles.add(i)},n=this,i=0,a=e;i<a.length;i++)r(a[i])},t.prototype.updateMoveManipulationAngle=function(e){this._moveManipulation.angleDeferred=function(){return m.primaryShapeOrientation(e.graphic.geometry)}},t.prototype.updateMoveManipulation=function(e){for(var t=c.makeDehydratedPoint(0,0,0,this.view.spatialReference),r=0,n=!1,i=this._moveManipulation,a=0,o=e;a<o.length;a++){var l=o[a];if(l.state.displaying){var u=l.state.graphic;this.enableZ&&d.canMoveZ(u)&&(n=!0);var h=l.geometryRepresentation instanceof _.OutlineVisualElement&&!l.state.isDraped?l.geometryRepresentation.attachmentOrigin:p.getGraphicAttachmentOrigin(this.view,u);s.isSome(h)&&(t.x+=h.x,t.y+=h.y,t.z+=h.z,r++)}}r>0?(t.x/=r,t.y/=r,t.z/=r,i.location=t,i.xyManipulation.available=!0,i.xyAxisManipulation.available=!0,i.zManipulation.available=n):i.available=!1},t.prototype.buildDragEventPipeline=function(e,t,r,n){var i=this,a=[],o=[],s=null,l=null,c=function(){for(var e=0,t=a;e<t.length;e++)t[e].dragging=!1;a.length=0,o.length=0,s=null,l=null,i._moveManipulation.interactive=!0};t.next((function(t){if("start"===t.action){a.length=0,o.length=0;for(var r=0,c=n;r<c.length;r++){var u=c[r];u.dragging||!u.manipulationXY.hasManipulator(e)&&u.manipulationXY.grabbing||(a.push(u),o.push(u.graphic),u.dragging=!0)}if(0!==o.length&&(i._moveManipulation.interactive=!1,s=x.dragGraphicMany(o),l=x.resetGraphicMany(o),i.emit("graphic-move-start",new M(o)),i.destroyed))return null}return 0!==o.length?t:null})).next((function(e){return s(e)})).next((function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=i.view.toScreen(e.mapStart),r=i.view.toScreen(e.mapEnd);if(i.emit("graphic-move",new S(r.x-t.x,r.y-t.y,o)),i.destroyed)return null}break;case"end":if(i.emit("graphic-move-stop",new O(o)),i.destroyed)return null;c()}})),r.next((function(e){return l(e)})).next((function(){if(i.emit("graphic-move-stop",new O(o)),i.destroyed)return null;c()}))},r.__decorate([l.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"graphics",void 0),r.__decorate([l.property({constructOnly:!0,nonNullable:!0})],t.prototype,"enableZ",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"type",void 0),r.__decorate([l.subclass("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],t)}(i.EventedMixin(w.InteractiveToolBase));t.GraphicMoveTool=R;var E=function(){function e(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new b.GraphicState({graphic:e})}return Object.defineProperty(e.prototype,"graphic",{get:function(){return this.state.graphic},enumerable:!1,configurable:!0}),e}()}).apply(null,n))||(e.exports=i)},B4Pz:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.FoamColor=t.FoamIntensity=void 0,t.FoamIntensity=function(e){e.fragment.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor =  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "],["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor =  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "]))))},t.FoamColor=function(e){e.fragment.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "],["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "]))))}}).apply(null,n))||(e.exports=i)},BhkK:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("eIBl"),r("XwIv"),r("H1tY"),r("LxLY"),r("Fe95"),r("48/q"),r("6hC7"),r("yjgM"),r("pvGl")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoveManipulation=void 0;var d=function(e){function t(t){var r=e.call(this)||this;r._handles=new n,r._angleDeferred=null,r._interactive=!0;var i=t.tool,a=t.view,o=t.snapToScene,s=t.radius;return r._view=a,r.xyManipulation=new u.MoveXYDiscManipulation({tool:i,view:a,snapToScene:o,radius:s}),r.xyAxisManipulation=new c.MoveXYAxisManipulation({tool:i,view:a,radius:s}),r.zManipulation=new p.MoveZManipulation({tool:i,view:a,radius:s}),r.xyManipulation.available=t.xyAvailable,r.xyAxisManipulation.available=t.xyAxisAvailable,r.zManipulation.available=t.zAvailable,r.autoHideXYAxis(),r.forEachManipulator((function(e){r._handles.add(e.events.on("grab-changed",(function(){return r.updateManipulatorInteractivity()})))})),r}return r.__extends(t,e),t.prototype.destroy=function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()},t.prototype.createGraphicDragPipeline=function(e,t){return i.handlesGroup([this.xyManipulation.createGraphicDragPipeline(e,t),this.xyAxisManipulation.createGraphicDragPipeline(e,t),this.zManipulation.createGraphicDragPipeline(e,t)])},t.prototype.createDragPipeline=function(e,t,r){return i.handlesGroup([this.xyManipulation.createDragPipeline(e,t,r),this.xyAxisManipulation.createDragPipeline(e,t,r),this.zManipulation.createDragPipeline(e,r)])},Object.defineProperty(t.prototype,"snapToScene",{set:function(e){this.xyManipulation.snapToScene=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angleDeferred",{set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"interactive",{set:function(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayScale",{set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e},enumerable:!1,configurable:!0}),t.prototype.forEachManipulator=function(e){this.xyManipulation.forEachManipulator((function(t){return e(t,1)})),this.xyAxisManipulation.forEachManipulator((function(t){return e(t,1)})),this.zManipulation.forEachManipulator((function(t){return e(t,0)}))},Object.defineProperty(t.prototype,"xyAxisVisible",{get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e},enumerable:!1,configurable:!0}),t.prototype.autoHideXYAxis=function(){var e=this,t=this.xyAxisManipulation,r=this.xyManipulation;if(!a("esri-mobile")){var n=[];r.forEachManipulator((function(e){return n.push(e)})),t.forEachManipulator((function(e){return n.push(e)}));for(var i=function(){var r=[];e.xyAxisVisible?o.isSome(e._angleDeferred)&&(e.angle=e._angleDeferred()):t.forEachManipulator((function(e){return r.push(e.disableDisplay())})),e._handles.remove(h),e._handles.add(r,h)},s=0,l=n;s<l.length;s++)this._handles.add(l[s].events.on("focus-changed",i));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",i)),i()}},t.prototype.updateManipulatorInteractivity=function(){var e=this,t=this.grabbing;this.forEachManipulator((function(r){r.interactive=!t&&e._interactive||r.grabbing}))},t.radiusForSymbol=function(e){var t=o.isSome(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((function(e){return"icon"===e.type}))?s.DISC_RADIUS_SMALL:s.DISC_RADIUS},t}(l.Manipulation);t.MoveManipulation=d;var h="disable-xy-axis-display"}).apply(null,n))||(e.exports=i)},CP88:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("tUyH"),r("v22c"),r("s6rJ")],void 0===(i=(function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaterGLMaterial=void 0;var o=function(e){function t(t){var r=e.call(this,t)||this;return r.updateParameters(),r}return r.__extends(t,e),t.prototype.updateParameters=function(){this.params=a.copyParameters(this.material.getParameters()),this.technique=this.techniqueRep.acquireAndReleaseExisting(i.WaterTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){if(2===this.output)return 22===e;if(5===this.output)return null==e;if(4===this.output)return 3===e;var t=3;return this.params.transparent&&(t=this.params.writeDepth?5:8),e===t},t.prototype.setElapsedTimeUniform=function(e){e.setUniform1f("timeElapsed",.001*this.material.animation.time*this.params.animationSpeed)},t.prototype._updateShadowState=function(e){e.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:e.shadowMappingEnabled}),this.updateParameters())},t.prototype._updateSSRState=function(e){e.ssrEnabled!==this.params.ssrEnabled&&(this.material.setParameterValues({ssrEnabled:e.ssrEnabled}),this.updateParameters())},t.prototype.ensureResources=function(e){return this.technique.ensureResource(e)},t.prototype.ensureParameters=function(e){0===this.output&&(this._updateShadowState(e),this._updateSSRState(e))},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.params,t),2!==this.output&&0!==this.output||this.setElapsedTimeUniform(this.technique.program)},t}(n.GLMaterial);t.WaterGLMaterial=o}).apply(null,n))||(e.exports=i)},CqfC:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("vJh7")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat2=void 0,t.mat2=r}).apply(null,n))||(e.exports=i)},Dk48:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("Gtr7"),r("Vx27")],void 0===(i=(function(e,t,r,n,i){"use strict";return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_VISIBLE=!1,t.DECONFLICTOR_SHOW_INVISIBLE=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_DEBUG_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.SHOW_POI=!1,t.TERRAIN_DEBUG_POPUP=!1,t.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,t.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.I3S_TREE_SHOW_TILES=!1,t.I3S_SHOW_MODIFICATIONS=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t.DISABLE_FAST_UPDATES=!1,t.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,t.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,t.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,t}return r.__extends(t,e),r.__decorate([i.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),r.__decorate([i.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),r.__decorate([i.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),r.__decorate([i.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),r.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),r.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),r.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),r.__decorate([i.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),r.__decorate([i.property()],t.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),r.__decorate([i.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),r.__decorate([i.property()],t.prototype,"SHOW_POI",void 0),r.__decorate([i.property()],t.prototype,"TERRAIN_DEBUG_POPUP",void 0),r.__decorate([i.property()],t.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),r.__decorate([i.property()],t.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),r.__decorate([i.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),r.__decorate([i.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),r.__decorate([i.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),r.__decorate([i.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),r.__decorate([i.property()],t.prototype,"I3S_TREE_SHOW_TILES",void 0),r.__decorate([i.property()],t.prototype,"I3S_SHOW_MODIFICATIONS",void 0),r.__decorate([i.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),r.__decorate([i.property()],t.prototype,"DISABLE_FAST_UPDATES",void 0),r.__decorate([i.property()],t.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),r.__decorate([i.property()],t.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),r.__decorate([i.property()],t.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),r.__decorate([i.subclass("esri.views.3d.support.DebugFlags")],t)}(n))}).apply(null,n))||(e.exports=i)},FLCf:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderStatsAggregator=t.addToRenderStats=t.makeNewRenderStats=void 0,t.makeNewRenderStats=function(){return{triangles:0,drawCalls:0}},t.addToRenderStats=function(e,t,r){r&&(r.drawCalls+=e,r.triangles+=t)};var r=function(){function e(){this.materialRenderStats=new Map,this.reset()}return e.prototype.getMaterialRenderStatsObject=function(e){var t=this.materialRenderStats.get(e);return t||this.materialRenderStats.set(e,t={triangles:0,drawCalls:0}),t},e.prototype.getAggregatedStats=function(){var e={materialRenderers:{},total:{triangles:0,drawCalls:0}};return this.materialRenderStats.forEach((function(t,r){e.materialRenderers[r]=t,e.total.drawCalls+=t.drawCalls,e.total.triangles+=t.triangles})),e},e.prototype.reset=function(){this.materialRenderStats.forEach((function(e){e.drawCalls=0,e.triangles=0}))},e}();t.RenderStatsAggregator=r}).apply(null,n))||(e.exports=i)},FU3N:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qsST"),r("LxLY"),r("dl/g"),r("CIy2")],void 0===(i=(function(e,t,r,n,i,a){"use strict";var o=r.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),s=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,a.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}();return function(){function e(e,t,r){this._textureRep=e,this._techniqueRep=t,this.onMaterialChanged=r,this._id2glMaterialRef=new Map}return e.prototype.dispose=function(){this._textureRep.dispose()},e.prototype.acquire=function(e,t){this.ownMaterial(e);var r,n=i.getShaderOutputID(e.id,t),a=this._id2glMaterialRef.get(n);return null==a?(r=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t}),a=new s(r),this._id2glMaterialRef.set(n,a)):r=a.getGLMaterial(),a.incRefCnt(),r},e.prototype.release=function(e,t){var r=i.getShaderOutputID(e.id,t),n=this._id2glMaterialRef.get(r);if(n.decRefCnt(),0===n.getRefCnt()){var a=n.getGLMaterial();a&&a.dispose(),this._id2glMaterialRef.delete(r)}},e.prototype.materialChanged=function(e){for(var t=0,r=i.ShaderOutputTypes;t<r.length;t++){var n=r[t];if(5!==n.output&&6!==n.output){var a=this._id2glMaterialRef.get(i.getShaderOutputID(e.id,n.output));if(a&&a.getGLMaterial()){var o=a.getGLMaterial();o.updateParameters&&o.updateParameters()}}}this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.ownMaterial=function(e){n.isSome(e.materialRepository)&&e.materialRepository!==this&&o.error("Material is already owned by a different material repository"),e.materialRepository=this},e}()}).apply(null,n))||(e.exports=i)},Fe95:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ALIGN_ARROWS_SCALE_THRESHOLD=t.RING_RESET_ANIMATION_SPEED_FACTOR=t.RING_INDICATOR_DELAY_MS=t.ROTATE_INDICATOR_DIRECTION_BUFFER=t.SCALE_INDICATOR_DIRECTION_BUFFER=t.SCALE_INDICATOR_OFFSET2=t.SCALE_INDICATOR_OFFSET1=t.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE=t.DRAG_THRESHOLD_PX=t.SCALE_INDICATOR_ARC_LENGTH=t.ROTATE_INDICATOR_ARC_LENGTH=t.ROTATE_INDICATOR_ARROW_TIP_RADIUS=t.ROTATE_INDICATOR_ARROW_TIP_LENGTH=t.OUTER_INDICATOR_RADIUS=t.INNER_INDICATOR_RADIUS=t.INDICATOR_THICKNESS=t.RING_THICKNESS=t.RING_HEIGHT=t.RING_RADIUS=t.DISC_RADIUS_SMALL=t.DISC_TRANSLATE_ARROW_OFFSET=t.DISC_TRANSLATE_ARROW_SIZE=t.DISC_HEIGHT=t.DISC_COLLISION_RADIUS=t.DISC_RADIUS=t.GEOMETRY_SEGMENTS=t.HANDLE_COLOR=void 0,t.HANDLE_COLOR=[1,.5,0],t.GEOMETRY_SEGMENTS=128,t.DISC_RADIUS=70,t.DISC_COLLISION_RADIUS=80,t.DISC_HEIGHT=.02,t.DISC_TRANSLATE_ARROW_SIZE=54,t.DISC_TRANSLATE_ARROW_OFFSET=100,t.DISC_RADIUS_SMALL=Math.ceil(t.DISC_RADIUS/3*2),t.RING_RADIUS=160,t.RING_HEIGHT=.5,t.RING_THICKNESS=24,t.INDICATOR_THICKNESS=9,t.INNER_INDICATOR_RADIUS=t.RING_RADIUS+30,t.OUTER_INDICATOR_RADIUS=t.RING_RADIUS+53,t.ROTATE_INDICATOR_ARROW_TIP_LENGTH=60,t.ROTATE_INDICATOR_ARROW_TIP_RADIUS=23,t.ROTATE_INDICATOR_ARC_LENGTH=5*Math.PI/12,t.SCALE_INDICATOR_ARC_LENGTH=1*Math.PI/3,t.DRAG_THRESHOLD_PX=10,t.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE=.2,t.SCALE_INDICATOR_OFFSET1=30,t.SCALE_INDICATOR_OFFSET2=53,t.SCALE_INDICATOR_DIRECTION_BUFFER=.2,t.ROTATE_INDICATOR_DIRECTION_BUFFER=.3,t.RING_INDICATOR_DELAY_MS=200,t.RING_RESET_ANIMATION_SPEED_FACTOR=3,t.ALIGN_ARROWS_SCALE_THRESHOLD=1e6}).apply(null,n))||(e.exports=i)},"G+tB":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("PLh7"),r("uinn")],void 0===(i=(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=void 0,t.createVisualElements=function(e){switch(r.unwrap(e.graphic.geometry).type){case"point":return i.createVisualElements(e);case"polygon":case"polyline":return n.createVisualElements(e);default:return null}}}).apply(null,n))||(e.exports=i)},GDWR:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KY0m")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommonUniformStore=void 0;var n=function(){function e(){this._uniforms={proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}return e.prototype.dispose=function(){this._uniforms=null},e.prototype.getPrograms=function(e){return this._uniforms[e]||[]},e.prototype.subscribeProgram=function(e){for(var t in this._uniforms)e.hasUniform(t)&&this._uniforms[t].push(e)},e.prototype.unsubscribeProgram=function(e){for(var t in this._uniforms)r.removeUnordered(this._uniforms[t],e)},e}();t.CommonUniformStore=n}).apply(null,n))||(e.exports=i)},HbaO:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("O7NG")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WHITE_UNIT=t.TRANSPARENT_UNIT=t.SUSPEND_RESUME_EXTENT_OPTIMISM=t.defaultIconElevationOffset=void 0,t.defaultIconElevationOffset=1,t.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2,t.TRANSPARENT_UNIT=r.vec4f64.ZEROS,t.WHITE_UNIT=r.vec4f64.ONES}).apply(null,n))||(e.exports=i)},J2BX:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("CIy2")],void 0===(i=(function(e,t,r,n){"use strict";function i(e,t){for(var r=e,i=new Uint8Array(4*r*r),a=r/2-.5,o=t/2,s=0;s<r;s++)for(var l=0;l<r;l++){var c=l+r*s,u=l-a,p=s-a,d=Math.sqrt(u*u+p*p)-o;n.packFloatRGBA(d=d/e+.5,i,4*c)}return i}function a(e,t){return u(e,t,!1)}function o(e,t){return u(e,t,!0)}function s(e,t){return p(e,t,!1)}function l(e,t){return p(e,t,!0)}function c(e,t){for(var r=new Uint8Array(4*e*e),i=Math.sqrt(1.25),a=(e-t)/2,o=0;o<e;o++)for(var s=0;s<e;s++){var l=o*e+s,c=(s-a)/t,u=(o-a+.75)/t,p=Math.max(-(1*c+-.5*u)/i,(1*(c-1)+-.5*-u)/i,-u)*t/e+.5;n.packFloatRGBA(p,r,4*l)}return r}function u(e,t,r){r&&(t/=Math.SQRT2);for(var i=new Uint8Array(4*e*e),a=0;a<e;a++)for(var o=0;o<e;o++){var s=o-.5*e+.25,l=.5*e-a-.75,c=a*e+o;if(r){var u=(s+l)/Math.SQRT2;l=(l-s)/Math.SQRT2,s=u}var p=Math.max(Math.abs(s),Math.abs(l))-.5*t;n.packFloatRGBA(p=p/e+.5,i,4*c)}return i}function p(e,t,r){r&&(t*=Math.SQRT2);for(var i=.5*t,a=new Uint8Array(4*e*e),o=0;o<e;o++)for(var s=0;s<e;s++){var l=s-.5*e,c=.5*e-o-1,u=o*e+s;if(r){var p=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=p}var d=void 0;d=(d=(l=Math.abs(l))>(c=Math.abs(c))?l>i?Math.sqrt((l-i)*(l-i)+c*c):c:c>i?Math.sqrt(l*l+(c-i)*(c-i)):l)/e+.5,n.packFloatRGBA(d,a,4*u)}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.createTriangle=t.createX=t.createCross=t.createKite=t.createSquare=t.createCircle=t.createType=void 0,t.createType=function(e,t,n){switch(e){case"circle":return i(t,n);case"square":return a(t,n);case"cross":return s(t,n);case"x":return l(t,n);case"kite":return o(t,n);case"triangle":return c(t,n);default:return r.neverReached(e),i(t,n)}},t.createCircle=i,t.createSquare=a,t.createKite=o,t.createCross=s,t.createX=l,t.createTriangle=c}).apply(null,n))||(e.exports=i)},JXo2:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("pcDC"),r("BcWh"),r("eIBl"),r("XwIv"),r("LxLY"),r("8MXS"),r("Vx27"),r("0LE5"),r("ZcgO"),r("DtIM"),r("woUR"),r("5T2R"),r("B3XD"),r("1eTA"),r("X5J5"),r("G+tB"),r("YsOV"),r("Fe95"),r("BhkK"),r("dtql"),r("73uV"),r("R4nD"),r("/NuL"),r("JjCO"),r("ys4y"),r("4ziW"),r("bz+r")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w,M,S,O,R,E,P,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReshapeGeometryHelper=t.ReshapeOperation=void 0;var T=function(e){function t(t){var r=e.call(this,t)||this;return r._vertexManipulatorMaterial=f.createManipulatorMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.vertex.color),g.settings.reshapeManipulators.vertex.renderOccludedFlag),r._vertexManipulatorOutlineMaterial=f.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.vertex.outlineColor),g.settings.reshapeManipulators.vertex.renderOccludedFlag),r._vertexManipulatorHoverOutlineMaterial=f.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.vertex.hoverOutlineColor),g.settings.reshapeManipulators.vertex.renderOccludedFlag),r._edgeManipulatorMaterial=f.createManipulatorMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.edge.color),g.settings.reshapeManipulators.edge.renderOccludedFlag),r._edgeManipulatorOutlineMaterial=f.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.edge.outlineColor),g.settings.reshapeManipulators.edge.renderOccludedFlag),r._selectedManipulatorMaterial=f.createManipulatorMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.selected.color),g.settings.reshapeManipulators.selected.renderOccludedFlag),r._selectedManipulatorOutlineMaterial=f.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.selected.outlineColor),g.settings.reshapeManipulators.selected.renderOccludedFlag),r._selectedManipulatorHoverOutlineMaterial=f.createManipulatorOutlineMaterial(g.settings.colorToVec4(g.settings.reshapeManipulators.selected.hoverOutlineColor),g.settings.reshapeManipulators.selected.renderOccludedFlag),r._selectedIndex=0,r._vertexManipulatorGeometry=null,r._vertexManipulatorOutlineGeometry=null,r._edgeManipulatorGeometry=null,r._edgeManipulatorOutlineGeometry=null,r._handles=new a,r._manipulatorHandles=new a,r._manipulatorInfos=[],r._reshapeHelper=null,r._graphicMoveManipulation=null,r._moveManipulation=null,r._numGrabbing=0,r._numDragging=0,r._reshapeEventState=0,r._outlineVisualElement=null,r.tool=null,r.outputGeometry=null,r._vertexLaserLineVisualElement=null,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=new O.GraphicState({graphic:this.graphic});this._graphicState=t,this._handles.add([t.watch("displaying",(function(t){for(var r=0,n=e._manipulatorInfos;r<n.length;r++)n[r].manipulator.available=t})),this.view.trackGraphicState(t)])},t.prototype.destroy=function(){this._clear(),this._handles.destroy()},Object.defineProperty(t.prototype,"inputGeometry",{get:function(){return s.isSome(this._reshapeHelper)?this._reshapeHelper.geometry:null},set:function(e){this._recreateManipulators(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manipulators",{get:function(){return this.tool.manipulators},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.tool.view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphic",{get:function(){return this.tool.graphic},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableZ",{get:function(){return this.tool.enableZ},enumerable:!1,configurable:!0}),t.prototype.removeSelectedVertices=function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.handle.type}));this._removeVertices(e)},t.prototype.manipulatorSelectionChanged=function(){this.emit("manipulators-changed")},t.prototype._clear=function(){this._moveManipulation&&this._moveManipulation.destroy(),this._graphicMoveManipulation&&this._graphicMoveManipulation.destroy(),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._graphicMoveManipulation=null,this._moveManipulation=null,this._reshapeHelper=null,this._numGrabbing=0,this._numDragging=0},t.prototype._recreateManipulators=function(e){if(void 0===e&&(e=this.inputGeometry),this._clear(),!s.isNone(e)){this._reshapeHelper=new G(_.EditGeometry.fromGeometry(e,this.view.viewingMode),e.type);for(var t=d.getGraphicEffectiveElevationInfo(this.graphic),r=0,n=this._reshapeHelper.data.components;r<n.length;r++){for(var i=n[r],a=0,o=i.vertices;a<o.length;a++)this._createPerVertexManipulator(o[a],t);for(var l=0,c=i.edges;l<c.length;l++)this._createPerVertexManipulator(c[l],t)}this._createGraphicMoveManipulators(t)}},t.prototype._perGraphicManipulatorDragAction=function(e,t){if("end"!==t.action){for(var r=[],n=this._manipulatorInfos.some((function(e){return"vertex"===e.handle.type&&e.manipulator.selected})),i=1===e&&n,a=s.unwrap(this._reshapeHelper),o=0,l=this._manipulatorInfos;o<l.length;o++)"vertex"===(d=l[o]).handle.type&&(d.manipulator.grabbing||i&&!d.manipulator.selected||(s.unwrap(a).moveVertices([d.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),r.push(d.handle.pos),this._updateManipulatorPosition(d)));if(0!==r.length){for(var c=0,u=0,p=this._manipulatorInfos;u<p.length;u++){var d;"vertex"===(d=p[u]).handle.type&&c++}if(this.outputGeometry=a.geometry,r.length===c){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}}},t.prototype._perVertexManipulatorDragAction=function(e,t){if(this._updateEventState(2),!this.destroyed){var r=t.mapDeltaX,n=t.mapDeltaY,i=t.mapDeltaZ;if(r||n||i){for(var a=[],o=0,l=this._manipulatorInfos;o<l.length;o++){var c=l[o];A(c)&&(c.manipulator.selected&&!c.manipulator.grabbing||c===e)&&a.push(c)}for(var u=s.unwrap(this._reshapeHelper),p=0,d=a;p<d.length;p++){var h=d[p];u.moveVertices([h.handle],r,n,i)}this.outputGeometry=u.geometry;for(var f=0,v=a;f<v.length;f++)this._updateManipulatorPosition(h=v[f]);this.emit("reshape",{type:"reshape",mover:this.graphic})}}},t.prototype._updateEventState=function(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t},t.prototype._createGraphicMoveManipulators=function(e){var t=this;this._graphicMoveManipulation=new M.MoveXYGraphicManipulation({tool:this.tool,view:this.view,graphicState:this._graphicState}),this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((function(e,r,n){r.next((function(e){return t._trackNumDragging(e)})).next((function(e){t._perGraphicManipulatorDragAction(0,e)})),n.next(t._cancelDragOperation())}))),this._graphicMoveManipulation.forEachManipulator((function(e){return t._manipulatorHandles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click"),e.stopPropagation()}))])})),this._moveManipulation=new x.MoveManipulation({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&m.canMoveZ(this.graphic),snapToScene:!1,radius:x.MoveManipulation.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((function(e){t._handles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(r){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some((function(e){return e.manipulator.selected}))||t.emit("immediate-click"),r.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var r=s.unwrap(this.graphic.geometry).spatialReference;this._handles.add([this._moveManipulation.createDragPipeline((function(e,r,n){r.next((function(e){return t._trackNumDragging(e)})).next(C.addMapDelta()).next((function(e){t._perGraphicManipulatorDragAction(1,e)})),n.next(t._cancelDragOperation())}),e,r),l.init(this._graphicState,"displaying",(function(e){t._moveManipulation.xyManipulation.available=e,t._moveManipulation.xyAxisManipulation.available=!0,t._moveManipulation.zManipulation.available=e&&t.enableZ&&m.canMoveZ(t.graphic),t._updateMoveManipulationPosition()})),this._graphicState.on("changed",(function(){return t._updateMoveManipulationPosition()}))]),this._updateMoveManipulationPosition();var n=y.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:function(e){if(!t.destroyed){t._graphicMoveManipulation.forEachManipulator(e);for(var r=0,n=t._manipulatorInfos;r<n.length;r++)e(n[r].manipulator,1);t._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:function(e){return t.on("manipulators-changed",e)}});this._outlineVisualElement=n.visualElement instanceof S.OutlineVisualElement?n.visualElement:null,s.isSome(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(function(){t._graphicState.isDraped||t._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(function(){return t._updateMoveManipulationPosition()}))]),this._manipulatorHandles.add(n)},t.prototype._createPerVertexManipulator=function(e,t){var r=this;if(void 0===t&&(t=d.getGraphicEffectiveElevationInfo(this.graphic)),s.isNone(this._vertexManipulatorGeometry)||s.isNone(this._vertexManipulatorOutlineGeometry)){var n=g.settings.reshapeManipulators.vertex,i=(l=n.size/2)/(c=l+n.collisionPadding);this._vertexManipulatorGeometry=new E(P.createSphereGeometry(i,16,16),"reshape-manipulator");var a=(l+n.outlineSize)/c;this._vertexManipulatorOutlineGeometry=new E(P.createSphereGeometry(a,16,16),"reshape-manipulator-outline")}if(s.isNone(this._edgeManipulatorGeometry)||s.isNone(this._edgeManipulatorOutlineGeometry)){var l,c,u=g.settings.reshapeManipulators.edge;i=(l=u.size/2)/(c=l+u.collisionPadding),this._edgeManipulatorGeometry=new E(P.createSphereGeometry(i,16,16),"reshape-manipulator"),this._edgeManipulatorOutlineGeometry=new E(P.createSphereGeometry(a=(l+u.outlineSize)/c,16,16),"reshape-manipulator-outline")}var p=new h.Manipulator3D({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|j.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|j.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|j.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|j.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|j.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|j.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|j.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(p,e,t);var f="edge"===e.type?{manipulator:p,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:p,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(f),this.manipulators.add(p),this._updateManipulatorPosition(f),"edge"===f.type){var m=this._getManipulatorInfoFromHandle(f.handle.left).manipulator.events.on("location-update",(function(){return r._updateManipulatorPosition(f)})),y=this._getManipulatorInfoFromHandle(f.handle.right).manipulator.events.on("location-update",(function(){return r._updateManipulatorPosition(f)}));f.locationUpdateHandle=o.handlesGroup([m,y]),this._manipulatorHandles.add(f.locationUpdateHandle,p)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(p,!0),p);var _=C.createManipulatorDragEventPipeline(p,(function(e,t,n){t.next((function(e){return r._trackNumDragging(e)})).next((function(e){return I(f)&&r._splitEdgeManipulator(f),e})).next(v.screenToMapXYForGraphicAtLocation(r.view,r.graphic,e.elevationAlignedLocation,e.location.spatialReference)).next(C.addMapDelta()).next((function(e){"vertex"===f.type?r._perVertexManipulatorDragAction(f,e):console.error("drag operation on non-vertex manipulator not allowed")})),n.next(r._cancelDragOperation())}));return this._manipulatorHandles.add(_,p),this._manipulatorHandles.add([p.events.on("immediate-click",(function(e){return r._manipulatorClickCallback(e,f)})),p.events.on("select-changed",(function(){f.selectedIndex=++r._selectedIndex,r._updateMoveManipulationPosition()}))]),this.emit("manipulators-changed"),p},t.prototype._trackNumDragging=function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e},t.prototype._cancelDragOperation=function(){var e=this,t=s.isSome(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return function(){switch(e._numDragging--,e.inputGeometry=t,e.outputGeometry=t,e._reshapeEventState){case 0:break;case 1:e.emit("move",{type:"move",dx:0,dy:0,mover:e.graphic});break;case 2:e.emit("reshape",{type:"reshape",mover:e.graphic})}e.destroyed||e._updateEventState(0)}},t.prototype._setTypeSpecificManipulatorSettings=function(e,t,r){switch(t.type){case"vertex":e.state=j.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=g.settings.reshapeManipulators.vertex.size/2+g.settings.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=r;break;case"edge":e.state=j.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=g.settings.reshapeManipulators.edge.size/2+g.settings.reshapeManipulators.edge.collisionPadding,e.elevationInfo={mode:"absolute-height",offset:0};break;default:n.neverReached(t)}},t.prototype._watchAndUpdateGrabState=function(e,t){var r=this;return e.events.on("grab-changed",(function(n){if("start"===n.action)t&&r._updateSelection(e),r._numGrabbing++;else if(r._numGrabbing--,r._updateEventState(0),r.destroyed)return;r._moveManipulation.interactive=!r._numGrabbing}))},t.prototype._clearSelection=function(){for(var e=0,t=this._manipulatorInfos;e<t.length;e++){var r=t[e];r.manipulator.grabbing||(r.manipulator.selected=!1)}},t.prototype._updateSelection=function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))},t.prototype._removeManipulator=function(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))},t.prototype._getManipulatorInfoFromHandle=function(e){if(e)for(var t=0,r=this._manipulatorInfos;t<r.length;t++){var n=r[t];if(e===n.handle)return n}return null},t.prototype._updateManipulatorPosition=function(e){if(e){var t=s.unwrap(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.data.coordinateHelper.toPoint(e.handle.pos,V),e.manipulator.grabbing&&s.isSome(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){var r=this._getManipulatorInfoFromHandle(e.handle.left).manipulator.elevationAlignedLocation,n=this._getManipulatorInfoFromHandle(e.handle.right).manipulator.elevationAlignedLocation;e.manipulator.elevationAlignedLocation=p.makeDehydratedPoint(r.x+.5*(n.x-r.x),r.y+.5*(n.y-r.y),r.hasZ&&n.hasZ?r.z+.5*(n.z-r.z):void 0,t.geometry.spatialReference)}}},t.prototype._splitEdgeManipulator=function(e){var t=s.unwrap(this._reshapeHelper),r=s.unwrap(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var n=e;n.handle=r,n.type="vertex";var i=d.getGraphicEffectiveElevationInfo(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,i),r.left&&this._createPerVertexManipulator(r.left),r.right&&this._createPerVertexManipulator(r.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(n),this._updateSelection(e.manipulator);var a=t.data.coordinateHelper.toArray(n.handle.pos),o=t.data.components.indexOf(r.component);this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:a,componentIndex:o,vertexIndex:s.unwrap(r.index)}],added:a})},t.prototype._updateMoveManipulationPosition=function(){var e=this,t=R.sv3d.get();u.vec3.set(t,0,0,0);for(var r=0,n=!1,i=null,a=null,o=0,l=this._manipulatorInfos;o<l.length;o++){var c=l[o];A(c)&&(c.manipulator.selected?(r++,u.vec3.add(t,t,c.manipulator.renderLocation),s.isNone(i)||c.selectedIndex>i.selectedIndex?(a=i,i=c):(s.isNone(a)||c.selectedIndex>a.selectedIndex)&&(a=c)):n=!0)}if(this._moveManipulation.xyAxisManipulation.orthogonalAvailable=!0,this._moveManipulation.xyAxisManipulation.available=!0,0!==r){var p=0;if(s.isSome(i)){var d=i.handle.pos,h=s.isSome(a)?a.handle.pos:i.handle.left&&i.handle.left.left?i.handle.left.left.pos:null,v=!s.isSome(a)&&i.handle.right&&i.handle.right.right?i.handle.right.right.pos:null;h&&v?this._moveManipulation.xyAxisManipulation.available=!1:h?p=D(h,d):v&&(p=D(d,v))}this._moveManipulation.xyAxisManipulation.orthogonalAvailable=1!==r,this._moveManipulation.angle=p,this._moveManipulation.radius=b.DISC_RADIUS_SMALL}else this._moveManipulation.angleDeferred=function(){return w.primaryShapeOrientation(s.unwrap(e.graphic.geometry))},this._moveManipulation.radius=x.MoveManipulation.radiusForSymbol(this.graphic.symbol);0!==r&&n?(u.vec3.scale(t,t,1/r),V.spatialReference=s.unwrap(this._reshapeHelper).geometry.spatialReference,this.view.renderCoordsHelper.fromRenderCoords(t,V),this._moveManipulation.elevationAlignedLocation=V):s.isSome(this._outlineVisualElement)&&!this._graphicState.isDraped&&s.isSome(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:f.placeAtGraphic(this.view,this._moveManipulation,this.graphic)},t.prototype._removeVertices=function(e){for(var t=[],r=s.unwrap(this._reshapeHelper),n=0,i=e;n<i.length;n++){var a=i[n];if("vertex"===a.handle.type&&r.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.right));var o=s.unwrap(r.removeVertices([a.handle]).removedVertices[0].createdEdge);o&&this._createPerVertexManipulator(o)}}if(t.length>0){var l=t.map((function(e){var t=r.data.components.indexOf(e.component);return{coordinates:r.data.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:s.unwrap(e.index)}}));this.outputGeometry=r.geometry;var c=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:l.map((function(e){return e.coordinates})),vertices:l}),this.destroyed)return;if(c&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}},t.prototype._manipulatorClickCallback=function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),I(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()},r.__decorate([c.property({constructOnly:!0})],t.prototype,"tool",void 0),r.__decorate([c.property()],t.prototype,"inputGeometry",null),r.__decorate([c.property()],t.prototype,"outputGeometry",void 0),r.__decorate([c.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.ReshapeOperation")],t)}(i.EventedAccessor);function D(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function A(e){return"vertex"===e.handle.type}function I(e){return"edge"===e.handle.type}t.ReshapeOperation=T;var j,V=p.makeDehydratedPoint(0,0,null,null);!function(e){e.Vertex=16,e.Edge=32}(j||(j={}));var G=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.type=r,n._geometry=null,n}return r.__extends(t,e),Object.defineProperty(t.prototype,"geometry",{get:function(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.data.toPolyline();break;case"polygon":this._geometry=this.data.toPolygon()}this._dirty=!1}return this._geometry},enumerable:!1,configurable:!0}),t}(_.EditGeometryHelper);t.ReshapeGeometryHelper=G}).apply(null,n))||(e.exports=i)},KPBO:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.add=t.scalarProduct=t.elementwiseProduct=t.dotProduct=void 0,t.dotProduct=function(e,t){for(var r=0,n=0;n<e.length;n++)r+=e[n]*t[n];return r},t.elementwiseProduct=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t[n];return r},t.scalarProduct=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t;return r},t.add=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]+t[n];return r}}).apply(null,n))||(e.exports=i)},KQg4:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("0W55"),r("7Aei"),r("aExC")],void 0===(i=(function(e,t,r,n,i,a){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.build=void 0,t.build=function(){var e=new a.ShaderBuilder;return e.include(n.ScreenSpacePass),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(i.glsl(o||(o=r.__makeTemplateObject(["\n    void main() {\n      vec4 texColor = texture2D(tex, uv);\n      gl_FragColor = texColor * color;\n    }\n  "],["\n    void main() {\n      vec4 texColor = texture2D(tex, uv);\n      gl_FragColor = texColor * color;\n    }\n  "])))),e}}).apply(null,n))||(e.exports=i)},Kvb2:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("woUR")],void 0===(i=(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ManipulatorState=void 0;var i=function(){function e(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return e.prototype.update=function(e){var t=this;this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,i){if(0===i&&(t.zManipulator=e),e instanceof n.Manipulator3D&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),r.isNone(t.firstGrabbedXY)&&e.grabbing&&1===i&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=1,i){case 0:t.grabbingState|=2;break;case 1:t.grabbingState|=4}}))},e}();t.ManipulatorState=i}).apply(null,n))||(e.exports=i)},KwnQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("z4cv")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat2f64=void 0,t.mat2f64=r}).apply(null,n))||(e.exports=i)},MCHn:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("LxLY"),r("0LE5"),r("Rdxj"),r("gxI5"),r("aWgr"),r("hX2R"),r("qSzK")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LaserlineVisualElement=void 0;var u=function(e){function t(t){var r=e.call(this,t.view)||this;return r._angleCutoff=c.defaultAngleCutoff,r._style={},r._heightManifoldTarget=a.vec3f64.create(),r._heightManifoldEnabled=!1,r._intersectsLine=s.lineSegment.create(),r._intersectsLineEnabled=!1,r._intersectsLineInfinite=!1,r._pathVerticalPlaneBuffers=null,r.applyProps(t),r}return r.__extends(t,e),t.prototype.createResources=function(){this.ensureRenderer()},t.prototype.destroyResources=function(){this.disposeRenderer()},t.prototype.updateVisibility=function(e){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane()},Object.defineProperty(t.prototype,"angleCutoff",{get:function(){return this._angleCutoff},set:function(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},set:function(e){this._style=e,this.syncStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"heightManifoldTarget",{get:function(){return this._heightManifoldEnabled?this._heightManifoldTarget:null},set:function(e){n.isSome(e)?(i.vec3.copy(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intersectsWorldUpAtLocation",{set:function(e){if(n.isNone(e))this.intersectsLine=null;else{var t=this.view.renderCoordsHelper.worldUpAtPosition(e,p);this.intersectsLine=s.lineSegment.fromValues(e,t),this.intersectsLineInfinite=!0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intersectsLine",{get:function(){return this._intersectsLineEnabled?this._intersectsLine:null},set:function(e){n.isSome(e)?(s.lineSegment.copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intersectsLineInfinite",{get:function(){return this._intersectsLineInfinite},set:function(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pathVerticalPlane",{get:function(){return this._pathVerticalPlaneBuffers},set:function(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncRenderer()},enumerable:!1,configurable:!0}),t.prototype.syncRenderer=function(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||n.isSome(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()},t.prototype.ensureRenderer=function(){n.isSome(this.renderer)||(this.renderer=new l.LaserLineRenderer(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))},t.prototype.syncStyle=function(){n.isNone(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))},t.prototype.syncAngleCutoff=function(){n.isNone(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})},t.prototype.syncHeightManifold=function(){n.isNone(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))},t.prototype.syncIntersectsLine=function(){n.isNone(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))},t.prototype.syncIntersectsLineInfinite=function(){n.isNone(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)},t.prototype.syncPathVerticalPlane=function(){n.isNone(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=n.isSome(this._pathVerticalPlaneBuffers)&&this.visible,n.isSome(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))},t.prototype.disposeRenderer=function(){n.isSome(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)},t}(o.VisualElement);t.LaserlineVisualElement=u;var p=a.vec3f64.create()}).apply(null,n))||(e.exports=i)},"N+ip":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("DJpR"),r("Kfys")],void 0===(i=(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OverlayRenderTarget=void 0;var i=function(){function e(e,t,n,i){this._renderTarget=null,this.id=t+"_"+ ++n,this._renderTarget=new r.FramebufferObject(e,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}return e.prototype.dispose=function(){this._renderTarget.dispose(),this._renderTarget=null},e.prototype.getTexture=function(){return this._renderTarget?this._renderTarget.colorTexture:null},e.prototype.isValid=function(){return null!==this._renderTarget},e.prototype.resize=function(e,t){this._renderTarget.resize(e,t)},e.prototype.bind=function(e){e.bindFramebuffer(this._renderTarget)},e.prototype.generateMipMap=function(){this._renderTarget.colorTexture.descriptor.hasMipmap&&this._renderTarget.colorTexture.generateMipmap()},e.prototype.disposeRenderTargetMemory=function(){this._renderTarget&&this._renderTarget.resize(0,0)},e.prototype.getGpuMemoryUsage=function(){var e=0;return this._renderTarget&&(e+=n.getGpuMemoryUsage(this._renderTarget)),e},e}();t.OverlayRenderTarget=i}).apply(null,n))||(e.exports=i)},NbdF:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("TMur"),r("LxLY"),r("8uEs"),r("/E+R")],void 0===(i=(function(e,t,r,n,i,a){"use strict";function o(e,t,n,a){var o;if(void 0===a&&(a=new r.Extent),"2d"===n.type)o=t*n.resolution;else if("3d"===n.type){var s=n.basemapTerrain,l=s.overlayManager,c=l?l.overlayPixelSizeInMapUnits(e):1;o=s&&!s.spatialReference.equals(n.spatialReference)?i.getMetersPerUnitForSR(s.spatialReference)/i.getMetersPerUnitForSR(n.spatialReference):t*c}var u=e.x-o,p=e.y-o,d=e.x+o,h=e.y+o,f=n.spatialReference;return a.xmin=Math.min(u,d),a.ymin=Math.min(p,h),a.xmax=Math.max(u,d),a.ymax=Math.max(p,h),a.spatialReference=f,a}Object.defineProperty(t,"__esModule",{value:!0}),t.intersectsDrapedGeometry=t.createQueryGeometry=void 0,t.createQueryGeometry=o,t.intersectsDrapedGeometry=function(e,t,r){var i=r.toMap(e);return n.isNone(i)?null:o(i,a.calculateTolerance(),r,s).intersects(t)?i:null};var s=new r.Extent}).apply(null,n))||(e.exports=i)},PLh7:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("XwIv"),r("xoE+"),r("LxLY"),r("0LE5"),r("Rdxj"),r("DtIM"),r("woUR"),r("Kvb2"),r("X5J5"),r("MCHn"),r("PXiz"),r("R4nD"),r("/NuL")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f){"use strict";function v(e){return i.isSome(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=void 0,t.createVisualElements=function(e){var t=e.view,o=e.graphic,g=new f.GraphicState({graphic:o}),y=[],_=function(e,t,n){var i=e.graphic,a=new h.OutlineVisualElement({view:e.view,geometry:v(i)?i.geometry:null,elevationInfo:s.getGraphicEffectiveElevationInfo(i),attached:!1});u.settings.visualElements.lineGraphics.shadowStyle.apply(a);var o=function(){a.attached=t.displaying};return u.settings.visualElements.lineGraphics.outline.apply(a),n.push(t.watch("displaying",o),t.watch("isDraped",(function(e){return a.isDraped=e})),t.on("changed",(function(){return a.geometry=v(i)?i.geometry:null})),r.destroyHandle(a)),o(),a}(e,g,y);return function(e,t,o,h){var f=e.graphic,g=e.view,y=s.getGraphicEffectiveElevationInfo(f),_="on-the-ground"===y.mode||!y.offset&&"absolute-height"!==y.mode,b=new c.ManipulatorState,x=new d.LineVisualElement({view:g,infinite:u.settings.visualElements.zVerticalLine.infiniteType,attached:!1});u.settings.visualElements.pointGraphics.shadowStyle.apply(x);var w=n.deg2rad(u.settings.visualElements.heightPlaneAngleCutoff),M=new p.LaserlineVisualElement({view:g,attached:!1,angleCutoff:w});u.settings.visualElements.heightPlane.apply(M);var S=1,O=1,R=function(){if(b.update(e),!o.displaying||_&&(o.isDraped||!v(f)||!f.geometry.hasZ))return t.laserlineEnabled=!1,x.attached=!1,void(M.attached=!1);t.laserlineEnabled=!0;var r=4&b.grabbingState?u.settings.visualElements.laserlineAlphaMultiplier:1;r!==S&&(S=r,u.settings.visualElements.lineGraphics.shadowStyle.apply(t,r),u.settings.visualElements.pointGraphics.shadowStyle.apply(x,r));var n=2&b.grabbingState?u.settings.visualElements.laserlineAlphaMultiplier:1;n!==O&&(O=n,u.settings.visualElements.heightPlane.apply(M,n)),function(e,t){var r=1===t.numSelected?t.firstSelected:t.numSelected>1&&i.isSome(t.firstGrabbedXY)?t.firstGrabbedXY:null;i.isSome(r)?(u.settings.visualElements.zVerticalLine.infinite&&(e.worldDownAtLocation=r.renderLocation),e.attached=!0):e.attached=!1}(x,b),function(e,t,r,n){if(n.numSelected>0){a.vec3.set(m,0,0,0);var o=0;e.forEachManipulator((function(e,t){1===t&&e.selected&&e instanceof l.Manipulator3D&&(a.vec3.add(m,m,e.renderLocation),o++)})),o>0?(r.heightManifoldTarget=a.vec3.scale(m,m,1/o),r.attached=!0):r.attached=!1}else{var s=t.attachmentOrigin;i.isSome(s)&&e.view.renderCoordsHelper.toRenderCoords(s,m)?(r.heightManifoldTarget=m,r.attached=!0):r.attached=!1}}(e,t,M,b)};u.settings.visualElements.zVerticalLine.apply(x),h.push(o.on("changed",R),o.watch("displaying",R),t.events.on("attachment-origin-changed",R),r.destroyHandle(x),r.destroyHandle(M));var E=[],P=function(){r.handlesGroup(E).remove(),E.length=0,e.forEachManipulator((function(e){return E.push(e.events.on("grab-changed",R))})),e.forEachManipulator((function(e){return E.push(e.events.on("select-changed",R))})),R()};P(),h.push(e.onManipulatorsChanged(P),r.refHandle((function(){return r.handlesGroup(E)})))}(e,_,g,y),y.push(t.maskOccludee(o)),y.push(t.trackGraphicState(g)),{visualElement:_,remove:function(){r.handlesGroup(y).remove()}}};var m=o.vec3f64.create()}).apply(null,n))||(e.exports=i)},PXiz:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("1m5D"),r("0LE5"),r("Rdxj"),r("2fXB"),r("j2SP"),r("MCHn"),r("2W+Z"),r("aWgr"),r("fXZm"),r("ys4y"),r("4ziW"),r("RC9r"),r("SNs2")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineVisualElement=void 0;var m=function(){function e(e){var t=this;this.view=null,this._ray=u.ray.create(),this._isWorldDown=!1,this._start=a.vec3f64.create(),this._end=a.vec3f64.fromValues(1,0,0),this._width=1,this._color=s.vec4f32.fromValues(1,0,1,1),this._innerWidth=1,this._innerColor=s.vec4f32.fromValues(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._infinite=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._occludedMode=4,this.resources=new c.VisualElementResources({view:e.view,cameraChanged:function(){return t.updateGeometry()},createResources:function(e){return t.createResources(e)}}),this._laserline=new l.LaserlineVisualElement({view:e.view});var r=!0;for(var n in e)n in this?"attached"===n?r=e[n]:this[n]=e[n]:console.error("Cannot set unknown property",n);this.attached=r}return e.prototype.destroy=function(){this.resources.destroy(),this._laserline.destroy()},Object.defineProperty(e.prototype,"laserlineAttached",{get:function(){return this.attached&&!this.hidden&&this._laserlineEnabled&&r.isSome(this._laserlineStyle)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e,this._laserline.attached=this.laserlineAttached},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached},set:function(e){this.resources.attached=e,this._laserline.attached=this.laserlineAttached},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldDownAtLocation",{set:function(e){this._isWorldDown=!0,i.vec3.copy(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),i.vec3.subtract(this._end,e,this._end),u.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"start",{get:function(){return this._start},set:function(e){this._isWorldDown=!1,i.vec3.exactEquals(this._start,e)||(i.vec3.copy(this._start,e),u.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},set:function(e){this._isWorldDown=!1,i.vec3.exactEquals(this._end,e)||(i.vec3.copy(this._end,e),u.ray.fromPoints(this._start,this._end,this._ray),this.updateGeometry())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){o.vec4.exactEquals(e,this._color)||(o.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerWidth",{get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerColor",{get:function(){return this._innerColor},set:function(e){o.vec4.exactEquals(e,this._innerColor)||(o.vec4.copy(this._innerColor,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stipplePattern",{get:function(){return this._stipplePattern},set:function(e){var t=r.isSome(e)!==r.isSome(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stippleOffColor",{get:function(){return this._stippleOffColor},set:function(e){(r.isNone(e)||r.isNone(this._stippleOffColor)||!o.vec4.exactEquals(e,this._stippleOffColor))&&(this._stippleOffColor=r.isSome(e)?s.vec4f32.clone(e):null,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"falloff",{get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"infinite",{get:function(){return this._infinite},set:function(e){e!==this._infinite&&(this._infinite=e,this.updateGeometry())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"laserlineStyle",{get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,r.isSome(e)&&(this._laserline.style=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"laserlineEnabled",{get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(e){e!==this._occludedMode&&(this._occludedMode=e,r.isSome(this.resources.resources)&&(this.resources.resources.material.renderOccluded=e))},enumerable:!1,configurable:!0}),e.prototype.updateMaterial=function(){var e=this.resources.resources;r.isNone(e)||e.material.setParameterValues(this.materialParameters)},Object.defineProperty(e.prototype,"materialParameters",{get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff}},enumerable:!1,configurable:!0}),e.prototype.updateGeometry=function(){var e=this.resources.object;r.isNone(e)||this.updateVertices(e)},e.prototype.updateVertices=function(e){if(this._infinite){var t=this.view.state.camera;switch(p.fromRay(this._ray,g),this._infinite){case 2:g.c0=-Number.MAX_VALUE;break;case 1:case 3:var r=this._ray.origin,n=this.view.elevationProvider.getElevation(r[0],r[1],r[2],this.view.renderCoordsHelper.spatialReference,"ground"),a=this.view.renderCoordsHelper.getAltitude(r);this._isWorldDown&&a<n&&i.vec3.negate(g.ray.direction,g.ray.direction),3===this._infinite&&null!=n&&(g.c1=Math.abs(a-n))}if(!u.frustum.intersectClipRay(t.frustum.planes,g))return void this.updateVertexAttributes(e,this._start,this._end);var o=p.getStart(g,y),s=p.getEnd(g,_);this.updateVertexAttributes(e,o,s),this._laserline.intersectsLine=u.lineSegment.fromPoints(o,s,b)}else this.updateVertexAttributes(e,this._start,this._end),this._laserline.intersectsLine=u.lineSegment.fromPoints(this._start,this._end,b)},e.prototype.updateVertexAttributes=function(e,t,r){var n=e.geometryRecords[0].geometry.data.getVertexAttr()[v.RibbonVertexAttributeConstants.POSITION].data;n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=r[0],n[4]=r[1],n[5]=r[2],e.geometryVertexAttrsUpdated(0)},e.prototype.createResources=function(e){var t=[a.vec3f64.create(),a.vec3f64.create()],r=new d(h.createPolylineGeometry(t),"lineVisualElement"),i=new f(this.materialParameters,"lineVisualElement");return i.renderOccluded=this._occludedMode,e.addGeometry(r,i,n.mat4f64.IDENTITY),this.updateVertices(e),{material:i,geometry:r,forEach:function(e){return e(i),e(r)}}},e}();t.LineVisualElement=m;var g=p.create(),y=a.vec3f64.create(),_=a.vec3f64.create(),b=u.lineSegment.create()}).apply(null,n))||(e.exports=i)},Px2u:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("Gtr7"),r("R2Zq"),r("LxLY"),r("KBgh"),r("Vx27"),r("FNtW"),r("znI2"),r("ZeO9")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SortedRenderGeometryRenderer=void 0;var p=function(){},d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._pendingAddsRemoves=new Map,t._adds=new o,t._removes=new o,t._updates=new o({allocator:function(e){return e||new p},deallocator:function(e){return e.renderGeometry=null,e}}),t._materialRenderers=new Map,t._sortedMaterialRenderers=new o,t._hasHighlights=!1,t._hasWater=!1,t}return r.__extends(t,e),t.prototype.dispose=function(){this._adds.prune(),this._removes.prune(),this._updates.prune(),this._materialRenderers&&(this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear())},Object.defineProperty(t.prototype,"updating",{get:function(){return this._pendingAddsRemoves.size>0||this._updates.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendersOccluded",{get:function(){return i.someMap(this._materialRenderers,(function(e){return e.rendersOccluded}))},enumerable:!1,configurable:!0}),t.prototype.stopAnimationsAtTime=function(e){this._sortedMaterialRenderers.forEachSimple((function(t){return a.applySome(t.material.animation,(function(t){return t.stopAtTime(e)}))}))},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!this.updating&&0===this._materialRenderers.size},enumerable:!1,configurable:!0}),t.prototype.commitChanges=function(){var e=this,t=!1;if(!this.updating)return!1;this.updateAddsRemoves();var r=c.splitRenderGeometryChangeSetByMaterial({numToAdd:this._adds.length,toAdd:this._adds.data,numToRemove:this._removes.length,toRemove:this._removes.data,numToUpdate:this._updates.length,toUpdate:this._updates.data}),n=!1,a=!1;return r.forEach((function(r,i){var o=e._materialRenderers.get(i);if(!o&&r.toAdd.length>0&&(o=new u(e.rctx,e.materialRepository,i),e._materialRenderers.set(i,o),t=!0,n=!0,a=!0),o){var s=n||o.hasHighlights,l=a||o.hasWater;o.modify(r),n=n||s!==o.hasHighlights,a=a||l!==o.hasWater,o.isEmpty&&(e._materialRenderers.delete(i),o.dispose(),t=!0)}})),this._adds.clear(),this._removes.clear(),this._updates.clear(),this._pendingAddsRemoves.clear(),t&&this.updateSortedMaterialRenderers(),n&&(this._hasHighlights=i.someMap(this._materialRenderers,(function(e){return e.hasHighlights}))),a&&(this._hasWater=i.someMap(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0},t.prototype.add=function(e){for(var t=0===this._pendingAddsRemoves.size,r=0,n=e;r<n.length;r++)this._pendingAddsRemoves.set(n[r],0);t&&this._pendingAddsRemoves.size>0&&this.notifyChange("updating")},t.prototype.remove=function(e){for(var t=0===this._pendingAddsRemoves.size,r=0,n=e;r<n.length;r++){var i=n[r],a=this._pendingAddsRemoves.get(i);0===a?this._pendingAddsRemoves.set(i,2):2!==a&&this._pendingAddsRemoves.set(i,1)}t&&this._pendingAddsRemoves.size>0&&this.notifyChange("updating")},t.prototype.modify=function(e,t){for(var r=0===this._updates.length,n=0,i=e;n<i.length;n++){var a=i[n],o=this._updates.pushNew();o.renderGeometry=a,o.updateType=t}r&&this._updates.length>0&&this.notifyChange("updating")},t.prototype.updateLogic=function(e){for(var t=!1,r=0;r<this._sortedMaterialRenderers.length;r++){var n=this._sortedMaterialRenderers.data[r].materialRenderer;n.updateLogic&&n.updateLogic(e)&&(t=!0)}return t},t.prototype.draw=function(e,t,r){for(var n=0;n<this._sortedMaterialRenderers.length;n++){var i=this._sortedMaterialRenderers.data[n];if(l.materialPredicate(i.material,e)){var a=r.getMaterialRenderStatsObject(i.materialRenderer.type);i.materialRenderer.render(null,e,t,a)}}},t.prototype.updateSortedMaterialRenderers=function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(r,n){n.insertOrder=t++,e._sortedMaterialRenderers.push({material:n,materialRenderer:r})})),this._sortedMaterialRenderers.sort((function(e,t){var r=t.material.renderPriority-e.material.renderPriority;return 0!==r?r:e.material.insertOrder-t.material.insertOrder}))},t.prototype.updateAddsRemoves=function(){var e=this;this._adds.clear(),this._removes.clear(),this._pendingAddsRemoves.forEach((function(t,r){switch(t){case 0:e._adds.push(r);break;case 1:e._removes.push(r)}}));for(var t=0;t<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[t].renderGeometry)?this._updates.removeUnorderedIndex(t):t++},Object.defineProperty(t.prototype,"test",{get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}},enumerable:!1,configurable:!0}),r.__decorate([s.property()],t.prototype,"rctx",void 0),r.__decorate([s.property()],t.prototype,"materialRepository",void 0),r.__decorate([s.property()],t.prototype,"updating",null),r.__decorate([s.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],t)}(n);t.SortedRenderGeometryRenderer=d}).apply(null,n))||(e.exports=i)},QDiq:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("0LE5"),r("Rdxj"),r("2Mej")],void 0===(i=(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SceneLighting=void 0;var a=n.vec3f64.create(),o=function(){function e(){this._renderLighting={main:{intensity:n.vec3f64.create(),direction:n.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldSunlight={direction:n.vec3f64.create(),ambient:{color:n.vec3f64.create(),intensity:0},diffuse:{color:n.vec3f64.create(),intensity:0}}}return e.prototype.setLightDirectionUniform=function(e){e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)},e.prototype.setUniforms=function(e,t){void 0===t&&(t=!1),e.setUniform1f("lightingFixedFactor",t?(1-this._info.groundLightingFactor)*(1-this._info.globalFactor):0),e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var r=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",r.r[0],r.g[0],r.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",r.r[0],r.r[1],r.r[2],r.r[3]),e.setUniform4f("lightingAmbientSH_G",r.g[0],r.g[1],r.g[2],r.g[3]),e.setUniform4f("lightingAmbientSH_B",r.b[0],r.b[1],r.b[2],r.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",r.r[0],r.g[0],r.b[0]),e.setUniform4f("lightingAmbientSH_R1",r.r[1],r.r[2],r.r[3],r.r[4]),e.setUniform4f("lightingAmbientSH_G1",r.g[1],r.g[2],r.g[3],r.g[4]),e.setUniform4f("lightingAmbientSH_B1",r.b[1],r.b[2],r.b[3],r.b[4]),e.setUniform4f("lightingAmbientSH_R2",r.r[5],r.r[6],r.r[7],r.r[8]),e.setUniform4f("lightingAmbientSH_G2",r.g[5],r.g[6],r.g[7],r.g[8]),e.setUniform4f("lightingAmbientSH_B2",r.b[5],r.b[6],r.b[7],r.b[8]))},e.prototype.set=function(e){this._info=e,i.combineLights(e.lights,this._shOrder,this._renderLighting),r.vec3.negate(this._oldSunlight.direction,this._renderLighting.main.direction);var t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldSunlight.ambient.intensity=1,this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*t,this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*t,this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*t,this._oldSunlight.diffuse.intensity=1;var n=r.vec3.copy(a,this._oldSunlight.diffuse.color);r.vec3.scale(n,n,.4*this._info.globalFactor),r.vec3.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,n)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"old",{get:function(){return this._oldSunlight},enumerable:!1,configurable:!0}),e}();t.SceneLighting=o}).apply(null,n))||(e.exports=i)},R4nD:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("BcWh"),r("LxLY"),r("0LE5"),r("Rdxj"),r("2fXB"),r("j2SP"),r("WRgd"),r("ZcgO"),r("as1Q"),r("MCHn"),r("2W+Z"),r("fOZq"),r("hADE"),r("mmEe"),r("ys4y"),r("+nCE"),r("cjy9"),r("RC9r"),r("SNs2")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlineVisualElement=void 0;var x=function(){function e(e){var t=this;this.view=null,this._attachmentOrigin=c.makeDehydratedPoint(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new r,this._isDraped=!1,this._geometry=null,this._width=1,this._color=s.vec4f32.fromValues(1,0,1,1),this._innerWidth=1,this._innerColor=s.vec4f32.fromValues(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._occludedMode=8,this.resources=new d.VisualElementResources({view:e.view,createResources:function(e){return t.createResources(e)},recreateGeometry:function(e,r){return e.geometries.length=0,t.recreateGeometry(r,e.material,e.geometries),e.geometries}}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new u.DrapedVisualElementResources({view:e.view,createResources:function(){return t.createDrapedResources()},recreateGeometry:function(e){e.geometries=t.createRenderGeometriesDraped(e.material),t.attachmentOriginChanged()}});var n=!0;for(var i in this._laserline=new p.LaserlineVisualElement({view:e.view}),e)i in this?"attached"===i?n=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=n}return e.prototype.destroy=function(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()},Object.defineProperty(e.prototype,"isDraped",{get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"laserlineAttached",{get:function(){return this.attached&&!this.hidden&&n.isSome(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e,this.drapedResources.hidden=e,this._laserline.attached=this.laserlineAttached},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this.updateAttached(e)},enumerable:!1,configurable:!0}),e.prototype.updateAttached=function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()},Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){o.vec4.exactEquals(e,this._color)||(o.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerWidth",{get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerColor",{get:function(){return this._innerColor},set:function(e){o.vec4.exactEquals(e,this._innerColor)||(o.vec4.copy(this._innerColor,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stipplePattern",{get:function(){return this._stipplePattern},set:function(e){var t=n.isSome(e)!==n.isSome(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stippleOffColor",{get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&o.vec4.exactEquals(e,this._stippleOffColor)||(this._stippleOffColor=e?s.vec4f32.clone(e):null,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"falloff",{get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"laserlineStyle",{get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,n.isSome(e)&&(this._laserline.style=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"laserlineEnabled",{get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(e){e!==this._occludedMode&&(this._occludedMode=e,n.isSome(this.resources.resources)&&(this.resources.resources.material.renderOccluded=e),n.isSome(this.drapedResources.resources)&&(this.drapedResources.resources.material.renderOccluded=e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attachmentOrigin",{get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=n.isSome(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;i.vec3.set(S,0,0,0);for(var t=b.RibbonVertexAttributeConstants.POSITION,r=0,a=0,o=e;a<o.length;a++){var s=o[a],l=s.getAttribute(t),c=s.getIndices(t),u=n.unwrap(this.resources.resources).material.isClosed(l.data,c);g.computeAttachmentOriginLines(l,c,u,M)&&(i.vec3.add(S,S,M),r++)}return 0===r?null:(i.vec3.scale(S,S,1/r),this.view.renderCoordsHelper.fromRenderCoords(S,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)},enumerable:!1,configurable:!0}),e.prototype.updateMaterial=function(){n.isSome(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),n.isSome(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)},Object.defineProperty(e.prototype,"isClosed",{get:function(){return n.isSome(this.geometry)&&"polygon"===this.geometry.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"materialParameters",{get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0}},enumerable:!1,configurable:!0}),e.prototype.recreateGeometry=function(e,t,r){for(var n=0,i=this.createRenderGeometries();n<i.length;n++){var a=i[n];e.addGeometry(a,t),r.push(a)}this.attachmentOriginChanged()},e.prototype.attachmentOriginChanged=function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")},e.prototype.createResources=function(e){var t=new _(this.materialParameters,"lineVisualElement");t.renderOccluded=8;var r=[];return this.recreateGeometry(e,t,r),{material:t,geometries:r,forEach:function(e){e(t),r.forEach(e)}}},e.prototype.createDrapedResources=function(){var e=new _(this.materialParameters,"lineVisualElement");return e.renderOccluded=4,{material:e,geometries:this.createRenderGeometriesDraped(e)}},e.prototype.createRenderGeometriesDraped=function(e){var t=this.geometry;if(n.isNone(t))return[];for(var r=[],a=0,o=f.geometryToRenderInfoDraped(t,this.view.basemapTerrain.spatialReference).lines;a<o.length;a++){var s=o[a].position,c=new y(f.createGeometryData({attributeData:{position:s},removeDuplicateStartEnd:this.isClosed?1:0}));c.material=e;var u=l.empty(w);l.expandWithBuffer(u,s),i.vec3.set(c.center,.5*(u[0]+u[3]),.5*(u[1]+u[4]),0),c.bsRadius=.5*Math.sqrt((u[3]-u[0])*(u[3]-u[0])+(u[4]-u[1])*(u[4]-u[1])),r.push(c)}return r},e.prototype.calculateMapBounds=function(e){if(n.isNone(this.resources.resources))return!1;for(var t=this.view.renderCoordsHelper,r=0,i=this.resources.resources.geometries;r<i.length;r++){var a=i[r].data.getAttribute("position"),o=a.data,s=new Float64Array(o.length);v.bufferToBuffer(a.data,t.spatialReference,0,s,this.view.spatialReference,0,o.length/3),l.expandWithBuffer(e,s)}return!0},e.prototype.createRenderGeometries=function(){var e=this.geometry;if(n.isNone(e))return[];for(var t=[],r=[],i=0,a=f.geometryToRenderInfo(e,this.view.elevationProvider,this.view.renderCoordsHelper,h.ElevationContext.fromElevationInfo(this.elevationInfo)).lines;i<a.length;i++){var o=a[i],s=o.position,l=f.createGeometryData({attributeData:{position:s,mapPosition:o.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0});t.push(new m(l,"geometryOutlineVisualElement")),r.push(s)}return this._laserline.pathVerticalPlane=r,t},e}();t.OutlineVisualElement=x;var w=l.create(),M=a.vec3f64.create(),S=a.vec3f64.create()}).apply(null,n))||(e.exports=i)},RWrl:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("BcWh"),r("eIBl"),r("xoE+"),r("LxLY"),r("afW+"),r("jBNx"),r("8MXS"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("qysZ"),r("DtIM"),r("woUR"),r("5T2R"),r("B3XD"),r("Fe95"),r("aWgr"),r("AzkI"),r("JjCO"),r("ys4y"),r("4ziW"),r("o5p5"),r("bz+r")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w,M,S,O,R){"use strict";var E;Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicScaleRotateTransform=void 0,function(e){e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.Unlocked=1024,e.DelayedFocused=2048,e.TouchInput=32768}(E||(E={}));var P=function(){function e(e){var t=this;this.mode=null,this._handles=new i,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new n,this.getFocused=function(){return t.ringManipulator.focused},this.getScale=function(){return o.isSome(t._scaleRotateDragData)&&"scale"===t._scaleRotateDragData.mode?t._scaleRotateDragData.scale:1},this.tool=e.tool,this.mode=e.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}return e.prototype.destroy=function(){o.isSome(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null},e.prototype.startAnimation=function(e){var t=this;this.cancelActiveAnimation(),e.start();var n=s.addFrameTask({update:function(r){e.update(r.deltaTime)&&t.cancelActiveAnimation()}});this._activeAnimation=r.__assign(r.__assign({},e),{frameTask:n})},e.prototype.cancelActiveAnimation=function(){o.isSome(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)},e.prototype.forEachManipulator=function(e){e(this.ringManipulator,2)},e.prototype.createManipulator=function(){var e=this;this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);var t=this.tool.graphicState.graphic,r=R.createManipulatorDragEventPipeline(this.ringManipulator,(function(r,n,i){e._scaleRotateDragData=null;var s=function(e,t){var r=e.allLayerViews.find((function(e){return e.layer===t.layer}));if(o.isNone(t.symbol))return null;var n=t.symbol;return{symbolLayers:n.symbolLayers.map((function(e){var t=null;return"object"===e.type&&(t=e.heading),{heading:t,size:r.getSymbolLayerSize(n,e)}})).toArray()}}(e.tool.view,t);if(o.isNone(s))return e.updateDragState(),null;var l={mode:"none",origin:h.vec3f64.clone(r.renderLocation),angle:0,startAngle:e.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:s};e._scaleRotateDragData=l,e.updateDragState();var c=w.sv3d.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(r.renderLocation,c),n.next(y.screenToRenderPlane(e.tool.view,b.plane.fromPositionAndNormal(r.renderLocation,c))).next((function(r){var n=b.plane.normal(r.plane),i=g.calculateInputRotationTransform(r.renderStart,r.renderEnd,l.origin,n),s=x.cyclicalPI.shortestSignedDiff(l.angle,i);l.angleDir=a.clamp(l.angleDir+s,-_.ROTATE_INDICATOR_DIRECTION_BUFFER,_.ROTATE_INDICATOR_DIRECTION_BUFFER),l.angle=i;var c=function(e,t){var r=d.vec3.subtract(w.sv3d.get(),t.renderStart,e.origin),n=d.vec3.subtract(w.sv3d.get(),t.renderEnd,e.origin),i=d.vec3.length(r),a=d.vec3.length(n);return 0===i?0:a/i}(l,r);if(l.scaleDir=a.clamp(l.scaleDir+(c-l.scale),-_.SCALE_INDICATOR_DIRECTION_BUFFER,_.SCALE_INDICATOR_DIRECTION_BUFFER),l.scale=c,e.onScaleChanged(),"none"===l.mode){var u=e.mode||function(e,t,r,n){var i=e.renderStart,a=e.renderEnd,o=C(i,n,w.sv3d.get()),s=C(a,n,w.sv3d.get());if(d.vec3.squaredDistance(o,s)<_.DRAG_THRESHOLD_PX*_.DRAG_THRESHOLD_PX)return null;var l=d.vec3.subtract(w.sv3d.get(),i,r),c=d.vec3.cross(w.sv3d.get(),l,t),u=i,p=d.vec3.add(w.sv3d.get(),u,c),h=C(r,n,w.sv3d.get()),f=o,v=C(p,n,w.sv3d.get()),m=d.vec3.subtract(w.sv3d.get(),v,f),g=d.vec3.subtract(w.sv3d.get(),o,h),y=b.ray.wrap(f,m),x=b.ray.wrap(h,g);return b.ray.distance2(y,s)<b.ray.distance2(x,s)?"rotate":"scale"}(r,r.plane,l.origin,e.tool.view.state.camera);if(o.isSome(u)){switch(u){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:t,angle:l.angle});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:t,scale:l.scale})}l.mode=u}}if(e.updateDragState(),o.isSome(t.symbol)){var p=t.symbol.clone(),h=0,f=1;switch(l.mode){default:case"none":break;case"scale":f=l.scale;break;case"rotate":h=l.angle}e.applySymbolData(p,l.startSymbolData,h,f),t.symbol=p,e.updateManipulatorTransform()}switch(r.action){case"start":case"update":switch(l.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:t,angle:l.angle});break;case"scale":e.tool.emit("graphic-scale",{graphic:t,scale:l.scale})}break;case"end":switch(l.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:t,angle:l.angle});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:t,scale:l.scale});break;default:case"none":}}"end"===r.action&&(e.startAnimation(T(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState())})),i.next(R.resetSymbol(t)).next((function(){if(o.isSome(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:t,angle:e._scaleRotateDragData.startAngle});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:t,scale:1})}e.startAnimation(T(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null}}))}));this._handles.add(r),this._handles.add([this.ringManipulator.events.on("focus-changed",(function(t){var r,n,i,a,o;"focus"===t.action?e.startAnimation((r=e,n=function(){return e.updateDelayedFocusedState()},i=0,a=null,o=function(){return!1},{start:function(){a=r.getFocused,r.getFocused=o,i=0,n()},update:function(e){return i+=e,!a()||i>_.RING_INDICATOR_DELAY_MS?1:0},destroy:function(){r.getFocused=a,n()}})):e.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(function(e){e.stopPropagation()})),c.init(this.tool.graphicState,"displaying",(function(t){return e.ringManipulator.available=t})),this.tool.graphicState.on("changed",(function(){return g.placeAtGraphic(e.tool.view,e.ringManipulator,t)}))]),g.placeAtGraphic(this.tool.view,this.ringManipulator,t)},e.prototype.onScaleChanged=function(){this.events.emit("scale-changed"),this.updateManipulatorTransform()},e.prototype.updateDelayedFocusedState=function(){this.ringManipulator.updateStateEnabled(E.DelayedFocused,this.getFocused())},e.prototype.updateDragState=function(){if(this.ringManipulator.updateStateEnabled(E.Unlocked,!(o.isSome(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),o.isSome(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(E.ScaleIn|E.ScaleOut,!1),this.ringManipulator.updateStateEnabled(E.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(E.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(E.RotateLeft|E.RotateRight,!1),this.ringManipulator.updateStateEnabled(E.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(E.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(E.ScaleIn|E.ScaleOut|E.RotateLeft|E.RotateRight,!1)},e.prototype.updateManipulatorTransform=function(){var e=u.mat4.identity(w.sm4d.get());u.mat4.rotate(e,e,this.tool.symbolRotationAngle,h.vec3f64.fromValues(0,0,1));var t=this.getScale(),r=u.mat4.fromScaling(w.sm4d.get(),d.vec3.set(w.sv3d.get(),t,t,t)),n=u.mat4.identity(w.sm4d.get());u.mat4.multiply(n,r,e),this.ringManipulator.modelTransform=n},e.prototype.createRingManipulator=function(){for(var e=function(e,t,r){for(var n=[],i=Math.ceil(_.GEOMETRY_SEGMENTS*(t-e)/(2*Math.PI)),a=0;a<i+1;a++){var o=e+a*(t-e)/i;n.push(h.vec3f64.fromValues(r*Math.cos(o),r*Math.sin(o),0))}return n},t=function(t){return e(0,2*Math.PI,t)},n=function(e,t){return new M(S.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,_.RING_HEIGHT/2],[-e/2,_.RING_HEIGHT/2]]}(t),e,[],[],!1),"graphic-transform-ring")},i=t(_.RING_RADIUS),a=n(i,_.RING_THICKNESS),o={left:[],right:[]},s=[],l=0;l<2;l++){var c=(P=l*Math.PI-Math.PI/4)+(C=Math.PI/2-_.ROTATE_INDICATOR_ARC_LENGTH),d=P+Math.PI/2-C,f=n(T=e(c,d,_.INNER_INDICATOR_RADIUS),_.INDICATOR_THICKNESS);s.push(T),s.push(e(c,d,_.OUTER_INDICATOR_RADIUS-_.RING_THICKNESS/2)),o.left.push(f),o.right.push(f);for(var g=0;g<2;g++){var y=0===g,b=p.mat4f64.create();if(y){u.mat4.scale(b,b,[1,-1,1]),u.mat4.rotate(b,b,-c,[0,0,1]);var x=Math.round(_.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE*(T.length-1));b[12]=T[x][0],b[13]=T[x][1],b[14]=T[x][2]}else u.mat4.rotate(b,b,d,[0,0,1]),x=Math.round((1-_.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE)*(T.length-1)),b[12]=T[x][0],b[13]=T[x][1],b[14]=T[x][2];var w=S.createExtrudedTriangle(_.ROTATE_INDICATOR_ARROW_TIP_LENGTH,0,_.ROTATE_INDICATOR_ARROW_TIP_RADIUS,_.RING_HEIGHT);S.transformInPlace(w,b);var O=new M(w,"graphic-transform-ring-rotate");(y?o.left:o.right).push(O)}}var R=[];for(l=0;l<2;l++){c=(P=l*Math.PI-Math.PI/4)+(C=Math.PI/2-_.SCALE_INDICATOR_ARC_LENGTH),d=P+Math.PI/2-C;var P,C,T=e(c,d,_.OUTER_INDICATOR_RADIUS);R.push(n(T,_.INDICATOR_THICKNESS))}var D=t(_.RING_RADIUS+_.SCALE_INDICATOR_OFFSET1),A=t(_.RING_RADIUS+_.SCALE_INDICATOR_OFFSET2),I=n(D,_.INDICATOR_THICKNESS),j=n(A,_.INDICATOR_THICKNESS),V=t(_.RING_RADIUS-_.SCALE_INDICATOR_OFFSET1),G=t(_.RING_RADIUS-_.SCALE_INDICATOR_OFFSET2),z=n(V,_.INDICATOR_THICKNESS),L=n(G,_.INDICATOR_THICKNESS),N=this.createMaterial(),U=this.createMaterial(.66),F=this.createMaterial(.5),H=this.createMaterial(.33),k=[{geometry:a,material:N,stateMask:E.DelayedFocused},{geometry:a,material:F,stateMask:0}];this.mode&&"scale"!==this.mode||(k=k.concat([{geometry:R,material:N,stateMask:E.DelayedFocused|E.Unlocked},{geometry:I,material:U,stateMask:E.DelayedFocused|E.ScaleIn},{geometry:j,material:H,stateMask:E.DelayedFocused|E.ScaleIn},{geometry:z,material:U,stateMask:E.DelayedFocused|E.ScaleOut},{geometry:L,material:H,stateMask:E.DelayedFocused|E.ScaleOut}])),this.mode&&"rotate"!==this.mode||(k=k.concat([{geometry:o.right,material:N,stateMask:E.DelayedFocused|E.Unlocked},{geometry:o.left,material:N,stateMask:E.DelayedFocused|E.RotateLeft},{geometry:o.right,material:N,stateMask:E.DelayedFocused|E.RotateRight}]));var B=r.__spreadArrays([i],s);return new m.Manipulator3D({view:this.tool.view,renderObjects:k,autoScaleRenderObjects:!1,worldOriented:!0,radius:_.RING_THICKNESS,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:v.getGraphicEffectiveElevationInfo(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:B,direction:h.vec3f64.fromValues(0,0,1)}})},e.prototype.createMaterial=function(e){void 0===e&&(e=1);var t=r.__spreadArrays(_.HANDLE_COLOR,[e]),n=new O({color:t,transparent:1!==e,cullFace:2},"graphic-transform");return n.renderOccluded=2,n},e.prototype.applySymbolData=function(e,t,r,n){var i=this;e.symbolLayers.forEach((function(e,a){var s=t.symbolLayers[a],l=s.heading,c=s.size;"object"===e.type&&(e.heading=(o.isSome(l)?l:0)-f.toDegree(r),o.isSome(c)&&"width"in c&&(c.width=i.enforceNonZeroSize(c.width),c.height=i.enforceNonZeroSize(c.height),c.depth=i.enforceNonZeroSize(c.depth),e.width=c.width*n,e.depth=c.depth*n,e.height=c.height*n))}))},e.prototype.enforceNonZeroSize=function(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)},Object.defineProperty(e.prototype,"test",{get:function(){return{ringManipulator:this.ringManipulator}},enumerable:!1,configurable:!0}),e}();function C(e,t,r){var n=t.projectPoint(e,l.castRenderScreenPointArray(D)),i=t.renderToScreen(n,A);return d.vec3.set(r,i[0],i[1],0)}function T(e,t){var r=null,n=1,i=function(){return n};return{start:function(){n=e.getScale(),r=e.getScale,e.getScale=i,t()},update:function(e){return n+=((n+1)/2-n)*Math.min(e*_.RING_RESET_ANIMATION_SPEED_FACTOR,1),t(),Math.abs(n-1)<.01?1:0},destroy:function(){e.getScale=r,t()}}}t.GraphicScaleRotateTransform=P;var D=h.vec3f64.create(),A=l.createScreenPointArray()}).apply(null,n))||(e.exports=i)},Raj5:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("RsYQ")],void 0===(i=(function(e,t,r){"use strict";var n=function(){function e(e,t,n,a,o,s){this.camera=null,this.lastFrameCamera=new r.default,this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=i,this.hasOccludees=!1,this.rctx=e,this.offscreenRenderingHelper=t,this.scenelightingData=n,this.shadowMap=a,this.ssaoHelper=o,this.sliceHelper=s}return e.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=i},Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!1,configurable:!0}),e}(),i=13;return n}).apply(null,n))||(e.exports=i)},"RdU/":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("B4Pz"),r("7Aei")],void 0===(i=(function(e,t,r,n,i){"use strict";function a(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(n.FoamIntensity),e.fragment.code.add(i.glsl(o||(o=r.__makeTemplateObject(["\n      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress = computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength = waveParams[2];\n        float flowOffset = waveParams[3];\n\n        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress = computeProgress(uv, time + phaseOffset);\n        float weight = computeWeight(uv, time + phaseOffset);\n\n        vec2 result = uv;\n        result -= flowVector * (progress + flowOffset);\n        result += phaseOffset;\n        result += (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\n      const float TIME_NOISE_STRENGTH = 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength = waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement = time * -_waveDir;\n\n        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal = normalize(normal_A + normal_B);\n        mixNormal.xy *= waveStrength;\n        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat = waveParams[1];\n        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  = normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "],["\n      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress = computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength = waveParams[2];\n        float flowOffset = waveParams[3];\n\n        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress = computeProgress(uv, time + phaseOffset);\n        float weight = computeWeight(uv, time + phaseOffset);\n\n        vec2 result = uv;\n        result -= flowVector * (progress + flowOffset);\n        result += phaseOffset;\n        result += (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\n      const float TIME_NOISE_STRENGTH = 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength = waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement = time * -_waveDir;\n\n        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal = normalize(normal_A + normal_B);\n        mixNormal.xy *= waveStrength;\n        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat = waveParams[1];\n        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  = normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "]))))}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.WaterDistortion=void 0,t.WaterDistortion=a,function(e){e.bindUniforms=function(e,t){e.setUniform1i("texWaveNormal",0),e.setUniform1i("texWavePerturbation",1),e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}}(a=t.WaterDistortion||(t.WaterDistortion={}))}).apply(null,n))||(e.exports=i)},T95R:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("BcWh"),r("LxLY"),r("jBNx"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("2fXB"),r("O7NG"),r("WRgd"),r("X5J5"),r("2W+Z"),r("fOZq"),r("v+nG"),r("mmEe"),r("RsYQ"),r("ys4y"),r("4ziW"),r("o5p5"),r("uZGf")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VerticesVisualElement=void 0;var w=function(){function e(e){var t=this;this.view=null,this.camera=new g.default,this.events=new r,this._vertices=null,this._spatialReference=null,this._color=d.settings.colorToVec4(d.settings.reshapeManipulators.vertex.color),this._elevationInfo=null,this._occludedMode=8,this.resources=new h.VisualElementResources({view:e.view,createResources:function(e){return t.createResources(e)},recreateGeometry:function(e,r){return e.geometries.length=0,t.recreateGeometry(r,e.vertexMaterial,e.vertexOutlineMaterial,e.geometries),e.geometries},cameraChanged:function(e){return t.resources.recreateGeometry()}});var n=!0;for(var i in e)i in this?"attached"===i?n=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=n}return e.prototype.destroy=function(){this.resources.destroy()},Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached},set:function(e){this.updateAttached(e)},enumerable:!1,configurable:!0}),e.prototype.updateAttached=function(e){this.resources.attached=e},Object.defineProperty(e.prototype,"vertices",{get:function(){return this._vertices},set:function(e){this._vertices=e,this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){c.vec4.exactEquals(e,this._color)||(c.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(e){e!==this._occludedMode&&(this._occludedMode=e,n.isSome(this.resources.resources)&&(this.resources.resources.vertexMaterial.renderOccluded=e,this.resources.resources.vertexOutlineMaterial.renderOccluded=e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vertexMaterialParameters",{get:function(){return{color:this._color,transparent:this._color[3]<1}},enumerable:!1,configurable:!0}),e.prototype.updateMaterial=function(){n.isSome(this.resources.resources)&&this.resources.resources.vertexMaterial.setParameterValues(this.vertexMaterialParameters)},e.prototype.recreateGeometry=function(e,t,r,n){for(var i=0,a=this.createRenderGeometries();i<a.length;i++){var o=a[i];e.addGeometry(o.vertexGeometry,t,o.xform),n.push(o.vertexGeometry),e.addGeometry(o.vertexOutlineGeometry,r,o.xform),n.push(o.vertexOutlineGeometry)}},e.prototype.createResources=function(e){var t=this.color,r=u.vec4f64.fromValues(t[0],t[1],t[2],t.length>3?t[3]:1),n=new x.ShadedColorMaterial({color:r,transparent:t[3]<1,writeDepth:!0,cullFace:2},"manipulator");n.renderOccluded=d.settings.reshapeManipulators.vertex.renderOccludedFlag;var i=d.settings.colorToVec4(d.settings.reshapeManipulators.vertex.outlineColor),a=u.vec4f64.fromValues(i[0],i[1],i[2],4===i.length?i[3]:1),o=new b({color:a,transparent:!0,writeDepth:!0,cullFace:1},"manipulator-outline");o.renderOccluded=d.settings.reshapeManipulators.vertex.renderOccludedFlag;var s=[];return this.recreateGeometry(e,n,o,s),{vertexMaterial:n,vertexOutlineMaterial:o,geometries:s,forEach:function(e){e(n),e(o),s.forEach(e)}}},e.prototype.calculateMapBounds=function(e){if(n.isNone(this.resources.resources))return!1;for(var t=this.view.renderCoordsHelper,r=0,i=this.resources.resources.geometries;r<i.length;r++){var a=i[r].data.getAttribute("position"),o=a.data,s=new Float64Array(o.length);m.bufferToBuffer(a.data,t.spatialReference,0,s,this.view.spatialReference,0,o.length/3),p.expandWithBuffer(e,s)}return!0},e.prototype.computeScreenLocation=function(e,t){return t.pixelSize=this.camera.computeScreenPixelSizeAt(e),this.camera.projectPoint(e,t.renderScreenPointArray),this.camera.renderToScreen(t.renderScreenPointArray,t.screenPointArray),t},e.prototype.computeTransform=function(e,t){var r=o.mat4f64.create(),n=t*this.computeScreenLocation(e,M).pixelSize;return a.mat4.set(r,n,0,0,0,0,n,0,0,0,0,n,0,0,0,0,1),r[12]+=e[0],r[13]+=e[1],r[14]+=e[2],r[15]=1,r},e.prototype.createRenderGeometries=function(){var e=this.vertices;if(n.isNone(e)||0===e.length)return[];if(!this.view.state||!this.view.state.camera)return[];this.camera.copyFrom(this.view.state.camera);for(var t=d.settings.reshapeManipulators.vertex,r=t.size/2,i=r+t.collisionPadding,a=r/i,o=(r+t.outlineSize)/i,l=v.geometryToRenderInfo(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,f.ElevationContext.fromElevationInfo(this.elevationInfo)),c=[],u=l.numVertices,p=l.position,h=0;h<u;++h){var m=new y(_.createSphereGeometry(a,16,16),"VerticesVisualElement-vertex"),g=new y(_.createSphereGeometry(o,16,16),"VerticesVisualElement-vertexOutline"),b=s.vec3.set(S,p[3*h+0],p[3*h+1],p[3*h+2]),x=this.computeTransform(b,i);c.push({vertexGeometry:m,vertexOutlineGeometry:g,xform:x})}return c},e}();t.VerticesVisualElement=w;var M={screenPointArray:i.createScreenPointArray(),renderScreenPointArray:i.createRenderScreenPointArray3(),pixelSize:0},S=l.vec3f64.create()}).apply(null,n))||(e.exports=i)},TIRl:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("LxLY"),r("DtIM"),r("bz+r")],void 0===(i=(function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SnapToScene=void 0;var o=function(){function e(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new a.EventPipeline,this._enabled=!1}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&n.isSome(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,r=this.snap(this.lastDragEvent.screenEnd);n.isSome(r)&&this.next.execute({action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?r:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd})}this._enabled=e},enumerable:!1,configurable:!0}),e.prototype.snap=function(e){var t=n.isSome(this.view)?this.view.toMap(e,{exclude:[]}):null;return n.isSome(t)&&n.isSome(this.view)&&(t.z=i.getZForElevationMode(t,this.view,this.elevationInfo)),t},e.prototype.createDragEventPipelineStep=function(e,t){var i=this;return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,function(e){if(i.lastDragEvent="end"!==e.action?r.__assign({},e):null,i._enabled){var t=i.snap(e.screenEnd);return n.isSome(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}},e}();t.SnapToScene=o}).apply(null,n))||(e.exports=i)},VQEQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("W9tT"),r("DIqE"),r("O7NG"),r("fese"),r("hs8d"),r("uUnu"),r("aRjO"),r("PaEL"),r("3PFg"),r("IwVr"),r("rCq5"),r("DKwL"),r("2o+p"),r("7Aei"),r("aExC")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g){"use strict";function y(e,t){var r,i,a;return void 0===t&&(t=G),e.textureIsSignedDistanceField?((a=t)[0]=(r=e.anchorPos)[0]*((i=e.distanceFieldBoundingBox)[2]-i[0])+i[0],a[1]=r[1]*(i[3]-i[1])+i[1]):n.vec2.copy(t,e.anchorPos),t}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateAnchorPosForRendering=t.HUDMaterial=t.build=void 0,t.build=function(e){var t=new g.ShaderBuilder,n=e.signedDistanceFieldEnabled;if(t.include(s.AlignPixel),t.include(l.HUD,e),t.include(o.Slice,e),6===e.output)return t.include(c.HUDOcclusionPass,e),t;t.include(v.ScreenSizePerspective),t.fragment.include(f.RgbaFloatEncoding),t.fragment.include(h.ColorConversion),t.include(p.VisualVariables,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),n&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(m.glsl(x||(x=r.__makeTemplateObject(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "],["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),m.glsl(e.screenSizePerspectiveEnabled?_||(_=r.__makeTemplateObject(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "],["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "])):b||(b=r.__makeTemplateObject(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"],["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var i=m.glsl(w||(w=r.__makeTemplateObject(["\n      vec2 uv01 = floor(uv0);\n      vec2 uv = uv0 - uv01;\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "],["\n      vec2 uv01 = floor(uv0);\n      vec2 uv = uv0 - uv01;\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "]))),a=m.glsl(n?M||(M=r.__makeTemplateObject(["\n  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"],["\n  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"])):S||(S=r.__makeTemplateObject(["\n  posProj += quadOffset;\n  if (inputSize.x == size.x) {\n    posProj = alignToPixelOrigin(posProj, viewport.zw);\n  }"],["\n  posProj += quadOffset;\n  if (inputSize.x == size.x) {\n    posProj = alignToPixelOrigin(posProj, viewport.zw);\n  }"])));t.vertex.code.add(m.glsl(R||(R=r.__makeTemplateObject(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "],["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "])),e.occlusionTestEnabled?"if (visible) {":"",i,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",m.glsl.float(d.symbolAlphaCutoff),n?"alphaDiscard = alphaDiscard && outlineColor.a < "+m.glsl.float(d.symbolAlphaCutoff)+";":"",a,e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?m.glsl(O||(O=r.__makeTemplateObject(["} else { vtc = vec2(0.0);\n        ",""],["} else { vtc = vec2(0.0);\n        ",""])),e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),t.fragment.uniforms.add("tex","sampler2D"),n&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));var y=e.debugDrawBorder?m.glsl(E||(E=r.__makeTemplateObject(["(isBorder > 0.0 ? 0.0 : ",")"],["(isBorder > 0.0 ? 0.0 : ",")"])),m.glsl.float(d.defaultMaskAlphaCutoff)):m.glsl.float(d.defaultMaskAlphaCutoff),G=m.glsl(A||(A=r.__makeTemplateObject(["\n    ","\n\n    ","\n\n    ","\n  "],["\n    ","\n\n    ","\n\n    ","\n  "])),e.debugDrawBorder?m.glsl(P||(P=r.__makeTemplateObject(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"],["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",n?m.glsl(C||(C=r.__makeTemplateObject(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "],["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),y,m.glsl.float(d.symbolAlphaCutoff),y):m.glsl(T||(T=r.__makeTemplateObject(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "],["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),y),e.debugDrawBorder?m.glsl(D||(D=r.__makeTemplateObject(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"],["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");return 0===e.output&&t.fragment.code.add(m.glsl(I||(I=r.__makeTemplateObject(["\n    void main() {\n      ","\n    }\n    "],["\n    void main() {\n      ","\n    }\n    "])),G)),4===e.output&&(t.include(u.OutputHighlight),t.fragment.code.add(m.glsl(V||(V=r.__makeTemplateObject(["\n    void main() {\n      ","\n      ","\n    }\n    "],["\n    void main() {\n      ","\n      ","\n    }\n    "])),G,e.binaryHighlightOcclusionEnabled?m.glsl(j||(j=r.__makeTemplateObject(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"],["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t},function(e){e.bindUniforms=function(e,t,r){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",a.vec4f64.ZEROS),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*r,2*t.screenOffset[1]*r),e.setUniform2fv("anchorPos",y(t))}}(t.HUDMaterial||(t.HUDMaterial={})),t.calculateAnchorPosForRendering=y;var _,b,x,w,M,S,O,R,E,P,C,T,D,A,I,j,V,G=i.vec2f64.create()}).apply(null,n))||(e.exports=i)},X5J5:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("QDcU"),r("KtQ6"),r("pcDC"),r("O7NG"),r("FbvD")],void 0===(i=(function(e,t,r,n,i,a,o,s){"use strict";function l(e,t){var r=e.clone();return r.a*=t,r}function c(e,t){var r=e.clone(),n=i.toHSV(r);n.s*=t;var a=i.toRGB(n);return r.r=a.r,r.g=a.g,r.b=a.b,r}function u(e,t){if(t)for(var r in t)e[r]=t[r]}Object.defineProperty(t,"__esModule",{value:!0}),t.settings=t.colors=void 0,t.colors={main:new n([255,127,0]),selected:new n([255,255,255]),staged:new n([12,207,255]),outline:new n([0,0,0,.5]),selectedOutline:new n([255,255,255])};var p=function(){function e(e){this.color=t.colors.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.occludedMode="always",u(this,e)}return Object.defineProperty(e.prototype,"occludedFlag",{get:function(){return M(this.occludedMode)},enumerable:!1,configurable:!0}),e}(),d=function(){function e(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=t.colors.main,this.outlineColor=t.colors.outline,this.occludedMode="always",this.hoverOutlineColor=t.colors.selectedOutline,u(this,e)}return Object.defineProperty(e.prototype,"renderOccludedFlag",{get:function(){return M(this.occludedMode)},enumerable:!1,configurable:!0}),e.prototype.apply=function(e,t){var r=this[e];t.setParameterValues({color:w(r),transparent:"color"!==e||r.a<1}),t.renderOccluded=this.renderOccludedFlag},e}(),h=function(e){this.vertex=new d({color:t.colors.main,outlineColor:t.colors.outline}),this.edge=new d({color:c(l(t.colors.main,2/3),.5),outlineColor:l(t.colors.outline,.5),size:8,collisionPadding:8}),this.selected=new d({color:t.colors.selected,outlineColor:t.colors.outline}),u(this,e)},f=function(){function e(e){this.color=t.colors.selected,this.width=1.5,this.stipplePattern=s.createStipplePattern([5,5]),this.stippleOffColor=t.colors.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=t.colors.selected,this.occludedMode="transparent",this.occludedLayer="default",u(this,e)}return e.prototype.apply=function(e){e.color=w(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=w(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=w(this.innerColor),e.occludedMode=M(this.occludedMode,{layer:this.occludedLayer})},e}(),v=function(){function e(e){this.color=t.colors.selected,this.size=4,this.outlineSize=1,this.outlineColor=t.colors.outline,this.shape="square",u(this,e)}return e.prototype.apply=function(e){e.color=w(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=w(this.outlineColor),e.primitive=this.shape},e}(),m=function(){function e(e){this.innerColor=t.colors.selected,this.innerWidth=1,this.glowColor=t.colors.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=t.colors.main,u(this,e)}return e.prototype.apply=function(e,t){void 0===t&&(t=1);var r={glowColor:n.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:n.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=r:e.laserlineStyle=r},e}(),g=function(e){this.outline=new f({color:t.colors.selected,occludedMode:"transparent",occludedLayer:"foreground",stippleOffColor:t.colors.outline,stipplePattern:s.createStipplePattern([5,5]),width:1.5}),this.staged=new f({color:t.colors.selected,occludedMode:"transparent",occludedLayer:"foreground",innerColor:t.colors.staged,stippleOffColor:t.colors.outline,stipplePattern:s.createStipplePattern([5,5]),width:1.5}),this.shadowStyle=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:1}),u(this,e)},y=function(e){this.outline=new v({color:t.colors.selected,outlineColor:t.colors.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:1.5,glowWidth:6,innerColor:t.colors.selected,innerWidth:1,radius:2}),u(this,e)},_=function(e){function t(t){var r=e.call(this)||this;return r.infinite="ground",u(r,t),r}return r.__extends(t,e),Object.defineProperty(t.prototype,"infiniteType",{get:function(){switch(this.infinite){case"single":return 1;case"double":return 2;case"ground":return 3;default:return a.neverReached(this.infinite),1}},enumerable:!1,configurable:!0}),t}(f),b=function(e){this.lineGraphics=new g,this.pointGraphics=new y,this.heightPlane=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:1}),this.heightBox=new m({globalAlpha:.3,glowColor:t.colors.main,glowFalloff:8,glowWidth:8,innerColor:t.colors.selected,innerWidth:0,heightFillColor:t.colors.main}),this.zVerticalLine=new _({color:l(t.colors.main,.5),falloff:2,innerColor:l(t.colors.selected,0),occludedMode:"transparent",stipplePattern:null,width:5,infinite:"ground"}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,u(this,e)},x=function(){function e(e){this.visualElements=new b,this.reshapeManipulators=new h,this.zManipulator=new p,u(this,e)}return e.prototype.colorToVec4=function(e){return w(e)},e}();function w(e){return o.vec4f64.fromArray(n.toUnitRGBA(e))}function M(e,t){var r=t&&"foreground"===t.layer;switch(e){case"always":return r?32:16;case"transparent":return r?8:4;case"always-transparent":return 2;default:a.neverReached(e)}return 1}t.settings=new x}).apply(null,n))||(e.exports=i)},Xakh:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";function i(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "],["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "]))))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.Reprojection=void 0,t.Reprojection=i,function(e){e.bindUniforms=function(e,t,r){e.setUniform1i("lastFrameColorMap",r.lastFrameColorTextureID),t.bindTexture(r.lastFrameColorTexture,r.lastFrameColorTextureID),e.setUniformMatrix4fv("reprojectionMat",r.reprojectionMat),e.setUniformMatrix4fv("rpProjectionMat",r.camera.projectionMatrix)}}(i=t.Reprojection||(t.Reprojection={}))}).apply(null,n))||(e.exports=i)},XcBT:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("KQg4"),r("W/V4"),r("FQ4r"),r("lBa0"),r("ff/U"),r("G0ER"),r("qbr3"),r("2Kdy")],void 0===(i=(function(e,t,n,i,a,o,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureTechniqueConfiguration=t.TextureTechnique=void 0;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get().build();return new c(e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),l.Default3D)},t.prototype.initializePipeline=function(){return u.makePipelineState(this.configuration.hasAlpha?{blending:u.separateBlendingParams(770,1,771,771),colorWrite:u.defaultColorWriteParams}:{colorWrite:u.defaultColorWriteParams})},t.shader=new a.ReloadableShaderModule(i,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[r("KQg4")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(o.ShaderTechnique);t.TextureTechnique=p;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasAlpha=!1,t}return n.__extends(t,e),n.__decorate([s.parameter()],t.prototype,"hasAlpha",void 0),t}(s.ShaderTechniqueConfiguration);t.TextureTechniqueConfiguration=d}).apply(null,n))||(e.exports=i)},YseA:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResizableFloat32Array=void 0;var n=function(){function e(e){null==e?e=16:e<65536&&(e=r.nextHighestPowerOfTwo(e)),this._array=new Float32Array(e),this._size=0}return e.prototype.resize=function(e,t){if(this._size=e,this._size>this._array.length){for(var r=this._array.length||1;r<this._size;)r*=2;var n=new Float32Array(r);return t&&n.set(this._array),this._array=n,!0}var i=2*this._size;if(i<=this._array.length){for(r=this._array.length;r>=i;)r=Math.floor(r/2);return n=new Float32Array(r),t&&n.set(this._array.subarray(0,r)),this._array=n,!0}return!1},e.prototype.append=function(e){var t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)},e.prototype.erase=function(e,t){for(var r=e;r<t;++r)this._array[r]=0},Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),e}();t.ResizableFloat32Array=n}).apply(null,n))||(e.exports=i)},ZeO9:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("R2Zq"),r("R2Zq"),r("LxLY"),r("LxLY"),r("FXVB"),r("1m5D"),r("MzcX"),r("FLCf"),r("YseA"),r("CIy2"),r("CP88"),r("pbva"),r("PwS/"),r("QFi0"),r("Kfys"),r("z2+Q")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g){"use strict";var y=function(){function e(e,t,r){this.type="MergedRenderer",this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._rctx=e,this._material=r,this._materialRep=t,this._glMaterials=f.acquireMaterials(this._material,this._materialRep),this._bufferWriter=r.createBufferWriter()}return e.prototype.dispose=function(){f.releaseMaterials(this._material,this._materialRep),this._dataByOrigin&&(this._dataByOrigin.forEach((function(e){e.vao.dispose(!0),e.vao=null})),this._dataByOrigin.clear(),this._dataByOrigin=null),this._glMaterials&&(this._glMaterials.forEach((function(e){e&&e.dispose()})),this._glMaterials.clear(),this._glMaterials=null)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasOccludees",{get:function(){return this._hasOccludees},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasWater",{get:function(){return!this.isEmpty&&n.someMap(this._glMaterials,(function(e){return e instanceof d.WaterGLMaterial}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rendersOccluded",{get:function(){return!this.isEmpty&&1!==this._material.renderOccluded},enumerable:!1,configurable:!0}),e.prototype.modify=function(e){this.updateGeometries(e.toUpdate),this.addAndRemoveGeometries(e.toAdd,e.toRemove),this.updateRenderCommands()},e.prototype.addAndRemoveGeometries=function(e,t){var r=this,n=this._bufferWriter,i=n.vertexBufferLayout,a=i.stride/4,o=this._dataByOrigin,s=function(e,t,r,n){for(var i=new Map,a=t.vertexBufferLayout.stride/4,o=function(r,n){var o=r.origin,s=e.get(o.id),l=i.get(o.id);null==l&&i.set(o.id,l={optimalCount:null==s?0:s.optimalCount,sparseCount:null==s?0:s.buffer.size,toAdd:[],toRemove:[],origin:o.vec3});var c=t.elementCount(r.data)*a;n?(l.optimalCount+=c,l.sparseCount+=c,l.toAdd.push(r)):(l.optimalCount-=c,l.toRemove.push(r))},s=0,l=r;s<l.length;s++){var c=l[s];o(c,!0)}for(var u=0,p=n;u<p.length;u++)o(c=p[u],!1);return i}(o,n,e,t);s.forEach((function(e,t){s.delete(t);var n=e.optimalCount,l=e.sparseCount,c=o.get(t);if(null==c&&(p.assert(n>0),c=r.createData(i,n,e.origin),o.set(t,c)),0===n)return c.vao.dispose(!0),c.vao=null,void o.delete(t);var u=n<e.sparseCount/2,d=_,h=c.buffer.size,f=c.buffer.array,v=c.buffer.resize(u?n:l,!1);u||v?r.removeAndRebuild(c,e.toRemove,a,f,d):e.toRemove.length>0?(r.removeByErasing(c,e.toRemove,a,d),e.toAdd.length>0&&(d.end=h)):(d.begin=h,d.end=h);var m=b;p.setMatrixTranslation3(m,-e.origin[0],-e.origin[1],-e.origin[2]),r.append(c,e.toAdd,a,m,d);var g=c.vao.vertexBuffers.geometry;if(g.byteSize!==c.buffer.array.buffer.byteLength)g.setData(c.buffer.array);else{var y=d.begin,x=d.end;if(y<x){var w=4*y;g.setSubData(c.buffer.array,w,w,4*x)}}c.drawCommandsDirty=!0}))},e.prototype.updateGeometries=function(e){for(var t=this._bufferWriter,r=t.vertexBufferLayout.stride/4,n=0,i=e;n<i.length;n++){var a=i[n],o=a.updateType,s=a.renderGeometry,l=this._dataByOrigin.get(s.origin.id),c=l&&l.instances.get(s.uniqueName);if(!c)return;if(1&o&&(c.isVisible=s.instanceParameters.visible),9&o&&(c.hasHighlights=!!s.instanceParameters.highlights&&s.instanceParameters.visible),16&o&&(c.hasOccludees=!!s.instanceParameters.occludees),6&o){var u=l.buffer.array,d=l.vao;f.calculateTransformRelToOrigin(s,x,w),t.write({transformation:x,invTranspTransformation:w},s.data,t.vertexBufferLayout.createView(u.buffer),c.from),p.assert(c.from+t.elementCount(s.data)===c.to,"material VBO layout has changed"),d.vertexBuffers.geometry.setSubData(u,c.from*r*4,c.from*r*4,c.to*r*4)}l.drawCommandsDirty=!0}},e.prototype.updateRenderCommands=function(){this._dataByOrigin.forEach((function(e){e.hasHiddenInstances=n.someMap(e.instances,(function(e){return!e.isVisible})),e.hasHighlights=n.someMap(e.instances,(function(e){return e.isVisible&&e.hasHighlights})),e.hasOccludees=n.someMap(e.instances,(function(e){return e.isVisible&&e.hasOccludees}))})),this._hasHighlights=n.someMap(this._dataByOrigin,(function(e){return e.hasHighlights})),this._hasOccludees=n.someMap(this._dataByOrigin,(function(e){return e.hasOccludees})),this._dataByOrigin.forEach((function(e){e.drawCommandsDirty&&(function(e){if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.stats={default:0,highlight:0,occludees:0},0!==e.instances.size){if(!(e.hasOccludees||e.hasHighlights||e.hasHiddenInstances)){var t=4*e.buffer.size/m.getStride(e.vao.layout.geometry);return e.drawCommandsDefault=[{first:0,count:t}],void(e.stats={default:t,highlight:0,occludees:0})}var n=h.sortInstancesAccordingToRange(r.valuesOfMap(e.instances));e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[];for(var i=0,a=n;i<a.length;i++){var o=a[i];o.isVisible&&(h.addOrMerge(o.hasOccludees?e.drawCommandsOccludees:e.drawCommandsDefault,o),o.hasHighlights&&h.addOrMerge(e.drawCommandsHighlight,o))}var s=function(e){for(var t=0,r=0,n=e;r<n.length;r++)t+=n[r].count;return t/3};e.stats={default:s(e.drawCommandsDefault),highlight:s(e.drawCommandsHighlight),occludees:s(e.drawCommandsOccludees)}}}(e),e.drawCommandsDirty=!1)}))},e.prototype.updateLogic=function(e){return this._material.update(e)},e.prototype.render=function(e,t,r,n){var o=this,s=this._rctx,l=this._glMaterials.get(t.pass),u=4===t.pass,p=e;if(2===t.pass&&null===p&&(p=22),!l||2!==l.ensureResources(s)||null!=p&&!l.beginSlot(p)||u&&!this._hasHighlights)return!1;l.ensureParameters(r);var d=l.getTechnique(),h=l.getPipelineState(p,!1);s.setPipelineState(h),l.bind(s,r);var f=!1;return this._dataByOrigin.forEach((function(e){if(!(i.isNone(e.drawCommandsDefault)&&i.isNone(e.drawCommandsHighlight)&&i.isNone(e.drawCommandsOccludees))&&(!u||e.hasHighlights)){r.origin=e.origin,d.bindDraw(r),d.ensureAttributeLocations(e.vao),s.bindVAO(e.vao);var t=d.primitiveType,v=u?e.drawCommandsHighlight:e.drawCommandsDefault,m=u?e.stats.highlight:e.stats.default;if(a.isSome(v)&&(o.renderCommands(s,t,v),c.addToRenderStats(v.length,m,n),f=!0),!u&&a.isSome(v=e.drawCommandsOccludees)){var g=l.getPipelineState(p,!0);s.setPipelineState(g),o.renderCommands(s,t,v),s.setPipelineState(h),c.addToRenderStats(v.length,e.stats.occludees,n),f=!0}}})),f},e.prototype.renderCommands=function(e,t,r){for(var n=0;n<r.length;n++)e.drawArrays(t,r[n].first,r[n].count)},e.prototype.createData=function(e,t,r){return{instances:new Map,vao:new g(this._rctx,this._material.vertexAttributeLocations,{geometry:l.glLayout(e)},{geometry:v.createVertex(this._rctx,35044)}),buffer:new u.ResizableFloat32Array(t),optimalCount:0,origin:r,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,stats:{default:0,highlight:0,occludees:0}}},e.prototype.removeAndRebuild=function(e,t,r,n,i){for(var a=0,o=t;a<o.length;a++){var s=o[a].uniqueName,l=e.instances.get(s);e.optimalCount-=(l.to-l.from)*r,e.instances.delete(s)}var c=0,u=e.buffer.array;i.begin=0,i.end=0;var p=-1,d=-1,h=0;e.instances.forEach((function(e){var t=e.from*r,i=e.to*r,a=i-t;p!==d&&d!==t?(u.set(n.subarray(p,d),h),h+=d-p,p=t):-1===p&&(p=t),d=i,e.from=c/r,e.to=(c+=a)/r})),p!==d&&u.set(n.subarray(p,d),h),i.end=c},e.prototype.removeByErasing=function(e,t,r,n){n.begin=1/0,n.end=-1/0;for(var i=-1,a=-1,o=0,s=t;o<s.length;o++){var l=s[o].uniqueName,c=e.instances.get(l),u=c.from*r,p=c.to*r;i!==a&&a!==u?(e.buffer.erase(i,a),i=u):-1===i&&(i=u),a=p,e.instances.delete(l),e.optimalCount-=p-u,u<n.begin&&(n.begin=u),p>n.end&&(n.end=p)}i!==a&&e.buffer.erase(i,a)},e.prototype.append=function(e,t,r,n,i){for(var s=this._bufferWriter,l=0,c=t;l<c.length;l++){var u=c[l],d=a.isSome(u.transformation)?o.mat4.multiply(x,n,u.transformation):n;o.mat4.invert(w,d),o.mat4.transpose(w,w);var f=i.end;s.write({transformation:d,invTranspTransformation:w},u.data,s.vertexBufferLayout.createView(e.buffer.array.buffer),i.end/r);var v=s.elementCount(u.data)*r,m=f+v;p.assert(null==e.instances.get(u.uniqueName));var g=u.instanceParameters.visible,y=new h.Instance(f/r,m/r,g,!!u.instanceParameters.highlights&&g,!!u.instanceParameters.occludees);e.instances.set(u.uniqueName,y),e.optimalCount+=v,i.end+=v}},Object.defineProperty(e.prototype,"test",{get:function(){return{material:this._material,glMaterials:this._glMaterials}},enumerable:!1,configurable:!0}),e}(),_={begin:0,end:0},b=s.mat4f64.create(),x=s.mat4f64.create(),w=s.mat4f64.create();return y}).apply(null,n))||(e.exports=i)},aRjO:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.HUDOcclusion=t.HUDOcclusionPass=void 0,t.HUDOcclusionPass=function(e){var t=e;t.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "],["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])))),t.fragment.uniforms.add("color","vec4"),t.fragment.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n  void main() {\n    gl_FragColor = color;\n  }\n  "],["\n  void main() {\n    gl_FragColor = color;\n  }\n  "]))))},function(e){e.bindUniforms=function(e){e.setUniform4f("color",1,1,1,1)}}(t.HUDOcclusion||(t.HUDOcclusion={}))}).apply(null,n))||(e.exports=i)},as1Q:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrapedVisualElementResources=void 0;var n=function(){function e(e){this.resourceFactory=e,this._resources=null,this._hidden=!1,this._attached=!1}return e.prototype.destroy=function(){this._destroyResources()},Object.defineProperty(e.prototype,"resources",{get:function(){return r.isSome(this._resources)?this._resources.external:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this._hidden},set:function(e){e!==this._hidden&&(this._hidden=e,this._syncGeometriesToRenderer())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())},enumerable:!1,configurable:!0}),e.prototype.recreate=function(){this.attached&&this._createResources()},e.prototype.recreateGeometry=function(){this.resourceFactory.recreateGeometry?r.isNone(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()},e.prototype._createOrDestroyResources=function(){this._attached?r.isNone(this._resources)&&this._createResources():this._destroyResources()},e.prototype._createResources=function(){this._destroyResources();var e=this.resourceFactory.createResources();this._resources={layerView:{view:this.resourceFactory.view,notifyGraphicUpdate:function(){},watch:function(){return{remove:function(){}}}},external:e,geometriesAdded:!1},this._syncGeometriesToRenderer()},e.prototype._destroyResources=function(){r.isNone(this._resources)||(this.ensureRenderGeometriesRemoved(),this._resources=null)},e.prototype._syncGeometriesToRenderer=function(){this._hidden?this.ensureRenderGeometriesRemoved():this._hidden||this.ensureRenderGeometriesAdded()},e.prototype.ensureRenderGeometriesRemoved=function(){r.isNone(this._resources)||this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)},e.prototype.ensureRenderGeometriesAdded=function(){r.isNone(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)},e}();t.DrapedVisualElementResources=n}).apply(null,n))||(e.exports=i)},cjy9:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("CIzB"),r("AzkI"),r("+nCE"),r("62Ht"),r("CIy2"),r("PwS/")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d){"use strict";return function(){function e(e,t,r,n,i,a,s){this.uniqueName=null,this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.boundingInfo=t,this.material=r,this.origin=null,this.center=o.vec3f64.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=i,n&&this.updateTransformation(n,a),this.castShadow=s,this.instanceParameters={highlights:null,occludees:null,visible:!0}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,r){return t=t||l.maxScale(e),a.vec3.transformMat4(r,this.boundingInfo.getCenter(),e),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!1,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=i.mat4f64.create()),n.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(r.unwrapOr(this.transformation,s.IDENTITY))),this.shaderTransformationDirty=!1),this.shaderTransformation):r.unwrapOr(this.transformation,s.IDENTITY)},e.prototype.computeAttachmentOrigin=function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(r.isSome(this.transformation)&&a.vec3.transformMat4(e,e,this.transformation),!0);var t=this.getIndices(p.VertexAttrConstants.POSITION),n=this.getAttribute(p.VertexAttrConstants.POSITION);return!!c.computeAttachmentOriginTriangles(n,t,e)&&(r.isSome(this.transformation)&&a.vec3.transformMat4(e,e,this.transformation),!0)},e.prototype.getIndices=function(e){return"indices"in this.data?this.data.indices[e]:null},e.prototype.getAttribute=function(e){return"vertexAttr"in this.data?this.data.vertexAttr[e]:null},e.prototype.addHighlight=function(){var e=u.generateObject3DStateId(0),t=this.instanceParameters;return t.highlights=d.addObject3DStateID(t.highlights,e),e},e.prototype.removeHighlight=function(e){var t=this.instanceParameters;t.highlights=d.removeObject3DStateID(t.highlights,e)},e}()}).apply(null,n))||(e.exports=i)},"dl/g":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KY0m")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getShaderOutputID=t.ShaderOutputTypes=void 0,t.ShaderOutputTypes=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"}],t.getShaderOutputID=function(e,n){return e+"_"+r.find(t.ShaderOutputTypes,(function(e){return e.output===n})).name}}).apply(null,n))||(e.exports=i)},dtql:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("CqfC"),r("KwnQ"),r("W9tT"),r("DIqE"),r("21p4"),r("lRq4"),r("AzkI"),r("bz+r")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.primaryShapeOrientation=t.createGraphicMoveDragPipeline=void 0,t.createGraphicMoveDragPipeline=function(e,t,r){var n=e.graphic,i=function(e,r){return t({action:e,graphic:n,dxScreen:r.screenDeltaX,dyScreen:r.screenDeltaY})};return r((function(e,t,r){t.next((function(e){return"start"===e.action&&i("start",e),e})).next(u.dragGraphic(n)).next((function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&i("update",e);break;case"end":i("end",e)}return e})),r.next(u.resetGraphic(n)).next((function(){i("end",{screenDeltaX:0,screenDeltaY:0})}))}))},t.primaryShapeOrientation=function(e){if(r.isNone(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=s.convexHull(e),i=t&&t.rings&&t.rings[0];if(!i)return 0;!function(e){for(var t=0,r=0,n=0,i=e;n<i.length;n++){var a=i[n];t+=a[0],r+=a[1]}t/=e.length,r/=e.length;for(var o=0,s=e;o<s.length;o++)(a=s[o])[0]-=t,a[1]-=r}(i);for(var o=[],u=0;u<i.length-1;u++){var f=Math.atan2(i[u+1][1]-i[u][1],i[u+1][0]-i[u][0]),v=c.cyclical2PI.normalize(f)%(Math.PI/2);o.push(v)}for(var m=o.sort((function(e,t){return e-t})),g=null,y=0,_=Number.POSITIVE_INFINITY,b=0,x=0,w=m;x<w.length;x++)if((f=w[x])!==g){g=f,n.mat2.fromRotation(p,f),l.empty(d);for(var M=0,S=i;M<S.length;M++)a.vec2.transformMat2(h,S[M],p),l.expandPointInPlace(d,h);var O=l.area(d);((O>_?_/O:O/_)>=.99&&f<y||O<_)&&(y=f,_=O),b=Math.max(b,O)}return _/b>=.95?0:y};var p=i.mat2f64.create(),d=l.create(),h=o.vec2f64.create()}).apply(null,n))||(e.exports=i)},eHCP:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Rdxj")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fromValues=t.fromVector=void 0,t.fromVector=function(e,t){return{vec3:r.vec3f64.clone(e),id:t}},t.fromValues=function(e,t,n,i){return{vec3:r.vec3f64.fromValues(e,t,n),id:i}}}).apply(null,n))||(e.exports=i)},fOZq:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("sSIw"),r("yVFQ")],void 0===(i=(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ElevationContext=void 0;var a=function(){function e(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return Object.defineProperty(e.prototype,"featureExpressionInfoContext",{get:function(){return this._featureExpressionInfoContext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=n.getMetersPerUnit(e)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"},Object.defineProperty(e.prototype,"offsetMeters",{set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetElevationInfoUnits",{set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0},enumerable:!1,configurable:!0}),e.prototype.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e},e.prototype.geometryZWithOffset=function(e,t){var r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r},e.prototype.calculateOffsetRenderUnits=function(e){var t=this._meterUnitOffset,r=this.featureExpressionInfoContext;return null!=r&&(t+=i.execute(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset},e.prototype.setFromElevationInfo=function(e){this.mode=e.mode,this.unit=e.unit||"meters",this.offsetElevationInfoUnits=r.unwrapOr(e.offset,0)},e.prototype.updateFeatureExpressionInfoContext=function(e,t,n){if(r.isNone(e))this._featureExpressionInfoContext=null;else{var a=e&&e.arcade;a&&r.isSome(t)&&r.isSome(n)?(this._featureExpressionInfoContext=i.clone(e),i.setContextFeature(this._featureExpressionInfoContext,i.createFeature(a.modules,t,n))):this._featureExpressionInfoContext=e}},e.fromElevationInfo=function(t){var n=new e;return r.isSome(t)&&n.setFromElevationInfo(t),n},e}();t.ElevationContext=a}).apply(null,n))||(e.exports=i)},gxI5:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisualElement=void 0;var r=function(){function e(e){this._attached=!1,this._visible=!0,this.view=e}return e.prototype.applyProps=function(e){var t=!1;for(var r in e)r in this?"attached"===r?t=e[r]:this[r]=e[r]:console.error("Cannot set unknown property",r);this.attached=t},e.prototype.destroy=function(){this.attached=!1},Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._attached?this.createResources():this.destroyResources())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))},enumerable:!1,configurable:!0}),e}();t.VisualElement=r}).apply(null,n))||(e.exports=i)},hADE:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+"),r("LxLY"),r("rusB"),r("0LE5"),r("Rdxj"),r("3Zlx"),r("HbaO"),r("/9Lg"),r("mmEe"),r("ij3I"),r("AgDx"),r("SNs2")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h){"use strict";function f(e,t,r){for(var n=new Array,i=0,a=e;i<a.length;i++){var o=a[i],s=o.count;if(!(s<=1)){var l=3*o.index,c=l+3*s;n.push({position:t.subarray(l,c),mapPosition:r?r.subarray(l,c):void 0})}}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.geometryToRenderInfoDraped=t.geometryToRenderInfo=t.createGeometryData=void 0,t.createGeometryData=function(e){var t={},o={};!function(e,t,r){for(var n=e.attributeData.position,a=(p=n)[0]===p[(d=p.length)-3]&&p[1]===p[d-2]&&p[2]===p[d-1]&&1===e.removeDuplicateStartEnd,o=n.length/3-(a?1:0),s=new Uint32Array(2*(o-1)),l=a?i.slice(n,0,n.length-3):n,c=0,u=0;u<o-1;u++)s[c++]=u,s[c++]=u+1;var p,d;t[h.RibbonVertexAttributeConstants.POSITION]={size:3,data:l,offsetIdx:0,strideIdx:3},r[h.RibbonVertexAttributeConstants.POSITION]=s}(e,o,t);var s=new Uint32Array(t[h.RibbonVertexAttributeConstants.POSITION].length);return function(e,t,r){var i=e.attributeData.mapPosition;n.isNone(i)||(r.mapPos=r[h.RibbonVertexAttributeConstants.POSITION],t.mapPos={size:3,data:i,offsetIdx:0,strideIdx:3})}(e,o,t),function(e,t,r,i){n.isSome(e.attributeData.colorFeature)||(t[h.RibbonVertexAttributeConstants.COLOR]={size:4,data:n.unwrapOr(e.attributeData.color,l.WHITE_UNIT),offsetIdx:0,strideIdx:4},r[h.RibbonVertexAttributeConstants.COLOR]=i)}(e,o,t,s),function(e,t,r,i){n.isSome(e.attributeData.sizeFeature)||(t[h.RibbonVertexAttributeConstants.SIZE]={size:1,data:new Float32Array([n.unwrapOr(e.attributeData.size,1)]),offsetIdx:0,strideIdx:1},r[h.RibbonVertexAttributeConstants.SIZE]=i)}(e,o,t,s),function(e,t,r,i){var a=e.attributeData.colorFeature;n.isNone(a)||(t[h.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE]={size:1,data:new Float32Array([a]),offsetIdx:0,strideIdx:1},r[h.RibbonVertexAttributeConstants.COLOR]=i)}(e,o,t,s),function(e,t,r,i){var a=e.attributeData.sizeFeature;n.isNone(a)||(t[h.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]={size:1,data:new Float32Array([a]),offsetIdx:0,strideIdx:1},r[h.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]=i)}(e,o,t,s),function(e,t,r,i){var a=e.attributeData.opacityFeature;n.isNone(a)||(t[h.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:new Float32Array([a]),offsetIdx:0,strideIdx:1},r[h.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]=i)}(e,o,t,s),function(e,t,i){if("round"===e.join){var o=t[h.RibbonVertexAttributeConstants.POSITION].data,s=o.length/3,l=new Float32Array(s),c=v,u=m;a.vec3.set(c,0,0,0);for(var p=n.unwrapOr(e.uniformSize,1),d=-1;d<s;++d){var f=d<0?s+d:d,y=(d+1)%s;if(a.vec3.set(u,o[3*y+0]-o[3*f+0],o[3*y+1]-o[3*f+1],o[3*y+2]-o[3*f+2]),a.vec3.normalize(u,u),d>=0){var _=(Math.PI-r.acosClamped(a.vec3.dot(c,u)))*g*1*(1.863798+-2.0062872/Math.pow(1+p/18.2313,.8856294));l[d]=Math.max(Math.floor(_),0)}a.vec3.scale(c,u,-1)}t[h.RibbonVertexAttributeConstants.SUBDIVISIONS]={size:1,data:l,offsetIdx:0,strideIdx:1},i[h.RibbonVertexAttributeConstants.SUBDIVISIONS]=i[h.RibbonVertexAttributeConstants.POSITION]}}(e,o,t),new d.GeometryData(o,t,"line")},t.geometryToRenderInfo=function(e,t,r,n){var i=s.pathsToTriangulationInfo("polygon"===e.type?e.rings:e.paths,e.hasZ,"polygon"===e.type?1:0),a=i.position,o=i.outlines,l=new Float64Array(a.length),u=c.applyPerVertexElevationAlignment(a,e.spatialReference,0,l,0,a,0,a.length/3,t,r,n),p=null!=u;return{lines:p?f(o,a,l):[],projectionSuccess:p,sampledElevation:u}},t.geometryToRenderInfoDraped=function(e,t){for(var r=s.pathsToTriangulationInfo("polygon"===e.type?e.rings:e.paths,!1,"polygon"===e.type?1:0),n=r.position,i=r.outlines,a=u.bufferToBuffer(n,e.spatialReference,0,n,t,0,n.length/3),o=2;o<n.length;o+=3)n[o]=p.DRAPED_Z;return{lines:a?f(i,n):[],projectionSuccess:a}};var v=o.vec3f64.create(),m=o.vec3f64.create(),g=4/Math.PI}).apply(null,n))||(e.exports=i)},hkmr:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("1m5D"),r("0LE5"),r("Rdxj"),r("Z4y+"),r("mmEe"),r("ys4y"),r("AgDx"),r("ZO6V"),r("eHCP"),r("ZJC8"),r("CIy2"),r("RC9r")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f){"use strict";var v=0,m=function(){function e(){this.ROOT_ORIGIN_ID="rg_root_"+v++,this._origins=new Map,this._gridSize=42e5}return e.prototype.getOrigin=function(t){var n=this._origins.get(this.ROOT_ORIGIN_ID);if(null==n){if(r.isSome(e.testOrigin)){var a=e.testOrigin;return this._origins.set(this.ROOT_ORIGIN_ID,p.fromValues(a[0],a[1],a[2],this.ROOT_ORIGIN_ID)),this.getOrigin(t)}var o=p.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,o),o}i.vec3.subtract(g,t,n.vec3),g[0]=Math.abs(g[0]),g[1]=Math.abs(g[1]),g[2]=Math.abs(g[2]);var s=this._gridSize;if(g[0]<s&&g[1]<s&&g[2]<s)return n;var l=Math.round(t[0]/s),c=Math.round(t[1]/s),u=Math.round(t[2]/s),d="rg_"+l+"/"+c+"/"+u,h=this._origins.get(d);return h||(h=p.fromValues(l*s,c*s,u*s,d),this._origins.set(d,h)),h},e.prototype._drawOriginBox=function(e){var t=window.view,r=t._stage;if(null==this._object){this._material=new f({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial"),r.add(3,this._material);var i=new u("GridLocalOrigin",{isPickable:!1});r.add(0,i),this._object=new d({idHint:"GridLocalOrigin",castShadow:!1}),r.add(1,this._object),i.addObject(this._object),r.addToViewContent([i.id])}for(var a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=a.length,v=new Float32Array(3*p),m=new Uint32Array(2*(p-1)),g=.5*this._gridSize,y=0;y<p;y++)v[3*y+0]=e[0]+(1&a[y]?g:-g),v[3*y+1]=e[1]+(2&a[y]?g:-g),v[3*y+2]=e[2]+(4&a[y]?g:-g),y>0&&(m[2*y+0]=y-1,m[2*y+1]=y);s.bufferToBuffer(v,o.WebMercator,0,v,t.spatialReference,0,p);var _={};_[h.VertexAttrConstants.POSITION]={size:3,data:v};var b={};b[h.VertexAttrConstants.POSITION]=m;var x=new c.GeometryData(_,b,"line"),w=new l(x,"GridLocalOriginBox");r.add(2,w),this._object.addGeometry(w,this._material,n.mat4f64.IDENTITY),console.log(this._origins.size,e)},e}(),g=a.vec3f64.create();return function(e){e.testOrigin=null}(m||(m={})),m}).apply(null,n))||(e.exports=i)},hs8d:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.AlignPixel=void 0,t.AlignPixel=function(e){var t=n.glsl(i||(i=r.__makeTemplateObject(["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "]))),o=n.glsl(a||(a=r.__makeTemplateObject(["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "])));e.vertex.code.add(t),e.vertex.code.add(o),e.fragment.code.add(t),e.fragment.code.add(o)}}).apply(null,n))||(e.exports=i)},i10q:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+"),r("LxLY"),r("0LE5"),r("Rdxj"),r("2fXB"),r("O7NG"),r("WRgd"),r("2W+Z"),r("/9Lg"),r("fOZq"),r("J2BX"),r("mmEe"),r("JjCO"),r("ys4y"),r("4ziW"),r("yqrJ"),r("CIy2"),r("xFEL")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointVisualElement=void 0;var b=function(){function e(e){var t=this;this.view=null,this._geometry=null,this._size=3,this._color=s.vec4f64.fromValues(1,0,1,1),this._primitive="square",this._outlineSize=1,this._outlineColor=s.vec4f64.fromValues(1,1,1,1),this._elevationInfo=null,this.resources=new c.VisualElementResources({view:e.view,createResources:function(e){return t.createResources(e)},recreateGeometry:function(e,r){return e.geometry=t.recreateGeometry(r,e.material),n.isSome(e.geometry)?[e.geometry]:[]}});var r=!0;for(var i in e)i in this?"attached"===i?r=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=r}return e.prototype.destroy=function(){this.resources.destroy()},Object.defineProperty(e.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(e){this.resources.hidden=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attached",{get:function(){return this.resources.attached},set:function(e){this.resources.attached=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){if(e!==this._size){var t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?n.isSome(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){o.vec4.exactEquals(e,this._color)||(o.vec4.copy(this._color,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"primitive",{get:function(){return this._primitive},set:function(e){this._primitive!==e&&(this._primitive=e,n.isSome(this.resources)&&this.resources.recreate())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"outlineSize",{get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(e){o.vec4.exactEquals(e,this._outlineColor)||(o.vec4.copy(this._outlineColor,e),this.updateMaterial())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()},enumerable:!1,configurable:!0}),e.prototype.updateMaterial=function(){var e=this.resources.resources;n.isNone(e)||e.material.setParameterValues(this.materialParameters(e.texture.id))},e.prototype.updateSizeAttribute=function(){var e=this.resources.resources,t=this.resources.object;if(!n.isNone(e)&&!n.isNone(t)){var r=e.geometry;if(!n.isNone(r)){var i=r.data.getVertexAttr()[y.VertexAttrConstants.SIZE].data,a=this.geometrySize;i[0]=a,i[1]=a,t.geometryVertexAttrsUpdated(0)}}},e.prototype.materialParameters=function(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:w,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1}},Object.defineProperty(e.prototype,"geometrySize",{get:function(){return this._size/x},enumerable:!1,configurable:!0}),e.prototype.recreateGeometry=function(e,t){var r=this.createRenderGeometry();return n.isSome(r)&&e.addGeometry(r,t),r},e.prototype.createResources=function(e){var t=this.createTexture(),r=new _.default(this.materialParameters(t.id),"pointVisualElement");r.renderOccluded=8;var i=this.recreateGeometry(e,r);return{material:r,texture:t,geometry:i,forEach:function(e){e(t),e(r),n.isSome(this.geometry)&&e(this.geometry)}}},Object.defineProperty(e.prototype,"preferredTextureSize",{get:function(){return r.clamp(r.nextHighestPowerOfTwo(2*this.geometrySize),16,128)},enumerable:!1,configurable:!0}),e.prototype.createTexture=function(){var e=this.preferredTextureSize;return new g(d.createType(this._primitive,e,e*x),"pointVisualElement",{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})},e.prototype.calculateMapBounds=function(e){if(n.isNone(this.resources.resources)||n.isNone(this.resources.resources.geometry))return!1;var t=this.resources.resources.geometry.data.getAttribute("position");return h.vectorToVector(t.data,this.view.renderCoordsHelper.spatialReference,M,this.view.spatialReference),l.expandWithBuffer(e,M),!0},e.prototype.createRenderGeometry=function(){var e=this.geometry;if(n.isNone(e))return null;var t=this.view.renderCoordsHelper,r=u.evaluateElevationAlignmentAtPoint(e,this.view.elevationProvider,p.ElevationContext.fromElevationInfo(this.elevationInfo),t),a=i.vec3.set(f.sv3d.get(),e.x,e.y,r),o=f.sv3d.get();h.vectorToVector(a,e.spatialReference,o,t.spatialReference);var s=this.geometrySize,l=m.createPointGeometry(null,o,null,[s,s],[0,0,0,1]);return new v(l)},e}();t.PointVisualElement=b;var x=.5,w=[x/2,x/2,1-x/2,1-x/2],M=a.vec3f64.create()}).apply(null,n))||(e.exports=i)},ij3I:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("Gtr7"),r("eIBl"),r("qsST"),r("R2Zq"),r("LxLY"),r("LxLY"),r("KBgh"),r("ULaq"),r("8MXS"),r("Vx27"),r("FXVB"),r("DIqE"),r("Rdxj"),r("Dk48"),r("N+ip"),r("GDWR"),r("y68M"),r("KRuQ"),r("RsYQ"),r("FU3N"),r("/Bau"),r("hkmr"),r("9DjX"),r("Raj5"),r("FLCf"),r("Px2u"),r("XcBT"),r("qUb7"),r("QDiq"),r("FbvD"),r("Zp3t"),r("Kfys")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w,M,S,O,R,E,P,C,T,D,A,I,j){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overlayRenderOccludedFlag=t.DRAPED_Z=t.OverlayRenderer=void 0;var V=a.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer"),G=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._hasHighlights=!1,t._rendersOccluded=!1,t._hasWater=!1,t._lighting=new D.SceneLighting,t._localOrigins=new S,t._handles=new i,t._layerRenderers=new Map,t._sortedLayerRenderersDirty=!1,t._sortedLayerRenderers=new c,t._stats=new E.RenderStatsAggregator,t._geometries=new Map,t._uniqueIdx=0,t.globalUnitScale=1,t.longitudeCyclical=null,t}return r.__extends(n,e),n.prototype.initialize=function(){var e=this;this._rctx=this.renderView.renderingContext,this._renderContext=new R(this._rctx,null,null,null,null,null),this._stippleTextureRepository=new A.StippleTextureRepository,this.waterTextureRepository=this.renderView.waterTextureRepository,this._shaderTechniqueRepository=new _.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:2,commonUniformStore:new y.CommonUniformStore,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),p.init(this.waterTextureRepository,"loadingState",(function(){return e.emitContentChanged()})),this._materialRepository=new w(this.renderView.textureRepository,this._shaderTechniqueRepository),this._materialRepository.onMaterialChanged=function(r){(r.renderOccluded&t.overlayRenderOccludedFlag)>0!==e._rendersOccluded&&e.updateRendersOccluded(),e.emitContentChanged(),e.notifyChange("updating")},this._compositingHelper=this.renderView.compositingHelper,this._lighting.set({lights:[new T.AmbientLight(v.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0}),this._bindParameters={slot:null,highlightDepthTexture:M.createEmptyDepthTexture(this._rctx),camera:N,inverseViewport:f.vec2f64.create(),origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting}},n.prototype.dispose=function(){this._handles.destroy(),this._layerRenderers.forEach((function(e){return e.dispose()})),this._layerRenderers.clear(),this._bindParameters.highlightDepthTexture.dispose(),this._bindParameters.highlightDepthTexture=null,this._shaderTechniqueRepository.dispose(),this._shaderTechniqueRepository=null},Object.defineProperty(n.prototype,"updating",{get:function(){return this._sortedLayerRenderersDirty||o.someMap(this._layerRenderers,(function(e){return e.updating}))||this.waterTextureRepository.updating},enumerable:!1,configurable:!0}),n.prototype.commitChanges=function(){var e=this,t=!1;this._layerRenderers.forEach((function(r,n){r.commitChanges()&&(t=!0),r.isEmpty&&(e._layerRenderers.delete(n),e._sortedLayerRenderersDirty=!0,e._handles.remove(n))})),this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),t=!0),t&&(this.notifyChange("updating"),this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())},n.prototype.addGeometries=function(e,t,r){for(var n=0,i=e;n<i.length;n++){var a=i[n];null==a.origin&&(a.origin=this._localOrigins.getOrigin(a.center)),a.uniqueName||(a.uniqueName="ov:"+this._uniqueIdx++),this._geometries.set(a.uniqueName,a)}this.ensureLayerRenderer(t).add(e),2===r&&this.notifyGraphicUpdate(e,t,2)},n.prototype.removeGeometries=function(e,t,r){for(var n=0,i=e;n<i.length;n++)this._geometries.delete(i[n].uniqueName);var a=this._layerRenderers.get(t);a&&(a.remove(e),2===r&&this.notifyGraphicUpdate(e,t,2))},n.prototype.updateGeometries=function(e,t,r){var n=this._layerRenderers.get(t);n?(n.modify(e,r),this.notifyUpdateGeometries(e,t,r)):V.warn("Attempted to update geometry for nonexistent layer")},n.prototype.notifyUpdateGeometries=function(e,t,r){this.notifyGraphicUpdate(e,t,4===r||2===r?2:1===r?1:0)},n.prototype.notifyGraphicUpdate=function(e,t,r){if(0!==r)for(var n=-1,i=0,a=e;i<a.length;i++){var o=a[i].data.graphicUid;o!==n&&(t.notifyGraphicUpdate(o,r),n=o)}},n.prototype.updateHighlights=function(e,t){var r=this._layerRenderers.get(t);r?r.modify(e,8):V.warn("Attempted to update highlights for nonexistent layer")},n.prototype.isEmpty=function(){return 0===this._geometries.size&&!m.OVERLAY_DRAW_DEBUG_TEXTURE},Object.defineProperty(n.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rendersOccluded",{get:function(){return this._rendersOccluded},enumerable:!1,configurable:!0}),n.prototype.updateLogic=function(e){var t=!1;return this._layerRenderers.forEach((function(r){r.updateLogic(e)&&(t=!0)})),t},n.prototype.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0},n.prototype.drawPass=function(e,r,n,i){var a=this;if(void 0===i&&(i=0),0===n.numViews)return!1;if(this._screenToWorldRatio=n.pixelRatio*Math.abs(n.views[0].extent[2]-n.views[0].extent[0])/Math.abs(n.views[0].viewport[2]-n.views[0].viewport[0]),this.isEmpty()||4===e&&!this.hasHighlights||2===e&&!this.hasWater)return!1;if(!this.hasNonZeroSizedView(n))return!1;var o=n.width,s=n.height;if(!r.isValid())return!1;r.resize(o,s);var c=this._rctx;if(N.pixelRatio=n.pixelRatio||1,this._renderContext.pass=e,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToWorldRatioGlobalWM=this._screenToWorldRatio*this.globalUnitScale,r.bind(c),c.setClearColor(0,0,0,0),c.clearSafe(16384),1===i&&(this._renderContext.renderOccludedMask=t.overlayRenderOccludedFlag),m.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==i)for(var u=0;u<n.numViews;u++)this.setViewParameters(n.views[u],N),this.drawDebugTexture(o,s,L[n.index%L.length]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forEachSimple((function(t){var u=t.layerView,p=t.renderer;if(2!==i||!l.isSome(u)||0!==u.drapeSourceType){var d=l.isSome(u)&&l.isSome(u.fullOpacity)&&u.fullOpacity<1&&0===e;d&&(a.bindTemporaryFramebuffer(a._rctx,o,s),c.clearSafe(16384));for(var h=0;h<n.numViews;h++)a.setViewParameters(n.views[h],N),p.draw(a._renderContext,a._bindParameters,a._stats);d&&l.isSome(a._temporaryRenderTarget)&&(r.bind(c),a._compositingHelper.composite(a._temporaryRenderTarget.getTexture(),2,l.unwrap(l.unwrap(u).fullOpacity)))}})),c.bindFramebuffer(null),r.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0},n.prototype.bindTemporaryFramebuffer=function(e,t,r){s.isNone(this._temporaryRenderTarget)&&(this._temporaryRenderTarget=new g.OverlayRenderTarget(e,"temp",0,!1)),this._temporaryRenderTarget.resize(t,r),this._temporaryRenderTarget.bind(e)},n.prototype.getStats=function(){return this._stats.getAggregatedStats()},n.prototype.hotReloadShaders=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this._shaderTechniqueRepository.hotReload()];case 1:return e.sent(),[2]}}))}))},n.prototype.intersect=function(e,t,r){var n=this,i=0;this._geometries.forEach((function(a){if(!r||r(a)){n.intersectRenderGeometry(a,t,0,e,i);var o=n.longitudeCyclical;o&&(a.center[0]-a.bsRadius<o.min&&n.intersectRenderGeometry(a,t,o.range,e,i),a.center[0]+a.bsRadius>o.max&&n.intersectRenderGeometry(a,t,-o.range,e,i)),i++}}))},n.prototype.intersectRenderGeometry=function(e,t,r,n,i){var a=this,o=0;l.isSome(e.transformation)&&(r+=e.transformation[12],o=e.transformation[13]),U[0]=t[0]-r,U[1]=t[1]-o,U[2]=1,F[0]=t[0]-r,F[1]=t[1]-o,F[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),n,U,F,(function(t,r,o){a.addIntersectionResult(o,e.material.renderPriority,i,n,e.data.layerUid,e.data.graphicUid)}),e.calculateShaderTransformation,!0)},n.prototype.addIntersectionResult=function(e,t,r,n,i,a){var o={type:"external",metadata:{layerUid:i,graphicUid:a}},s=function(i){i.set(o,null,n.results.ground.dist,n.results.ground.normal,n.results.ground.transformation,t,null,null,e,r),i.intersector="OverlayRenderer"};if((null==n.results.min.drapedLayerOrder||t>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&s(n.results.min),0!==n.options.store&&(null==n.results.max.drapedLayerOrder||t<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&s(n.results.max),2===n.options.store){var l=new O.IntersectorResult(n.ray);s(l),n.results.all.push(l)}},n.prototype.stopAnimationsAtTime=function(e){this._sortedLayerRenderers.forEachSimple((function(t){return t.renderer.stopAnimationsAtTime(e)}))},n.prototype.ensureLayerRenderer=function(e){var t=this,r=this._layerRenderers.get(e);return r||(r=new P.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,r),this._sortedLayerRenderersDirty=!0,this._handles.add([e.watch("fullOpacity",(function(){return t.emitContentChanged()})),p.init(r,"updating",(function(){return t.notifyChange("updating")}))],e)),r},n.prototype.updateSortedLayerRenderers=function(){var e=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var t=o.firstKeyOfMap(this._layerRenderers).view.allLayerViews,r=u.SetFromValues(o.valuesOfMap(this._layerRenderers));t.forEach((function(t){var n=t,i=e._layerRenderers.get(n);i&&(e._sortedLayerRenderers.push(new z(n,i)),r.delete(i))})),r.forEach((function(t){e._sortedLayerRenderers.push(new z(null,t))}))}},n.prototype.setViewParameters=function(e,t){t.viewport=e.viewport;var r=e.extent;h.mat4.ortho(t.projectionMatrix,0,r[2]-r[0],0,r[3]-r[1],t.near,t.far),h.mat4.identity(t.viewMatrix),h.mat4.translate(t.viewMatrix,t.viewMatrix,[-e.extent[0],-e.extent[1],0]),t.setGLViewport(this._rctx),this._renderContext.camera=t,this._bindParameters.camera=t,this._bindParameters.inverseViewport[0]=1/t.fullViewport[2],this._bindParameters.inverseViewport[1]=1/t.fullViewport[3]},n.prototype.hasNonZeroSizedView=function(e){for(var t=0;t<e.numViews;t++){var r=e.views[t];if(r.extent[0]!==r.extent[2]&&r.extent[1]!==r.extent[3])return!0}return!1},n.prototype.emitContentChanged=function(){this.onContentChanged&&this.onContentChanged()},n.prototype.updateHasWater=function(){var e=o.someMap(this._layerRenderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e)},n.prototype.updateHasHighlights=function(){var e=o.someMap(this._layerRenderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this._hasHighlights))},n.prototype.updateRendersOccluded=function(){var e=o.someMap(this._layerRenderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.onRendersOccludedChanged&&this.onRendersOccludedChanged(this.rendersOccluded))},n.prototype.drawDebugTexture=function(e,t,r){var n=this._rctx;this.ensureDebugPatternResources(e,t);var i=this._debugPatternProgram;n.bindProgram(i),n.setPipelineState(this._debugPatternPipelineState),i.setUniform4f("color",r[0],r[1],r[2],1),i.setUniform1i("tex",0),n.bindTexture(this._debugPatternTexture,0),n.bindVAO(this._quadVAO),n.drawArrays(5,0,j.vertexCount(this._quadVAO,"geometry"))},n.prototype.ensureDebugPatternResources=function(e,t){if(!this._debugPatternTexture){for(var r=new Uint8Array(e*t*4),n=0,i=0;i<t;i++)for(var a=0;a<e;a++){var o=Math.floor(a/10),s=Math.floor(i/10);o<2||s<2||10*o>e-20||10*s>t-20?(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=255):(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=1&o&&1&s?1&a^1&i?0:255:1&o^1&s?0:128)}this._debugPatternTexture=new I(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},r);var l=new C.TextureTechniqueConfiguration;l.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(C.TextureTechnique,l,this._debugTextureTechnique),this._debugPatternProgram=this._debugTextureTechnique.program,this._debugPatternPipelineState=this._debugTextureTechnique.pipeline,this._quadVAO=M.createQuadVAO(this._rctx)}},Object.defineProperty(n.prototype,"test",{get:function(){return{layerRenderers:this._layerRenderers}},enumerable:!1,configurable:!0}),r.__decorate([b.autoDispose()],n.prototype,"_shaderTechniqueRepository",void 0),r.__decorate([b.autoDispose()],n.prototype,"_stippleTextureRepository",void 0),r.__decorate([d.property(),b.autoDispose()],n.prototype,"waterTextureRepository",void 0),r.__decorate([d.property()],n.prototype,"renderView",void 0),r.__decorate([d.property()],n.prototype,"globalUnitScale",void 0),r.__decorate([d.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating"]})],n.prototype,"updating",null),r.__decorate([d.subclass("esri.views.3d.terrain.OverlayRenderer")],n)}(b.AutoDisposableMixin(n));t.OverlayRenderer=G;var z=function(e,t){this.layerView=e,this.renderer=t},L=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],N=new x.default;N.near=1,N.far=1e4,N.relativeElevation=null;var U=v.vec3f64.create(),F=v.vec3f64.create();t.DRAPED_Z=-2,t.overlayRenderOccludedFlag=4}).apply(null,n))||(e.exports=i)},j2SP:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("3gjc")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec4f32=void 0,t.vec4f32=r}).apply(null,n))||(e.exports=i)},jl7D:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("cmSR"),r("fese"),r("3kdR"),r("PaEL"),r("pLfv"),r("cj3m"),r("vGsU"),r("RdU/"),r("IwVr"),r("7Aei"),r("aExC")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h){"use strict";var f,v,m,g,y,_,b,x,w;Object.defineProperty(t,"__esModule",{value:!0}),t.build=void 0,t.build=function(e){var t=new h.ShaderBuilder;return t.include(a.Transform,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0===e.output&&(t.include(s.NormalUtils,e),t.include(n.ForwardLinearDepth,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),t.vertex.code.add(d.glsl(f||(f=r.__makeTemplateObject(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "],["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "])),d.glsl.float(p.symbolAlphaCutoff))),t.include(u.WaterDistortion,e),t.include(i.Slice,e),e.receiveShadows&&t.include(l.ReadShadowMap,e),t.include(c.Water,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.code.add(d.glsl(m||(m=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        vec3 l = normalize(-lightingMainDirection);\n        float shadow = ",";\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        vec3 l = normalize(-lightingMainDirection);\n        float shadow = ",";\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "])),e.receiveShadows?d.glsl(v||(v=r.__makeTemplateObject(["1.0 - readShadowMap(vpos, linearDepth)"],["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0"))),2===e.output&&(t.include(s.NormalUtils,e),t.include(u.WaterDistortion,e),t.include(i.Slice,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(d.glsl(g||(g=r.__makeTemplateObject(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),d.glsl.float(p.symbolAlphaCutoff))),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(d.glsl(y||(y=r.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "]))))),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(d.glsl(_||(_=r.__makeTemplateObject(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),d.glsl.float(p.symbolAlphaCutoff))),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(d.glsl(b||(b=r.__makeTemplateObject(["\n        void main() {\n          gl_FragColor = waterColor;\n        }\n    "],["\n        void main() {\n          gl_FragColor = waterColor;\n        }\n    "]))))),4===e.output&&(t.include(o.OutputHighlight),t.varyings.add("vpos","vec3"),t.vertex.code.add(d.glsl(x||(x=r.__makeTemplateObject(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "],["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),d.glsl.float(p.symbolAlphaCutoff))),t.include(i.Slice,e),t.fragment.code.add(d.glsl(w||(w=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "]))))),t}}).apply(null,n))||(e.exports=i)},pLfv:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.NormalUtils=void 0,t.NormalUtils=function(e,t){e.vertex.code.add(n.glsl(1===t.viewingMode?i||(i=r.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "])):a||(a=r.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "])))),e.vertex.code.add(n.glsl(1===t.viewingMode?o||(o=r.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "])):s||(s=r.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = vec3(1.0, 0.0, 0.0);\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = vec3(1.0, 0.0, 0.0);\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "]))))}}).apply(null,n))||(e.exports=i)},pbva:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("1m5D")],void 0===(i=(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addOrMerge=t.sortInstancesAccordingToRange=t.Instance=void 0,t.Instance=function(e,t,i,a,o,s){this.from=e,this.to=t,this.isVisible=i,this.hasHighlights=a,this.hasOccludees=o,this.transformation=s,null!=s&&(this.transformationNormal=n.mat4f64.clone(s),r.mat4.invert(this.transformationNormal,this.transformationNormal),r.mat4.transpose(this.transformationNormal,this.transformationNormal))},t.sortInstancesAccordingToRange=function(e){return e.sort((function(e,t){return e.from===t.from?e.to>t.to?1:e.to<t.to?-1:0:e.from>t.from?1:e.from<t.from?-1:0}))},t.addOrMerge=function(e,t){var r=function(e){return{first:e.from,count:e.to-e.from}};if(0!==e.length){var n,i=e[e.length-1];(n=i).first+n.count>=t.from?i.count=t.from-i.first+t.to-t.from:e.push(r(t))}else e.push(r(t))}}).apply(null,n))||(e.exports=i)},pqGg:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("fese"),r("xDGw"),r("uUnu"),r("aRjO"),r("PaEL"),r("3PFg"),r("2o+p"),r("2NOe"),r("W/V4"),r("FQ4r"),r("lBa0"),r("ff/U"),r("VQEQ"),r("VQEQ"),r("G0ER"),r("qbr3"),r("qbr3"),r("2Kdy")],void 0===(i=(function(e,t,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HUDMaterialTechniqueConfiguration=t.HUDMaterialTechnique=void 0;var x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({output:n.output,viewingMode:e.viewingMode,occlusionTestEnabled:n.occlusionTestEnabled,signedDistanceFieldEnabled:n.sdf,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:n.debugDrawBorder,binaryHighlightOcclusionEnabled:n.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:n.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:n.screenSizePerspective,verticalOffsetEnabled:n.verticalOffset,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!1});return new y(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),v.Default3D)},t.prototype.bindPass=function(e,t,r){p.View.bindProjectionMatrix(this.program,r.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",r.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(r.camera.fovY/2)/(r.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",r.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),a.VerticalOffset.bindUniforms(this.program,t,r),u.ScreenSizePerspective.bindUniforms(this.program,t),this.program.setUniform1f("pixelRatio",r.camera.pixelRatio||1),p.View.bindViewport(this.program,r),6===this.configuration.output?s.HUDOcclusion.bindUniforms(this.program):(o.HUD.bindUniforms(this.program,r),g.HUDMaterial.bindUniforms(this.program,t,r.camera.pixelRatio||1),c.VisualVariables.bindUniforms(this.program,t),this.configuration.occlusionTestEnabled&&o.HUD.bindVisibilityTexture(e,this.program,r)),4===this.configuration.output&&l.OutputHighlight.bindOutputHighlight(e,this.program,r)},t.prototype.bindDraw=function(e){p.View.bindView(this.program,e),p.View.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){return b.makePipelineState(4===this.configuration.output?{blending:_.separateBlendingParams(1,1,771,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},colorWrite:b.defaultColorWriteParams}:6===this.configuration.output?{depthTest:{func:515},depthWrite:b.defaultDepthWriteParams,colorWrite:b.defaultColorWriteParams}:{blending:_.simpleBlendingParams(1,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:this.configuration.depthEnabled?515:519},depthWrite:this.configuration.depthEnabled?b.defaultDepthWriteParams:void 0,colorWrite:b.defaultColorWriteParams})},Object.defineProperty(t.prototype,"primitiveType",{get:function(){return 6===this.configuration.output?0:4},enumerable:!1,configurable:!0}),t.shader=new d.ReloadableShaderModule(m,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[r("VQEQ")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(h.ShaderTechnique);t.HUDMaterialTechnique=x;var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.occlusionTestEnabled=!0,t.sdf=!1,t.vvSize=!1,t.vvColor=!1,t.verticalOffset=!1,t.screenSizePerspective=!1,t.screenCenterOffsetUnitsEnabled=0,t.debugDrawBorder=!0,t.binaryHighlightOcclusion=!0,t.slicePlaneEnabled=!1,t.polygonOffsetEnabled=!1,t.depthEnabled=!0,t}return n.__extends(t,e),n.__decorate([f.parameter({count:7})],t.prototype,"output",void 0),n.__decorate([f.parameter()],t.prototype,"occlusionTestEnabled",void 0),n.__decorate([f.parameter()],t.prototype,"sdf",void 0),n.__decorate([f.parameter()],t.prototype,"vvSize",void 0),n.__decorate([f.parameter()],t.prototype,"vvColor",void 0),n.__decorate([f.parameter()],t.prototype,"verticalOffset",void 0),n.__decorate([f.parameter()],t.prototype,"screenSizePerspective",void 0),n.__decorate([f.parameter({count:2})],t.prototype,"screenCenterOffsetUnitsEnabled",void 0),n.__decorate([f.parameter()],t.prototype,"debugDrawBorder",void 0),n.__decorate([f.parameter()],t.prototype,"binaryHighlightOcclusion",void 0),n.__decorate([f.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([f.parameter()],t.prototype,"polygonOffsetEnabled",void 0),n.__decorate([f.parameter()],t.prototype,"depthEnabled",void 0),t}(f.ShaderTechniqueConfiguration);t.HUDMaterialTechniqueConfiguration=w}).apply(null,n))||(e.exports=i)},pvGl:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("KtQ6"),r("BcWh"),r("eIBl"),r("xoE+"),r("LxLY"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("woUR"),r("5T2R"),r("B3XD"),r("X5J5"),r("Fe95"),r("48/q"),r("dtql"),r("ys4y"),r("4ziW"),r("bz+r")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoveZManipulation=void 0;var w=function(e){function t(t){var r=e.call(this)||this;return r._handles=new a,r._radius=m.DISC_RADIUS,r.events=new i,r._tool=t.tool,r._view=t.view,null!=t.radius&&(r._radius=t.radius),r.createManipulator(),r.forEachManipulator((function(e){return r._tool.manipulators.add(e)})),r}return r.__extends(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))},t.prototype.forEachManipulator=function(e){e(this._manipulator,0)},t.prototype.createGraphicDragPipeline=function(e,t){var r=this,n=s.unwrap(e.graphic.geometry).spatialReference;return y.createGraphicMoveDragPipeline(e,t,(function(e){return r.createDragPipeline(e,n)}))},t.prototype.createDragPipeline=function(e,t){var r=this._view;return x.createManipulatorDragEventPipeline(this._manipulator,(function(n,i,a,o){var s=i.next(f.screenToZConstrained(r,n.renderLocation,t)).next(x.addScreenDelta());e(n,s,a,o)}))},Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this.updateManipulator())},enumerable:!1,configurable:!0}),t.prototype.updateManipulator=function(){var e=this._radius/m.DISC_RADIUS,t=v.settings.zManipulator.height*e,r=v.settings.zManipulator.coneHeight*e,i=v.settings.zManipulator.coneWidth*e,a=v.settings.zManipulator.width*e,o=[p.vec3f64.fromValues(0,0,0),p.vec3f64.fromValues(0,0,t)],s=new _(b.createTubeGeometry(o,a/2,16,!1),"move-z"),u=b.createConeGeometry(r,i/2,16,!1),d=new _(u),f=[p.vec3f64.fromValues(0,0,0),p.vec3f64.fromValues(0,0,t+r)],g=function(e){var r=c.mat4f64.create();return l.mat4.translate(r,r,[0,0,t]),l.mat4.rotateX(r,r,Math.PI/2),r}(),y=function(e,t){var r=n.darken(v.settings.zManipulator.color,t);return[r.r/255,r.g/255,r.b/255,v.settings.zManipulator.color.a*e]},x=h.createManipulatorMaterial(y(1,.25),1),w=h.createManipulatorMaterial(y(1,0),1),M=h.createManipulatorMaterial(y(.7,0),v.settings.zManipulator.occludedFlag),S=h.createManipulatorMaterial(y(.85,0),v.settings.zManipulator.occludedFlag);this._manipulator.renderObjects=[{geometry:d,transform:g,material:x,stateMask:1},{geometry:s,material:x,stateMask:1},{geometry:d,transform:g,material:w,stateMask:2},{geometry:s,material:w,stateMask:2},{geometry:d,transform:g,material:M,stateMask:1},{geometry:s,material:M,stateMask:1},{geometry:d,transform:g,material:S,stateMask:2},{geometry:s,material:S,stateMask:2}],this._manipulator.radius=a/2+2,this._manipulator.collisionType={type:"line",paths:[f]}},t.prototype.createManipulator=function(){var e=this,t=new d.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var r=e._view.state.camera,n=M;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,n);var i=u.vec3.dist(r.eye,n),a=r.computeRenderPixelSizeAtDist(i),s=u.vec3.subtract(S,n,r.eye);u.vec3.normalize(s,s);var l=O;e._view.renderCoordsHelper.worldUpAtPosition(M,l);var c=Math.abs(u.vec3.dot(s,l)),p=u.vec3.cross(S,s,l),d=u.vec3.cross(S,p,l),h=o.clamp(c,.01,1),f=1-Math.sqrt(1-h*h)/h/r.fullWidth,g=v.settings.zManipulator.width*(e._radius/m.DISC_RADIUS);u.vec3.scale(d,u.vec3.normalize(d,d),(1/f-1)*i+a*g),t[12]-=S[0],t[13]-=S[1],t[14]-=S[2]},this._manipulator=t,this.updateManipulator()},t}(g.Manipulation);t.MoveZManipulation=w;var M=p.vec3f64.create(),S=p.vec3f64.create(),O=p.vec3f64.create()}).apply(null,n))||(e.exports=i)},qUb7:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Rdxj")],void 0===(i=(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphericalHarmonicsLight=t.AmbientLight=t.FillLight=t.MainLight=void 0,t.MainLight=function(e,t,n){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.fromValues(.57735,.57735,.57735)),void 0===n&&(n=!0),this.intensity=e,this.direction=t,this.castShadows=n},t.FillLight=function(e,t){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.fromValues(.57735,.57735,.57735)),this.intensity=r.vec3f64.create(),this.direction=r.vec3f64.create(),this.intensity=e,this.direction=t},t.AmbientLight=function(e){void 0===e&&(e=r.vec3f64.create()),this.intensity=e},t.SphericalHarmonicsLight=function(){this.sh={r:[0],g:[0],b:[0]}}}).apply(null,n))||(e.exports=i)},qkUi:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ub+M"),r("owRV"),r("A5GR"),r("uNfR"),r("4QR8")],void 0===(i=(function(e,t,r,n,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DrawGraphicTool",{enumerable:!0,get:function(){return r.DrawGraphicTool}}),Object.defineProperty(t,"DrawOperation",{enumerable:!0,get:function(){return n.DrawOperation}}),Object.defineProperty(t,"GraphicMoveTool",{enumerable:!0,get:function(){return i.GraphicMoveTool}}),Object.defineProperty(t,"GraphicReshapeTool",{enumerable:!0,get:function(){return a.GraphicReshapeTool}}),Object.defineProperty(t,"GraphicTransformTool",{enumerable:!0,get:function(){return o.GraphicTransformTool}})}).apply(null,n))||(e.exports=i)},qvwY:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";function r(e){return e instanceof Float32Array&&e.length>=16}function n(e){return Array.isArray(e)&&e.length>=16}Object.defineProperty(t,"__esModule",{value:!0}),t.isMat4=t.isMat4f64=t.isMat4f32=void 0,t.isMat4f32=r,t.isMat4f64=n,t.isMat4=function(e){return r(e)||n(e)}}).apply(null,n))||(e.exports=i)},sQDZ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("6vp1"),r("Xakh"),r("7Aei")],void 0===(i=(function(e,t,r,n,i,a){"use strict";function o(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.include(n.ReadLinearDepth),e.include(i.Reprojection),e.fragment.code.add(a.glsl(s||(s=r.__makeTemplateObject(["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "],["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150;":"75;"))}var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSpaceReflections=void 0,t.ScreenSpaceReflections=o,function(e){e.bindUniforms=function(e,t,r){r.ssrEnabled&&(e.setUniform1i("depthMapView",r.linearDepthTextureID),t.bindTexture(r.linearDepthTexture,r.linearDepthTextureID),e.setUniform2fv("nearFar",r.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",r.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/r.camera.height),i.Reprojection.bindUniforms(e,t,r))}}(o=t.ScreenSpaceReflections||(t.ScreenSpaceReflections={}))}).apply(null,n))||(e.exports=i)},uNfR:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("BcWh"),r("eIBl"),r("LxLY"),r("8MXS"),r("Vx27"),r("9O7+"),r("JXo2"),r("X7Ps")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicReshapeTool=void 0;var p=function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new i,r._reshapeOperation=null,r._internalGeometryUpdate=!1,r.type="reshape-3d",r}return r.__extends(t,e),t.prototype.destroy=function(){this._handles.removeAll(),this._reshapeOperation&&(this._reshapeOperation.destroy(),this._reshapeOperation=null),this._set("view",null),this._set("graphic",null)},Object.defineProperty(t.prototype,"selectionManagementDisabled",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype._updateGeometry=function(){var e=this.graphic.geometry;this._reshapeOperation.inputGeometry=0!==l.isSupportedGraphic(this.graphic)||!a.isSome(e)||"polygon"!==e.type&&"polyline"!==e.type?null:e.clone()},t.prototype._updateGraphic=function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0===l.isSupportedGraphic(this.graphic)){var t=this.watch("graphic.geometry",(function(){!1===e._internalGeometryUpdate&&e._updateGeometry()}),!0);this._handles.add(t,"onGraphicGeometryChange")}},t.prototype.manipulatorSelectionChanged=function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()},t.prototype._onReshapeGeometryChanged=function(){a.isNone(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)},t.prototype.initialize=function(){var e=this;this._reshapeOperation=new c.ReshapeOperation({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)})),this._reshapeOperation.on("move",(function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)})),this._reshapeOperation.on("vertex-add",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)})),this._reshapeOperation.on("vertex-remove",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)})),this._reshapeOperation.on("immediate-click",(function(){return e.emit("immediate-click")})),o.init(this,"graphic",(function(){e._updateGraphic()}),!0)])},t.prototype.onInputEvent=function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()},t.prototype.reset=function(){},r.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),r.__decorate([s.property({constructOnly:!0})],t.prototype,"graphic",void 0),r.__decorate([s.property({constructOnly:!0,nonNullable:!0,value:!0})],t.prototype,"enableZ",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"type",void 0),r.__decorate([s.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],t)}(n.EventedMixin(u.InteractiveToolBase));t.GraphicReshapeTool=p}).apply(null,n))||(e.exports=i)},uUnu:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("2o+p"),r("7Aei")],void 0===(i=(function(e,t,r,n,i){"use strict";function a(e,t){var a=e;a.include(n.ScreenSizePerspective),a.attributes.add("position","vec3"),a.attributes.add("normal","vec3"),a.attributes.add("auxpos1","vec4"),a.vertex.uniforms.add("proj","mat4"),a.vertex.uniforms.add("view","mat4"),a.vertex.uniforms.add("viewNormal","mat4"),a.vertex.uniforms.add("viewport","vec4"),a.vertex.uniforms.add("camPos","vec3"),a.vertex.uniforms.add("polygonOffset","float"),a.vertex.uniforms.add("cameraGroundRelative","float"),a.vertex.uniforms.add("pixelRatio","float"),a.vertex.uniforms.add("perDistancePixelRatio","float"),a.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&a.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&a.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),a.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),a.vertex.defines.addFloat("SMALL_OFFSET_ANGLE",.984807753012208),a.vertex.code.add(i.glsl(o||(o=r.__makeTemplateObject(["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "],["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "])))),a.vertex.code.add(i.glsl(s||(s=r.__makeTemplateObject(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = sign(pointGroundDistance);\n\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "],["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = sign(pointGroundDistance);\n\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "])))),a.vertex.code.add(i.glsl(l||(l=r.__makeTemplateObject(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "],["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "])))),a.vertex.code.add(i.glsl(p||(p=r.__makeTemplateObject(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "],["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.verticalOffsetEnabled?i.glsl(c||(c=r.__makeTemplateObject(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"],["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",1!==t.screenCenterOffsetUnitsEnabled?i.glsl(u||(u=r.__makeTemplateObject(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "],["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),a.vertex.code.add(i.glsl(d||(d=r.__makeTemplateObject(["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD > 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD = 0.75\n        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n  "],["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD > 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD = 0.75\n        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n  "]))))}var o,s,l,c,u,p,d;Object.defineProperty(t,"__esModule",{value:!0}),t.HUD=void 0,t.HUD=a,function(e){!function(e){e[e.OCCLUDED=0]="OCCLUDED",e[e.NOTOCCLUDED=1]="NOTOCCLUDED",e[e.BOTH=2]="BOTH",e[e.COUNT=3]="COUNT"}(e.TransparentRenderStyle||(e.TransparentRenderStyle={})),e.bindUniforms=function(t,r){t.setUniform1f("uRenderTransparentlyOccludedHUD",r.renderTransparentlyOccludedHUD===e.TransparentRenderStyle.OCCLUDED?1:r.renderTransparentlyOccludedHUD===e.TransparentRenderStyle.NOTOCCLUDED?0:.75)},e.bindVisibilityTexture=function(e,t,r){t.setUniform1i("hudVisibilityTexture",1),e.bindTexture(r.hudVisibilityTexture,1),e.setActiveTexture(0)}}(a=t.HUD||(t.HUD={}))}).apply(null,n))||(e.exports=i)},"ub+M":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("jZlN"),r("pcDC"),r("BcWh"),r("LxLY"),r("Vx27"),r("RYqx"),r("DtIM"),r("X5J5"),r("owRV"),r("5uSI"),r("R4nD"),r("T95R"),r("wT+E"),r("X7Ps")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawGraphicTool=void 0;var g=function(e){function t(t){var r=e.call(this,t)||this;return r.drawOperation=null,r._createGraphic=null,r._outlineVisualElement=null,r._verticesVisualElement=null,r._stagedVerticesVisualElement=null,r.hasZ=!0,r.defaultZ=0,r.elevationInfo=null,r.snapToScene=!1,r.mode="hybrid",r.geometryType=null,r.type="draw-3d",r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=o.unwrapOr(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new l({elevationInfo:t}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new p.DrawOperation({view:this.view,manipulators:this.manipulators,geometryType:y(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snappingEnabled:this.snapToScene,snappingDrawSurface:new d.SceneDrawSurface(this.view,t,[this._internalGraphicsLayer]),hasM:!1,elevationInfo:t}),this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)}))},t.prototype.destroy=function(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)},t.prototype.onInputEvent=function(e){this.drawOperation.onInputEvent(e)},t.prototype._getCreateGeometry=function(e,t){if(void 0===t&&(t=!1),null==this.drawOperation)return null;var r=o.isSome(e)?e:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null,n=this.drawOperation.vertices;if(0===n.length)return null;var i=this.drawOperation.spatialReference,a=n,s=a.slice(),l=[];o.isSome(r)&&(s.splice(r,1),l.push(a[r]));var c={regularVertices:null,stagedVertices:null,full:null,outline:null},u="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":c.regularVertices=s,c.stagedVertices=l,c.full=this.drawOperation.coordinateHelper.createPointFromArray(n[0]);break;case"polyline":c.regularVertices=s,c.stagedVertices=l,a.length>0&&(c.full=v.createPolyline([a],i,u));break;case"polygon":c.regularVertices=s,c.stagedVertices=l,a.length>0&&(c.full=v.createPolygon([a],i,u,!0));break;case"circle":if(a.length>0){var p=v.createViewAlignedCoordinateSystem(this.view,n[0]);if(1===a.length&&t){var d=a[0],h=p.makeMapPoint(d[0]+_*this.view.resolution,d[1]);c.full=v.createCircle([d,h],p,!0)}else 2===a.length&&(c.full=this.forceUniformSize?v.createCircle(n,p,this.centered):v.createEllipse(n,p,this.centered))}break;case"rectangle":a.length>0&&(p=v.createViewAlignedCoordinateSystem(this.view,n[0]),1===a.length&&t?(h=p.makeMapPoint((d=a[0])[0]+_*this.view.resolution,d[1]),c.full=v.createSquare([d,h],p,!0)):2===a.length&&(c.full=this.forceUniformSize?v.createSquare(n,p,this.centered):v.createRectangle(n,p,this.centered)));break;default:return null}switch(this.geometryType){case"point":break;case"polyline":a.length>1&&(c.outline=v.createPolyline([a],i,u));break;case"polygon":a.length>1&&(c.outline=v.createPolygon([a],i,u));break;case"circle":case"rectangle":o.isSome(c.full)&&"polygon"===c.full.type&&(c.outline=v.createPolygon(c.full.rings,i,u))}return c},t.prototype._destroyAllVisualisations=function(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()},t.prototype._destroyCreateGraphic=function(){o.isSome(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null)},t.prototype._destroyOutlineVisualElement=function(){o.isSome(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)},t.prototype._destroyVerticesVisualElement=function(){o.isSome(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)},t.prototype._destroyStagedVerticesVisualElement=function(){o.isSome(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)},t.prototype._updateCreateGraphic=function(e){void 0===e&&(e=null);var t=this._getCreateGeometry(e);if(o.isNone(t))this._destroyAllVisualisations();else{var r=this._internalGraphicsLayer.elevationInfo,i="on-the-ground"===c.getEffectiveElevationMode(this.hasZ,r);o.isSome(t.outline)?o.isNone(this._outlineVisualElement)?(this._outlineVisualElement=new h.OutlineVisualElement({view:this.view,geometry:t.outline,elevationInfo:o.unwrap(r),isDraped:i,attached:!1}),u.settings.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),u.settings.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=t.outline:this._destroyOutlineVisualElement(),o.isSome(t.regularVertices)?o.isNone(this._verticesVisualElement)?(this._verticesVisualElement=new f.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:t.regularVertices,elevationInfo:o.unwrap(this._internalGraphicsLayer.elevationInfo),attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=t.regularVertices:this._destroyVerticesVisualElement(),o.isSome(t.stagedVertices)?o.isNone(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new f.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:t.stagedVertices,elevationInfo:o.unwrap(this._internalGraphicsLayer.elevationInfo),attached:!1}),this._stagedVerticesVisualElement.color=u.settings.colorToVec4(u.settings.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=t.stagedVertices:this._destroyStagedVerticesVisualElement(),o.isSome(t.full)?o.isNone(this._createGraphic)?(this._createGraphic=new n({geometry:t.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this.notifyChange("createGraphic")):this._createGraphic.geometry=t.full:this._destroyCreateGraphic()}},Object.defineProperty(t.prototype,"createGraphic",{get:function(){return this._createGraphic},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"centered",{set:function(e){this._set("centered",e),this._updateCreateGraphic()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forceUniformSize",{set:function(e){this._set("forceUniformSize",e),this._updateCreateGraphic()},enumerable:!1,configurable:!0}),t.prototype.reset=function(){},Object.defineProperty(t.prototype,"canRedo",{get:function(){return this.drawOperation.canRedo},enumerable:!1,configurable:!0}),t.prototype.redo=function(){this.drawOperation.redo()},Object.defineProperty(t.prototype,"canUndo",{get:function(){return this.drawOperation.canUndo},enumerable:!1,configurable:!0}),t.prototype.undo=function(){this.drawOperation.undo()},t.prototype.completeCreateOperation=function(){this.drawOperation.complete()},t.prototype.activate=function(){},t.prototype.deactivate=function(){this.drawOperation.isCompleted||this.drawOperation.cancel()},t.prototype.getVertexCoords=function(){return this.drawOperation.vertices},t.prototype.onVertexAdd=function(e){this._updateCreateGraphic(),this.emit("vertex-add",e)},t.prototype.onVertexRemove=function(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)},t.prototype.onVertexUpdate=function(e){this._updateCreateGraphic(),this.emit("vertex-update",e)},t.prototype.onCursorUpdate=function(e){this._updateCreateGraphic(1===e.vertices.length?e.vertices[0].vertexIndex:null),this.emit("cursor-update",e)},t.prototype.onComplete=function(e){this._updateCreateGraphic();var t=null;if(this.drawOperation.isCompleted){var i=this._getCreateGeometry(null,!0);o.isSome(i)&&(t=new n({geometry:i.full,symbol:this.createGraphicSymbol}))}this.emit("complete",r.__assign({graphic:t},e))},r.__decorate([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),r.__decorate([s.property()],t.prototype,"createGraphicSymbol",void 0),r.__decorate([s.property()],t.prototype,"createGraphic",null),r.__decorate([s.property({value:!0})],t.prototype,"enabled",null),r.__decorate([s.property({value:!0})],t.prototype,"centered",null),r.__decorate([s.property({value:!0})],t.prototype,"forceUniformSize",null),r.__decorate([s.property({constructOnly:!0})],t.prototype,"hasZ",void 0),r.__decorate([s.property({nonNullable:!0})],t.prototype,"defaultZ",void 0),r.__decorate([s.property({constructOnly:!0})],t.prototype,"elevationInfo",void 0),r.__decorate([s.property()],t.prototype,"snapToScene",void 0),r.__decorate([s.property({constructOnly:!0})],t.prototype,"mode",void 0),r.__decorate([s.property({constructOnly:!0})],t.prototype,"geometryType",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"type",void 0),r.__decorate([s.subclass("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],t)}(a.EventedMixin(m.InteractiveToolBase));function y(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return i.neverReached(e),null}}t.DrawGraphicTool=g;var _=48}).apply(null,n))||(e.exports=i)},uinn:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("XwIv"),r("xoE+"),r("LxLY"),r("8MXS"),r("0LE5"),r("Rdxj"),r("WRgd"),r("lRq4"),r("DtIM"),r("Kvb2"),r("X5J5"),r("MCHn"),r("PXiz"),r("i10q"),r("/9Lg"),r("fOZq"),r("/NuL"),r("UidR"),r("mmEe")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b){"use strict";function x(e){return i.isSome(e.geometry)&&"point"===e.geometry.type}Object.defineProperty(t,"__esModule",{value:!0}),t.createVisualElements=void 0,t.createVisualElements=function(e){var t=e.view,s=new y.GraphicState({graphic:e.graphic}),S=[],O=function(e,t,n){var o=e.graphic,s=new v.PointVisualElement({view:e.view,geometry:x(o)?o.geometry:null,elevationInfo:u.getGraphicEffectiveElevationInfo(o),attached:!1});return function(e,t,n,o){(function(e,t,n,a){var o=e.view,s=e.graphic,l=null,u=function(){i.isSome(l)&&(l.remove(),l=null),n.isDraped&&x(s)&&(l=function(e,t,r){_.pointToVector(t,w,e.elevationProvider.spatialReference);var n=w[0],i=w[1];return e.elevationProvider.on("elevation-change",(function(e){c.containsXY(e.extent,n,i)&&r()}))}(o,s.geometry,(function(){t.geometry=s.geometry}))),t.geometry=x(s)?s.geometry:null};a.push(n.on("changed",u),r.refHandle((function(){return l}))),u()})(e,t,n,o),d.settings.visualElements.pointGraphics.outline.apply(t),o.push(a.init(n,"displaying",(function(){return t.attached=n.displaying})))}(e,s,t,n),n.push(r.destroyHandle(s)),s}(e,s,S);return function(e,t,i,a){var s=e.view,c=e.graphic,v=new f.LineVisualElement({view:s,infinite:d.settings.visualElements.zVerticalLine.infiniteType,attached:!1});d.settings.visualElements.zVerticalLine.apply(v);var y=new h.LaserlineVisualElement({view:s,intersectsLineInfinite:!0,attached:!1});d.settings.visualElements.pointGraphics.shadowStyle.apply(y);var _=n.deg2rad(d.settings.visualElements.heightPlaneAngleCutoff),S=new h.LaserlineVisualElement({view:s,attached:!1,angleCutoff:_});d.settings.visualElements.heightPlane.apply(S);var O=u.getGraphicEffectiveElevationInfo(e.graphic),R=g.ElevationContext.fromElevationInfo(O),E="on-the-ground"===O.mode||!O.offset&&"absolute-height"!==O.mode,P=new p.ManipulatorState,C=1,T=1,D=function(){P.update(e);var r=E&&(t.isDraped||!x(c)||!c.geometry.hasZ),n=!0;if(!r&&x(c)){var i=c.geometry,u=m.evaluateElevationAlignmentAtPoint(c.geometry,s.elevationProvider,R,s.renderCoordsHelper);o.vec3.set(w,i.x,i.y,u),b.vectorToVector(w,i.spatialReference,w,s.renderCoordsHelper.spatialReference),v.worldDownAtLocation=w,y.intersectsWorldUpAtLocation=w}else n=!1;var p=2&P.grabbingState?d.settings.visualElements.laserlineAlphaMultiplier:1;p!==C&&(C=p,d.settings.visualElements.heightPlane.apply(S,p));var h=l.empty(M);!r&&t.displaying&&a.calculateMapBounds(h)&&b.vectorToVector(l.getMin(h,w),s.spatialReference,w,s.renderCoordsHelper.spatialReference)?(S.heightManifoldTarget=w,S.attached=!0):S.attached=!1;var f=4&P.grabbingState?d.settings.visualElements.laserlineAlphaMultiplier:1;f!==T&&(T=f,d.settings.visualElements.pointGraphics.shadowStyle.apply(y,f));var g=n&&t.displaying&&!r;y.attached=g,v.attached=g};i.push(t.watch(["displaying","isDraped"],D),t.on("changed",D)),e.forEachManipulator((function(e){i.push(e.events.on("grab-changed",D))})),i.push(r.destroyHandle(y)),i.push(r.destroyHandle(v)),i.push(r.destroyHandle(S)),D()}(e,s,S,O),S.push(t.trackGraphicState(s)),{visualElement:O,remove:function(){r.handlesGroup(S).remove()}}};var w=s.vec3f64.create(),M=l.create()}).apply(null,n))||(e.exports=i)},"v+nG":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("1m5D"),r("Rdxj"),r("WRgd"),r("ZPQp"),r("ZcgO"),r("/9Lg"),r("/9Lg"),r("BwdQ"),r("UidR"),r("ZJC8")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.geometryToRenderInfo=t.placePointOnGeometry=t.extendPointGraphicElevationContext=t.createStageObjectForHUD=void 0;var h=i.vec3f64.create();t.createStageObjectForHUD=function(e,t,i,o,s,l,u,f,v,m,g){var y=i?i.length:0,_=e.clippingExtent;if(p.pointToVector(t,h,e.elevationProvider.spatialReference),r.isSome(_)&&!a.containsPoint(_,h))return null;p.pointToVector(t,h,e.renderCoordsHelper.spatialReference);for(var b=e.localOriginFactory.getOrigin(h),x=new d({castShadow:!1,metadata:{layerUid:v,graphicUid:m,usesVerticalDistanceToGround:!0},idHint:f}),w=0;w<y;w++)x.addGeometry(i[w],o[w],s?s[w]:n.mat4f64.IDENTITY,l,b,g);return{object:x,sampledElevation:c.applyElevationAlignmentForHUD(x,t,e.elevationProvider,e.renderCoordsHelper,u)}},t.extendPointGraphicElevationContext=function(e,t,r){var n=e.elevationContext,i=r.spatialReference;p.pointToVector(t,h,i),n.centerPointInElevationSR=s.makeDehydratedPoint(h[0],h[1],t.hasZ?h[2]:0,i)},t.placePointOnGeometry=function(e){switch(e.type){case"point":return e;case"polygon":case"extent":return u.computeCentroid(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var r=o.getPointOnPath(t,o.getPathLength(t)/2);return s.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference);case"mesh":return e.extent.center}return null},t.geometryToRenderInfo=function(e,t,r,n,i){var a=new Float64Array(3*e.length),o=new Float64Array(a.length);e.forEach((function(e,t){a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));var s=l.applyPerVertexElevationAlignment(a,t,0,o,0,a,0,a.length/3,r,n,i);return{numVertices:e.length,position:a,mapPosition:o,projectionSuccess:null!=s,sampledElevation:s}}}).apply(null,n))||(e.exports=i)},v22c:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("fese"),r("PaEL"),r("cj3m"),r("sQDZ"),r("RdU/"),r("2NOe"),r("W/V4"),r("FQ4r"),r("lBa0"),r("EiD/"),r("ff/U"),r("jl7D"),r("G0ER"),r("qbr3"),r("2Kdy")],void 0===(i=(function(e,t,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaterTechniqueConfiguration=t.WaterTechnique=void 0;var y=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.waterTextureRepository=t.waterTextureRepository,n}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({output:n.output,viewingMode:e.viewingMode,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:n.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:n.useSSR,highStepCount:!0});return new m(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),f.Default3D)},t.prototype.ensureResource=function(e){return this.waterTextureRepository.ready||this.waterTextureRepository.updating||this.waterTextureRepository.loadTextures(e),this.waterTextureRepository.ready?2:1},t.prototype.bindPass=function(e,t,r){c.View.bindProjectionMatrix(this.program,r.camera.projectionMatrix),0===this.configuration.output&&(r.lighting.setUniforms(this.program,!1),s.ScreenSpaceReflections.bindUniforms(this.program,e,r)),0!==this.configuration.output&&2!==this.configuration.output||(l.WaterDistortion.bindUniforms(this.program,t),this.waterTextureRepository.bindRepo(e)),this.program.setUniform4fv("waterColor",t.color),4===this.configuration.output&&a.OutputHighlight.bindOutputHighlight(e,this.program,r)},t.prototype.bindDraw=function(e){c.View.bindView(this.program,e),0===this.configuration.output&&(c.View.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),o.ReadShadowMap.bindUniforms(this.program,e,h.DefaultTextureUnits.SHADOW_MAP)),0!==this.configuration.output&&4!==this.configuration.output||i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){var e=this.configuration;return g.makePipelineState(2===e.output?{depthTest:{func:513},depthWrite:e.writeDepth&&g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams}:{blending:4!==e.output&&e.transparent?g.separateBlendingParams(770,1,771,771):null,depthTest:{func:513},depthWrite:e.writeDepth&&g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams})},t.shader=new u.ReloadableShaderModule(v,(function(){return new Promise((function(e,t){Promise.resolve().then((function(){var t=[r("jl7D")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))})),t}(p.ShaderTechnique);t.WaterTechnique=y;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.receiveShadows=!1,t.slicePlaneEnabled=!1,t.transparent=!1,t.writeDepth=!1,t.useSSR=!1,t.isDraped=!1,t}return n.__extends(t,e),n.__decorate([d.parameter({count:7})],t.prototype,"output",void 0),n.__decorate([d.parameter()],t.prototype,"receiveShadows",void 0),n.__decorate([d.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([d.parameter()],t.prototype,"transparent",void 0),n.__decorate([d.parameter()],t.prototype,"writeDepth",void 0),n.__decorate([d.parameter()],t.prototype,"useSSR",void 0),n.__decorate([d.parameter()],t.prototype,"isDraped",void 0),t}(d.ShaderTechniqueConfiguration);t.WaterTechniqueConfiguration=_}).apply(null,n))||(e.exports=i)},vGsU:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("B4Pz"),r("ybGv"),r("piY7"),r("sQDZ"),r("7Aei")],void 0===(i=(function(e,t,r,n,i,a,o,s){"use strict";var l,c,u;Object.defineProperty(t,"__esModule",{value:!0}),t.Water=void 0,t.Water=function(e,t){e.include(a.PhysicallyBasedRendering,t),e.include(i.Gamma),e.include(n.FoamColor),t.ssrEnabled&&e.include(o.ScreenSpaceReflections,t),e.fragment.code.add(s.glsl(l||(l=r.__makeTemplateObject(["\n    const vec3 fresnelSky =  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial =  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness = 0.015;\n    const float foamIntensityExternal = 1.7;\n    const float ssrIntensity = 0.65;\n    const float ssrHeightFadeStart = 300000.0;\n    const float ssrHeightFadeEnd = 500000.0;\n    const float waterDiffusion = 0.775;\n    const float waterSeeColorMod = 0.8;\n    const float correctionViewingPowerFactor = 0.4;\n\n    const vec3 skyZenitColor = vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor = vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon = the dominant color of the sky horizon\n    *   @parameter: cosTheta = the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n = normal facing away from the surface\n    *   @parameter: v = view direction facing away from the surface.\n    *   @parameter: l = light direction facing away from the surface\n    *   @parameter: lightIntensity = light intensity, currently between 0...PI\n    *   @parameter: localUp = a normal for the general direction of the surface\n    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit = 0.;\n      vec3 seaWaterColor = linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h = normalize(l + v);\n      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV = max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon = linearizeGamma(skyColor);\n      vec3 skyZenit = linearizeGamma(skyZenitColor);\n      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL = max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod = 0.1 + upDotL * 0.9;\n      skyColor *= daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier = clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular = vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV > 0.0 && upDotL > 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular = shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam = vec3(0.0);\n      if(upDotV > 0.0) {\n        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "],["\n    const vec3 fresnelSky =  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial =  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness = 0.015;\n    const float foamIntensityExternal = 1.7;\n    const float ssrIntensity = 0.65;\n    const float ssrHeightFadeStart = 300000.0;\n    const float ssrHeightFadeEnd = 500000.0;\n    const float waterDiffusion = 0.775;\n    const float waterSeeColorMod = 0.8;\n    const float correctionViewingPowerFactor = 0.4;\n\n    const vec3 skyZenitColor = vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor = vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon = the dominant color of the sky horizon\n    *   @parameter: cosTheta = the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n = normal facing away from the surface\n    *   @parameter: v = view direction facing away from the surface.\n    *   @parameter: l = light direction facing away from the surface\n    *   @parameter: lightIntensity = light intensity, currently between 0...PI\n    *   @parameter: localUp = a normal for the general direction of the surface\n    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit = 0.;\n      vec3 seaWaterColor = linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h = normalize(l + v);\n      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV = max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon = linearizeGamma(skyColor);\n      vec3 skyZenit = linearizeGamma(skyZenitColor);\n      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL = max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod = 0.1 + upDotL * 0.9;\n      skyColor *= daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier = clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular = vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV > 0.0 && upDotL > 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular = shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam = vec3(0.0);\n      if(upDotV > 0.0) {\n        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "])))),e.fragment.code.add(s.glsl(t.ssrEnabled?c||(c=r.__makeTemplateObject(["\n      // Convert the world position to view position\n      vec4 viewPosition = vec4(positionView.xyz, 1.0);\n      vec3 viewDir = normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor = vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z > 0.0)\n      {\n        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "],["\n      // Convert the world position to view position\n      vec4 viewPosition = vec4(positionView.xyz, 1.0);\n      vec3 viewDir = normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor = vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z > 0.0)\n      {\n        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "])):u||(u=r.__makeTemplateObject(["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "],["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "]))))}}).apply(null,n))||(e.exports=i)},vJh7:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qysZ")],void 0===(i=(function(e,t,r){"use strict";function n(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=n*s+a*l,e[1]=i*s+o*l,e[2]=n*c+a*u,e[3]=i*c+o*u,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=t.multiplyScalarAndAdd=t.multiplyScalar=t.equals=t.exactEquals=t.subtract=t.add=t.LDU=t.frob=t.str=t.fromScaling=t.fromRotation=t.scale=t.rotate=t.multiply=t.determinant=t.adjoint=t.invert=t.transpose=t.set=t.identity=t.copy=void 0,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},t.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*a-i*n;return o?(e[0]=a*(o=1/o),e[1]=-n*o,e[2]=-i*o,e[3]=r*o,e):null},t.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=n,t.rotate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*s,e[1]=i*l+o*s,e[2]=n*-s+a*l,e[3]=i*-s+o*l,e},t.scale=function(e,t,r){var n=t[1],i=t[2],a=t[3],o=r[0],s=r[1];return e[0]=t[0]*o,e[1]=n*o,e[2]=i*s,e[3]=a*s,e},t.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=i,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var n=e[0],i=e[1],a=e[2],o=e[3],s=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-c)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(o-u)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},t.mul=n,t.sub=i}).apply(null,n))||(e.exports=i)},xFEL:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("xoE+"),r("LxLY"),r("jBNx"),r("YX1r"),r("51bw"),r("FXVB"),r("1m5D"),r("W9tT"),r("DIqE"),r("0LE5"),r("Rdxj"),r("qvwY"),r("lRq4"),r("2B1V"),r("+nCE"),r("9FJH"),r("FNtW"),r("+wMf"),r("CIy2"),r("ILj8"),r("s6rJ"),r("PwS/"),r("VQEQ"),r("pqGg")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w,M,S,O,R){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=function(e){function t(t,r){var n=e.call(this,r)||this;return n.techniqueConfig=new R.HUDMaterialTechniqueConfiguration,n.params=M.copyParameters(t,Y),n}return r.__extends(t,e),t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&x.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig},t.prototype.intersect=function(e,t,r,n,i,a,o,s,l){l?this.intersectDrapedHudGeometry(e,a,o,s):this.intersectHudGeometry(e,t,r,n,o,s)},t.prototype.intersectDrapedHudGeometry=function(e,t,r,n){var i=e.getAttribute(x.VertexAttrConstants.POSITION),a=e.getAttribute(x.VertexAttrConstants.SIZE),o=this.params,s=O.calculateAnchorPosForRendering(o),l=1,c=1;if(n){var u=n(B);l=u[0],c=u[5]}l*=e.screenToWorldRatio,c*=e.screenToWorldRatio;for(var p=q*e.screenToWorldRatio,d=0;d<i.data.length/i.size;d++){var h=d*i.size,f=i.data[h],v=i.data[h+1],m=d*a.size;Z[0]=a.data[m]*l,Z[1]=a.data[m+1]*c;var g=void 0;o.textureIsSignedDistanceField&&(g=o.outlineSize*e.screenToWorldRatio/2),D(t,f,v,Z,p,g,o,s)&&r()}},t.prototype.intersectHudGeometry=function(e,t,r,n,i,a){if(n.options.selectionMode&&n.options.hud&&!S.isInstanceHidden(t)){var s,c,u,p,f,v,m,g,y,_,w,M,R,E=e.data,P=this.params,C=1,T=1;if(o.mat3.fromMat4(N,r),a){var I=a(B);C=I[0],T=I[5],c=(s=N)[0],u=s[1],p=s[2],f=s[3],v=s[4],m=s[5],g=s[6],y=s[7],_=s[8],w=1/Math.sqrt(c*c+u*u+p*p),M=1/Math.sqrt(f*f+v*v+m*m),R=1/Math.sqrt(g*g+y*y+_*_),s[0]=c*w,s[1]=u*w,s[2]=p*w,s[3]=f*M,s[4]=v*M,s[5]=m*M,s[6]=g*R,s[7]=y*R,s[8]=_*R}var z=E.getVertexAttr()[x.VertexAttrConstants.POSITION],U=E.getVertexAttr()[x.VertexAttrConstants.SIZE],q=E.getVertexAttr()[x.VertexAttrConstants.NORMAL],X=E.getVertexAttr()[x.VertexAttrConstants.AUXPOS1];x.assert(z.size>=3);var Y=n.point,Q=n.camera,K=O.calculateAnchorPosForRendering(P);C*=Q.pixelRatio,T*=Q.pixelRatio;for(var J="screen"===this.params.centerOffsetUnits,$=0;$<z.data.length/z.size;$++){var ee=$*z.size;d.vec3.set(j,z.data[ee],z.data[ee+1],z.data[ee+2]),d.vec3.transformMat4(j,j,r);var te=$*U.size;Z[0]=U.data[te]*C,Z[1]=U.data[te+1]*T,d.vec3.transformMat4(j,j,Q.viewMatrix);var re=$*X.size;if(d.vec3.set(H,X.data[re+0],X.data[re+1],X.data[re+2]),!J&&(j[0]+=H[0],j[1]+=H[1],0!==H[2])){var ne=H[2];d.vec3.normalize(H,j),d.vec3.subtract(j,j,d.vec3.scale(H,H,ne))}var ie=$*q.size;if(d.vec3.set(V,q.data[ie],q.data[ie+1],q.data[ie+2]),this.normalAndViewAngle(V,N,Q,k),this.applyVerticalOffsetTransformationView(j,k,Q,A),Q.applyProjection(j,G),G[0]>-1){var ae=Math.floor(G[0])+this.params.screenOffset[0],oe=Math.floor(G[1])+this.params.screenOffset[1];J&&(ae+=H[0],0!==H[1]&&(oe+=b.applyScaleFactor(H[1],A.factorAlignment))),b.applyPrecomputedScaleFactor(Z,A.factor,Z);var se=void 0;if(P.textureIsSignedDistanceField&&(se=P.outlineSize*Q.pixelRatio/2),D(Y,ae,oe,Z,W*Q.pixelRatio,se,P,K)){var le=n.ray;d.vec3.transformMat4(L,j,l.mat4.invert(F,Q.viewMatrix)),G[0]=Y[0],G[1]=Y[1],Q.unprojectPoint(G,j);var ce=h.vec3f64.create();d.vec3.copy(ce,le.direction);var ue=1/d.vec3.length(ce);d.vec3.scale(ce,ce,ue),i(d.vec3.distance(le.origin,j)*ue,ce,-1,1,!0,L)}}}}},t.prototype.computeAttachmentOrigin=function(e,t){var r=e.data,n="getVertexAttr"in r?r.getVertexAttr():"vertexAttr"in r?r.vertexAttr:null;if(!n)return null;var i=x.VertexAttrConstants.POSITION,a=n[i],o="getIndices"in r?r.getIndices(i):"indices"in r?r.indices[i]:null;return g.computeAttachmentOriginPoints(a,o,t)},t.prototype.createBufferWriter=function(){return new K(this)},t.prototype.normalAndViewAngle=function(e,t,r,n){return f.isMat4(t)&&(t=o.mat3.fromMat4(U,t)),d.vec3.transformMat3(n.normal,e,t),d.vec3.transformMat4(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=d.vec3.dot(z,X),n},t.prototype.updateScaleInfo=function(e,t,r){var n=this.params;n.screenSizePerspective?b.precomputeScaleFactor(r,t,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment?b.precomputeScaleFactor(r,t,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)},t.prototype.applyShaderOffsetsView=function(e,t,r,n,i,a,o){var s=this.normalAndViewAngle(t,r,i,k);return this.applyVerticalGroundOffsetView(e,s,i,o),this.applyVerticalOffsetTransformationView(o,s,i,a),this.applyPolygonOffsetView(o,s,n[3],i,o),this.applyCenterOffsetView(o,n,o),o},t.prototype.applyShaderOffsetsNDC=function(e,t,r,n,a){return this.applyCenterOffsetNDC(e,t,r,n),i.isSome(a)&&d.vec3.copy(a,n),this.applyPolygonOffsetNDC(n,t,r,n),n},t.prototype.applyPolygonOffsetView=function(e,t,r,i,a){var o=i.aboveGround?1:-1,s=n.sign(r);0===s&&(s=o);var l=o*s;if(this.params.shaderPolygonOffset<=0)return d.vec3.copy(a,e);var c=n.clamp(Math.abs(t.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/i.viewport[2];return d.vec3.scale(a,e,l>0?u:1/u),a},t.prototype.applyVerticalGroundOffsetView=function(e,t,r,n){var i=d.vec3.length(e),a=r.aboveGround?1:-1,o=.5*r.computeRenderPixelSizeAtDist(i),s=d.vec3.scale(j,t.normal,a*o);return d.vec3.add(n,e,s),n},t.prototype.applyVerticalOffsetTransformationView=function(e,t,r,n){var i=this.params;if(!i.verticalOffset||!i.verticalOffset.screenLength){if(i.screenSizePerspective||i.screenSizePerspectiveAlignment){var a=d.vec3.length(e);this.updateScaleInfo(n,a,t.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}var o=d.vec3.length(e),s=M.verticalOffsetAtDistance(r,o,i.verticalOffset,t.cosAngle,i.screenSizePerspectiveAlignment||i.screenSizePerspective);return this.updateScaleInfo(n,o,t.cosAngle),d.vec3.scale(t.normal,t.normal,s),d.vec3.add(e,e,t.normal)},t.prototype.applyCenterOffsetView=function(e,t,r){var n="screen"!==this.params.centerOffsetUnits;return r!==e&&d.vec3.copy(r,e),n&&(r[0]+=t[0],r[1]+=t[1],t[2]&&(d.vec3.normalize(V,r),d.vec3.add(r,r,d.vec3.scale(V,V,t[2])))),r},t.prototype.applyCenterOffsetNDC=function(e,t,r,n){var i="screen"!==this.params.centerOffsetUnits;return n!==e&&d.vec3.copy(n,e),i||(n[0]+=t[0]/r.fullWidth*2,n[1]+=t[1]/r.fullHeight*2),n},t.prototype.applyPolygonOffsetNDC=function(e,t,r,i){var a=this.params.shaderPolygonOffset;if(e!==i&&d.vec3.copy(i,e),a){var o=r.aboveGround?1:-1,s=o*n.sign(t[3]);i[2]-=(s||o)*a}return i},t.prototype.getGLMaterial=function(e){return 0===e.output?new C(e):4===e.output?new T(e):void 0},t.prototype.calculateRelativeScreenBounds=function(e,t,r){return void 0===r&&(r=v.create()),function(e,t,r,n){void 0===n&&(n=I),u.vec2.copy(n,e.anchorPos),n[0]*=-t[0],n[1]*=-t[1],n[0]+=e.screenOffset[0]*r,n[1]+=e.screenOffset[1]*r}(this.params,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r},t}(_.Material);t.default=E;var P=function(e){function t(t){var n=e.call(this,r.__assign(r.__assign({},t),t.material.getParameters()))||this;return n.updateParameters(),n}return r.__extends(t,e),t.prototype.beginSlot=function(e){return e===(this.params.drawInSecondSlot?19:18)},t.prototype.updateParameters=function(){this.params=M.copyParameters(this.material.getParameters()),this.updateTexture(this.params.textureId),this.selectProgram()},t.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(R.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.params,t)},t}(y),C=function(e){function t(t){var n=e.call(this,r.__assign(r.__assign({},t),{output:0}))||this;return n.isOcclusionSlot=!1,n}return r.__extends(t,e),t.prototype.beginSlot=function(e){var t=this.params.drawInSecondSlot?19:18;return this.params.occlusionTest?(this.isOcclusionSlot=12===e,12===e||e===t):(this.isOcclusionSlot=!1,e===t)},t.prototype.getTechnique=function(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique},t.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(R.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique),this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(R.HUDMaterialTechnique,this.material.getTechniqueConfig(6),this.occlusionTechnique)},t.prototype.bind=function(e,t){var r=this.getTechnique();e.bindProgram(r.program),this.isOcclusionSlot||(this.bindTexture(e,r.program),this.bindTextureScale(e,r.program)),r.bindPass(e,this.params,t)},t}(P),T=function(e){function t(t){return e.call(this,r.__assign(r.__assign({},t),{output:4}))||this}return r.__extends(t,e),t}(P);function D(e,t,r,n,i,a,o,s){var l=t-i-(s[0]>0?n[0]*s[0]:0),c=l+n[0]+2*i,u=r-i-(s[1]>0?n[1]*s[1]:0),p=u+n[1]+2*i;if(o.textureIsSignedDistanceField){var d=o.distanceFieldBoundingBox;l+=n[0]*d[0],u+=n[1]*d[1],c-=n[0]*(1-d[2]),p-=n[1]*(1-d[3]),l-=a,c+=a,u-=a,p+=a}return e[0]>l&&e[0]<c&&e[1]>u&&e[1]<p}var A={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},I=p.vec2f64.create(),j=h.vec3f64.create(),V=h.vec3f64.create(),G=a.createRenderScreenPointArray3(),z=h.vec3f64.create(),L=h.vec3f64.create(),N=s.mat3f64.create(),U=s.mat3f64.create(),F=c.mat4f64.create(),H=h.vec3f64.create(),k={normal:z,cosAngle:0},B=c.mat4f64.create(),W=1,q=2,Z=[0,0],X=h.vec3f64.fromValues(0,0,1),Y={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:p.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,debugDrawBorder:!1},Q=m.newLayout().vec3f(x.VertexAttrConstants.POSITION).vec3f(x.VertexAttrConstants.NORMAL).vec2f(x.VertexAttrConstants.UV0).vec4u8(x.VertexAttrConstants.COLOR).vec2f(x.VertexAttrConstants.SIZE).vec4f(x.VertexAttrConstants.AUXPOS1).vec4f(x.VertexAttrConstants.AUXPOS2),K=function(){function e(e){this.material=e,this.vertexBufferLayout=Q}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[x.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,n){w.writePosition(t.indices[x.VertexAttrConstants.POSITION],t.vertexAttr[x.VertexAttrConstants.POSITION].data,e.transformation,r.position,n,6),w.writeNormal(t.indices[x.VertexAttrConstants.NORMAL],t.vertexAttr[x.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,r.normal,n,6);var i=t.vertexAttr[x.VertexAttrConstants.UV0].data,a=void 0,o=void 0,s=void 0,l=void 0;if(null==i||i.length<4){var c=this.material.getParameters();a=0,o=0,s=c.texCoordScale[0],l=c.texCoordScale[1]}else a=i[0],o=i[1],s=i[2],l=i[3];s=Math.min(1.99999,s+1),l=Math.min(1.99999,l+1);for(var u=t.indices[x.VertexAttrConstants.POSITION].length,p=r.uv0,d=n,h=0;h<u;++h)p.set(d,0,a),p.set(d,1,o),p.set(d+=1,0,s),p.set(d,1,o),p.set(d+=1,0,s),p.set(d,1,l),p.set(d+=1,0,s),p.set(d,1,l),p.set(d+=1,0,a),p.set(d,1,l),p.set(d+=1,0,a),p.set(d,1,o),d+=1;w.writeColor(t.indices[x.VertexAttrConstants.COLOR],t.vertexAttr[x.VertexAttrConstants.COLOR].data,4,r.color,n,6);var f=t.indices[x.VertexAttrConstants.SIZE],v=t.vertexAttr[x.VertexAttrConstants.SIZE].data,m=f.length,g=r.size;for(d=n,h=0;h<m;++h)for(var y=v[2*f[h]],_=v[2*f[h]+1],b=0;b<6;++b)g.set(d,0,y),g.set(d,1,_),d+=1;t.indices[x.VertexAttrConstants.AUXPOS1]&&t.vertexAttr[x.VertexAttrConstants.AUXPOS1]&&w.writeBufferVec4(t.indices[x.VertexAttrConstants.AUXPOS1],t.vertexAttr[x.VertexAttrConstants.AUXPOS1].data,r.auxpos1,n,6),t.indices[x.VertexAttrConstants.AUXPOS2]&&t.vertexAttr[x.VertexAttrConstants.AUXPOS2]&&w.writeBufferVec4(t.indices[x.VertexAttrConstants.AUXPOS2],t.vertexAttr[x.VertexAttrConstants.AUXPOS2].data,r.auxpos2,n,6)},e}()}).apply(null,n))||(e.exports=i)},y68M:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("LxLY"),r("qMld")],void 0===(i=(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderTechniqueRepository=void 0;var a=function(e){this.technique=e,this.refCount=0,this.refZeroFrame=0},o=function(){function e(e){this._context=e,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=1200}return Object.defineProperty(e.prototype,"viewingMode",{get:function(){return this._context.viewingMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"constructionContext",{get:function(){return this._context},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.dispose()}))})),this._perConstructorInstances.clear()},e.prototype.acquire=function(e,t){var r=t.key,n=this._perConstructorInstances.get(e);n||(n=new Map,this._perConstructorInstances.set(e,n));var i=n.get(r);return void 0===i&&(i=new a(new e(this._context,t)),n.set(r,i)),++i.refCount,i.technique},e.prototype.acquireAndReleaseExisting=function(e,t,r){return n.isNone(r)?this.acquire(e,t):t.key===r.key&&r instanceof e?r:(this.release(r),this.acquire(e,t))},e.prototype.release=function(e){var t=this._perConstructorInstances.get(e.constructor).get(e.key);t.refCount-=1,0===t.refCount&&(t.refZeroFrame=this._frameCounter)},e.prototype.frameUpdate=function(){var e=this;this._frameCounter++,this._perConstructorInstances.forEach((function(t,r){t.forEach((function(r,n){0===r.refCount&&r.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(r.technique.dispose(),t.delete(n))})),0===t.size&&e._perConstructorInstances.delete(r)}))},e.prototype.getProgramsUsingUniform=function(e){return this._context.commonUniformStore.getPrograms(e)},e.prototype.hotReload=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t=this;return r.__generator(this,(function(n){switch(n.label){case 0:return e=new Array,this._perConstructorInstances.forEach((function(n,i){e.push(function(e,n){return r.__awaiter(t,void 0,void 0,(function(){var t,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=n.shader)?[4,t.reload()]:[3,2];case 1:r.sent(),e.forEach((function(e){e.technique.reload(i._context)})),r.label=2;case 2:return[2]}}))}))}(n,i))})),[4,i.all(e)];case 1:return n.sent(),[2]}}))}))},e}();t.ShaderTechniqueRepository=o}).apply(null,n))||(e.exports=i)},yVFQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("qsST"),r("xdO3"),r("sCbS")],void 0===(i=(function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zeroContext=t.extractExpressionInfo=t.execute=t.setContextFeature=t.createFeature=t.createContext=t.createContextWithoutExpressionSupport=t.clone=void 0;var o=n.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function s(e){return null!=e.cachedResult}function l(e){return"0"===e?0:null}t.clone=function(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}},t.createContextWithoutExpressionSupport=function(e){var t=e&&e.expression;if("string"==typeof t){var r=l(t);if(null!=r)return{cachedResult:r}}return null},t.createContext=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,c,u;return r.__generator(this,(function(r){switch(r.label){case 0:return"string"!=typeof(i=e&&e.expression)?[2,null]:null!=(o=l(i))?[2,{cachedResult:o}]:[4,a.loadArcade()];case 1:return s=r.sent(),u=(c=s.arcadeUtils).createSyntaxTree(i),c.dependsOnView(u)?(null!=n&&n.error("Expressions containing '$view' are not supported on ElevationInfo"),[2,{cachedResult:0}]):[2,{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:s}}]}}))}))},t.createFeature=function(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)},t.setContextFeature=function(e,t){if(null!=e&&!s(e)){if(!t||!e.arcade)return void o.errorOncePerTick("Arcade support required but not provided");t._geometry&&(t._geometry=i.hydrateGeometry(t._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}},t.execute=function(e){if(null!=e){if(s(e))return e.cachedResult;var t=e.arcade,r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0},t.extractExpressionInfo=function(e,t){void 0===t&&(t=!1);var r=e&&e.featureExpressionInfo;return t||"0"===(r&&r.expression)||(r=null),r},t.zeroContext={cachedResult:0}}).apply(null,n))||(e.exports=i)},ybGv:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("7Aei")],void 0===(i=(function(e,t,r,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Gamma=void 0,t.Gamma=function(e){e.fragment.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    const float GAMMA = 2.2;\n    const float INV_GAMMA = 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "],["\n    const float GAMMA = 2.2;\n    const float INV_GAMMA = 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "]))))}}).apply(null,n))||(e.exports=i)},yjgM:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("QDcU"),r("eIBl"),r("LxLY"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("DtIM"),r("woUR"),r("B3XD"),r("X5J5"),r("Fe95"),r("48/q"),r("dtql"),r("TIRl"),r("JjCO"),r("ys4y"),r("4ziW"),r("o5p5"),r("bz+r")],void 0===(i=(function(e,t,r,n,i,a,o,s,l,c,u,p,d,h,f,v,m,g,y,_,b,x,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoveXYDiscManipulation=void 0;var M=function(e){function t(t){var r=e.call(this)||this;return r._handles=new i,r._snapToScene=new g.SnapToScene,r._discMaterial=r._createMaterial(),r._discMaterialTransparent=r._createMaterial(.5),r._scale=1,r._radius=f.DISC_RADIUS,r._view=t.view,r._tool=t.tool,null!=t.snapToScene&&(r.snapToScene=t.snapToScene),null!=t.radius&&(r._radius=t.radius),r._createManipulator(),r.forEachManipulator((function(e){return r._tool.manipulators.add(e)})),r}return r.__extends(t,e),t.prototype.destroy=function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null},t.prototype.forEachManipulator=function(e){e(this._manipulator,1)},Object.defineProperty(t.prototype,"displayScale",{get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapToScene",{get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())},enumerable:!1,configurable:!0}),t.prototype.createGraphicDragPipeline=function(e,t){var r=this,n=e.graphic,i=u.getGraphicEffectiveElevationInfo(n),o=a.unwrap(n.geometry).spatialReference;return m.createGraphicMoveDragPipeline(e,t,(function(e){return r.createDragPipeline(e,i,o)}))},t.prototype.createDragPipeline=function(e,t,r){var n=this,i=this._view;return w.createManipulatorDragEventPipeline(this._manipulator,(function(a,o,s,l){var c=o.next(w.dragAtLocation(i,a.elevationAlignedLocation)).next(d.screenToMapXYAtLocation(i,a.elevationAlignedLocation,t,r)).next(n._snapToScene.createDragEventPipelineStep(i,t),n._snapToScene.next).next(w.addScreenDelta());e(a,c,s,l)}))},t.prototype._updateManipulatorTransform=function(){var e=o.mat4.fromScaling(y.sm4d.get(),l.vec3.set(y.sv3d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e},t.prototype._createManipulator=function(){this._manipulator=new p.Manipulator3D({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:c.vec3f64.fromValues(0,0,1)},worldOriented:!0}),this._updateManipulator()},t.prototype._updateManipulator=function(){var e=new _(b.createCylinderGeometry(f.DISC_HEIGHT,1,f.GEOMETRY_SEGMENTS,c.vec3f64.fromValues(0,0,1),c.vec3f64.fromValues(0,0,0)),"graphic-transform-disc"),t=o.mat4.fromScaling(s.mat4f64.create(),c.vec3f64.fromValues(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=f.DISC_COLLISION_RADIUS*(this._radius/f.DISC_RADIUS)},t.prototype._createMaterial=function(e){void 0===e&&(e=1);var t=n.toUnitRGBA(h.colors.main);t[3]*=e;var r=new x({color:t,transparent:1!==e,cullFace:2},"move-xy-disc");return r.renderOccluded=2,r},Object.defineProperty(t.prototype,"test",{get:function(){return{discManipulator:this._manipulator}},enumerable:!1,configurable:!0}),t}(v.Manipulation);t.MoveXYDiscManipulation=M}).apply(null,n))||(e.exports=i)},z4cv:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createView=t.fromValues=t.clone=t.create=void 0,t.create=function(){return[1,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3]]},t.fromValues=function(e,t,r,n){return[e,t,r,n]},t.createView=function(e,t){return new Float64Array(e,t,4)}}).apply(null,n))||(e.exports=i)},znI2:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("CIy2")],void 0===(i=(function(e,t,r){"use strict";function n(e){return r.getFirstObjectValue(e.data.indices).length>=1}Object.defineProperty(t,"__esModule",{value:!0}),t.splitRenderGeometryChangeSetByMaterial=void 0,t.splitRenderGeometryChangeSetByMaterial=function(e){for(var t=new Map,r=null,i=null,a=function(e){if(e===r)return i;var n=t.get(e);return n||t.set(e,n={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1}),r=e,i=n,n},o=0;o<e.numToAdd;o++)n(s=e.toAdd[o])&&a(s.material).toAdd.push(s);for(o=0;o<e.numToRemove;o++){var s;n(s=e.toRemove[o])&&a(s.material).toRemove.push(s)}for(o=0;o<e.numToUpdate;o++){var l=e.toUpdate[o];n(l.renderGeometry)&&a(l.renderGeometry.material).toUpdate.push(l)}return t}}).apply(null,n))||(e.exports=i)}}]);