(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{NloG:function(e,t,i){"use strict";var a=i("pO5D"),s=(i("wSAH"),i("6S2I")),r=(i("zqDF"),i("WbKI")),n=i("04ZG"),o=(i("4EHJ"),i("ju1D"),i("9AIY"),i("/CmD")),l=i("zm0L"),h=i("pdg3"),c=i("+rMe"),p=i("kJYu");let d=class extends(Object(p.b)(Object(h.a)(Object(c.b)(l.a.EventedMixin(o.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw s.a.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}})}get fullOpacity(){const e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(a.a)([Object(r.b)()],d.prototype,"fullOpacity",null),Object(a.a)([Object(r.b)()],d.prototype,"layer",void 0),Object(a.a)([Object(r.b)()],d.prototype,"parent",void 0),Object(a.a)([Object(r.b)({readOnly:!0})],d.prototype,"suspended",null),Object(a.a)([Object(r.b)({readOnly:!0})],d.prototype,"suspendInfo",null),Object(a.a)([Object(r.b)({readOnly:!0})],d.prototype,"legendEnabled",null),Object(a.a)([Object(r.b)({type:Boolean,readOnly:!0})],d.prototype,"updating",null),Object(a.a)([Object(r.b)()],d.prototype,"visible",null),d=Object(a.a)([Object(n.a)("esri.views.layers.LayerView")],d),t.a=d},Vm2Q:function(e,t,i){"use strict";i.d(t,"a",(function(){return x}));var a,s=i("pO5D"),r=(i("wSAH"),i("6S2I"),i("zqDF"),i("WbKI")),n=i("04ZG"),o=(i("4EHJ"),i("ju1D"),i("9AIY"),i("LE9a")),l=i("fX31"),h=i("N5XI"),c=i("ZuQG"),p=i("L1EH"),d=i("AMBt"),u=i("N2DF"),b=i("OvF4"),y=i("Ehki"),v=i("qatw");i("4GrV");const g={base:u.a,key:"type",typeMap:{extent:b.a,polygon:y.a}};let O=a=class extends c.a{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new a({geometry:this.geometry.clone()})}};Object(s.a)([Object(r.b)({types:g,json:{read:v.a,write:!0}})],O.prototype,"geometry",void 0),Object(s.a)([Object(r.b)({readOnly:!0})],O.prototype,"version",null),O=a=Object(s.a)([Object(n.a)("esri.views.layers.support.Geometry")],O);var w=O;let j=class extends c.a{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(s.a)([Object(r.b)({type:[[[Number]]],json:{write:!0}})],j.prototype,"path",void 0),Object(s.a)([Object(r.b)({readOnly:!0})],j.prototype,"version",null),j=Object(s.a)([Object(n.a)("esri.views.layers.support.Path")],j);const m=o.a.ofType({key:"type",base:c.a,typeMap:{rect:p.a,path:j,geometry:w}}),x=e=>{let t=class extends e{constructor(){super(...arguments),this.clips=new m,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new d.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(h.init)(this,"suspended",e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},!0),Object(h.init)(this,["layer.opacity","container"],()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)},!0),Object(h.init)(this,["layer.blendMode"],e=>{this.container&&(this.container.blendMode=e)},!0),Object(h.init)(this,["layer.effect"],e=>{this.container&&(this.container.effect=e)},!0),this.clips.on("change",()=>{this.container.clips=this.clips,this.notifyChange("clips")})]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then(e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){let t=!0;const i=this.layer,a=i.minScale,s=i.maxScale;if(null!=a&&null!=s){let i=!a,r=!s;!i&&e<=a&&(i=!0),!r&&e>=s&&(r=!0),t=i&&r}return t}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(s.a)([Object(r.b)({type:m,set(e){const t=Object(l.b)(e,this._get("clips"),m);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(s.a)([Object(r.b)()],t.prototype,"moving",void 0),Object(s.a)([Object(r.b)()],t.prototype,"attached",void 0),Object(s.a)([Object(r.b)()],t.prototype,"container",void 0),Object(s.a)([Object(r.b)()],t.prototype,"suspended",void 0),Object(s.a)([Object(r.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(s.a)([Object(r.b)()],t.prototype,"updateRequested",void 0),Object(s.a)([Object(r.b)()],t.prototype,"updating",null),Object(s.a)([Object(r.b)()],t.prototype,"view",void 0),t=Object(s.a)([Object(n.a)("esri.views.2d.layers.LayerView2D")],t),t}},f1zk:function(e,t,i){"use strict";i.r(t);var a=i("pO5D"),s=(i("wSAH"),i("6S2I")),r=(i("zqDF"),i("WbKI")),n=i("04ZG"),o=(i("4EHJ"),i("ju1D"),i("9AIY"),i("N5XI")),l=i("bHqs"),h=i("NloG"),c=i("srIe"),p=i("zlDU"),d=i("SuVq"),u=i("IvSi"),b=i("xk++"),y=i("rXMu");const v=e=>{let t=class extends e{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,t){const{layer:i}=this;if(!e)throw new p.a("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:a}=i,s=Object(y.a)(i,t);if(!a||!Object(c.k)(s))throw new p.a("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:s});const r=await s.getRequiredFields(),n=new b.a;n.geometry=e,n.outFields=r,n.outSpatialReference=e.spatialReference;const o=this.view.resolution,l="2d"===this.view.type?new d.a(o,o,this.view.spatialReference):new d.a(.5*o,.5*o,this.view.spatialReference),{returnTopmostRaster:h,showNoDataRecords:u}=s.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};return i.queryVisibleRasters(n,{returnDomainValues:!0,returnTopmostRaster:h,pixelSize:l,showNoDataRecords:u}).then(e=>e)}canResume(){var e;return!(!super.canResume()||null!=(e=this.timeExtent)&&e.isEmpty)}};return Object(a.a)([Object(r.b)()],t.prototype,"layer",void 0),Object(a.a)([Object(r.b)()],t.prototype,"suspended",void 0),Object(a.a)([Object(r.b)(u.a)],t.prototype,"timeExtent",void 0),Object(a.a)([Object(r.b)()],t.prototype,"view",void 0),t=Object(a.a)([Object(n.a)("esri.views.layers.ImageryLayerView")],t),t};var g=i("Vm2Q"),O=i("RI0u"),w=i("9MzC"),j=i("/CmD"),m=i("OvF4"),x=i("qRWG"),f=i("Lqtk"),q=i("jWBI"),R=i("Gdt4"),E=i("9iar"),I=i("tODX"),_=i("AMBt"),V=i("Vh9r"),D=i("q03O");const U=s.a.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");let k=class extends j.a{constructor(){super(...arguments),this.attached=!1,this.container=new _.a,this.updateRequested=!1,this._graphicsView=null,this._projectFullExtentPromise=null,this.type="Graphics",this._graphics=new E.b,this._updateGraphics=Object(w.i)(async(e,t)=>{if(!e.stationary)return;const i=e.state,a=new m.a({xmin:i.extent.xmin,ymin:i.extent.ymin,xmax:i.extent.xmax,ymax:i.extent.ymax,spatialReference:i.spatialReference}),s=e.state.size[0],r=e.state.size[1],n={};n.timeExtent=this.timeExtent,n.requestAsImageElement=!1,n.signal=t,null==this._projectFullExtentPromise&&(this._projectFullExtentPromise=this._getProjectedFullExtent(a.spatialReference));const o="vector-field"===this.layer.renderer.type?this.layer.renderer.symbolTileSize:50,l=await this._projectFullExtentPromise,h=Object(R.d)(a,s,r,o,l),c=await this.layer.fetchImage(h.extent,h.width,h.height,n),p=this.layer.renderer;if("vector-field"===p.type){this._pixelData={extent:h.extent,pixelBlock:c.pixelData.pixelBlock};const t=await p.getGraphicsFromPixelData(c.pixelData,"vector-uv"===this.layer.rasterInfo.dataType);this._graphicsView.update(e),await Object(w.a)(0).then(()=>{this._graphics.set("items",t)})}})}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this._updateGraphics(e).catch(e=>{Object(w.m)(e)||U.error(e)})}hitTest(e,t){const i=this.view.toMap(Object(x.f)(e,t));return Promise.resolve(new q.a({attributes:{},geometry:i,layer:this.layer}))}attach(){this._graphicsView=new V.a({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new D.a(this.view.featuresTilingScheme)}),this.attached=!0}detach(){this._graphics.destroy(),this._graphicsView.destroy(),this.container.removeChild(this._graphicsView.container),this._graphicsView=null}moveStart(){}viewChange(){}moveEnd(){}install(e){this.container.addChild(this._graphicsView.container),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._graphicsView.container),e.removeChild(this.container)}isUpdating(){return this._graphicsView.updating||this.updateRequested}getPixelData(){return this.updating?null:this._pixelData}redraw(){}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}async _getProjectedFullExtent(e){try{return await Object(I.e)(this.layer.fullExtent,e)}catch(t){try{const t=(await Object(f.default)(this.layer.url,{query:{option:"footprints",outSR:e.wkid||JSON.stringify(e.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return t?m.a.fromJSON(t):null}catch{return null}}}};Object(a.a)([Object(r.b)()],k.prototype,"attached",void 0),Object(a.a)([Object(r.b)()],k.prototype,"container",void 0),Object(a.a)([Object(r.b)()],k.prototype,"layer",void 0),Object(a.a)([Object(r.b)()],k.prototype,"timeExtent",void 0),Object(a.a)([Object(r.b)()],k.prototype,"view",void 0),Object(a.a)([Object(r.b)()],k.prototype,"updateRequested",void 0),Object(a.a)([Object(r.b)()],k.prototype,"updating",null),Object(a.a)([Object(O.a)({graphics:"Graphics"})],k.prototype,"type",void 0),k=Object(a.a)([Object(n.a)("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],k);var S=k,F=i("ne7T"),P=i("iUxC"),M=i("LTnl"),T=i("vbiG");const C=s.a.getLogger("esri.views.2d.layers.imagery.ImageryView2D");let G=class extends j.a{constructor(){super(...arguments),this.attached=!1,this.container=new _.a,this.updateRequested=!1,this.type="Imagery",this._bitmapView=null}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this.strategy.update(e).catch(e=>{Object(w.m)(e)||C.error(e)})}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren()}hitTest(e,t){const i=this.view.toMap(Object(x.f)(e,t));return Promise.resolve(new q.a({attributes:{},geometry:i,layer:this.layer}))}attach(){const e=this.layer.version>=10,t=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,i=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this._bitmapView=new M.a,this.strategy=new T.a({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:t,imageMaxWidth:i,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()}),this.attached=!0}moveStart(){}viewChange(){}moveEnd(){}install(e){this.container.addChild(this._bitmapView),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._bitmapView),e.removeChild(this.container)}redraw(){this.strategy.updateExports(e=>{e.source instanceof HTMLImageElement?e.requestRender():this.layer.applyRenderer({pixelBlock:e.source.pixelBlock}).then(t=>{const i=e.source;i.pixelBlock=t.pixelBlock,i.filter=e=>this.layer.applyFilter(e),this.container.requestRender()})})}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.container.children;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const t=this.view.extent,i=e.map(e=>e.source).filter(e=>e.extent&&e.extent.intersects(t)).map(e=>({extent:e.extent,pixelBlock:e.originalPixelBlock})),a=Object(F.k)(i,t);return a?{extent:a.extent,pixelBlock:a.pixelBlock}:null}return null}_fetchImage(e,t,i,a){return(a=a||{}).timeExtent=this.timeExtent,a.requestAsImageElement=!0,this.layer.fetchImage(e,t,i,a).then(e=>e.imageElement?e.imageElement:this.layer.applyRenderer(e.pixelData,{signal:a.signal}).then(t=>{const i=new P.a(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return i.filter=e=>this.layer.applyFilter(e),i}))}};Object(a.a)([Object(r.b)()],G.prototype,"attached",void 0),Object(a.a)([Object(r.b)()],G.prototype,"container",void 0),Object(a.a)([Object(r.b)()],G.prototype,"layer",void 0),Object(a.a)([Object(r.b)()],G.prototype,"strategy",void 0),Object(a.a)([Object(r.b)()],G.prototype,"timeExtent",void 0),Object(a.a)([Object(r.b)()],G.prototype,"view",void 0),Object(a.a)([Object(r.b)()],G.prototype,"updateRequested",void 0),Object(a.a)([Object(r.b)()],G.prototype,"updating",null),Object(a.a)([Object(O.a)({imagery:"Imagery"})],G.prototype,"type",void 0),G=Object(a.a)([Object(n.a)("esri.views.2d.layers.imagery.ImageryView2D")],G);var B=G;let z=class extends(v(Object(l.a)(Object(g.a)(h.a)))){constructor(){super(...arguments),this._exportImageVersion=-1}initialize(){this.handles.add(Object(o.init)(this,["layer.blendMode"],e=>{this.subview&&(this.subview.container.blendMode=e)},!0))}get pixelData(){return this.updating?null:this.subview.getPixelData()}get updating(){return!(this.subview&&!this.subview.updating)}hitTest(e,t){return this.suspended||!this.subview?Promise.resolve(null):this.subview.hitTest(e,t)}update(e){var t;null==(t=this.subview)||t.update(e)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([Object(o.init)(this,"layer.exportImageServiceParameters.version",e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())}),this.watch("timeExtent",()=>{this.subview.timeExtent=this.timeExtent,this.requestUpdate()}),this.layer.on("redraw",()=>this.subview.redraw()),Object(o.watch)(this.layer,"renderer",()=>this._setSubView())],"imagerylayerview-update")}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove("imagerylayerview-update"),this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}async doRefresh(){this.requestUpdate()}isUpdating(){return!this.subview||!this.suspended&&this.subview.isUpdating()}_setSubView(){var e;let t="Imagery";var i,a;"vector-field"===(null==(e=this.layer.renderer)?void 0:e.type)&&"lerc"===this.layer.format&&(t="Graphics"),this.subview&&this.subview.type===t||(null==(i=this.subview)||i.uninstall(this.container),null==(a=this.subview)||a.destroy(),this.subview="Imagery"===t?new B({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new S({layer:this.layer,view:this.view,timeExtent:this.timeExtent}),this.subview.attach(),this.subview.install(this.container),this.subview.container.blendMode=this.layer.blendMode),this.requestUpdate()}};Object(a.a)([Object(r.b)()],z.prototype,"pixelData",null),Object(a.a)([Object(r.b)({readOnly:!0})],z.prototype,"updating",null),Object(a.a)([Object(r.b)()],z.prototype,"subview",void 0),z=Object(a.a)([Object(n.a)("esri.views.2d.layers.ImageryLayerView2D")],z),t.default=z},rXMu:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));var a=i("srIe"),s=i("wdpY");async function r(e,t=e.popupTemplate){if(!Object(a.k)(t))return[];const i=await t.getRequiredFields(e.fields),{lastEditInfoEnabled:r}=t,{objectIdField:n,typeIdField:o,globalIdField:l,relationships:h}=e;if(i.includes("*"))return["*"];const c=r?await Object(s.m)(e):[],p=Object(s.i)(e.fields,[...i,...c]);return o&&p.push(o),p&&n&&Object(s.p)(e.fields,n)&&-1===p.indexOf(n)&&p.push(n),p&&l&&Object(s.p)(e.fields,l)&&-1===p.indexOf(l)&&p.push(l),h&&h.forEach(t=>{const{keyField:i}=t;p&&i&&Object(s.p)(e.fields,i)&&-1===p.indexOf(i)&&p.push(i)}),p}function n(e,t){return e.popupTemplate?e.popupTemplate:Object(a.k)(t)&&t.defaultPopupTemplateEnabled&&Object(a.k)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);