(function(){var e={"esri/layers/support/TilemapCache":"Cobz","esri/layers/ElevationLayer":"GAgw","esri/layers/support/LercDecoder":"M/KD","esri/layers/mixins/ArcGISCachedService":"WhPF","esri/layers/support/serviceTileInfoProperty":"ddAr","esri/views/3d/support/WorkerHandle":"ecY5","esri/layers/support/Tilemap":"xojL"},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{Cobz:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("zp6E"),r("Gtr7"),r("ma1f"),r("eIBl"),r("qsST"),r("W6K4"),r("KBgh"),r("qMld"),r("afW+"),r("jfWY"),r("8MXS"),r("Vx27"),r("xojL")],void 0===(n=(function(e,t,r,i,n,a,o,l,s,c,p,u,h,d,f,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilemapCache=void 0;var y=l.getLogger("esri.layers.support.TilemapCache"),_=function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new o,r._pendingTilemapRequests={},r._availableLevels={},r.levels=5,r.cacheByteSize=2097152,r.request=i,r._prefetchingEnabled=!0,r}var n;return r.__extends(t,e),n=t,t.prototype.initialize=function(){var e=this;this._tilemapCache=new s(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(function(){return e._initializeTilemapDefinition()})),d.init(this,"layer.tileInfo.lods",(function(t){return e._initializeAvailableLevels(t)}),!0)]),this._initializeTilemapDefinition()},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},t.prototype.castLevels=function(e){return e<=2?(y.error("Minimum levels for Tilemap is 3, but got ",e),3):e},Object.defineProperty(t.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!1,configurable:!0}),t.prototype.fetchTilemap=function(e,t,i,n){var o=this;if(!this._availableLevels[e])return p.reject(new a("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"));var l=this._tmpTilemapDefinition,s=this._tilemapFromCache(e,t,i,l);if(s)return p.resolve(s);var c=n&&n.signal;return n=r.__assign(r.__assign({},n),{signal:null}),p.create((function(e,t){p.onAbort(c,(function(){return t(p.createAbortError())}));var r=v.tilemapDefinitionId(l),i=o._pendingTilemapRequests[r];if(!i){i=v.Tilemap.fromDefinition(l,n).then((function(e){return o._tilemapCache.put(r,e,e.byteSize),e}));var a=function(){return delete o._pendingTilemapRequests[r]};o._pendingTilemapRequests[r]=i,i.then(a,a)}i.then(e,t)}))},t.prototype.getAvailability=function(e,t,r){if(!this._availableLevels[e])return"unavailable";var i=this._tilemapFromCache(e,t,r,this._tmpTilemapDefinition);return i?i.getAvailability(t,r):"unknown"},t.prototype.getAvailabilityUpsample=function(e,t,r,i){i.level=e,i.row=t,i.col=r;var n=this.layer.tileInfo;for(n.updateTileInfo(i);;){var a=this.getAvailability(i.level,i.row,i.col);if("unavailable"!==a)return a;if(!n.upsampleTile(i))return"unavailable"}},t.prototype.fetchAvailability=function(e,t,r,i){return this._availableLevels[e]?this.fetchTilemap(e,t,r,i).catch((function(e){return e})).then((function(i){if(i instanceof v.Tilemap){var n=i.getAvailability(t,r);return"unavailable"===n?p.reject(new a("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:r})):n}if(p.isAbortError(i))throw i;return"unknown"})):p.reject(new a("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"))},t.prototype.fetchAvailabilityUpsample=function(e,t,r,i,n){var a=this;i.level=e,i.row=t,i.col=r;var o=this.layer.tileInfo;o.updateTileInfo(i);var l=this.fetchAvailability(e,t,r,n).catch((function(e){if(p.isAbortError(e))throw e;if(o.upsampleTile(i))return a.fetchAvailabilityUpsample(i.level,i.row,i.col,i);throw e}));return this._fetchAvailabilityUpsamplePrefetch(i.id,e,t,r,n,l),l},t.prototype._fetchAvailabilityUpsamplePrefetch=function(e,t,i,a,o,l){return r.__awaiter(this,void 0,void 0,(function(){var s,c,h,d,f,v,y,_,m;return r.__generator(this,(function(b){switch(b.label){case 0:if(!this._prefetchingEnabled)return[2];if(this._handles.has(s="prefetch-"+e))return[2];c=p.createAbortController(),l.then((function(){return c.abort()}),(function(){return c.abort()})),h=!1,this._handles.add({remove:function(){h||(h=!0,c.abort())}},s),b.label=1;case 1:return b.trys.push([1,3,,4]),[4,u.waitTicks(10,c.signal)];case 2:case 3:return b.sent(),[3,4];case 4:if(h||(h=!0,this._handles.remove(s)),p.isAborted(c))return[2];for(d={id:e,level:t,row:i,col:a},f=r.__assign(r.__assign({},o),{signal:c.signal}),v=this.layer.tileInfo,y=function(e){var t=_.fetchAvailability(d.level,d.row,d.col,f);n._prefetches.push(t);var r=function(){n._prefetches.removeUnordered(t)};t.then(r,r)},_=this,m=0;n._prefetches.length<n._maxPrefetch&&v.upsampleTile(d);++m)y();return[2]}}))}))},t.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?h.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}},t.prototype._tilemapFromCache=function(e,t,r,i){i.level=e,i.row=t-t%this.size,i.col=r-r%this.size;var n=v.tilemapDefinitionId(i);return this._tilemapCache.get(n)},t.prototype._initializeAvailableLevels=function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,r,i){return!!e._tilemapFromCache(t,r,i,e._tmpTilemapDefinition)}}},enumerable:!1,configurable:!0}),t._maxPrefetch=4,t._prefetches=new c({initialSize:n._maxPrefetch}),r.__decorate([f.property({constructOnly:!0,type:Number})],t.prototype,"levels",void 0),r.__decorate([f.cast("levels")],t.prototype,"castLevels",null),r.__decorate([f.property({readOnly:!0,dependsOn:["levels"],type:Number})],t.prototype,"size",null),r.__decorate([f.property({constructOnly:!0,type:Number})],t.prototype,"cacheByteSize",void 0),r.__decorate([f.property({constructOnly:!0})],t.prototype,"layer",void 0),r.__decorate([f.property({constructOnly:!0})],t.prototype,"request",void 0),n=r.__decorate([f.subclass("esri.layers.support.TilemapCache")],t)}(n);t.TilemapCache=_}).apply(null,i))||(e.exports=n)},GAgw:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("zp6E"),r("7bfM"),r("ma1f"),r("qsST"),r("LxLY"),r("EUqE"),r("qMld"),r("jfWY"),r("Vx27"),r("MFVu"),r("0RER"),r("WhPF"),r("2fnV"),r("FEX1"),r("QJ8R"),r("EtsK"),r("M/KD"),r("2Kdy")],void 0===(n=(function(e,t,i,n,a,o,l,s,c,p,u,h,d,f,v,y,_,m,b,g){"use strict";var w=l.getLogger("esri.layers.ElevationLayer");return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i.copyright=null,i.heightModelInfo=null,i.path=null,i.opacity=1,i.operationalLayerType="ArcGISTiledElevationServiceLayer",i.sourceJSON=null,i.type="elevation",i.url=null,i.version=null,i._lercDecoder=g.acquireInstance(),i}return i.__extends(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?i.__assign({url:e},t):e},t.prototype.destroy=function(){g.releaseInstance(this._lercDecoder),this._lercDecoder=null},Object.defineProperty(t.prototype,"minScale",{get:function(){},set:function(e){this.constructed&&w.warn(this.declaredClass+".minScale support has been removed (since 4.5)")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScale",{get:function(){},set:function(e){this.constructed&&w.warn(this.declaredClass+".maxScale support has been removed (since 4.5)")},enumerable:!1,configurable:!0}),t.prototype.readVersion=function(e,t){var r=t.currentVersion;return r||(r=9.3),r},t.prototype.load=function(e){var t=this,r=s.isSome(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(e){for(var t=0;t<e.typeKeywords.length;t++)if("elevation 3d layer"===e.typeKeywords[t].toLowerCase())return!0;throw new o("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).then((function(){return t._fetchImageService(r)}),(function(){return t._fetchImageService(r)}))),p.resolve(this)},t.prototype.fetchTile=function(e,t,r,i){var o=this;void 0===i&&(i={}),null!=i&&"number"==typeof i&&(a.deprecated(w,"Passing 'noDataValue' directly as a parameter",{replacement:"use { noDataValue } options object instead",version:"4.12"}),i={noDataValue:i});var l={responseType:"array-buffer",signal:i.signal},s={noDataValue:i.noDataValue,returnFileInfo:!0};return this.load().then((function(){return o._fetchTileAvailability(e,t,r,i)})).then((function(){return n(o.getTileUrl(e,t,r),l)})).then((function(e){return o._lercDecoder.decode(e.data,s,i.signal)})).then((function(e){return{values:e.pixelData,width:e.width,height:e.height,maxZError:e.fileInfo.maxZError,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue}}))},t.prototype.getTileUrl=function(e,t,r){var n=!this.tilemapCache&&this.supportsBlankTile,a=u.objectToQuery(i.__assign(i.__assign({},this.parsedUrl.query),{blankTile:!n&&null}));return this.parsedUrl.path+"/tile/"+e+"/"+t+"/"+r+(a?"?"+a:"")},t.prototype.queryElevation=function(e,t){var r=this;return this._importElevationQuery().then((function(i){return(new i.ElevationQuery).query(r,e,t)}))},t.prototype.createElevationSampler=function(e,t){var r=this;return this._importElevationQuery().then((function(i){return(new i.ElevationQuery).createSampler(r,e,t)}))},t.prototype._fetchTileAvailability=function(e,t,r,i){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,r,i):p.resolve("unknown")},t.prototype._fetchImageService=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r;return i.__generator(this,(function(a){switch(a.label){case 0:return this.sourceJSON?[2,this.sourceJSON]:(t={query:i.__assign({f:"json"},this.parsedUrl.query),responseType:"json",signal:e},[4,n(this.parsedUrl.path,t)]);case 1:return(r=a.sent()).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=r.data,this.read(r.data,{origin:"service",url:this.parsedUrl}),[2]}}))}))},t.prototype._importElevationQuery=function(){return new Promise((function(e,t){r.e(36).then((function(){var t=[r("T16p")];e.apply(null,t)}).bind(this)).catch(t.bind(this))}))},i.__decorate([h.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),i.__decorate([h.property({readOnly:!0,type:d})],t.prototype,"heightModelInfo",void 0),i.__decorate([h.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],t.prototype,"path",void 0),i.__decorate([h.property({type:["show","hide"]})],t.prototype,"listMode",void 0),i.__decorate([h.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],t.prototype,"minScale",null),i.__decorate([h.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],t.prototype,"maxScale",null),i.__decorate([h.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"opacity",void 0),i.__decorate([h.property({type:["ArcGISTiledElevationServiceLayer"]})],t.prototype,"operationalLayerType",void 0),i.__decorate([h.property()],t.prototype,"sourceJSON",void 0),i.__decorate([h.property({json:{read:!1},value:"elevation",readOnly:!0})],t.prototype,"type",void 0),i.__decorate([h.property(b.url)],t.prototype,"url",void 0),i.__decorate([h.property()],t.prototype,"version",void 0),i.__decorate([h.reader("version",["currentVersion"])],t.prototype,"readVersion",null),i.__decorate([h.subclass("esri.layers.ElevationLayer")],t)}(v.ArcGISCachedService(y.ArcGISService(_.OperationalLayer(m.PortalLayer(c.MultiOriginJSONMixin(f))))))}).apply(null,i))||(e.exports=n)},"M/KD":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("qMld"),r("ecY5"),r("2Kdy")],void 0===(n=(function(e,t,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.releaseInstance=t.acquireInstance=void 0;var a=function(e){function t(t){var r=e.call(this,"LercWorker","_decode",t,{strategy:"dedicated"})||this;return r.scheduler=t,r}return r.__extends(t,e),t.prototype.decode=function(e,t,r){return e&&0!==e.byteLength?this.invoke({buffer:e,options:t},r):i.resolve(null)},t.prototype.getTransferList=function(e){return[e.buffer]},t}(n.WorkerHandle),o=new Map;t.acquireInstance=function(e){var t=o.get(e);return t||(t={instance:new a(e),ref:0},o.set(e,t)),++t.ref,t.instance},t.releaseInstance=function(e){if(null!=e){var t=e.scheduler,r=o.get(t);r&&--r.ref<=0&&(r.instance.destroy(),o.delete(t))}}}).apply(null,i))||(e.exports=n)},WhPF:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("TMur"),r("Vx27"),r("ddAr"),r("Cobz")],void 0===(n=(function(e,t,r,i,n,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArcGISCachedService=void 0,t.ArcGISCachedService=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.copyright=null,t.minScale=0,t.maxScale=0,t.spatialReference=null,t.tileInfo=null,t.tilemapCache=null,t}return r.__extends(t,e),t.prototype.readMinScale=function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0},t.prototype.readMaxScale=function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0},Object.defineProperty(t.prototype,"supportsBlankTile",{get:function(){return this.version>=10.2},enumerable:!1,configurable:!0}),t.prototype.readTilemapCache=function(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new o.TilemapCache({layer:this}):null},r.__decorate([n.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),r.__decorate([n.property()],t.prototype,"minScale",void 0),r.__decorate([n.reader("service","minScale")],t.prototype,"readMinScale",null),r.__decorate([n.property()],t.prototype,"maxScale",void 0),r.__decorate([n.reader("service","maxScale")],t.prototype,"readMaxScale",null),r.__decorate([n.property({type:i.SpatialReference})],t.prototype,"spatialReference",void 0),r.__decorate([n.property({readOnly:!0,dependsOn:["version"]})],t.prototype,"supportsBlankTile",null),r.__decorate([n.property(a.serviceTileInfoProperty)],t.prototype,"tileInfo",void 0),r.__decorate([n.property()],t.prototype,"tilemapCache",void 0),r.__decorate([n.reader("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),r.__decorate([n.property()],t.prototype,"version",void 0),r.__decorate([n.subclass("esri.layers.mixins.ArcGISCachedService")],t)}(e)}}).apply(null,i))||(e.exports=n)},ddAr:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("pMLx")],void 0===(n=(function(e,t,r,i){"use strict";function n(e,t,n,a){if(!e)return null;var o=t.minScale,l=t.maxScale,s=t.minLOD,c=t.maxLOD;if(null!=s&&null!=c)return i.fromJSON(a&&a.ignoreMinMaxLOD?e:r.__assign(r.__assign({},e),{lods:e.lods.filter((function(e){var t=e.level;return null!=t&&t>=s&&t<=c}))}));if(0!==o&&0!==l){var p=function(e){return Math.round(1e4*e)/1e4},u=o?p(o):1/0,h=l?p(l):-1/0;return i.fromJSON(r.__assign(r.__assign({},e),{lods:e.lods.filter((function(e){var t=p(e.scale);return t<=u&&t>=h}))}))}return i.fromJSON(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.readServiceTileInfo=t.serviceTileInfoProperty=void 0,t.serviceTileInfoProperty={type:i,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:n}}}}},t.readServiceTileInfo=n}).apply(null,i))||(e.exports=n)},ecY5:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("qsST"),r("qMld"),r("8V7H")],void 0===(n=(function(e,t,r,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerHandle=void 0;var o=i.getLogger("esri.views.3d.support.WorkerHandle"),l=function(){function e(e,t,i,n){var l=this;void 0===n&&(n={}),this._methodName=t,this._promise=a.open(e,r.__assign(r.__assign({},n),{scheduler:i})).then((function(e){void 0===l._thread?(l._thread=e,l._promise=null):e.close()})),this._promise.catch((function(t){return o.error("Failed to initialize "+e+" worker: "+t)}))}return e.prototype.destroy=function(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null},e.prototype.invoke=function(e,t){var r=this;if(void 0===t&&(t=null),this._thread){var i=this.getTransferList(e);return this._thread.invoke(this._methodName,e,{transferList:i,signal:t})}return this._promise?this._promise.then((function(){return n.throwIfAborted(t),r.invoke(e,t)})):n.reject(null)},e.prototype.broadcast=function(e,t){var r=this;return this._thread?n.all(this._thread.broadcast(t,e)).then((function(){})):this._promise?this._promise.then((function(){return r.broadcast(e,t)})):n.reject()},Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e}();t.WorkerHandle=l}).apply(null,i))||(e.exports=n)},xojL:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("zp6E"),r("KY0m"),r("ma1f"),r("rg9i")],void 0===(n=(function(e,t,r,i,n,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tilemapDefinitionUrl=t.tilemapDefinitionId=t.Tilemap=void 0;var l=function(){function e(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return e.prototype.getAvailability=function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var r=(e-this.location.top)*this.location.width+(t-this.location.left),i=r>>3,n=this._tileAvailabilityBitSet;return i<0||i>n.length?"unknown":n[i]&1<<r%8?"available":"unavailable"},e.prototype._updateFromData=function(e){for(var t=!0,r=!0,i=Math.ceil(this.location.width*this.location.height/8),n=new Uint8Array(i),a=0,o=0;o<e.length;o++){var l=o%8;e[o]?(r=!1,n[a]|=1<<l):t=!1,7===l&&++a}r?this._allAvailability="unavailable":t?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=n,this.byteSize+=n.length)},e.fromDefinition=function(t,o){var l=t.service.request||i,c=t.row,p=t.col,u=t.width,h=t.height,d={query:{f:"json"}};return o=o?r.__assign(r.__assign({},d),o):d,l(s(t),o).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:c,left:p,width:u,height:h},valid:!0,data:n.constant(u*h,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==c||t.location.left!==p||t.location.width!==u||t.location.height!==h))throw new a("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:c,left:p,width:u,height:h}});return e.fromJSON(t)}))},e.fromJSON=function(t){e.validateJSON(t);var r=new e;return r.location=Object.freeze(o.clone(t.location)),r._updateFromData(t.data),Object.freeze(r)},e.validateJSON=function(e){if(!e||!e.location)throw new a("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new a("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new a("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new a("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new a("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();function s(e){var t;if("vector-tile"===e.service.type)t=e.service.url+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height;else{var r=e.service.tileServers;t=(r&&r.length?r[e.row%r.length]:e.service.url)+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height}var i=e.service.query;return i&&(t=t+"?"+i),t}t.Tilemap=l,t.tilemapDefinitionId=function(e){return e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height},t.tilemapDefinitionUrl=s,t.default=l}).apply(null,i))||(e.exports=n)}}]);