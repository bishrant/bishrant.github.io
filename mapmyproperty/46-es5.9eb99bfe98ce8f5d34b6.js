!function(){function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach(function(e){r(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return a(this,r)}}function a(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}function l(e,t,r,n,i,s,a){try{var u=e[s](a),o=u.value}catch(c){return void r(c)}u.done?t(o):Promise.resolve(o).then(n,i)}function f(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var s=e.apply(t,r);function a(e){l(s,n,i,a,u,"next",e)}function u(e){l(s,n,i,a,u,"throw",e)}a(void 0)})}}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==r)return;var n,i,s=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(s.push(n.value),!t||s.length!==t);a=!0);}catch(o){u=!0,i=o}finally{try{a||null==r.return||r.return()}finally{if(u)throw i}}return s}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=d(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw s}}}}function d(e,t){if(e){if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{"1kEK":function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){var n=new i(e.getPointX(t),e.getPointY(t),r),s=e.hasZ(t),a=e.hasM(t);return s&&(n.z=e.getPointZ(t)),a&&(n.m=e.getPointM(t)),n},exportPolygon:function(e,t,r){return new s(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new a(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new u(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){var n=e.hasZ(t),i=e.hasM(t),s=new o(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(n){var a=e.getZExtent(t);s.zmin=a.vmin,s.zmax=a.vmax}if(i){var u=e.getMExtent(t);s.mmin=u.vmin,s.mmax=u.vmax}return s}},i=function e(t,r,n){y(this,e),this.x=t,this.y=r,this.spatialReference=n,this.z=void 0,this.m=void 0},s=function e(t,r,n,i){y(this,e),this.rings=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,n&&(this.hasZ=n),i&&(this.hasM=i)},a=function e(t,r,n,i){y(this,e),this.paths=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,n&&(this.hasZ=n),i&&(this.hasM=i)},u=function e(t,r,n,i){y(this,e),this.points=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,n&&(this.hasZ=n),i&&(this.hasM=i)},o=function e(t,r,n,i,s){y(this,e),this.xmin=t,this.ymin=r,this.xmax=n,this.ymax=i,this.spatialReference=s,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}},"2X7Z":function(e,t,r){"use strict";function n(e,t){return e?t?4:3:t?3:2}function i(e,t,r,i,u){if(!t||!t.lengths.length)return null;var o="upperLeft"===(null==u?void 0:u.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);var c,l=e.coords,f=[],h=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],d=t.lengths,v=t.coords,y=n(r,i),b=0,g=p(d);try{for(g.s();!(c=g.n()).done;){var m=c.value,O=s(h,v,b,m,r,i,o);O&&f.push(O),b+=m*y}}catch(x){g.e(x)}finally{g.f()}if(f.sort(function(e,t){var n=o*e[2]-o*t[2];return 0===n&&r&&(n=e[4]-t[4]),n}),f.length){var j=6*f[0][2];l[0]=f[0][0]/j,l[1]=f[0][1]/j,r&&(j=6*f[0][4],l[2]=0!==j?f[0][3]/j:0),(l[0]<h[0]||l[0]>h[1]||l[1]<h[2]||l[1]>h[3]||r&&(l[2]<h[4]||l[2]>h[5]))&&(l.length=0)}if(!l.length){var k=t.lengths[0]?a(v,0,d[0],r,i):null;if(!k)return null;l[0]=k[0],l[1]=k[1],r&&k.length>2&&(l[2]=k[2])}return e}function s(e,t,r,i,s,a){for(var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,o=n(s,a),c=r,l=r+o,f=0,h=0,p=0,d=0,v=0,y=0,b=i-1;y<b;y++,c+=o,l+=o){var g=t[c],m=t[c+1],O=t[c+2],j=t[l],k=t[l+1],x=t[l+2],w=g*k-j*m;d+=w,f+=(g+j)*w,h+=(m+k)*w,s&&(p+=(O+x)*(w=g*x-j*O),v+=w),g<e[0]&&(e[0]=g),g>e[1]&&(e[1]=g),m<e[2]&&(e[2]=m),m>e[3]&&(e[3]=m),s&&(O<e[4]&&(e[4]=O),O>e[5]&&(e[5]=O))}if(d*u>0&&(d*=-1),v*u>0&&(v*=-1),!d)return null;var I=[f,h,.5*d];return s&&(I[3]=p,I[4]=.5*v),I}function a(e,t,r,i,s){for(var a=n(i,s),f=t,h=t+a,p=0,d=0,v=0,y=0,b=0,g=r-1;b<g;b++,f+=a,h+=a){var m=e[f],O=e[f+1],j=e[f+2],k=e[h],x=e[h+1],w=e[h+2],I=i?o(m,O,j,k,x,w):u(m,O,k,x);if(I)if(p+=I,i){var S=l(m,O,j,k,x,w);d+=I*S[0],v+=I*S[1],y+=I*S[2]}else{var F=c(m,O,k,x);d+=I*F[0],v+=I*F[1]}}return p>0?i?[d/p,v/p,y/p]:[d/p,v/p]:r>0?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function u(e,t,r,n){var i=r-e,s=n-t;return Math.sqrt(i*i+s*s)}function o(e,t,r,n,i,s){var a=n-e,u=i-t,o=s-r;return Math.sqrt(a*a+u*u+o*o)}function c(e,t,r,n){return[e+.5*(r-e),t+.5*(n-t)]}function l(e,t,r,n,i,s){return[e+.5*(n-e),t+.5*(i-t),r+.5*(s-r)]}r.d(t,"a",function(){return i})},HsO1:function(e,t,r){"use strict";r.d(t,"a",function(){return v}),r.d(t,"b",function(){return O}),r.d(t,"c",function(){return k});var n=r("f4Nx"),i=r("l4ZG"),s=r("gYg2"),a=r("1kEK"),u=[0,0];function o(e,t){if(!t)return null;if("x"in t){var r,n={x:0,y:0};return r=h(e(t.x,t.y,u),2),n.x=r[0],n.y=r[1],null!=t.z&&(n.z=t.z),null!=t.m&&(n.m=t.m),n}if("xmin"in t){var i,s,a={xmin:0,ymin:0,xmax:0,ymax:0};return i=h(e(t.xmin,t.ymin,u),2),a.xmin=i[0],a.ymin=i[1],s=h(e(t.xmax,t.ymax,u),2),a.xmax=s[0],a.ymax=s[1],t.hasZ&&(a.zmin=t.zmin,a.zmax=t.zmax,a.hasZ=!0),t.hasM&&(a.mmin=t.mmin,a.mmax=t.mmax,a.hasM=!0),a}return"rings"in t?{rings:l(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:l(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:d(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function l(e,t){var r,n=[],i=p(e);try{for(i.s();!(r=i.n()).done;){var s=r.value;n.push(d(s,t))}}catch(a){i.e(a)}finally{i.f()}return n}function d(e,t){var r,n=[],i=p(e);try{for(i.s();!(r=i.n()).done;){var s=r.value,a=t(s[0],s[1],[0,0]);n.push(a),s.length>2&&a.push(s[2]),s.length>3&&a.push(s[3])}}catch(u){i.e(u)}finally{i.f()}return n}function v(e,t){return b.apply(this,arguments)}function b(){return(b=f(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:return n=Array.isArray(t)?t.map(function(e){var t;return null==(t=e.geometry)?void 0:t.spatialReference}):[t],e.next=5,Object(s.f)(n.map(function(e){return{source:e,dest:r}}));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}var g=o.bind(null,i.c),m=o.bind(null,i.f);function O(e,t,r){return e?(r||(r=t,t=e.spatialReference),Object(n.i)(t)&&Object(n.i)(r)&&!Object(n.c)(t,r)?Object(i.a)(t,r)?Object(n.m)(r)?g(e):m(e):Object(s.m)(a.a,[e],t,r,null)[0]:e):e}var j=new(function(){function e(){y(this,e),this._jobs=[],this._timer=null,this._process=this._process.bind(this)}var t;return c(e,[{key:"push",value:(t=f(regeneratorRuntime.mark(function e(t,r,i){var s,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return!t||!t.length||!r||!i||Object(n.c)(r,i),s={geometries:t,inSpatialReference:r,outSpatialReference:i,resolve:null},e.abrupt("return",(this._jobs.push(s),new Promise(function(e){s.resolve=e,null===a._timer&&(a._timer=setTimeout(a._process,10))})));case 3:case"end":return e.stop()}},e,this)})),function(e,r,n){return t.apply(this,arguments)})},{key:"_process",value:function(){this._timer=null;var e=this._jobs.shift();if(e){var t=e.geometries,r=e.inSpatialReference,u=e.outSpatialReference,o=e.resolve;Object(i.a)(r,u)?Object(n.m)(u)?o(t.map(g)):o(t.map(m)):o(Object(s.m)(a.a,t,r,u,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}}]),e}());function k(e,t,r){return x.apply(this,arguments)}function x(){return(x=f(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",j.push(t,r,n));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}},RjdO:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=r("X2wA"),i=Object(n.b)(function(e){var t;void 0!==(t=function(){function e(r,n,i,s,a){for(;s>i;){if(s-i>600){var u=s-i+1,o=n-i+1,c=Math.log(u),l=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*l*(u-l)/u)*(o-u/2<0?-1:1);e(r,n,Math.max(i,Math.floor(n-o*l/u+f)),Math.min(s,Math.floor(n+(u-o)*l/u+f)),a)}var h=r[n],p=i,d=s;for(t(r,i,n),a(r[s],h)>0&&t(r,i,s);p<d;){for(t(r,p,d),p++,d--;a(r[p],h)<0;)p++;for(;a(r[d],h)>0;)d--}0===a(r[i],h)?t(r,i,d):t(r,++d,s),d<=n&&(i=d+1),n<=d&&(s=d-1)}}function t(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function r(e,t){return e<t?-1:e>t?1:0}return function(t,n,i,s,a){e(t,n,i||0,s||t.length-1,a||r)}}())&&(e.exports=t)})},"YV+X":function(e,r,i){"use strict";i.r(r),i.d(r,"FeatureServiceSnappingSourceWorker",function(){return re});var a=i("pO5D"),u=(i("wSAH"),i("srIe")),o=i("6S2I"),l=(i("zqDF"),i("WbKI")),d=i("04ZG"),v=(i("4EHJ"),i("ju1D"),i("9AIY"),i("9MzC")),b=i("WZb1"),g=i("zm0L"),m=i("r0DZ"),O=i("N5XI"),j=i("+AYZ"),k=i("xk++"),x=i("00eo"),w=i("3/ME"),I=i("ZRfE"),S=i("ZBG3"),F=i("xkkJ"),T=i("tQ+6"),R=i("OvF4"),P=i("kYAx"),C=i("ZlUD"),E=i("hufI"),M=i("6fyR"),A=i("/CmD"),_=function(e){n(r,e);var t=s(r);function r(){var e;return y(this,r),(e=t.apply(this,arguments)).updating=!1,e.pending=[],e}return c(r,[{key:"push",value:function(e,t){this.pending.push({promise:e,callback:t}),1===this.pending.length&&this.process()}},{key:"process",value:function(){var e=this;if(this.pending.length){this.updating=!0;var t=this.pending[0];t.promise.then(function(e){return t.callback(e)}).catch(function(){}).then(function(){e.pending.shift(),e.process()})}else this.updating=!1}}]),r}(A.a);Object(a.a)([Object(l.b)()],_.prototype,"updating",void 0),_=Object(a.a)([Object(d.a)("esri.core.AsyncSequence")],_);var N=i("kJYu"),z=i("eSsm"),Z=function(){function e(t,r){y(this,e),this.data=t,this.resolution=r,this.state={type:0},this.alive=!0}return c(e,[{key:"process",value:function(e){switch(this.state.type){case 0:return this.state=this.gotoFetchCount(this.state,e),this.state.task.promise.then(e.resume,e.resume);case 1:break;case 2:return this.state=this.gotoFetchFeatures(this.state,e),this.state.task.promise.then(e.resume,e.resume);case 3:break;case 4:this.state=this.goToDone(this.state,e)}return null}},{key:"debugInfo",get:function(){return{data:this.data,featureCount:this.featureCount,state:this.stateToString}}},{key:"featureCount",get:function(){switch(this.state.type){case 0:case 1:return 0;case 2:return this.state.featureCount;case 3:return this.state.previous.featureCount;case 4:return this.state.features.length;case 5:return this.state.previous.features.length}}},{key:"stateToString",get:function(){switch(this.state.type){case 0:return"created";case 1:return"fetch-count";case 2:return"fetched-count";case 3:return"fetch-features";case 4:return"fetched-features";case 5:return"done"}}},{key:"gotoFetchCount",value:function(e,t){var r=this;return{type:1,previous:e,task:Object(v.h)(function(){var e=f(regeneratorRuntime.mark(function e(n){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(z.d)(t.fetchCount(r,n));case 2:i=e.sent,1===r.state.type&&(r.state=r.gotoFetchedCount(r.state,i.ok?i.value:1/0));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}}},{key:"gotoFetchedCount",value:function(e,t){return{type:2,featureCount:t,previous:e}}},{key:"gotoFetchFeatures",value:function(e,t){var r=this;return{type:3,previous:e,task:Object(v.h)(function(){var n=f(regeneratorRuntime.mark(function n(i){var s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(z.d)(t.fetchFeatures(r,e.featureCount,i));case 2:s=n.sent,3===r.state.type&&(r.state=r.gotoFetchedFeatures(r.state,s.ok?s.value:[]));case 4:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())}}},{key:"gotoFetchedFeatures",value:function(e,t){return{type:4,previous:e,features:t}}},{key:"goToDone",value:function(e,t){return t.finish(this,e.features),{type:5,previous:e}}},{key:"reset",value:function(){var e=this.state;switch(this.state={type:0},e.type){case 0:case 2:case 4:case 5:break;case 1:case 3:e.task.abort()}}},{key:"intersects",value:function(e){return!(!Object(u.j)(e)&&this.data.extent)||(Object(P.k)(e,q),Object(P.n)(this.data.extent,q))}}]),e}(),q=Object(P.g)(),B=o.a.getLogger("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher"),H=function(e){n(l,e);var t,r,i,a,o=s(l);function l(e){var t;return y(this,l),(t=o.call(this,e)).tilesOfInterest=[],t.availability=0,t.pendingTiles=new Map,t.pendingEdits=new _,t.pendingEditsAbortController=Object(v.d)(),t}return c(l,[{key:"minimumVerticesPerFeature",get:function(){var e;switch(null==(e=this.store)?void 0:e.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}},{key:"filter",set:function(e){var t=this._get("filter"),r=this.filterProperties(e);JSON.stringify(t)!==JSON.stringify(r)&&this._set("filter",r)}},{key:"customParameters",set:function(e){var t=this._get("customParameters");JSON.stringify(t)!==JSON.stringify(e)&&this._set("customParameters",e)}},{key:"configuration",get:function(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}},{key:"tileInfo",set:function(e){var t=this._get("tileInfo");t!==e&&(Object(u.k)(e)&&Object(u.k)(t)&&JSON.stringify(e)===JSON.stringify(t)||(this._set("tileInfo",e),this.store.tileInfo=e))}},{key:"tileSize",set:function(e){this._get("tileSize")!==e&&this._set("tileSize",e)}},{key:"updating",get:function(){return this.updatingHandles.updating||this.pendingEdits.updating}},{key:"initialize",value:function(){var e=this;this.initializeFetchExtent(),this.updatingHandles.add(this,"configuration",function(){return e.refresh()}),this.updatingHandles.add(this,"tilesOfInterest",function(t,r){Object(T.c)(t,r,function(e,t){return e.id===t.id})||e.process()},1)}},{key:"destroy",value:function(){var e=this;this.pendingTiles.forEach(function(t){return e.deletePendingTile(t)}),this.pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this.pendingEditsAbortController.abort(),this.pendingEditsAbortController=null}},{key:"refresh",value:function(){var e=this;this.store.refresh(),this.pendingTiles.forEach(function(t){return e.deletePendingTile(t)}),this.process()}},{key:"applyEdits",value:function(e){var t=this;this.pendingEdits.push(e,function(){var e=f(regeneratorRuntime.mark(function e(r){var n,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===r.addedFeatures.length&&0===r.updatedFeatures.length&&0===r.deletedFeatures.length){e.next=6;break}n=p(t.pendingTiles);try{for(n.s();!(i=n.n()).done;)s=h(i.value,2),s[1].reset()}catch(a){n.e(a)}finally{n.f()}return e.next=5,t.updatingHandles.addPromise(t.store.processEdits(r,function(e,r){return t.queryFeaturesById(e,r)},t.pendingEditsAbortController.signal));case 5:t.processPendingTiles();case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}},{key:"initializeFetchExtent",value:function(){var e=this;if(this.capabilities.query.supportsExtent){var t=Object(v.h)(function(){var t=f(regeneratorRuntime.mark(function t(r){var n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(M.executeQueryForExtent)(e.url,new k.a({where:"1=1",outSpatialReference:e.spatialReference,cacheHint:!!e.capabilities.query.supportsCacheHint||void 0}),{query:e.configuration.customParameters,signal:r});case 3:i=t.sent,e.store.extent=R.a.fromJSON(null==(n=i.data)?void 0:n.extent),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),Object(v.t)(t.t0),B.error("Failed to fetch data extent",t.t0);case 10:case"end":return t.stop()}},t,null,[[0,7]])}));return function(e){return t.apply(this,arguments)}}());this.updatingHandles.addPromise(t.promise.then(function(){return e.process()})),this.handles.add(Object(F.c)(function(){return t.abort()})),this.fetchExtentTask=t}}},{key:"debugInfo",get:function(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this.pendingTiles.values()).map(function(e){return e.debugInfo}),storedTiles:this.store.debugInfo}}},{key:"process",value:function(){!Object(u.k)(this.fetchExtentTask)||this.fetchExtentTask.finished?(this.markTilesNotAlive(),this.createPendingTiles(),this.deletePendingTiles(),this.processPendingTiles()):this.setAvailability(0)}},{key:"markTilesNotAlive",value:function(){var e,t=p(this.pendingTiles);try{for(t.s();!(e=t.n()).done;){h(e.value,2)[1].alive=!1}}catch(r){t.e(r)}finally{t.f()}}},{key:"createPendingTiles",value:function(){var e=this.collectMissingTilesInfo();if(this.setAvailability(Object(u.j)(e)?1:e.coveredArea/e.fullArea),!Object(u.j)(e)){var t,r=p(e.missingTiles);try{for(r.s();!(t=r.n()).done;){var n=t.value,i=n.data,s=n.resolution,a=this.pendingTiles.get(i.id);a?(a.resolution=s,a.alive=!0):this.createPendingTile(i,s)}}catch(o){r.e(o)}finally{r.f()}}}},{key:"collectMissingTilesInfo",value:function(){for(var e=this,t=null,r=this.tilesOfInterest.length-1;r>=0;r--){var n=this.store.process(this.tilesOfInterest[r],function(t,r){return e.verifyTileComplexity(t,r)});Object(u.j)(t)?t=n:t.prepend(n)}return t}},{key:"deletePendingTiles",value:function(){var e,t=p(this.pendingTiles);try{for(t.s();!(e=t.n()).done;){var r=h(e.value,2)[1];r.alive||this.deletePendingTile(r)}}catch(n){t.e(n)}finally{t.f()}}},{key:"processPendingTiles",value:function(){var e=this,t={fetchCount:function(t,r){return e.fetchCount(t,r)},fetchFeatures:function(t,r,n){return e.fetchFeatures(t,r,n)},finish:function(t,r){return e.finishPendingTile(t,r)},resume:function(){return e.processPendingTiles()}};if(this.ensureFetchAllCounts(t)){var r,n=p(this.pendingTiles);try{for(n.s();!(r=n.n()).done;){var i=h(r.value,2)[1];this.verifyTileComplexity(this.store.getFeatureCount(i.data),i.resolution)&&this.updatingHandles.addPromise(i.process(t))}}catch(s){n.e(s)}finally{n.f()}}}},{key:"verifyTileComplexity",value:function(e,t){return this.verifyVertexComplexity(e)&&this.verifyFeatureDensity(e,t)}},{key:"verifyVertexComplexity",value:function(e){return e*this.minimumVerticesPerFeature<Y}},{key:"verifyFeatureDensity",value:function(e,t){if(Object(u.j)(this.tileInfo))return!1;var r=this.tileSize*t;return e*(D/(r*r))<G}},{key:"ensureFetchAllCounts",value:function(e){var t,r=!0,n=p(this.pendingTiles);try{for(n.s();!(t=n.n()).done;){var i=h(t.value,2)[1];i.state.type<2&&this.updatingHandles.addPromise(i.process(e)),i.state.type<=1&&(r=!1)}}catch(s){n.e(s)}finally{n.f()}return r}},{key:"finishPendingTile",value:function(e,t){this.store.add(e.data,t),this.deletePendingTile(e),this.updateAvailability()}},{key:"updateAvailability",value:function(){var e=this.collectMissingTilesInfo();this.setAvailability(Object(u.j)(e)?1:e.coveredArea/e.fullArea)}},{key:"setAvailability",value:function(e){this._set("availability",e)}},{key:"createPendingTile",value:function(e,t){var r=new Z(e,t);return this.pendingTiles.set(e.id,r),r}},{key:"deletePendingTile",value:function(e){e.reset(),this.pendingTiles.delete(e.data.id)}},{key:"fetchCount",value:(a=f(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.store.fetchCount(t.data,this.url,this.createCountQuery(t),{query:this.customParameters,timeout:J,signal:r}));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"fetchFeatures",value:(i=f(regeneratorRuntime.mark(function e(t,r,n){var i,s,a,o,c,l,f,h,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=0,a=0,o=r;case 1:return c=this.createFeaturesQuery(t),l=this.setPagingParameters(c,s,o),e.next=5,this.queryFeatures(c,n);case 5:if(f=e.sent,h=f.features,p=f.exceededTransferLimit,l&&(s+=Object(u.q)(c.num)),a+=h.length,i=i?i.concat(h):h,o=r-a,l&&p&&!(o<=0)){e.next=10;break}return e.abrupt("return",i);case 10:e.next=1;break;case 12:case"end":return e.stop()}},e,this)})),function(e,t,r){return i.apply(this,arguments)})},{key:"filterProperties",value:function(e){return Object(u.j)(e)?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||"1=1",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}},{key:"queryFeaturesById",value:function(e,t){var r=this.createFeaturesQuery(null);return r.objectIds=e,this.queryFeatures(r,t)}},{key:"queryFeatures",value:function(e,t){return this.capabilities.query.supportsFormatPBF?this.queryFeaturesPBF(e,t):this.queryFeaturesJSON(e,t)}},{key:"queryFeaturesPBF",value:(r=f(regeneratorRuntime.mark(function e(t,r){var n,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.sourceSpatialReference,e.next=3,Object(M.executeQueryPBF)(this.url,t,new E.b({sourceSpatialReference:n}),{query:this.configuration.customParameters,timeout:J,signal:r});case 3:return i=e.sent,s=i.data,e.abrupt("return",Object(C.y)(s));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"queryFeaturesJSON",value:(t=f(regeneratorRuntime.mark(function e(t,r){var n,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.sourceSpatialReference,e.next=3,Object(M.executeQuery)(this.url,t,n,{query:this.configuration.customParameters,timeout:J,signal:r});case 3:return i=e.sent,s=i.data,e.abrupt("return",Object(C.b)(s,this.objectIdField));case 6:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"createCountQuery",value:function(e){var t=this.createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}},{key:"createFeaturesQuery",value:function(e){var t=this.createBaseQuery(e);return t.outFields=[this.objectIdField],t.returnGeometry=!0,Object(u.k)(e)&&(this.capabilities.query.supportsResultType?t.resultType="tile":this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0)),t}},{key:"createBaseQuery",value:function(e){var t=new k.a({returnZ:!1,returnM:!1,geometry:Object(u.k)(this.tileInfo)&&Object(u.k)(e)?Object(P.p)(e.data.extent,this.tileInfo.spatialReference):void 0}),r=this.configuration.filter;return Object(u.k)(r)&&(t.where=r.where,t.gdbVersion=r.gdbVersion,t.timeExtent=r.timeExtent),t.outSpatialReference=this.spatialReference,t}},{key:"setPagingParameters",value:function(e,t,r){if(!this.capabilities.query.supportsPagination)return!1;var n=this.capabilities.query,i=n.supportsMaxRecordCountFactor,s=n.supportsCacheHint,a=n.tileMaxRecordCount,u=n.maxRecordCount,o=n.supportsResultType,c=i?k.a.MAX_MAX_RECORD_COUNT_FACTOR:1,l=c*((o||s)&&a?a:u||V);return e.start=t,i?(e.maxRecordCountFactor=Math.min(c,Math.ceil(r/l)),e.num=Math.min(r,e.maxRecordCountFactor*l)):e.num=Math.min(r,l),!0}}]),l}(N.a);Object(a.a)([Object(l.b)({constructOnly:!0})],H.prototype,"url",void 0),Object(a.a)([Object(l.b)({constructOnly:!0})],H.prototype,"objectIdField",void 0),Object(a.a)([Object(l.b)({constructOnly:!0})],H.prototype,"capabilities",void 0),Object(a.a)([Object(l.b)({constructOnly:!0})],H.prototype,"sourceSpatialReference",void 0),Object(a.a)([Object(l.b)({constructOnly:!0})],H.prototype,"spatialReference",void 0),Object(a.a)([Object(l.b)({constructOnly:!0})],H.prototype,"store",void 0),Object(a.a)([Object(l.b)({readOnly:!0})],H.prototype,"minimumVerticesPerFeature",null),Object(a.a)([Object(l.b)()],H.prototype,"filter",null),Object(a.a)([Object(l.b)()],H.prototype,"customParameters",null),Object(a.a)([Object(l.b)({readOnly:!0})],H.prototype,"configuration",null),Object(a.a)([Object(l.b)()],H.prototype,"tileInfo",null),Object(a.a)([Object(l.b)()],H.prototype,"tileSize",null),Object(a.a)([Object(l.b)()],H.prototype,"tilesOfInterest",void 0),Object(a.a)([Object(l.b)({readOnly:!0})],H.prototype,"updating",null),Object(a.a)([Object(l.b)({readOnly:!0})],H.prototype,"availability",void 0),H=Object(a.a)([Object(d.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],H);var V=2e3,J=6e5,Y=1e6,D=25,G=1,L=i("8Lmx"),Q=i("BMSW"),X=function(){function e(){y(this,e),this._store=new Map,this._byteSize=0}return c(e,[{key:"set",value:function(e,t){this.delete(e),this._store.set(e,t),this._byteSize+=t.byteSize}},{key:"delete",value:function(e){var t=this._store.get(e);return!!this._store.delete(e)&&(this._byteSize-=t.byteSize,!0)}},{key:"get",value:function(e){return this.used(e),this._store.get(e)}},{key:"has",value:function(e){return this.used(e),this._store.has(e)}},{key:"clear",value:function(){this._store.clear()}},{key:"applyByteSizeLimit",value:function(e,t){var r,n=p(this._store);try{for(n.s();!(r=n.n()).done;){var i=h(r.value,2),s=i[0],a=i[1];if(this._byteSize<=e)break;this.delete(s),t(a)}}catch(u){n.e(u)}finally{n.f()}}},{key:"values",value:function(){return this._store.values()}},{key:Symbol.iterator,value:function(){return this._store[Symbol.iterator]()}},{key:"used",value:function(e){var t=this._store.get(e);t&&(this._store.delete(e),this._store.set(e,t))}}]),e}(),U=function(e){n(a,e);var t,r,i=s(a);function a(e){var t;return y(this,a),(t=i.call(this,e)).tileInfo=null,t.extent=null,t.maximumByteSize=10485760,t.tileBounds=new Q.a,t.tiles=new X,t.refCounts=new Map,t.tileFeatureCounts=new Map,t.tmpBoundingRect=Object(P.g)(),t}return c(a,[{key:"add",value:function(e,t){var r,n=this,i=[],s=p(t);try{for(s.s();!(r=s.n()).done;){var a=r.value;0===this.referenceFeature(a.objectId)&&i.push(a)}}catch(u){s.e(u)}finally{s.f()}this.addTileStorage(e,new Set(t.map(function(e){return e.objectId})),this.byteSizeOfFeatures(t)),this.featureStore.addMany(i),this.tiles.applyByteSizeLimit(this.maximumByteSize,function(e){return n.removeTileStorage(e)})}},{key:"destroy",value:function(){this.clear(),this.tileFeatureCounts.clear()}},{key:"clear",value:function(){this.featureStore.clear(),this.tileBounds.clear(),this.tiles.clear(),this.refCounts.clear()}},{key:"refresh",value:function(){this.clear(),this.tileFeatureCounts.clear()}},{key:"processEdits",value:function(e,t,r){return this.processEditsDelete(e.deletedFeatures.concat(e.updatedFeatures)),this.processEditsRefetch(e.addedFeatures.concat(e.updatedFeatures),t,r)}},{key:"addTileStorage",value:function(e,t,r){this.tiles.set(e.id,new W(e,t,r)),this.tileBounds.set(e.id,e.extent),this.tileFeatureCounts.set(e.id,t.size)}},{key:"remove",value:function(e){var t=e.id,r=this.tiles.get(t);r&&this.removeTileStorage(r)}},{key:"removeTileStorage",value:function(e){var t,r=[],n=p(e.objectIds);try{for(n.s();!(t=n.n()).done;){var i=t.value;1===this.unreferenceFeature(i)&&r.push(i)}}catch(a){n.e(a)}finally{n.f()}this.featureStore.removeManyById(r);var s=e.data.id;this.tiles.delete(s),this.tileBounds.delete(s)}},{key:"processEditsDelete",value:function(e){this.featureStore.removeManyById(e);var t,r=p(this.tiles);try{for(r.s();!(t=r.n()).done;){var n,i=h(t.value,2)[1],s=p(e);try{for(s.s();!(n=s.n()).done;){var a=n.value;i.objectIds.delete(a)}}catch(l){s.e(l)}finally{s.f()}this.tileFeatureCounts.set(i.data.id,i.objectIds.size)}}catch(l){r.e(l)}finally{r.f()}var u,o=p(e);try{for(o.s();!(u=o.n()).done;){var c=u.value;this.refCounts.delete(c)}}catch(l){o.e(l)}finally{o.f()}}},{key:"processEditsRefetch",value:(r=f(regeneratorRuntime.mark(function e(t,r,n){var i,s,a,u,o,c,l,f=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(t,n);case 2:i=e.sent.features,s=this.featureStore,a=s.hasZ,u=s.hasM,o=p(i);try{for(l=function(){var e=c.value,t=Object(C.r)(f.tmpBoundingRect,e.geometry,a,u);f.tileBounds.forEachInBounds(t,function(t){var r=f.tiles.get(t);f.featureStore.add(e),r.objectIds.has(e.objectId)||(r.objectIds.add(e.objectId),f.referenceFeature(e.objectId),f.tileFeatureCounts.set(r.data.id,r.objectIds.size))})},o.s();!(c=o.n()).done;)l()}catch(h){o.e(h)}finally{o.f()}case 8:case"end":return e.stop()}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"process",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};if(Object(u.j)(this.tileInfo)||!e.extent||Object(u.k)(this.extent)&&!Object(P.n)(Object(P.k)(this.extent,this.tmpBoundingRect),e.extent))return new $(e);if(this.tiles.has(e.id))return new $(e);var r=this.createTileTree(e,this.tileInfo);return this.simplify(r,t,null,0,1),this.collectMissingTiles(e,r,this.tileInfo)}},{key:"debugInfo",get:function(){var e=this;return Array.from(this.tiles.values()).map(function(t){var r=t.data;return{data:r,featureCount:e.tileFeatureCounts.get(r.id)||0}})}},{key:"getFeatureCount",value:function(e){var t=this.tileFeatureCounts.get(e.id);return null!=t?t:0}},{key:"fetchCount",value:(t=f(regeneratorRuntime.mark(function e(t,r,n,i){var s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(s=this.tileFeatureCounts.get(t.id))){e.next=3;break}return e.abrupt("return",s);case 3:return e.next=5,Object(M.executeQueryForCount)(r,n,i);case 5:return a=e.sent,e.abrupt("return",(this.tileFeatureCounts.set(t.id,a.data.count),a.data.count));case 7:case"end":return e.stop()}},e,this)})),function(e,r,n,i){return t.apply(this,arguments)})},{key:"createTileTree",value:function(e,t){var r=this,n=new K(e.level,e.row,e.col);return t.updateTileInfo(n,1),this.tileBounds.forEachInBounds(e.extent,function(i){var s=r.tiles.get(i).data;r.tilesAreRelated(e,s)&&r.populateChildren(n,s,t,r.tileFeatureCounts.get(s.id)||0)}),n}},{key:"tilesAreRelated",value:function(e,t){if(!e||!t)return!1;if(e.level===t.level)return e.row===t.row&&e.col===t.col;var r=e.level<t.level,n=r?e:t,i=r?t:e,s=1<<i.level-n.level;return Math.floor(i.row/s)===n.row&&Math.floor(i.col/s)===n.col}},{key:"populateChildren",value:function(e,t,r,n){var i=t.level-e.level-1;if(i<0)e.isLeaf=!0;else{var s=t.row>>i,a=t.col>>i,o=a-(e.col<<1)+(s-(e.row<<1)<<1),c=e.children[o];if(Object(u.k)(c))this.populateChildren(c,t,r,n);else{var l=new K(e.level+1,s,a);r.updateTileInfo(l,1),e.children[o]=l,this.populateChildren(l,t,r,n)}}}},{key:"simplify",value:function(e,t,r,n,i){var s=i*i;if(e.isLeaf)return t(this.getFeatureCount(e),i)?0:(this.remove(e),Object(u.k)(r)&&(r.children[n]=null),s);for(var a=i/2,o=a*a,c=0,l=0;l<e.children.length;l++){var f=e.children[l];c+=Object(u.k)(f)?this.simplify(f,t,e,l,a):o}return 0===c?this.mergeChildren(e):1-c/s<te&&(this.purge(e),Object(u.k)(r)&&(r.children[n]=null),c=s),c}},{key:"mergeChildren",value:function(e){var t=this,r=new Set,n=0;this.forEachLeaf(e,function(e){var i=t.tiles.get(e.id);if(i){n+=i.byteSize;var s,a=p(i.objectIds);try{for(a.s();!(s=a.n()).done;){var u=s.value;r.has(u)||(r.add(u),t.referenceFeature(u))}}catch(o){a.e(o)}finally{a.f()}t.remove(e)}}),this.addTileStorage(e,r,n),e.isLeaf=!0,e.children[0]=e.children[1]=e.children[2]=e.children[3]=null,this.tileFeatureCounts.set(e.id,r.size)}},{key:"forEachLeaf",value:function(e,t){var r,n=p(e.children);try{for(n.s();!(r=n.n()).done;){var i=r.value;Object(u.j)(i)||(i.isLeaf?t(i):this.forEachLeaf(i,t))}}catch(s){n.e(s)}finally{n.f()}}},{key:"purge",value:function(e){if(!Object(u.j)(e))if(e.isLeaf)this.remove(e);else for(var t=0;t<e.children.length;t++)this.purge(e.children[t]),e.children[t]=null}},{key:"collectMissingTiles",value:function(e,t,r){var n=new ee(r,e,this.extent);return this.collectMissingTilesRecurse(t,n,1),n.info}},{key:"collectMissingTilesRecurse",value:function(e,t,r){if(!e.isLeaf)if(e.hasChildren)for(var n=r/2,i=0;i<e.children.length;i++){var s=e.children[i];Object(u.j)(s)?t.addMissing(e.level+1,(e.row<<1)+((2&i)>>1),(e.col<<1)+(1&i),n):this.collectMissingTilesRecurse(s,t,n)}else t.addMissing(e.level,e.row,e.col,r)}},{key:"referenceFeature",value:function(e){var t=(this.refCounts.get(e)||0)+1;return this.refCounts.set(e,t),1===t?0:2}},{key:"unreferenceFeature",value:function(e){var t=(this.refCounts.get(e)||0)-1;return 0===t?(this.refCounts.delete(e),1):(t>0&&this.refCounts.set(e,t),2)}},{key:"byteSizeOfFeatures",value:function(e){var t,r=0,n=p(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;r+=this.byteSizeOfFeature(i)}}catch(s){n.e(s)}finally{n.f()}return r}},{key:"byteSizeOfFeature",value:function(e){return 32+this.byteSizeOfGeometry(e.geometry)+Object(L.a)(e.attributes)}},{key:"byteSizeOfGeometry",value:function(e){if(!e)return 0;var t=Object(L.b)(e.lengths,4);return 32+Object(L.b)(e.coords,8)+t}},{key:"test",get:function(){var e=this;return{tiles:Array.from(this.tiles.values()).map(function(e){return"".concat(e.data.id,":[").concat(Array.from(e.objectIds),"]")}),featureReferences:Array.from(this.refCounts.keys()).map(function(t){return"".concat(t,":").concat(e.refCounts.get(t))})}}}]),a}(A.a);Object(a.a)([Object(l.b)({constructOnly:!0})],U.prototype,"featureStore",void 0),Object(a.a)([Object(l.b)()],U.prototype,"tileInfo",void 0),Object(a.a)([Object(l.b)()],U.prototype,"extent",void 0),Object(a.a)([Object(l.b)()],U.prototype,"maximumByteSize",void 0),U=Object(a.a)([Object(d.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],U);var W=function e(t,r,n){y(this,e),this.data=t,this.objectIds=r,this.byteSize=n},K=function(){function e(t,r,n){y(this,e),this.level=t,this.row=r,this.col=n,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}return c(e,[{key:"hasChildren",get:function(){return!this.isLeaf&&(Object(u.k)(this.children[0])||Object(u.k)(this.children[1])||Object(u.k)(this.children[2])||Object(u.k)(this.children[3]))}}]),e}(),$=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];y(this,e),this.missingTiles=r,this.fullArea=0,this.coveredArea=0,this.fullArea=Object(P.b)(t.extent),this.coveredArea=this.fullArea}return c(e,[{key:"prepend",value:function(e){this.missingTiles=e.missingTiles.concat(this.missingTiles),this.coveredArea+=e.coveredArea,this.fullArea+=e.fullArea}}]),e}(),ee=function(){function e(t,r,n){y(this,e),this.tileInfo=t,this.extent=null,this.info=new $(r),Object(u.k)(n)&&(this.extent=Object(P.k)(n))}return c(e,[{key:"addMissing",value:function(e,t,r,n){var i={id:null,level:e,row:t,col:r};this.tileInfo.updateTileInfo(i,1),!Object(u.k)(i.extent)||Object(u.k)(this.extent)&&!Object(P.n)(this.extent,i.extent)||(this.info.missingTiles.push({data:i,resolution:n}),this.info.coveredArea-=Object(P.b)(i.extent))}}]),e}(),te=.18751,re=function(e){n(T,e);var r,i,a,o,l,h,p,d,g,F=s(T);function T(){var e;return y(this,T),(e=F.apply(this,arguments)).isInitializing=!0,e.whenSetup=Object(v.f)(),e.handles=new m.a,e.updatingHandles=new x.a,e.pendingApplyEdits=new Map,e}return c(T,[{key:"updating",get:function(){return this.featureFetcher.updating||this.isInitializing||this.updatingHandles.updating}},{key:"destroy",value:function(){this.featureFetcher.destroy(),this.queryEngine.destroy(),this.featureStore.clear(),this.handles.destroy()}},{key:"setup",value:(g=f(regeneratorRuntime.mark(function e(r){var n,i,s,a,u,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.serviceInfo,i=n.geometryType,s=n.objectIdField,a=n.timeInfo,u=n.fields,e.abrupt("return",(this.featureStore=new I.a(t(t({},r.serviceInfo),{},{hasZ:!1,hasM:!1})),this.queryEngine=new S.a({spatialReference:r.spatialReference,featureStore:this.featureStore,geometryType:i,fields:u,hasZ:!1,hasM:!1,objectIdField:s,timeInfo:a?j.a.fromJSON(a):null}),this.featureFetcher=new H({store:new U({featureStore:this.featureStore}),url:r.serviceInfo.url,objectIdField:r.serviceInfo.objectIdField,capabilities:r.serviceInfo.capabilities,spatialReference:b.a.fromJSON(r.spatialReference),sourceSpatialReference:b.a.fromJSON(r.serviceInfo.spatialReference)}),this.handles.add([this.featureFetcher.watch("availability",function(e){return o.emit("notify-availability",{availability:e})},!0),this.watch("updating",function(){return o.notifyUpdating()})]),this.whenSetup.resolve(),this.isInitializing=!1,this.configure(r.configuration)));case 2:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"configure",value:(d=f(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updatingHandles.addPromise(this.whenSetup.promise);case 2:return this.updateFeatureFetcherConfiguration(t),e.abrupt("return",{result:{}});case 4:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"fetchCandidates",value:(p=f(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.whenSetup.promise;case 2:return Object(v.u)(r),e.next=5,this.queryEngine.executeQueryForSnapping({point:t.point,distance:t.distance,types:t.types,query:Object(u.k)(t.filter)?t.filter:{where:"1=1"}},Object(u.k)(r)?r.signal:null);case 5:return e.t0=e.sent,e.abrupt("return",{result:e.t0});case 7:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"updateTiles",value:(h=f(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updatingHandles.addPromise(this.whenSetup.promise);case 2:return Object(v.u)(r),this.featureFetcher.tileSize=t.tileSize,this.featureFetcher.tilesOfInterest=t.tiles,this.featureFetcher.tileInfo=Object(u.k)(t.tileInfo)?w.a.fromJSON(t.tileInfo):null,e.abrupt("return",{result:{}});case 7:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"refresh",value:(l=f(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updatingHandles.addPromise(this.whenSetup.promise);case 2:return Object(v.u)(r),this.featureFetcher.refresh(),e.abrupt("return",{result:{}});case 5:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"whenNotUpdating",value:(o=f(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updatingHandles.addPromise(this.whenSetup.promise);case 2:return Object(v.u)(r),e.next=5,Object(v.x)(Object(O.whenNotOnce)(this,"updating"),r);case 5:return e.abrupt("return",{result:{}});case 6:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"getDebugInfo",value:(a=f(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(Object(v.u)(r),{result:this.featureFetcher.debugInfo}));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"beginApplyEdits",value:(i=f(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.updatingHandles.addPromise(this.whenSetup.promise),Object(v.u)(r),n=Object(v.f)(),e.abrupt("return",(this.pendingApplyEdits.set(t.id,n),this.featureFetcher.applyEdits(n.promise),this.updatingHandles.addPromise(n.promise),{result:{}}));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"endApplyEdits",value:(r=f(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.pendingApplyEdits.get(t.id),e.abrupt("return",(n&&n.resolve(t.edits),Object(v.u)(r),{result:{}}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"updateFeatureFetcherConfiguration",value:function(e){this.featureFetcher.filter=Object(u.k)(e.filter)?k.a.fromJSON(e.filter):null,this.featureFetcher.customParameters=e.customParameters}},{key:"notifyUpdating",value:function(){this.emit("notify-updating",{updating:this.updating})}}]),T}(g.a.EventedAccessor);Object(a.a)([Object(l.b)({readOnly:!0})],re.prototype,"updating",null),Object(a.a)([Object(l.b)()],re.prototype,"isInitializing",void 0),re=Object(a.a)([Object(d.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],re),r.default=function(){return new re}}}])}();