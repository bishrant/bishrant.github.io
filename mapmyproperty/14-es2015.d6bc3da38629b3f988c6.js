(window.webpackJsonp=window.webpackJsonp||[]).push([[14,74],{"6UvW":function(e,t,i){"use strict";i.d(t,"a",function(){return o}),i.d(t,"b",function(){return l});var a=i("srIe"),r=i("OvF4"),s=(i("4GrV"),i("gEht")),n=i("U282");function o(e,t,i,n=new r.a){let o;if("2d"===i.type)o=t*i.resolution;else if("3d"===i.type){const r=i.overlayPixelSizeInMapUnits(e),n=i.basemapSpatialReference;o=Object(a.k)(n)&&!n.equals(i.spatialReference)?Object(s.f)(n)/Object(s.f)(i.spatialReference):t*r}const l=e.x-o,c=e.y-o,h=e.x+o,p=e.y+o,{spatialReference:d}=i;return n.xmin=Math.min(l,h),n.ymin=Math.min(c,p),n.xmax=Math.max(l,h),n.ymax=Math.max(c,p),n.spatialReference=d,n}function l(e,t,i){const r=i.toMap(e);return!Object(a.j)(r)&&o(r,Object(n.a)(),i,c).intersects(t)}const c=new r.a},"89mX":function(e,t,i){"use strict";i.d(t,"a",function(){return d}),i.d(t,"b",function(){return p});var a=i("OIYi"),r=i("Tbkp"),s=i("aQrP"),n=i("Q3fD"),o=i("0nJL"),l=i("0Ect"),c=i("69UF"),h=i("xtdb");function p(e){const t=new s.a;return t.include(r.a,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(a.a`
    void main(void) {
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(o.a,e),e.multipassTerrainEnabled&&(t.fragment.include(l.a),t.include(h.b,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(a.a`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${a.a.float(c.b)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(t.fragment.include(n.a),t.fragment.code.add(a.a`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${a.a.float(c.b)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}var d=Object.freeze({__proto__:null,build:p})},Q44q:function(e,t,i){"use strict";i.r(t),i.d(t,"DrawOperation",function(){return a.a}),i.d(t,"DrawGraphicTool",function(){return _e}),i.d(t,"GraphicMoveTool",function(){return jt}),i.d(t,"GraphicReshapeTool",function(){return Ct}),i.d(t,"GraphicTransformTool",function(){return Zt}),i.d(t,"ExtentTransformTool",function(){return Ea});var a=i("ZGlk"),r=i("pO5D"),s=i("wSAH"),n=i("srIe"),o=i("6S2I"),l=i("zqDF"),c=i("WbKI"),h=i("04ZG"),p=(i("4EHJ"),i("ju1D"),i("9AIY"),i("zm0L")),d=i("jWBI"),u=i("N5XI"),g=i("kJYu"),b=i("zgsL"),m=i("9AiD"),v=i("Alwt"),O=i("R3Kl"),f=i("pUVe"),y=i("nvBr"),j=i("0ynT"),_=i("D8Ta"),M=i("NUQ5");const w={main:new y.a([255,127,0]),selected:new y.a([255,255,255]),staged:new y.a([12,207,255]),outline:new y.a([0,0,0,.5]),selectedOutline:new y.a([255,255,255])};function x(e,t){const i=e.clone();return i.a*=t,i}function S(e,t){const i=e.clone(),a=Object(j.b)(i);a.s*=t;const r=Object(j.e)(a);return i.r=r.r,i.g=r.g,i.b=r.b,i}function P(e,t){if(t)for(const i in t)e[i]=t[i]}class E{constructor(e){this.color=w.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,P(this,e)}}class A{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=w.main,this.outlineColor=w.outline,this.renderOccluded=16,this.hoverOutlineColor=w.selectedOutline,P(this,e)}apply(e,t){const i=this[e];t.setParameterValues({color:z(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class D{constructor(e){this.vertex=new A({color:w.main,outlineColor:w.outline}),this.edge=new A({color:S(x(w.main,2/3),.5),outlineColor:x(w.outline,.5),size:8,collisionPadding:8}),this.selected=new A({color:w.selected,outlineColor:w.outline}),P(this,e)}}class G{constructor(e){this.color=w.selected,this.width=1.5,this.stipplePattern=Object(M.b)([5,5]),this.stippleOffColor=w.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=w.selected,this.renderOccluded=4,P(this,e)}apply(e){e.color=z(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=z(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=z(this.innerColor),e.renderOccluded=this.renderOccluded}}class R{constructor(e){this.color=w.selected,this.size=4,this.outlineSize=1,this.outlineColor=w.outline,this.shape="square",P(this,e)}apply(e){e.color=z(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=z(this.outlineColor),e.primitive=this.shape}}class C{constructor(e){this.innerColor=w.selected,this.innerWidth=1,this.glowColor=w.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=w.main,P(this,e)}apply(e,t=1){const i={glowColor:y.a.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:y.a.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class T{constructor(e){this.outline=new G({color:w.outline,renderOccluded:8,stippleOffColor:w.selected,stipplePattern:Object(M.b)([5,5]),width:1.5,innerWidth:0}),this.staged=new G({color:w.selected,renderOccluded:8,innerColor:w.staged,stippleOffColor:w.outline,stipplePattern:Object(M.b)([5,5]),width:1.5}),this.shadowStyle=new C({globalAlpha:.3,glowColor:w.main,glowFalloff:8,glowWidth:8,innerColor:w.selected,innerWidth:1}),P(this,e)}}class k{constructor(e){this.outline=new R({color:w.selected,outlineColor:w.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new C({globalAlpha:.3,glowColor:w.main,glowFalloff:1.5,glowWidth:6,innerColor:w.selected,innerWidth:1,radius:2}),P(this,e)}}class I extends G{constructor(e){super(),this.extensionType=2,P(this,e)}}class V{constructor(e){this.lineGraphics=new T,this.pointGraphics=new k,this.heightPlane=new C({globalAlpha:.3,glowColor:w.main,glowFalloff:8,glowWidth:8,innerColor:w.selected,innerWidth:1}),this.heightBox=new C({globalAlpha:.3,glowColor:w.main,glowFalloff:8,glowWidth:8,innerColor:w.selected,innerWidth:0,heightFillColor:w.main}),this.zVerticalLine=new I({color:x(w.main,.5),falloff:2,innerColor:x(w.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,P(this,e)}}function z(e){return Object(_.g)(y.a.toUnitRGBA(e))}const H=new class{constructor(e){this.visualElements=new V,this.reshapeManipulators=new D,this.zManipulator=new E,P(this,e)}colorToVec4(e){return z(e)}};var B=i("Cy1f"),F=i("5DEt"),q=i("gYg2"),U=i("dXfX"),L=i("QmHG"),Z=i("XvKw"),W=i("GlSV"),N=i("EDiM"),Y=i("Drlb"),X=i("hrr/"),K=i("aAs6"),Q=i("15Hh"),J=i("r+FG"),$=i("vqnv"),ee=i("tiP8");class te{constructor(e,t,i=null,a=null,r,s,n,o,l){this.data=e,this.material=t,this.layerUid=i,this.graphicUid=a,this.boundingSphere=Object(_.c)(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this.shaderTransformationDirty=!0,this.boundingInfo=r,this.material=t,this.origin=null,this.transformation=null,this.calculateShaderTransformation=n,s&&this.updateTransformation(s,o),this.castShadow=l}updateTransformation(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.computeBoundingSphere(e,t,this.boundingSphere)}shaderTransformationChanged(){this.shaderTransformationDirty=!0}computeBoundingSphere(e,t,i){Object(n.j)(this.boundingInfo)||(t=t||Object(K.f)(e),Object(F.l)(i,this.boundingInfo.getCenter(),e),i[3]=this.boundingInfo.getBSRadius()*t)}get hasShaderTransformation(){return Object(n.k)(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return Object(n.j)(this.calculateShaderTransformation)?Object(n.r)(this.transformation,J.a):(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=Object(J.b)()),Object(Q.c)(this.shaderTransformation,this.calculateShaderTransformation(Object(n.r)(this.transformation,J.a))),this.shaderTransformationDirty=!1),this.shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(n.k)(this.transformation)&&Object(F.l)(e,e,this.transformation),!0);const t=this.indices.get("position"),i=this.vertexAttributes.get("position");return!!Object(N.c)(i,t,e)&&(Object(n.k)(this.transformation)&&Object(F.l)(e,e,this.transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new $.a(0),t=this.instanceParameters;return t.highlights=Object(ee.b)(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=Object(ee.f)(t.highlights,e)}}var ie=i("1AhW"),ae=i("ZHv2"),re=i("3WMd"),se=i("/CmD"),ne=i("pdg3");class oe{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return Object(n.k)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?Object(n.j)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?Object(n.j)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this.resourceFactory.createResources();this._resources={layerView:new le({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();const i=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;i&&i.registerDrapeSource(this._resources.layerView)}_destroyResources(){var e;if(Object(n.j)(this._resources))return;this.ensureRenderGeometriesRemoved();const t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}ensureRenderGeometriesRemoved(){var e;!Object(n.j)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}ensureRenderGeometriesAdded(){Object(n.j)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}let le=class extends(Object(ne.a)(se.a)){constructor(e){super(e),this.drapeSourceType=1}};Object(r.a)([Object(c.b)({constructOnly:!0})],le.prototype,"view",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],le.prototype,"drapeSourceType",void 0),le=Object(r.a)([Object(h.a)("DrapedVisualElementLayerView")],le);class ce{constructor(e){this.view=null,this._attachmentOrigin=Object(W.d)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new p.a,this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(Z.c)(1,0,1,1),this._innerWidth=0,this._innerColor=Object(Z.c)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new re.a({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this.recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new oe({view:e.view,createResources:()=>this.createDrapedResources(),recreateGeometry:e=>{e.geometries=this.createRenderGeometriesDraped(e.material),this.attachmentOriginChanged()}});let t=!0;this._laserline=new ae.a({view:e.view});for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&Object(n.k)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this.updateAttached(e)}updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){Object(U.g)(e,this._color)||(Object(U.c)(this._color,e),this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(U.g)(e,this._innerColor)||(Object(U.c)(this._innerColor,e),this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(n.k)(e)!==Object(n.k)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&Object(U.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(Z.a)(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(n.k)(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=Object(n.k)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(F.v)(de,0,0,0);let t=0;for(const i of e){const e=i.vertexAttributes.get("position"),a=i.indices.get("position"),r=Object(n.q)(this.resources.resources).material.isClosed(e.data,a);Object(N.a)(e,a,r,pe)&&(Object(F.e)(de,de,pe),t++)}return 0===t?null:(Object(F.d)(de,de,1/t),this.view.renderCoordsHelper.fromRenderCoords(de,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}updateMaterial(){Object(n.k)(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),Object(n.k)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}get isClosed(){return Object(n.k)(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}recreateGeometry(e,t,i){const a=this.createRenderGeometries();for(const r of a)e.addGeometry(r,t),i.push(r);this.attachmentOriginChanged()}attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}createResources(e){const t=new X.a(this.materialParameters),i=[];return this.recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}createDrapedResources(){const e=new X.a(this.materialParameters);return{material:e,geometries:this.createRenderGeometriesDraped(e)}}createRenderGeometriesDraped(e){const t=this.geometry;if(Object(n.j)(t))return[];const i=Object(ie.c)(t,this.view.basemapTerrain.spatialReference),a=[];for(const{position:r}of i.lines){const t={attributeData:{position:r},removeDuplicateStartEnd:this.isClosed?1:0},i=new te(Object(ie.a)(t),e),s=Object(L.e)(he);Object(L.h)(s,r),Object(U.l)(i.boundingSphere,.5*(s[0]+s[3]),.5*(s[1]+s[4]),0,.5*Math.sqrt((s[3]-s[0])*(s[3]-s[0])+(s[4]-s[1])*(s[4]-s[1]))),a.push(i)}return a}calculateMapBounds(e){if(Object(n.j)(this.resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const i of this.resources.resources.geometries){const a=i.vertexAttributes.get("position"),r=new Float64Array(a.data.length);Object(q.k)(a.data,t.spatialReference,0,r,this.view.spatialReference,0,a.data.length/3),Object(L.h)(e,r)}return!0}createRenderGeometries(){const e=this.geometry;if(Object(n.j)(e))return[];const t=Object(ie.b)(e,this.view.elevationProvider,this.view.renderCoordsHelper,Y.a.fromElevationInfo(this.elevationInfo)),i=[],a=[];for(const{position:r,mapPosition:s}of t.lines){const e={attributeData:{position:r,mapPosition:s},removeDuplicateStartEnd:this.isClosed?1:0};i.push(Object(ie.a)(e)),a.push(r)}return this._laserline.pathVerticalPlane=a,i}}const he=Object(L.d)(),pe=Object(B.e)(),de=Object(B.e)();var ue=i("yvcr"),ge=(i("Mu3I"),i("WiJz"),i("uljd"),i("Lg+x"));Object(B.e)();var be=i("X668"),me=i("k2DL");class ve extends be.a{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=H.colorToVec4(H.reshapeManipulators.vertex.color),this._size=H.reshapeManipulators.vertex.size,this._outlineColor=H.colorToVec4(H.reshapeManipulators.vertex.outlineColor),this._outlineSize=H.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){Object(U.g)(e,this._color)||(Object(U.c)(this._color,e),this.updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(U.g)(e,this._outlineColor)||(Object(U.c)(this._outlineColor,e),this.updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}updateMaterial(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}createRenderGeometries(){const e=this.vertices;if(Object(n.j)(e)||0===e.length)return[];const t=function(e,t,i,a,r){const s=new Float64Array(3*e.length),n=new Float64Array(s.length);e.forEach((e,t)=>{s[3*t+0]=e[0],s[3*t+1]=e[1],s[3*t+2]=e.length>2?e[2]:0});const o=Object(ge.b)(s,t,0,n,0,s,0,s.length/3,i,a,r);return{numVertices:e.length,position:s,mapPosition:n,projectionSuccess:null!=o,sampledElevation:o}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Y.a.fromElevationInfo(this.elevationInfo)),i=[],a=t.numVertices,r=t.position;for(let s=0;s<a;++s){const e=Object(F.v)(Oe,r[3*s+0],r[3*s+1],r[3*s+2]),t=fe(.5,e),a=fe(.5,e);i.push({vertexGeometry:t,vertexOutlineGeometry:a})}return i}createGeometries(e){const t=this.createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:a}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(a,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new me.a({...this.vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0}),this.vertexOutlineMaterial=new me.a({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const Oe=Object(B.e)();function fe(e,t){return ue.a.createSphereGeometry(e,16,16,{offset:t})}let ye=class extends p.a.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};Object(r.a)([Object(c.b)({constructOnly:!0})],ye.prototype,"graphic",void 0),Object(r.a)([Object(c.b)()],ye.prototype,"tracking",void 0),Object(r.a)([Object(c.b)()],ye.prototype,"displaying",void 0),Object(r.a)([Object(c.b)()],ye.prototype,"isDraped",void 0),ye=Object(r.a)([Object(h.a)("esri.views.3d.layers.graphics.GraphicState")],ye);var je=i("39Rk");let _e=class extends(Object(g.b)(p.a.EventedMixin(O.a))){constructor(e){super(e),this.drawOperation=null,this._createGraphic=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._stagedVerticesVisualElement=null,this.hasZ=!0,this.defaultZ=0,this.elevationInfo=null,this.snapToScene=!1,this.snappingManager=null,this.mode=null,this.geometryType=null,this.type="draw-3d"}initialize(){const e=Object(n.r)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new b.a({elevationInfo:e,listMode:"hide",internal:!0}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new a.a({view:this.view,manipulators:this.manipulators,geometryType:Me(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,snappingDrawSurface:new v.b(this.view,e,[this._internalGraphicsLayer]),elevationDrawSurface:new v.a(e,this.defaultZ,this.view,this._internalGraphicsLayer),hasM:!1,elevationInfo:e,snappingManager:this.snappingManager}),this.drawOperation.on("vertex-add",e=>this.onVertexAdd(e)),this.drawOperation.on("vertex-remove",e=>this.onVertexRemove(e)),this.drawOperation.on("vertex-update",e=>this.onVertexUpdate(e)),this.drawOperation.on("cursor-update",e=>this.onCursorUpdate(e)),this.drawOperation.on("complete",e=>this.onComplete(e))}destroy(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)}onInputEvent(e){this.drawOperation.onInputEvent(e)}_getCreateGeometry(e,t=!1){if(null==this.drawOperation)return null;const i=Object(n.k)(e)?e:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null,a=this.drawOperation.vertices;if(0===a.length)return null;const r=this.drawOperation.spatialReference,s=a,o=s.slice(),l=[];Object(n.k)(i)&&(o.splice(i,1),l.push(s[i]));const c={regularVertices:null,stagedVertices:null,full:null,outline:null},h="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":c.regularVertices=o,c.stagedVertices=l,c.full=this.drawOperation.coordinateHelper.createPointFromArray(a[0]);break;case"polyline":c.regularVertices=o,c.stagedVertices=l,s.length>0&&(c.full=Object(je.createPolyline)([s],r,h));break;case"polygon":c.regularVertices=o,c.stagedVertices=l,s.length>0&&(c.full=Object(je.createPolygon)([s],r,h,!0));break;case"circle":if(s.length>0){const e=Object(f.a)(this.view,a[0]);if(1===s.length&&t){const t=s[0],i=e.makeMapPoint(t[0]+we*this.view.resolution,t[1]);c.full=Object(je.createCircle)([t,i],e,!0)}else 2===s.length&&(c.full=this.forceUniformSize?Object(je.createCircle)(a,e,this.centered):Object(je.createEllipse)(a,e,this.centered))}break;case"rectangle":if(s.length>0){const e=Object(f.a)(this.view,a[0]);if(1===s.length&&t){const t=s[0],i=e.makeMapPoint(t[0]+we*this.view.resolution,t[1]);c.full=Object(je.createSquare)([t,i],e,!0)}else 2===s.length&&(c.full=this.forceUniformSize?Object(je.createSquare)(a,e,this.centered):Object(je.createRectangle)(a,e,this.centered))}break;default:return null}switch(this.geometryType){case"point":break;case"polyline":s.length>1&&(c.outline=Object(je.createPolyline)([s],r,h));break;case"polygon":s.length>1&&(c.outline=Object(je.createPolygon)([s],r,h));break;case"circle":case"rectangle":Object(n.k)(c.full)&&"polygon"===c.full.type&&(c.outline=Object(je.createPolygon)(c.full.rings,r,h))}return c}_destroyAllVisualisations(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()}_destroyCreateGraphic(){Object(n.k)(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null),this._createGraphicState=null,this.handles.remove(xe)}_destroyOutlineVisualElement(){Object(n.k)(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)}_destroyVerticesVisualElement(){Object(n.k)(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)}_destroyStagedVerticesVisualElement(){Object(n.k)(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)}_updateCreateGraphic(e=null){const t=this._getCreateGeometry(e);if(Object(n.j)(t))return void this._destroyAllVisualisations();const i=this._internalGraphicsLayer.elevationInfo;Object(n.k)(t.outline)?Object(n.j)(this._outlineVisualElement)?(this._outlineVisualElement=new ce({view:this.view,geometry:t.outline,elevationInfo:Object(n.q)(i),isDraped:Object(n.k)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(m.c)(this.hasZ,i),attached:!1}),H.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),H.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=t.outline:this._destroyOutlineVisualElement(),Object(n.k)(t.regularVertices)?Object(n.j)(this._verticesVisualElement)?(this._verticesVisualElement=new ve({view:this.view,spatialReference:this.view.spatialReference,vertices:t.regularVertices,elevationInfo:Object(n.q)(this._internalGraphicsLayer.elevationInfo),renderOccluded:H.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=t.regularVertices:this._destroyVerticesVisualElement(),Object(n.k)(t.stagedVertices)?Object(n.j)(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new ve({view:this.view,spatialReference:this.view.spatialReference,vertices:t.stagedVertices,elevationInfo:Object(n.q)(this._internalGraphicsLayer.elevationInfo),renderOccluded:H.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._stagedVerticesVisualElement.color=H.colorToVec4(H.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=t.stagedVertices:this._destroyStagedVerticesVisualElement(),Object(n.k)(t.full)?Object(n.j)(this._createGraphic)?(this._createGraphic=new d.a({geometry:t.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this._createGraphicState=new ye({graphic:this._createGraphic}),this.handles.add([this.view.trackGraphicState(this._createGraphicState),Object(u.init)(this._createGraphicState,"isDraped",e=>{Object(n.k)(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=e)})],xe),this.notifyChange("createGraphic")):this._createGraphic.geometry=t.full:this._destroyCreateGraphic()}get createGraphic(){return this._createGraphic}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set centered(e){this._set("centered",e),this._updateCreateGraphic()}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateCreateGraphic()}reset(){}get canRedo(){return this.drawOperation.canRedo}redo(){this.drawOperation.redo()}get canUndo(){return this.drawOperation.canUndo}undo(){this.drawOperation.undo()}completeCreateOperation(){this.drawOperation.complete()}activate(){}deactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.vertices}onVertexAdd(e){this._updateCreateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateCreateGraphic(),this.emit("vertex-update",e)}onCursorUpdate(e){this._updateCreateGraphic(1===e.vertices.length?e.vertices[0].vertexIndex:null),this.emit("cursor-update",e)}onComplete(e){this._updateCreateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateGeometry(null,!0);Object(n.k)(e)&&(t=new d.a({geometry:e.full,symbol:this.createGraphicSymbol}))}this.emit("complete",{graphic:t,...e})}};function Me(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return null}}Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],_e.prototype,"view",void 0),Object(r.a)([Object(c.b)()],_e.prototype,"createGraphicSymbol",void 0),Object(r.a)([Object(c.b)()],_e.prototype,"createGraphic",null),Object(r.a)([Object(c.b)({value:!0})],_e.prototype,"enabled",null),Object(r.a)([Object(c.b)({value:!0})],_e.prototype,"centered",null),Object(r.a)([Object(c.b)({value:!0})],_e.prototype,"forceUniformSize",null),Object(r.a)([Object(c.b)({constructOnly:!0})],_e.prototype,"hasZ",void 0),Object(r.a)([Object(c.b)({nonNullable:!0})],_e.prototype,"defaultZ",void 0),Object(r.a)([Object(c.b)({constructOnly:!0})],_e.prototype,"elevationInfo",void 0),Object(r.a)([Object(c.b)()],_e.prototype,"snapToScene",void 0),Object(r.a)([Object(c.b)()],_e.prototype,"snappingManager",void 0),Object(r.a)([Object(c.b)({constructOnly:!0})],_e.prototype,"mode",void 0),Object(r.a)([Object(c.b)({constructOnly:!0})],_e.prototype,"geometryType",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],_e.prototype,"type",void 0),_e=Object(r.a)([Object(h.a)("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],_e);const we=48,xe="create-graphic";var Se=i("xkkJ"),Pe=i("LE9a"),Ee=i("r0DZ"),Ae=i("aunz"),De=i("J9+3"),Ge=i("Hxwb"),Re=i("wg3g"),Ce=i("NRDM"),Te=i("/rov"),ke=i("dK/y"),Ie=i("JD/0");function Ve(e,t=Object(m.d)(e)){return"on-the-ground"!==t.mode&&!(Object(n.j)(e.geometry)||!e.geometry.hasZ)}var ze=i("OKTS"),He=i("jxyb"),Be=i("TnN0");class Fe{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((e,t)=>{if(0===t&&(this.zManipulator=e),e instanceof Be.a&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),Object(n.j)(this.firstGrabbedXY)&&e.grabbing&&1===t&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,t){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}})}}function qe(e,t,i){const{graphic:a,view:r}=e,s=[],o=Object(m.d)(a),l="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,c=new Fe,h=new He.a({view:r,extensionType:H.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});H.visualElements.pointGraphics.shadowStyle.apply(h);const p=Object(ze.d)(H.visualElements.heightPlaneAngleCutoff),d=new ae.a({view:r,attached:!1,angleCutoff:p});H.visualElements.heightPlane.apply(d);let u=1,g=1;const b=()=>{if(c.update(e),!i.displaying||l&&(i.isDraped||!Ue(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,h.attached=!1,void(d.attached=!1);t.laserlineEnabled=!0;{const e=4&c.grabbingState?H.visualElements.laserlineAlphaMultiplier:1;e!==u&&(u=e,H.visualElements.lineGraphics.shadowStyle.apply(t,e),H.visualElements.pointGraphics.shadowStyle.apply(h,e))}{const e=2&c.grabbingState?H.visualElements.laserlineAlphaMultiplier:1;e!==g&&(g=e,H.visualElements.heightPlane.apply(d,e))}(function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(n.k)(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(n.k)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1})(h,c),function(e,t,i,a){if(a.numSelected>0){Object(F.v)(Le,0,0,0);let t=0;e.forEachManipulator((e,i)=>{1===i&&e.selected&&e instanceof Be.a&&(Object(F.e)(Le,Le,e.renderLocation),t++)}),t>0?(i.heightManifoldTarget=Object(F.d)(Le,Le,1/t),i.attached=!0):i.attached=!1}else{const a=t.attachmentOrigin;Object(n.k)(a)&&e.view.renderCoordsHelper.toRenderCoords(a,Le)?(i.heightManifoldTarget=Le,i.attached=!0):i.attached=!1}}(e,t,d,c)};H.visualElements.zVerticalLine.apply(h),s.push(i.on("changed",b),i.watch("displaying",b),t.events.on("attachment-origin-changed",b),Object(Se.a)(h),Object(Se.a)(d));const v=[],O=()=>{Object(Se.b)(v).remove(),v.length=0,e.forEachManipulator(e=>v.push(e.events.on("grab-changed",b))),e.forEachManipulator(e=>v.push(e.events.on("select-changed",b))),b()};return O(),s.push(e.onManipulatorsChanged(O),Object(Se.d)(()=>Object(Se.b)(v))),Object(Se.b)(s)}function Ue(e){return Object(n.k)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const Le=Object(B.e)();var Ze=i("kYAx"),We=i("ACyv");function Ne(e){return Object(n.k)(e.geometry)&&"point"===e.geometry.type}const Ye=Object(B.e)(),Xe=Object(L.d)();function Ke(e){switch(Object(n.q)(e.graphic.geometry).type){case"point":return function(e){const{view:t,graphic:i}=e,a=new ye({graphic:i}),r=[],s=function(e,t,i){const{view:a,graphic:r}=e,s=new We.a({view:a,geometry:Ne(r)?r.geometry:null,elevationInfo:Object(m.d)(r),attached:!1});return function(e,t,i,a){(function(e,t,i,a){const{view:r,graphic:s}=e;let o=null;const l=()=>{Object(n.k)(o)&&(o.remove(),o=null),i.isDraped&&Ne(s)&&(o=function(e,t,i){const a=e.elevationProvider.spatialReference;Object(q.o)(t,Ye,a);const r=Ye[0],s=Ye[1];return e.elevationProvider.on("elevation-change",e=>{Object(Ze.f)(e.extent,r,s)&&i()})}(r,s.geometry,()=>{t.geometry=s.geometry})),t.geometry=Ne(s)?s.geometry:null};a.push(i.on("changed",l),Object(Se.d)(()=>o)),l()})(e,t,i,a),H.visualElements.pointGraphics.outline.apply(t),a.push(Object(u.init)(i,"displaying",()=>t.attached=i.displaying))}(e,s,t,i),i.push(Object(Se.a)(s)),s}(e,a,r);return function(e,t,i,a){const{view:r,graphic:s}=e,n=new He.a({view:r,extensionType:H.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});H.visualElements.zVerticalLine.apply(n);const o=new ae.a({view:r,intersectsLineInfinite:!0,attached:!1});H.visualElements.pointGraphics.shadowStyle.apply(o);const l=Object(ze.d)(H.visualElements.heightPlaneAngleCutoff),c=new ae.a({view:r,attached:!1,angleCutoff:l});H.visualElements.heightPlane.apply(c);const h=Object(m.d)(e.graphic),p=Y.a.fromElevationInfo(h),d="on-the-ground"===h.mode||!h.offset&&"absolute-height"!==h.mode,u=new Fe;let g=1,b=1;const v=()=>{u.update(e);const i=d&&(t.isDraped||!Ne(s)||!s.geometry.hasZ);let l=!0;if(!i&&Ne(s)){const e=s.geometry,t=Object(ge.c)(s.geometry,r.elevationProvider,p,r.renderCoordsHelper);Object(F.v)(Ye,e.x,e.y,t),Object(q.r)(Ye,e.spatialReference,Ye,r.renderCoordsHelper.spatialReference),n.setStartEndFromWorldDownAtLocation(Ye),o.intersectsWorldUpAtLocation=Ye}else l=!1;const h=2&u.grabbingState?H.visualElements.laserlineAlphaMultiplier:1;h!==g&&(g=h,H.visualElements.heightPlane.apply(c,h));const m=Object(L.e)(Xe);!i&&t.displaying&&a.calculateMapBounds(m)&&Object(q.r)(Object(L.m)(m,Ye),r.spatialReference,Ye,r.renderCoordsHelper.spatialReference)?(c.heightManifoldTarget=Ye,c.attached=!0):c.attached=!1;const v=4&u.grabbingState?H.visualElements.laserlineAlphaMultiplier:1;v!==b&&(b=v,H.visualElements.pointGraphics.shadowStyle.apply(o,v));const O=l&&t.displaying&&!i;o.attached=O,n.attached=O};i.push(t.watch(["displaying","isDraped"],v),t.on("changed",v)),e.forEachManipulator(e=>{i.push(e.events.on("grab-changed",v))}),i.push(Object(Se.a)(o)),i.push(Object(Se.a)(n)),i.push(Object(Se.a)(c)),v()}(e,a,r,s),r.push(t.trackGraphicState(a)),{visualElement:s,remove(){Object(Se.b)(r).remove()}}}(e);case"polygon":case"polyline":return function(e){const{view:t,graphic:i}=e,a=new ye({graphic:i}),r=function(e,t){const{view:i,graphic:a}=e,r=new ce({view:i,geometry:Ue(a)?a.geometry:null,elevationInfo:Object(m.d)(a),attached:!1});H.visualElements.lineGraphics.shadowStyle.apply(r);const s=()=>{r.attached=t.displaying};H.visualElements.lineGraphics.outline.apply(r);const n=[t.watch("displaying",s),t.watch("isDraped",e=>r.isDraped=e),t.on("changed",()=>r.geometry=Ue(a)?a.geometry:null),Object(Se.a)(r)];return s(),{visualElement:r,remove:()=>Object(Se.b)(n).remove()}}(e,a),s=[r,qe(e,r.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:r.visualElement,remove:()=>Object(Se.b)(s).remove()}}(e);default:return null}}const Qe=[1,.5,0],Je=Math.ceil(70/3*2),$e=5*Math.PI/12,et=1*Math.PI/3;function tt(e,t,i){const a=e.graphic,r=(e,i)=>t({action:e,graphic:a,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i((e,t,i)=>{const s=t.next(e=>("start"===e.action&&r("start",e),e)).next(Object(Re.g)(a)).next(e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&r("update",e);break;case"end":r("end",e)}return e});return i.next(Object(Re.i)(a)).next(()=>{r("end",{screenDeltaX:0,screenDeltaY:0})}),s})}function it(e){if(Object(n.j)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],a=t[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}class at{constructor(){this._available=!0}set location(e){this.forEachManipulator3D(t=>t.location=e)}set elevationAlignedLocation(e){this.forEachManipulator3D(t=>t.elevationAlignedLocation=e)}set elevationInfo(e){this.forEachManipulator3D(t=>t.elevationInfo=e)}get available(){return this._available}set available(e){this._available=e,this.forEachManipulator3D(t=>t.available=e)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(t=>t===e)}someManipulator(e){let t=!1;return this.forEachManipulator(i=>{!t&&e(i)&&(t=!0)}),t}forEachManipulator3D(e){this.forEachManipulator((t,i)=>{t instanceof Be.a&&e(t,i)})}}var rt=i("8JEK"),st=i("024p"),nt=i("tKWm");class ot extends at{constructor(e){super(),this._handles=new Ee.a,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this.createMaterial(),this._transparentMaterial=this.createMaterial(.5),this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new p.a,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){this._arrowManipulatorInfos.map(({manipulator:t})=>e(t,1))}createGraphicDragPipeline(e,t,i){const a=t.graphic,r=Object(m.d)(a),s=Object(n.q)(a.geometry).spatialReference;return tt(t,i,t=>this.createDragPipeline((i,a,r,s,n)=>t(i,e(i,a,r,s,n),r),r,s,a))}createDragPipeline(e,t,i,a){return Object(Se.b)(this._arrowManipulatorInfos.map(({manipulator:r},s)=>Object(Re.e)(r,(r,n,o,l,c)=>{const h=n.next(e=>({...e,manipulatorType:1})).next(Object(Re.f)(this._view,r.elevationAlignedLocation)).next(Object(nt.c)(this._view,r.elevationAlignedLocation,t,i,a)).next(Object(Re.d)(r.location,this.angle+(s+1)*Math.PI*.5)).next(Object(Re.c)());e(r,h,o,l,c)})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const a=this._radius/70,r=54*a,s=Math.sqrt(r*r*3/4),n=ue.a.createExtrudedTriangle(s,r/2,r/2,.02);ue.a.transformInPlace(n,Object(Q.t)(rt.a.get(),Object(F.v)(rt.d.get(),0,-s/3,0))),e.renderObjects=[{geometry:n,material:this._opaqueMaterial,stateMask:2},{geometry:n,material:this._transparentMaterial,stateMask:1}],e.radius=s/3*2*1.2;const o=Object(Q.i)(rt.a.get());Object(Q.u)(o,i*Math.PI/2);const l=Object(Q.i)(rt.a.get());Object(Q.t)(l,Object(F.v)(rt.d.get(),0,100*a,0)),Object(Q.l)(t,o,l)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=Object(Q.i)(rt.a.get());Object(Q.q)(t,t,e,Object(B.g)(0,0,1));const i=Object(Q.o)(rt.a.get(),Object(F.v)(rt.d.get(),this.displayScale,this.displayScale,this.displayScale)),a=Object(Q.i)(rt.a.get());Object(Q.l)(a,i,t);for(const r of this._arrowManipulatorInfos){const e=Object(Q.l)(rt.a.get(),a,r.transform);r.manipulator.modelTransform=e}}_createArrowManipulator(e){const t=new Be.a({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(B.g)(0,0,1)}}),i={manipulator:t,transform:Object(J.b)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),i}createMaterial(e=1){const t=y.a.toUnitRGBA(w.main);return t[3]*=e,new st.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:e})=>e)}}}class lt{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new Re.a,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(n.k)(this.lastDragEvent)){const t=this.lastDragEvent.mapEnd,i=this.snap(this.lastDragEvent.screenEnd);Object(n.k)(i)&&this.next.execute({action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd})}this._enabled=e}snap(e){const t=Object(n.k)(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(n.k)(t)&&Object(n.k)(this.view)&&(t.z=Object(m.f)(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this.snap(e.screenEnd);return Object(n.k)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class ct extends at{constructor(e){super(),this._handles=new Ee.a,this._snapToScene=new lt,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=70,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const a=t.graphic,r=Object(m.d)(a),s=Object(n.q)(a.geometry).spatialReference;return tt(t,i,t=>this.createDragPipeline((i,a,r,s,n)=>t(i,e(i,a,r,s,n),r),r,s,a))}createDragPipeline(e,t,i,a){const r=this._view;return Object(Re.e)(this._manipulator,(s,n,o,l,c)=>{const h=n.next(Object(Re.f)(r,s.elevationAlignedLocation)).next(Object(nt.c)(r,s.elevationAlignedLocation,t,i,a)).next(this._snapToScene.createDragEventPipelineStep(r,t),this._snapToScene.next).next(e=>({...e,manipulatorType:1})).next(Object(Re.c)());e(s,h,o,l,c)})}_updateManipulatorTransform(){const e=Object(Q.o)(rt.a.get(),Object(F.v)(rt.d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){this._manipulator=new Be.a({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(B.g)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=ue.a.createCylinderGeometry(.02,1,128,Object(B.g)(0,0,1),Object(B.g)(0,0,0)),t=Object(Q.o)(Object(J.b)(),Object(B.g)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/70*80}_createMaterial(e=1){const t=y.a.toUnitRGBA(w.main);return t[3]*=e,new st.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{discManipulator:this._manipulator}}}class ht extends at{constructor(e){super(),this._handles=new Ee.a,this._radius=70,this.events=new p.a,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this.createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){e(this._manipulator,0)}createGraphicDragPipeline(e,t,i){const a=Object(n.q)(t.graphic.geometry).spatialReference;return tt(t,i,t=>this.createDragPipeline((i,a,r,s,n)=>t(i,e(i,a,r,s,n),r),a))}createDragPipeline(e,t){const i=this._view;return Object(Re.e)(this._manipulator,(a,r,s,n,o)=>{const l=r.next(e=>({...e,manipulatorType:0})).next(Object(nt.g)(i,a.renderLocation,t)).next(Object(Re.c)());e(a,l,s,n,o)})}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}updateManipulator(){const e=this._radius/70,t=H.zManipulator.height*e,i=H.zManipulator.coneHeight*e,a=H.zManipulator.coneWidth*e,r=H.zManipulator.width*e,s=[Object(B.g)(0,0,0),Object(B.g)(0,0,t)],n=ue.a.createTubeGeometry(s,r/2,16,!1),o=ue.a.createConeGeometry(i,a/2,16,!1),l=[Object(B.g)(0,0,0),Object(B.g)(0,0,t+i)],c=(e=>{const i=Object(J.b)();return Object(Q.s)(i,i,[0,0,t]),Object(Q.e)(i,i,Math.PI/2),i})(),h=(e,t)=>{const i=Object(j.a)(H.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,H.zManipulator.color.a*e]},p=Object(ke.c)(h(1,.25),1),d=Object(ke.c)(h(1,0),1),u=Object(ke.c)(h(.7,0),H.zManipulator.renderOccluded),g=Object(ke.c)(h(.85,0),H.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:o,transform:c,material:p,stateMask:1},{geometry:n,material:p,stateMask:1},{geometry:o,transform:c,material:d,stateMask:2},{geometry:n,material:d,stateMask:2},{geometry:o,transform:c,material:u,stateMask:1},{geometry:n,material:u,stateMask:1},{geometry:o,transform:c,material:g,stateMask:2},{geometry:n,material:g,stateMask:2}],this._manipulator.radius=r/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}createManipulator(){const e=new Be.a({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=pt;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=Object(F.z)(t.eye,i),r=t.computeRenderPixelSizeAtDist(a),s=Object(F.i)(dt,i,t.eye);Object(F.q)(s,s);const n=ut;this._view.renderCoordsHelper.worldUpAtPosition(pt,n);const o=Math.abs(Object(F.g)(s,n)),l=Object(F.f)(dt,s,n),c=Object(F.f)(dt,l,n),h=Object(ze.c)(o,.01,1),p=1-Math.sqrt(1-h*h)/h/t.fullWidth,d=H.zManipulator.width*(this._radius/70);Object(F.d)(c,Object(F.q)(c,c),(1/p-1)*a+r*d),e[12]-=dt[0],e[13]-=dt[1],e[14]-=dt[2]},this._manipulator=e,this.updateManipulator()}}const pt=Object(B.e)(),dt=Object(B.e)(),ut=Object(B.e)();class gt extends at{constructor(e){super(),this._handles=new Ee.a,this._angleDeferred=null,this._interactive=!0;const{tool:t,view:i,snapToScene:a,radius:r}=e;this._view=i,this.xyManipulation=new ct({tool:t,view:i,snapToScene:a,radius:r}),this.xyAxisManipulation=new ot({tool:t,view:i,radius:r}),this.zManipulation=new ht({tool:t,view:i,radius:r}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this.autoHideXYAxis(),this.forEachManipulator(e=>{this._handles.add(e.events.on("grab-changed",()=>this.updateManipulatorInteractivity()))})}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return Object(Se.b)([this.xyManipulation.createGraphicDragPipeline((t,i,a,r,s)=>e(0,t,i,a,r,s),t,i),this.xyAxisManipulation.createGraphicDragPipeline((t,i,a,r,s)=>e(1,t,i,a,r,s),t,i),this.zManipulation.createGraphicDragPipeline((t,i,a,r,s)=>e(2,t,i,a,r,s),t,i)])}createDragPipeline(e,t,i,a){return Object(Se.b)([this.xyManipulation.createDragPipeline((t,i,a,r,s)=>e(0,t,i,a,r,s),t,i,a),this.xyAxisManipulation.createDragPipeline((t,i,a,r,s)=>e(1,t,i,a,r,s),t,i,a),this.zManipulation.createDragPipeline((t,i,a,r,s)=>e(2,t,i,a,r,s),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator(t=>e(t,1)),this.xyAxisManipulation.forEachManipulator(t=>e(t,1)),this.zManipulation.forEachManipulator(t=>e(t,0))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator(e=>e.focused)||this.xyAxisManipulation.someManipulator(e=>e.focused);return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(Object(s.a)("esri-mobile"))return;const i=[];t.forEachManipulator(e=>i.push(e)),e.forEachManipulator(e=>i.push(e));const a=()=>{const t=[];this.xyAxisVisible?Object(n.k)(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator(e=>t.push(e.disableDisplay())),this._handles.remove(bt),this._handles.add(t,bt)};for(const r of i)this._handles.add(r.events.on("focus-changed",a));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",a)),a()}updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator(t=>{t.interactive=!e&&this._interactive||t.grabbing})}static radiusForSymbol(e){const t=Object(n.k)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some(e=>"icon"===e.type)?Je:70}}const bt="disable-xy-axis-display";var mt=i("PN7H");class vt extends at{constructor(e){super(),this._handles=new Ee.a,this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,1)}createGraphicDragPipeline(e){return tt(this._graphicState,e,e=>this.createDragPipeline(e))}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,a=Object(n.k)(i.geometry)?i.geometry.spatialReference:null;return Object(Re.e)(this._manipulator,(r,s,n,o,l)=>{const c=s.next(Object(nt.d)(l,t,i,a)).next(Object(Re.b)()).next(Object(Re.c)());e(r,c,n,o,l)})}_createManipulator(){this._manipulator=new mt.a({graphic:this._graphicState.graphic,view:this._view,selectable:!0,cursor:"move"})}}class Ot{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class ft{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class yt{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let jt=class extends(p.a.EventedMixin(O.a)){constructor(e){super(e),this.graphics=new Pe.a,this.enableZ=!0,this.type="move-3d",this._toolHandles=new Ee.a,this._handles=new Ee.a,this.snappingPipeline=new Ce.a}initialize(){this._toolHandles.add([this.graphics.on("change",()=>this._refreshManipulators())]),this._refreshManipulators()}destroy(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}reset(){}_refreshManipulators(){this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter(e=>0===Object(Ie.a)(e)).map(e=>new _t(e));e.length&&(this.createManipulators(e),this.createVisualElements(e),this._handles.add(e.map(e=>this.view.trackGraphicState(e.state))),this.updateMoveManipulation(e))}createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new vt({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator(e=>this._handles.add(e.events.on("immediate-click",e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()}))),this._handles.add(t.manipulationXY.createDragPipeline((t,i,a,r)=>this.buildDragEventPipeline(e,0,t,i,a,r)))}this.createMoveManipulation(e)}createMoveManipulation(e){const t=new gt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?gt.radiusForSymbol(e[0].graphic.symbol):70});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator(e=>{this._handles.add(e.events.on("immediate-click",i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()}))});const i=()=>this.updateMoveManipulation(e);for(const r of e)this._handles.add([r.state.on("changed",i),r.state.watch("displaying",i)]);const a=e[e.length-1];this._handles.add(a.state.on("changed",()=>this.updateMoveManipulationAngle(a))),this._handles.add(t.createDragPipeline((t,i,a,r,s)=>this.buildDragEventPipeline(e,t,i,a,r,s),Object(m.d)(a.graphic),Object(n.q)(a.graphic.geometry).spatialReference,a.graphic)),this.updateMoveManipulationAngle(a)}createVisualElements(e){for(const t of e){const i=Ke({view:this.view,graphic:t.graphic,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>Object(Se.c)()});t.geometryRepresentation=i.visualElement,t.geometryRepresentation instanceof ce&&this._handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",()=>{t.state.isDraped||this.updateMoveManipulation(e)}),t.state.watch("isDraped",()=>this.updateMoveManipulation(e))]),this._handles.add(i)}}updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>it(e.graphic.geometry)}updateMoveManipulation(e){const t=Object(W.d)(0,0,0,this.view.spatialReference);let i=0,a=!1;const r=this._moveManipulation;for(const s of e){if(!s.state.displaying)continue;const e=s.state.graphic;this.enableZ&&Ve(e)&&(a=!0);const r=s.geometryRepresentation instanceof ce&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:Object(ke.f)(this.view,e);Object(n.k)(r)&&(t.x+=r.x,t.y+=r.y,t.z+=r.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,r.location=t,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=a):r.available=!1}buildDragEventPipeline(e,t,i,a,r,s){const n=[],o=[];let l=null,c=null;const h=()=>{for(const e of n)e.dragging=!1;n.length=0,o.length=0,l=null,c=null,this._moveManipulation.interactive=!0};if(1===e.length&&0===t){const t=e[0].graphic;a=this.buildSnappingPipelineSteps(t,Object(m.d)(t),a,r,s)}const p=a.next(t=>{if("start"===t.action){n.length=0,o.length=0;for(const t of e)t.dragging||!t.manipulationXY.hasManipulator(i)&&t.manipulationXY.grabbing||(n.push(t),o.push(t.graphic),t.dragging=!0);if(0!==o.length&&(this._moveManipulation.interactive=!1,l=Object(Re.h)(o),c=Object(Re.j)(o),this.emit("graphic-move-start",new Ot(o)),this.destroyed))return null}return 0!==o.length?t:null}).next(e=>l(e)).next(e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd);if(this.emit("graphic-move",new ft(i.x-t.x,i.y-t.y,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new yt(o)),this.destroyed)return null;h()}});return r.next(e=>c(e)).next(()=>{if(this.emit("graphic-move-stop",new yt(o)),this.destroyed)return null;h()}),p}buildSnappingPipelineSteps(e,t,i,a,r){const s=e.geometry;if(Object(n.j)(s)||"point"!==s.type)return i;const o=new Ge.a({elevationInfo:t,pointer:r,geometry:new De.a(Ae.c.fromGeometry(s,this.view.viewingMode),"point"),visualizer:new Te.a,excludeFeature:e}),l=this.snappingManager;return i.next(t=>{const i=s.clone();return i.z=Object(m.a)(this.view,i,Object(m.d)(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:o.coordinateHelper.fromPoint(i)}}).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:o,snappingManager:l,cancel:a}),this.snappingPipeline.next)}};Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],jt.prototype,"view",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],jt.prototype,"graphics",void 0),Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],jt.prototype,"enableZ",void 0),Object(r.a)([Object(c.b)({constructOnly:!0})],jt.prototype,"snappingManager",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],jt.prototype,"type",void 0),jt=Object(r.a)([Object(h.a)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],jt);class _t{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new ye({graphic:e})}get graphic(){return this.state.graphic}}var Mt=i("JAyX");let wt=class extends p.a.EventedAccessor{constructor(e){super(e),this._vertexManipulatorMaterial=Object(ke.c)(H.colorToVec4(H.reshapeManipulators.vertex.color),H.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=Object(ke.d)(H.colorToVec4(H.reshapeManipulators.vertex.outlineColor),H.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Object(ke.d)(H.colorToVec4(H.reshapeManipulators.vertex.hoverOutlineColor),H.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=Object(ke.c)(H.colorToVec4(H.reshapeManipulators.edge.color),H.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=Object(ke.d)(H.colorToVec4(H.reshapeManipulators.edge.outlineColor),H.reshapeManipulators.edge.renderOccluded),this._selectedManipulatorMaterial=Object(ke.c)(H.colorToVec4(H.reshapeManipulators.selected.color),H.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=Object(ke.d)(H.colorToVec4(H.reshapeManipulators.selected.outlineColor),H.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Object(ke.d)(H.colorToVec4(H.reshapeManipulators.selected.hoverOutlineColor),H.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._handles=new Ee.a,this._manipulatorHandles=new Ee.a,this._manipulatorInfos=[],this._reshapeHelper=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._snappingPipeline=new Ce.a,this._snappingPipelineHandle=new Ce.a,this._vertexLaserLineVisualElement=null}initialize(){const e=new ye({graphic:this.graphic});this._graphicState=e,this._handles.add([e.watch("displaying",e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e}),this.view.trackGraphicState(e)])}destroy(){this._clear(),this._handles.destroy()}get inputGeometry(){return Object(n.k)(this._reshapeHelper)?this._reshapeHelper.geometry:null}set inputGeometry(e){this._recreateManipulators(e)}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZ(){return this.tool.enableZ}get enableMoveGraphic(){return this.tool.enableMoveGraphic}removeSelectedVertices(){const e=this._manipulatorInfos.filter(e=>e.manipulator.selected&&"vertex"===e.handle.type);this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_clear(){this._moveManipulation=Object(n.e)(this._moveManipulation),this._graphicMoveManipulation=Object(n.e)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._reshapeHelper=Object(n.e)(this._reshapeHelper),this._numGrabbing=0,this._numDragging=0}_recreateManipulators(e=this.inputGeometry){if(this._clear(),Object(n.j)(e))return;Object(n.e)(this._reshapeHelper),this._reshapeHelper=new Rt(Ae.c.fromGeometry(e,this.view.viewingMode),e.type);const t=Object(m.d)(this.graphic);for(const i of this._reshapeHelper.editGeometry.components){for(const e of i.vertices)this._createPerVertexManipulator(e,t);for(const e of i.edges)this._createPerVertexManipulator(e,t)}this._createGraphicMoveManipulators(t)}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return;const i=[],a=this._manipulatorInfos.some(e=>"vertex"===e.handle.type&&e.manipulator.selected),r=1===e&&a,s=Object(n.q)(this._reshapeHelper);for(const l of this._manipulatorInfos)"vertex"===l.handle.type&&(l.manipulator.grabbing||r&&!l.manipulator.selected||(Object(n.q)(s).moveVertices([l.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),i.push(l.handle.pos),this._updateManipulatorPosition(l)));if(0===i.length)return;let o=0;for(const n of this._manipulatorInfos)"vertex"===n.handle.type&&o++;if(this.outputGeometry=s.geometry,i.length===o){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)St(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;const t=e.mapDeltaX,i=e.mapDeltaY,a=e.mapDeltaZ;if(!t&&!i&&!a)return;const r=[];for(const n of this._manipulatorInfos)St(n)&&(n.manipulator.selected&&!n.manipulator.grabbing||n===e.info)&&r.push(n);const s=Object(n.q)(this._reshapeHelper);for(const n of r)s.moveVertices([n.handle],t,i,a);this.outputGeometry=s.geometry;for(const n of r)this._updateManipulatorPosition(n);this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){this._graphicMoveManipulation=new vt({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic?this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((e,t,i)=>{t.next(e=>this._trackNumDragging(e)).next(e=>{this._perGraphicManipulatorDragAction(0,e)}),i.next(this._cancelDragOperation())})):this._graphicMoveManipulation.forEachManipulator(e=>{e.grabbable=!1,e.cursor=null}),this._graphicMoveManipulation.forEachManipulator(e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",e=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})])),this._moveManipulation=new gt({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Ve(this.graphic),snapToScene:!1,radius:gt.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator(e=>{this._handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some(e=>e.manipulator.selected)||this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()})])}),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const t=Object(n.q)(this.graphic.geometry).spatialReference;this._handles.add([this._moveManipulation.createDragPipeline((t,i,a,r,s)=>{const o=a.next(e=>this._trackNumDragging(e)).next(e=>{const t=this._manipulatorInfos.filter(e=>St(e)&&e.manipulator.selected);return 1===e.manipulatorType&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:{...e,info:null}}).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:r,snappingManager:this.tool.snappingManager,snappingContext:new Ge.a({geometry:Object(n.q)(this._reshapeHelper),elevationInfo:e,pointer:s,excludeFeature:this.graphic,visualizer:new Te.a})}),this._snappingPipelineHandle.next).next(Object(Re.b)()).next(e=>(this._perGraphicManipulatorDragAction(1,e),e));return r.next(this._cancelDragOperation()),o},e,t,this.graphic),Object(u.init)(this._graphicState,"displaying",()=>{this._updateMoveManipulationPosition()}),this._graphicState.on("changed",()=>this._updateMoveManipulationPosition()),Object(u.init)(this._graphicState,"isDraped",()=>{const e="align-move-manipulation";this._graphicState.isDraped?this._handles.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),e):this._handles.remove(e)})]),this._updateMoveManipulationPosition();const i=Ke({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){Object(n.k)(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,1);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});this._outlineVisualElement=i.visualElement instanceof ce?i.visualElement:null,Object(n.k)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}),this._graphicState.watch("isDraped",()=>this._updateMoveManipulationPosition())]),this._manipulatorHandles.add(i)}_createPerVertexManipulator(e,t=Object(m.d)(this.graphic)){if(Object(n.j)(this._vertexManipulatorGeometry)||Object(n.j)(this._vertexManipulatorOutlineGeometry)){const e=H.reshapeManipulators.vertex,t=e.size/2,i=t+e.collisionPadding;this._vertexManipulatorGeometry=ue.a.createSphereGeometry(t/i,16,16),this._vertexManipulatorOutlineGeometry=ue.a.createSphereGeometry((t+e.outlineSize)/i,16,16)}if(Object(n.j)(this._edgeManipulatorGeometry)||Object(n.j)(this._edgeManipulatorOutlineGeometry)){const e=H.reshapeManipulators.edge,t=e.size/2,i=t+e.collisionPadding;this._edgeManipulatorGeometry=ue.a.createSphereGeometry(t/i,16,16),this._edgeManipulatorOutlineGeometry=ue.a.createSphereGeometry((t+e.outlineSize)/i,16,16)}const i=new Be.a({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|Dt.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|Dt.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Dt.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|Dt.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Dt.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|Dt.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|Dt.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(i,e,t);const a="edge"===e.type?{manipulator:i,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:i,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(a),this.manipulators.add(i),this._updateManipulatorPosition(a),"edge"===a.type){const e=this._getManipulatorInfoFromHandle(a.handle.left).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(a)),t=this._getManipulatorInfoFromHandle(a.handle.right).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(a));a.locationUpdateHandle=Object(Se.b)([e,t]),this._manipulatorHandles.add(a.locationUpdateHandle,i)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(i,!0),i);const r=Object(Re.e)(i,(e,i,r,s)=>{i.next(e=>this._trackNumDragging(e)).next(e=>{if(Pt(a)){const t=this._splitEdgeManipulator(a);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:a,snapOrigin:a.handle.pos}}).next(Object(Re.f)(this.view,e.elevationAlignedLocation)).next(Object(nt.e)(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this.isMultiVertexSelection(),cancel:r,snappingManager:this.tool.snappingManager,snappingContext:new Ge.a({geometry:Object(n.q)(this._reshapeHelper),elevationInfo:t,pointer:s,excludeFeature:this.graphic,visualizer:new Te.a})}),this._snappingPipeline.next).next(Object(Re.b)()).next(e=>{this._perVertexManipulatorDragAction(e)}),r.next(this._cancelDragOperation())});return this._manipulatorHandles.add(r,i),this._manipulatorHandles.add([i.events.on("immediate-click",e=>this._manipulatorClickCallback(e,a)),i.events.on("select-changed",()=>{a.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})]),this.emit("manipulators-changed"),i}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(){const e=Object(n.k)(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return()=>{switch(this._numDragging--,this.inputGeometry=e,this.outputGeometry=e,Object(n.k)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}this.destroyed||this._updateEventState(0)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=Dt.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=H.reshapeManipulators.vertex.size/2+H.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i;break;case"edge":e.state=Dt.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=H.reshapeManipulators.edge.size/2+H.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"===i.mode?i:{mode:"absolute-height",offset:0}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing})}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=Object(n.q)(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.editGeometry.coordinateHelper.toPoint(e.handle.pos,Et),e.manipulator.grabbing&&Object(n.k)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){const i=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,a=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if(Object(n.k)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const r=i.location,s=a.location,n=.5,o=r.x+n*(s.x-r.x),l=r.y+n*(s.y-r.y),c=r.hasZ&&s.hasZ?0:void 0;e.manipulator.location=Object(W.d)(o,l,c,t.geometry.spatialReference)}else Object(F.h)(At,i.renderLocation,a.renderLocation,.5),e.manipulator.renderLocation=At}}_splitEdgeManipulator(e){const t=Object(n.q)(this._reshapeHelper),i=Object(n.q)(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const a=e;a.handle=i,a.type="vertex";const r=Object(m.d)(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r),i.left&&this._createPerVertexManipulator(i.left),i.right&&this._createPerVertexManipulator(i.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(a),this._updateSelection(e.manipulator);const s=this._updateEventState(2),o=t.editGeometry.coordinateHelper.toArray(a.handle.pos),l=t.editGeometry.components.indexOf(i.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:o,componentIndex:l,vertexIndex:Object(n.q)(i.index)}],added:o}),s&&this._updateEventState(0),a}_updateMoveManipulationPosition(){const e=rt.d.get();Object(F.v)(e,0,0,0);let t=0,i=!1,a=null,r=null;for(const s of this._manipulatorInfos)St(s)&&(s.manipulator.selected?(t++,Object(F.e)(e,e,s.manipulator.renderLocation),Object(n.j)(a)||s.selectedIndex>a.selectedIndex?(r=a,a=s):(Object(n.j)(r)||s.selectedIndex>r.selectedIndex)&&(r=s)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&Ve(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&Ve(this.graphic)}if(0!==t){let e=0;if(Object(n.k)(a)){const t=a.handle.pos,i=Object(n.k)(r)?r.handle.pos:a.handle.left&&a.handle.left.left?a.handle.left.left.pos:null,s=!Object(n.k)(r)&&a.handle.right&&a.handle.right.right?a.handle.right.right.pos:null;i&&s?this._moveManipulation.xyAxisManipulation.available=!1:i?e=xt(i,t):s&&(e=xt(t,s))}this._moveManipulation.angle=e,this._moveManipulation.radius=Je}else this._moveManipulation.angleDeferred=()=>it(Object(n.q)(this.graphic.geometry)),this._moveManipulation.radius=gt.radiusForSymbol(this.graphic.symbol);0!==t&&i?(Object(F.d)(e,e,1/t),Et.spatialReference=Object(n.q)(this._reshapeHelper).geometry.spatialReference,Et.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Et),this._moveManipulation.elevationAlignedLocation=Et):Object(n.k)(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(n.k)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Object(ke.g)(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=Object(n.q)(this._reshapeHelper);for(const a of e)if("vertex"===a.handle.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.right));const e=Object(n.q)(i.removeVertices([a.handle]).removedVertices[0].createdEdge);e&&this._createPerVertexManipulator(e)}if(t.length>0){const e=t.map(e=>{const t=i.editGeometry.components.indexOf(e.component);return{coordinates:i.editGeometry.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:Object(n.q)(e.index)}});this.outputGeometry=i.geometry;const a=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map(e=>e.coordinates),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),Pt(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}};function xt(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function St(e){return"vertex"===e.handle.type}function Pt(e){return"edge"===e.handle.type}Object(r.a)([Object(c.b)({constructOnly:!0})],wt.prototype,"tool",void 0),Object(r.a)([Object(c.b)()],wt.prototype,"inputGeometry",null),Object(r.a)([Object(c.b)()],wt.prototype,"outputGeometry",void 0),wt=Object(r.a)([Object(h.a)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],wt);const Et=Object(W.d)(0,0,null,null),At=Object(B.e)();var Dt,Gt;(Gt=Dt||(Dt={})).Vertex=16,Gt.Edge=32;class Rt extends De.a{constructor(e,t){super(e,t),this.type=t,this._geometry=null}get geometry(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.editGeometry.toPolyline();break;case"polygon":this._geometry=this.editGeometry.toPolygon()}this._dirty=!1}return this._geometry}}let Ct=class extends(p.a.EventedMixin(O.a)){constructor(e){super(e),this._handles=new Ee.a,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZ=!0,this.enableMoveGraphic=!0,this.type="reshape-3d",this.snappingManager=null}destroy(){this._handles.removeAll(),this._reshapeOperation=Object(n.e)(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}get selectionManagementDisabled(){return!0}_updateGeometry(){const e=this.graphic.geometry;this._reshapeOperation.inputGeometry=0!==Object(Mt.a)(this.graphic)||!Object(n.k)(e)||"polygon"!==e.type&&"polyline"!==e.type?null:e.clone()}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==Object(Mt.a)(this.graphic))return;const e=this.watch("graphic.geometry",()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()},!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_onReshapeGeometryChanged(){Object(n.j)(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)}initialize(){this._reshapeOperation=new wt({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)}),this._reshapeOperation.on("move",e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)}),this._reshapeOperation.on("vertex-add",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)}),this._reshapeOperation.on("vertex-remove",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)}),this._reshapeOperation.on("immediate-click",e=>this.emit("immediate-click",e)),Object(u.init)(this,"graphic",()=>{this._updateGraphic()},!0)])}beforeUndo(){Object(n.k)(this.snappingManager)&&this.snappingManager.doneSnapping()}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager}}};Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Ct.prototype,"view",void 0),Object(r.a)([Object(c.b)({constructOnly:!0})],Ct.prototype,"graphic",void 0),Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Ct.prototype,"enableZ",void 0),Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Ct.prototype,"enableMoveGraphic",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],Ct.prototype,"type",void 0),Object(r.a)([Object(c.b)({constructOnly:!0})],Ct.prototype,"snappingManager",void 0),Ct=Object(r.a)([Object(h.a)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Ct);var Tt,kt,It=i("QhKk"),Vt=i("WBXD"),zt=i("qRWG"),Ht=i("0Kx6");(kt=Tt||(Tt={})).ScaleIn=32,kt.ScaleOut=64,kt.RotateLeft=128,kt.RotateRight=256,kt.Unlocked=1024,kt.DelayedFocused=2048,kt.TouchInput=32768;class Bt{constructor(e){this.mode=null,this._handles=new Ee.a,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new p.a,this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>Object(n.k)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._scaleRotateDragData.scale:1,this.tool=e.tool,this.mode=e.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}destroy(){Object(n.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=Object(Vt.a)({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){Object(n.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)}forEachManipulator(e){e(this.ringManipulator,4)}createManipulator(){this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);const e=this.ringManipulator,t=this.tool.graphicState.graphic,i=Object(Re.e)(e,(e,i,a)=>{this._scaleRotateDragData=null;const r=function(e,t){const i=e.allLayerViews.find(e=>e.layer===t.layer);if(Object(n.j)(t.symbol))return null;const a=t.symbol;return{symbolLayers:a.symbolLayers.map(e=>{let t=null,r=null;return"object"===e.type&&(t=e.heading),r=i.getSymbolLayerSize(a,e),{heading:t,size:r}}).toArray()}}(this.tool.view,t);if(Object(n.j)(r))return this.updateDragState(),null;const s={mode:"none",origin:Object(B.d)(e.renderLocation),angle:0,startAngle:this.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:r};this._scaleRotateDragData=s,this.updateDragState();const o=rt.d.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),i.next(Object(nt.f)(this.tool.view,Ht.e.fromPositionAndNormal(e.renderLocation,o))).next(e=>{const i=Ht.e.normal(e.plane),a=Object(ke.a)(e.renderStart,e.renderEnd,s.origin,i),r=K.c.shortestSignedDiff(s.angle,a);s.angleDir=Object(ze.c)(s.angleDir+r,-.3,.3),s.angle=a;const o=function(e,t){const i=Object(F.i)(rt.d.get(),t.renderStart,e.origin),a=Object(F.i)(rt.d.get(),t.renderEnd,e.origin),r=Object(F.o)(i),s=Object(F.o)(a);return 0===r?0:s/r}(s,e),l=o-s.scale;if(s.scaleDir=Object(ze.c)(s.scaleDir+l,-.2,.2),s.scale=o,this.onScaleChanged(),"none"===s.mode){const i=this.mode||function(e,t,i,a){const{renderStart:r,renderEnd:s}=e,n=Ft(r,a,rt.d.get()),o=Ft(s,a,rt.d.get());if(Object(F.k)(n,o)<100)return null;const l=Object(F.i)(rt.d.get(),r,i),c=Object(F.f)(rt.d.get(),l,t),h=r,p=Object(F.e)(rt.d.get(),h,c),d=Ft(i,a,rt.d.get()),u=n,g=Ft(p,a,rt.d.get()),b=Object(F.i)(rt.d.get(),g,u),m=Object(F.i)(rt.d.get(),n,d),v=Ht.f.wrap(u,b),O=Ht.f.wrap(d,m);return Ht.f.distance2(v,o)<Ht.f.distance2(O,o)?"rotate":"scale"}(e,e.plane,s.origin,this.tool.view.state.camera);if(Object(n.k)(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:Object(ze.n)(s.angle)});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:s.scale,yScale:s.scale})}s.mode=i}}if(this.updateDragState(),Object(n.k)(t.symbol)){const e=t.symbol.clone();let i=0,a=1;switch(s.mode){default:case"none":break;case"scale":a=s.scale;break;case"rotate":i=s.angle}this.applySymbolData(e,s.startSymbolData,i,a),t.symbol=e,this.updateManipulatorTransform()}switch(e.action){case"start":case"update":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:Object(ze.n)(s.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:s.scale,yScale:s.scale})}break;case"end":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Object(ze.n)(s.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:s.scale,yScale:s.scale});break;default:case"none":}}"end"===e.action&&(this.startAnimation(qt(this,()=>this.onScaleChanged())),this._scaleRotateDragData=null,this.updateDragState())}),a.next(Object(Re.l)(t)).next(()=>{if(Object(n.k)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Object(ze.n)(this._scaleRotateDragData.startAngle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(qt(this,()=>this.onScaleChanged())),this._scaleRotateDragData=null}})});this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",e=>{"focus"===e.action?this.startAnimation(function(e,t){let i=0,a=null;const r=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=r,i=0,t()},update:e=>(i+=e,!a()||i>200?1:0),destroy:()=>{e.getFocused=a,t()}}}(this,()=>this.updateDelayedFocusedState())):this.updateDelayedFocusedState()}),this.ringManipulator.events.on("immediate-click",e=>{e.stopPropagation()}),Object(u.init)(this.tool.graphicState,"displaying",e=>this.ringManipulator.available=e),this.tool.graphicState.on("changed",()=>Object(ke.g)(this.tool.view,this.ringManipulator,t))]),Object(ke.g)(this.tool.view,this.ringManipulator,t)}onScaleChanged(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(Tt.DelayedFocused,this.getFocused())}updateDragState(){if(this.ringManipulator.updateStateEnabled(Tt.Unlocked,!(Object(n.k)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(n.k)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Tt.ScaleIn|Tt.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Tt.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Tt.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Tt.RotateLeft|Tt.RotateRight,!1),this.ringManipulator.updateStateEnabled(Tt.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Tt.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Tt.ScaleIn|Tt.ScaleOut|Tt.RotateLeft|Tt.RotateRight,!1)}updateManipulatorTransform(){const e=Object(Q.i)(rt.a.get()),t=this.tool.symbolRotationAngle;Object(Q.q)(e,e,t,Object(B.g)(0,0,1));const i=this.getScale(),a=Object(Q.o)(rt.a.get(),Object(F.v)(rt.d.get(),i,i,i)),r=Object(Q.i)(rt.a.get());Object(Q.l)(r,a,e),this.ringManipulator.modelTransform=r}createRingManipulator(){const e=(e,t,i)=>{const a=[],r=Math.ceil(128*(t-e)/(2*Math.PI));for(let s=0;s<r+1;s++){const n=e+s*(t-e)/r;a.push(Object(B.g)(i*Math.cos(n),i*Math.sin(n),0))}return a},t=t=>e(0,2*Math.PI,t),i=(e,t)=>ue.a.createPathExtrusionGeometry((e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),a=t(160),r=i(a,24),s={left:[],right:[]},n=[];for(let m=0;m<2;m++){const t=m*Math.PI-Math.PI/4,a=Math.PI/2-$e,r=t+a,o=t+Math.PI/2-a,l=e(r,o,190),c=i(l,9);n.push(l),n.push(e(r,o,201)),s.left.push(c),s.right.push(c);for(let e=0;e<2;e++){const t=0===e,i=Object(J.b)();if(t){Object(Q.r)(i,i,[1,-1,1]),Object(Q.q)(i,i,-r,[0,0,1]);const e=Math.round(.2*(l.length-1));i[12]=l[e][0],i[13]=l[e][1],i[14]=l[e][2]}else{Object(Q.q)(i,i,o,[0,0,1]);const e=Math.round(.8*(l.length-1));i[12]=l[e][0],i[13]=l[e][1],i[14]=l[e][2]}const a=ue.a.createExtrudedTriangle(60,0,23,.5);ue.a.transformInPlace(a,i),(t?s.left:s.right).push(a)}}const o=[];for(let m=0;m<2;m++){const t=m*Math.PI-Math.PI/4,a=Math.PI/2-et,r=t+Math.PI/2-a,s=e(t+a,r,213);o.push(i(s,9))}const l=t(190),c=t(213),h=i(l,9),p=i(c,9),d=t(130),u=t(107),g=i(d,9),b=i(u,9),v=this.createMaterial(),O=this.createMaterial(.66),f=this.createMaterial(.5),y=this.createMaterial(.33);let j=[{geometry:r,material:v,stateMask:Tt.DelayedFocused},{geometry:r,material:f,stateMask:0}];this.mode&&"scale"!==this.mode||(j=j.concat([{geometry:o,material:v,stateMask:Tt.DelayedFocused|Tt.Unlocked},{geometry:h,material:O,stateMask:Tt.DelayedFocused|Tt.ScaleIn},{geometry:p,material:y,stateMask:Tt.DelayedFocused|Tt.ScaleIn},{geometry:g,material:O,stateMask:Tt.DelayedFocused|Tt.ScaleOut},{geometry:b,material:y,stateMask:Tt.DelayedFocused|Tt.ScaleOut}])),this.mode&&"rotate"!==this.mode||(j=j.concat([{geometry:s.right,material:v,stateMask:Tt.DelayedFocused|Tt.Unlocked},{geometry:s.left,material:v,stateMask:Tt.DelayedFocused|Tt.RotateLeft},{geometry:s.right,material:v,stateMask:Tt.DelayedFocused|Tt.RotateRight}]));const _=[a,...n];return new Be.a({view:this.tool.view,renderObjects:j,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(m.d)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:_,direction:Object(B.g)(0,0,1)}})}createMaterial(e=1){const t=[...Qe,e];return new st.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}applySymbolData(e,t,i,a){e.symbolLayers.forEach((e,r)=>{const{heading:s,size:o}=t.symbolLayers[r];"object"===e.type&&(e.heading=(Object(n.k)(s)?s:0)-Object(It.c)(i),Object(n.k)(o)&&"width"in o&&(o.width=this.enforceNonZeroSize(o.width),o.height=this.enforceNonZeroSize(o.height),o.depth=this.enforceNonZeroSize(o.depth),e.width=o.width*a,e.depth=o.depth*a,e.height=o.height*a))})}enforceNonZeroSize(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)}get test(){return{ringManipulator:this.ringManipulator}}}function Ft(e,t,i){const a=t.projectToRenderScreen(e,Object(zt.a)(Ut)),r=t.renderToScreen(a,Lt);return Object(F.v)(i,r[0],r[1],0)}function qt(e,t){let i=null,a=1;const r=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=r,t()},update:e=>(a+=((a+1)/2-a)*Math.min(3*e,1),t(),Math.abs(a-1)<.01?1:0),destroy:()=>{e.getScale=i,t()}}}const Ut=Object(B.e)(),Lt=Object(zt.g)();let Zt=class extends(p.a.EventedMixin(O.a)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.handles=new Ee.a,this.scaleRotate=null,this.snappingPipeline=new Ce.a}initialize(){this.graphicState=new ye({graphic:this.graphic}),this.moveManipulation=new gt({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Ve(this.graphic),radius:gt.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator(e=>this.handles.add(e.events.on("immediate-click",e=>e.stopPropagation()))),this.moveManipulation.elevationInfo=Object(m.d)(this.graphic);const e=this.graphic.geometry;this.moveManipulation.createGraphicDragPipeline((t,i,a,r,s)=>(Object(n.k)(e)&&"point"===e.type&&0===t&&(a=a.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new Ge.a({elevationInfo:Object(m.d)(this.graphic),pointer:s,geometry:new De.a(Ae.c.fromGeometry(e,this.view.viewingMode),"point"),visualizer:new Te.a,excludeFeature:this.graphic}),snappingManager:this.snappingManager,cancel:r}),this.snappingPipeline.next)),a),this.graphicState,e=>{const{action:t,graphic:i,dxScreen:a,dyScreen:r}=e,s={graphic:i,dxScreen:a,dyScreen:r};switch(t){case"start":this.emit("graphic-translate-start",s);break;case"update":this.emit("graphic-translate",s);break;case"end":this.emit("graphic-translate-stop",s)}}),this.moveManipulation.angle=this.symbolRotationAngle,(this.enableScaling||this.enableRotation)&&(this.scaleRotate=new Bt({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate"}),this.handles.add(this.scaleRotate.events.on("scale-changed",()=>this.onScaleChanged()))),this.handles.add([Ke({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(Se.c)()}),this.graphic.watch("symbol",()=>this.updateMoveAngle()),this.graphicState.on("changed",()=>this.onGeometryChanged()),this.hideManipulatorsForGraphicState(),this.view.watch("scale",()=>this.updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()}forEachManipulator(e){this.moveManipulation.forEachManipulator(e),Object(n.k)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",e=>{this.forEachManipulator(t=>t.available=e),this.moveManipulation.zManipulation.available=e&&this.enableZ&&Ve(this.graphic)})}destroy(){this.handles.destroy(),this.moveManipulation.destroy(),this.scaleRotate=Object(n.e)(this.scaleRotate),this._set("view",null),this._set("graphic",null)}set snapToScene(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}get symbolRotationAngle(){const e=this.graphic.symbol;if(e){const t=e.symbolLayers.find(e=>"object"===e.type),i=t&&t.heading||0;return Object(It.d)(-i)}return 0}reset(){}onDetach(){Object(n.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onHide(){Object(n.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onScaleChanged(){if(Object(n.j)(this.scaleRotate))return;const e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}updateMoveAngle(){this.moveManipulation.angle="local"===this.view.viewingMode||this.view.scale<1e6?this.symbolRotationAngle:0}onGeometryChanged(){Object(ke.g)(this.view,this.moveManipulation,this.graphic)}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:Object(n.k)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Zt.prototype,"view",void 0),Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Zt.prototype,"graphic",void 0),Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Zt.prototype,"enableZ",void 0),Object(r.a)([Object(c.b)()],Zt.prototype,"enableRotation",void 0),Object(r.a)([Object(c.b)()],Zt.prototype,"enableScaling",void 0),Object(r.a)([Object(c.b)({value:!1})],Zt.prototype,"snapToScene",null),Object(r.a)([Object(c.b)({constructOnly:!0})],Zt.prototype,"snappingManager",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],Zt.prototype,"type",void 0),Zt=Object(r.a)([Object(h.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Zt);var Wt=i("gEht"),Nt=i("AvGH"),Yt=i("M0lq"),Xt=i("Hizz"),Kt=(i("bJda"),i("SuVq")),Qt=(i("4GrV"),i("BPBZ")),Jt=i("IEcw"),$t=i("Ango"),ei=i("VeZB"),ti=i("EVMh"),ii=i("1/dN"),ai=i("fFEv"),ri=i("NbNv"),si=i("WVfK"),ni=i("hnWO"),oi=i("w6Td"),li=i("ypgp"),ci=i("2jVe"),hi=i("+h6m"),pi=i("jjdI"),di=i("GJyJ"),ui=i("jpeq"),gi=i("0nJL"),bi=i("agdK"),mi=i("h7dw"),vi=i("cTsy");class Oi extends li.a{constructor(e,t){super(e,t),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=Oi.shader.get(),i=this.configuration,a=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled});return new pi.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),hi.a)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t,i){if(ui.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.stipplePattern!==t.stipplePattern){const e=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,e),this.stipplePattern=e}if(this.configuration.stippleEnabled){const t=Object(n.k)(this.stippleTextureBind)?this.stippleTextureBind(e,0)*i.camera.pixelRatio:1;this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/t),this.program.setUniform2f("ndcToPixel",i.camera.fullViewport[2]/2,i.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",t.color),this.program.setUniform1f("alphaCoverage",Math.min(1,t.width*i.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const e=Object(n.q)(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",e[0],e[1],e[2],e.length>3?e[3]:1)}4===this.configuration.output&&bi.a.bindOutputHighlight(e,this.program,i)}bindDraw(e){ui.a.bindView(this.program,e),gi.a.bindUniformsWithOrigin(this.program,this.configuration,e)}initializePipeline(){const e=this.configuration,t=Object(di.e)(770,1,771,771),i=(t,i=null,a=null)=>Object(di.d)({blending:i,depthTest:mi.b,depthWrite:a,colorWrite:di.b,stencilWrite:e.sceneHasOcludees?mi.h:null,stencilTest:e.sceneHasOcludees?t?mi.d:mi.c:null});return 0===e.output?(this._occludeePipelineState=i(!0,e.transparent||e.stippleEnabled?t:null,di.c),i(!1,e.transparent||e.stippleEnabled?t:null,di.c)):i(!1)}get primitiveType(){return 1}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}Oi.shader=new oi.a(vi.a,()=>i.e(180).then(i.bind(null,"seFa")));class fi extends ci.a{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleIntegerRepeatsEnabled=!1,this.sceneHasOcludees=!1}}Object(r.a)([Object(ci.b)({count:8})],fi.prototype,"output",void 0),Object(r.a)([Object(ci.b)()],fi.prototype,"slicePlaneEnabled",void 0),Object(r.a)([Object(ci.b)()],fi.prototype,"vertexColors",void 0),Object(r.a)([Object(ci.b)()],fi.prototype,"transparent",void 0),Object(r.a)([Object(ci.b)()],fi.prototype,"stippleEnabled",void 0),Object(r.a)([Object(ci.b)()],fi.prototype,"stippleOffColorEnabled",void 0),Object(r.a)([Object(ci.b)()],fi.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(r.a)([Object(ci.b)()],fi.prototype,"sceneHasOcludees",void 0);const yi=o.a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");class ji extends ri.a{constructor(e){super(e,wi),this.techniqueConfig=new fi}getTechniqueConfig(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1;const t=Object(n.k)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&Object(n.k)(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,a,r,s,n,o,l){l?Object(ai.d)(e,a,s,1,n):this.intersectLineGeometry(e,t,i,a,n)}intersectLineGeometry(e,t,i,a,r){if(!a.options.selectionMode||Object(ee.d)(t))return;if(!Object(ti.g)(i))return void yi.error("intersection assumes a translation-only matrix");const s=e.vertexAttributes.get("position").data,n=a.camera,o=ki;Object(Yt.c)(o,a.point),Object(F.v)(Ii[0],o[0]-2,o[1]+2,0),Object(F.v)(Ii[1],o[0]+2,o[1]+2,0),Object(F.v)(Ii[2],o[0]+2,o[1]-2,0),Object(F.v)(Ii[3],o[0]-2,o[1]-2,0);for(let p=0;p<4;p++)if(!n.unprojectFromRenderScreen(Ii[p],Vi[p]))return;Ht.e.fromPoints(n.eye,Vi[0],Vi[1],zi),Ht.e.fromPoints(n.eye,Vi[1],Vi[2],Hi),Ht.e.fromPoints(n.eye,Vi[2],Vi[3],Bi),Ht.e.fromPoints(n.eye,Vi[3],Vi[0],Fi);let l=Number.MAX_VALUE;for(let p=0;p<s.length-5;p+=3){if(xi[0]=s[p]+i[12],xi[1]=s[p+1]+i[13],xi[2]=s[p+2]+i[14],Si[0]=s[p+3]+i[12],Si[1]=s[p+4]+i[13],Si[2]=s[p+5]+i[14],Ht.e.signedDistance(zi,xi)<0&&Ht.e.signedDistance(zi,Si)<0||Ht.e.signedDistance(Hi,xi)<0&&Ht.e.signedDistance(Hi,Si)<0||Ht.e.signedDistance(Bi,xi)<0&&Ht.e.signedDistance(Bi,Si)<0||Ht.e.signedDistance(Fi,xi)<0&&Ht.e.signedDistance(Fi,Si)<0)continue;if(n.projectToRenderScreen(xi,Ai),n.projectToRenderScreen(Si,Di),Ai[2]<0&&Di[2]>0){Object(F.i)(Pi,xi,Si);const e=n.frustum,t=-Ht.e.signedDistance(e[4],xi)/Object(F.g)(Pi,Ht.e.normal(e[4]));Object(F.d)(Pi,Pi,t),Object(F.e)(xi,xi,Pi),n.projectToRenderScreen(xi,Ai)}else if(Ai[2]>0&&Di[2]<0){Object(F.i)(Pi,Si,xi);const e=n.frustum,t=-Ht.e.signedDistance(e[4],Si)/Object(F.g)(Pi,Ht.e.normal(e[4]));Object(F.d)(Pi,Pi,t),Object(F.e)(Si,Si,Pi),n.projectToRenderScreen(Si,Di)}else if(Ai[2]<0&&Di[2]<0)continue;Ai[2]=0,Di[2]=0;const e=Ht.d.distance2(Ht.d.fromPoints(Ai,Di,Ci),o);e<l&&(l=e,Object(F.j)(Gi,xi),Object(F.j)(Ri,Si))}const c=a.rayBeginPoint,h=a.rayEndPoint;if(l<4){let e=Number.MAX_VALUE;if(Ht.d.closestLineSegmentPoint(Ht.d.fromPoints(Gi,Ri,Ci),Ht.d.fromPoints(c,h,Ti),Ei)){Object(F.i)(Ei,Ei,c);const t=Object(F.o)(Ei);Object(F.d)(Ei,Ei,1/t),e=t/Object(F.n)(c,h)}r(e,Ei)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const a=i.get("position");return Object(N.a)(a,null,!1,t)}createBufferWriter(){const e=this.params.vertexColors?ni.b:ni.c;return Object(n.j)(this.params.stipplePattern)?new ni.a(e):new Mi(e.clone().vec3f("auxpos1"))}getGLMaterial(e){return 0===e.output||4===e.output?new _i(e):void 0}}class _i extends ii.a{constructor(e){super(e),this.updateParameters()}updateParameters(){this.technique=this.techniqueRep.acquireAndReleaseExisting(Oi,this.material.getTechniqueConfig(this.output),this.technique)}beginSlot(e){return 3===e}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}ensureParameters(e){0===this.output&&this._updateOccludeeState(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}class Mi{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,a){Object(si.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,a),this.writeAuxpos1(e,t,i,a)}writeAuxpos1(e,t,i,a){const r=i.getField("auxpos1",ei.u),s=t.indices.get("position"),n=t.vertexAttributes.get("position").data,o=e.transformation,l=r.typedBufferStride,c=r.typedBuffer;a*=l;for(let h=0;h<s.length;h+=2){const e=3*s[h],t=n[e],i=n[e+1],r=n[e+2],p=o[0]*t+o[4]*i+o[8]*r+o[12],d=o[1]*t+o[5]*i+o[9]*r+o[13],u=o[2]*t+o[6]*i+o[10]*r+o[14];for(let s=0;s<2;++s)c[a]=p,c[a+1]=d,c[a+2]=u,a+=l}}}const wi={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1,...ri.b},xi=Object(B.e)(),Si=Object(B.e)(),Pi=Object(B.e)(),Ei=Object(B.e)(),Ai=Object(zt.e)(),Di=Object(zt.e)(),Gi=Object(B.e)(),Ri=Object(B.e)(),Ci=Ht.d.create(),Ti=Ht.d.create(),ki=Object(B.e)(),Ii=[Object(zt.e)(),Object(zt.e)(),Object(zt.e)(),Object(zt.e)()],Vi=[Object(B.e)(),Object(B.e)(),Object(B.e)(),Object(B.e)()],zi=Ht.e.create(),Hi=Ht.e.create(),Bi=Ht.e.create(),Fi=Ht.e.create();i("lObl"),Object(s.a)("mac"),Math.cos(Object(ze.d)(45)),Math.cos(Object(ze.d)(5));const qi=[1,.5,0],Ui=[...qi,1],Li=[1,1,1,1],Zi=[1,.8,.6,1],Wi=[1,.93,.86,1],Ni=[...qi,1],Yi=[...qi,1];var Xi=i("cKKt"),Ki=i("sE2g");class Qi extends li.a{initializeProgram(e){const t=Qi.shader.get().build();return new pi.a(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),hi.a)}bindPass(e,t,i){ui.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",t.backgroundColor),this.program.setUniform4fv("gridColor",t.gridColor),this.program.setUniform1f("gridWidth",t.gridWidth)}bindDraw(e){ui.a.bindView(this.program,e)}initializePipeline(){return Object(di.d)({blending:Object(di.e)(1,1,771,771),depthTest:{func:513},colorWrite:di.b})}}Qi.shader=new oi.a(Ki.a,()=>i.e(183).then(i.bind(null,"B0gI"))),Object(r.a)([Object(Xi.c)()],class extends ii.a{constructor(e){super(e),this.technique=new Qi(this.techniqueRep.constructionContext,null),this.updateParameters()}updateParameters(){}beginSlot(e){return 8===e}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.params,t)}}.prototype,"technique",void 0);var Ji=i("aK8v"),$i=i("dDjh"),ea=i("xtdb"),ta=i("89mX");class ia extends li.a{initializeProgram(e){const t=ia.shader.get(),i=this.configuration,a=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new pi.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),hi.a)}bindPass(e,t,i){ui.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(ea.a)(this.program,e,i))}bindDraw(e){ui.a.bindView(this.program,e),gi.a.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const i=this.configuration,a=3===e,r=2===e;return Object(di.d)({blending:0!==i.output&&7!==i.output||!i.transparent?null:a?aa:Object($i.a)(e),culling:(e=>0!==e&&{face:1===e?1028:1029,mode:2305})(i.cullFace),depthTest:{func:Object($i.b)(e)},depthWrite:a?i.writeDepth&&di.c:Object($i.c)(e),colorWrite:di.b,stencilWrite:i.sceneHasOcludees?mi.h:null,stencilTest:i.sceneHasOcludees?t?mi.d:mi.c:null,polygonOffset:a||r?null:Object($i.g)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}ia.shader=new oi.a(ta.a,()=>i.e(176).then(i.bind(null,"wFaR")));const aa=Object(di.f)(1,771);class ra extends ci.a{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}Object(r.a)([Object(ci.b)({count:8})],ra.prototype,"output",void 0),Object(r.a)([Object(ci.b)({count:3})],ra.prototype,"cullFace",void 0),Object(r.a)([Object(ci.b)()],ra.prototype,"slicePlaneEnabled",void 0),Object(r.a)([Object(ci.b)()],ra.prototype,"transparent",void 0),Object(r.a)([Object(ci.b)()],ra.prototype,"enableOffset",void 0),Object(r.a)([Object(ci.b)()],ra.prototype,"writeDepth",void 0),Object(r.a)([Object(ci.b)()],ra.prototype,"sceneHasOcludees",void 0),Object(r.a)([Object(ci.b)({count:4})],ra.prototype,"transparencyPassType",void 0),Object(r.a)([Object(ci.b)()],ra.prototype,"multipassTerrainEnabled",void 0),Object(r.a)([Object(ci.b)()],ra.prototype,"cullAboveGround",void 0);class sa extends ri.a{constructor(e){super(e,oa),this.supportsEdges=!0,this.techniqueConfig=new ra}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<$i.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,a,r,s,n){Object(ai.e)(e,t,a,r,s,void 0,n)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new na(e):void 0}createBufferWriter(){return new ni.a(ni.d)}}class na extends Ji.a{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){this.updateTexture(this.material.params.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(ia,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}const oa={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...ri.b};var la,ca=i("f/qv"),ha=i("Gj5k"),pa=i("xvdR"),da=i("ag7Y");let ua=la=class extends da.a{constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new la({position:Object(ca.a)(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(n.k)(this.position)&&Object(n.k)(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}};function ga(e){const t=Object(F.o)(e.basis1),i=Object(F.o)(e.basis2);return.3*Math.min(t,i)}function ba(e){return ga(e)}function ma(e){return 0!==e.direction[0]&&0!==e.direction[1]}function va(e,t,i){const a=[];if(Object(n.k)(t))a.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const r=i/t*2*Math.PI;a.push([Math.cos(r)*e,Math.sin(r)*e])}}return ue.a.createPathExtrusionGeometry(a,i,[],[],!1)}Object(r.a)([Object(c.b)({readOnly:!0,json:{read:!1,write:!0}})],ua.prototype,"type",void 0),Object(r.a)([Object(c.b)({type:Kt.a}),Object(pa.a)()],ua.prototype,"position",void 0),Object(r.a)([Object(c.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(pa.a)(),Object(ha.a)(e=>K.b.normalize(Object(l.i)(e),0,!0))],ua.prototype,"heading",void 0),Object(r.a)([Object(c.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(pa.a)(),Object(ha.a)(e=>K.b.normalize(Object(l.i)(e),0,!0))],ua.prototype,"tilt",void 0),Object(r.a)([Object(c.b)({type:Number,nonNullable:!0}),Object(pa.a)()],ua.prototype,"width",void 0),Object(r.a)([Object(c.b)({type:Number,nonNullable:!0}),Object(pa.a)()],ua.prototype,"height",void 0),ua=la=Object(r.a)([Object(h.a)("esri.widgets.Slice.SlicePlane")],ua),o.a.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");const Oa=(Ht.f.create(),Math.PI/2);class fa{constructor(){this.lastDragEvent=null,this.next=new Re.a,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(n.k)(this.lastDragEvent)){const t={...this.lastDragEvent,action:"update"};e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this.lastDragEvent=null,e=>(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this.adjustScaleFactors(e),e)}adjustScaleFactors(e){const t=ma(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{adjustScaleFactors:e=>this.adjustScaleFactors(e)}}}var ya=i("NPIS"),ja=i("FXzB"),_a=i("4eAd"),Ma=i("+9DA");function wa(e,t){return Sa(e,t,!1)}function xa(e,t){return Sa(e,t,!0)}function Sa(e,t,i){if(e instanceof ya.b){if(e.operation instanceof ja.a)return function(e,t,i=!1){const a=i?-1:1,r=Object(B.g)(a*e.dx,a*e.dy,a*e.dz);Object(F.e)(t.origin,t.origin,r)}(e.operation,t,i),!0;if(e.operation instanceof _a.a)return function(e,t,i=!1){const a=i?-e.angle:e.angle;Object(F.c)(t.basis1,t.basis1,B.b,a),Object(F.c)(t.basis2,t.basis2,B.b,a)}(e.operation,t,i),!0;if(e.operation instanceof Ma.a)return function(e,t,i=!1){const a=i?1/e.factor1:e.factor1,r=i?1/e.factor2:e.factor2;Object(F.d)(t.basis1,t.basis1,a),Object(F.d)(t.basis2,t.basis2,r),Pa(t.origin,e.origin,e.axis1,a),Pa(t.origin,e.origin,e.axis2,r)}(e.operation,t,i),!0}return!1}function Pa(e,t,i,a){const r=rt.c.get(),s=Object(Yt.d)(r,e,t),n=Object(Yt.a)(r,i,Object(Yt.g)(i,s));Object(Yt.o)(e,e,n,a-1)}let Ea=class extends(p.a.EventedMixin(O.a)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this._preserveAspectRatio=new fa,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new Ee.a,this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=Ht.a.create(),this.mapBoundsStart=Ht.a.create(),this.displayBounds=Ht.a.create(),this.displayBoundsStart=Ht.a.create(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}]}initialize(){this.graphicState=new ye({graphic:this.graphic});const e=this.graphic.geometry;this.reshapeHelper=new Rt(Ae.c.fromGeometry(e,this.view.viewingMode),e.type),this.graphicMoveManipulation=new vt({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=function(e,t=1){const i=0===t?40:0,a=[Object(B.g)(i,0,-24),Object(B.g)(i,0,24)],r=function(e,t){const i=Object(F.i)(Object(B.e)(),e[e.length-1],e[e.length-2]);Object(F.q)(i,i),Object(F.d)(i,i,12),Object(F.e)(i,i,e[e.length-1]);{const t=Object(F.i)(Object(B.e)(),e[0],e[1]);return Object(F.q)(t,t),Object(F.d)(t,t,12),Object(F.e)(t,t,e[0]),[t,...e,i]}}(a),s=(e,t)=>function(e,t,i){const a=a=>{const r=(a?t:e).slice(0),s=Object(F.i)(rt.d.get(),r[0],r[1]);Object(F.q)(s,s);const o=Object(F.i)(rt.d.get(),r[r.length-1],r[r.length-2]);if(Object(F.q)(o,o),i.padding>0){const e=Object(F.d)(Object(B.e)(),o,-i.padding);if(r[r.length-1]=Object(F.e)(e,e,r[r.length-1]),i.bothEnds){const e=Object(F.d)(Object(B.e)(),s,-i.padding);r[0]=Object(F.e)(e,e,r[0])}}const l=a?i.tipFocusMultiplier:1,c=i.tipLength*(i.focusTipLength?l:1),h=i.tipRadius*l,p=Object(Q.i)(rt.a.get());if(i.padding>0){const e=c/4,t=Object(F.v)(rt.d.get(),0,e,0),a=1+i.padding/e;Object(Q.s)(p,p,t),Object(Q.r)(p,p,Object(F.v)(rt.d.get(),a,a,a)),Object(Q.s)(p,p,Object(F.d)(t,t,-1/a))}const d=Object(Q.i)(Object(J.b)()),u=Object(B.g)(0,1,0),g=Object(Q.p)(Object(J.b)(),Object(Qt.d)(rt.b.get(),u,o));g[12]=r[r.length-1][0],g[13]=r[r.length-1][1],g[14]=r[r.length-1][2],Object(Q.l)(g,g,p);const b=[{part:"tube",geometry:va(i.tubeRadius*(a?i.tubeFocusMultiplier:1)+i.padding,i.flat,r),transform:d}];let m,v;if(Object(n.k)(i.flat)?m=ue.a.createExtrudedTriangle(c,h,h,i.flat.thickness):(m=ue.a.createConeGeometry(c,h,24,!1,!1,!0),v=ue.a.createConeGeometry(c,h,24,!1,!0,!1)),b.push({part:"tip",geometry:m,transform:g}),v&&b.push({part:"cap",geometry:v,transform:g}),i.bothEnds){const e=Object(Q.p)(Object(J.b)(),Object(Qt.d)(rt.b.get(),u,s));e[12]=r[0][0],e[13]=r[0][1],e[14]=r[0][2],Object(Q.l)(e,e,p),b.push({part:"tip",geometry:m,transform:e}),v&&b.push({part:"cap",geometry:v,transform:e})}return b};return{normal:a(!1),focused:a(!0)}}(a,a,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),o=s(0,!1),l=s(2.25,!0),c=new st.a({color:Li,cullFace:2,renderOccluded:16}),h=new st.a({color:Zi,cullFace:2,renderOccluded:16}),p=new st.a({color:Wi,cullFace:2,renderOccluded:16}),d=new st.a({color:Yi,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),u=ue.a.createPolylineGeometry([[i,0,0],[i-40,0,0]]),g=ue.a.createPolylineGeometry([[i,0,0],[i-40,0,0]]),b=new ji({color:Ni,renderOccluded:4});return new Be.a({view:e,renderObjects:[...o.normal.map(({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?c:"cap"===e?h:p,transform:i,stateMask:17})),...l.normal.map(({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:17})),{geometry:u,material:b,stateMask:49},...o.focused.map(({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?c:"cap"===e?h:p,transform:i,stateMask:18})),...l.focused.map(({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:18})),{geometry:g,material:b,stateMask:50}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[r]},collisionPriority:1,radius:11,state:16})}(this.view,0),this.moveZManipulator.state|=32,this.handles.add(this.watch("enableZ",()=>this.updateManipulatorAvailability(this.moveZManipulator,0))),this.handles.add(this._createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map(e=>{const t=function(e,t){const i=ma(t),a=i?[Object(B.g)(1,0,0),Object(B.g)(0,0,0),Object(B.g)(0,1,0)]:[Object(B.g)(1,0,0),Object(B.g)(-1,0,0)],r=ue.a.createPolylineGeometry(a),s=[...qi,1],n=i?4:1,o=2*n,l=e=>e>1?(e=>new X.a({color:s,width:e,renderOccluded:4}))(e):new ji({color:s,renderOccluded:4}),c=[{geometry:r,material:l(n),stateMask:17},{geometry:r,material:l(o),stateMask:18},{geometry:r,material:l(1),stateMask:32}],h=new Be.a({view:e,renderObjects:c,collisionType:{type:"line",paths:[a]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?6:4,idHint:i?1:2});return h.state=16,h}(this.view,e);return this.handles.add(this.watch("enableScaling",()=>this.updateManipulatorAvailability(t,2))),t.events.on("grab-changed",e=>this._onResizeGrab(e)),this.handles.add(this._createResizeDragPipeline(t,e)),t}),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new Xt.a("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAK4UExURUdwTP9+AP9tAP9+AP99AP9VAP99AP99AP9+AP9+AP99AP99AP98AP8AAP99AP/9/P+ABf9/Af/Jlf////9/AP9/AP99AP9xAP9/AP94AP9+AP9+AP/16//38f9/AP97AP99AP99AP99AP9zAP9+AP9/AP/o0v/w4v+IE//PoP/59f+DCf99AP98AP+EC/+eQP/kyf/27//at/+VLf/59f+WL//8+/+LHP9+AP9/AP99AP/38P/nz//48/+dPv/7+P/NnP+HEf/8+v/9/f/8+//ewf+SKv/WsP+MHv98AP/27//17P/hxf++f//27v9+AP99AP+1bP98AP9+AP/o0/9+AP+BB/97AP/QpP98AP+uYP9/AP+AA/+QJP+rWP/q1v/Fjf+fQf/hx//Onv/fwP/9/P99AP/ev/+kTP+KGP+vYv/s2v9/AP+oU/+1b/98AP98AP96AP97AP9+AP9/AP9/AP96AP9/AP99AP/Ztf+rW/+mUP98AP+1b//48v/38f98AP+cO//38P99AP/nz//Pov99AP/HkP+fQ/+tX/99AP/69//v4P+6eP/DiP/z6P+TK/+JFv+EDf/s2//lzP+8ev96AP+8ff+YNP9/AP/Tqv+iSf96AP+tXv9/AP/Lm/98AP/lzP/Uq/+tXf/9/P/06f/Hk/+9fv/u3f/Klv/Spf+oVv+za/+jSv/Lmf/q1f/Gjv+1bf/69//Sp/+bOv/PoP+3c//z5/9/AP/Ikv/r1/+hRv/FjP/Mmv+ZN//06v/59P/69f/q1v/x5P9/AP+PI/+3cf/9+//8+v+gRP/16//o0//Ztf+nUv/17P/Hkf/ixv/s2v/59P/48//Di/+lT//ky//hxf/Wrv+oVf/u3f/w4//Wrf+5dv/gxP/7+f/z6P/dvP+6d//u3v+aOP/r2f/r2f///9a+uZsAAADndFJOUwB9B29qA1OAd38/RykBeP6BgLX+KhJ2CQgRdWHt8zpGOUVmC2sK2uaFu/aCQS+DktPwyIz3jfyHZz5o8tf1kvq4hPz+/c6LxIhi8e/RqvBjfKJaedtbgki8K54GgYqb3bGT0rnN/XDNloae30CZpFJUG0BlGhgZUjPHnJgto/PyUJHxUdi8dLKTnU/55aev64yGg+DWqDipjizAlTCdArgx1cCc/Ou0quG1vZqilrfcsaP4vpC6peoos96UsLeP7PX33OcyiaT8+5Tu2saY7rPR4Pb0sJfV0MKZ4ufBptD66sun4pDf3qyDniQAAAO+SURBVFjDpVf1WxRBGF7gYO64A+5OJKU7lFRaSlLARlBpsEVFwu7u7u7u7u7ubt1/w7vZPXZmd/bYffx+geed731vZme+oigR83NsGBNvpbSwUFrF29g6+lGybKxaoQKYqRTqRqlsS09/QDR/T0sJdOdwJRA15Ujntvgd3YBZU661M0dv3wO0aXntxfkaeyDB+mwQodv1BxJNTTyGtQ2QbDbWBH4/02qMBIXeQoVZrYt/h0vZA/8U3PmHtvs0SIKCF84v5Vbe0XQl/GfTgejAoKDFgY/nDSUpTMbun7u/zl1o+lUc6BrdneasQ06EQMDeFRFA3s97I2FIpAONm0OBQMKd49/m0OCXRvfd92iB1W3U8hQ2t8aPEwfq2T3TBFu1Hhdwc2EFwjlMt4d1vsH8meYR245TyO+KK9iy8Y/E70+TrwdN/wp5km6AVpSXBJnQpCo8NJn84IlAI1p/7UU5Au+6yaJP4zAFbyig4IBR3HZjyzDXwlgG3oHnKJj/EOA58sl+4OeNiGLgSgxtNgioAfaIuJt/gyucZhQ8gvkPGjlBVU30249R3ViFEbxrP8TIz0GxREP+V/FfmG75hy/6z18rvtfzFkKgQEoxmu0DKEfpaaQTEx53UUxDjZQuAPZCgQL8LY2RIZCbAT8jCrVQvjIEQF+4hWwEGUcNliOwEwpMQRArSilHoBAKXEYQJ8pCjsAJKKBHkJ7yBIZDgRpMQNYR1kCBC9gRZH3EK1DgLPYRZV1jNRQ4gl2jjIoIdFON/NSVCDSaasB9hr3+s0VUoBfcQCAKJWDBpK2v/kbTyaICFVDgKB5MaDj/rjM6ZA4wu4GMGDyc0YQCIqHLtXQif1gRXK1FsXg8pYFRTBFYrSXww5hIynyAgj4GgUYUqGWyWVaxMJswu6MnYGgTL62DuJmM28U7PH72frbmBQvSOlZYwGE2paYcR7sMrT6Uge8vIBQWSywclppq4cOQqyw042CRKdWvI5U2tLgaLI2rpvnJQ3KyZidxpeIZsbhSznh7uy+VJtuiJTh/rqm8U9vxhUnniPxbl3gftiPXouTxrjztpIAeqteKtzhok8VY2Rm8R1m2Lddsk0WoT7oBp44xd3f9UclEnfBlavBGUU0uZp3nx4SRI8uH3+pOB7JM0OoizbYUIzTb1NaF0vmjrYkTh5dEuspHbOQ5L6lI9CkVH5pc3dvmu7v+39g3vq3B0cXWzDmcbF0kzK4DvRVkusJ7oNTxudkrkT98J/o0yRvgAzQJNr7M+O/bkqAJEPP7B6FvZpCHDcaFAAAAAElFTkSuQmCC",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=function(e,t){const i=new sa({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),a=40,r=27*1.1,s=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new $t.a([["position",{size:3,data:[a-e,-e,0,a+e,-e,0,a+e,e,0,a-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},n=ue.a.createPolylineGeometry([[0,0,0],[13,0,0]]),o=ue.a.createPolylineGeometry([[0,0,0],[a-r,0,0]]),l=new ji({color:Ui,renderOccluded:4}),c=[{geometry:s(27),material:i,stateMask:17},{geometry:n,material:l,stateMask:17},{geometry:s(r),material:i,stateMask:18},{geometry:o,material:l,stateMask:18}];return new Be.a({view:e,renderObjects:c,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},collisionPriority:1,radius:13.5,state:16})}(this.view,this.rotateManipulatorTexture),this.handles.add(this.watch("enableRotation",()=>this.updateManipulatorAvailability(this.rotateManipulator,3))),this.rotateManipulator.events.on("grab-changed",e=>{this._onRotateGrab(e)}),this.handles.add(this._createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds(this.mapBounds);const t=Ke({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(Se.c)()});this.outlineVisualElement=t.visualElement instanceof ce?t.visualElement:null,Object(n.k)(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",()=>this.updateDisplayBounds(this.mapBounds))),this.handles.add(t),this.handles.add([this.graphicState.on("changed",()=>this.onGeometryChanged()),this.graphicState.watch("displaying",()=>this.updateAllManipulatorAvailability()),Object(u.init)(this.graphicState,"isDraped",()=>this.graphicDrapedChanged()),this.view.trackGraphicState(this.graphicState)]);const i=this.view.pointsOfInterest;i&&this.handles.add(i.focus.watch("location",()=>this.updateDisplayBounds(this.mapBounds)));const a=e=>{this.handles.add(e.events.on("grab-changed",()=>{this.grabbing=e.grabbing,this.updateAllManipulatorAvailability()}))};this.forEachManipulator(a),this.graphicMoveManipulation.forEachManipulator(a);const r=(e,t)=>{this.handles.add(e.events.on("immediate-click",e=>{1===t&&this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()}))};this.forEachManipulator(r),this.graphicMoveManipulation.forEachManipulator(r),this.onGeometryChanged(),this.updateAllManipulatorAvailability()}graphicDrapedChanged(){this.handles.remove(Aa),this.updateDisplayBounds(this.mapBounds),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",e=>{Object(n.k)(this.attachmentOrigin)&&Object(Ze.f)(e.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this.updateDisplayBounds(this.mapBounds)}),Aa)}updateAllManipulatorAvailability(){this.forEachManipulator((e,t)=>this.updateManipulatorAvailability(e,t))}updateManipulatorAvailability(e,t){const i=this.graphicState.displaying,a=this.grabbing&&!e.grabbing;e.interactive=!a;const r=this.enableZ&&Ve(this.graphic);switch(t){case 3:e.available=i&&this.enableRotation;break;case 2:e.available=i&&(this.enableScaling||this.enableRotation||r),e.interactive=!a&&this.enableScaling,e.state=this.enableScaling?16:32;break;case 0:e.available=i&&r;break;default:e.available=i}}forEachManipulator(e){this.resizeManipulators.forEach(t=>e(t,2)),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}destroy(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.reshapeHelper.destroy(),this._set("view",null),this._set("graphic",null)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}reset(){}onDetach(){this.mapBounds=null,this.displayBounds=null}onGeometryChanged(){this.updateDisplayBounds(this.mapBounds)}calculateMapBounds(){const e=this.graphic.geometry,t=this.reshapeHelper.editGeometry,i=t.components[0].edges[0],a=Object(Yt.d)(rt.c.get(),i.left.pos,i.right.pos);Object(Yt.e)(a,a);const r=Object(n.r)(Object(ke.f)(this.view,this.graphic),e.extent.center);let s=Ga*this.view.pixelSizeAt(r);const o=this.view.spatialReference;o!==e.spatialReference&&(s*=Object(Wt.f)(o)/Object(Wt.f)(e.spatialReference)),function(e,t,i,a){a||(a=Ht.a.create());const r=Object(Yt.r)(rt.c.get(),e[1],-e[0]),s=Object(Yt.r)(rt.c.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=Object(Yt.r)(rt.c.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=rt.c.get();t.components.forEach(t=>t.vertices.forEach(t=>{const i=t.pos;Object(Yt.r)(o,Object(Yt.g)(e,i),Object(Yt.g)(r,i)),Object(Yt.t)(s,s,o),Object(Yt.u)(n,n,o)}));const l=1e-6,c=Object(Yt.r)(rt.c.get(),n[0]-s[0]<l?i/2:0,n[1]-s[1]<l?i/2:0);Object(Yt.d)(s,s,c),Object(Yt.h)(n,n,c),Object(Yt.a)(a.basis1,e,(n[0]-s[0])/2),Object(Yt.a)(a.basis2,r,(n[1]-s[1])/2),Object(Yt.r)(a.origin,s[0]*e[0]+s[1]*r[0],s[0]*e[1]+s[1]*r[1]),Object(Yt.h)(a.origin,a.origin,a.basis1),Object(Yt.h)(a.origin,a.origin,a.basis2)}(a,t,s,this.mapBounds)}updateDisplayBounds(e){const t=this.graphic.geometry,i=Object(n.k)(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(n.k)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Object(ke.f)(this.view,this.graphic);this.attachmentOrigin=Object(n.r)(i,t.extent.center);const a=Object(n.k)(i)?i.z:Object(ge.c)(e.origin,this.view.elevationProvider,Y.a.fromElevationInfo(Object(m.d)(this.graphic)),this.view.renderCoordsHelper),r=Ht.a.copy(e);Object(F.v)(r.origin,e.origin[0],e.origin[1],a),function(e,t,i,a=0,r){r||(r=Ht.a.create()),t.toRenderCoords(e.origin,i,r.origin);const s=rt.d.get();Object(F.e)(s,e.origin,e.basis1),Object(F.e)(s,s,e.basis2),t.toRenderCoords(s,i,s);const n=rt.d.get();Object(F.e)(n,e.origin,e.basis1),Object(F.i)(n,n,e.basis2),t.toRenderCoords(n,i,n);const o=rt.d.get();Object(F.i)(o,e.origin,e.basis1),Object(F.i)(o,o,e.basis2),t.toRenderCoords(o,i,o);const l=rt.d.get();Object(F.i)(l,e.origin,e.basis1),Object(F.e)(l,l,e.basis2),t.toRenderCoords(l,i,l);const c=Object(F.h)(rt.d.get(),s,n,.5);Object(F.i)(c,c,r.origin);const h=Object(F.h)(rt.d.get(),o,l,.5);Object(F.i)(h,r.origin,h),Object(F.h)(r.basis1,c,h,.5);const p=Object(F.h)(rt.d.get(),l,s,.5);Object(F.i)(p,p,r.origin);const d=Object(F.h)(rt.d.get(),n,o,.5);Object(F.i)(d,r.origin,d),Object(F.h)(r.basis2,p,d,.5);const u=Object(F.f)(rt.d.get(),r.basis1,r.basis2),g=Object(F.f)(u,u,r.basis1);Object(F.q)(g,g),Object(F.d)(r.basis2,g,Object(F.g)(r.basis2,g)),Object(F.d)(r.basis1,r.basis1,1+a/Object(F.o)(r.basis1)),Object(F.d)(r.basis2,r.basis2,1+a/Object(F.o)(r.basis2)),Ht.a.updateUnboundedPlane(r)}(r,this.view.renderCoordsHelper,t.spatialReference,this.displayBoundsMargin(),this.displayBounds),this.updateManipulators()}displayBoundsMargin(){const e=this.view.pointsOfInterest;return Da*this.view.pixelSizeAt(e?e.focus.location:this.reshapeHelper.geometry.extent.center)}_createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline((e,t,i)=>this.applyGraphicMoveSteps(t,i))}_createMoveZDragPipeline(){const e=this.view,t=this.reshapeHelper.geometry.spatialReference;return Object(Re.e)(this.moveZManipulator,(i,a,r)=>{const s=Object(B.d)(i.renderLocation),n=a.next(Object(nt.g)(e,s,t)).next(Object(Re.c)());this.applyGraphicMoveSteps(n,r)})}applyGraphicMoveSteps(e,t){const i=e.next(e=>("start"===e.action&&(this.inputState={type:"move"},Ht.a.copy(this.mapBounds,this.mapBoundsStart),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e)).next(Object(Re.b)()).next(this._moveDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",t)}return e});return t.next(()=>{Object(n.k)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this.cancel()}),i}_moveDragUpdateGeometry(){return e=>{if(Object(n.j)(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const i of this.reshapeHelper.editGeometry.components)t.push(...i.vertices);return wa(this.reshapeHelper.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,"start"===e.action?0:1),this.mapBounds),this.graphic.geometry=this.reshapeHelper.geometry,e}}_onResizeGrab(e){if("start"!==e.action)return;const t=this._calculatePickRay(e.screenPoint);Ht.e.intersectRay(this.displayBounds.plane,t,rt.d.get())&&(Ht.a.copy(this.displayBounds,this.displayBoundsStart),Ht.a.copy(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin(),this.inputState={type:"resize"})}_createResizeDragPipeline(e,t){return Object(Re.e)(e,(e,i,a)=>{Object(n.j)(this.inputState)||(i.next(e=>("start"===e.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),e)).next(Object(nt.f)(this.view,this.displayBoundsStart.plane)).next(e=>({...e,handle:t})).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":this.emit("graphic-scale",t);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",t)}return e}),a.next(()=>{Object(n.k)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this.cancel()}))})}_resizeDragRenderPlaneToFactors(){return e=>{const t=this.displayBoundsStart,i=e.handle.direction,a=this.displayBoundsMargin(),r=this.displayBoundsMarginStart,s=Object(F.j)(rt.d.get(),t.origin);Object(F.b)(s,s,t.basis1,-i[0]),Object(F.b)(s,s,t.basis2,-i[1]);const n=Object(F.i)(rt.d.get(),e.renderEnd,s),o=Object(F.i)(rt.d.get(),e.renderStart,s),l=ma(e.handle),c=ba(t),h=ba(this.displayBounds)/c,p=(e,t)=>{if(0===e)return 1;let i=Object(F.o)(t),s=.5*e*Object(F.g)(t,n)/i;const c=s<0?-1:1;l&&(s+=(i-.5*e*Object(F.g)(t,o)/i)*c*h);const p=i<1.5*r?1:Ra;return i=Math.max(i-r,Ra),c>0&&(s-=a),c*Math.max(c*(s/i),p)};return{...e,factor1:p(i[0],t.basis1),factor2:p(i[1],t.basis2)}}}_resizeDragUpdateGeometry(){return e=>{const t=Object(F.j)(Object(B.e)(),this.mapBoundsStart.origin);Object(F.b)(t,t,this.mapBoundsStart.basis1,-e.handle.direction[0]),Object(F.b)(t,t,this.mapBoundsStart.basis2,-e.handle.direction[1]);const i=Object(Yt.r)(Object(Nt.a)(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);Object(Yt.e)(i,i);const a=[];for(const n of this.reshapeHelper.editGeometry.components)a.push(...n.vertices);const r="start"===e.action?0:1,s=this.reshapeHelper.scaleVertices(a,this.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(t),i,e.factor1,e.factor2,r,1);return Ht.a.copy(this.mapBoundsStart,this.mapBounds),wa(s,this.mapBounds),this.graphic.geometry=this.reshapeHelper.geometry,e}}_onRotateGrab(e){if("start"!==e.action)return;const t=function(e,t,i,a){const r=t.worldUpAtPosition(e.origin,rt.d.get()),s=rt.d.get();return Object(F.j)(s,r),Ht.e.fromPositionAndNormal(e.origin,s,a)}(this.displayBounds,this.view.renderCoordsHelper,0,Ht.e.create()),i=this._calculatePickRay(e.screenPoint);Ht.e.intersectRay(t,i,rt.d.get())&&(Ht.a.copy(this.displayBounds,this.displayBoundsStart),Ht.a.copy(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}_createRotateDragPipeline(e){return Object(Re.e)(e,(e,t,i)=>{const a=this.inputState;Object(n.j)(a)||(t.next(e=>("start"===e.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),e)).next(Object(nt.f)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,angle:Object(ze.n)(e.rotateAngle)};switch(e.action){case"start":case"update":this.emit("graphic-rotate",t);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",t)}return e}),i.next(()=>{Object(n.k)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this.cancel()}))})}_rotateDragRenderPlaneToRotate(e){return t=>{const i=Ht.e.normal(e.rotatePlane),a=Object(ke.a)(t.renderStart,t.renderEnd,this.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return e=>{const t=Object(F.j)(Object(B.e)(),this.mapBoundsStart.origin),i=[];for(const s of this.reshapeHelper.editGeometry.components)i.push(...s.vertices);const a="start"===e.action?0:1,r=this.reshapeHelper.rotateVertices(i,this.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(t),e.rotateAngle,a,1);return Ht.a.copy(this.mapBoundsStart,this.mapBounds),wa(r,this.mapBounds),this.graphic.geometry=this.reshapeHelper.geometry,e}}_calculatePickRay(e){const t=Ht.f.create(),i=Object(zt.j)(e);return Ht.f.fromScreen(this.view.state.camera,i,t),Object(F.q)(t.direction,t.direction),t}updateManipulators(){if(!this.visible)return;const e=function(e,t){return Object(ke.b)(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,rt.a.get());(function(e,t,i,a){const r=a.worldUpAtPosition(i.origin,rt.d.get()),s=function(e,t){return{basis:e.basis1,direction:1,position:Object(F.e)(rt.d.get(),e.origin,e.basis1),edge:0}}(i),n=Object(Q.i)(rt.a.get());Object(Q.g)(n,n,s.edge*Math.PI/2),Object(Q.e)(n,n,-function(e,t){return Object(Jt.b)(t,e.basis2,e.basis1)+Oa}(i,r)),Object(Q.l)(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=s.position})(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,e),this.resizeManipulators.forEach((t,i)=>{!function(e,t,i,a){const r=Object(F.o)(a.basis1),s=Object(F.o)(a.basis2),n=ga(a),o=ba(a),l=Object(F.v)(rt.d.get(),0,0,0);Object(F.e)(l,Object(F.d)(rt.d.get(),a.basis1,t.direction[0]),Object(F.d)(rt.d.get(),a.basis2,t.direction[1])),Object(F.e)(l,a.origin,l);let c=0,h=1;if(ma(t))1===t.direction[0]&&-1===t.direction[1]?c=Oa:1===t.direction[0]&&1===t.direction[1]?c=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(c=3*Math.PI/2),h=o;else{const e=0!==t.direction[0]?1:2;c=1===e?Oa:0,h=(1===e?s:r)-n}const p=Object(Q.i)(rt.a.get());Object(Q.g)(p,p,c),Object(Q.r)(p,p,Object(F.v)(rt.d.get(),h,h,h)),Object(Q.l)(p,i,p),p[12]=0,p[13]=0,p[14]=0,e.modelTransform=p,e.renderLocation=l}(t,this.resizeHandles[i],e,this.displayBounds)})}updateZMoveHandle(e,t){const i=this.displayBounds,a={basis:i.basis1,direction:-1,position:Object(F.i)(rt.d.get(),i.origin,i.basis1),edge:2},r=rt.a.get();Object(Q.g)(r,t,a.edge*Math.PI/2),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=a.position}cancel(){const e=this.reshapeHelper.editGeometry.lastOperation;Object(n.j)(e)||(this.reshapeHelper.undo(),this.graphic.geometry=this.reshapeHelper.geometry,xa(e,this.mapBounds),this.updateDisplayBounds(this.mapBounds),this.inputState=null)}canUndo(){return this.reshapeHelper.canUndo}undo(){if(Object(n.k)(this.inputState))this.view.activeTool=null;else if(this.canUndo()){const e=this.reshapeHelper.undo();this.graphic.geometry=this.reshapeHelper.geometry,xa(Object(n.q)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}canRedo(){return this.reshapeHelper.canRedo}redo(){if(this.canRedo()){const e=this.reshapeHelper.redo();this.graphic.geometry=this.reshapeHelper.geometry,wa(Object(n.q)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}};Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Ea.prototype,"view",void 0),Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Ea.prototype,"graphic",void 0),Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Ea.prototype,"enableZ",void 0),Object(r.a)([Object(c.b)()],Ea.prototype,"enableRotation",void 0),Object(r.a)([Object(c.b)()],Ea.prototype,"enableScaling",void 0),Object(r.a)([Object(c.b)()],Ea.prototype,"preserveAspectRatio",null),Object(r.a)([Object(c.b)()],Ea.prototype,"grabbing",void 0),Object(r.a)([Object(c.b)()],Ea.prototype,"inputState",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],Ea.prototype,"type",void 0),Ea=Object(r.a)([Object(h.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Ea);const Aa="draped-elevation-changes",Da=10,Ga=80,Ra=1e-6},U282:function(e,t,i){"use strict";function a(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,i=0;for(let a=0;a<e.length;a++){const r=e[a].size;"number"==typeof r&&(t+=r,i++)}return t/i}(e.stops):t}function s(e,t){if(!t)return e;const i=t.filter(e=>"size"===e.type).map(t=>{const{maxSize:i,minSize:a}=t;return(r(i,e)+r(a,e))/2});let a=0;const s=i.length;if(0===s)return e;for(let r=0;r<s;r++)a+=i[r];const n=Math.floor(a/s);return Math.max(n,e)}function n(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const r="visualVariables"in t?s(i,t.visualVariables):i;if("simple"===t.type)return a(r,t.symbol);if("unique-value"===t.type){let e=r;return t.uniqueValueInfos.forEach(t=>{e=a(e,t.symbol)}),e}if("class-breaks"===t.type){let e=r;return t.classBreakInfos.forEach(t=>{e=a(e,t.symbol)}),e}return r}i.d(t,"a",function(){return n})},cTsy:function(e,t,i){"use strict";i.d(t,"a",function(){return d}),i.d(t,"b",function(){return p});var a=i("OIYi"),r=i("Tbkp"),s=i("aQrP"),n=i("0nJL"),o=i("agdK"),l=i("69UF"),c=i("Z1Ae"),h=i("bVvB");function p(e){const t=new s.a;return t.include(r.a,{linearDepth:!1}),t.include(h.a,e),t.include(c.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(a.a`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      gl_Position = transformPosition(proj, view, vpos);
  `),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(a.a`
    vec4 vpos2 = transformPosition(proj, view, auxpos1);
    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);

    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;
    ${e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""}

    // Cancel out perspective correct interpolation because we want this length the really represent
    // the screen distance
    stipplePatternUv *= gl_Position.w;
    `)),t.vertex.code.add(a.a`
  }
  `),4===e.output&&t.include(o.a),t.include(n.a,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(a.a`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${a.a.float(l.c)}) {
      discard;
    }

    ${0===e.output?a.a`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===e.output?a.a`outputHighlight();`:""}
  }
  `),t}var d=Object.freeze({__proto__:null,build:p})},sE2g:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return s});var a=i("OIYi"),r=i("aQrP");function s(){const e=new r.a;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(a.a`
    void main(void) {
      vUV = uv0;
      gl_Position = proj * view * vec4(position, 1.0);
    }
  `),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(a.a`
    void main() {
      const float LINE_WIDTH = 1.0;

      vec2 uvScaled = vUV * gridWidth;
      vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
      vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);

      // mask aliasing along edges
      grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
      grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);

      float gridFade = max(grid.x, grid.y);

      float gridAlpha = gridColor.a * gridFade;

      // premultiply alpha in output
      gl_FragColor =
        vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
        vec4(gridColor.rgb, 1.0) * gridAlpha;
    }
  `),e}var n=Object.freeze({__proto__:null,build:s})}}]);